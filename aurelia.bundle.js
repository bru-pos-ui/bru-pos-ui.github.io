webpackJsonp([1],{

/***/ 1:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony export (binding) */ __webpack_require__.d(exports, "_emptyParameters", function() { return _emptyParameters; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InvocationHandler", function() { return InvocationHandler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Container", function() { return Container; });
/* harmony export (binding) */ __webpack_require__.d(exports, "autoinject", function() { return autoinject; });
/* harmony export (binding) */ __webpack_require__.d(exports, "inject", function() { return inject; });
/* harmony export (binding) */ __webpack_require__.d(exports, "invoker", function() { return invoker; });
/* harmony export (binding) */ __webpack_require__.d(exports, "invokeAsFactory", function() { return invokeAsFactory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "FactoryInvoker", function() { return FactoryInvoker; });
/* harmony export (binding) */ __webpack_require__.d(exports, "registration", function() { return registration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "transient", function() { return transient; });
/* harmony export (binding) */ __webpack_require__.d(exports, "singleton", function() { return singleton; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TransientRegistration", function() { return TransientRegistration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SingletonRegistration", function() { return SingletonRegistration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "resolver", function() { return resolver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Strategy", function() { return Strategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StrategyResolver", function() { return StrategyResolver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Lazy", function() { return Lazy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "All", function() { return All; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Optional", function() { return Optional; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Parent", function() { return Parent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Factory", function() { return Factory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NewInstance", function() { return NewInstance; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getDecoratorDependencies", function() { return getDecoratorDependencies; });
/* harmony export (binding) */ __webpack_require__.d(exports, "lazy", function() { return lazy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "all", function() { return all; });
/* harmony export (binding) */ __webpack_require__.d(exports, "optional", function() { return optional; });
/* harmony export (binding) */ __webpack_require__.d(exports, "parent", function() { return parent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "factory", function() { return factory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "newInstance", function() { return newInstance; });



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function isInjectable(potentialTarget) {
    return !!potentialTarget;
}
function autoinject(potentialTarget) {
    var deco = function (target) {
        if (!target.hasOwnProperty('inject')) {
            target.inject = (__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].paramTypes, target) ||
                _emptyParameters).slice();
            if (target.inject && target.inject.length > 0) {
                if (target.inject[target.inject.length - 1] === Object) {
                    target.inject.splice(-1, 1);
                }
            }
        }
    };
    if (isInjectable(potentialTarget)) {
        return deco(potentialTarget);
    }
    return deco;
}
function inject() {
    var rest = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        rest[_i] = arguments[_i];
    }
    return function (target, _key, descriptor) {
        if (typeof descriptor === 'number') {
            autoinject(target);
            if (rest.length === 1) {
                target.inject[descriptor] = rest[0];
            }
            return;
        }
        if (descriptor) {
            var fn = descriptor.value;
            fn.inject = rest;
        }
        else {
            target.inject = rest;
        }
    };
}

var resolver = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["protocol"].create('aurelia:resolver', function (target) {
    if (!(typeof target.get === 'function')) {
        return 'Resolvers must implement: get(container: Container, key: any): any';
    }
    return true;
});
var Strategy;
(function (Strategy) {
    Strategy[Strategy["instance"] = 0] = "instance";
    Strategy[Strategy["singleton"] = 1] = "singleton";
    Strategy[Strategy["transient"] = 2] = "transient";
    Strategy[Strategy["function"] = 3] = "function";
    Strategy[Strategy["array"] = 4] = "array";
    Strategy[Strategy["alias"] = 5] = "alias";
})(Strategy || (Strategy = {}));
function isStrategy(actual, expected, state) {
    return actual === expected;
}
var StrategyResolver = (function () {
    function StrategyResolver(strategy, state) {
        this.strategy = strategy;
        this.state = state;
    }
    StrategyResolver.prototype.get = function (container, key) {
        if (isStrategy(this.strategy, Strategy.instance, this.state)) {
            return this.state;
        }
        if (isStrategy(this.strategy, Strategy.singleton, this.state)) {
            var singleton = container.invoke(this.state);
            this.state = singleton;
            this.strategy = 0;
            return singleton;
        }
        if (isStrategy(this.strategy, Strategy.transient, this.state)) {
            return container.invoke(this.state);
        }
        if (isStrategy(this.strategy, Strategy.function, this.state)) {
            return this.state(container, key, this);
        }
        if (isStrategy(this.strategy, Strategy.array, this.state)) {
            return this.state[0].get(container, key);
        }
        if (isStrategy(this.strategy, Strategy.alias, this.state)) {
            return container.get(this.state);
        }
        throw new Error('Invalid strategy: ' + this.strategy);
    };
    StrategyResolver = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Number, Object])
    ], StrategyResolver);
    return StrategyResolver;
}());
var Lazy = (function () {
    function Lazy(key) {
        this._key = key;
    }
    Lazy_1 = Lazy;
    Lazy.prototype.get = function (container) {
        var _this = this;
        return function () { return container.get(_this._key); };
    };
    Lazy.of = function (key) {
        return new Lazy_1(key);
    };
    var Lazy_1;
    Lazy = Lazy_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], Lazy);
    return Lazy;
}());
var All = (function () {
    function All(key) {
        this._key = key;
    }
    All_1 = All;
    All.prototype.get = function (container) {
        return container.getAll(this._key);
    };
    All.of = function (key) {
        return new All_1(key);
    };
    var All_1;
    All = All_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], All);
    return All;
}());
var Optional = (function () {
    function Optional(key, checkParent) {
        if (checkParent === void 0) { checkParent = true; }
        this._key = key;
        this._checkParent = checkParent;
    }
    Optional_1 = Optional;
    Optional.prototype.get = function (container) {
        if (container.hasResolver(this._key, this._checkParent)) {
            return container.get(this._key);
        }
        return null;
    };
    Optional.of = function (key, checkParent) {
        if (checkParent === void 0) { checkParent = true; }
        return new Optional_1(key, checkParent);
    };
    var Optional_1;
    Optional = Optional_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object, Boolean])
    ], Optional);
    return Optional;
}());
var Parent = (function () {
    function Parent(key) {
        this._key = key;
    }
    Parent_1 = Parent;
    Parent.prototype.get = function (container) {
        return container.parent ? container.parent.get(this._key) : null;
    };
    Parent.of = function (key) {
        return new Parent_1(key);
    };
    var Parent_1;
    Parent = Parent_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], Parent);
    return Parent;
}());
var Factory = (function () {
    function Factory(key) {
        this._key = key;
    }
    Factory_1 = Factory;
    Factory.prototype.get = function (container) {
        var fn = this._key;
        var resolver = container.getResolver(fn);
        if (resolver && resolver.strategy === Strategy.function) {
            fn = resolver.state;
        }
        return function () {
            var rest = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                rest[_i] = arguments[_i];
            }
            return container.invoke(fn, rest);
        };
    };
    Factory.of = function (key) {
        return new Factory_1(key);
    };
    var Factory_1;
    Factory = Factory_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], Factory);
    return Factory;
}());
var NewInstance = (function () {
    function NewInstance(key) {
        var dynamicDependencies = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            dynamicDependencies[_i - 1] = arguments[_i];
        }
        this.key = key;
        this.asKey = key;
        this.dynamicDependencies = dynamicDependencies;
    }
    NewInstance_1 = NewInstance;
    NewInstance.prototype.get = function (container) {
        var dynamicDependencies = this.dynamicDependencies.length > 0
            ? this.dynamicDependencies.map(function (dependency) {
                return dependency['protocol:aurelia:resolver']
                    ? dependency.get(container)
                    : container.get(dependency);
            })
            : undefined;
        var fn = this.key;
        var resolver = container.getResolver(fn);
        if (resolver && resolver.strategy === 3) {
            fn = resolver.state;
        }
        var instance = container.invoke(fn, dynamicDependencies);
        container.registerInstance(this.asKey, instance);
        return instance;
    };
    NewInstance.prototype.as = function (key) {
        this.asKey = key;
        return this;
    };
    NewInstance.of = function (key) {
        var dynamicDependencies = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            dynamicDependencies[_i - 1] = arguments[_i];
        }
        return new (NewInstance_1.bind.apply(NewInstance_1, [void 0, key].concat(dynamicDependencies)))();
    };
    var NewInstance_1;
    NewInstance = NewInstance_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object, Object])
    ], NewInstance);
    return NewInstance;
}());
function getDecoratorDependencies(target) {
    autoinject(target);
    return target.inject;
}
function lazy(keyValue) {
    return function (target, _key, index) {
        var inject$$1 = getDecoratorDependencies(target);
        inject$$1[index] = Lazy.of(keyValue);
    };
}
function all(keyValue) {
    return function (target, _key, index) {
        var inject$$1 = getDecoratorDependencies(target);
        inject$$1[index] = All.of(keyValue);
    };
}
function optional(checkParentOrTarget) {
    if (checkParentOrTarget === void 0) { checkParentOrTarget = true; }
    var deco = function (checkParent) {
        return function (target, _key, index) {
            var inject$$1 = getDecoratorDependencies(target);
            inject$$1[index] = Optional.of(inject$$1[index], checkParent);
        };
    };
    if (typeof checkParentOrTarget === 'boolean') {
        return deco(checkParentOrTarget);
    }
    return deco(true);
}
function parent(target, _key, index) {
    var inject$$1 = getDecoratorDependencies(target);
    inject$$1[index] = Parent.of(inject$$1[index]);
}
function factory(keyValue) {
    return function (target, _key, index) {
        var inject$$1 = getDecoratorDependencies(target);
        inject$$1[index] = Factory.of(keyValue);
    };
}
function newInstance(asKeyOrTarget) {
    var dynamicDependencies = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        dynamicDependencies[_i - 1] = arguments[_i];
    }
    var deco = function (asKey) {
        return function (target, _key, index) {
            var inject$$1 = getDecoratorDependencies(target);
            inject$$1[index] = NewInstance.of.apply(NewInstance, [inject$$1[index]].concat(dynamicDependencies));
            if (!!asKey) {
                inject$$1[index].as(asKey);
            }
        };
    };
    if (arguments.length >= 1) {
        return deco(asKeyOrTarget);
    }
    return deco();
}

function validateKey(key) {
    if (key === null || key === undefined) {
        throw new Error('key/value cannot be null or undefined. Are you trying to inject/register something that doesn\'t exist with DI?');
    }
}
var _emptyParameters = Object.freeze([]);
__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration = 'aurelia:registration';
__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker = 'aurelia:invoker';
var resolverDecorates = resolver.decorates;
var InvocationHandler = (function () {
    function InvocationHandler(fn, invoker, dependencies) {
        this.fn = fn;
        this.invoker = invoker;
        this.dependencies = dependencies;
    }
    InvocationHandler.prototype.invoke = function (container, dynamicDependencies) {
        return dynamicDependencies !== undefined
            ? this.invoker.invokeWithDynamicDependencies(container, this.fn, this.dependencies, dynamicDependencies)
            : this.invoker.invoke(container, this.fn, this.dependencies);
    };
    return InvocationHandler;
}());
function invokeWithDynamicDependencies(container, fn, staticDependencies, dynamicDependencies) {
    var i = staticDependencies.length;
    var args = new Array(i);
    var lookup;
    while (i--) {
        lookup = staticDependencies[i];
        if (lookup === null || lookup === undefined) {
            throw new Error('Constructor Parameter with index ' +
                i +
                ' cannot be null or undefined. Are you trying to inject/register something that doesn\'t exist with DI?');
        }
        else {
            args[i] = container.get(lookup);
        }
    }
    if (dynamicDependencies !== undefined) {
        args = args.concat(dynamicDependencies);
    }
    return Reflect.construct(fn, args);
}
var classInvoker = {
    invoke: function (container, Type, deps) {
        var instances = deps.map(function (dep) { return container.get(dep); });
        return Reflect.construct(Type, instances);
    },
    invokeWithDynamicDependencies: invokeWithDynamicDependencies
};
function getDependencies(f) {
    if (!f.hasOwnProperty('inject')) {
        return [];
    }
    if (typeof f.inject === 'function') {
        return f.inject();
    }
    return f.inject;
}
var Container = (function () {
    function Container(configuration) {
        if (configuration === undefined) {
            configuration = {};
        }
        this._configuration = configuration;
        this._onHandlerCreated = configuration.onHandlerCreated;
        this._handlers =
            configuration.handlers || (configuration.handlers = new Map());
        this._resolvers = new Map();
        this.root = this;
        this.parent = null;
    }
    Container.prototype.makeGlobal = function () {
        Container.instance = this;
        return this;
    };
    Container.prototype.setHandlerCreatedCallback = function (onHandlerCreated) {
        this._onHandlerCreated = onHandlerCreated;
        this._configuration.onHandlerCreated = onHandlerCreated;
    };
    Container.prototype.registerInstance = function (key, instance) {
        return this.registerResolver(key, new StrategyResolver(0, instance === undefined ? key : instance));
    };
    Container.prototype.registerSingleton = function (key, fn) {
        return this.registerResolver(key, new StrategyResolver(1, fn === undefined ? key : fn));
    };
    Container.prototype.registerTransient = function (key, fn) {
        return this.registerResolver(key, new StrategyResolver(2, fn === undefined ? key : fn));
    };
    Container.prototype.registerHandler = function (key, handler) {
        return this.registerResolver(key, new StrategyResolver(3, handler));
    };
    Container.prototype.registerAlias = function (originalKey, aliasKey) {
        return this.registerResolver(aliasKey, new StrategyResolver(5, originalKey));
    };
    Container.prototype.registerResolver = function (key, resolver$$1) {
        validateKey(key);
        var allResolvers = this._resolvers;
        var result = allResolvers.get(key);
        if (result === undefined) {
            allResolvers.set(key, resolver$$1);
        }
        else if (result.strategy === 4) {
            result.state.push(resolver$$1);
        }
        else {
            allResolvers.set(key, new StrategyResolver(4, [result, resolver$$1]));
        }
        return resolver$$1;
    };
    Container.prototype.autoRegister = function (key, fn) {
        fn = fn === undefined ? key : fn;
        if (typeof fn === 'function') {
            var registration = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration, fn);
            if (registration === undefined) {
                return this.registerResolver(key, new StrategyResolver(1, fn));
            }
            return registration.registerResolver(this, key, fn);
        }
        return this.registerResolver(key, new StrategyResolver(0, fn));
    };
    Container.prototype.autoRegisterAll = function (fns) {
        var i = fns.length;
        while (i--) {
            this.autoRegister(fns[i]);
        }
    };
    Container.prototype.unregister = function (key) {
        this._resolvers.delete(key);
    };
    Container.prototype.hasResolver = function (key, checkParent) {
        if (checkParent === void 0) { checkParent = false; }
        validateKey(key);
        return (this._resolvers.has(key) ||
            (checkParent &&
                this.parent !== null &&
                this.parent.hasResolver(key, checkParent)));
    };
    Container.prototype.getResolver = function (key) {
        return this._resolvers.get(key);
    };
    Container.prototype.get = function (key) {
        validateKey(key);
        if (key === Container) {
            return this;
        }
        if (resolverDecorates(key)) {
            return key.get(this, key);
        }
        var resolver$$1 = this._resolvers.get(key);
        if (resolver$$1 === undefined) {
            if (this.parent === null) {
                return this.autoRegister(key).get(this, key);
            }
            var registration = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration, key);
            if (registration === undefined) {
                return this.parent._get(key);
            }
            return registration.registerResolver(this, key, key).get(this, key);
        }
        return resolver$$1.get(this, key);
    };
    Container.prototype._get = function (key) {
        var resolver$$1 = this._resolvers.get(key);
        if (resolver$$1 === undefined) {
            if (this.parent === null) {
                return this.autoRegister(key).get(this, key);
            }
            return this.parent._get(key);
        }
        return resolver$$1.get(this, key);
    };
    Container.prototype.getAll = function (key) {
        validateKey(key);
        var resolver$$1 = this._resolvers.get(key);
        if (resolver$$1 === undefined) {
            if (this.parent === null) {
                return _emptyParameters;
            }
            return this.parent.getAll(key);
        }
        if (resolver$$1.strategy === 4) {
            var state = resolver$$1.state;
            var i = state.length;
            var results = new Array(i);
            while (i--) {
                results[i] = state[i].get(this, key);
            }
            return results;
        }
        return [resolver$$1.get(this, key)];
    };
    Container.prototype.createChild = function () {
        var child = new Container(this._configuration);
        child.root = this.root;
        child.parent = this;
        return child;
    };
    Container.prototype.invoke = function (fn, dynamicDependencies) {
        try {
            var handler = this._handlers.get(fn);
            if (handler === undefined) {
                handler = this._createInvocationHandler(fn);
                this._handlers.set(fn, handler);
            }
            return handler.invoke(this, dynamicDependencies);
        }
        catch (e) {
            throw new __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["AggregateError"]("Error invoking " + fn.name + ". Check the inner error for details.", e, true);
        }
    };
    Container.prototype._createInvocationHandler = function (fn) {
        var dependencies;
        if (fn.inject === undefined) {
            dependencies =
                __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].paramTypes, fn) || _emptyParameters;
        }
        else {
            dependencies = [];
            var ctor = fn;
            while (typeof ctor === 'function') {
                dependencies.push.apply(dependencies, getDependencies(ctor));
                ctor = Object.getPrototypeOf(ctor);
            }
        }
        var invoker = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker, fn) || classInvoker;
        var handler = new InvocationHandler(fn, invoker, dependencies);
        return this._onHandlerCreated !== undefined
            ? this._onHandlerCreated(handler)
            : handler;
    };
    return Container;
}());

function invoker(value) {
    return function (target) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker, value, target);
    };
}
function invokeAsFactory(potentialTarget) {
    var deco = function (target) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker, FactoryInvoker.instance, target);
    };
    return potentialTarget ? deco(potentialTarget) : deco;
}
var FactoryInvoker = (function () {
    function FactoryInvoker() {
    }
    FactoryInvoker.prototype.invoke = function (container, fn, dependencies) {
        var i = dependencies.length;
        var args = new Array(i);
        while (i--) {
            args[i] = container.get(dependencies[i]);
        }
        return fn.apply(undefined, args);
    };
    FactoryInvoker.prototype.invokeWithDynamicDependencies = function (container, fn, staticDependencies, dynamicDependencies) {
        var i = staticDependencies.length;
        var args = new Array(i);
        while (i--) {
            args[i] = container.get(staticDependencies[i]);
        }
        if (dynamicDependencies !== undefined) {
            args = args.concat(dynamicDependencies);
        }
        return fn.apply(undefined, args);
    };
    return FactoryInvoker;
}());
FactoryInvoker.instance = new FactoryInvoker();

function registration(value) {
    return function (target) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration, value, target);
    };
}
function transient(key) {
    return registration(new TransientRegistration(key));
}
function singleton(keyOrRegisterInChild, registerInChild) {
    if (registerInChild === void 0) { registerInChild = false; }
    return registration(new SingletonRegistration(keyOrRegisterInChild, registerInChild));
}
var TransientRegistration = (function () {
    function TransientRegistration(key) {
        this._key = key;
    }
    TransientRegistration.prototype.registerResolver = function (container, key, fn) {
        var existingResolver = container.getResolver(this._key || key);
        return existingResolver === undefined
            ? container.registerTransient((this._key || key), fn)
            : existingResolver;
    };
    return TransientRegistration;
}());
var SingletonRegistration = (function () {
    function SingletonRegistration(keyOrRegisterInChild, registerInChild) {
        if (registerInChild === void 0) { registerInChild = false; }
        if (typeof keyOrRegisterInChild === 'boolean') {
            this._registerInChild = keyOrRegisterInChild;
        }
        else {
            this._key = keyOrRegisterInChild;
            this._registerInChild = registerInChild;
        }
    }
    SingletonRegistration.prototype.registerResolver = function (container, key, fn) {
        var targetContainer = this._registerInChild ? container : container.root;
        var existingResolver = targetContainer.getResolver(this._key || key);
        return existingResolver === undefined
            ? targetContainer.registerSingleton(this._key || key, fn)
            : existingResolver;
    };
    return SingletonRegistration;
}());




/***/ },

/***/ 1354:
/***/ function(module, exports, __webpack_require__) {

__webpack_require__("aurelia-binding");
__webpack_require__(1);
__webpack_require__("aurelia-event-aggregator");
__webpack_require__("aurelia-framework");
__webpack_require__(213);
__webpack_require__("aurelia-history-browser");
__webpack_require__("aurelia-loader");
__webpack_require__("aurelia-loader-webpack");
__webpack_require__(70);
__webpack_require__("aurelia-logging-console");
__webpack_require__(58);
__webpack_require__(23);
__webpack_require__("aurelia-route-recognizer");
__webpack_require__("aurelia-router");
__webpack_require__(138);
__webpack_require__(44);
__webpack_require__("aurelia-templating-binding");
__webpack_require__("aurelia-templating-router");
module.exports = __webpack_require__("aurelia-templating-resources");


/***/ },

/***/ 138:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__ = __webpack_require__(27);
/* harmony export (binding) */ __webpack_require__.d(exports, "TaskQueue", function() { return TaskQueue; });
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };





var stackSeparator = '\nEnqueued in TaskQueue by:\n';
var microStackSeparator = '\nEnqueued in MicroTaskQueue by:\n';

function makeRequestFlushFromMutationObserver(flush) {
  var observer = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createMutationObserver(flush);
  var val = 'a';
  var node = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createTextNode('a');
  var values = Object.create(null);
  values.a = 'b';
  values.b = 'a';
  observer.observe(node, { characterData: true });
  return function requestFlush() {
    node.data = val = values[val];
  };
}

function makeRequestFlushFromTimer(flush) {
  return function requestFlush() {
    var timeoutHandle = setTimeout(handleFlushTimer, 0);

    var intervalHandle = setInterval(handleFlushTimer, 50);
    function handleFlushTimer() {
      clearTimeout(timeoutHandle);
      clearInterval(intervalHandle);
      flush();
    }
  };
}

function onError(error, task, longStacks) {
  if (longStacks && task.stack && (typeof error === 'undefined' ? 'undefined' : _typeof(error)) === 'object' && error !== null) {
    error.stack = filterFlushStack(error.stack) + task.stack;
  }

  if ('onError' in task) {
    task.onError(error);
  } else {
    setTimeout(function () {
      throw error;
    }, 0);
  }
}

var TaskQueue = function () {
  function TaskQueue() {
    var _this = this;

    

    this.flushing = false;
    this.longStacks = false;

    this.microTaskQueue = [];
    this.microTaskQueueCapacity = 1024;
    this.taskQueue = [];

    if (__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["FEATURE"].mutationObserver) {
      this.requestFlushMicroTaskQueue = makeRequestFlushFromMutationObserver(function () {
        return _this.flushMicroTaskQueue();
      });
    } else {
      this.requestFlushMicroTaskQueue = makeRequestFlushFromTimer(function () {
        return _this.flushMicroTaskQueue();
      });
    }

    this.requestFlushTaskQueue = makeRequestFlushFromTimer(function () {
      return _this.flushTaskQueue();
    });
  }

  TaskQueue.prototype._flushQueue = function _flushQueue(queue, capacity) {
    var index = 0;
    var task = void 0;

    try {
      this.flushing = true;
      while (index < queue.length) {
        task = queue[index];
        if (this.longStacks) {
          this.stack = typeof task.stack === 'string' ? task.stack : undefined;
        }
        task.call();
        index++;

        if (index > capacity) {
          for (var scan = 0, newLength = queue.length - index; scan < newLength; scan++) {
            queue[scan] = queue[scan + index];
          }

          queue.length -= index;
          index = 0;
        }
      }
    } catch (error) {
      onError(error, task, this.longStacks);
    } finally {
      this.flushing = false;
    }
  };

  TaskQueue.prototype.queueMicroTask = function queueMicroTask(task) {
    if (this.microTaskQueue.length < 1) {
      this.requestFlushMicroTaskQueue();
    }

    if (this.longStacks) {
      task.stack = this.prepareQueueStack(microStackSeparator);
    }

    this.microTaskQueue.push(task);
  };

  TaskQueue.prototype.queueTask = function queueTask(task) {
    if (this.taskQueue.length < 1) {
      this.requestFlushTaskQueue();
    }

    if (this.longStacks) {
      task.stack = this.prepareQueueStack(stackSeparator);
    }

    this.taskQueue.push(task);
  };

  TaskQueue.prototype.flushTaskQueue = function flushTaskQueue() {
    var queue = this.taskQueue;
    this.taskQueue = [];
    this._flushQueue(queue, Number.MAX_VALUE);
  };

  TaskQueue.prototype.flushMicroTaskQueue = function flushMicroTaskQueue() {
    var queue = this.microTaskQueue;
    this._flushQueue(queue, this.microTaskQueueCapacity);
    queue.length = 0;
  };

  TaskQueue.prototype.prepareQueueStack = function prepareQueueStack(separator) {
    var stack = separator + filterQueueStack(captureStack());

    if (typeof this.stack === 'string') {
      stack = filterFlushStack(stack) + this.stack;
    }

    return stack;
  };

  return TaskQueue;
}();

function captureStack() {
  var error = new Error();

  if (error.stack) {
    return error.stack;
  }

  try {
    throw error;
  } catch (e) {
    return e.stack;
  }
}

function filterQueueStack(stack) {
  return stack.replace(/^[\s\S]*?\bqueue(Micro)?Task\b[^\n]*\n/, '');
}

function filterFlushStack(stack) {
  var index = stack.lastIndexOf('flushMicroTaskQueue');

  if (index < 0) {
    index = stack.lastIndexOf('flushTaskQueue');
    if (index < 0) {
      return stack;
    }
  }

  index = stack.lastIndexOf('\n', index);

  return index < 0 ? stack : stack.substr(0, index);
}

/***/ },

/***/ 213:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(exports, "History", function() { return History; });


function mi(name) {
  throw new Error('History must implement ' + name + '().');
}

var History = function () {
  function History() {
    
  }

  History.prototype.activate = function activate(options) {
    mi('activate');
  };

  History.prototype.deactivate = function deactivate() {
    mi('deactivate');
  };

  History.prototype.getAbsoluteRoot = function getAbsoluteRoot() {
    mi('getAbsoluteRoot');
  };

  History.prototype.navigate = function navigate(fragment, options) {
    mi('navigate');
  };

  History.prototype.navigateBack = function navigateBack() {
    mi('navigateBack');
  };

  History.prototype.setTitle = function setTitle(title) {
    mi('setTitle');
  };

  History.prototype.setState = function setState(key, value) {
    mi('setState');
  };

  History.prototype.getState = function getState(key) {
    mi('getState');
  };

  History.prototype.getHistoryIndex = function getHistoryIndex() {
    mi('getHistoryIndex');
  };

  History.prototype.go = function go(movement) {
    mi('go');
  };

  return History;
}();

/***/ },

/***/ 44:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_loader__ = __webpack_require__("aurelia-loader");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_loader___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_aurelia_loader__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_task_queue__ = __webpack_require__(138);
/* harmony export (binding) */ __webpack_require__.d(exports, "animationEvent", function() { return animationEvent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Animator", function() { return Animator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionTransactionNotifier", function() { return CompositionTransactionNotifier; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionTransactionOwnershipToken", function() { return CompositionTransactionOwnershipToken; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionTransaction", function() { return CompositionTransaction; });
/* harmony export (immutable) */ exports["_hyphenate"] = _hyphenate;
/* harmony export (immutable) */ exports["_isAllWhitespace"] = _isAllWhitespace;
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewEngineHooksResource", function() { return ViewEngineHooksResource; });
/* harmony export (immutable) */ exports["viewEngineHooks"] = viewEngineHooks;
/* harmony export (binding) */ __webpack_require__.d(exports, "ElementEvents", function() { return ElementEvents; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ResourceLoadContext", function() { return ResourceLoadContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewCompileInstruction", function() { return ViewCompileInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BehaviorInstruction", function() { return BehaviorInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TargetInstruction", function() { return TargetInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "viewStrategy", function() { return viewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RelativeViewStrategy", function() { return RelativeViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ConventionalViewStrategy", function() { return ConventionalViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NoViewStrategy", function() { return NoViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplateRegistryViewStrategy", function() { return TemplateRegistryViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InlineViewStrategy", function() { return InlineViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StaticViewStrategy", function() { return StaticViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewLocator", function() { return ViewLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingLanguage", function() { return BindingLanguage; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SlotCustomAttribute", function() { return SlotCustomAttribute; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PassThroughSlot", function() { return PassThroughSlot; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ShadowSlot", function() { return ShadowSlot; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ShadowDOM", function() { return ShadowDOM; });
/* harmony export (immutable) */ exports["validateBehaviorName"] = validateBehaviorName;
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewResources", function() { return ViewResources; });
/* harmony export (binding) */ __webpack_require__.d(exports, "View", function() { return View; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewSlot", function() { return ViewSlot; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BoundViewFactory", function() { return BoundViewFactory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewFactory", function() { return ViewFactory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewCompiler", function() { return ViewCompiler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ResourceModule", function() { return ResourceModule; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ResourceDescription", function() { return ResourceDescription; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ModuleAnalyzer", function() { return ModuleAnalyzer; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewEngine", function() { return ViewEngine; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Controller", function() { return Controller; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BehaviorPropertyObserver", function() { return BehaviorPropertyObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindableProperty", function() { return BindableProperty; });
/* harmony export (binding) */ __webpack_require__.d(exports, "HtmlBehaviorResource", function() { return HtmlBehaviorResource; });
/* harmony export (immutable) */ exports["children"] = children;
/* harmony export (immutable) */ exports["child"] = child;
/* harmony export (binding) */ __webpack_require__.d(exports, "SwapStrategies", function() { return SwapStrategies; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionEngine", function() { return CompositionEngine; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ElementConfigResource", function() { return ElementConfigResource; });
/* harmony export (immutable) */ exports["resource"] = resource;
/* harmony export (immutable) */ exports["behavior"] = behavior;
/* harmony export (immutable) */ exports["customElement"] = customElement;
/* harmony export (immutable) */ exports["customAttribute"] = customAttribute;
/* harmony export (immutable) */ exports["templateController"] = templateController;
/* harmony export (immutable) */ exports["bindable"] = bindable;
/* harmony export (immutable) */ exports["dynamicOptions"] = dynamicOptions;
/* harmony export (immutable) */ exports["useShadowDOM"] = useShadowDOM;
/* harmony export (immutable) */ exports["processAttributes"] = processAttributes;
/* harmony export (immutable) */ exports["processContent"] = processContent;
/* harmony export (immutable) */ exports["containerless"] = containerless;
/* harmony export (immutable) */ exports["useViewStrategy"] = useViewStrategy;
/* harmony export (immutable) */ exports["useView"] = useView;
/* harmony export (immutable) */ exports["inlineView"] = inlineView;
/* harmony export (immutable) */ exports["noView"] = noView;
/* harmony export (immutable) */ exports["view"] = view;
/* harmony export (immutable) */ exports["elementConfig"] = elementConfig;
/* harmony export (immutable) */ exports["viewResources"] = viewResources;
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplatingEngine", function() { return TemplatingEngine; });
var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _class, _temp, _class2, _temp2, _dec, _class3, _dec2, _class4, _dec3, _class5, _dec4, _class6, _dec5, _class7, _dec6, _class8, _class9, _temp3, _class10, _temp4, _class12, _class14, _temp5, _dec7, _class15, _dec8, _class16, _dec9, _class17;












var animationEvent = {
  enterBegin: 'animation:enter:begin',
  enterActive: 'animation:enter:active',
  enterDone: 'animation:enter:done',
  enterTimeout: 'animation:enter:timeout',

  leaveBegin: 'animation:leave:begin',
  leaveActive: 'animation:leave:active',
  leaveDone: 'animation:leave:done',
  leaveTimeout: 'animation:leave:timeout',

  staggerNext: 'animation:stagger:next',

  removeClassBegin: 'animation:remove-class:begin',
  removeClassActive: 'animation:remove-class:active',
  removeClassDone: 'animation:remove-class:done',
  removeClassTimeout: 'animation:remove-class:timeout',

  addClassBegin: 'animation:add-class:begin',
  addClassActive: 'animation:add-class:active',
  addClassDone: 'animation:add-class:done',
  addClassTimeout: 'animation:add-class:timeout',

  animateBegin: 'animation:animate:begin',
  animateActive: 'animation:animate:active',
  animateDone: 'animation:animate:done',
  animateTimeout: 'animation:animate:timeout',

  sequenceBegin: 'animation:sequence:begin',
  sequenceDone: 'animation:sequence:done'
};

var Animator = function () {
  function Animator() {
    
  }

  Animator.prototype.enter = function enter(element) {
    return Promise.resolve(false);
  };

  Animator.prototype.leave = function leave(element) {
    return Promise.resolve(false);
  };

  Animator.prototype.removeClass = function removeClass(element, className) {
    element.classList.remove(className);
    return Promise.resolve(false);
  };

  Animator.prototype.addClass = function addClass(element, className) {
    element.classList.add(className);
    return Promise.resolve(false);
  };

  Animator.prototype.animate = function animate(element, className) {
    return Promise.resolve(false);
  };

  Animator.prototype.runSequence = function runSequence(animations) {};

  Animator.prototype.registerEffect = function registerEffect(effectName, properties) {};

  Animator.prototype.unregisterEffect = function unregisterEffect(effectName) {};

  return Animator;
}();

var CompositionTransactionNotifier = function () {
  function CompositionTransactionNotifier(owner) {
    

    this.owner = owner;
    this.owner._compositionCount++;
  }

  CompositionTransactionNotifier.prototype.done = function done() {
    this.owner._compositionCount--;
    this.owner._tryCompleteTransaction();
  };

  return CompositionTransactionNotifier;
}();

var CompositionTransactionOwnershipToken = function () {
  function CompositionTransactionOwnershipToken(owner) {
    

    this.owner = owner;
    this.owner._ownershipToken = this;
    this.thenable = this._createThenable();
  }

  CompositionTransactionOwnershipToken.prototype.waitForCompositionComplete = function waitForCompositionComplete() {
    this.owner._tryCompleteTransaction();
    return this.thenable;
  };

  CompositionTransactionOwnershipToken.prototype.resolve = function resolve() {
    this._resolveCallback();
  };

  CompositionTransactionOwnershipToken.prototype._createThenable = function _createThenable() {
    var _this = this;

    return new Promise(function (resolve, reject) {
      _this._resolveCallback = resolve;
    });
  };

  return CompositionTransactionOwnershipToken;
}();

var CompositionTransaction = function () {
  function CompositionTransaction() {
    

    this._ownershipToken = null;
    this._compositionCount = 0;
  }

  CompositionTransaction.prototype.tryCapture = function tryCapture() {
    return this._ownershipToken === null ? new CompositionTransactionOwnershipToken(this) : null;
  };

  CompositionTransaction.prototype.enlist = function enlist() {
    return new CompositionTransactionNotifier(this);
  };

  CompositionTransaction.prototype._tryCompleteTransaction = function _tryCompleteTransaction() {
    if (this._compositionCount <= 0) {
      this._compositionCount = 0;

      if (this._ownershipToken !== null) {
        var token = this._ownershipToken;
        this._ownershipToken = null;
        token.resolve();
      }
    }
  };

  return CompositionTransaction;
}();

var capitalMatcher = /([A-Z])/g;

function addHyphenAndLower(char) {
  return '-' + char.toLowerCase();
}

function _hyphenate(name) {
  return (name.charAt(0).toLowerCase() + name.slice(1)).replace(capitalMatcher, addHyphenAndLower);
}

function _isAllWhitespace(node) {
  return !(node.auInterpolationTarget || /[^\t\n\r ]/.test(node.textContent));
}

var ViewEngineHooksResource = function () {
  function ViewEngineHooksResource() {
    
  }

  ViewEngineHooksResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  ViewEngineHooksResource.prototype.register = function register(registry, name) {
    registry.registerViewEngineHooks(this.instance);
  };

  ViewEngineHooksResource.prototype.load = function load(container, target) {};

  ViewEngineHooksResource.convention = function convention(name) {
    if (name.endsWith('ViewEngineHooks')) {
      return new ViewEngineHooksResource();
    }
  };

  return ViewEngineHooksResource;
}();

function viewEngineHooks(target) {
  var deco = function deco(t) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, new ViewEngineHooksResource(), t);
  };

  return target ? deco(target) : deco;
}

var ElementEvents = (_temp = _class = function () {
  function ElementEvents(element) {
    

    this.element = element;
    this.subscriptions = {};
  }

  ElementEvents.prototype._enqueueHandler = function _enqueueHandler(handler) {
    this.subscriptions[handler.eventName] = this.subscriptions[handler.eventName] || [];
    this.subscriptions[handler.eventName].push(handler);
  };

  ElementEvents.prototype._dequeueHandler = function _dequeueHandler(handler) {
    var index = void 0;
    var subscriptions = this.subscriptions[handler.eventName];
    if (subscriptions) {
      index = subscriptions.indexOf(handler);
      if (index > -1) {
        subscriptions.splice(index, 1);
      }
    }
    return handler;
  };

  ElementEvents.prototype.publish = function publish(eventName) {
    var detail = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var bubbles = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
    var cancelable = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;

    var event = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createCustomEvent(eventName, { cancelable: cancelable, bubbles: bubbles, detail: detail });
    this.element.dispatchEvent(event);
  };

  ElementEvents.prototype.subscribe = function subscribe(eventName, handler, captureOrOptions) {
    if (typeof handler === 'function') {
      if (captureOrOptions === undefined) {
        captureOrOptions = ElementEvents.defaultListenerOptions;
      }
      var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, false);
      return eventHandler;
    }

    return undefined;
  };

  ElementEvents.prototype.subscribeOnce = function subscribeOnce(eventName, handler, captureOrOptions) {
    if (typeof handler === 'function') {
      if (captureOrOptions === undefined) {
        captureOrOptions = ElementEvents.defaultListenerOptions;
      }
      var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, true);
      return eventHandler;
    }

    return undefined;
  };

  ElementEvents.prototype.dispose = function dispose(eventName) {
    if (eventName && typeof eventName === 'string') {
      var subscriptions = this.subscriptions[eventName];
      if (subscriptions) {
        while (subscriptions.length) {
          var subscription = subscriptions.pop();
          if (subscription) {
            subscription.dispose();
          }
        }
      }
    } else {
      this.disposeAll();
    }
  };

  ElementEvents.prototype.disposeAll = function disposeAll() {
    for (var _key in this.subscriptions) {
      this.dispose(_key);
    }
  };

  return ElementEvents;
}(), _class.defaultListenerOptions = true, _temp);

var EventHandlerImpl = function () {
  function EventHandlerImpl(owner, eventName, handler, captureOrOptions, once) {
    

    this.owner = owner;
    this.eventName = eventName;
    this.handler = handler;

    this.capture = typeof captureOrOptions === 'boolean' ? captureOrOptions : captureOrOptions.capture;
    this.bubbles = !this.capture;
    this.captureOrOptions = captureOrOptions;
    this.once = once;
    owner.element.addEventListener(eventName, this, captureOrOptions);
    owner._enqueueHandler(this);
  }

  EventHandlerImpl.prototype.handleEvent = function handleEvent(e) {
    var fn = this.handler;
    fn(e);
    if (this.once) {
      this.dispose();
    }
  };

  EventHandlerImpl.prototype.dispose = function dispose() {
    this.owner.element.removeEventListener(this.eventName, this, this.captureOrOptions);
    this.owner._dequeueHandler(this);
    this.owner = this.handler = null;
  };

  return EventHandlerImpl;
}();

var ResourceLoadContext = function () {
  function ResourceLoadContext() {
    

    this.dependencies = {};
  }

  ResourceLoadContext.prototype.addDependency = function addDependency(url) {
    this.dependencies[url] = true;
  };

  ResourceLoadContext.prototype.hasDependency = function hasDependency(url) {
    return url in this.dependencies;
  };

  return ResourceLoadContext;
}();

var ViewCompileInstruction = function ViewCompileInstruction() {
  var targetShadowDOM = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
  var compileSurrogate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

  

  this.targetShadowDOM = targetShadowDOM;
  this.compileSurrogate = compileSurrogate;
  this.associatedModuleId = null;
};

ViewCompileInstruction.normal = new ViewCompileInstruction();

var BehaviorInstruction = function () {
  function BehaviorInstruction() {
    
  }

  BehaviorInstruction.enhance = function enhance() {
    var instruction = new BehaviorInstruction();
    instruction.enhance = true;
    return instruction;
  };

  BehaviorInstruction.unitTest = function unitTest(type, attributes) {
    var instruction = new BehaviorInstruction();
    instruction.type = type;
    instruction.attributes = attributes || {};
    return instruction;
  };

  BehaviorInstruction.element = function element(node, type) {
    var instruction = new BehaviorInstruction();
    instruction.type = type;
    instruction.attributes = {};
    instruction.anchorIsContainer = !(node.hasAttribute('containerless') || type.containerless);
    instruction.initiatedByBehavior = true;
    return instruction;
  };

  BehaviorInstruction.attribute = function attribute(attrName, type) {
    var instruction = new BehaviorInstruction();
    instruction.attrName = attrName;
    instruction.type = type || null;
    instruction.attributes = {};
    return instruction;
  };

  BehaviorInstruction.dynamic = function dynamic(host, viewModel, viewFactory) {
    var instruction = new BehaviorInstruction();
    instruction.host = host;
    instruction.viewModel = viewModel;
    instruction.viewFactory = viewFactory;
    instruction.inheritBindingContext = true;
    return instruction;
  };

  return BehaviorInstruction;
}();

var biProto = BehaviorInstruction.prototype;
biProto.initiatedByBehavior = false;
biProto.enhance = false;
biProto.partReplacements = null;
biProto.viewFactory = null;
biProto.originalAttrName = null;
biProto.skipContentProcessing = false;
biProto.contentFactory = null;
biProto.viewModel = null;
biProto.anchorIsContainer = false;
biProto.host = null;
biProto.attributes = null;
biProto.type = null;
biProto.attrName = null;
biProto.inheritBindingContext = false;

BehaviorInstruction.normal = new BehaviorInstruction();

var TargetInstruction = (_temp2 = _class2 = function () {
  function TargetInstruction() {
    
  }

  TargetInstruction.shadowSlot = function shadowSlot(parentInjectorId) {
    var instruction = new TargetInstruction();
    instruction.parentInjectorId = parentInjectorId;
    instruction.shadowSlot = true;
    return instruction;
  };

  TargetInstruction.contentExpression = function contentExpression(expression) {
    var instruction = new TargetInstruction();
    instruction.contentExpression = expression;
    return instruction;
  };

  TargetInstruction.letElement = function letElement(expressions) {
    var instruction = new TargetInstruction();
    instruction.expressions = expressions;
    instruction.letElement = true;
    return instruction;
  };

  TargetInstruction.lifting = function lifting(parentInjectorId, liftingInstruction) {
    var instruction = new TargetInstruction();
    instruction.parentInjectorId = parentInjectorId;
    instruction.expressions = TargetInstruction.noExpressions;
    instruction.behaviorInstructions = [liftingInstruction];
    instruction.viewFactory = liftingInstruction.viewFactory;
    instruction.providers = [liftingInstruction.type.target];
    instruction.lifting = true;
    return instruction;
  };

  TargetInstruction.normal = function normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction) {
    var instruction = new TargetInstruction();
    instruction.injectorId = injectorId;
    instruction.parentInjectorId = parentInjectorId;
    instruction.providers = providers;
    instruction.behaviorInstructions = behaviorInstructions;
    instruction.expressions = expressions;
    instruction.anchorIsContainer = elementInstruction ? elementInstruction.anchorIsContainer : true;
    instruction.elementInstruction = elementInstruction;
    return instruction;
  };

  TargetInstruction.surrogate = function surrogate(providers, behaviorInstructions, expressions, values) {
    var instruction = new TargetInstruction();
    instruction.expressions = expressions;
    instruction.behaviorInstructions = behaviorInstructions;
    instruction.providers = providers;
    instruction.values = values;
    return instruction;
  };

  return TargetInstruction;
}(), _class2.noExpressions = Object.freeze([]), _temp2);

var tiProto = TargetInstruction.prototype;

tiProto.injectorId = null;
tiProto.parentInjectorId = null;

tiProto.shadowSlot = false;
tiProto.slotName = null;
tiProto.slotFallbackFactory = null;

tiProto.contentExpression = null;
tiProto.letElement = false;

tiProto.expressions = null;
tiProto.expressions = null;
tiProto.providers = null;

tiProto.viewFactory = null;

tiProto.anchorIsContainer = false;
tiProto.elementInstruction = null;
tiProto.lifting = false;

tiProto.values = null;

var viewStrategy = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["protocol"].create('aurelia:view-strategy', {
  validate: function validate(target) {
    if (!(typeof target.loadViewFactory === 'function')) {
      return 'View strategies must implement: loadViewFactory(viewEngine: ViewEngine, compileInstruction: ViewCompileInstruction, loadContext?: ResourceLoadContext): Promise<ViewFactory>';
    }

    return true;
  },
  compose: function compose(target) {
    if (!(typeof target.makeRelativeTo === 'function')) {
      target.makeRelativeTo = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["PLATFORM"].noop;
    }
  }
});

var RelativeViewStrategy = (_dec = viewStrategy(), _dec(_class3 = function () {
  function RelativeViewStrategy(path) {
    

    this.path = path;
    this.absolutePath = null;
  }

  RelativeViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext, target) {
    if (this.absolutePath === null && this.moduleId) {
      this.absolutePath = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_path__["relativeToFile"])(this.path, this.moduleId);
    }

    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(this.absolutePath || this.path, compileInstruction, loadContext, target);
  };

  RelativeViewStrategy.prototype.makeRelativeTo = function makeRelativeTo(file) {
    if (this.absolutePath === null) {
      this.absolutePath = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_path__["relativeToFile"])(this.path, file);
    }
  };

  return RelativeViewStrategy;
}()) || _class3);

var ConventionalViewStrategy = (_dec2 = viewStrategy(), _dec2(_class4 = function () {
  function ConventionalViewStrategy(viewLocator, origin) {
    

    this.moduleId = origin.moduleId;
    this.viewUrl = viewLocator.convertOriginToViewUrl(origin);
  }

  ConventionalViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext, target) {
    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(this.viewUrl, compileInstruction, loadContext, target);
  };

  return ConventionalViewStrategy;
}()) || _class4);

var NoViewStrategy = (_dec3 = viewStrategy(), _dec3(_class5 = function () {
  function NoViewStrategy(dependencies, dependencyBaseUrl) {
    

    this.dependencies = dependencies || null;
    this.dependencyBaseUrl = dependencyBaseUrl || '';
  }

  NoViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext, target) {
    var entry = this.entry;
    var dependencies = this.dependencies;

    if (entry && entry.factoryIsReady) {
      return Promise.resolve(null);
    }

    this.entry = entry = new __WEBPACK_IMPORTED_MODULE_3_aurelia_loader__["TemplateRegistryEntry"](this.moduleId || this.dependencyBaseUrl);

    entry.dependencies = [];
    entry.templateIsLoaded = true;

    if (dependencies !== null) {
      for (var i = 0, ii = dependencies.length; i < ii; ++i) {
        var current = dependencies[i];

        if (typeof current === 'string' || typeof current === 'function') {
          entry.addDependency(current);
        } else {
          entry.addDependency(current.from, current.as);
        }
      }
    }

    compileInstruction.associatedModuleId = this.moduleId;

    return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);
  };

  return NoViewStrategy;
}()) || _class5);

var TemplateRegistryViewStrategy = (_dec4 = viewStrategy(), _dec4(_class6 = function () {
  function TemplateRegistryViewStrategy(moduleId, entry) {
    

    this.moduleId = moduleId;
    this.entry = entry;
  }

  TemplateRegistryViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext, target) {
    var entry = this.entry;

    if (entry.factoryIsReady) {
      return Promise.resolve(entry.factory);
    }

    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);
  };

  return TemplateRegistryViewStrategy;
}()) || _class6);

var InlineViewStrategy = (_dec5 = viewStrategy(), _dec5(_class7 = function () {
  function InlineViewStrategy(markup, dependencies, dependencyBaseUrl) {
    

    this.markup = markup;
    this.dependencies = dependencies || null;
    this.dependencyBaseUrl = dependencyBaseUrl || '';
  }

  InlineViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext, target) {
    var entry = this.entry;
    var dependencies = this.dependencies;

    if (entry && entry.factoryIsReady) {
      return Promise.resolve(entry.factory);
    }

    this.entry = entry = new __WEBPACK_IMPORTED_MODULE_3_aurelia_loader__["TemplateRegistryEntry"](this.moduleId || this.dependencyBaseUrl);
    entry.template = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createTemplateFromMarkup(this.markup);

    if (dependencies !== null) {
      for (var i = 0, ii = dependencies.length; i < ii; ++i) {
        var current = dependencies[i];

        if (typeof current === 'string' || typeof current === 'function') {
          entry.addDependency(current);
        } else {
          entry.addDependency(current.from, current.as);
        }
      }
    }

    compileInstruction.associatedModuleId = this.moduleId;
    return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);
  };

  return InlineViewStrategy;
}()) || _class7);

var StaticViewStrategy = (_dec6 = viewStrategy(), _dec6(_class8 = function () {
  function StaticViewStrategy(config) {
    

    if (typeof config === 'string' || config instanceof __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].Element && config.tagName === 'TEMPLATE') {
      config = {
        template: config
      };
    }
    this.template = config.template;
    this.dependencies = config.dependencies || [];
    this.factoryIsReady = false;
    this.onReady = null;
    this.moduleId = 'undefined';
  }

  StaticViewStrategy.prototype.loadViewFactory = function loadViewFactory(viewEngine, compileInstruction, loadContext, target) {
    var _this2 = this;

    if (this.factoryIsReady) {
      return Promise.resolve(this.factory);
    }
    var deps = this.dependencies;
    deps = typeof deps === 'function' ? deps() : deps;
    deps = deps ? deps : [];
    deps = Array.isArray(deps) ? deps : [deps];

    return Promise.all(deps).then(function (dependencies) {
      var container = viewEngine.container;
      var appResources = viewEngine.appResources;
      var viewCompiler = viewEngine.viewCompiler;
      var viewResources = new ViewResources(appResources);

      var resource = void 0;
      var elDeps = [];

      if (target) {
        viewResources.autoRegister(container, target);
      }

      for (var _iterator = dependencies, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
        var _ref;

        if (_isArray) {
          if (_i >= _iterator.length) break;
          _ref = _iterator[_i++];
        } else {
          _i = _iterator.next();
          if (_i.done) break;
          _ref = _i.value;
        }

        var dep = _ref;

        if (typeof dep === 'function') {
          resource = viewResources.autoRegister(container, dep);
          if (resource.elementName !== null) {
            elDeps.push(resource);
          }
        } else if (dep && (typeof dep === 'undefined' ? 'undefined' : _typeof(dep)) === 'object') {
          for (var _key2 in dep) {
            var exported = dep[_key2];
            if (typeof exported === 'function') {
              resource = viewResources.autoRegister(container, exported);
              if (resource.elementName !== null) {
                elDeps.push(resource);
              }
            }
          }
        } else {
          throw new Error('dependency neither function nor object. Received: "' + (typeof dep === 'undefined' ? 'undefined' : _typeof(dep)) + '"');
        }
      }

      return Promise.all(elDeps.map(function (el) {
        return el.load(container, el.target);
      })).then(function () {
        var factory = _this2.template !== null ? viewCompiler.compile(_this2.template, viewResources, compileInstruction) : null;
        _this2.factoryIsReady = true;
        _this2.factory = factory;
        return factory;
      });
    });
  };

  return StaticViewStrategy;
}()) || _class8);

var ViewLocator = (_temp3 = _class9 = function () {
  function ViewLocator() {
    
  }

  ViewLocator.prototype.getViewStrategy = function getViewStrategy(value) {
    if (!value) {
      return null;
    }

    if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && 'getViewStrategy' in value) {
      var _origin = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(value.constructor);

      value = value.getViewStrategy();

      if (typeof value === 'string') {
        value = new RelativeViewStrategy(value);
      }

      viewStrategy.assert(value);

      if (_origin.moduleId) {
        value.makeRelativeTo(_origin.moduleId);
      }

      return value;
    }

    if (typeof value === 'string') {
      value = new RelativeViewStrategy(value);
    }

    if (viewStrategy.validate(value)) {
      return value;
    }

    if (typeof value !== 'function') {
      value = value.constructor;
    }

    if ('$view' in value) {
      var c = value.$view;
      var _view = void 0;
      c = typeof c === 'function' ? c.call(value) : c;
      if (c === null) {
        _view = new NoViewStrategy();
      } else {
        _view = c instanceof StaticViewStrategy ? c : new StaticViewStrategy(c);
      }
      __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(ViewLocator.viewStrategyMetadataKey, _view, value);
      return _view;
    }

    var origin = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(value);
    var strategy = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].get(ViewLocator.viewStrategyMetadataKey, value);

    if (!strategy) {
      if (!origin.moduleId) {
        throw new Error('Cannot determine default view strategy for object.', value);
      }

      strategy = this.createFallbackViewStrategy(origin);
    } else if (origin.moduleId) {
      strategy.moduleId = origin.moduleId;
    }

    return strategy;
  };

  ViewLocator.prototype.createFallbackViewStrategy = function createFallbackViewStrategy(origin) {
    return new ConventionalViewStrategy(this, origin);
  };

  ViewLocator.prototype.convertOriginToViewUrl = function convertOriginToViewUrl(origin) {
    var moduleId = origin.moduleId;
    var id = moduleId.endsWith('.js') || moduleId.endsWith('.ts') ? moduleId.substring(0, moduleId.length - 3) : moduleId;
    return id + '.html';
  };

  return ViewLocator;
}(), _class9.viewStrategyMetadataKey = 'aurelia:view-strategy', _temp3);

function mi(name) {
  throw new Error('BindingLanguage must implement ' + name + '().');
}

var BindingLanguage = function () {
  function BindingLanguage() {
    
  }

  BindingLanguage.prototype.inspectAttribute = function inspectAttribute(resources, elementName, attrName, attrValue) {
    mi('inspectAttribute');
  };

  BindingLanguage.prototype.createAttributeInstruction = function createAttributeInstruction(resources, element, info, existingInstruction) {
    mi('createAttributeInstruction');
  };

  BindingLanguage.prototype.createLetExpressions = function createLetExpressions(resources, element) {
    mi('createLetExpressions');
  };

  BindingLanguage.prototype.inspectTextContent = function inspectTextContent(resources, value) {
    mi('inspectTextContent');
  };

  return BindingLanguage;
}();

var noNodes = Object.freeze([]);

var SlotCustomAttribute = function () {
  SlotCustomAttribute.inject = function inject() {
    return [__WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].Element];
  };

  function SlotCustomAttribute(element) {
    

    this.element = element;
    this.element.auSlotAttribute = this;
  }

  SlotCustomAttribute.prototype.valueChanged = function valueChanged(newValue, oldValue) {};

  return SlotCustomAttribute;
}();

var PassThroughSlot = function () {
  function PassThroughSlot(anchor, name, destinationName, fallbackFactory) {
    

    this.anchor = anchor;
    this.anchor.viewSlot = this;
    this.name = name;
    this.destinationName = destinationName;
    this.fallbackFactory = fallbackFactory;
    this.destinationSlot = null;

    this.projections = 0;

    this.contentView = null;

    var attr = new SlotCustomAttribute(this.anchor);
    attr.value = this.destinationName;
  }

  PassThroughSlot.prototype.renderFallbackContent = function renderFallbackContent(view, nodes, projectionSource, index) {
    if (this.contentView === null) {
      this.contentView = this.fallbackFactory.create(this.ownerView.container);
      this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);

      var slots = Object.create(null);
      slots[this.destinationSlot.name] = this.destinationSlot;

      ShadowDOM.distributeView(this.contentView, slots, projectionSource, index, this.destinationSlot.name);
    }
  };

  PassThroughSlot.prototype.passThroughTo = function passThroughTo(destinationSlot) {
    this.destinationSlot = destinationSlot;
  };

  PassThroughSlot.prototype.addNode = function addNode(view, node, projectionSource, index) {
    if (this.contentView !== null) {
      this.contentView.removeNodes();
      this.contentView.detached();
      this.contentView.unbind();
      this.contentView = null;
    }

    if (node.viewSlot instanceof PassThroughSlot) {
      node.viewSlot.passThroughTo(this);
      return;
    }

    this.projections++;
    this.destinationSlot.addNode(view, node, projectionSource, index);
  };

  PassThroughSlot.prototype.removeView = function removeView(view, projectionSource) {
    this.projections--;
    this.destinationSlot.removeView(view, projectionSource);

    if (this.needsFallbackRendering) {
      this.renderFallbackContent(null, noNodes, projectionSource);
    }
  };

  PassThroughSlot.prototype.removeAll = function removeAll(projectionSource) {
    this.projections = 0;
    this.destinationSlot.removeAll(projectionSource);

    if (this.needsFallbackRendering) {
      this.renderFallbackContent(null, noNodes, projectionSource);
    }
  };

  PassThroughSlot.prototype.projectFrom = function projectFrom(view, projectionSource) {
    this.destinationSlot.projectFrom(view, projectionSource);
  };

  PassThroughSlot.prototype.created = function created(ownerView) {
    this.ownerView = ownerView;
  };

  PassThroughSlot.prototype.bind = function bind(view) {
    if (this.contentView) {
      this.contentView.bind(view.bindingContext, view.overrideContext);
    }
  };

  PassThroughSlot.prototype.attached = function attached() {
    if (this.contentView) {
      this.contentView.attached();
    }
  };

  PassThroughSlot.prototype.detached = function detached() {
    if (this.contentView) {
      this.contentView.detached();
    }
  };

  PassThroughSlot.prototype.unbind = function unbind() {
    if (this.contentView) {
      this.contentView.unbind();
    }
  };

  _createClass(PassThroughSlot, [{
    key: 'needsFallbackRendering',
    get: function get() {
      return this.fallbackFactory && this.projections === 0;
    }
  }]);

  return PassThroughSlot;
}();

var ShadowSlot = function () {
  function ShadowSlot(anchor, name, fallbackFactory) {
    

    this.anchor = anchor;
    this.anchor.isContentProjectionSource = true;
    this.anchor.viewSlot = this;
    this.name = name;
    this.fallbackFactory = fallbackFactory;
    this.contentView = null;
    this.projections = 0;

    this.children = [];
    this.projectFromAnchors = null;
    this.destinationSlots = null;
  }

  ShadowSlot.prototype.addNode = function addNode(view, node, projectionSource, index, destination) {
    if (this.contentView !== null) {
      this.contentView.removeNodes();
      this.contentView.detached();
      this.contentView.unbind();
      this.contentView = null;
    }

    if (node.viewSlot instanceof PassThroughSlot) {
      node.viewSlot.passThroughTo(this);
      return;
    }

    if (this.destinationSlots !== null) {
      ShadowDOM.distributeNodes(view, [node], this.destinationSlots, this, index);
    } else {
      node.auOwnerView = view;
      node.auProjectionSource = projectionSource;
      node.auAssignedSlot = this;

      var anchor = this._findAnchor(view, node, projectionSource, index);
      var parent = anchor.parentNode;

      parent.insertBefore(node, anchor);
      this.children.push(node);
      this.projections++;
    }
  };

  ShadowSlot.prototype.removeView = function removeView(view, projectionSource) {
    if (this.destinationSlots !== null) {
      ShadowDOM.undistributeView(view, this.destinationSlots, this);
    } else if (this.contentView && this.contentView.hasSlots) {
      ShadowDOM.undistributeView(view, this.contentView.slots, projectionSource);
    } else {
      var found = this.children.find(function (x) {
        return x.auSlotProjectFrom === projectionSource;
      });
      if (found) {
        var _children = found.auProjectionChildren;
        var ownChildren = this.children;

        for (var i = 0, ii = _children.length; i < ii; ++i) {
          var _child = _children[i];

          if (_child.auOwnerView === view) {
            _children.splice(i, 1);
            view.fragment.appendChild(_child);
            i--;ii--;

            this.projections--;
            var idx = ownChildren.indexOf(_child);
            if (idx > -1) {
              ownChildren.splice(idx, 1);
            }
          }
        }

        if (this.needsFallbackRendering) {
          this.renderFallbackContent(view, noNodes, projectionSource);
        }
      }
    }
  };

  ShadowSlot.prototype.removeAll = function removeAll(projectionSource) {
    if (this.destinationSlots !== null) {
      ShadowDOM.undistributeAll(this.destinationSlots, this);
    } else if (this.contentView && this.contentView.hasSlots) {
      ShadowDOM.undistributeAll(this.contentView.slots, projectionSource);
    } else {
      var found = this.children.find(function (x) {
        return x.auSlotProjectFrom === projectionSource;
      });

      if (found) {
        var _children2 = found.auProjectionChildren;
        var ownChildren = this.children;

        for (var i = 0, ii = _children2.length; i < ii; ++i) {
          var _child2 = _children2[i];
          _child2.auOwnerView.fragment.appendChild(_child2);

          this.projections--;
          var idx = ownChildren.indexOf(_child2);
          if (idx > -1) {
            ownChildren.splice(idx, 1);
          }
        }

        found.auProjectionChildren = [];

        if (this.needsFallbackRendering) {
          this.renderFallbackContent(null, noNodes, projectionSource);
        }
      }
    }
  };

  ShadowSlot.prototype._findAnchor = function _findAnchor(view, node, projectionSource, index) {
    if (projectionSource) {
      var found = this.children.find(function (x) {
        return x.auSlotProjectFrom === projectionSource;
      });
      if (found) {
        if (index !== undefined) {
          var _children3 = found.auProjectionChildren;
          var viewIndex = -1;
          var lastView = void 0;

          for (var i = 0, ii = _children3.length; i < ii; ++i) {
            var current = _children3[i];

            if (current.auOwnerView !== lastView) {
              viewIndex++;
              lastView = current.auOwnerView;

              if (viewIndex >= index && lastView !== view) {
                _children3.splice(i, 0, node);
                return current;
              }
            }
          }
        }

        found.auProjectionChildren.push(node);
        return found;
      }
    }

    return this.anchor;
  };

  ShadowSlot.prototype.projectTo = function projectTo(slots) {
    this.destinationSlots = slots;
  };

  ShadowSlot.prototype.projectFrom = function projectFrom(view, projectionSource) {
    var anchor = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createComment('anchor');
    var parent = this.anchor.parentNode;
    anchor.auSlotProjectFrom = projectionSource;
    anchor.auOwnerView = view;
    anchor.auProjectionChildren = [];
    parent.insertBefore(anchor, this.anchor);
    this.children.push(anchor);

    if (this.projectFromAnchors === null) {
      this.projectFromAnchors = [];
    }

    this.projectFromAnchors.push(anchor);
  };

  ShadowSlot.prototype.renderFallbackContent = function renderFallbackContent(view, nodes, projectionSource, index) {
    if (this.contentView === null) {
      this.contentView = this.fallbackFactory.create(this.ownerView.container);
      this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);
      this.contentView.insertNodesBefore(this.anchor);
    }

    if (this.contentView.hasSlots) {
      var slots = this.contentView.slots;
      var projectFromAnchors = this.projectFromAnchors;

      if (projectFromAnchors !== null) {
        for (var slotName in slots) {
          var slot = slots[slotName];

          for (var i = 0, ii = projectFromAnchors.length; i < ii; ++i) {
            var anchor = projectFromAnchors[i];
            slot.projectFrom(anchor.auOwnerView, anchor.auSlotProjectFrom);
          }
        }
      }

      this.fallbackSlots = slots;
      ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index);
    }
  };

  ShadowSlot.prototype.created = function created(ownerView) {
    this.ownerView = ownerView;
  };

  ShadowSlot.prototype.bind = function bind(view) {
    if (this.contentView) {
      this.contentView.bind(view.bindingContext, view.overrideContext);
    }
  };

  ShadowSlot.prototype.attached = function attached() {
    if (this.contentView) {
      this.contentView.attached();
    }
  };

  ShadowSlot.prototype.detached = function detached() {
    if (this.contentView) {
      this.contentView.detached();
    }
  };

  ShadowSlot.prototype.unbind = function unbind() {
    if (this.contentView) {
      this.contentView.unbind();
    }
  };

  _createClass(ShadowSlot, [{
    key: 'needsFallbackRendering',
    get: function get() {
      return this.fallbackFactory && this.projections === 0;
    }
  }]);

  return ShadowSlot;
}();

var ShadowDOM = (_temp4 = _class10 = function () {
  function ShadowDOM() {
    
  }

  ShadowDOM.getSlotName = function getSlotName(node) {
    if (node.auSlotAttribute === undefined) {
      return ShadowDOM.defaultSlotKey;
    }

    return node.auSlotAttribute.value;
  };

  ShadowDOM.distributeView = function distributeView(view, slots, projectionSource, index, destinationOverride) {
    var nodes = void 0;

    if (view === null) {
      nodes = noNodes;
    } else {
      var childNodes = view.fragment.childNodes;
      var ii = childNodes.length;
      nodes = new Array(ii);

      for (var i = 0; i < ii; ++i) {
        nodes[i] = childNodes[i];
      }
    }

    ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride);
  };

  ShadowDOM.undistributeView = function undistributeView(view, slots, projectionSource) {
    for (var slotName in slots) {
      slots[slotName].removeView(view, projectionSource);
    }
  };

  ShadowDOM.undistributeAll = function undistributeAll(slots, projectionSource) {
    for (var slotName in slots) {
      slots[slotName].removeAll(projectionSource);
    }
  };

  ShadowDOM.distributeNodes = function distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride) {
    for (var i = 0, ii = nodes.length; i < ii; ++i) {
      var currentNode = nodes[i];
      var nodeType = currentNode.nodeType;

      if (currentNode.isContentProjectionSource) {
        currentNode.viewSlot.projectTo(slots);

        for (var slotName in slots) {
          slots[slotName].projectFrom(view, currentNode.viewSlot);
        }

        nodes.splice(i, 1);
        ii--;i--;
      } else if (nodeType === 1 || nodeType === 3 || currentNode.viewSlot instanceof PassThroughSlot) {
        if (nodeType === 3 && _isAllWhitespace(currentNode)) {
          nodes.splice(i, 1);
          ii--;i--;
        } else {
          var found = slots[destinationOverride || ShadowDOM.getSlotName(currentNode)];

          if (found) {
            found.addNode(view, currentNode, projectionSource, index);
            nodes.splice(i, 1);
            ii--;i--;
          }
        }
      } else {
        nodes.splice(i, 1);
        ii--;i--;
      }
    }

    for (var _slotName in slots) {
      var slot = slots[_slotName];

      if (slot.needsFallbackRendering) {
        slot.renderFallbackContent(view, nodes, projectionSource, index);
      }
    }
  };

  return ShadowDOM;
}(), _class10.defaultSlotKey = '__au-default-slot-key__', _temp4);

function register(lookup, name, resource, type) {
  if (!name) {
    return;
  }

  var existing = lookup[name];
  if (existing) {
    if (existing !== resource) {
      throw new Error('Attempted to register ' + type + ' when one with the same name already exists. Name: ' + name + '.');
    }

    return;
  }

  lookup[name] = resource;
}

function validateBehaviorName(name, type) {
  if (/[A-Z]/.test(name)) {
    var newName = _hyphenate(name);
    __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating').warn('\'' + name + '\' is not a valid ' + type + ' name and has been converted to \'' + newName + '\'. Upper-case letters are not allowed because the DOM is not case-sensitive.');
    return newName;
  }
  return name;
}

var conventionMark = '__au_resource__';

var ViewResources = function () {
  ViewResources.convention = function convention(target, existing) {
    var resource = void 0;

    if (existing && conventionMark in existing) {
      return existing;
    }
    if ('$resource' in target) {
      var config = target.$resource;

      if (typeof config === 'string') {
        resource = existing || new HtmlBehaviorResource();
        resource[conventionMark] = true;
        if (!resource.elementName) {
          resource.elementName = validateBehaviorName(config, 'custom element');
        }
      } else {
        if (typeof config === 'function') {
          config = config.call(target);
        }
        if (typeof config === 'string') {
          config = { name: config };
        }

        config = Object.assign({}, config);

        var resourceType = config.type || 'element';

        var _name = config.name;
        switch (resourceType) {
          case 'element':case 'attribute':
            resource = existing || new HtmlBehaviorResource();
            resource[conventionMark] = true;
            if (resourceType === 'element') {
              if (!resource.elementName) {
                resource.elementName = _name ? validateBehaviorName(_name, 'custom element') : _hyphenate(target.name);
              }
            } else {
              if (!resource.attributeName) {
                resource.attributeName = _name ? validateBehaviorName(_name, 'custom attribute') : _hyphenate(target.name);
              }
            }
            if ('templateController' in config) {
              config.liftsContent = config.templateController;
              delete config.templateController;
            }
            if ('defaultBindingMode' in config && resource.attributeDefaultBindingMode !== undefined) {
              config.attributeDefaultBindingMode = config.defaultBindingMode;
              delete config.defaultBindingMode;
            }

            delete config.name;

            Object.assign(resource, config);
            break;
          case 'valueConverter':
            resource = new __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ValueConverterResource"](__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["camelCase"])(_name || target.name));
            break;
          case 'bindingBehavior':
            resource = new __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["BindingBehaviorResource"](__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["camelCase"])(_name || target.name));
            break;
          case 'viewEngineHooks':
            resource = new ViewEngineHooksResource();
            break;
        }
      }

      if (resource instanceof HtmlBehaviorResource) {
        var _bindables = typeof config === 'string' ? undefined : config.bindables;
        var currentProps = resource.properties;
        if (Array.isArray(_bindables)) {
          for (var i = 0, ii = _bindables.length; ii > i; ++i) {
            var prop = _bindables[i];
            if (!prop || typeof prop !== 'string' && !prop.name) {
              throw new Error('Invalid bindable property at "' + i + '" for class "' + target.name + '". Expected either a string or an object with "name" property.');
            }
            var newProp = new BindableProperty(prop);

            var existed = false;
            for (var j = 0, jj = currentProps.length; jj > j; ++j) {
              if (currentProps[j].name === newProp.name) {
                existed = true;
                break;
              }
            }
            if (existed) {
              continue;
            }
            newProp.registerWith(target, resource);
          }
        }
      }
    }
    return resource;
  };

  function ViewResources(parent, viewUrl) {
    

    this.bindingLanguage = null;

    this.parent = parent || null;
    this.hasParent = this.parent !== null;
    this.viewUrl = viewUrl || '';
    this.lookupFunctions = {
      valueConverters: this.getValueConverter.bind(this),
      bindingBehaviors: this.getBindingBehavior.bind(this)
    };
    this.attributes = Object.create(null);
    this.elements = Object.create(null);
    this.valueConverters = Object.create(null);
    this.bindingBehaviors = Object.create(null);
    this.attributeMap = Object.create(null);
    this.values = Object.create(null);
    this.beforeCompile = this.afterCompile = this.beforeCreate = this.afterCreate = this.beforeBind = this.beforeUnbind = false;
  }

  ViewResources.prototype._tryAddHook = function _tryAddHook(obj, name) {
    if (typeof obj[name] === 'function') {
      var func = obj[name].bind(obj);
      var counter = 1;
      var callbackName = void 0;

      while (this[callbackName = name + counter.toString()] !== undefined) {
        counter++;
      }

      this[name] = true;
      this[callbackName] = func;
    }
  };

  ViewResources.prototype._invokeHook = function _invokeHook(name, one, two, three, four) {
    if (this.hasParent) {
      this.parent._invokeHook(name, one, two, three, four);
    }

    if (this[name]) {
      this[name + '1'](one, two, three, four);

      var callbackName = name + '2';
      if (this[callbackName]) {
        this[callbackName](one, two, three, four);

        callbackName = name + '3';
        if (this[callbackName]) {
          this[callbackName](one, two, three, four);

          var counter = 4;

          while (this[callbackName = name + counter.toString()] !== undefined) {
            this[callbackName](one, two, three, four);
            counter++;
          }
        }
      }
    }
  };

  ViewResources.prototype.registerViewEngineHooks = function registerViewEngineHooks(hooks) {
    this._tryAddHook(hooks, 'beforeCompile');
    this._tryAddHook(hooks, 'afterCompile');
    this._tryAddHook(hooks, 'beforeCreate');
    this._tryAddHook(hooks, 'afterCreate');
    this._tryAddHook(hooks, 'beforeBind');
    this._tryAddHook(hooks, 'beforeUnbind');
  };

  ViewResources.prototype.getBindingLanguage = function getBindingLanguage(bindingLanguageFallback) {
    return this.bindingLanguage || (this.bindingLanguage = bindingLanguageFallback);
  };

  ViewResources.prototype.patchInParent = function patchInParent(newParent) {
    var originalParent = this.parent;

    this.parent = newParent || null;
    this.hasParent = this.parent !== null;

    if (newParent.parent === null) {
      newParent.parent = originalParent;
      newParent.hasParent = originalParent !== null;
    }
  };

  ViewResources.prototype.relativeToView = function relativeToView(path) {
    return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_path__["relativeToFile"])(path, this.viewUrl);
  };

  ViewResources.prototype.registerElement = function registerElement(tagName, behavior) {
    register(this.elements, tagName, behavior, 'an Element');
  };

  ViewResources.prototype.getElement = function getElement(tagName) {
    return this.elements[tagName] || (this.hasParent ? this.parent.getElement(tagName) : null);
  };

  ViewResources.prototype.mapAttribute = function mapAttribute(attribute) {
    return this.attributeMap[attribute] || (this.hasParent ? this.parent.mapAttribute(attribute) : null);
  };

  ViewResources.prototype.registerAttribute = function registerAttribute(attribute, behavior, knownAttribute) {
    this.attributeMap[attribute] = knownAttribute;
    register(this.attributes, attribute, behavior, 'an Attribute');
  };

  ViewResources.prototype.getAttribute = function getAttribute(attribute) {
    return this.attributes[attribute] || (this.hasParent ? this.parent.getAttribute(attribute) : null);
  };

  ViewResources.prototype.registerValueConverter = function registerValueConverter(name, valueConverter) {
    register(this.valueConverters, name, valueConverter, 'a ValueConverter');
  };

  ViewResources.prototype.getValueConverter = function getValueConverter(name) {
    return this.valueConverters[name] || (this.hasParent ? this.parent.getValueConverter(name) : null);
  };

  ViewResources.prototype.registerBindingBehavior = function registerBindingBehavior(name, bindingBehavior) {
    register(this.bindingBehaviors, name, bindingBehavior, 'a BindingBehavior');
  };

  ViewResources.prototype.getBindingBehavior = function getBindingBehavior(name) {
    return this.bindingBehaviors[name] || (this.hasParent ? this.parent.getBindingBehavior(name) : null);
  };

  ViewResources.prototype.registerValue = function registerValue(name, value) {
    register(this.values, name, value, 'a value');
  };

  ViewResources.prototype.getValue = function getValue(name) {
    return this.values[name] || (this.hasParent ? this.parent.getValue(name) : null);
  };

  ViewResources.prototype.autoRegister = function autoRegister(container, impl) {
    var resourceTypeMeta = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, impl);
    if (resourceTypeMeta) {
      if (resourceTypeMeta instanceof HtmlBehaviorResource) {
        ViewResources.convention(impl, resourceTypeMeta);

        if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
          HtmlBehaviorResource.convention(impl.name, resourceTypeMeta);
        }
        if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
          resourceTypeMeta.elementName = _hyphenate(impl.name);
        }
      }
    } else {
      resourceTypeMeta = ViewResources.convention(impl) || HtmlBehaviorResource.convention(impl.name) || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ValueConverterResource"].convention(impl.name) || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["BindingBehaviorResource"].convention(impl.name) || ViewEngineHooksResource.convention(impl.name);
      if (!resourceTypeMeta) {
        resourceTypeMeta = new HtmlBehaviorResource();
        resourceTypeMeta.elementName = _hyphenate(impl.name);
      }
      __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, resourceTypeMeta, impl);
    }
    resourceTypeMeta.initialize(container, impl);
    resourceTypeMeta.register(this);
    return resourceTypeMeta;
  };

  return ViewResources;
}();

var View = function () {
  function View(container, viewFactory, fragment, controllers, bindings, children, slots) {
    

    this.container = container;
    this.viewFactory = viewFactory;
    this.resources = viewFactory.resources;
    this.fragment = fragment;
    this.firstChild = fragment.firstChild;
    this.lastChild = fragment.lastChild;
    this.controllers = controllers;
    this.bindings = bindings;
    this.children = children;
    this.slots = slots;
    this.hasSlots = false;
    this.fromCache = false;
    this.isBound = false;
    this.isAttached = false;
    this.bindingContext = null;
    this.overrideContext = null;
    this.controller = null;
    this.viewModelScope = null;
    this.animatableElement = undefined;
    this._isUserControlled = false;
    this.contentView = null;

    for (var _key3 in slots) {
      this.hasSlots = true;
      break;
    }
  }

  View.prototype.returnToCache = function returnToCache() {
    this.viewFactory.returnViewToCache(this);
  };

  View.prototype.created = function created() {
    var i = void 0;
    var ii = void 0;
    var controllers = this.controllers;

    for (i = 0, ii = controllers.length; i < ii; ++i) {
      controllers[i].created(this);
    }
  };

  View.prototype.bind = function bind(bindingContext, overrideContext, _systemUpdate) {
    var controllers = void 0;
    var bindings = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (_systemUpdate && this._isUserControlled) {
      return;
    }

    if (this.isBound) {
      if (this.bindingContext === bindingContext) {
        return;
      }

      this.unbind();
    }

    this.isBound = true;
    this.bindingContext = bindingContext;
    this.overrideContext = overrideContext || __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(bindingContext);

    this.resources._invokeHook('beforeBind', this);

    bindings = this.bindings;
    for (i = 0, ii = bindings.length; i < ii; ++i) {
      bindings[i].bind(this);
    }

    if (this.viewModelScope !== null) {
      bindingContext.bind(this.viewModelScope.bindingContext, this.viewModelScope.overrideContext);
      this.viewModelScope = null;
    }

    controllers = this.controllers;
    for (i = 0, ii = controllers.length; i < ii; ++i) {
      controllers[i].bind(this);
    }

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      children[i].bind(bindingContext, overrideContext, true);
    }

    if (this.hasSlots) {
      ShadowDOM.distributeView(this.contentView, this.slots);
    }
  };

  View.prototype.addBinding = function addBinding(binding) {
    this.bindings.push(binding);

    if (this.isBound) {
      binding.bind(this);
    }
  };

  View.prototype.unbind = function unbind() {
    var controllers = void 0;
    var bindings = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (this.isBound) {
      this.isBound = false;
      this.resources._invokeHook('beforeUnbind', this);

      if (this.controller !== null) {
        this.controller.unbind();
      }

      bindings = this.bindings;
      for (i = 0, ii = bindings.length; i < ii; ++i) {
        bindings[i].unbind();
      }

      controllers = this.controllers;
      for (i = 0, ii = controllers.length; i < ii; ++i) {
        controllers[i].unbind();
      }

      children = this.children;
      for (i = 0, ii = children.length; i < ii; ++i) {
        children[i].unbind();
      }

      this.bindingContext = null;
      this.overrideContext = null;
    }
  };

  View.prototype.insertNodesBefore = function insertNodesBefore(refNode) {
    refNode.parentNode.insertBefore(this.fragment, refNode);
  };

  View.prototype.appendNodesTo = function appendNodesTo(parent) {
    parent.appendChild(this.fragment);
  };

  View.prototype.removeNodes = function removeNodes() {
    var fragment = this.fragment;
    var current = this.firstChild;
    var end = this.lastChild;
    var next = void 0;

    while (current) {
      next = current.nextSibling;
      fragment.appendChild(current);

      if (current === end) {
        break;
      }

      current = next;
    }
  };

  View.prototype.attached = function attached() {
    var controllers = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (this.isAttached) {
      return;
    }

    this.isAttached = true;

    if (this.controller !== null) {
      this.controller.attached();
    }

    controllers = this.controllers;
    for (i = 0, ii = controllers.length; i < ii; ++i) {
      controllers[i].attached();
    }

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      children[i].attached();
    }
  };

  View.prototype.detached = function detached() {
    var controllers = void 0;
    var children = void 0;
    var i = void 0;
    var ii = void 0;

    if (this.isAttached) {
      this.isAttached = false;

      if (this.controller !== null) {
        this.controller.detached();
      }

      controllers = this.controllers;
      for (i = 0, ii = controllers.length; i < ii; ++i) {
        controllers[i].detached();
      }

      children = this.children;
      for (i = 0, ii = children.length; i < ii; ++i) {
        children[i].detached();
      }
    }
  };

  return View;
}();

function getAnimatableElement(view) {
  if (view.animatableElement !== undefined) {
    return view.animatableElement;
  }

  var current = view.firstChild;

  while (current && current.nodeType !== 1) {
    current = current.nextSibling;
  }

  if (current && current.nodeType === 1) {
    return view.animatableElement = current.classList.contains('au-animate') ? current : null;
  }

  return view.animatableElement = null;
}

var ViewSlot = function () {
  function ViewSlot(anchor, anchorIsContainer) {
    var animator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Animator.instance;

    

    this.anchor = anchor;
    this.anchorIsContainer = anchorIsContainer;
    this.bindingContext = null;
    this.overrideContext = null;
    this.animator = animator;
    this.children = [];
    this.isBound = false;
    this.isAttached = false;
    this.contentSelectors = null;
    anchor.viewSlot = this;
    anchor.isContentProjectionSource = false;
  }

  ViewSlot.prototype.animateView = function animateView(view) {
    var direction = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'enter';

    var animatableElement = getAnimatableElement(view);

    if (animatableElement !== null) {
      switch (direction) {
        case 'enter':
          return this.animator.enter(animatableElement);
        case 'leave':
          return this.animator.leave(animatableElement);
        default:
          throw new Error('Invalid animation direction: ' + direction);
      }
    }
  };

  ViewSlot.prototype.transformChildNodesIntoView = function transformChildNodesIntoView() {
    var parent = this.anchor;

    this.children.push({
      fragment: parent,
      firstChild: parent.firstChild,
      lastChild: parent.lastChild,
      returnToCache: function returnToCache() {},
      removeNodes: function removeNodes() {
        var last = void 0;

        while (last = parent.lastChild) {
          parent.removeChild(last);
        }
      },
      created: function created() {},
      bind: function bind() {},
      unbind: function unbind() {},
      attached: function attached() {},
      detached: function detached() {}
    });
  };

  ViewSlot.prototype.bind = function bind(bindingContext, overrideContext) {
    var i = void 0;
    var ii = void 0;
    var children = void 0;

    if (this.isBound) {
      if (this.bindingContext === bindingContext) {
        return;
      }

      this.unbind();
    }

    this.isBound = true;
    this.bindingContext = bindingContext = bindingContext || this.bindingContext;
    this.overrideContext = overrideContext = overrideContext || this.overrideContext;

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      children[i].bind(bindingContext, overrideContext, true);
    }
  };

  ViewSlot.prototype.unbind = function unbind() {
    if (this.isBound) {
      var i = void 0;
      var ii = void 0;
      var _children4 = this.children;

      this.isBound = false;
      this.bindingContext = null;
      this.overrideContext = null;

      for (i = 0, ii = _children4.length; i < ii; ++i) {
        _children4[i].unbind();
      }
    }
  };

  ViewSlot.prototype.add = function add(view) {
    if (this.anchorIsContainer) {
      view.appendNodesTo(this.anchor);
    } else {
      view.insertNodesBefore(this.anchor);
    }

    this.children.push(view);

    if (this.isAttached) {
      view.attached();
      return this.animateView(view, 'enter');
    }
  };

  ViewSlot.prototype.insert = function insert(index, view) {
    var children = this.children;
    var length = children.length;

    if (index === 0 && length === 0 || index >= length) {
      return this.add(view);
    }

    view.insertNodesBefore(children[index].firstChild);
    children.splice(index, 0, view);

    if (this.isAttached) {
      view.attached();
      return this.animateView(view, 'enter');
    }
  };

  ViewSlot.prototype.move = function move(sourceIndex, targetIndex) {
    if (sourceIndex === targetIndex) {
      return;
    }

    var children = this.children;
    var view = children[sourceIndex];

    view.removeNodes();
    view.insertNodesBefore(children[targetIndex].firstChild);
    children.splice(sourceIndex, 1);
    children.splice(targetIndex, 0, view);
  };

  ViewSlot.prototype.remove = function remove(view, returnToCache, skipAnimation) {
    return this.removeAt(this.children.indexOf(view), returnToCache, skipAnimation);
  };

  ViewSlot.prototype.removeMany = function removeMany(viewsToRemove, returnToCache, skipAnimation) {
    var _this3 = this;

    var children = this.children;
    var ii = viewsToRemove.length;
    var i = void 0;
    var rmPromises = [];

    viewsToRemove.forEach(function (child) {
      if (skipAnimation) {
        child.removeNodes();
        return;
      }

      var animation = _this3.animateView(child, 'leave');
      if (animation) {
        rmPromises.push(animation.then(function () {
          return child.removeNodes();
        }));
      } else {
        child.removeNodes();
      }
    });

    var removeAction = function removeAction() {
      if (_this3.isAttached) {
        for (i = 0; i < ii; ++i) {
          viewsToRemove[i].detached();
        }
      }

      if (returnToCache) {
        for (i = 0; i < ii; ++i) {
          viewsToRemove[i].returnToCache();
        }
      }

      for (i = 0; i < ii; ++i) {
        var index = children.indexOf(viewsToRemove[i]);
        if (index >= 0) {
          children.splice(index, 1);
        }
      }
    };

    if (rmPromises.length > 0) {
      return Promise.all(rmPromises).then(function () {
        return removeAction();
      });
    }

    return removeAction();
  };

  ViewSlot.prototype.removeAt = function removeAt(index, returnToCache, skipAnimation) {
    var _this4 = this;

    var view = this.children[index];

    var removeAction = function removeAction() {
      index = _this4.children.indexOf(view);
      view.removeNodes();
      _this4.children.splice(index, 1);

      if (_this4.isAttached) {
        view.detached();
      }

      if (returnToCache) {
        view.returnToCache();
      }

      return view;
    };

    if (!skipAnimation) {
      var animation = this.animateView(view, 'leave');
      if (animation) {
        return animation.then(function () {
          return removeAction();
        });
      }
    }

    return removeAction();
  };

  ViewSlot.prototype.removeAll = function removeAll(returnToCache, skipAnimation) {
    var _this5 = this;

    var children = this.children;
    var ii = children.length;
    var i = void 0;
    var rmPromises = [];

    children.forEach(function (child) {
      if (skipAnimation) {
        child.removeNodes();
        return;
      }

      var animation = _this5.animateView(child, 'leave');
      if (animation) {
        rmPromises.push(animation.then(function () {
          return child.removeNodes();
        }));
      } else {
        child.removeNodes();
      }
    });

    var removeAction = function removeAction() {
      if (_this5.isAttached) {
        for (i = 0; i < ii; ++i) {
          children[i].detached();
        }
      }

      if (returnToCache) {
        for (i = 0; i < ii; ++i) {
          var _child3 = children[i];

          if (_child3) {
            _child3.returnToCache();
          }
        }
      }

      _this5.children = [];
    };

    if (rmPromises.length > 0) {
      return Promise.all(rmPromises).then(function () {
        return removeAction();
      });
    }

    return removeAction();
  };

  ViewSlot.prototype.attached = function attached() {
    var i = void 0;
    var ii = void 0;
    var children = void 0;
    var child = void 0;

    if (this.isAttached) {
      return;
    }

    this.isAttached = true;

    children = this.children;
    for (i = 0, ii = children.length; i < ii; ++i) {
      child = children[i];
      child.attached();
      this.animateView(child, 'enter');
    }
  };

  ViewSlot.prototype.detached = function detached() {
    var i = void 0;
    var ii = void 0;
    var children = void 0;

    if (this.isAttached) {
      this.isAttached = false;
      children = this.children;
      for (i = 0, ii = children.length; i < ii; ++i) {
        children[i].detached();
      }
    }
  };

  ViewSlot.prototype.projectTo = function projectTo(slots) {
    var _this6 = this;

    this.projectToSlots = slots;
    this.add = this._projectionAdd;
    this.insert = this._projectionInsert;
    this.move = this._projectionMove;
    this.remove = this._projectionRemove;
    this.removeAt = this._projectionRemoveAt;
    this.removeMany = this._projectionRemoveMany;
    this.removeAll = this._projectionRemoveAll;
    this.children.forEach(function (view) {
      return ShadowDOM.distributeView(view, slots, _this6);
    });
  };

  ViewSlot.prototype._projectionAdd = function _projectionAdd(view) {
    ShadowDOM.distributeView(view, this.projectToSlots, this);

    this.children.push(view);

    if (this.isAttached) {
      view.attached();
    }
  };

  ViewSlot.prototype._projectionInsert = function _projectionInsert(index, view) {
    if (index === 0 && !this.children.length || index >= this.children.length) {
      this.add(view);
    } else {
      ShadowDOM.distributeView(view, this.projectToSlots, this, index);

      this.children.splice(index, 0, view);

      if (this.isAttached) {
        view.attached();
      }
    }
  };

  ViewSlot.prototype._projectionMove = function _projectionMove(sourceIndex, targetIndex) {
    if (sourceIndex === targetIndex) {
      return;
    }

    var children = this.children;
    var view = children[sourceIndex];

    ShadowDOM.undistributeView(view, this.projectToSlots, this);
    ShadowDOM.distributeView(view, this.projectToSlots, this, targetIndex);

    children.splice(sourceIndex, 1);
    children.splice(targetIndex, 0, view);
  };

  ViewSlot.prototype._projectionRemove = function _projectionRemove(view, returnToCache) {
    ShadowDOM.undistributeView(view, this.projectToSlots, this);
    this.children.splice(this.children.indexOf(view), 1);

    if (this.isAttached) {
      view.detached();
    }
    if (returnToCache) {
      view.returnToCache();
    }
  };

  ViewSlot.prototype._projectionRemoveAt = function _projectionRemoveAt(index, returnToCache) {
    var view = this.children[index];

    ShadowDOM.undistributeView(view, this.projectToSlots, this);
    this.children.splice(index, 1);

    if (this.isAttached) {
      view.detached();
    }
    if (returnToCache) {
      view.returnToCache();
    }
  };

  ViewSlot.prototype._projectionRemoveMany = function _projectionRemoveMany(viewsToRemove, returnToCache) {
    var _this7 = this;

    viewsToRemove.forEach(function (view) {
      return _this7.remove(view, returnToCache);
    });
  };

  ViewSlot.prototype._projectionRemoveAll = function _projectionRemoveAll(returnToCache) {
    ShadowDOM.undistributeAll(this.projectToSlots, this);

    var children = this.children;
    var ii = children.length;

    for (var i = 0; i < ii; ++i) {
      if (returnToCache) {
        children[i].returnToCache();
      } else if (this.isAttached) {
        children[i].detached();
      }
    }

    this.children = [];
  };

  return ViewSlot;
}();

var ProviderResolver = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["resolver"])(_class12 = function () {
  function ProviderResolver() {
    
  }

  ProviderResolver.prototype.get = function get(container, key) {
    var id = key.__providerId__;
    return id in container ? container[id] : container[id] = container.invoke(key);
  };

  return ProviderResolver;
}()) || _class12;

var providerResolverInstance = new ProviderResolver();

function elementContainerGet(key) {
  if (key === __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].Element) {
    return this.element;
  }

  if (key === BoundViewFactory) {
    if (this.boundViewFactory) {
      return this.boundViewFactory;
    }

    var factory = this.instruction.viewFactory;
    var _partReplacements = this.partReplacements;

    if (_partReplacements) {
      factory = _partReplacements[factory.part] || factory;
    }

    this.boundViewFactory = new BoundViewFactory(this, factory, _partReplacements);
    return this.boundViewFactory;
  }

  if (key === ViewSlot) {
    if (this.viewSlot === undefined) {
      this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);
      this.element.isContentProjectionSource = this.instruction.lifting;
      this.children.push(this.viewSlot);
    }

    return this.viewSlot;
  }

  if (key === ElementEvents) {
    return this.elementEvents || (this.elementEvents = new ElementEvents(this.element));
  }

  if (key === CompositionTransaction) {
    return this.compositionTransaction || (this.compositionTransaction = this.parent.get(key));
  }

  if (key === ViewResources) {
    return this.viewResources;
  }

  if (key === TargetInstruction) {
    return this.instruction;
  }

  return this.superGet(key);
}

function createElementContainer(parent, element, instruction, children, partReplacements, resources) {
  var container = parent.createChild();
  var providers = void 0;
  var i = void 0;

  container.element = element;
  container.instruction = instruction;
  container.children = children;
  container.viewResources = resources;
  container.partReplacements = partReplacements;

  providers = instruction.providers;
  i = providers.length;

  while (i--) {
    container._resolvers.set(providers[i], providerResolverInstance);
  }

  container.superGet = container.get;
  container.get = elementContainerGet;

  return container;
}

function hasAttribute(name) {
  return this._element.hasAttribute(name);
}

function getAttribute(name) {
  return this._element.getAttribute(name);
}

function setAttribute(name, value) {
  this._element.setAttribute(name, value);
}

function makeElementIntoAnchor(element, elementInstruction) {
  var anchor = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createComment('anchor');

  if (elementInstruction) {
    var firstChild = element.firstChild;

    if (firstChild && firstChild.tagName === 'AU-CONTENT') {
      anchor.contentElement = firstChild;
    }

    anchor._element = element;

    anchor.hasAttribute = hasAttribute;
    anchor.getAttribute = getAttribute;
    anchor.setAttribute = setAttribute;
  }

  __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].replaceNode(anchor, element);

  return anchor;
}

function applyInstructions(containers, element, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources) {
  var behaviorInstructions = instruction.behaviorInstructions;
  var expressions = instruction.expressions;
  var elementContainer = void 0;
  var i = void 0;
  var ii = void 0;
  var current = void 0;
  var instance = void 0;

  if (instruction.contentExpression) {
    bindings.push(instruction.contentExpression.createBinding(element.nextSibling));
    element.nextSibling.auInterpolationTarget = true;
    element.parentNode.removeChild(element);
    return;
  }

  if (instruction.shadowSlot) {
    var commentAnchor = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createComment('slot');
    var slot = void 0;

    if (instruction.slotDestination) {
      slot = new PassThroughSlot(commentAnchor, instruction.slotName, instruction.slotDestination, instruction.slotFallbackFactory);
    } else {
      slot = new ShadowSlot(commentAnchor, instruction.slotName, instruction.slotFallbackFactory);
    }

    __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].replaceNode(commentAnchor, element);
    shadowSlots[instruction.slotName] = slot;
    controllers.push(slot);
    return;
  }

  if (instruction.letElement) {
    for (i = 0, ii = expressions.length; i < ii; ++i) {
      bindings.push(expressions[i].createBinding());
    }
    element.parentNode.removeChild(element);
    return;
  }

  if (behaviorInstructions.length) {
    if (!instruction.anchorIsContainer) {
      element = makeElementIntoAnchor(element, instruction.elementInstruction);
    }

    containers[instruction.injectorId] = elementContainer = createElementContainer(containers[instruction.parentInjectorId], element, instruction, children, partReplacements, resources);

    for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
      current = behaviorInstructions[i];
      instance = current.type.create(elementContainer, current, element, bindings);
      controllers.push(instance);
    }
  }

  for (i = 0, ii = expressions.length; i < ii; ++i) {
    bindings.push(expressions[i].createBinding(element));
  }
}

function styleStringToObject(style, target) {
  var attributes = style.split(';');
  var firstIndexOfColon = void 0;
  var i = void 0;
  var current = void 0;
  var key = void 0;
  var value = void 0;

  target = target || {};

  for (i = 0; i < attributes.length; i++) {
    current = attributes[i];
    firstIndexOfColon = current.indexOf(':');
    key = current.substring(0, firstIndexOfColon).trim();
    value = current.substring(firstIndexOfColon + 1).trim();
    target[key] = value;
  }

  return target;
}

function styleObjectToString(obj) {
  var result = '';

  for (var _key4 in obj) {
    result += _key4 + ':' + obj[_key4] + ';';
  }

  return result;
}

function applySurrogateInstruction(container, element, instruction, controllers, bindings, children) {
  var behaviorInstructions = instruction.behaviorInstructions;
  var expressions = instruction.expressions;
  var providers = instruction.providers;
  var values = instruction.values;
  var i = void 0;
  var ii = void 0;
  var current = void 0;
  var instance = void 0;
  var currentAttributeValue = void 0;

  i = providers.length;
  while (i--) {
    container._resolvers.set(providers[i], providerResolverInstance);
  }

  for (var _key5 in values) {
    currentAttributeValue = element.getAttribute(_key5);

    if (currentAttributeValue) {
      if (_key5 === 'class') {
        element.setAttribute('class', currentAttributeValue + ' ' + values[_key5]);
      } else if (_key5 === 'style') {
        var styleObject = styleStringToObject(values[_key5]);
        styleStringToObject(currentAttributeValue, styleObject);
        element.setAttribute('style', styleObjectToString(styleObject));
      }
    } else {
      element.setAttribute(_key5, values[_key5]);
    }
  }

  if (behaviorInstructions.length) {
    for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
      current = behaviorInstructions[i];
      instance = current.type.create(container, current, element, bindings);

      if (instance.contentView) {
        children.push(instance.contentView);
      }

      controllers.push(instance);
    }
  }

  for (i = 0, ii = expressions.length; i < ii; ++i) {
    bindings.push(expressions[i].createBinding(element));
  }
}

var BoundViewFactory = function () {
  function BoundViewFactory(parentContainer, viewFactory, partReplacements) {
    

    this.parentContainer = parentContainer;
    this.viewFactory = viewFactory;
    this.factoryCreateInstruction = { partReplacements: partReplacements };
  }

  BoundViewFactory.prototype.create = function create() {
    var view = this.viewFactory.create(this.parentContainer.createChild(), this.factoryCreateInstruction);
    view._isUserControlled = true;
    return view;
  };

  BoundViewFactory.prototype.setCacheSize = function setCacheSize(size, doNotOverrideIfAlreadySet) {
    this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);
  };

  BoundViewFactory.prototype.getCachedView = function getCachedView() {
    return this.viewFactory.getCachedView();
  };

  BoundViewFactory.prototype.returnViewToCache = function returnViewToCache(view) {
    this.viewFactory.returnViewToCache(view);
  };

  _createClass(BoundViewFactory, [{
    key: 'isCaching',
    get: function get() {
      return this.viewFactory.isCaching;
    }
  }]);

  return BoundViewFactory;
}();

var ViewFactory = function () {
  function ViewFactory(template, instructions, resources) {
    

    this.isCaching = false;

    this.template = template;
    this.instructions = instructions;
    this.resources = resources;
    this.cacheSize = -1;
    this.cache = null;
  }

  ViewFactory.prototype.setCacheSize = function setCacheSize(size, doNotOverrideIfAlreadySet) {
    if (size) {
      if (size === '*') {
        size = Number.MAX_VALUE;
      } else if (typeof size === 'string') {
        size = parseInt(size, 10);
      }
    }

    if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {
      this.cacheSize = size;
    }

    if (this.cacheSize > 0) {
      this.cache = [];
    } else {
      this.cache = null;
    }

    this.isCaching = this.cacheSize > 0;
  };

  ViewFactory.prototype.getCachedView = function getCachedView() {
    return this.cache !== null ? this.cache.pop() || null : null;
  };

  ViewFactory.prototype.returnViewToCache = function returnViewToCache(view) {
    if (view.isAttached) {
      view.detached();
    }

    if (view.isBound) {
      view.unbind();
    }

    if (this.cache !== null && this.cache.length < this.cacheSize) {
      view.fromCache = true;
      this.cache.push(view);
    }
  };

  ViewFactory.prototype.create = function create(container, createInstruction, element) {
    createInstruction = createInstruction || BehaviorInstruction.normal;

    var cachedView = this.getCachedView();
    if (cachedView !== null) {
      return cachedView;
    }

    var fragment = createInstruction.enhance ? this.template : this.template.cloneNode(true);
    var instructables = fragment.querySelectorAll('.au-target');
    var instructions = this.instructions;
    var resources = this.resources;
    var controllers = [];
    var bindings = [];
    var children = [];
    var shadowSlots = Object.create(null);
    var containers = { root: container };
    var partReplacements = createInstruction.partReplacements;
    var i = void 0;
    var ii = void 0;
    var view = void 0;
    var instructable = void 0;
    var instruction = void 0;

    this.resources._invokeHook('beforeCreate', this, container, fragment, createInstruction);

    if (element && this.surrogateInstruction !== null) {
      applySurrogateInstruction(container, element, this.surrogateInstruction, controllers, bindings, children);
    }

    if (createInstruction.enhance && fragment.hasAttribute('au-target-id')) {
      instructable = fragment;
      instruction = instructions[instructable.getAttribute('au-target-id')];
      applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);
    }

    for (i = 0, ii = instructables.length; i < ii; ++i) {
      instructable = instructables[i];
      instruction = instructions[instructable.getAttribute('au-target-id')];
      applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);
    }

    view = new View(container, this, fragment, controllers, bindings, children, shadowSlots);

    if (!createInstruction.initiatedByBehavior) {
      view.created();
    }

    this.resources._invokeHook('afterCreate', view);

    return view;
  };

  return ViewFactory;
}();

var nextInjectorId = 0;
function getNextInjectorId() {
  return ++nextInjectorId;
}

var lastAUTargetID = 0;
function getNextAUTargetID() {
  return (++lastAUTargetID).toString();
}

function makeIntoInstructionTarget(element) {
  var value = element.getAttribute('class');
  var auTargetID = getNextAUTargetID();

  element.setAttribute('class', value ? value + ' au-target' : 'au-target');
  element.setAttribute('au-target-id', auTargetID);

  return auTargetID;
}

function makeShadowSlot(compiler, resources, node, instructions, parentInjectorId) {
  var auShadowSlot = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createElement('au-shadow-slot');
  __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].replaceNode(auShadowSlot, node);

  var auTargetID = makeIntoInstructionTarget(auShadowSlot);
  var instruction = TargetInstruction.shadowSlot(parentInjectorId);

  instruction.slotName = node.getAttribute('name') || ShadowDOM.defaultSlotKey;
  instruction.slotDestination = node.getAttribute('slot');

  if (node.innerHTML.trim()) {
    var fragment = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createDocumentFragment();
    var _child4 = void 0;

    while (_child4 = node.firstChild) {
      fragment.appendChild(_child4);
    }

    instruction.slotFallbackFactory = compiler.compile(fragment, resources);
  }

  instructions[auTargetID] = instruction;

  return auShadowSlot;
}

var defaultLetHandler = BindingLanguage.prototype.createLetExpressions;

var ViewCompiler = function () {
  ViewCompiler.inject = function inject() {
    return [BindingLanguage, ViewResources];
  };

  function ViewCompiler(bindingLanguage, resources) {
    

    this.bindingLanguage = bindingLanguage;
    this.resources = resources;
  }

  ViewCompiler.prototype.compile = function compile(source, resources, compileInstruction) {
    resources = resources || this.resources;
    compileInstruction = compileInstruction || ViewCompileInstruction.normal;
    source = typeof source === 'string' ? __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createTemplateFromMarkup(source) : source;

    var content = void 0;
    var part = void 0;
    var cacheSize = void 0;

    if (source.content) {
      part = source.getAttribute('part');
      cacheSize = source.getAttribute('view-cache');
      content = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].adoptNode(source.content);
    } else {
      content = source;
    }

    compileInstruction.targetShadowDOM = compileInstruction.targetShadowDOM && __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["FEATURE"].shadowDOM;
    resources._invokeHook('beforeCompile', content, resources, compileInstruction);

    var instructions = {};
    this._compileNode(content, resources, instructions, source, 'root', !compileInstruction.targetShadowDOM);

    var firstChild = content.firstChild;
    if (firstChild && firstChild.nodeType === 1) {
      var targetId = firstChild.getAttribute('au-target-id');
      if (targetId) {
        var ins = instructions[targetId];

        if (ins.shadowSlot || ins.lifting || ins.elementInstruction && !ins.elementInstruction.anchorIsContainer) {
          content.insertBefore(__WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createComment('view'), firstChild);
        }
      }
    }

    var factory = new ViewFactory(content, instructions, resources);

    factory.surrogateInstruction = compileInstruction.compileSurrogate ? this._compileSurrogate(source, resources) : null;
    factory.part = part;

    if (cacheSize) {
      factory.setCacheSize(cacheSize);
    }

    resources._invokeHook('afterCompile', factory);

    return factory;
  };

  ViewCompiler.prototype._compileNode = function _compileNode(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {
    switch (node.nodeType) {
      case 1:
        return this._compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM);
      case 3:
        var expression = resources.getBindingLanguage(this.bindingLanguage).inspectTextContent(resources, node.wholeText);
        if (expression) {
          var marker = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createElement('au-marker');
          var auTargetID = makeIntoInstructionTarget(marker);
          (node.parentNode || parentNode).insertBefore(marker, node);
          node.textContent = ' ';
          instructions[auTargetID] = TargetInstruction.contentExpression(expression);

          while (node.nextSibling && node.nextSibling.nodeType === 3) {
            (node.parentNode || parentNode).removeChild(node.nextSibling);
          }
        } else {
          while (node.nextSibling && node.nextSibling.nodeType === 3) {
            node = node.nextSibling;
          }
        }
        return node.nextSibling;
      case 11:
        var currentChild = node.firstChild;
        while (currentChild) {
          currentChild = this._compileNode(currentChild, resources, instructions, node, parentInjectorId, targetLightDOM);
        }
        break;
      default:
        break;
    }

    return node.nextSibling;
  };

  ViewCompiler.prototype._compileSurrogate = function _compileSurrogate(node, resources) {
    var tagName = node.tagName.toLowerCase();
    var attributes = node.attributes;
    var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);
    var knownAttribute = void 0;
    var property = void 0;
    var instruction = void 0;
    var i = void 0;
    var ii = void 0;
    var attr = void 0;
    var attrName = void 0;
    var attrValue = void 0;
    var info = void 0;
    var type = void 0;
    var expressions = [];
    var expression = void 0;
    var behaviorInstructions = [];
    var values = {};
    var hasValues = false;
    var providers = [];

    for (i = 0, ii = attributes.length; i < ii; ++i) {
      attr = attributes[i];
      attrName = attr.name;
      attrValue = attr.value;

      info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);
      type = resources.getAttribute(info.attrName);

      if (type) {
        knownAttribute = resources.mapAttribute(info.attrName);
        if (knownAttribute) {
          property = type.attributes[knownAttribute];

          if (property) {
            info.defaultBindingMode = property.defaultBindingMode;

            if (!info.command && !info.expression) {
              info.command = property.hasOptions ? 'options' : null;
            }

            if (info.command && info.command !== 'options' && type.primaryProperty) {
              var _primaryProperty = type.primaryProperty;
              attrName = info.attrName = _primaryProperty.attribute;

              info.defaultBindingMode = _primaryProperty.defaultBindingMode;
            }
          }
        }
      }

      instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);

      if (instruction) {
        if (instruction.alteredAttr) {
          type = resources.getAttribute(instruction.attrName);
        }

        if (instruction.discrete) {
          expressions.push(instruction);
        } else {
          if (type) {
            instruction.type = type;
            this._configureProperties(instruction, resources);

            if (type.liftsContent) {
              throw new Error('You cannot place a template controller on a surrogate element.');
            } else {
              behaviorInstructions.push(instruction);
            }
          } else {
            expressions.push(instruction.attributes[instruction.attrName]);
          }
        }
      } else {
        if (type) {
          instruction = BehaviorInstruction.attribute(attrName, type);
          instruction.attributes[resources.mapAttribute(attrName)] = attrValue;

          if (type.liftsContent) {
            throw new Error('You cannot place a template controller on a surrogate element.');
          } else {
            behaviorInstructions.push(instruction);
          }
        } else if (attrName !== 'id' && attrName !== 'part' && attrName !== 'replace-part') {
          hasValues = true;
          values[attrName] = attrValue;
        }
      }
    }

    if (expressions.length || behaviorInstructions.length || hasValues) {
      for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
        instruction = behaviorInstructions[i];
        instruction.type.compile(this, resources, node, instruction);
        providers.push(instruction.type.target);
      }

      for (i = 0, ii = expressions.length; i < ii; ++i) {
        expression = expressions[i];
        if (expression.attrToRemove !== undefined) {
          node.removeAttribute(expression.attrToRemove);
        }
      }

      return TargetInstruction.surrogate(providers, behaviorInstructions, expressions, values);
    }

    return null;
  };

  ViewCompiler.prototype._compileElement = function _compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {
    var tagName = node.tagName.toLowerCase();
    var attributes = node.attributes;
    var expressions = [];
    var expression = void 0;
    var behaviorInstructions = [];
    var providers = [];
    var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);
    var liftingInstruction = void 0;
    var viewFactory = void 0;
    var type = void 0;
    var elementInstruction = void 0;
    var elementProperty = void 0;
    var i = void 0;
    var ii = void 0;
    var attr = void 0;
    var attrName = void 0;
    var attrValue = void 0;
    var originalAttrName = void 0;
    var instruction = void 0;
    var info = void 0;
    var property = void 0;
    var knownAttribute = void 0;
    var auTargetID = void 0;
    var injectorId = void 0;

    if (tagName === 'slot') {
      if (targetLightDOM) {
        node = makeShadowSlot(this, resources, node, instructions, parentInjectorId);
      }
      return node.nextSibling;
    } else if (tagName === 'template') {
      if (!('content' in node)) {
        throw new Error('You cannot place a template element within ' + node.namespaceURI + ' namespace');
      }
      viewFactory = this.compile(node, resources);
      viewFactory.part = node.getAttribute('part');
    } else {
      type = resources.getElement(node.getAttribute('as-element') || tagName);

      if (tagName === 'let' && !type && bindingLanguage.createLetExpressions !== defaultLetHandler) {
        expressions = bindingLanguage.createLetExpressions(resources, node);
        auTargetID = makeIntoInstructionTarget(node);
        instructions[auTargetID] = TargetInstruction.letElement(expressions);
        return node.nextSibling;
      }
      if (type) {
        elementInstruction = BehaviorInstruction.element(node, type);
        type.processAttributes(this, resources, node, attributes, elementInstruction);
        behaviorInstructions.push(elementInstruction);
      }
    }

    for (i = 0, ii = attributes.length; i < ii; ++i) {
      attr = attributes[i];
      originalAttrName = attrName = attr.name;
      attrValue = attr.value;
      info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);

      if (targetLightDOM && info.attrName === 'slot') {
        info.attrName = attrName = 'au-slot';
      }

      type = resources.getAttribute(info.attrName);
      elementProperty = null;

      if (type) {
        knownAttribute = resources.mapAttribute(info.attrName);
        if (knownAttribute) {
          property = type.attributes[knownAttribute];

          if (property) {
            info.defaultBindingMode = property.defaultBindingMode;

            if (!info.command && !info.expression) {
              info.command = property.hasOptions ? 'options' : null;
            }

            if (info.command && info.command !== 'options' && type.primaryProperty) {
              var _primaryProperty2 = type.primaryProperty;
              attrName = info.attrName = _primaryProperty2.attribute;

              info.defaultBindingMode = _primaryProperty2.defaultBindingMode;
            }
          }
        }
      } else if (elementInstruction) {
        elementProperty = elementInstruction.type.attributes[info.attrName];
        if (elementProperty) {
          info.defaultBindingMode = elementProperty.defaultBindingMode;
        }
      }

      if (elementProperty) {
        instruction = bindingLanguage.createAttributeInstruction(resources, node, info, elementInstruction);
      } else {
        instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);
      }

      if (instruction) {
        if (instruction.alteredAttr) {
          type = resources.getAttribute(instruction.attrName);
        }

        if (instruction.discrete) {
          expressions.push(instruction);
        } else {
          if (type) {
            instruction.type = type;
            this._configureProperties(instruction, resources);

            if (type.liftsContent) {
              instruction.originalAttrName = originalAttrName;
              liftingInstruction = instruction;
              break;
            } else {
              behaviorInstructions.push(instruction);
            }
          } else if (elementProperty) {
            elementInstruction.attributes[info.attrName].targetProperty = elementProperty.name;
          } else {
            expressions.push(instruction.attributes[instruction.attrName]);
          }
        }
      } else {
        if (type) {
          instruction = BehaviorInstruction.attribute(attrName, type);
          instruction.attributes[resources.mapAttribute(attrName)] = attrValue;

          if (type.liftsContent) {
            instruction.originalAttrName = originalAttrName;
            liftingInstruction = instruction;
            break;
          } else {
            behaviorInstructions.push(instruction);
          }
        } else if (elementProperty) {
          elementInstruction.attributes[attrName] = attrValue;
        }
      }
    }

    if (liftingInstruction) {
      liftingInstruction.viewFactory = viewFactory;
      node = liftingInstruction.type.compile(this, resources, node, liftingInstruction, parentNode);
      auTargetID = makeIntoInstructionTarget(node);
      instructions[auTargetID] = TargetInstruction.lifting(parentInjectorId, liftingInstruction);
    } else {
      var skipContentProcessing = false;

      if (expressions.length || behaviorInstructions.length) {
        injectorId = behaviorInstructions.length ? getNextInjectorId() : false;

        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
          instruction = behaviorInstructions[i];
          instruction.type.compile(this, resources, node, instruction, parentNode);
          providers.push(instruction.type.target);
          skipContentProcessing = skipContentProcessing || instruction.skipContentProcessing;
        }

        for (i = 0, ii = expressions.length; i < ii; ++i) {
          expression = expressions[i];
          if (expression.attrToRemove !== undefined) {
            node.removeAttribute(expression.attrToRemove);
          }
        }

        auTargetID = makeIntoInstructionTarget(node);
        instructions[auTargetID] = TargetInstruction.normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction);
      }

      if (skipContentProcessing) {
        return node.nextSibling;
      }

      var currentChild = node.firstChild;
      while (currentChild) {
        currentChild = this._compileNode(currentChild, resources, instructions, node, injectorId || parentInjectorId, targetLightDOM);
      }
    }

    return node.nextSibling;
  };

  ViewCompiler.prototype._configureProperties = function _configureProperties(instruction, resources) {
    var type = instruction.type;
    var attrName = instruction.attrName;
    var attributes = instruction.attributes;
    var property = void 0;
    var key = void 0;
    var value = void 0;

    var knownAttribute = resources.mapAttribute(attrName);
    if (knownAttribute && attrName in attributes && knownAttribute !== attrName) {
      attributes[knownAttribute] = attributes[attrName];
      delete attributes[attrName];
    }

    for (key in attributes) {
      value = attributes[key];

      if (value !== null && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {
        property = type.attributes[key];

        if (property !== undefined) {
          value.targetProperty = property.name;
        } else {
          value.targetProperty = key;
        }
      }
    }
  };

  return ViewCompiler;
}();

var ResourceModule = function () {
  function ResourceModule(moduleId) {
    

    this.id = moduleId;
    this.moduleInstance = null;
    this.mainResource = null;
    this.resources = null;
    this.viewStrategy = null;
    this.isInitialized = false;
    this.onLoaded = null;
    this.loadContext = null;
  }

  ResourceModule.prototype.initialize = function initialize(container) {
    var current = this.mainResource;
    var resources = this.resources;
    var vs = this.viewStrategy;

    if (this.isInitialized) {
      return;
    }

    this.isInitialized = true;

    if (current !== undefined) {
      current.metadata.viewStrategy = vs;
      current.initialize(container);
    }

    for (var i = 0, ii = resources.length; i < ii; ++i) {
      current = resources[i];
      current.metadata.viewStrategy = vs;
      current.initialize(container);
    }
  };

  ResourceModule.prototype.register = function register(registry, name) {
    var main = this.mainResource;
    var resources = this.resources;

    if (main !== undefined) {
      main.register(registry, name);
      name = null;
    }

    for (var i = 0, ii = resources.length; i < ii; ++i) {
      resources[i].register(registry, name);
      name = null;
    }
  };

  ResourceModule.prototype.load = function load(container, loadContext) {
    if (this.onLoaded !== null) {
      return this.loadContext === loadContext ? Promise.resolve() : this.onLoaded;
    }

    var main = this.mainResource;
    var resources = this.resources;
    var loads = void 0;

    if (main !== undefined) {
      loads = new Array(resources.length + 1);
      loads[0] = main.load(container, loadContext);
      for (var i = 0, ii = resources.length; i < ii; ++i) {
        loads[i + 1] = resources[i].load(container, loadContext);
      }
    } else {
      loads = new Array(resources.length);
      for (var _i2 = 0, _ii = resources.length; _i2 < _ii; ++_i2) {
        loads[_i2] = resources[_i2].load(container, loadContext);
      }
    }

    this.loadContext = loadContext;
    this.onLoaded = Promise.all(loads);
    return this.onLoaded;
  };

  return ResourceModule;
}();

var ResourceDescription = function () {
  function ResourceDescription(key, exportedValue, resourceTypeMeta) {
    

    if (!resourceTypeMeta) {
      resourceTypeMeta = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, exportedValue);

      if (!resourceTypeMeta) {
        resourceTypeMeta = new HtmlBehaviorResource();
        resourceTypeMeta.elementName = _hyphenate(key);
        __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, resourceTypeMeta, exportedValue);
      }
    }

    if (resourceTypeMeta instanceof HtmlBehaviorResource) {
      if (resourceTypeMeta.elementName === undefined) {
        resourceTypeMeta.elementName = _hyphenate(key);
      } else if (resourceTypeMeta.attributeName === undefined) {
        resourceTypeMeta.attributeName = _hyphenate(key);
      } else if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
        HtmlBehaviorResource.convention(key, resourceTypeMeta);
      }
    } else if (!resourceTypeMeta.name) {
      resourceTypeMeta.name = _hyphenate(key);
    }

    this.metadata = resourceTypeMeta;
    this.value = exportedValue;
  }

  ResourceDescription.prototype.initialize = function initialize(container) {
    this.metadata.initialize(container, this.value);
  };

  ResourceDescription.prototype.register = function register(registry, name) {
    this.metadata.register(registry, name);
  };

  ResourceDescription.prototype.load = function load(container, loadContext) {
    return this.metadata.load(container, this.value, loadContext);
  };

  return ResourceDescription;
}();

var ModuleAnalyzer = function () {
  function ModuleAnalyzer() {
    

    this.cache = Object.create(null);
  }

  ModuleAnalyzer.prototype.getAnalysis = function getAnalysis(moduleId) {
    return this.cache[moduleId];
  };

  ModuleAnalyzer.prototype.analyze = function analyze(moduleId, moduleInstance, mainResourceKey) {
    var mainResource = void 0;
    var fallbackValue = void 0;
    var fallbackKey = void 0;
    var resourceTypeMeta = void 0;
    var key = void 0;
    var exportedValue = void 0;
    var resources = [];
    var conventional = void 0;
    var vs = void 0;
    var resourceModule = void 0;

    resourceModule = this.cache[moduleId];
    if (resourceModule) {
      return resourceModule;
    }

    resourceModule = new ResourceModule(moduleId);
    this.cache[moduleId] = resourceModule;

    if (typeof moduleInstance === 'function') {
      moduleInstance = { 'default': moduleInstance };
    }

    if (mainResourceKey) {
      mainResource = new ResourceDescription(mainResourceKey, moduleInstance[mainResourceKey]);
    }

    for (key in moduleInstance) {
      exportedValue = moduleInstance[key];

      if (key === mainResourceKey || typeof exportedValue !== 'function') {
        continue;
      }

      resourceTypeMeta = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, exportedValue);

      if (resourceTypeMeta) {
        if (resourceTypeMeta instanceof HtmlBehaviorResource) {
          ViewResources.convention(exportedValue, resourceTypeMeta);

          if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
            HtmlBehaviorResource.convention(key, resourceTypeMeta);
          }

          if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
            resourceTypeMeta.elementName = _hyphenate(key);
          }
        }

        if (!mainResource && resourceTypeMeta instanceof HtmlBehaviorResource && resourceTypeMeta.elementName !== null) {
          mainResource = new ResourceDescription(key, exportedValue, resourceTypeMeta);
        } else {
          resources.push(new ResourceDescription(key, exportedValue, resourceTypeMeta));
        }
      } else if (viewStrategy.decorates(exportedValue)) {
        vs = exportedValue;
      } else if (exportedValue instanceof __WEBPACK_IMPORTED_MODULE_3_aurelia_loader__["TemplateRegistryEntry"]) {
        vs = new TemplateRegistryViewStrategy(moduleId, exportedValue);
      } else {
        if (conventional = ViewResources.convention(exportedValue)) {
          if (conventional.elementName !== null && !mainResource) {
            mainResource = new ResourceDescription(key, exportedValue, conventional);
          } else {
            resources.push(new ResourceDescription(key, exportedValue, conventional));
          }
          __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, conventional, exportedValue);
        } else if (conventional = HtmlBehaviorResource.convention(key)) {
          if (conventional.elementName !== null && !mainResource) {
            mainResource = new ResourceDescription(key, exportedValue, conventional);
          } else {
            resources.push(new ResourceDescription(key, exportedValue, conventional));
          }

          __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, conventional, exportedValue);
        } else if (conventional = __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ValueConverterResource"].convention(key) || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["BindingBehaviorResource"].convention(key) || ViewEngineHooksResource.convention(key)) {
          resources.push(new ResourceDescription(key, exportedValue, conventional));
          __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, conventional, exportedValue);
        } else if (!fallbackValue) {
          fallbackValue = exportedValue;
          fallbackKey = key;
        }
      }
    }

    if (!mainResource && fallbackValue) {
      mainResource = new ResourceDescription(fallbackKey, fallbackValue);
    }

    resourceModule.moduleInstance = moduleInstance;
    resourceModule.mainResource = mainResource;
    resourceModule.resources = resources;
    resourceModule.viewStrategy = vs;

    return resourceModule;
  };

  return ModuleAnalyzer;
}();

var logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating');

function ensureRegistryEntry(loader, urlOrRegistryEntry) {
  if (urlOrRegistryEntry instanceof __WEBPACK_IMPORTED_MODULE_3_aurelia_loader__["TemplateRegistryEntry"]) {
    return Promise.resolve(urlOrRegistryEntry);
  }

  return loader.loadTemplate(urlOrRegistryEntry);
}

var ProxyViewFactory = function () {
  function ProxyViewFactory(promise) {
    var _this8 = this;

    

    promise.then(function (x) {
      return _this8.viewFactory = x;
    });
  }

  ProxyViewFactory.prototype.create = function create(container, bindingContext, createInstruction, element) {
    return this.viewFactory.create(container, bindingContext, createInstruction, element);
  };

  ProxyViewFactory.prototype.setCacheSize = function setCacheSize(size, doNotOverrideIfAlreadySet) {
    this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);
  };

  ProxyViewFactory.prototype.getCachedView = function getCachedView() {
    return this.viewFactory.getCachedView();
  };

  ProxyViewFactory.prototype.returnViewToCache = function returnViewToCache(view) {
    this.viewFactory.returnViewToCache(view);
  };

  _createClass(ProxyViewFactory, [{
    key: 'isCaching',
    get: function get() {
      return this.viewFactory.isCaching;
    }
  }]);

  return ProxyViewFactory;
}();

var auSlotBehavior = null;

var ViewEngine = (_temp5 = _class14 = function () {
  ViewEngine.inject = function inject() {
    return [__WEBPACK_IMPORTED_MODULE_3_aurelia_loader__["Loader"], __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"], ViewCompiler, ModuleAnalyzer, ViewResources];
  };

  function ViewEngine(loader, container, viewCompiler, moduleAnalyzer, appResources) {
    

    this.loader = loader;
    this.container = container;
    this.viewCompiler = viewCompiler;
    this.moduleAnalyzer = moduleAnalyzer;
    this.appResources = appResources;
    this._pluginMap = {};

    if (auSlotBehavior === null) {
      auSlotBehavior = new HtmlBehaviorResource();
      auSlotBehavior.attributeName = 'au-slot';
      __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, auSlotBehavior, SlotCustomAttribute);
    }

    auSlotBehavior.initialize(container, SlotCustomAttribute);
    auSlotBehavior.register(appResources);
  }

  ViewEngine.prototype.addResourcePlugin = function addResourcePlugin(extension, implementation) {
    var name = extension.replace('.', '') + '-resource-plugin';
    this._pluginMap[extension] = name;
    this.loader.addPlugin(name, implementation);
  };

  ViewEngine.prototype.loadViewFactory = function loadViewFactory(urlOrRegistryEntry, compileInstruction, loadContext, target) {
    var _this9 = this;

    loadContext = loadContext || new ResourceLoadContext();

    return ensureRegistryEntry(this.loader, urlOrRegistryEntry).then(function (registryEntry) {
      var url = registryEntry.address;

      if (registryEntry.onReady) {
        if (!loadContext.hasDependency(url)) {
          loadContext.addDependency(url);
          return registryEntry.onReady;
        }

        if (registryEntry.template === null) {
          return registryEntry.onReady;
        }

        return Promise.resolve(new ProxyViewFactory(registryEntry.onReady));
      }

      loadContext.addDependency(url);

      registryEntry.onReady = _this9.loadTemplateResources(registryEntry, compileInstruction, loadContext, target).then(function (resources) {
        registryEntry.resources = resources;

        if (registryEntry.template === null) {
          return registryEntry.factory = null;
        }

        var viewFactory = _this9.viewCompiler.compile(registryEntry.template, resources, compileInstruction);
        return registryEntry.factory = viewFactory;
      });

      return registryEntry.onReady;
    });
  };

  ViewEngine.prototype.loadTemplateResources = function loadTemplateResources(registryEntry, compileInstruction, loadContext, target) {
    var resources = new ViewResources(this.appResources, registryEntry.address);
    var dependencies = registryEntry.dependencies;
    var importIds = void 0;
    var names = void 0;

    compileInstruction = compileInstruction || ViewCompileInstruction.normal;

    if (dependencies.length === 0 && !compileInstruction.associatedModuleId) {
      return Promise.resolve(resources);
    }

    importIds = dependencies.map(function (x) {
      return x.src;
    });
    names = dependencies.map(function (x) {
      return x.name;
    });
    logger.debug('importing resources for ' + registryEntry.address, importIds);

    if (target) {
      var viewModelRequires = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].get(ViewEngine.viewModelRequireMetadataKey, target);
      if (viewModelRequires) {
        var templateImportCount = importIds.length;
        for (var i = 0, ii = viewModelRequires.length; i < ii; ++i) {
          var req = viewModelRequires[i];
          var importId = typeof req === 'function' ? __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(req).moduleId : __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_path__["relativeToFile"])(req.src || req, registryEntry.address);

          if (importIds.indexOf(importId) === -1) {
            importIds.push(importId);
            names.push(req.as);
          }
        }
        logger.debug('importing ViewModel resources for ' + compileInstruction.associatedModuleId, importIds.slice(templateImportCount));
      }
    }

    return this.importViewResources(importIds, names, resources, compileInstruction, loadContext);
  };

  ViewEngine.prototype.importViewModelResource = function importViewModelResource(moduleImport, moduleMember) {
    var _this10 = this;

    return this.loader.loadModule(moduleImport).then(function (viewModelModule) {
      var normalizedId = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(viewModelModule).moduleId;
      var resourceModule = _this10.moduleAnalyzer.analyze(normalizedId, viewModelModule, moduleMember);

      if (!resourceModule.mainResource) {
        throw new Error('No view model found in module "' + moduleImport + '".');
      }

      resourceModule.initialize(_this10.container);

      return resourceModule.mainResource;
    });
  };

  ViewEngine.prototype.importViewResources = function importViewResources(moduleIds, names, resources, compileInstruction, loadContext) {
    var _this11 = this;

    loadContext = loadContext || new ResourceLoadContext();
    compileInstruction = compileInstruction || ViewCompileInstruction.normal;

    moduleIds = moduleIds.map(function (x) {
      return _this11._applyLoaderPlugin(x);
    });

    return this.loader.loadAllModules(moduleIds).then(function (imports) {
      var i = void 0;
      var ii = void 0;
      var analysis = void 0;
      var normalizedId = void 0;
      var current = void 0;
      var associatedModule = void 0;
      var container = _this11.container;
      var moduleAnalyzer = _this11.moduleAnalyzer;
      var allAnalysis = new Array(imports.length);

      for (i = 0, ii = imports.length; i < ii; ++i) {
        current = imports[i];
        normalizedId = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(current).moduleId;

        analysis = moduleAnalyzer.analyze(normalizedId, current);
        analysis.initialize(container);
        analysis.register(resources, names[i]);

        allAnalysis[i] = analysis;
      }

      if (compileInstruction.associatedModuleId) {
        associatedModule = moduleAnalyzer.getAnalysis(compileInstruction.associatedModuleId);

        if (associatedModule) {
          associatedModule.register(resources);
        }
      }

      for (i = 0, ii = allAnalysis.length; i < ii; ++i) {
        allAnalysis[i] = allAnalysis[i].load(container, loadContext);
      }

      return Promise.all(allAnalysis).then(function () {
        return resources;
      });
    });
  };

  ViewEngine.prototype._applyLoaderPlugin = function _applyLoaderPlugin(id) {
    var index = id.lastIndexOf('.');
    if (index !== -1) {
      var ext = id.substring(index);
      var pluginName = this._pluginMap[ext];

      if (pluginName === undefined) {
        return id;
      }

      return this.loader.applyPluginToUrl(id, pluginName);
    }

    return id;
  };

  return ViewEngine;
}(), _class14.viewModelRequireMetadataKey = 'aurelia:view-model-require', _temp5);

var Controller = function () {
  function Controller(behavior, instruction, viewModel, container) {
    

    this.behavior = behavior;
    this.instruction = instruction;
    this.viewModel = viewModel;
    this.isAttached = false;
    this.view = null;
    this.isBound = false;
    this.scope = null;
    this.container = container;
    this.elementEvents = container.elementEvents || null;

    var observerLookup = behavior.observerLocator.getOrCreateObserversLookup(viewModel);
    var handlesBind = behavior.handlesBind;
    var attributes = instruction.attributes;
    var boundProperties = this.boundProperties = [];
    var properties = behavior.properties;
    var i = void 0;
    var ii = void 0;

    behavior._ensurePropertiesDefined(viewModel, observerLookup);

    for (i = 0, ii = properties.length; i < ii; ++i) {
      properties[i]._initialize(viewModel, observerLookup, attributes, handlesBind, boundProperties);
    }
  }

  Controller.prototype.created = function created(owningView) {
    if (this.behavior.handlesCreated) {
      this.viewModel.created(owningView, this.view);
    }
  };

  Controller.prototype.automate = function automate(overrideContext, owningView) {
    this.view.bindingContext = this.viewModel;
    this.view.overrideContext = overrideContext || __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(this.viewModel);
    this.view._isUserControlled = true;

    if (this.behavior.handlesCreated) {
      this.viewModel.created(owningView || null, this.view);
    }

    this.bind(this.view);
  };

  Controller.prototype.bind = function bind(scope) {
    var skipSelfSubscriber = this.behavior.handlesBind;
    var boundProperties = this.boundProperties;
    var i = void 0;
    var ii = void 0;
    var x = void 0;
    var observer = void 0;
    var selfSubscriber = void 0;

    if (this.isBound) {
      if (this.scope === scope) {
        return;
      }

      this.unbind();
    }

    this.isBound = true;
    this.scope = scope;

    for (i = 0, ii = boundProperties.length; i < ii; ++i) {
      x = boundProperties[i];
      observer = x.observer;
      selfSubscriber = observer.selfSubscriber;
      observer.publishing = false;

      if (skipSelfSubscriber) {
        observer.selfSubscriber = null;
      }

      x.binding.bind(scope);
      observer.call();

      observer.publishing = true;
      observer.selfSubscriber = selfSubscriber;
    }

    var overrideContext = void 0;
    if (this.view !== null) {
      if (skipSelfSubscriber) {
        this.view.viewModelScope = scope;
      }

      if (this.viewModel === scope.overrideContext.bindingContext) {
        overrideContext = scope.overrideContext;
      } else if (this.instruction.inheritBindingContext) {
        overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(this.viewModel, scope.overrideContext);
      } else {
        overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(this.viewModel);
        overrideContext.__parentOverrideContext = scope.overrideContext;
      }

      this.view.bind(this.viewModel, overrideContext);
    } else if (skipSelfSubscriber) {
      overrideContext = scope.overrideContext;

      if (scope.overrideContext.__parentOverrideContext !== undefined && this.viewModel.viewFactory && this.viewModel.viewFactory.factoryCreateInstruction.partReplacements) {
        overrideContext = Object.assign({}, scope.overrideContext);
        overrideContext.parentOverrideContext = scope.overrideContext.__parentOverrideContext;
      }
      this.viewModel.bind(scope.bindingContext, overrideContext);
    }
  };

  Controller.prototype.unbind = function unbind() {
    if (this.isBound) {
      var _boundProperties = this.boundProperties;
      var _i3 = void 0;
      var _ii2 = void 0;

      this.isBound = false;
      this.scope = null;

      if (this.view !== null) {
        this.view.unbind();
      }

      if (this.behavior.handlesUnbind) {
        this.viewModel.unbind();
      }

      if (this.elementEvents !== null) {
        this.elementEvents.disposeAll();
      }

      for (_i3 = 0, _ii2 = _boundProperties.length; _i3 < _ii2; ++_i3) {
        _boundProperties[_i3].binding.unbind();
      }
    }
  };

  Controller.prototype.attached = function attached() {
    if (this.isAttached) {
      return;
    }

    this.isAttached = true;

    if (this.behavior.handlesAttached) {
      this.viewModel.attached();
    }

    if (this.view !== null) {
      this.view.attached();
    }
  };

  Controller.prototype.detached = function detached() {
    if (this.isAttached) {
      this.isAttached = false;

      if (this.view !== null) {
        this.view.detached();
      }

      if (this.behavior.handlesDetached) {
        this.viewModel.detached();
      }
    }
  };

  return Controller;
}();

var BehaviorPropertyObserver = (_dec7 = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["subscriberCollection"])(), _dec7(_class15 = function () {
  function BehaviorPropertyObserver(taskQueue, obj, propertyName, selfSubscriber, initialValue) {
    

    this.taskQueue = taskQueue;
    this.obj = obj;
    this.propertyName = propertyName;
    this.notqueued = true;
    this.publishing = false;
    this.selfSubscriber = selfSubscriber;
    this.currentValue = this.oldValue = initialValue;
  }

  BehaviorPropertyObserver.prototype.getValue = function getValue() {
    return this.currentValue;
  };

  BehaviorPropertyObserver.prototype.setValue = function setValue(newValue) {
    var oldValue = this.currentValue;

    if (!Object.is(newValue, oldValue)) {
      this.oldValue = oldValue;
      this.currentValue = newValue;

      if (this.publishing && this.notqueued) {
        if (this.taskQueue.flushing) {
          this.call();
        } else {
          this.notqueued = false;
          this.taskQueue.queueMicroTask(this);
        }
      }
    }
  };

  BehaviorPropertyObserver.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.currentValue;

    this.notqueued = true;

    if (Object.is(newValue, oldValue)) {
      return;
    }

    if (this.selfSubscriber) {
      this.selfSubscriber(newValue, oldValue);
    }

    this.callSubscribers(newValue, oldValue);
    this.oldValue = newValue;
  };

  BehaviorPropertyObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  BehaviorPropertyObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  return BehaviorPropertyObserver;
}()) || _class15);

function getObserver(instance, name) {
  var lookup = instance.__observers__;

  if (lookup === undefined) {
    var ctor = Object.getPrototypeOf(instance).constructor;
    var _behavior = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, ctor);
    if (!_behavior.isInitialized) {
      _behavior.initialize(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"].instance || new __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"](), instance.constructor);
    }

    lookup = _behavior.observerLocator.getOrCreateObserversLookup(instance);
    _behavior._ensurePropertiesDefined(instance, lookup);
  }

  return lookup[name];
}

var BindableProperty = function () {
  function BindableProperty(nameOrConfig) {
    

    if (typeof nameOrConfig === 'string') {
      this.name = nameOrConfig;
    } else {
      Object.assign(this, nameOrConfig);
    }

    this.attribute = this.attribute || _hyphenate(this.name);
    var defaultBindingMode = this.defaultBindingMode;
    if (defaultBindingMode === null || defaultBindingMode === undefined) {
      this.defaultBindingMode = __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["bindingMode"].oneWay;
    } else if (typeof defaultBindingMode === 'string') {
      this.defaultBindingMode = __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["bindingMode"][defaultBindingMode] || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["bindingMode"].oneWay;
    }
    this.changeHandler = this.changeHandler || null;
    this.owner = null;
    this.descriptor = null;
  }

  BindableProperty.prototype.registerWith = function registerWith(target, behavior, descriptor) {
    behavior.properties.push(this);
    behavior.attributes[this.attribute] = this;
    this.owner = behavior;

    if (descriptor) {
      this.descriptor = descriptor;
      return this._configureDescriptor(descriptor);
    }

    return undefined;
  };

  BindableProperty.prototype._configureDescriptor = function _configureDescriptor(descriptor) {
    var name = this.name;

    descriptor.configurable = true;
    descriptor.enumerable = true;

    if ('initializer' in descriptor) {
      this.defaultValue = descriptor.initializer;
      delete descriptor.initializer;
      delete descriptor.writable;
    }

    if ('value' in descriptor) {
      this.defaultValue = descriptor.value;
      delete descriptor.value;
      delete descriptor.writable;
    }

    descriptor.get = function () {
      return getObserver(this, name).getValue();
    };

    descriptor.set = function (value) {
      getObserver(this, name).setValue(value);
    };

    descriptor.get.getObserver = function (obj) {
      return getObserver(obj, name);
    };

    return descriptor;
  };

  BindableProperty.prototype.defineOn = function defineOn(target, behavior) {
    var name = this.name;
    var handlerName = void 0;

    if (this.changeHandler === null) {
      handlerName = name + 'Changed';
      if (handlerName in target.prototype) {
        this.changeHandler = handlerName;
      }
    }

    if (this.descriptor === null) {
      Object.defineProperty(target.prototype, name, this._configureDescriptor(behavior, {}));
    }
  };

  BindableProperty.prototype.createObserver = function createObserver(viewModel) {
    var selfSubscriber = null;
    var defaultValue = this.defaultValue;
    var changeHandlerName = this.changeHandler;
    var name = this.name;
    var initialValue = void 0;

    if (this.hasOptions) {
      return undefined;
    }

    if (changeHandlerName in viewModel) {
      if ('propertyChanged' in viewModel) {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          viewModel[changeHandlerName](newValue, oldValue);
          viewModel.propertyChanged(name, newValue, oldValue);
        };
      } else {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          return viewModel[changeHandlerName](newValue, oldValue);
        };
      }
    } else if ('propertyChanged' in viewModel) {
      selfSubscriber = function selfSubscriber(newValue, oldValue) {
        return viewModel.propertyChanged(name, newValue, oldValue);
      };
    } else if (changeHandlerName !== null) {
      throw new Error('Change handler ' + changeHandlerName + ' was specified but not declared on the class.');
    }

    if (defaultValue !== undefined) {
      initialValue = typeof defaultValue === 'function' ? defaultValue.call(viewModel) : defaultValue;
    }

    return new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, this.name, selfSubscriber, initialValue);
  };

  BindableProperty.prototype._initialize = function _initialize(viewModel, observerLookup, attributes, behaviorHandlesBind, boundProperties) {
    var selfSubscriber = void 0;
    var observer = void 0;
    var attribute = void 0;
    var defaultValue = this.defaultValue;

    if (this.isDynamic) {
      for (var _key6 in attributes) {
        this._createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, _key6, attributes[_key6], boundProperties);
      }
    } else if (!this.hasOptions) {
      observer = observerLookup[this.name];

      if (attributes !== null) {
        selfSubscriber = observer.selfSubscriber;
        attribute = attributes[this.attribute];

        if (behaviorHandlesBind) {
          observer.selfSubscriber = null;
        }

        if (typeof attribute === 'string') {
          viewModel[this.name] = attribute;
          observer.call();
        } else if (attribute) {
          boundProperties.push({ observer: observer, binding: attribute.createBinding(viewModel) });
        } else if (defaultValue !== undefined) {
          observer.call();
        }

        observer.selfSubscriber = selfSubscriber;
      }

      observer.publishing = true;
    }
  };

  BindableProperty.prototype._createDynamicProperty = function _createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, name, attribute, boundProperties) {
    var changeHandlerName = name + 'Changed';
    var selfSubscriber = null;
    var observer = void 0;
    var info = void 0;

    if (changeHandlerName in viewModel) {
      if ('propertyChanged' in viewModel) {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          viewModel[changeHandlerName](newValue, oldValue);
          viewModel.propertyChanged(name, newValue, oldValue);
        };
      } else {
        selfSubscriber = function selfSubscriber(newValue, oldValue) {
          return viewModel[changeHandlerName](newValue, oldValue);
        };
      }
    } else if ('propertyChanged' in viewModel) {
      selfSubscriber = function selfSubscriber(newValue, oldValue) {
        return viewModel.propertyChanged(name, newValue, oldValue);
      };
    }

    observer = observerLookup[name] = new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, name, selfSubscriber);

    Object.defineProperty(viewModel, name, {
      configurable: true,
      enumerable: true,
      get: observer.getValue.bind(observer),
      set: observer.setValue.bind(observer)
    });

    if (behaviorHandlesBind) {
      observer.selfSubscriber = null;
    }

    if (typeof attribute === 'string') {
      viewModel[name] = attribute;
      observer.call();
    } else if (attribute) {
      info = { observer: observer, binding: attribute.createBinding(viewModel) };
      boundProperties.push(info);
    }

    observer.publishing = true;
    observer.selfSubscriber = selfSubscriber;
  };

  return BindableProperty;
}();

var lastProviderId = 0;

function nextProviderId() {
  return ++lastProviderId;
}

function doProcessContent() {
  return true;
}
function doProcessAttributes() {}

var HtmlBehaviorResource = function () {
  function HtmlBehaviorResource() {
    

    this.elementName = null;
    this.attributeName = null;
    this.attributeDefaultBindingMode = undefined;
    this.liftsContent = false;
    this.targetShadowDOM = false;
    this.shadowDOMOptions = null;
    this.processAttributes = doProcessAttributes;
    this.processContent = doProcessContent;
    this.usesShadowDOM = false;
    this.childBindings = null;
    this.hasDynamicOptions = false;
    this.containerless = false;
    this.properties = [];
    this.attributes = {};
    this.isInitialized = false;
    this.primaryProperty = null;
  }

  HtmlBehaviorResource.convention = function convention(name, existing) {
    var behavior = void 0;

    if (name.endsWith('CustomAttribute')) {
      behavior = existing || new HtmlBehaviorResource();
      behavior.attributeName = _hyphenate(name.substring(0, name.length - 15));
    }

    if (name.endsWith('CustomElement')) {
      behavior = existing || new HtmlBehaviorResource();
      behavior.elementName = _hyphenate(name.substring(0, name.length - 13));
    }

    return behavior;
  };

  HtmlBehaviorResource.prototype.addChildBinding = function addChildBinding(behavior) {
    if (this.childBindings === null) {
      this.childBindings = [];
    }

    this.childBindings.push(behavior);
  };

  HtmlBehaviorResource.prototype.initialize = function initialize(container, target) {
    var proto = target.prototype;
    var properties = this.properties;
    var attributeName = this.attributeName;
    var attributeDefaultBindingMode = this.attributeDefaultBindingMode;
    var i = void 0;
    var ii = void 0;
    var current = void 0;

    if (this.isInitialized) {
      return;
    }

    this.isInitialized = true;
    target.__providerId__ = nextProviderId();

    this.observerLocator = container.get(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ObserverLocator"]);
    this.taskQueue = container.get(__WEBPACK_IMPORTED_MODULE_7_aurelia_task_queue__["TaskQueue"]);

    this.target = target;
    this.usesShadowDOM = this.targetShadowDOM && __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["FEATURE"].shadowDOM;
    this.handlesCreated = 'created' in proto;
    this.handlesBind = 'bind' in proto;
    this.handlesUnbind = 'unbind' in proto;
    this.handlesAttached = 'attached' in proto;
    this.handlesDetached = 'detached' in proto;
    this.htmlName = this.elementName || this.attributeName;

    if (attributeName !== null) {
      if (properties.length === 0) {
        new BindableProperty({
          name: 'value',
          changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,
          attribute: attributeName,
          defaultBindingMode: attributeDefaultBindingMode
        }).registerWith(target, this);
      }

      current = properties[0];

      if (properties.length === 1 && current.name === 'value') {
        current.isDynamic = current.hasOptions = this.hasDynamicOptions;
        current.defineOn(target, this);
      } else {
        for (i = 0, ii = properties.length; i < ii; ++i) {
          properties[i].defineOn(target, this);
          if (properties[i].primaryProperty) {
            if (this.primaryProperty) {
              throw new Error('Only one bindable property on a custom element can be defined as the default');
            }
            this.primaryProperty = properties[i];
          }
        }

        current = new BindableProperty({
          name: 'value',
          changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,
          attribute: attributeName,
          defaultBindingMode: attributeDefaultBindingMode
        });

        current.hasOptions = true;
        current.registerWith(target, this);
      }
    } else {
      for (i = 0, ii = properties.length; i < ii; ++i) {
        properties[i].defineOn(target, this);
      }

      this._copyInheritedProperties(container, target);
    }
  };

  HtmlBehaviorResource.prototype.register = function register(registry, name) {
    var _this12 = this;

    if (this.attributeName !== null) {
      registry.registerAttribute(name || this.attributeName, this, this.attributeName);

      if (Array.isArray(this.aliases)) {
        this.aliases.forEach(function (alias) {
          registry.registerAttribute(alias, _this12, _this12.attributeName);
        });
      }
    }

    if (this.elementName !== null) {
      registry.registerElement(name || this.elementName, this);
    }
  };

  HtmlBehaviorResource.prototype.load = function load(container, target, loadContext, viewStrategy, transientView) {
    var _this13 = this;

    var options = void 0;

    if (this.elementName !== null) {
      viewStrategy = container.get(ViewLocator).getViewStrategy(viewStrategy || this.viewStrategy || target);
      options = new ViewCompileInstruction(this.targetShadowDOM, true);

      if (!viewStrategy.moduleId) {
        viewStrategy.moduleId = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(target).moduleId;
      }

      return viewStrategy.loadViewFactory(container.get(ViewEngine), options, loadContext, target).then(function (viewFactory) {
        if (!transientView || !_this13.viewFactory) {
          _this13.viewFactory = viewFactory;
        }

        return viewFactory;
      });
    }

    return Promise.resolve(this);
  };

  HtmlBehaviorResource.prototype.compile = function compile(compiler, resources, node, instruction, parentNode) {
    if (this.liftsContent) {
      if (!instruction.viewFactory) {
        var _template = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createElement('template');
        var fragment = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createDocumentFragment();
        var cacheSize = node.getAttribute('view-cache');
        var part = node.getAttribute('part');

        node.removeAttribute(instruction.originalAttrName);
        __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].replaceNode(_template, node, parentNode);
        fragment.appendChild(node);
        instruction.viewFactory = compiler.compile(fragment, resources);

        if (part) {
          instruction.viewFactory.part = part;
          node.removeAttribute('part');
        }

        if (cacheSize) {
          instruction.viewFactory.setCacheSize(cacheSize);
          node.removeAttribute('view-cache');
        }

        node = _template;
      }
    } else if (this.elementName !== null) {
      var _partReplacements2 = {};

      if (this.processContent(compiler, resources, node, instruction) && node.hasChildNodes()) {
        var currentChild = node.firstChild;
        var contentElement = this.usesShadowDOM ? null : __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createElement('au-content');
        var nextSibling = void 0;
        var toReplace = void 0;

        while (currentChild) {
          nextSibling = currentChild.nextSibling;

          if (currentChild.tagName === 'TEMPLATE' && (toReplace = currentChild.getAttribute('replace-part'))) {
            _partReplacements2[toReplace] = compiler.compile(currentChild, resources);
            __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].removeNode(currentChild, parentNode);
            instruction.partReplacements = _partReplacements2;
          } else if (contentElement !== null) {
            if (currentChild.nodeType === 3 && _isAllWhitespace(currentChild)) {
              __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].removeNode(currentChild, parentNode);
            } else {
              contentElement.appendChild(currentChild);
            }
          }

          currentChild = nextSibling;
        }

        if (contentElement !== null && contentElement.hasChildNodes()) {
          node.appendChild(contentElement);
        }

        instruction.skipContentProcessing = false;
      } else {
        instruction.skipContentProcessing = true;
      }
    } else if (!this.processContent(compiler, resources, node, instruction)) {
      instruction.skipContentProcessing = true;
    }

    return node;
  };

  HtmlBehaviorResource.prototype.create = function create(container, instruction, element, bindings) {
    var viewHost = void 0;
    var au = null;

    instruction = instruction || BehaviorInstruction.normal;
    element = element || null;
    bindings = bindings || null;

    if (this.elementName !== null && element) {
      if (this.usesShadowDOM) {
        viewHost = element.attachShadow(this.shadowDOMOptions);
        container.registerInstance(__WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].boundary, viewHost);
      } else {
        viewHost = element;
        if (this.targetShadowDOM) {
          container.registerInstance(__WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].boundary, viewHost);
        }
      }
    }

    if (element !== null) {
      element.au = au = element.au || {};
    }

    var viewModel = instruction.viewModel || container.get(this.target);
    var controller = new Controller(this, instruction, viewModel, container);
    var childBindings = this.childBindings;
    var viewFactory = void 0;

    if (this.liftsContent) {
      au.controller = controller;
    } else if (this.elementName !== null) {
      viewFactory = instruction.viewFactory || this.viewFactory;
      container.viewModel = viewModel;

      if (viewFactory) {
        controller.view = viewFactory.create(container, instruction, element);
      }

      if (element !== null) {
        au.controller = controller;

        if (controller.view) {
          if (!this.usesShadowDOM && (element.childNodes.length === 1 || element.contentElement)) {
            var contentElement = element.childNodes[0] || element.contentElement;
            controller.view.contentView = { fragment: contentElement };
            contentElement.parentNode && __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].removeNode(contentElement);
          }

          if (instruction.anchorIsContainer) {
            if (childBindings !== null) {
              for (var _i4 = 0, _ii3 = childBindings.length; _i4 < _ii3; ++_i4) {
                controller.view.addBinding(childBindings[_i4].create(element, viewModel, controller));
              }
            }

            controller.view.appendNodesTo(viewHost);
          } else {
            controller.view.insertNodesBefore(viewHost);
          }
        } else if (childBindings !== null) {
          for (var _i5 = 0, _ii4 = childBindings.length; _i5 < _ii4; ++_i5) {
            bindings.push(childBindings[_i5].create(element, viewModel, controller));
          }
        }
      } else if (controller.view) {
        controller.view.controller = controller;

        if (childBindings !== null) {
          for (var _i6 = 0, _ii5 = childBindings.length; _i6 < _ii5; ++_i6) {
            controller.view.addBinding(childBindings[_i6].create(instruction.host, viewModel, controller));
          }
        }
      } else if (childBindings !== null) {
        for (var _i7 = 0, _ii6 = childBindings.length; _i7 < _ii6; ++_i7) {
          bindings.push(childBindings[_i7].create(instruction.host, viewModel, controller));
        }
      }
    } else if (childBindings !== null) {
      for (var _i8 = 0, _ii7 = childBindings.length; _i8 < _ii7; ++_i8) {
        bindings.push(childBindings[_i8].create(element, viewModel, controller));
      }
    }

    if (au !== null) {
      au[this.htmlName] = controller;
    }

    if (instruction.initiatedByBehavior && viewFactory) {
      controller.view.created();
    }

    return controller;
  };

  HtmlBehaviorResource.prototype._ensurePropertiesDefined = function _ensurePropertiesDefined(instance, lookup) {
    var properties = void 0;
    var i = void 0;
    var ii = void 0;
    var observer = void 0;

    if ('__propertiesDefined__' in lookup) {
      return;
    }

    lookup.__propertiesDefined__ = true;
    properties = this.properties;

    for (i = 0, ii = properties.length; i < ii; ++i) {
      observer = properties[i].createObserver(instance);

      if (observer !== undefined) {
        lookup[observer.propertyName] = observer;
      }
    }
  };

  HtmlBehaviorResource.prototype._copyInheritedProperties = function _copyInheritedProperties(container, target) {
    var _this14 = this;

    var behavior = void 0;
    var derived = target;

    while (true) {
      var proto = Object.getPrototypeOf(target.prototype);
      target = proto && proto.constructor;
      if (!target) {
        return;
      }
      behavior = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, target);
      if (behavior) {
        break;
      }
    }
    behavior.initialize(container, target);

    var _loop = function _loop(_i9, _ii8) {
      var prop = behavior.properties[_i9];

      if (_this14.properties.some(function (p) {
        return p.name === prop.name;
      })) {
        return 'continue';
      }

      new BindableProperty(prop).registerWith(derived, _this14);
    };

    for (var _i9 = 0, _ii8 = behavior.properties.length; _i9 < _ii8; ++_i9) {
      var _ret = _loop(_i9, _ii8);

      if (_ret === 'continue') continue;
    }
  };

  return HtmlBehaviorResource;
}();

function createChildObserverDecorator(selectorOrConfig, all) {
  return function (target, key, descriptor) {
    var actualTarget = typeof key === 'string' ? target.constructor : target;
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, actualTarget);

    if (typeof selectorOrConfig === 'string') {
      selectorOrConfig = {
        selector: selectorOrConfig,
        name: key
      };
    }

    if (descriptor) {
      descriptor.writable = true;
      descriptor.configurable = true;
    }

    selectorOrConfig.all = all;
    r.addChildBinding(new ChildObserver(selectorOrConfig));
  };
}

function children(selectorOrConfig) {
  return createChildObserverDecorator(selectorOrConfig, true);
}

function child(selectorOrConfig) {
  return createChildObserverDecorator(selectorOrConfig, false);
}

var ChildObserver = function () {
  function ChildObserver(config) {
    

    this.name = config.name;
    this.changeHandler = config.changeHandler || this.name + 'Changed';
    this.selector = config.selector;
    this.all = config.all;
  }

  ChildObserver.prototype.create = function create(viewHost, viewModel, controller) {
    return new ChildObserverBinder(this.selector, viewHost, this.name, viewModel, controller, this.changeHandler, this.all);
  };

  return ChildObserver;
}();

var noMutations = [];

function trackMutation(groupedMutations, binder, record) {
  var mutations = groupedMutations.get(binder);

  if (!mutations) {
    mutations = [];
    groupedMutations.set(binder, mutations);
  }

  mutations.push(record);
}

function onChildChange(mutations, observer) {
  var binders = observer.binders;
  var bindersLength = binders.length;

  var groupedMutations = new Map();

  for (var _i10 = 0, _ii9 = mutations.length; _i10 < _ii9; ++_i10) {
    var record = mutations[_i10];
    var added = record.addedNodes;
    var removed = record.removedNodes;

    for (var j = 0, jj = removed.length; j < jj; ++j) {
      var _node = removed[j];
      if (_node.nodeType === 1) {
        for (var k = 0; k < bindersLength; ++k) {
          var binder = binders[k];

          if (binder.onRemove(_node)) {
            trackMutation(groupedMutations, binder, record);
          }
        }
      }
    }

    for (var _j = 0, _jj = added.length; _j < _jj; ++_j) {
      var _node2 = added[_j];
      if (_node2.nodeType === 1) {
        for (var _k = 0; _k < bindersLength; ++_k) {
          var _binder = binders[_k];

          if (_binder.onAdd(_node2)) {
            trackMutation(groupedMutations, _binder, record);
          }
        }
      }
    }
  }

  groupedMutations.forEach(function (mutationRecords, binder) {
    if (binder.isBound && binder.changeHandler !== null) {
      binder.viewModel[binder.changeHandler](mutationRecords);
    }
  });
}

var ChildObserverBinder = function () {
  function ChildObserverBinder(selector, viewHost, property, viewModel, controller, changeHandler, all) {
    

    this.selector = selector;

    this.viewHost = viewHost;
    this.property = property;
    this.viewModel = viewModel;
    this.controller = controller;
    this.changeHandler = changeHandler in viewModel ? changeHandler : null;
    this.usesShadowDOM = controller.behavior.usesShadowDOM;
    this.all = all;

    if (!this.usesShadowDOM && controller.view && controller.view.contentView) {
      this.contentView = controller.view.contentView;
    } else {
      this.contentView = null;
    }
    this.source = null;
    this.isBound = false;
  }

  ChildObserverBinder.prototype.matches = function matches(element) {
    if (element.matches(this.selector)) {
      if (this.contentView === null) {
        return true;
      }

      var contentView = this.contentView;
      var assignedSlot = element.auAssignedSlot;

      if (assignedSlot && assignedSlot.projectFromAnchors) {
        var anchors = assignedSlot.projectFromAnchors;

        for (var _i11 = 0, _ii10 = anchors.length; _i11 < _ii10; ++_i11) {
          if (anchors[_i11].auOwnerView === contentView) {
            return true;
          }
        }

        return false;
      }

      return element.auOwnerView === contentView;
    }

    return false;
  };

  ChildObserverBinder.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.source = source;
    }
    this.isBound = true;

    var viewHost = this.viewHost;
    var viewModel = this.viewModel;
    var observer = viewHost.__childObserver__;

    if (!observer) {
      observer = viewHost.__childObserver__ = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createMutationObserver(onChildChange);

      var options = {
        childList: true,
        subtree: !this.usesShadowDOM
      };

      observer.observe(viewHost, options);
      observer.binders = [];
    }

    observer.binders.push(this);

    if (this.usesShadowDOM) {
      var current = viewHost.firstElementChild;

      if (this.all) {
        var items = viewModel[this.property];
        if (!items) {
          items = viewModel[this.property] = [];
        } else {
          items.splice(0);
        }

        while (current) {
          if (this.matches(current)) {
            items.push(current.au && current.au.controller ? current.au.controller.viewModel : current);
          }

          current = current.nextElementSibling;
        }

        if (this.changeHandler !== null) {
          this.viewModel[this.changeHandler](noMutations);
        }
      } else {
        while (current) {
          if (this.matches(current)) {
            var _value = current.au && current.au.controller ? current.au.controller.viewModel : current;
            this.viewModel[this.property] = _value;

            if (this.changeHandler !== null) {
              this.viewModel[this.changeHandler](_value);
            }

            break;
          }

          current = current.nextElementSibling;
        }
      }
    }
  };

  ChildObserverBinder.prototype.onRemove = function onRemove(element) {
    if (this.matches(element)) {
      var _value2 = element.au && element.au.controller ? element.au.controller.viewModel : element;

      if (this.all) {
        var items = this.viewModel[this.property] || (this.viewModel[this.property] = []);
        var index = items.indexOf(_value2);

        if (index !== -1) {
          items.splice(index, 1);
        }

        return true;
      }

      var currentValue = this.viewModel[this.property];
      if (currentValue === _value2) {
        this.viewModel[this.property] = null;

        if (this.isBound && this.changeHandler !== null) {
          this.viewModel[this.changeHandler](_value2);
        }
      }
    }

    return false;
  };

  ChildObserverBinder.prototype.onAdd = function onAdd(element) {
    if (this.matches(element)) {
      var _value3 = element.au && element.au.controller ? element.au.controller.viewModel : element;

      if (this.all) {
        var items = this.viewModel[this.property] || (this.viewModel[this.property] = []);

        if (this.selector === '*') {
          items.push(_value3);
          return true;
        }

        var index = 0;
        var prev = element.previousElementSibling;

        while (prev) {
          if (this.matches(prev)) {
            index++;
          }

          prev = prev.previousElementSibling;
        }

        items.splice(index, 0, _value3);
        return true;
      }

      this.viewModel[this.property] = _value3;

      if (this.isBound && this.changeHandler !== null) {
        this.viewModel[this.changeHandler](_value3);
      }
    }

    return false;
  };

  ChildObserverBinder.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    this.source = null;
    var childObserver = this.viewHost.__childObserver__;
    if (childObserver) {
      var binders = childObserver.binders;
      if (binders && binders.length) {
        var idx = binders.indexOf(this);
        if (idx !== -1) {
          binders.splice(idx, 1);
        }
        if (binders.length === 0) {
          childObserver.disconnect();
          this.viewHost.__childObserver__ = null;
        }
      }

      if (this.usesShadowDOM) {
        this.viewModel[this.property] = null;
      }
    }
  };

  return ChildObserverBinder;
}();

function remove(viewSlot, previous) {
  return Array.isArray(previous) ? viewSlot.removeMany(previous, true) : viewSlot.remove(previous, true);
}

var SwapStrategies = {
  before: function before(viewSlot, previous, callback) {
    return previous === undefined ? callback() : callback().then(function () {
      return remove(viewSlot, previous);
    });
  },
  with: function _with(viewSlot, previous, callback) {
    return previous === undefined ? callback() : Promise.all([remove(viewSlot, previous), callback()]);
  },
  after: function after(viewSlot, previous, callback) {
    return Promise.resolve(viewSlot.removeAll(true)).then(callback);
  }
};

function tryActivateViewModel(context) {
  if (context.skipActivation || typeof context.viewModel.activate !== 'function') {
    return Promise.resolve();
  }

  return context.viewModel.activate(context.model) || Promise.resolve();
}

var CompositionEngine = (_dec8 = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["inject"])(ViewEngine, ViewLocator), _dec8(_class16 = function () {
  function CompositionEngine(viewEngine, viewLocator) {
    

    this.viewEngine = viewEngine;
    this.viewLocator = viewLocator;
  }

  CompositionEngine.prototype._swap = function _swap(context, view) {
    var swapStrategy = SwapStrategies[context.swapOrder] || SwapStrategies.after;
    var previousViews = context.viewSlot.children.slice();

    return swapStrategy(context.viewSlot, previousViews, function () {
      return Promise.resolve(context.viewSlot.add(view)).then(function () {
        if (context.currentController) {
          context.currentController.unbind();
        }
      });
    }).then(function () {
      if (context.compositionTransactionNotifier) {
        context.compositionTransactionNotifier.done();
      }
    });
  };

  CompositionEngine.prototype._createControllerAndSwap = function _createControllerAndSwap(context) {
    var _this15 = this;

    return this.createController(context).then(function (controller) {
      if (context.compositionTransactionOwnershipToken) {
        return context.compositionTransactionOwnershipToken.waitForCompositionComplete().then(function () {
          controller.automate(context.overrideContext, context.owningView);

          return _this15._swap(context, controller.view);
        }).then(function () {
          return controller;
        });
      }

      controller.automate(context.overrideContext, context.owningView);

      return _this15._swap(context, controller.view).then(function () {
        return controller;
      });
    });
  };

  CompositionEngine.prototype.createController = function createController(context) {
    var _this16 = this;

    var childContainer = void 0;
    var viewModel = void 0;
    var viewModelResource = void 0;

    var m = void 0;

    return this.ensureViewModel(context).then(tryActivateViewModel).then(function () {
      childContainer = context.childContainer;
      viewModel = context.viewModel;
      viewModelResource = context.viewModelResource;
      m = viewModelResource.metadata;

      var viewStrategy = _this16.viewLocator.getViewStrategy(context.view || viewModel);

      if (context.viewResources) {
        viewStrategy.makeRelativeTo(context.viewResources.viewUrl);
      }

      return m.load(childContainer, viewModelResource.value, null, viewStrategy, true);
    }).then(function (viewFactory) {
      return m.create(childContainer, BehaviorInstruction.dynamic(context.host, viewModel, viewFactory));
    });
  };

  CompositionEngine.prototype.ensureViewModel = function ensureViewModel(context) {
    var childContainer = context.childContainer = context.childContainer || context.container.createChild();

    if (typeof context.viewModel === 'string') {
      context.viewModel = context.viewResources ? context.viewResources.relativeToView(context.viewModel) : context.viewModel;

      return this.viewEngine.importViewModelResource(context.viewModel).then(function (viewModelResource) {
        childContainer.autoRegister(viewModelResource.value);

        if (context.host) {
          childContainer.registerInstance(__WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].Element, context.host);
        }

        context.viewModel = childContainer.viewModel = childContainer.get(viewModelResource.value);
        context.viewModelResource = viewModelResource;
        return context;
      });
    }

    var ctor = context.viewModel.constructor;
    var isClass = typeof context.viewModel === 'function';
    if (isClass) {
      ctor = context.viewModel;
      childContainer.autoRegister(ctor);
    }
    var m = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, ctor);

    m.elementName = m.elementName || 'dynamic-element';

    m.initialize(isClass ? childContainer : context.container || childContainer, ctor);

    context.viewModelResource = { metadata: m, value: ctor };

    if (context.host) {
      childContainer.registerInstance(__WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].Element, context.host);
    }
    childContainer.viewModel = context.viewModel = isClass ? childContainer.get(ctor) : context.viewModel;
    return Promise.resolve(context);
  };

  CompositionEngine.prototype.compose = function compose(context) {
    var _this17 = this;

    context.childContainer = context.childContainer || context.container.createChild();
    context.view = this.viewLocator.getViewStrategy(context.view);

    var transaction = context.childContainer.get(CompositionTransaction);
    var compositionTransactionOwnershipToken = transaction.tryCapture();

    if (compositionTransactionOwnershipToken) {
      context.compositionTransactionOwnershipToken = compositionTransactionOwnershipToken;
    } else {
      context.compositionTransactionNotifier = transaction.enlist();
    }

    if (context.viewModel) {
      return this._createControllerAndSwap(context);
    } else if (context.view) {
      if (context.viewResources) {
        context.view.makeRelativeTo(context.viewResources.viewUrl);
      }

      return context.view.loadViewFactory(this.viewEngine, new ViewCompileInstruction()).then(function (viewFactory) {
        var result = viewFactory.create(context.childContainer);
        result.bind(context.bindingContext, context.overrideContext);

        if (context.compositionTransactionOwnershipToken) {
          return context.compositionTransactionOwnershipToken.waitForCompositionComplete().then(function () {
            return _this17._swap(context, result);
          }).then(function () {
            return result;
          });
        }

        return _this17._swap(context, result).then(function () {
          return result;
        });
      });
    } else if (context.viewSlot) {
      context.viewSlot.removeAll();

      if (context.compositionTransactionNotifier) {
        context.compositionTransactionNotifier.done();
      }

      return Promise.resolve(null);
    }

    return Promise.resolve(null);
  };

  return CompositionEngine;
}()) || _class16);

var ElementConfigResource = function () {
  function ElementConfigResource() {
    
  }

  ElementConfigResource.prototype.initialize = function initialize(container, target) {};

  ElementConfigResource.prototype.register = function register(registry, name) {};

  ElementConfigResource.prototype.load = function load(container, target) {
    var config = new target();
    var eventManager = container.get(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["EventManager"]);
    eventManager.registerElementConfig(config);
  };

  return ElementConfigResource;
}();

function resource(instanceOrConfig) {
  return function (target) {
    var isConfig = typeof instanceOrConfig === 'string' || Object.getPrototypeOf(instanceOrConfig) === Object.prototype;
    if (isConfig) {
      target.$resource = instanceOrConfig;
    } else {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, instanceOrConfig, target);
    }
  };
}

function behavior(override) {
  return function (target) {
    if (override instanceof HtmlBehaviorResource) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, override, target);
    } else {
      var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, target);
      Object.assign(r, override);
    }
  };
}

function customElement(name) {
  return function (target) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, target);
    r.elementName = validateBehaviorName(name, 'custom element');
  };
}

function customAttribute(name, defaultBindingMode, aliases) {
  return function (target) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, target);
    r.attributeName = validateBehaviorName(name, 'custom attribute');
    r.attributeDefaultBindingMode = defaultBindingMode;
    r.aliases = aliases;
  };
}

function templateController(target) {
  var deco = function deco(t) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
    r.liftsContent = true;
  };

  return target ? deco(target) : deco;
}

function bindable(nameOrConfigOrTarget, key, descriptor) {
  var deco = function deco(target, key2, descriptor2) {
    var actualTarget = key2 ? target.constructor : target;
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, actualTarget);
    var prop = void 0;

    if (key2) {
      nameOrConfigOrTarget = nameOrConfigOrTarget || {};
      nameOrConfigOrTarget.name = key2;
    }

    prop = new BindableProperty(nameOrConfigOrTarget);
    return prop.registerWith(actualTarget, r, descriptor2);
  };

  if (!nameOrConfigOrTarget) {
    return deco;
  }

  if (key) {
    var _target = nameOrConfigOrTarget;
    nameOrConfigOrTarget = null;
    return deco(_target, key, descriptor);
  }

  return deco;
}

function dynamicOptions(target) {
  var deco = function deco(t) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
    r.hasDynamicOptions = true;
  };

  return target ? deco(target) : deco;
}

var defaultShadowDOMOptions = { mode: 'open' };

function useShadowDOM(targetOrOptions) {
  var options = typeof targetOrOptions === 'function' || !targetOrOptions ? defaultShadowDOMOptions : targetOrOptions;

  var deco = function deco(t) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
    r.targetShadowDOM = true;
    r.shadowDOMOptions = options;
  };

  return typeof targetOrOptions === 'function' ? deco(targetOrOptions) : deco;
}

function processAttributes(processor) {
  return function (t) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
    r.processAttributes = function (compiler, resources, node, attributes, elementInstruction) {
      try {
        processor(compiler, resources, node, attributes, elementInstruction);
      } catch (error) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating').error(error);
      }
    };
  };
}

function doNotProcessContent() {
  return false;
}

function processContent(processor) {
  return function (t) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
    r.processContent = processor ? function (compiler, resources, node, instruction) {
      try {
        return processor(compiler, resources, node, instruction);
      } catch (error) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating').error(error);
        return false;
      }
    } : doNotProcessContent;
  };
}

function containerless(target) {
  var deco = function deco(t) {
    var r = __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
    r.containerless = true;
  };

  return target ? deco(target) : deco;
}

function useViewStrategy(strategy) {
  return function (target) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(ViewLocator.viewStrategyMetadataKey, strategy, target);
  };
}

function useView(path) {
  return useViewStrategy(new RelativeViewStrategy(path));
}

function inlineView(markup, dependencies, dependencyBaseUrl) {
  return useViewStrategy(new InlineViewStrategy(markup, dependencies, dependencyBaseUrl));
}

function noView(targetOrDependencies, dependencyBaseUrl) {
  var target = void 0;
  var dependencies = void 0;
  if (typeof targetOrDependencies === 'function') {
    target = targetOrDependencies;
  } else {
    dependencies = targetOrDependencies;
    target = undefined;
  }

  var deco = function deco(t) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(ViewLocator.viewStrategyMetadataKey, new NoViewStrategy(dependencies, dependencyBaseUrl), t);
  };

  return target ? deco(target) : deco;
}

function view(templateOrConfig) {
  return function (target) {
    target.$view = templateOrConfig;
  };
}

function elementConfig(target) {
  var deco = function deco(t) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].resource, new ElementConfigResource(), t);
  };

  return target ? deco(target) : deco;
}

function viewResources() {
  for (var _len = arguments.length, resources = Array(_len), _key7 = 0; _key7 < _len; _key7++) {
    resources[_key7] = arguments[_key7];
  }

  return function (target) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["metadata"].define(ViewEngine.viewModelRequireMetadataKey, resources, target);
  };
}

var TemplatingEngine = (_dec9 = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"], ModuleAnalyzer, ViewCompiler, CompositionEngine), _dec9(_class17 = function () {
  function TemplatingEngine(container, moduleAnalyzer, viewCompiler, compositionEngine) {
    

    this._container = container;
    this._moduleAnalyzer = moduleAnalyzer;
    this._viewCompiler = viewCompiler;
    this._compositionEngine = compositionEngine;
    container.registerInstance(Animator, Animator.instance = new Animator());
  }

  TemplatingEngine.prototype.configureAnimator = function configureAnimator(animator) {
    this._container.unregister(Animator);
    this._container.registerInstance(Animator, Animator.instance = animator);
  };

  TemplatingEngine.prototype.compose = function compose(context) {
    return this._compositionEngine.compose(context);
  };

  TemplatingEngine.prototype.enhance = function enhance(instruction) {
    if (instruction instanceof __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].Element) {
      instruction = { element: instruction };
    }

    var compilerInstructions = { letExpressions: [] };
    var resources = instruction.resources || this._container.get(ViewResources);

    this._viewCompiler._compileNode(instruction.element, resources, compilerInstructions, instruction.element.parentNode, 'root', true);

    var factory = new ViewFactory(instruction.element, compilerInstructions, resources);
    var container = instruction.container || this._container.createChild();
    var view = factory.create(container, BehaviorInstruction.enhance());

    view.bind(instruction.bindingContext || {}, instruction.overrideContext);

    view.firstChild = view.lastChild = view.fragment;
    view.fragment = __WEBPACK_IMPORTED_MODULE_2_aurelia_pal__["DOM"].createDocumentFragment();
    view.attached();

    return view;
  };

  return TemplatingEngine;
}()) || _class17);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ 70:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(exports, "logLevel", function() { return logLevel; });
/* harmony export (immutable) */ exports["getLogger"] = getLogger;
/* harmony export (immutable) */ exports["addAppender"] = addAppender;
/* harmony export (immutable) */ exports["removeAppender"] = removeAppender;
/* harmony export (immutable) */ exports["getAppenders"] = getAppenders;
/* harmony export (immutable) */ exports["clearAppenders"] = clearAppenders;
/* harmony export (immutable) */ exports["addCustomLevel"] = addCustomLevel;
/* harmony export (immutable) */ exports["removeCustomLevel"] = removeCustomLevel;
/* harmony export (immutable) */ exports["setLevel"] = setLevel;
/* harmony export (immutable) */ exports["getLevel"] = getLevel;
/* harmony export (binding) */ __webpack_require__.d(exports, "Logger", function() { return Logger; });


var logLevel = {
  none: 0,
  error: 10,
  warn: 20,
  info: 30,
  debug: 40
};

var loggers = {};
var appenders = [];
var globalDefaultLevel = logLevel.none;

var standardLevels = ['none', 'error', 'warn', 'info', 'debug'];
function isStandardLevel(level) {
  return standardLevels.filter(function (l) {
    return l === level;
  }).length > 0;
}

function appendArgs() {
  return [this].concat(Array.prototype.slice.call(arguments));
}

function logFactory(level) {
  var threshold = logLevel[level];
  return function () {
    if (this.level < threshold) {
      return;
    }

    var args = appendArgs.apply(this, arguments);
    var i = appenders.length;
    while (i--) {
      var _appenders$i;

      (_appenders$i = appenders[i])[level].apply(_appenders$i, args);
    }
  };
}

function logFactoryCustom(level) {
  var threshold = logLevel[level];
  return function () {
    if (this.level < threshold) {
      return;
    }

    var args = appendArgs.apply(this, arguments);
    var i = appenders.length;
    while (i--) {
      var appender = appenders[i];
      if (appender[level] !== undefined) {
        appender[level].apply(appender, args);
      }
    }
  };
}

function connectLoggers() {
  var proto = Logger.prototype;
  for (var _level in logLevel) {
    if (isStandardLevel(_level)) {
      if (_level !== 'none') {
        proto[_level] = logFactory(_level);
      }
    } else {
      proto[_level] = logFactoryCustom(_level);
    }
  }
}

function disconnectLoggers() {
  var proto = Logger.prototype;
  for (var _level2 in logLevel) {
    if (_level2 !== 'none') {
      proto[_level2] = function () {};
    }
  }
}

function getLogger(id) {
  return loggers[id] || new Logger(id);
}

function addAppender(appender) {
  if (appenders.push(appender) === 1) {
    connectLoggers();
  }
}

function removeAppender(appender) {
  appenders = appenders.filter(function (a) {
    return a !== appender;
  });
}

function getAppenders() {
  return [].concat(appenders);
}

function clearAppenders() {
  appenders = [];
  disconnectLoggers();
}

function addCustomLevel(name, value) {
  if (logLevel[name] !== undefined) {
    throw Error('Log level "' + name + '" already exists.');
  }

  if (isNaN(value)) {
    throw Error('Value must be a number.');
  }

  logLevel[name] = value;

  if (appenders.length > 0) {
    connectLoggers();
  } else {
    Logger.prototype[name] = function () {};
  }
}

function removeCustomLevel(name) {
  if (logLevel[name] === undefined) {
    return;
  }

  if (isStandardLevel(name)) {
    throw Error('Built-in log level "' + name + '" cannot be removed.');
  }

  delete logLevel[name];
  delete Logger.prototype[name];
}

function setLevel(level) {
  globalDefaultLevel = level;
  for (var key in loggers) {
    loggers[key].setLevel(level);
  }
}

function getLevel() {
  return globalDefaultLevel;
}

var Logger = function () {
  function Logger(id) {
    

    var cached = loggers[id];
    if (cached) {
      return cached;
    }

    loggers[id] = this;
    this.id = id;
    this.level = globalDefaultLevel;
  }

  Logger.prototype.debug = function debug(message) {};

  Logger.prototype.info = function info(message) {};

  Logger.prototype.warn = function warn(message) {};

  Logger.prototype.error = function error(message) {};

  Logger.prototype.setLevel = function setLevel(level) {
    this.level = level;
  };

  Logger.prototype.isDebugEnabled = function isDebugEnabled() {
    return this.level === logLevel.debug;
  };

  return Logger;
}();

/***/ },

/***/ "aurelia-binding":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__ = __webpack_require__(58);
/* harmony export (binding) */ __webpack_require__.d(exports, "getArrayObserver", function() { return _getArrayObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getMapObserver", function() { return _getMapObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getSetObserver", function() { return _getSetObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "targetContext", function() { return targetContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "sourceContext", function() { return sourceContext; });
/* harmony export (immutable) */ exports["camelCase"] = camelCase;
/* harmony export (immutable) */ exports["createOverrideContext"] = createOverrideContext;
/* harmony export (immutable) */ exports["getContextFor"] = getContextFor;
/* harmony export (immutable) */ exports["createScopeForTest"] = createScopeForTest;
/* harmony export (immutable) */ exports["connectable"] = connectable;
/* harmony export (immutable) */ exports["enqueueBindingConnect"] = enqueueBindingConnect;
/* harmony export (immutable) */ exports["setConnectQueueThreshold"] = setConnectQueueThreshold;
/* harmony export (immutable) */ exports["enableConnectQueue"] = enableConnectQueue;
/* harmony export (immutable) */ exports["disableConnectQueue"] = disableConnectQueue;
/* harmony export (immutable) */ exports["getConnectQueueSize"] = getConnectQueueSize;
/* harmony export (immutable) */ exports["subscriberCollection"] = subscriberCollection;
/* harmony export (binding) */ __webpack_require__.d(exports, "ExpressionObserver", function() { return ExpressionObserver; });
/* harmony export (immutable) */ exports["calcSplices"] = calcSplices;
/* harmony export (immutable) */ exports["mergeSplice"] = mergeSplice;
/* harmony export (immutable) */ exports["projectArraySplices"] = projectArraySplices;
/* harmony export (immutable) */ exports["getChangeRecords"] = getChangeRecords;
/* harmony export (binding) */ __webpack_require__.d(exports, "ModifyCollectionObserver", function() { return ModifyCollectionObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CollectionLengthObserver", function() { return CollectionLengthObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Expression", function() { return Expression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingBehavior", function() { return BindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ValueConverter", function() { return ValueConverter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Assign", function() { return Assign; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Conditional", function() { return Conditional; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessThis", function() { return AccessThis; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessScope", function() { return AccessScope; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessMember", function() { return AccessMember; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessKeyed", function() { return AccessKeyed; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallScope", function() { return CallScope; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallMember", function() { return CallMember; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallFunction", function() { return CallFunction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Binary", function() { return Binary; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Unary", function() { return Unary; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralPrimitive", function() { return LiteralPrimitive; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralString", function() { return LiteralString; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralTemplate", function() { return LiteralTemplate; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralArray", function() { return LiteralArray; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralObject", function() { return LiteralObject; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Unparser", function() { return _Unparser; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ExpressionCloner", function() { return ExpressionCloner; });
/* harmony export (immutable) */ exports["cloneExpression"] = cloneExpression;
/* harmony export (binding) */ __webpack_require__.d(exports, "bindingMode", function() { return bindingMode; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Parser", function() { return Parser; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ParserImplementation", function() { return ParserImplementation; });
/* harmony export (binding) */ __webpack_require__.d(exports, "delegationStrategy", function() { return delegationStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "EventManager", function() { return EventManager; });
/* harmony export (binding) */ __webpack_require__.d(exports, "EventSubscriber", function() { return EventSubscriber; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DirtyChecker", function() { return DirtyChecker; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DirtyCheckProperty", function() { return DirtyCheckProperty; });
/* harmony export (binding) */ __webpack_require__.d(exports, "propertyAccessor", function() { return propertyAccessor; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PrimitiveObserver", function() { return PrimitiveObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SetterObserver", function() { return SetterObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "XLinkAttributeObserver", function() { return XLinkAttributeObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "dataAttributeAccessor", function() { return dataAttributeAccessor; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DataAttributeObserver", function() { return DataAttributeObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StyleObserver", function() { return StyleObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ValueAttributeObserver", function() { return ValueAttributeObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CheckedObserver", function() { return CheckedObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SelectValueObserver", function() { return SelectValueObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ClassObserver", function() { return ClassObserver; });
/* harmony export (immutable) */ exports["hasDeclaredDependencies"] = hasDeclaredDependencies;
/* harmony export (immutable) */ exports["declarePropertyDependencies"] = declarePropertyDependencies;
/* harmony export (immutable) */ exports["computedFrom"] = computedFrom;
/* harmony export (binding) */ __webpack_require__.d(exports, "ComputedExpression", function() { return ComputedExpression; });
/* harmony export (immutable) */ exports["createComputedObserver"] = createComputedObserver;
/* harmony export (binding) */ __webpack_require__.d(exports, "elements", function() { return elements; });
/* harmony export (binding) */ __webpack_require__.d(exports, "presentationElements", function() { return presentationElements; });
/* harmony export (binding) */ __webpack_require__.d(exports, "presentationAttributes", function() { return presentationAttributes; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SVGAnalyzer", function() { return SVGAnalyzer; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ObserverLocator", function() { return ObserverLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ObjectObservationAdapter", function() { return ObjectObservationAdapter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingExpression", function() { return BindingExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Binding", function() { return Binding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallExpression", function() { return CallExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Call", function() { return Call; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ValueConverterResource", function() { return ValueConverterResource; });
/* harmony export (immutable) */ exports["valueConverter"] = valueConverter;
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingBehaviorResource", function() { return BindingBehaviorResource; });
/* harmony export (immutable) */ exports["bindingBehavior"] = bindingBehavior;
/* harmony export (binding) */ __webpack_require__.d(exports, "ListenerExpression", function() { return ListenerExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Listener", function() { return Listener; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NameExpression", function() { return NameExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingEngine", function() { return BindingEngine; });
/* harmony export (immutable) */ exports["observable"] = observable;
/* harmony export (immutable) */ exports["connectBindingToSignal"] = connectBindingToSignal;
/* harmony export (immutable) */ exports["signalBindings"] = signalBindings;




var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _dec, _dec2, _class, _dec3, _class2, _dec4, _class3, _dec5, _class5, _dec6, _class7, _dec7, _class8, _dec8, _class9, _dec9, _class10, _class12, _temp, _dec10, _class13, _class14, _temp2;

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }








var targetContext = 'Binding:target';
var sourceContext = 'Binding:source';

var map = Object.create(null);

function camelCase(name) {
  if (name in map) {
    return map[name];
  }
  var result = name.charAt(0).toLowerCase() + name.slice(1).replace(/[_.-](\w|$)/g, function (_, x) {
    return x.toUpperCase();
  });
  map[name] = result;
  return result;
}

function createOverrideContext(bindingContext, parentOverrideContext) {
  return {
    bindingContext: bindingContext,
    parentOverrideContext: parentOverrideContext || null
  };
}

function getContextFor(name, scope, ancestor) {
  var oc = scope.overrideContext;

  if (ancestor) {
    while (ancestor && oc) {
      ancestor--;
      oc = oc.parentOverrideContext;
    }
    if (ancestor || !oc) {
      return undefined;
    }
    return name in oc ? oc : oc.bindingContext;
  }

  while (oc && !(name in oc) && !(oc.bindingContext && name in oc.bindingContext)) {
    oc = oc.parentOverrideContext;
  }
  if (oc) {
    return name in oc ? oc : oc.bindingContext;
  }

  return scope.bindingContext || scope.overrideContext;
}

function createScopeForTest(bindingContext, parentBindingContext) {
  if (parentBindingContext) {
    return {
      bindingContext: bindingContext,
      overrideContext: createOverrideContext(bindingContext, createOverrideContext(parentBindingContext))
    };
  }
  return {
    bindingContext: bindingContext,
    overrideContext: createOverrideContext(bindingContext)
  };
}

var slotNames = [];
var versionSlotNames = [];
var lastSlot = -1;
function ensureEnoughSlotNames(currentSlot) {
  if (currentSlot === lastSlot) {
    lastSlot += 5;
    var ii = slotNames.length = versionSlotNames.length = lastSlot + 1;
    for (var i = currentSlot + 1; i < ii; ++i) {
      slotNames[i] = '_observer' + i;
      versionSlotNames[i] = '_observerVersion' + i;
    }
  }
}
ensureEnoughSlotNames(-1);

function addObserver(observer) {
  var observerSlots = this._observerSlots === undefined ? 0 : this._observerSlots;
  var i = observerSlots;
  while (i-- && this[slotNames[i]] !== observer) {}

  if (i === -1) {
    i = 0;
    while (this[slotNames[i]]) {
      i++;
    }
    this[slotNames[i]] = observer;
    observer.subscribe(sourceContext, this);

    if (i === observerSlots) {
      this._observerSlots = i + 1;
    }
  }

  if (this._version === undefined) {
    this._version = 0;
  }
  this[versionSlotNames[i]] = this._version;
  ensureEnoughSlotNames(i);
}

function observeProperty(obj, propertyName) {
  var observer = this.observerLocator.getObserver(obj, propertyName);
  addObserver.call(this, observer);
}

function observeArray(array) {
  var observer = this.observerLocator.getArrayObserver(array);
  addObserver.call(this, observer);
}

function unobserve(all) {
  var i = this._observerSlots;
  while (i--) {
    if (all || this[versionSlotNames[i]] !== this._version) {
      var observer = this[slotNames[i]];
      this[slotNames[i]] = null;
      if (observer) {
        observer.unsubscribe(sourceContext, this);
      }
    }
  }
}

function connectable() {
  return function (target) {
    target.prototype.observeProperty = observeProperty;
    target.prototype.observeArray = observeArray;
    target.prototype.unobserve = unobserve;
    target.prototype.addObserver = addObserver;
  };
}

var queue = [];
var queued = {};
var nextId = 0;
var minimumImmediate = 100;
var frameBudget = 15;

var isFlushRequested = false;
var immediate = 0;

function flush(animationFrameStart) {
  var length = queue.length;
  var i = 0;
  while (i < length) {
    var binding = queue[i];
    queued[binding.__connectQueueId] = false;
    binding.connect(true);
    i++;

    if (i % 100 === 0 && __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].performance.now() - animationFrameStart > frameBudget) {
      break;
    }
  }
  queue.splice(0, i);

  if (queue.length) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].requestAnimationFrame(flush);
  } else {
    isFlushRequested = false;
    immediate = 0;
  }
}

function enqueueBindingConnect(binding) {
  if (immediate < minimumImmediate) {
    immediate++;
    binding.connect(false);
  } else {
    var id = binding.__connectQueueId;
    if (id === undefined) {
      id = nextId;
      nextId++;
      binding.__connectQueueId = id;
    }

    if (!queued[id]) {
      queue.push(binding);
      queued[id] = true;
    }
  }
  if (!isFlushRequested) {
    isFlushRequested = true;
    __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].requestAnimationFrame(flush);
  }
}

function setConnectQueueThreshold(value) {
  minimumImmediate = value;
}

function enableConnectQueue() {
  setConnectQueueThreshold(100);
}

function disableConnectQueue() {
  setConnectQueueThreshold(Number.MAX_SAFE_INTEGER);
}

function getConnectQueueSize() {
  return queue.length;
}

function addSubscriber(context, callable) {
  if (this.hasSubscriber(context, callable)) {
    return false;
  }
  if (!this._context0) {
    this._context0 = context;
    this._callable0 = callable;
    return true;
  }
  if (!this._context1) {
    this._context1 = context;
    this._callable1 = callable;
    return true;
  }
  if (!this._context2) {
    this._context2 = context;
    this._callable2 = callable;
    return true;
  }
  if (!this._contextsRest) {
    this._contextsRest = [context];
    this._callablesRest = [callable];
    return true;
  }
  this._contextsRest.push(context);
  this._callablesRest.push(callable);
  return true;
}

function removeSubscriber(context, callable) {
  if (this._context0 === context && this._callable0 === callable) {
    this._context0 = null;
    this._callable0 = null;
    return true;
  }
  if (this._context1 === context && this._callable1 === callable) {
    this._context1 = null;
    this._callable1 = null;
    return true;
  }
  if (this._context2 === context && this._callable2 === callable) {
    this._context2 = null;
    this._callable2 = null;
    return true;
  }
  var callables = this._callablesRest;
  if (callables === undefined || callables.length === 0) {
    return false;
  }
  var contexts = this._contextsRest;
  var i = 0;
  while (!(callables[i] === callable && contexts[i] === context) && callables.length > i) {
    i++;
  }
  if (i >= callables.length) {
    return false;
  }
  contexts.splice(i, 1);
  callables.splice(i, 1);
  return true;
}

var arrayPool1 = [];
var arrayPool2 = [];
var poolUtilization = [];

function callSubscribers(newValue, oldValue) {
  var context0 = this._context0;
  var callable0 = this._callable0;
  var context1 = this._context1;
  var callable1 = this._callable1;
  var context2 = this._context2;
  var callable2 = this._callable2;
  var length = this._contextsRest ? this._contextsRest.length : 0;
  var contextsRest = void 0;
  var callablesRest = void 0;
  var poolIndex = void 0;
  var i = void 0;
  if (length) {
    poolIndex = poolUtilization.length;
    while (poolIndex-- && poolUtilization[poolIndex]) {}
    if (poolIndex < 0) {
      poolIndex = poolUtilization.length;
      contextsRest = [];
      callablesRest = [];
      poolUtilization.push(true);
      arrayPool1.push(contextsRest);
      arrayPool2.push(callablesRest);
    } else {
      poolUtilization[poolIndex] = true;
      contextsRest = arrayPool1[poolIndex];
      callablesRest = arrayPool2[poolIndex];
    }

    i = length;
    while (i--) {
      contextsRest[i] = this._contextsRest[i];
      callablesRest[i] = this._callablesRest[i];
    }
  }

  if (context0) {
    if (callable0) {
      callable0.call(context0, newValue, oldValue);
    } else {
      context0(newValue, oldValue);
    }
  }
  if (context1) {
    if (callable1) {
      callable1.call(context1, newValue, oldValue);
    } else {
      context1(newValue, oldValue);
    }
  }
  if (context2) {
    if (callable2) {
      callable2.call(context2, newValue, oldValue);
    } else {
      context2(newValue, oldValue);
    }
  }
  if (length) {
    for (i = 0; i < length; i++) {
      var callable = callablesRest[i];
      var context = contextsRest[i];
      if (callable) {
        callable.call(context, newValue, oldValue);
      } else {
        context(newValue, oldValue);
      }
      contextsRest[i] = null;
      callablesRest[i] = null;
    }
    poolUtilization[poolIndex] = false;
  }
}

function hasSubscribers() {
  return !!(this._context0 || this._context1 || this._context2 || this._contextsRest && this._contextsRest.length);
}

function hasSubscriber(context, callable) {
  var has = this._context0 === context && this._callable0 === callable || this._context1 === context && this._callable1 === callable || this._context2 === context && this._callable2 === callable;
  if (has) {
    return true;
  }
  var index = void 0;
  var contexts = this._contextsRest;
  if (!contexts || (index = contexts.length) === 0) {
    return false;
  }
  var callables = this._callablesRest;
  while (index--) {
    if (contexts[index] === context && callables[index] === callable) {
      return true;
    }
  }
  return false;
}

function subscriberCollection() {
  return function (target) {
    target.prototype.addSubscriber = addSubscriber;
    target.prototype.removeSubscriber = removeSubscriber;
    target.prototype.callSubscribers = callSubscribers;
    target.prototype.hasSubscribers = hasSubscribers;
    target.prototype.hasSubscriber = hasSubscriber;
  };
}

var ExpressionObserver = (_dec = connectable(), _dec2 = subscriberCollection(), _dec(_class = _dec2(_class = function () {
  function ExpressionObserver(scope, expression, observerLocator, lookupFunctions) {
    

    this.scope = scope;
    this.expression = expression;
    this.observerLocator = observerLocator;
    this.lookupFunctions = lookupFunctions;
  }

  ExpressionObserver.prototype.getValue = function getValue() {
    return this.expression.evaluate(this.scope, this.lookupFunctions);
  };

  ExpressionObserver.prototype.setValue = function setValue(newValue) {
    this.expression.assign(this.scope, newValue);
  };

  ExpressionObserver.prototype.subscribe = function subscribe(context, callable) {
    var _this = this;

    if (!this.hasSubscribers()) {
      this.oldValue = this.expression.evaluate(this.scope, this.lookupFunctions);
      this.expression.connect(this, this.scope);
    }
    this.addSubscriber(context, callable);
    if (arguments.length === 1 && context instanceof Function) {
      return {
        dispose: function dispose() {
          _this.unsubscribe(context, callable);
        }
      };
    }
  };

  ExpressionObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.unobserve(true);
      this.oldValue = undefined;
    }
  };

  ExpressionObserver.prototype.call = function call() {
    var newValue = this.expression.evaluate(this.scope, this.lookupFunctions);
    var oldValue = this.oldValue;
    if (newValue !== oldValue) {
      this.oldValue = newValue;
      this.callSubscribers(newValue, oldValue);
    }
    this._version++;
    this.expression.connect(this, this.scope);
    this.unobserve(false);
  };

  return ExpressionObserver;
}()) || _class) || _class);

function isIndex(s) {
  return +s === s >>> 0;
}

function toNumber(s) {
  return +s;
}

function newSplice(index, removed, addedCount) {
  return {
    index: index,
    removed: removed,
    addedCount: addedCount
  };
}

var EDIT_LEAVE = 0;
var EDIT_UPDATE = 1;
var EDIT_ADD = 2;
var EDIT_DELETE = 3;

function ArraySplice() {}

ArraySplice.prototype = {
  calcEditDistances: function calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd) {
    var rowCount = oldEnd - oldStart + 1;
    var columnCount = currentEnd - currentStart + 1;
    var distances = new Array(rowCount);
    var north = void 0;
    var west = void 0;

    for (var i = 0; i < rowCount; ++i) {
      distances[i] = new Array(columnCount);
      distances[i][0] = i;
    }

    for (var j = 0; j < columnCount; ++j) {
      distances[0][j] = j;
    }

    for (var _i = 1; _i < rowCount; ++_i) {
      for (var _j = 1; _j < columnCount; ++_j) {
        if (this.equals(current[currentStart + _j - 1], old[oldStart + _i - 1])) {
          distances[_i][_j] = distances[_i - 1][_j - 1];
        } else {
          north = distances[_i - 1][_j] + 1;
          west = distances[_i][_j - 1] + 1;
          distances[_i][_j] = north < west ? north : west;
        }
      }
    }

    return distances;
  },

  spliceOperationsFromEditDistances: function spliceOperationsFromEditDistances(distances) {
    var i = distances.length - 1;
    var j = distances[0].length - 1;
    var current = distances[i][j];
    var edits = [];
    while (i > 0 || j > 0) {
      if (i === 0) {
        edits.push(EDIT_ADD);
        j--;
        continue;
      }
      if (j === 0) {
        edits.push(EDIT_DELETE);
        i--;
        continue;
      }
      var northWest = distances[i - 1][j - 1];
      var west = distances[i - 1][j];
      var north = distances[i][j - 1];

      var min = void 0;
      if (west < north) {
        min = west < northWest ? west : northWest;
      } else {
        min = north < northWest ? north : northWest;
      }

      if (min === northWest) {
        if (northWest === current) {
          edits.push(EDIT_LEAVE);
        } else {
          edits.push(EDIT_UPDATE);
          current = northWest;
        }
        i--;
        j--;
      } else if (min === west) {
        edits.push(EDIT_DELETE);
        i--;
        current = west;
      } else {
        edits.push(EDIT_ADD);
        j--;
        current = north;
      }
    }

    edits.reverse();
    return edits;
  },

  calcSplices: function calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd) {
    var prefixCount = 0;
    var suffixCount = 0;

    var minLength = Math.min(currentEnd - currentStart, oldEnd - oldStart);
    if (currentStart === 0 && oldStart === 0) {
      prefixCount = this.sharedPrefix(current, old, minLength);
    }

    if (currentEnd === current.length && oldEnd === old.length) {
      suffixCount = this.sharedSuffix(current, old, minLength - prefixCount);
    }

    currentStart += prefixCount;
    oldStart += prefixCount;
    currentEnd -= suffixCount;
    oldEnd -= suffixCount;

    if (currentEnd - currentStart === 0 && oldEnd - oldStart === 0) {
      return [];
    }

    if (currentStart === currentEnd) {
      var _splice = newSplice(currentStart, [], 0);
      while (oldStart < oldEnd) {
        _splice.removed.push(old[oldStart++]);
      }

      return [_splice];
    } else if (oldStart === oldEnd) {
      return [newSplice(currentStart, [], currentEnd - currentStart)];
    }

    var ops = this.spliceOperationsFromEditDistances(this.calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd));

    var splice = undefined;
    var splices = [];
    var index = currentStart;
    var oldIndex = oldStart;
    for (var i = 0; i < ops.length; ++i) {
      switch (ops[i]) {
        case EDIT_LEAVE:
          if (splice) {
            splices.push(splice);
            splice = undefined;
          }

          index++;
          oldIndex++;
          break;
        case EDIT_UPDATE:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.addedCount++;
          index++;

          splice.removed.push(old[oldIndex]);
          oldIndex++;
          break;
        case EDIT_ADD:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.addedCount++;
          index++;
          break;
        case EDIT_DELETE:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.removed.push(old[oldIndex]);
          oldIndex++;
          break;
      }
    }

    if (splice) {
      splices.push(splice);
    }
    return splices;
  },

  sharedPrefix: function sharedPrefix(current, old, searchLength) {
    for (var i = 0; i < searchLength; ++i) {
      if (!this.equals(current[i], old[i])) {
        return i;
      }
    }

    return searchLength;
  },

  sharedSuffix: function sharedSuffix(current, old, searchLength) {
    var index1 = current.length;
    var index2 = old.length;
    var count = 0;
    while (count < searchLength && this.equals(current[--index1], old[--index2])) {
      count++;
    }

    return count;
  },

  calculateSplices: function calculateSplices(current, previous) {
    return this.calcSplices(current, 0, current.length, previous, 0, previous.length);
  },

  equals: function equals(currentValue, previousValue) {
    return currentValue === previousValue;
  }
};

var arraySplice = new ArraySplice();

function calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd) {
  return arraySplice.calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd);
}

function intersect(start1, end1, start2, end2) {
  if (end1 < start2 || end2 < start1) {
    return -1;
  }

  if (end1 === start2 || end2 === start1) {
    return 0;
  }

  if (start1 < start2) {
    if (end1 < end2) {
      return end1 - start2;
    }

    return end2 - start2;
  }

  if (end2 < end1) {
    return end2 - start1;
  }

  return end1 - start1;
}

function mergeSplice(splices, index, removed, addedCount) {
  var splice = newSplice(index, removed, addedCount);

  var inserted = false;
  var insertionOffset = 0;

  for (var i = 0; i < splices.length; i++) {
    var current = splices[i];
    current.index += insertionOffset;

    if (inserted) {
      continue;
    }

    var intersectCount = intersect(splice.index, splice.index + splice.removed.length, current.index, current.index + current.addedCount);

    if (intersectCount >= 0) {

      splices.splice(i, 1);
      i--;

      insertionOffset -= current.addedCount - current.removed.length;

      splice.addedCount += current.addedCount - intersectCount;
      var deleteCount = splice.removed.length + current.removed.length - intersectCount;

      if (!splice.addedCount && !deleteCount) {
        inserted = true;
      } else {
        var currentRemoved = current.removed;

        if (splice.index < current.index) {
          var prepend = splice.removed.slice(0, current.index - splice.index);
          Array.prototype.push.apply(prepend, currentRemoved);
          currentRemoved = prepend;
        }

        if (splice.index + splice.removed.length > current.index + current.addedCount) {
          var append = splice.removed.slice(current.index + current.addedCount - splice.index);
          Array.prototype.push.apply(currentRemoved, append);
        }

        splice.removed = currentRemoved;
        if (current.index < splice.index) {
          splice.index = current.index;
        }
      }
    } else if (splice.index < current.index) {

      inserted = true;

      splices.splice(i, 0, splice);
      i++;

      var offset = splice.addedCount - splice.removed.length;
      current.index += offset;
      insertionOffset += offset;
    }
  }

  if (!inserted) {
    splices.push(splice);
  }
}

function createInitialSplices(array, changeRecords) {
  var splices = [];

  for (var i = 0; i < changeRecords.length; i++) {
    var record = changeRecords[i];
    switch (record.type) {
      case 'splice':
        mergeSplice(splices, record.index, record.removed.slice(), record.addedCount);
        break;
      case 'add':
      case 'update':
      case 'delete':
        if (!isIndex(record.name)) {
          continue;
        }

        var index = toNumber(record.name);
        if (index < 0) {
          continue;
        }

        mergeSplice(splices, index, [record.oldValue], record.type === 'delete' ? 0 : 1);
        break;
      default:
        console.error('Unexpected record type: ' + JSON.stringify(record));
        break;
    }
  }

  return splices;
}

function projectArraySplices(array, changeRecords) {
  var splices = [];

  createInitialSplices(array, changeRecords).forEach(function (splice) {
    if (splice.addedCount === 1 && splice.removed.length === 1) {
      if (splice.removed[0] !== array[splice.index]) {
        splices.push(splice);
      }

      return;
    }

    splices = splices.concat(calcSplices(array, splice.index, splice.index + splice.addedCount, splice.removed, 0, splice.removed.length));
  });

  return splices;
}

function newRecord(type, object, key, oldValue) {
  return {
    type: type,
    object: object,
    key: key,
    oldValue: oldValue
  };
}

function getChangeRecords(map) {
  var entries = new Array(map.size);
  var keys = map.keys();
  var i = 0;
  var item = void 0;

  while (item = keys.next()) {
    if (item.done) {
      break;
    }

    entries[i] = newRecord('added', map, item.value);
    i++;
  }

  return entries;
}

var ModifyCollectionObserver = (_dec3 = subscriberCollection(), _dec3(_class2 = function () {
  function ModifyCollectionObserver(taskQueue, collection) {
    

    this.taskQueue = taskQueue;
    this.queued = false;
    this.changeRecords = null;
    this.oldCollection = null;
    this.collection = collection;
    this.lengthPropertyName = collection instanceof Map || collection instanceof Set ? 'size' : 'length';
  }

  ModifyCollectionObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  ModifyCollectionObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  ModifyCollectionObserver.prototype.addChangeRecord = function addChangeRecord(changeRecord) {
    if (!this.hasSubscribers() && !this.lengthObserver) {
      return;
    }

    if (changeRecord.type === 'splice') {
      var index = changeRecord.index;
      var arrayLength = changeRecord.object.length;
      if (index > arrayLength) {
        index = arrayLength - changeRecord.addedCount;
      } else if (index < 0) {
        index = arrayLength + changeRecord.removed.length + index - changeRecord.addedCount;
      }
      if (index < 0) {
        index = 0;
      }
      changeRecord.index = index;
    }

    if (this.changeRecords === null) {
      this.changeRecords = [changeRecord];
    } else {
      this.changeRecords.push(changeRecord);
    }

    if (!this.queued) {
      this.queued = true;
      this.taskQueue.queueMicroTask(this);
    }
  };

  ModifyCollectionObserver.prototype.flushChangeRecords = function flushChangeRecords() {
    if (this.changeRecords && this.changeRecords.length || this.oldCollection) {
      this.call();
    }
  };

  ModifyCollectionObserver.prototype.reset = function reset(oldCollection) {
    this.oldCollection = oldCollection;

    if (this.hasSubscribers() && !this.queued) {
      this.queued = true;
      this.taskQueue.queueMicroTask(this);
    }
  };

  ModifyCollectionObserver.prototype.getLengthObserver = function getLengthObserver() {
    return this.lengthObserver || (this.lengthObserver = new CollectionLengthObserver(this.collection));
  };

  ModifyCollectionObserver.prototype.call = function call() {
    var changeRecords = this.changeRecords;
    var oldCollection = this.oldCollection;
    var records = void 0;

    this.queued = false;
    this.changeRecords = [];
    this.oldCollection = null;

    if (this.hasSubscribers()) {
      if (oldCollection) {
        if (this.collection instanceof Map || this.collection instanceof Set) {
          records = getChangeRecords(oldCollection);
        } else {
          records = calcSplices(this.collection, 0, this.collection.length, oldCollection, 0, oldCollection.length);
        }
      } else {
        if (this.collection instanceof Map || this.collection instanceof Set) {
          records = changeRecords;
        } else {
          records = projectArraySplices(this.collection, changeRecords);
        }
      }

      this.callSubscribers(records);
    }

    if (this.lengthObserver) {
      this.lengthObserver.call(this.collection[this.lengthPropertyName]);
    }
  };

  return ModifyCollectionObserver;
}()) || _class2);

var CollectionLengthObserver = (_dec4 = subscriberCollection(), _dec4(_class3 = function () {
  function CollectionLengthObserver(collection) {
    

    this.collection = collection;
    this.lengthPropertyName = collection instanceof Map || collection instanceof Set ? 'size' : 'length';
    this.currentValue = collection[this.lengthPropertyName];
  }

  CollectionLengthObserver.prototype.getValue = function getValue() {
    return this.collection[this.lengthPropertyName];
  };

  CollectionLengthObserver.prototype.setValue = function setValue(newValue) {
    this.collection[this.lengthPropertyName] = newValue;
  };

  CollectionLengthObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  CollectionLengthObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  CollectionLengthObserver.prototype.call = function call(newValue) {
    var oldValue = this.currentValue;
    this.callSubscribers(newValue, oldValue);
    this.currentValue = newValue;
  };

  return CollectionLengthObserver;
}()) || _class3);

var arrayProto = Array.prototype;
var pop = arrayProto.pop;
var push = arrayProto.push;
var reverse = arrayProto.reverse;
var shift = arrayProto.shift;
var sort = arrayProto.sort;
var splice = arrayProto.splice;
var unshift = arrayProto.unshift;

if (arrayProto.__au_patched__) {
  __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('array-observation').warn('Detected 2nd attempt of patching array from Aurelia binding.' + ' This is probably caused by dependency mismatch between core modules and a 3rd party plugin.' + ' Please see https://github.com/aurelia/cli/pull/906 if you are using webpack.');
} else {
  Reflect.defineProperty(arrayProto, '__au_patched__', { value: 1 });
  arrayProto.pop = function () {
    var notEmpty = this.length > 0;
    var methodCallResult = pop.apply(this, arguments);
    if (notEmpty && this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'delete',
        object: this,
        name: this.length,
        oldValue: methodCallResult
      });
    }
    return methodCallResult;
  };

  arrayProto.push = function () {
    var methodCallResult = push.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'splice',
        object: this,
        index: this.length - arguments.length,
        removed: [],
        addedCount: arguments.length
      });
    }
    return methodCallResult;
  };

  arrayProto.reverse = function () {
    var oldArray = void 0;
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.flushChangeRecords();
      oldArray = this.slice();
    }
    var methodCallResult = reverse.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.reset(oldArray);
    }
    return methodCallResult;
  };

  arrayProto.shift = function () {
    var notEmpty = this.length > 0;
    var methodCallResult = shift.apply(this, arguments);
    if (notEmpty && this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'delete',
        object: this,
        name: 0,
        oldValue: methodCallResult
      });
    }
    return methodCallResult;
  };

  arrayProto.sort = function () {
    var oldArray = void 0;
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.flushChangeRecords();
      oldArray = this.slice();
    }
    var methodCallResult = sort.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.reset(oldArray);
    }
    return methodCallResult;
  };

  arrayProto.splice = function () {
    var methodCallResult = splice.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'splice',
        object: this,
        index: +arguments[0],
        removed: methodCallResult,
        addedCount: arguments.length > 2 ? arguments.length - 2 : 0
      });
    }
    return methodCallResult;
  };

  arrayProto.unshift = function () {
    var methodCallResult = unshift.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'splice',
        object: this,
        index: 0,
        removed: [],
        addedCount: arguments.length
      });
    }
    return methodCallResult;
  };
}

function _getArrayObserver(taskQueue, array) {
  return ModifyArrayObserver.for(taskQueue, array);
}

var ModifyArrayObserver = function (_ModifyCollectionObse) {
  _inherits(ModifyArrayObserver, _ModifyCollectionObse);

  function ModifyArrayObserver(taskQueue, array) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse.call(this, taskQueue, array));
  }

  ModifyArrayObserver.for = function _for(taskQueue, array) {
    if (!('__array_observer__' in array)) {
      Reflect.defineProperty(array, '__array_observer__', {
        value: ModifyArrayObserver.create(taskQueue, array),
        enumerable: false, configurable: false
      });
    }
    return array.__array_observer__;
  };

  ModifyArrayObserver.create = function create(taskQueue, array) {
    return new ModifyArrayObserver(taskQueue, array);
  };

  return ModifyArrayObserver;
}(ModifyCollectionObserver);

var Expression = function () {
  function Expression() {
    

    this.isAssignable = false;
  }

  Expression.prototype.evaluate = function evaluate(scope, lookupFunctions, args) {
    throw new Error('Binding expression "' + this + '" cannot be evaluated.');
  };

  Expression.prototype.assign = function assign(scope, value, lookupFunctions) {
    throw new Error('Binding expression "' + this + '" cannot be assigned to.');
  };

  Expression.prototype.toString = function toString() {
    return typeof FEATURE_NO_UNPARSER === 'undefined' ? _Unparser.unparse(this) : Function.prototype.toString.call(this);
  };

  return Expression;
}();

var BindingBehavior = function (_Expression) {
  _inherits(BindingBehavior, _Expression);

  function BindingBehavior(expression, name, args) {
    

    var _this3 = _possibleConstructorReturn(this, _Expression.call(this));

    _this3.expression = expression;
    _this3.name = name;
    _this3.args = args;
    return _this3;
  }

  BindingBehavior.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.expression.evaluate(scope, lookupFunctions);
  };

  BindingBehavior.prototype.assign = function assign(scope, value, lookupFunctions) {
    return this.expression.assign(scope, value, lookupFunctions);
  };

  BindingBehavior.prototype.accept = function accept(visitor) {
    return visitor.visitBindingBehavior(this);
  };

  BindingBehavior.prototype.connect = function connect(binding, scope) {
    this.expression.connect(binding, scope);
  };

  BindingBehavior.prototype.bind = function bind(binding, scope, lookupFunctions) {
    if (this.expression.expression && this.expression.bind) {
      this.expression.bind(binding, scope, lookupFunctions);
    }
    var behavior = lookupFunctions.bindingBehaviors(this.name);
    if (!behavior) {
      throw new Error('No BindingBehavior named "' + this.name + '" was found!');
    }
    var behaviorKey = 'behavior-' + this.name;
    if (binding[behaviorKey]) {
      throw new Error('A binding behavior named "' + this.name + '" has already been applied to "' + this.expression + '"');
    }
    binding[behaviorKey] = behavior;
    behavior.bind.apply(behavior, [binding, scope].concat(evalList(scope, this.args, binding.lookupFunctions)));
  };

  BindingBehavior.prototype.unbind = function unbind(binding, scope) {
    var behaviorKey = 'behavior-' + this.name;
    binding[behaviorKey].unbind(binding, scope);
    binding[behaviorKey] = null;
    if (this.expression.expression && this.expression.unbind) {
      this.expression.unbind(binding, scope);
    }
  };

  return BindingBehavior;
}(Expression);

var ValueConverter = function (_Expression2) {
  _inherits(ValueConverter, _Expression2);

  function ValueConverter(expression, name, args) {
    

    var _this4 = _possibleConstructorReturn(this, _Expression2.call(this));

    _this4.expression = expression;
    _this4.name = name;
    _this4.args = args;
    _this4.allArgs = [expression].concat(args);
    return _this4;
  }

  ValueConverter.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var converter = lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }

    if ('toView' in converter) {
      return converter.toView.apply(converter, evalList(scope, this.allArgs, lookupFunctions));
    }

    return this.allArgs[0].evaluate(scope, lookupFunctions);
  };

  ValueConverter.prototype.assign = function assign(scope, value, lookupFunctions) {
    var converter = lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }

    if ('fromView' in converter) {
      value = converter.fromView.apply(converter, [value].concat(evalList(scope, this.args, lookupFunctions)));
    }

    return this.allArgs[0].assign(scope, value, lookupFunctions);
  };

  ValueConverter.prototype.accept = function accept(visitor) {
    return visitor.visitValueConverter(this);
  };

  ValueConverter.prototype.connect = function connect(binding, scope) {
    var expressions = this.allArgs;
    var i = expressions.length;
    while (i--) {
      expressions[i].connect(binding, scope);
    }
    var converter = binding.lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }
    var signals = converter.signals;
    if (signals === undefined) {
      return;
    }
    i = signals.length;
    while (i--) {
      connectBindingToSignal(binding, signals[i]);
    }
  };

  return ValueConverter;
}(Expression);

var Assign = function (_Expression3) {
  _inherits(Assign, _Expression3);

  function Assign(target, value) {
    

    var _this5 = _possibleConstructorReturn(this, _Expression3.call(this));

    _this5.target = target;
    _this5.value = value;
    _this5.isAssignable = true;
    return _this5;
  }

  Assign.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.target.assign(scope, this.value.evaluate(scope, lookupFunctions));
  };

  Assign.prototype.accept = function accept(vistor) {
    vistor.visitAssign(this);
  };

  Assign.prototype.connect = function connect(binding, scope) {};

  Assign.prototype.assign = function assign(scope, value) {
    this.value.assign(scope, value);
    this.target.assign(scope, value);
  };

  return Assign;
}(Expression);

var Conditional = function (_Expression4) {
  _inherits(Conditional, _Expression4);

  function Conditional(condition, yes, no) {
    

    var _this6 = _possibleConstructorReturn(this, _Expression4.call(this));

    _this6.condition = condition;
    _this6.yes = yes;
    _this6.no = no;
    return _this6;
  }

  Conditional.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return !!this.condition.evaluate(scope, lookupFunctions) ? this.yes.evaluate(scope, lookupFunctions) : this.no.evaluate(scope, lookupFunctions);
  };

  Conditional.prototype.accept = function accept(visitor) {
    return visitor.visitConditional(this);
  };

  Conditional.prototype.connect = function connect(binding, scope) {
    this.condition.connect(binding, scope);
    if (this.condition.evaluate(scope)) {
      this.yes.connect(binding, scope);
    } else {
      this.no.connect(binding, scope);
    }
  };

  return Conditional;
}(Expression);

var AccessThis = function (_Expression5) {
  _inherits(AccessThis, _Expression5);

  function AccessThis(ancestor) {
    

    var _this7 = _possibleConstructorReturn(this, _Expression5.call(this));

    _this7.ancestor = ancestor;
    return _this7;
  }

  AccessThis.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var oc = scope.overrideContext;
    var i = this.ancestor;
    while (i-- && oc) {
      oc = oc.parentOverrideContext;
    }
    return i < 1 && oc ? oc.bindingContext : undefined;
  };

  AccessThis.prototype.accept = function accept(visitor) {
    return visitor.visitAccessThis(this);
  };

  AccessThis.prototype.connect = function connect(binding, scope) {};

  return AccessThis;
}(Expression);

var AccessScope = function (_Expression6) {
  _inherits(AccessScope, _Expression6);

  function AccessScope(name, ancestor) {
    

    var _this8 = _possibleConstructorReturn(this, _Expression6.call(this));

    _this8.name = name;
    _this8.ancestor = ancestor;
    _this8.isAssignable = true;
    return _this8;
  }

  AccessScope.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var context = getContextFor(this.name, scope, this.ancestor);
    return context[this.name];
  };

  AccessScope.prototype.assign = function assign(scope, value) {
    var context = getContextFor(this.name, scope, this.ancestor);
    return context ? context[this.name] = value : undefined;
  };

  AccessScope.prototype.accept = function accept(visitor) {
    return visitor.visitAccessScope(this);
  };

  AccessScope.prototype.connect = function connect(binding, scope) {
    var context = getContextFor(this.name, scope, this.ancestor);
    binding.observeProperty(context, this.name);
  };

  return AccessScope;
}(Expression);

var AccessMember = function (_Expression7) {
  _inherits(AccessMember, _Expression7);

  function AccessMember(object, name) {
    

    var _this9 = _possibleConstructorReturn(this, _Expression7.call(this));

    _this9.object = object;
    _this9.name = name;
    _this9.isAssignable = true;
    return _this9;
  }

  AccessMember.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    return instance === null || instance === undefined ? instance : instance[this.name];
  };

  AccessMember.prototype.assign = function assign(scope, value) {
    var instance = this.object.evaluate(scope);

    if (instance === null || instance === undefined) {
      instance = {};
      this.object.assign(scope, instance);
    }

    instance[this.name] = value;
    return value;
  };

  AccessMember.prototype.accept = function accept(visitor) {
    return visitor.visitAccessMember(this);
  };

  AccessMember.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (obj) {
      binding.observeProperty(obj, this.name);
    }
  };

  return AccessMember;
}(Expression);

var AccessKeyed = function (_Expression8) {
  _inherits(AccessKeyed, _Expression8);

  function AccessKeyed(object, key) {
    

    var _this10 = _possibleConstructorReturn(this, _Expression8.call(this));

    _this10.object = object;
    _this10.key = key;
    _this10.isAssignable = true;
    return _this10;
  }

  AccessKeyed.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    var lookup = this.key.evaluate(scope, lookupFunctions);
    return getKeyed(instance, lookup);
  };

  AccessKeyed.prototype.assign = function assign(scope, value) {
    var instance = this.object.evaluate(scope);
    var lookup = this.key.evaluate(scope);
    return setKeyed(instance, lookup, value);
  };

  AccessKeyed.prototype.accept = function accept(visitor) {
    return visitor.visitAccessKeyed(this);
  };

  AccessKeyed.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (obj instanceof Object) {
      this.key.connect(binding, scope);
      var key = this.key.evaluate(scope);

      if (key !== null && key !== undefined && !(Array.isArray(obj) && typeof key === 'number')) {
        binding.observeProperty(obj, key);
      }
    }
  };

  return AccessKeyed;
}(Expression);

var CallScope = function (_Expression9) {
  _inherits(CallScope, _Expression9);

  function CallScope(name, args, ancestor) {
    

    var _this11 = _possibleConstructorReturn(this, _Expression9.call(this));

    _this11.name = name;
    _this11.args = args;
    _this11.ancestor = ancestor;
    return _this11;
  }

  CallScope.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var args = evalList(scope, this.args, lookupFunctions);
    var context = getContextFor(this.name, scope, this.ancestor);
    var func = getFunction(context, this.name, mustEvaluate);
    if (func) {
      return func.apply(context, args);
    }
    return undefined;
  };

  CallScope.prototype.accept = function accept(visitor) {
    return visitor.visitCallScope(this);
  };

  CallScope.prototype.connect = function connect(binding, scope) {
    var args = this.args;
    var i = args.length;
    while (i--) {
      args[i].connect(binding, scope);
    }
  };

  return CallScope;
}(Expression);

var CallMember = function (_Expression10) {
  _inherits(CallMember, _Expression10);

  function CallMember(object, name, args) {
    

    var _this12 = _possibleConstructorReturn(this, _Expression10.call(this));

    _this12.object = object;
    _this12.name = name;
    _this12.args = args;
    return _this12;
  }

  CallMember.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    var args = evalList(scope, this.args, lookupFunctions);
    var func = getFunction(instance, this.name, mustEvaluate);
    if (func) {
      return func.apply(instance, args);
    }
    return undefined;
  };

  CallMember.prototype.accept = function accept(visitor) {
    return visitor.visitCallMember(this);
  };

  CallMember.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (getFunction(obj, this.name, false)) {
      var args = this.args;
      var i = args.length;
      while (i--) {
        args[i].connect(binding, scope);
      }
    }
  };

  return CallMember;
}(Expression);

var CallFunction = function (_Expression11) {
  _inherits(CallFunction, _Expression11);

  function CallFunction(func, args) {
    

    var _this13 = _possibleConstructorReturn(this, _Expression11.call(this));

    _this13.func = func;
    _this13.args = args;
    return _this13;
  }

  CallFunction.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var func = this.func.evaluate(scope, lookupFunctions);
    if (typeof func === 'function') {
      return func.apply(null, evalList(scope, this.args, lookupFunctions));
    }
    if (!mustEvaluate && (func === null || func === undefined)) {
      return undefined;
    }
    throw new Error(this.func + ' is not a function');
  };

  CallFunction.prototype.accept = function accept(visitor) {
    return visitor.visitCallFunction(this);
  };

  CallFunction.prototype.connect = function connect(binding, scope) {
    this.func.connect(binding, scope);
    var func = this.func.evaluate(scope);
    if (typeof func === 'function') {
      var args = this.args;
      var i = args.length;
      while (i--) {
        args[i].connect(binding, scope);
      }
    }
  };

  return CallFunction;
}(Expression);

var Binary = function (_Expression12) {
  _inherits(Binary, _Expression12);

  function Binary(operation, left, right) {
    

    var _this14 = _possibleConstructorReturn(this, _Expression12.call(this));

    _this14.operation = operation;
    _this14.left = left;
    _this14.right = right;
    return _this14;
  }

  Binary.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var left = this.left.evaluate(scope, lookupFunctions);

    switch (this.operation) {
      case '&&':
        return left && this.right.evaluate(scope, lookupFunctions);
      case '||':
        return left || this.right.evaluate(scope, lookupFunctions);
    }

    var right = this.right.evaluate(scope, lookupFunctions);

    switch (this.operation) {
      case '==':
        return left == right;
      case '===':
        return left === right;
      case '!=':
        return left != right;
      case '!==':
        return left !== right;
      case 'instanceof':
        return typeof right === 'function' && left instanceof right;
      case 'in':
        return (typeof right === 'undefined' ? 'undefined' : _typeof(right)) === 'object' && right !== null && left in right;
    }

    if (left === null || right === null || left === undefined || right === undefined) {
      switch (this.operation) {
        case '+':
          if (left !== null && left !== undefined) return left;
          if (right !== null && right !== undefined) return right;
          return 0;
        case '-':
          if (left !== null && left !== undefined) return left;
          if (right !== null && right !== undefined) return 0 - right;
          return 0;
      }

      return null;
    }

    switch (this.operation) {
      case '+':
        return autoConvertAdd(left, right);
      case '-':
        return left - right;
      case '*':
        return left * right;
      case '/':
        return left / right;
      case '%':
        return left % right;
      case '<':
        return left < right;
      case '>':
        return left > right;
      case '<=':
        return left <= right;
      case '>=':
        return left >= right;
      case '^':
        return left ^ right;
    }

    throw new Error('Internal error [' + this.operation + '] not handled');
  };

  Binary.prototype.accept = function accept(visitor) {
    return visitor.visitBinary(this);
  };

  Binary.prototype.connect = function connect(binding, scope) {
    this.left.connect(binding, scope);
    var left = this.left.evaluate(scope);
    if (this.operation === '&&' && !left || this.operation === '||' && left) {
      return;
    }
    this.right.connect(binding, scope);
  };

  return Binary;
}(Expression);

var Unary = function (_Expression13) {
  _inherits(Unary, _Expression13);

  function Unary(operation, expression) {
    

    var _this15 = _possibleConstructorReturn(this, _Expression13.call(this));

    _this15.operation = operation;
    _this15.expression = expression;
    return _this15;
  }

  Unary.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    switch (this.operation) {
      case '!':
        return !this.expression.evaluate(scope, lookupFunctions);
      case 'typeof':
        return _typeof(this.expression.evaluate(scope, lookupFunctions));
      case 'void':
        return void this.expression.evaluate(scope, lookupFunctions);
    }

    throw new Error('Internal error [' + this.operation + '] not handled');
  };

  Unary.prototype.accept = function accept(visitor) {
    return visitor.visitPrefix(this);
  };

  Unary.prototype.connect = function connect(binding, scope) {
    this.expression.connect(binding, scope);
  };

  return Unary;
}(Expression);

var LiteralPrimitive = function (_Expression14) {
  _inherits(LiteralPrimitive, _Expression14);

  function LiteralPrimitive(value) {
    

    var _this16 = _possibleConstructorReturn(this, _Expression14.call(this));

    _this16.value = value;
    return _this16;
  }

  LiteralPrimitive.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.value;
  };

  LiteralPrimitive.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralPrimitive(this);
  };

  LiteralPrimitive.prototype.connect = function connect(binding, scope) {};

  return LiteralPrimitive;
}(Expression);

var LiteralString = function (_Expression15) {
  _inherits(LiteralString, _Expression15);

  function LiteralString(value) {
    

    var _this17 = _possibleConstructorReturn(this, _Expression15.call(this));

    _this17.value = value;
    return _this17;
  }

  LiteralString.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.value;
  };

  LiteralString.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralString(this);
  };

  LiteralString.prototype.connect = function connect(binding, scope) {};

  return LiteralString;
}(Expression);

var LiteralTemplate = function (_Expression16) {
  _inherits(LiteralTemplate, _Expression16);

  function LiteralTemplate(cooked, expressions, raw, tag) {
    

    var _this18 = _possibleConstructorReturn(this, _Expression16.call(this));

    _this18.cooked = cooked;
    _this18.expressions = expressions || [];
    _this18.length = _this18.expressions.length;
    _this18.tagged = tag !== undefined;
    if (_this18.tagged) {
      _this18.cooked.raw = raw;
      _this18.tag = tag;
      if (tag instanceof AccessScope) {
        _this18.contextType = 'Scope';
      } else if (tag instanceof AccessMember || tag instanceof AccessKeyed) {
        _this18.contextType = 'Object';
      } else {
        throw new Error(_this18.tag + ' is not a valid template tag');
      }
    }
    return _this18;
  }

  LiteralTemplate.prototype.getScopeContext = function getScopeContext(scope, lookupFunctions) {
    return getContextFor(this.tag.name, scope, this.tag.ancestor);
  };

  LiteralTemplate.prototype.getObjectContext = function getObjectContext(scope, lookupFunctions) {
    return this.tag.object.evaluate(scope, lookupFunctions);
  };

  LiteralTemplate.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var results = new Array(this.length);
    for (var i = 0; i < this.length; i++) {
      results[i] = this.expressions[i].evaluate(scope, lookupFunctions);
    }
    if (this.tagged) {
      var func = this.tag.evaluate(scope, lookupFunctions);
      if (typeof func === 'function') {
        var context = this['get' + this.contextType + 'Context'](scope, lookupFunctions);
        return func.call.apply(func, [context, this.cooked].concat(results));
      }
      if (!mustEvaluate) {
        return null;
      }
      throw new Error(this.tag + ' is not a function');
    }
    var result = this.cooked[0];
    for (var _i2 = 0; _i2 < this.length; _i2++) {
      result = String.prototype.concat(result, results[_i2], this.cooked[_i2 + 1]);
    }
    return result;
  };

  LiteralTemplate.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralTemplate(this);
  };

  LiteralTemplate.prototype.connect = function connect(binding, scope) {
    for (var i = 0; i < this.length; i++) {
      this.expressions[i].connect(binding, scope);
    }
    if (this.tagged) {
      this.tag.connect(binding, scope);
    }
  };

  return LiteralTemplate;
}(Expression);

var LiteralArray = function (_Expression17) {
  _inherits(LiteralArray, _Expression17);

  function LiteralArray(elements) {
    

    var _this19 = _possibleConstructorReturn(this, _Expression17.call(this));

    _this19.elements = elements;
    return _this19;
  }

  LiteralArray.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var elements = this.elements;
    var result = [];

    for (var i = 0, length = elements.length; i < length; ++i) {
      result[i] = elements[i].evaluate(scope, lookupFunctions);
    }

    return result;
  };

  LiteralArray.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralArray(this);
  };

  LiteralArray.prototype.connect = function connect(binding, scope) {
    var length = this.elements.length;
    for (var i = 0; i < length; i++) {
      this.elements[i].connect(binding, scope);
    }
  };

  return LiteralArray;
}(Expression);

var LiteralObject = function (_Expression18) {
  _inherits(LiteralObject, _Expression18);

  function LiteralObject(keys, values) {
    

    var _this20 = _possibleConstructorReturn(this, _Expression18.call(this));

    _this20.keys = keys;
    _this20.values = values;
    return _this20;
  }

  LiteralObject.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = {};
    var keys = this.keys;
    var values = this.values;

    for (var i = 0, length = keys.length; i < length; ++i) {
      instance[keys[i]] = values[i].evaluate(scope, lookupFunctions);
    }

    return instance;
  };

  LiteralObject.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralObject(this);
  };

  LiteralObject.prototype.connect = function connect(binding, scope) {
    var length = this.keys.length;
    for (var i = 0; i < length; i++) {
      this.values[i].connect(binding, scope);
    }
  };

  return LiteralObject;
}(Expression);

function evalList(scope, list, lookupFunctions) {
  var length = list.length;
  var result = [];
  for (var i = 0; i < length; i++) {
    result[i] = list[i].evaluate(scope, lookupFunctions);
  }
  return result;
}

function autoConvertAdd(a, b) {
  if (a !== null && b !== null) {
    if (typeof a === 'string' && typeof b !== 'string') {
      return a + b.toString();
    }

    if (typeof a !== 'string' && typeof b === 'string') {
      return a.toString() + b;
    }

    return a + b;
  }

  if (a !== null) {
    return a;
  }

  if (b !== null) {
    return b;
  }

  return 0;
}

function getFunction(obj, name, mustExist) {
  var func = obj === null || obj === undefined ? null : obj[name];
  if (typeof func === 'function') {
    return func;
  }
  if (!mustExist && (func === null || func === undefined)) {
    return null;
  }
  throw new Error(name + ' is not a function');
}

function getKeyed(obj, key) {
  if (Array.isArray(obj)) {
    return obj[parseInt(key, 10)];
  } else if (obj) {
    return obj[key];
  } else if (obj === null || obj === undefined) {
    return undefined;
  }

  return obj[key];
}

function setKeyed(obj, key, value) {
  if (Array.isArray(obj)) {
    var index = parseInt(key, 10);

    if (obj.length <= index) {
      obj.length = index + 1;
    }

    obj[index] = value;
  } else {
    obj[key] = value;
  }

  return value;
}

var _Unparser = null;


if (typeof FEATURE_NO_UNPARSER === 'undefined') {
  _Unparser = function () {
    function Unparser(buffer) {
      

      this.buffer = buffer;
    }

    Unparser.unparse = function unparse(expression) {
      var buffer = [];
      var visitor = new _Unparser(buffer);

      expression.accept(visitor);

      return buffer.join('');
    };

    Unparser.prototype.write = function write(text) {
      this.buffer.push(text);
    };

    Unparser.prototype.writeArgs = function writeArgs(args) {
      this.write('(');

      for (var i = 0, length = args.length; i < length; ++i) {
        if (i !== 0) {
          this.write(',');
        }

        args[i].accept(this);
      }

      this.write(')');
    };

    Unparser.prototype.visitBindingBehavior = function visitBindingBehavior(behavior) {
      var args = behavior.args;

      behavior.expression.accept(this);
      this.write('&' + behavior.name);

      for (var i = 0, length = args.length; i < length; ++i) {
        this.write(':');
        args[i].accept(this);
      }
    };

    Unparser.prototype.visitValueConverter = function visitValueConverter(converter) {
      var args = converter.args;

      converter.expression.accept(this);
      this.write('|' + converter.name);

      for (var i = 0, length = args.length; i < length; ++i) {
        this.write(':');
        args[i].accept(this);
      }
    };

    Unparser.prototype.visitAssign = function visitAssign(assign) {
      assign.target.accept(this);
      this.write('=');
      assign.value.accept(this);
    };

    Unparser.prototype.visitConditional = function visitConditional(conditional) {
      conditional.condition.accept(this);
      this.write('?');
      conditional.yes.accept(this);
      this.write(':');
      conditional.no.accept(this);
    };

    Unparser.prototype.visitAccessThis = function visitAccessThis(access) {
      if (access.ancestor === 0) {
        this.write('$this');
        return;
      }
      this.write('$parent');
      var i = access.ancestor - 1;
      while (i--) {
        this.write('.$parent');
      }
    };

    Unparser.prototype.visitAccessScope = function visitAccessScope(access) {
      var i = access.ancestor;
      while (i--) {
        this.write('$parent.');
      }
      this.write(access.name);
    };

    Unparser.prototype.visitAccessMember = function visitAccessMember(access) {
      access.object.accept(this);
      this.write('.' + access.name);
    };

    Unparser.prototype.visitAccessKeyed = function visitAccessKeyed(access) {
      access.object.accept(this);
      this.write('[');
      access.key.accept(this);
      this.write(']');
    };

    Unparser.prototype.visitCallScope = function visitCallScope(call) {
      var i = call.ancestor;
      while (i--) {
        this.write('$parent.');
      }
      this.write(call.name);
      this.writeArgs(call.args);
    };

    Unparser.prototype.visitCallFunction = function visitCallFunction(call) {
      call.func.accept(this);
      this.writeArgs(call.args);
    };

    Unparser.prototype.visitCallMember = function visitCallMember(call) {
      call.object.accept(this);
      this.write('.' + call.name);
      this.writeArgs(call.args);
    };

    Unparser.prototype.visitPrefix = function visitPrefix(prefix) {
      this.write('(' + prefix.operation);
      if (prefix.operation.charCodeAt(0) >= 97) {
        this.write(' ');
      }
      prefix.expression.accept(this);
      this.write(')');
    };

    Unparser.prototype.visitBinary = function visitBinary(binary) {
      binary.left.accept(this);
      if (binary.operation.charCodeAt(0) === 105) {
        this.write(' ' + binary.operation + ' ');
      } else {
        this.write(binary.operation);
      }
      binary.right.accept(this);
    };

    Unparser.prototype.visitLiteralPrimitive = function visitLiteralPrimitive(literal) {
      this.write('' + literal.value);
    };

    Unparser.prototype.visitLiteralArray = function visitLiteralArray(literal) {
      var elements = literal.elements;

      this.write('[');

      for (var i = 0, length = elements.length; i < length; ++i) {
        if (i !== 0) {
          this.write(',');
        }

        elements[i].accept(this);
      }

      this.write(']');
    };

    Unparser.prototype.visitLiteralObject = function visitLiteralObject(literal) {
      var keys = literal.keys;
      var values = literal.values;

      this.write('{');

      for (var i = 0, length = keys.length; i < length; ++i) {
        if (i !== 0) {
          this.write(',');
        }

        this.write('\'' + keys[i] + '\':');
        values[i].accept(this);
      }

      this.write('}');
    };

    Unparser.prototype.visitLiteralString = function visitLiteralString(literal) {
      var escaped = literal.value.replace(/'/g, "\'");
      this.write('\'' + escaped + '\'');
    };

    Unparser.prototype.visitLiteralTemplate = function visitLiteralTemplate(literal) {
      var cooked = literal.cooked,
          expressions = literal.expressions;

      var length = expressions.length;
      this.write('`');
      this.write(cooked[0]);
      for (var i = 0; i < length; i++) {
        expressions[i].accept(this);
        this.write(cooked[i + 1]);
      }
      this.write('`');
    };

    return Unparser;
  }();
}

var ExpressionCloner = function () {
  function ExpressionCloner() {
    
  }

  ExpressionCloner.prototype.cloneExpressionArray = function cloneExpressionArray(array) {
    var clonedArray = [];
    var i = array.length;
    while (i--) {
      clonedArray[i] = array[i].accept(this);
    }
    return clonedArray;
  };

  ExpressionCloner.prototype.visitBindingBehavior = function visitBindingBehavior(behavior) {
    return new BindingBehavior(behavior.expression.accept(this), behavior.name, this.cloneExpressionArray(behavior.args));
  };

  ExpressionCloner.prototype.visitValueConverter = function visitValueConverter(converter) {
    return new ValueConverter(converter.expression.accept(this), converter.name, this.cloneExpressionArray(converter.args));
  };

  ExpressionCloner.prototype.visitAssign = function visitAssign(assign) {
    return new Assign(assign.target.accept(this), assign.value.accept(this));
  };

  ExpressionCloner.prototype.visitConditional = function visitConditional(conditional) {
    return new Conditional(conditional.condition.accept(this), conditional.yes.accept(this), conditional.no.accept(this));
  };

  ExpressionCloner.prototype.visitAccessThis = function visitAccessThis(access) {
    return new AccessThis(access.ancestor);
  };

  ExpressionCloner.prototype.visitAccessScope = function visitAccessScope(access) {
    return new AccessScope(access.name, access.ancestor);
  };

  ExpressionCloner.prototype.visitAccessMember = function visitAccessMember(access) {
    return new AccessMember(access.object.accept(this), access.name);
  };

  ExpressionCloner.prototype.visitAccessKeyed = function visitAccessKeyed(access) {
    return new AccessKeyed(access.object.accept(this), access.key.accept(this));
  };

  ExpressionCloner.prototype.visitCallScope = function visitCallScope(call) {
    return new CallScope(call.name, this.cloneExpressionArray(call.args), call.ancestor);
  };

  ExpressionCloner.prototype.visitCallFunction = function visitCallFunction(call) {
    return new CallFunction(call.func.accept(this), this.cloneExpressionArray(call.args));
  };

  ExpressionCloner.prototype.visitCallMember = function visitCallMember(call) {
    return new CallMember(call.object.accept(this), call.name, this.cloneExpressionArray(call.args));
  };

  ExpressionCloner.prototype.visitUnary = function visitUnary(unary) {
    return new Unary(prefix.operation, prefix.expression.accept(this));
  };

  ExpressionCloner.prototype.visitBinary = function visitBinary(binary) {
    return new Binary(binary.operation, binary.left.accept(this), binary.right.accept(this));
  };

  ExpressionCloner.prototype.visitLiteralPrimitive = function visitLiteralPrimitive(literal) {
    return new LiteralPrimitive(literal);
  };

  ExpressionCloner.prototype.visitLiteralArray = function visitLiteralArray(literal) {
    return new LiteralArray(this.cloneExpressionArray(literal.elements));
  };

  ExpressionCloner.prototype.visitLiteralObject = function visitLiteralObject(literal) {
    return new LiteralObject(literal.keys, this.cloneExpressionArray(literal.values));
  };

  ExpressionCloner.prototype.visitLiteralString = function visitLiteralString(literal) {
    return new LiteralString(literal.value);
  };

  ExpressionCloner.prototype.visitLiteralTemplate = function visitLiteralTemplate(literal) {
    return new LiteralTemplate(literal.cooked, this.cloneExpressionArray(literal.expressions), literal.raw, literal.tag && literal.tag.accept(this));
  };

  return ExpressionCloner;
}();

function cloneExpression(expression) {
  var visitor = new ExpressionCloner();
  return expression.accept(visitor);
}

var bindingMode = {
  oneTime: 0,
  toView: 1,
  oneWay: 1,
  twoWay: 2,
  fromView: 3
};

var Parser = function () {
  function Parser() {
    

    this.cache = Object.create(null);
  }

  Parser.prototype.parse = function parse(src) {
    src = src || '';

    return this.cache[src] || (this.cache[src] = new ParserImplementation(src).parseBindingBehavior());
  };

  return Parser;
}();

var fromCharCode = String.fromCharCode;

var ParserImplementation = function () {
  _createClass(ParserImplementation, [{
    key: 'raw',
    get: function get() {
      return this.src.slice(this.start, this.idx);
    }
  }]);

  function ParserImplementation(src) {
    

    this.idx = 0;

    this.start = 0;

    this.src = src;
    this.len = src.length;

    this.tkn = T$EOF;

    this.val = undefined;

    this.ch = src.charCodeAt(0);
  }

  ParserImplementation.prototype.parseBindingBehavior = function parseBindingBehavior() {
    this.nextToken();
    if (this.tkn & T$ExpressionTerminal) {
      this.err('Invalid start of expression');
    }
    var result = this.parseValueConverter();
    while (this.opt(T$Ampersand)) {
      result = new BindingBehavior(result, this.val, this.parseVariadicArgs());
    }
    if (this.tkn !== T$EOF) {
      this.err('Unconsumed token ' + this.raw);
    }
    return result;
  };

  ParserImplementation.prototype.parseValueConverter = function parseValueConverter() {
    var result = this.parseExpression();
    while (this.opt(T$Bar)) {
      result = new ValueConverter(result, this.val, this.parseVariadicArgs());
    }
    return result;
  };

  ParserImplementation.prototype.parseVariadicArgs = function parseVariadicArgs() {
    this.nextToken();
    var result = [];
    while (this.opt(T$Colon)) {
      result.push(this.parseExpression());
    }
    return result;
  };

  ParserImplementation.prototype.parseExpression = function parseExpression() {
    var exprStart = this.idx;
    var result = this.parseConditional();

    while (this.tkn === T$Eq) {
      if (!result.isAssignable) {
        this.err('Expression ' + this.src.slice(exprStart, this.start) + ' is not assignable');
      }
      this.nextToken();
      exprStart = this.idx;
      result = new Assign(result, this.parseConditional());
    }
    return result;
  };

  ParserImplementation.prototype.parseConditional = function parseConditional() {
    var result = this.parseBinary(0);

    if (this.opt(T$Question)) {
      var yes = this.parseExpression();
      this.expect(T$Colon);
      result = new Conditional(result, yes, this.parseExpression());
    }
    return result;
  };

  ParserImplementation.prototype.parseBinary = function parseBinary(minPrecedence) {
    var left = this.parseLeftHandSide(0);

    while (this.tkn & T$BinaryOp) {
      var opToken = this.tkn;
      if ((opToken & T$Precedence) <= minPrecedence) {
        break;
      }
      this.nextToken();
      left = new Binary(TokenValues[opToken & T$TokenMask], left, this.parseBinary(opToken & T$Precedence));
    }
    return left;
  };

  ParserImplementation.prototype.parseLeftHandSide = function parseLeftHandSide(context) {
    var result = void 0;

    primary: switch (this.tkn) {
      case T$Plus:
        this.nextToken();
        return this.parseLeftHandSide(0);
      case T$Minus:
        this.nextToken();
        return new Binary('-', new LiteralPrimitive(0), this.parseLeftHandSide(0));
      case T$Bang:
      case T$TypeofKeyword:
      case T$VoidKeyword:
        var op = TokenValues[this.tkn & T$TokenMask];
        this.nextToken();
        return new Unary(op, this.parseLeftHandSide(0));
      case T$ParentScope:
        {
          do {
            this.nextToken();
            context++;
            if (this.opt(T$Period)) {
              if (this.tkn === T$Period) {
                this.err();
              }
              continue;
            } else if (this.tkn & T$AccessScopeTerminal) {
              result = new AccessThis(context & C$Ancestor);

              context = context & C$ShorthandProp | C$This;
              break primary;
            } else {
              this.err();
            }
          } while (this.tkn === T$ParentScope);
        }

      case T$Identifier:
        {
          result = new AccessScope(this.val, context & C$Ancestor);
          this.nextToken();
          context = context & C$ShorthandProp | C$Scope;
          break;
        }
      case T$ThisScope:
        this.nextToken();
        result = new AccessThis(0);
        context = context & C$ShorthandProp | C$This;
        break;
      case T$LParen:
        this.nextToken();
        result = this.parseExpression();
        this.expect(T$RParen);
        context = C$Primary;
        break;
      case T$LBracket:
        {
          this.nextToken();
          var _elements = [];
          if (this.tkn !== T$RBracket) {
            do {
              _elements.push(this.parseExpression());
            } while (this.opt(T$Comma));
          }
          this.expect(T$RBracket);
          result = new LiteralArray(_elements);
          context = C$Primary;
          break;
        }
      case T$LBrace:
        {
          var keys = [];
          var values = [];
          this.nextToken();
          while (this.tkn !== T$RBrace) {
            if (this.tkn & T$IdentifierOrKeyword) {
              var ch = this.ch,
                  tkn = this.tkn,
                  idx = this.idx;

              keys.push(this.val);
              this.nextToken();
              if (this.opt(T$Colon)) {
                values.push(this.parseExpression());
              } else {
                this.ch = ch;
                this.tkn = tkn;
                this.idx = idx;
                values.push(this.parseLeftHandSide(C$ShorthandProp));
              }
            } else if (this.tkn & T$Literal) {
              keys.push(this.val);
              this.nextToken();
              this.expect(T$Colon);
              values.push(this.parseExpression());
            } else {
              this.err();
            }
            if (this.tkn !== T$RBrace) {
              this.expect(T$Comma);
            }
          }
          this.expect(T$RBrace);
          result = new LiteralObject(keys, values);
          context = C$Primary;
          break;
        }
      case T$StringLiteral:
        result = new LiteralString(this.val);
        this.nextToken();
        context = C$Primary;
        break;
      case T$TemplateTail:
        result = new LiteralTemplate([this.val]);
        this.nextToken();
        context = C$Primary;
        break;
      case T$TemplateContinuation:
        result = this.parseTemplate(0);
        context = C$Primary;
        break;
      case T$NumericLiteral:
        {
          result = new LiteralPrimitive(this.val);
          this.nextToken();

          break;
        }
      case T$NullKeyword:
      case T$UndefinedKeyword:
      case T$TrueKeyword:
      case T$FalseKeyword:
        result = new LiteralPrimitive(TokenValues[this.tkn & T$TokenMask]);
        this.nextToken();
        context = C$Primary;
        break;
      default:
        if (this.idx >= this.len) {
          this.err('Unexpected end of expression');
        } else {
          this.err();
        }
    }

    if (context & C$ShorthandProp) {
      return result;
    }

    var name = this.val;
    while (this.tkn & T$MemberOrCallExpression) {
      switch (this.tkn) {
        case T$Period:
          this.nextToken();
          if (!(this.tkn & T$IdentifierOrKeyword)) {
            this.err();
          }
          name = this.val;
          this.nextToken();

          context = context & C$Primary | (context & (C$This | C$Scope)) << 1 | context & C$Member | (context & C$Keyed) >> 1 | (context & C$Call) >> 2;
          if (this.tkn === T$LParen) {
            continue;
          }
          if (context & C$Scope) {
            result = new AccessScope(name, result.ancestor);
          } else {
            result = new AccessMember(result, name);
          }
          continue;
        case T$LBracket:
          this.nextToken();
          context = C$Keyed;
          result = new AccessKeyed(result, this.parseExpression());
          this.expect(T$RBracket);
          break;
        case T$LParen:
          this.nextToken();
          var args = [];
          while (this.tkn !== T$RParen) {
            args.push(this.parseExpression());
            if (!this.opt(T$Comma)) {
              break;
            }
          }
          this.expect(T$RParen);
          if (context & C$Scope) {
            result = new CallScope(name, args, result.ancestor);
          } else if (context & (C$Member | C$Primary)) {
            result = new CallMember(result, name, args);
          } else {
            result = new CallFunction(result, args);
          }
          context = C$Call;
          break;
        case T$TemplateTail:
          result = new LiteralTemplate([this.val], [], [this.raw], result);
          this.nextToken();
          break;
        case T$TemplateContinuation:
          result = this.parseTemplate(context | C$Tagged, result);
      }
    }

    return result;
  };

  ParserImplementation.prototype.parseTemplate = function parseTemplate(context, func) {
    var cooked = [this.val];
    var raw = context & C$Tagged ? [this.raw] : undefined;
    this.expect(T$TemplateContinuation);
    var expressions = [this.parseExpression()];

    while ((this.tkn = this.scanTemplateTail()) !== T$TemplateTail) {
      cooked.push(this.val);
      if (context & C$Tagged) {
        raw.push(this.raw);
      }
      this.expect(T$TemplateContinuation);
      expressions.push(this.parseExpression());
    }

    cooked.push(this.val);
    if (context & C$Tagged) {
      raw.push(this.raw);
    }
    this.nextToken();
    return new LiteralTemplate(cooked, expressions, raw, func);
  };

  ParserImplementation.prototype.nextToken = function nextToken() {
    while (this.idx < this.len) {
      if (this.ch <= 0x20) {
        this.next();
        continue;
      }
      this.start = this.idx;
      if (this.ch === 0x24 || this.ch >= 0x61 && this.ch <= 0x7A) {
        this.tkn = this.scanIdentifier();
        return;
      }

      if ((this.tkn = CharScanners[this.ch](this)) !== null) {
        return;
      }
    }
    this.tkn = T$EOF;
  };

  ParserImplementation.prototype.next = function next() {
    return this.ch = this.src.charCodeAt(++this.idx);
  };

  ParserImplementation.prototype.scanIdentifier = function scanIdentifier() {
    while (AsciiIdParts.has(this.next()) || this.ch > 0x7F && IdParts[this.ch]) {}

    return KeywordLookup[this.val = this.raw] || T$Identifier;
  };

  ParserImplementation.prototype.scanNumber = function scanNumber(isFloat) {
    if (isFloat) {
      this.val = 0;
    } else {
      this.val = this.ch - 0x30;
      while (this.next() <= 0x39 && this.ch >= 0x30) {
        this.val = this.val * 10 + this.ch - 0x30;
      }
    }

    if (isFloat || this.ch === 0x2E) {
      if (!isFloat) {
        this.next();
      }
      var start = this.idx;
      var value = this.ch - 0x30;
      while (this.next() <= 0x39 && this.ch >= 0x30) {
        value = value * 10 + this.ch - 0x30;
      }
      this.val = this.val + value / Math.pow(10, this.idx - start);
    }

    if (this.ch === 0x65 || this.ch === 0x45) {
      var _start = this.idx;

      this.next();
      if (this.ch === 0x2D || this.ch === 0x2B) {
        this.next();
      }

      if (!(this.ch >= 0x30 && this.ch <= 0x39)) {
        this.idx = _start;
        this.err('Invalid exponent');
      }
      while (this.next() <= 0x39 && this.ch >= 0x30) {}
      this.val = parseFloat(this.src.slice(this.start, this.idx));
    }

    return T$NumericLiteral;
  };

  ParserImplementation.prototype.scanString = function scanString() {
    var quote = this.ch;
    this.next();

    var buffer = void 0;
    var marker = this.idx;

    while (this.ch !== quote) {
      if (this.ch === 0x5C) {
        if (!buffer) {
          buffer = [];
        }

        buffer.push(this.src.slice(marker, this.idx));

        this.next();

        var _unescaped = void 0;

        if (this.ch === 0x75) {
          this.next();

          if (this.idx + 4 < this.len) {
            var hex = this.src.slice(this.idx, this.idx + 4);

            if (!/[A-Z0-9]{4}/i.test(hex)) {
              this.err('Invalid unicode escape [\\u' + hex + ']');
            }

            _unescaped = parseInt(hex, 16);
            this.idx += 4;
            this.ch = this.src.charCodeAt(this.idx);
          } else {
            this.err();
          }
        } else {
          _unescaped = unescape(this.ch);
          this.next();
        }

        buffer.push(fromCharCode(_unescaped));
        marker = this.idx;
      } else if (this.ch === 0 || this.idx >= this.len) {
        this.err('Unterminated quote');
      } else {
        this.next();
      }
    }

    var last = this.src.slice(marker, this.idx);
    this.next();
    var unescaped = last;

    if (buffer !== null && buffer !== undefined) {
      buffer.push(last);
      unescaped = buffer.join('');
    }

    this.val = unescaped;
    return T$StringLiteral;
  };

  ParserImplementation.prototype.scanTemplate = function scanTemplate() {
    var tail = true;
    var result = '';

    while (this.next() !== 0x60) {
      if (this.ch === 0x24) {
        if (this.idx + 1 < this.len && this.src.charCodeAt(this.idx + 1) === 0x7B) {
          this.idx++;
          tail = false;
          break;
        } else {
          result += '$';
        }
      } else if (this.ch === 0x5C) {
        result += fromCharCode(unescape(this.next()));
      } else if (this.ch === 0 || this.idx >= this.len) {
        this.err('Unterminated template literal');
      } else {
        result += fromCharCode(this.ch);
      }
    }

    this.next();
    this.val = result;
    if (tail) {
      return T$TemplateTail;
    }
    return T$TemplateContinuation;
  };

  ParserImplementation.prototype.scanTemplateTail = function scanTemplateTail() {
    if (this.idx >= this.len) {
      this.err('Unterminated template');
    }
    this.idx--;
    return this.scanTemplate();
  };

  ParserImplementation.prototype.err = function err() {
    var message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Unexpected token ' + this.raw;
    var column = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.start;

    throw new Error('Parser Error: ' + message + ' at column ' + column + ' in expression [' + this.src + ']');
  };

  ParserImplementation.prototype.opt = function opt(token) {
    if (this.tkn === token) {
      this.nextToken();
      return true;
    }

    return false;
  };

  ParserImplementation.prototype.expect = function expect(token) {
    if (this.tkn === token) {
      this.nextToken();
    } else {
      this.err('Missing expected token ' + TokenValues[token & T$TokenMask], this.idx);
    }
  };

  return ParserImplementation;
}();

function unescape(code) {
  switch (code) {
    case 0x66:
      return 0xC;
    case 0x6E:
      return 0xA;
    case 0x72:
      return 0xD;
    case 0x74:
      return 0x9;
    case 0x76:
      return 0xB;
    default:
      return code;
  }
}

var C$This = 1 << 10;
var C$Scope = 1 << 11;
var C$Member = 1 << 12;
var C$Keyed = 1 << 13;
var C$Call = 1 << 14;
var C$Primary = 1 << 15;
var C$ShorthandProp = 1 << 16;
var C$Tagged = 1 << 17;

var C$Ancestor = (1 << 9) - 1;

var T$TokenMask = (1 << 6) - 1;

var T$PrecShift = 6;

var T$Precedence = 7 << T$PrecShift;

var T$ExpressionTerminal = 1 << 11;

var T$ClosingToken = 1 << 12;

var T$OpeningToken = 1 << 13;

var T$AccessScopeTerminal = 1 << 14;
var T$Keyword = 1 << 15;
var T$EOF = 1 << 16 | T$AccessScopeTerminal | T$ExpressionTerminal;
var T$Identifier = 1 << 17;
var T$IdentifierOrKeyword = T$Identifier | T$Keyword;
var T$Literal = 1 << 18;
var T$NumericLiteral = 1 << 19 | T$Literal;
var T$StringLiteral = 1 << 20 | T$Literal;
var T$BinaryOp = 1 << 21;

var T$UnaryOp = 1 << 22;

var T$MemberExpression = 1 << 23;

var T$MemberOrCallExpression = 1 << 24;
var T$TemplateTail = 1 << 25 | T$MemberOrCallExpression;
var T$TemplateContinuation = 1 << 26 | T$MemberOrCallExpression;

var T$FalseKeyword = 0 | T$Keyword | T$Literal;
var T$TrueKeyword = 1 | T$Keyword | T$Literal;
var T$NullKeyword = 2 | T$Keyword | T$Literal;
var T$UndefinedKeyword = 3 | T$Keyword | T$Literal;
var T$ThisScope = 4 | T$IdentifierOrKeyword;
var T$ParentScope = 5 | T$IdentifierOrKeyword;

var T$LParen = 6 | T$OpeningToken | T$AccessScopeTerminal | T$MemberOrCallExpression;
var T$LBrace = 7 | T$OpeningToken;
var T$Period = 8 | T$MemberExpression | T$MemberOrCallExpression;
var T$RBrace = 9 | T$AccessScopeTerminal | T$ClosingToken | T$ExpressionTerminal;
var T$RParen = 10 | T$AccessScopeTerminal | T$ClosingToken | T$ExpressionTerminal;
var T$Comma = 11 | T$AccessScopeTerminal;
var T$LBracket = 12 | T$OpeningToken | T$AccessScopeTerminal | T$MemberExpression | T$MemberOrCallExpression;
var T$RBracket = 13 | T$ClosingToken | T$ExpressionTerminal;
var T$Colon = 14 | T$AccessScopeTerminal;
var T$Question = 15;

var T$Ampersand = 18 | T$AccessScopeTerminal;
var T$Bar = 19 | T$AccessScopeTerminal;
var T$BarBar = 20 | 1 << T$PrecShift | T$BinaryOp;
var T$AmpersandAmpersand = 21 | 2 << T$PrecShift | T$BinaryOp;
var T$Caret = 22 | 3 << T$PrecShift | T$BinaryOp;
var T$EqEq = 23 | 4 << T$PrecShift | T$BinaryOp;
var T$BangEq = 24 | 4 << T$PrecShift | T$BinaryOp;
var T$EqEqEq = 25 | 4 << T$PrecShift | T$BinaryOp;
var T$BangEqEq = 26 | 4 << T$PrecShift | T$BinaryOp;
var T$Lt = 27 | 5 << T$PrecShift | T$BinaryOp;
var T$Gt = 28 | 5 << T$PrecShift | T$BinaryOp;
var T$LtEq = 29 | 5 << T$PrecShift | T$BinaryOp;
var T$GtEq = 30 | 5 << T$PrecShift | T$BinaryOp;
var T$InKeyword = 31 | 5 << T$PrecShift | T$BinaryOp | T$Keyword;
var T$InstanceOfKeyword = 32 | 5 << T$PrecShift | T$BinaryOp | T$Keyword;
var T$Plus = 33 | 6 << T$PrecShift | T$BinaryOp | T$UnaryOp;
var T$Minus = 34 | 6 << T$PrecShift | T$BinaryOp | T$UnaryOp;
var T$TypeofKeyword = 35 | T$UnaryOp | T$Keyword;
var T$VoidKeyword = 36 | T$UnaryOp | T$Keyword;
var T$Star = 37 | 7 << T$PrecShift | T$BinaryOp;
var T$Percent = 38 | 7 << T$PrecShift | T$BinaryOp;
var T$Slash = 39 | 7 << T$PrecShift | T$BinaryOp;
var T$Eq = 40;
var T$Bang = 41 | T$UnaryOp;

var KeywordLookup = Object.create(null);
KeywordLookup.true = T$TrueKeyword;
KeywordLookup.null = T$NullKeyword;
KeywordLookup.false = T$FalseKeyword;
KeywordLookup.undefined = T$UndefinedKeyword;
KeywordLookup.$this = T$ThisScope;
KeywordLookup.$parent = T$ParentScope;
KeywordLookup.in = T$InKeyword;
KeywordLookup.instanceof = T$InstanceOfKeyword;
KeywordLookup.typeof = T$TypeofKeyword;
KeywordLookup.void = T$VoidKeyword;

var TokenValues = [false, true, null, undefined, '$this', '$parent', '(', '{', '.', '}', ')', ',', '[', ']', ':', '?', '\'', '"', '&', '|', '||', '&&', '^', '==', '!=', '===', '!==', '<', '>', '<=', '>=', 'in', 'instanceof', '+', '-', 'typeof', 'void', '*', '%', '/', '=', '!'];

var codes = {
  AsciiIdPart: [0x24, 0, 0x30, 0x3A, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B],
  IdStart: [0x24, 0, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B, 0xAA, 0, 0xBA, 0, 0xC0, 0xD7, 0xD8, 0xF7, 0xF8, 0x2B9, 0x2E0, 0x2E5, 0x1D00, 0x1D26, 0x1D2C, 0x1D5D, 0x1D62, 0x1D66, 0x1D6B, 0x1D78, 0x1D79, 0x1DBF, 0x1E00, 0x1F00, 0x2071, 0, 0x207F, 0, 0x2090, 0x209D, 0x212A, 0x212C, 0x2132, 0, 0x214E, 0, 0x2160, 0x2189, 0x2C60, 0x2C80, 0xA722, 0xA788, 0xA78B, 0xA7AF, 0xA7B0, 0xA7B8, 0xA7F7, 0xA800, 0xAB30, 0xAB5B, 0xAB5C, 0xAB65, 0xFB00, 0xFB07, 0xFF21, 0xFF3B, 0xFF41, 0xFF5B],
  Digit: [0x30, 0x3A],
  Skip: [0, 0x21, 0x7F, 0xA1]
};

function decompress(lookup, set, compressed, value) {
  var rangeCount = compressed.length;
  for (var i = 0; i < rangeCount; i += 2) {
    var start = compressed[i];
    var end = compressed[i + 1];
    end = end > 0 ? end : start + 1;
    if (lookup) {
      var j = start;
      while (j < end) {
        lookup[j] = value;
        j++;
      }
    }
    if (set) {
      for (var ch = start; ch < end; ch++) {
        set.add(ch);
      }
    }
  }
}

function returnToken(token) {
  return function (p) {
    p.next();
    return token;
  };
}
function unexpectedCharacter(p) {
  p.err('Unexpected character [' + fromCharCode(p.ch) + ']');
  return null;
}

var AsciiIdParts = new Set();
decompress(null, AsciiIdParts, codes.AsciiIdPart, true);

var IdParts = new Uint8Array(0xFFFF);
decompress(IdParts, null, codes.IdStart, 1);
decompress(IdParts, null, codes.Digit, 1);

var CharScanners = new Array(0xFFFF);
var ci = 0;
while (ci < 0xFFFF) {
  CharScanners[ci] = unexpectedCharacter;
  ci++;
}

decompress(CharScanners, null, codes.Skip, function (p) {
  p.next();
  return null;
});
decompress(CharScanners, null, codes.IdStart, function (p) {
  return p.scanIdentifier();
});
decompress(CharScanners, null, codes.Digit, function (p) {
  return p.scanNumber(false);
});

CharScanners[0x22] = CharScanners[0x27] = function (p) {
  return p.scanString();
};
CharScanners[0x60] = function (p) {
  return p.scanTemplate();
};

CharScanners[0x21] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Bang;
  }
  if (p.next() !== 0x3D) {
    return T$BangEq;
  }
  p.next();
  return T$BangEqEq;
};

CharScanners[0x3D] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Eq;
  }
  if (p.next() !== 0x3D) {
    return T$EqEq;
  }
  p.next();
  return T$EqEqEq;
};

CharScanners[0x26] = function (p) {
  if (p.next() !== 0x26) {
    return T$Ampersand;
  }
  p.next();
  return T$AmpersandAmpersand;
};

CharScanners[0x7C] = function (p) {
  if (p.next() !== 0x7C) {
    return T$Bar;
  }
  p.next();
  return T$BarBar;
};

CharScanners[0x2E] = function (p) {
  if (p.next() <= 0x39 && p.ch >= 0x30) {
    return p.scanNumber(true);
  }
  return T$Period;
};

CharScanners[0x3C] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Lt;
  }
  p.next();
  return T$LtEq;
};

CharScanners[0x3E] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Gt;
  }
  p.next();
  return T$GtEq;
};

CharScanners[0x25] = returnToken(T$Percent);
CharScanners[0x28] = returnToken(T$LParen);
CharScanners[0x29] = returnToken(T$RParen);
CharScanners[0x2A] = returnToken(T$Star);
CharScanners[0x2B] = returnToken(T$Plus);
CharScanners[0x2C] = returnToken(T$Comma);
CharScanners[0x2D] = returnToken(T$Minus);
CharScanners[0x2F] = returnToken(T$Slash);
CharScanners[0x3A] = returnToken(T$Colon);
CharScanners[0x3F] = returnToken(T$Question);
CharScanners[0x5B] = returnToken(T$LBracket);
CharScanners[0x5D] = returnToken(T$RBracket);
CharScanners[0x5E] = returnToken(T$Caret);
CharScanners[0x7B] = returnToken(T$LBrace);
CharScanners[0x7D] = returnToken(T$RBrace);

var mapProto = Map.prototype;

function _getMapObserver(taskQueue, map) {
  return ModifyMapObserver.for(taskQueue, map);
}

var ModifyMapObserver = function (_ModifyCollectionObse2) {
  _inherits(ModifyMapObserver, _ModifyCollectionObse2);

  function ModifyMapObserver(taskQueue, map) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse2.call(this, taskQueue, map));
  }

  ModifyMapObserver.for = function _for(taskQueue, map) {
    if (!('__map_observer__' in map)) {
      Reflect.defineProperty(map, '__map_observer__', {
        value: ModifyMapObserver.create(taskQueue, map),
        enumerable: false, configurable: false
      });
    }
    return map.__map_observer__;
  };

  ModifyMapObserver.create = function create(taskQueue, map) {
    var observer = new ModifyMapObserver(taskQueue, map);

    var proto = mapProto;
    if (proto.set !== map.set || proto.delete !== map.delete || proto.clear !== map.clear) {
      proto = {
        set: map.set,
        delete: map.delete,
        clear: map.clear
      };
    }

    map.set = function () {
      var hasValue = map.has(arguments[0]);
      var type = hasValue ? 'update' : 'add';
      var oldValue = map.get(arguments[0]);
      var methodCallResult = proto.set.apply(map, arguments);
      if (!hasValue || oldValue !== map.get(arguments[0])) {
        observer.addChangeRecord({
          type: type,
          object: map,
          key: arguments[0],
          oldValue: oldValue
        });
      }
      return methodCallResult;
    };

    map.delete = function () {
      var hasValue = map.has(arguments[0]);
      var oldValue = map.get(arguments[0]);
      var methodCallResult = proto.delete.apply(map, arguments);
      if (hasValue) {
        observer.addChangeRecord({
          type: 'delete',
          object: map,
          key: arguments[0],
          oldValue: oldValue
        });
      }
      return methodCallResult;
    };

    map.clear = function () {
      var methodCallResult = proto.clear.apply(map, arguments);
      observer.addChangeRecord({
        type: 'clear',
        object: map
      });
      return methodCallResult;
    };

    return observer;
  };

  return ModifyMapObserver;
}(ModifyCollectionObserver);

var emLogger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('event-manager');

function findOriginalEventTarget(event) {
  return event.composedPath && event.composedPath()[0] || event.deepPath && event.deepPath()[0] || event.path && event.path[0] || event.target;
}

function stopPropagation() {
  this.standardStopPropagation();
  this.propagationStopped = true;
}

function handleCapturedEvent(event) {
  event.propagationStopped = false;
  var target = findOriginalEventTarget(event);

  var orderedCallbacks = [];

  while (target) {
    if (target.capturedCallbacks) {
      var callback = target.capturedCallbacks[event.type];
      if (callback) {
        if (event.stopPropagation !== stopPropagation) {
          event.standardStopPropagation = event.stopPropagation;
          event.stopPropagation = stopPropagation;
        }
        orderedCallbacks.push(callback);
      }
    }
    target = target.parentNode;
  }
  for (var i = orderedCallbacks.length - 1; i >= 0 && !event.propagationStopped; i--) {
    var orderedCallback = orderedCallbacks[i];
    if ('handleEvent' in orderedCallback) {
      orderedCallback.handleEvent(event);
    } else {
      orderedCallback(event);
    }
  }
}

var CapturedHandlerEntry = function () {
  function CapturedHandlerEntry(eventName) {
    

    this.eventName = eventName;
    this.count = 0;
  }

  CapturedHandlerEntry.prototype.increment = function increment() {
    this.count++;

    if (this.count === 1) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].addEventListener(this.eventName, handleCapturedEvent, true);
    }
  };

  CapturedHandlerEntry.prototype.decrement = function decrement() {
    if (this.count === 0) {
      emLogger.warn('The same EventListener was disposed multiple times.');
    } else if (--this.count === 0) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].removeEventListener(this.eventName, handleCapturedEvent, true);
    }
  };

  return CapturedHandlerEntry;
}();

var DelegateHandlerEntry = function () {
  function DelegateHandlerEntry(eventName, eventManager) {
    

    this.eventName = eventName;
    this.count = 0;
    this.eventManager = eventManager;
  }

  DelegateHandlerEntry.prototype.handleEvent = function handleEvent(event) {
    event.propagationStopped = false;
    var target = findOriginalEventTarget(event);

    while (target && !event.propagationStopped) {
      if (target.delegatedCallbacks) {
        var callback = target.delegatedCallbacks[event.type];
        if (callback) {
          if (event.stopPropagation !== stopPropagation) {
            event.standardStopPropagation = event.stopPropagation;
            event.stopPropagation = stopPropagation;
          }
          if ('handleEvent' in callback) {
            callback.handleEvent(event);
          } else {
            callback(event);
          }
        }
      }

      var parent = target.parentNode;
      var shouldEscapeShadowRoot = this.eventManager.escapeShadowRoot && parent instanceof ShadowRoot;

      target = shouldEscapeShadowRoot ? parent.host : parent;
    }
  };

  DelegateHandlerEntry.prototype.increment = function increment() {
    this.count++;

    if (this.count === 1) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].addEventListener(this.eventName, this, false);
    }
  };

  DelegateHandlerEntry.prototype.decrement = function decrement() {
    if (this.count === 0) {
      emLogger.warn('The same EventListener was disposed multiple times.');
    } else if (--this.count === 0) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].removeEventListener(this.eventName, this, false);
    }
  };

  return DelegateHandlerEntry;
}();

var DelegationEntryHandler = function () {
  function DelegationEntryHandler(entry, lookup, targetEvent) {
    

    this.entry = entry;
    this.lookup = lookup;
    this.targetEvent = targetEvent;
  }

  DelegationEntryHandler.prototype.dispose = function dispose() {
    if (this.lookup[this.targetEvent]) {
      this.entry.decrement();
      this.lookup[this.targetEvent] = null;
    } else {
      emLogger.warn('Calling .dispose() on already disposed eventListener');
    }
  };

  return DelegationEntryHandler;
}();

var EventHandler = function () {
  function EventHandler(target, targetEvent, callback) {
    

    this.target = target;
    this.targetEvent = targetEvent;
    this.callback = callback;
  }

  EventHandler.prototype.dispose = function dispose() {
    this.target.removeEventListener(this.targetEvent, this.callback);
  };

  return EventHandler;
}();

var DefaultEventStrategy = function () {
  function DefaultEventStrategy(eventManager) {
    

    this.delegatedHandlers = {};
    this.capturedHandlers = {};

    this.eventManager = eventManager;
  }

  DefaultEventStrategy.prototype.subscribe = function subscribe(target, targetEvent, callback, strategy, disposable) {
    var delegatedHandlers = void 0;
    var capturedHandlers = void 0;
    var handlerEntry = void 0;

    if (strategy === delegationStrategy.bubbling) {
      delegatedHandlers = this.delegatedHandlers;
      handlerEntry = delegatedHandlers[targetEvent] || (delegatedHandlers[targetEvent] = new DelegateHandlerEntry(targetEvent, this.eventManager));
      var delegatedCallbacks = target.delegatedCallbacks || (target.delegatedCallbacks = {});
      if (!delegatedCallbacks[targetEvent]) {
        handlerEntry.increment();
      } else {
        emLogger.warn('Overriding previous callback for event listener', { event: targetEvent, callback: callback, previousCallback: delegatedCallbacks[targetEvent] });
      }
      delegatedCallbacks[targetEvent] = callback;

      if (disposable === true) {
        return new DelegationEntryHandler(handlerEntry, delegatedCallbacks, targetEvent);
      }

      return function () {
        handlerEntry.decrement();
        delegatedCallbacks[targetEvent] = null;
      };
    }
    if (strategy === delegationStrategy.capturing) {
      capturedHandlers = this.capturedHandlers;
      handlerEntry = capturedHandlers[targetEvent] || (capturedHandlers[targetEvent] = new CapturedHandlerEntry(targetEvent));
      var capturedCallbacks = target.capturedCallbacks || (target.capturedCallbacks = {});
      if (!capturedCallbacks[targetEvent]) {
        handlerEntry.increment();
      } else {
        emLogger.error('already have a callback for event', { event: targetEvent, callback: callback });
      }
      capturedCallbacks[targetEvent] = callback;

      if (disposable === true) {
        return new DelegationEntryHandler(handlerEntry, capturedCallbacks, targetEvent);
      }

      return function () {
        handlerEntry.decrement();
        capturedCallbacks[targetEvent] = null;
      };
    }

    target.addEventListener(targetEvent, callback);

    if (disposable === true) {
      return new EventHandler(target, targetEvent, callback);
    }

    return function () {
      target.removeEventListener(targetEvent, callback);
    };
  };

  return DefaultEventStrategy;
}();

var delegationStrategy = {
  none: 0,
  capturing: 1,
  bubbling: 2
};

var EventManager = function () {
  function EventManager() {
    var escapeShadowRoot = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

    

    this.elementHandlerLookup = {};
    this.eventStrategyLookup = {};
    this.escapeShadowRoot = escapeShadowRoot;

    this.registerElementConfig({
      tagName: 'input',
      properties: {
        value: ['change', 'input'],
        checked: ['change', 'input'],
        files: ['change', 'input']
      }
    });

    this.registerElementConfig({
      tagName: 'textarea',
      properties: {
        value: ['change', 'input']
      }
    });

    this.registerElementConfig({
      tagName: 'select',
      properties: {
        value: ['change']
      }
    });

    this.registerElementConfig({
      tagName: 'content editable',
      properties: {
        value: ['change', 'input', 'blur', 'keyup', 'paste']
      }
    });

    this.registerElementConfig({
      tagName: 'scrollable element',
      properties: {
        scrollTop: ['scroll'],
        scrollLeft: ['scroll']
      }
    });

    this.defaultEventStrategy = new DefaultEventStrategy(this);
  }

  EventManager.prototype.registerElementConfig = function registerElementConfig(config) {
    var tagName = config.tagName.toLowerCase();
    var properties = config.properties;
    var propertyName = void 0;

    var lookup = this.elementHandlerLookup[tagName] = {};

    for (propertyName in properties) {
      if (properties.hasOwnProperty(propertyName)) {
        lookup[propertyName] = properties[propertyName];
      }
    }
  };

  EventManager.prototype.registerEventStrategy = function registerEventStrategy(eventName, strategy) {
    this.eventStrategyLookup[eventName] = strategy;
  };

  EventManager.prototype.getElementHandler = function getElementHandler(target, propertyName) {
    var tagName = void 0;
    var lookup = this.elementHandlerLookup;

    if (target.tagName) {
      tagName = target.tagName.toLowerCase();

      if (lookup[tagName] && lookup[tagName][propertyName]) {
        return new EventSubscriber(lookup[tagName][propertyName]);
      }

      if (propertyName === 'textContent' || propertyName === 'innerHTML') {
        return new EventSubscriber(lookup['content editable'].value);
      }

      if (propertyName === 'scrollTop' || propertyName === 'scrollLeft') {
        return new EventSubscriber(lookup['scrollable element'][propertyName]);
      }
    }

    return null;
  };

  EventManager.prototype.addEventListener = function addEventListener(target, targetEvent, callbackOrListener, delegate, disposable) {
    return (this.eventStrategyLookup[targetEvent] || this.defaultEventStrategy).subscribe(target, targetEvent, callbackOrListener, delegate, disposable);
  };

  return EventManager;
}();

var EventSubscriber = function () {
  function EventSubscriber(events) {
    

    this.events = events;
    this.element = null;
    this.handler = null;
  }

  EventSubscriber.prototype.subscribe = function subscribe(element, callbackOrListener) {
    this.element = element;
    this.handler = callbackOrListener;

    var events = this.events;
    for (var i = 0, ii = events.length; ii > i; ++i) {
      element.addEventListener(events[i], callbackOrListener);
    }
  };

  EventSubscriber.prototype.dispose = function dispose() {
    if (this.element === null) {
      return;
    }
    var element = this.element;
    var callbackOrListener = this.handler;
    var events = this.events;
    for (var i = 0, ii = events.length; ii > i; ++i) {
      element.removeEventListener(events[i], callbackOrListener);
    }
    this.element = this.handler = null;
  };

  return EventSubscriber;
}();

var DirtyChecker = function () {
  function DirtyChecker() {
    

    this.tracked = [];
    this.checkDelay = 120;
  }

  DirtyChecker.prototype.addProperty = function addProperty(property) {
    var tracked = this.tracked;

    tracked.push(property);

    if (tracked.length === 1) {
      this.scheduleDirtyCheck();
    }
  };

  DirtyChecker.prototype.removeProperty = function removeProperty(property) {
    var tracked = this.tracked;
    tracked.splice(tracked.indexOf(property), 1);
  };

  DirtyChecker.prototype.scheduleDirtyCheck = function scheduleDirtyCheck() {
    var _this22 = this;

    setTimeout(function () {
      return _this22.check();
    }, this.checkDelay);
  };

  DirtyChecker.prototype.check = function check() {
    var tracked = this.tracked;
    var i = tracked.length;

    while (i--) {
      var current = tracked[i];

      if (current.isDirty()) {
        current.call();
      }
    }

    if (tracked.length) {
      this.scheduleDirtyCheck();
    }
  };

  return DirtyChecker;
}();

var DirtyCheckProperty = (_dec5 = subscriberCollection(), _dec5(_class5 = function () {
  function DirtyCheckProperty(dirtyChecker, obj, propertyName) {
    

    this.dirtyChecker = dirtyChecker;
    this.obj = obj;
    this.propertyName = propertyName;
  }

  DirtyCheckProperty.prototype.getValue = function getValue() {
    return this.obj[this.propertyName];
  };

  DirtyCheckProperty.prototype.setValue = function setValue(newValue) {
    this.obj[this.propertyName] = newValue;
  };

  DirtyCheckProperty.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.getValue();

    this.callSubscribers(newValue, oldValue);

    this.oldValue = newValue;
  };

  DirtyCheckProperty.prototype.isDirty = function isDirty() {
    return this.oldValue !== this.obj[this.propertyName];
  };

  DirtyCheckProperty.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.oldValue = this.getValue();
      this.dirtyChecker.addProperty(this);
    }
    this.addSubscriber(context, callable);
  };

  DirtyCheckProperty.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.dirtyChecker.removeProperty(this);
    }
  };

  return DirtyCheckProperty;
}()) || _class5);

var logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('property-observation');

var propertyAccessor = {
  getValue: function getValue(obj, propertyName) {
    return obj[propertyName];
  },
  setValue: function setValue(value, obj, propertyName) {
    obj[propertyName] = value;
  }
};

var PrimitiveObserver = function () {
  function PrimitiveObserver(primitive, propertyName) {
    

    this.doNotCache = true;

    this.primitive = primitive;
    this.propertyName = propertyName;
  }

  PrimitiveObserver.prototype.getValue = function getValue() {
    return this.primitive[this.propertyName];
  };

  PrimitiveObserver.prototype.setValue = function setValue() {
    var type = _typeof(this.primitive);
    throw new Error('The ' + this.propertyName + ' property of a ' + type + ' (' + this.primitive + ') cannot be assigned.');
  };

  PrimitiveObserver.prototype.subscribe = function subscribe() {};

  PrimitiveObserver.prototype.unsubscribe = function unsubscribe() {};

  return PrimitiveObserver;
}();

var SetterObserver = (_dec6 = subscriberCollection(), _dec6(_class7 = function () {
  function SetterObserver(taskQueue, obj, propertyName) {
    

    this.taskQueue = taskQueue;
    this.obj = obj;
    this.propertyName = propertyName;
    this.queued = false;
    this.observing = false;
  }

  SetterObserver.prototype.getValue = function getValue() {
    return this.obj[this.propertyName];
  };

  SetterObserver.prototype.setValue = function setValue(newValue) {
    this.obj[this.propertyName] = newValue;
  };

  SetterObserver.prototype.getterValue = function getterValue() {
    return this.currentValue;
  };

  SetterObserver.prototype.setterValue = function setterValue(newValue) {
    var oldValue = this.currentValue;

    if (oldValue !== newValue) {
      if (!this.queued) {
        this.oldValue = oldValue;
        this.queued = true;
        this.taskQueue.queueMicroTask(this);
      }

      this.currentValue = newValue;
    }
  };

  SetterObserver.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.oldValue = this.currentValue;

    this.queued = false;

    this.callSubscribers(newValue, oldValue);
  };

  SetterObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.observing) {
      this.convertProperty();
    }
    this.addSubscriber(context, callable);
  };

  SetterObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  SetterObserver.prototype.convertProperty = function convertProperty() {
    this.observing = true;
    this.currentValue = this.obj[this.propertyName];
    this.setValue = this.setterValue;
    this.getValue = this.getterValue;

    if (!Reflect.defineProperty(this.obj, this.propertyName, {
      configurable: true,
      enumerable: this.propertyName in this.obj ? this.obj.propertyIsEnumerable(this.propertyName) : true,
      get: this.getValue.bind(this),
      set: this.setValue.bind(this)
    })) {
      logger.warn('Cannot observe property \'' + this.propertyName + '\' of object', this.obj);
    }
  };

  return SetterObserver;
}()) || _class7);

var XLinkAttributeObserver = function () {
  function XLinkAttributeObserver(element, propertyName, attributeName) {
    

    this.element = element;
    this.propertyName = propertyName;
    this.attributeName = attributeName;
  }

  XLinkAttributeObserver.prototype.getValue = function getValue() {
    return this.element.getAttributeNS('http://www.w3.org/1999/xlink', this.attributeName);
  };

  XLinkAttributeObserver.prototype.setValue = function setValue(newValue) {
    return this.element.setAttributeNS('http://www.w3.org/1999/xlink', this.attributeName, newValue);
  };

  XLinkAttributeObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return XLinkAttributeObserver;
}();

var dataAttributeAccessor = {
  getValue: function getValue(obj, propertyName) {
    return obj.getAttribute(propertyName);
  },
  setValue: function setValue(value, obj, propertyName) {
    if (value === null || value === undefined) {
      obj.removeAttribute(propertyName);
    } else {
      obj.setAttribute(propertyName, value);
    }
  }
};

var DataAttributeObserver = function () {
  function DataAttributeObserver(element, propertyName) {
    

    this.element = element;
    this.propertyName = propertyName;
  }

  DataAttributeObserver.prototype.getValue = function getValue() {
    return this.element.getAttribute(this.propertyName);
  };

  DataAttributeObserver.prototype.setValue = function setValue(newValue) {
    if (newValue === null || newValue === undefined) {
      return this.element.removeAttribute(this.propertyName);
    }
    return this.element.setAttribute(this.propertyName, newValue);
  };

  DataAttributeObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return DataAttributeObserver;
}();

var StyleObserver = function () {
  function StyleObserver(element, propertyName) {
    

    this.element = element;
    this.propertyName = propertyName;

    this.styles = null;
    this.version = 0;
  }

  StyleObserver.prototype.getValue = function getValue() {
    return this.element.style.cssText;
  };

  StyleObserver.prototype._setProperty = function _setProperty(style, value) {
    var priority = '';

    if (value !== null && value !== undefined && typeof value.indexOf === 'function' && value.indexOf('!important') !== -1) {
      priority = 'important';
      value = value.replace('!important', '');
    }
    this.element.style.setProperty(style, value, priority);
  };

  StyleObserver.prototype.setValue = function setValue(newValue) {
    var styles = this.styles || {};
    var style = void 0;
    var version = this.version;

    if (newValue !== null && newValue !== undefined) {
      if (newValue instanceof Object) {
        var value = void 0;
        for (style in newValue) {
          if (newValue.hasOwnProperty(style)) {
            value = newValue[style];
            style = style.replace(/([A-Z])/g, function (m) {
              return '-' + m.toLowerCase();
            });
            styles[style] = version;
            this._setProperty(style, value);
          }
        }
      } else if (newValue.length) {
        var rx = /\s*([\w\-]+)\s*:\s*((?:(?:[\w\-]+\(\s*(?:"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[\w\-]+\(\s*(?:^"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^\)]*)\),?|[^\)]*)\),?|"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^;]*),?\s*)+);?/g;
        var pair = void 0;
        while ((pair = rx.exec(newValue)) !== null) {
          style = pair[1];
          if (!style) {
            continue;
          }

          styles[style] = version;
          this._setProperty(style, pair[2]);
        }
      }
    }

    this.styles = styles;
    this.version += 1;

    if (version === 0) {
      return;
    }

    version -= 1;
    for (style in styles) {
      if (!styles.hasOwnProperty(style) || styles[style] !== version) {
        continue;
      }

      this.element.style.removeProperty(style);
    }
  };

  StyleObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return StyleObserver;
}();

var ValueAttributeObserver = (_dec7 = subscriberCollection(), _dec7(_class8 = function () {
  function ValueAttributeObserver(element, propertyName, handler) {
    

    this.element = element;
    this.propertyName = propertyName;
    this.handler = handler;
    if (propertyName === 'files') {
      this.setValue = function () {};
    }
  }

  ValueAttributeObserver.prototype.getValue = function getValue() {
    return this.element[this.propertyName];
  };

  ValueAttributeObserver.prototype.setValue = function setValue(newValue) {
    newValue = newValue === undefined || newValue === null ? '' : newValue;
    if (this.element[this.propertyName] !== newValue) {
      this.element[this.propertyName] = newValue;
      this.notify();
    }
  };

  ValueAttributeObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.getValue();

    this.callSubscribers(newValue, oldValue);

    this.oldValue = newValue;
  };

  ValueAttributeObserver.prototype.handleEvent = function handleEvent() {
    this.notify();
  };

  ValueAttributeObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.oldValue = this.getValue();
      this.handler.subscribe(this.element, this);
    }

    this.addSubscriber(context, callable);
  };

  ValueAttributeObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.handler.dispose();
    }
  };

  return ValueAttributeObserver;
}()) || _class8);

var checkedArrayContext = 'CheckedObserver:array';
var checkedValueContext = 'CheckedObserver:value';

var CheckedObserver = (_dec8 = subscriberCollection(), _dec8(_class9 = function () {
  function CheckedObserver(element, handler, observerLocator) {
    

    this.element = element;
    this.handler = handler;
    this.observerLocator = observerLocator;
  }

  CheckedObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  CheckedObserver.prototype.setValue = function setValue(newValue) {
    if (this.initialSync && this.value === newValue) {
      return;
    }

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(checkedArrayContext, this);
      this.arrayObserver = null;
    }

    if (this.element.type === 'checkbox' && Array.isArray(newValue)) {
      this.arrayObserver = this.observerLocator.getArrayObserver(newValue);
      this.arrayObserver.subscribe(checkedArrayContext, this);
    }

    this.oldValue = this.value;
    this.value = newValue;
    this.synchronizeElement();
    this.notify();

    if (!this.initialSync) {
      this.initialSync = true;
      this.observerLocator.taskQueue.queueMicroTask(this);
    }
  };

  CheckedObserver.prototype.call = function call(context, splices) {
    this.synchronizeElement();

    if (!this.valueObserver) {
      this.valueObserver = this.element.__observers__.model || this.element.__observers__.value;
      if (this.valueObserver) {
        this.valueObserver.subscribe(checkedValueContext, this);
      }
    }
  };

  CheckedObserver.prototype.synchronizeElement = function synchronizeElement() {
    var value = this.value;
    var element = this.element;
    var elementValue = element.hasOwnProperty('model') ? element.model : element.value;
    var isRadio = element.type === 'radio';
    var matcher = element.matcher || function (a, b) {
      return a === b;
    };

    element.checked = isRadio && !!matcher(value, elementValue) || !isRadio && value === true || !isRadio && Array.isArray(value) && value.findIndex(function (item) {
      return !!matcher(item, elementValue);
    }) !== -1;
  };

  CheckedObserver.prototype.synchronizeValue = function synchronizeValue() {
    var value = this.value;
    var element = this.element;
    var elementValue = element.hasOwnProperty('model') ? element.model : element.value;
    var index = void 0;
    var matcher = element.matcher || function (a, b) {
      return a === b;
    };

    if (element.type === 'checkbox') {
      if (Array.isArray(value)) {
        index = value.findIndex(function (item) {
          return !!matcher(item, elementValue);
        });
        if (element.checked && index === -1) {
          value.push(elementValue);
        } else if (!element.checked && index !== -1) {
          value.splice(index, 1);
        }

        return;
      }

      value = element.checked;
    } else if (element.checked) {
      value = elementValue;
    } else {
      return;
    }

    this.oldValue = this.value;
    this.value = value;
    this.notify();
  };

  CheckedObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.value;

    if (newValue === oldValue) {
      return;
    }

    this.callSubscribers(newValue, oldValue);
  };

  CheckedObserver.prototype.handleEvent = function handleEvent() {
    this.synchronizeValue();
  };

  CheckedObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.handler.subscribe(this.element, this);
    }
    this.addSubscriber(context, callable);
  };

  CheckedObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.handler.dispose();
    }
  };

  CheckedObserver.prototype.unbind = function unbind() {
    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(checkedArrayContext, this);
      this.arrayObserver = null;
    }
    if (this.valueObserver) {
      this.valueObserver.unsubscribe(checkedValueContext, this);
    }
  };

  return CheckedObserver;
}()) || _class9);

var selectArrayContext = 'SelectValueObserver:array';

var SelectValueObserver = (_dec9 = subscriberCollection(), _dec9(_class10 = function () {
  function SelectValueObserver(element, handler, observerLocator) {
    

    this.element = element;
    this.handler = handler;
    this.observerLocator = observerLocator;
  }

  SelectValueObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  SelectValueObserver.prototype.setValue = function setValue(newValue) {
    if (newValue !== null && newValue !== undefined && this.element.multiple && !Array.isArray(newValue)) {
      throw new Error('Only null or Array instances can be bound to a multi-select.');
    }
    if (this.value === newValue) {
      return;
    }

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(selectArrayContext, this);
      this.arrayObserver = null;
    }

    if (Array.isArray(newValue)) {
      this.arrayObserver = this.observerLocator.getArrayObserver(newValue);
      this.arrayObserver.subscribe(selectArrayContext, this);
    }

    this.oldValue = this.value;
    this.value = newValue;
    this.synchronizeOptions();
    this.notify();

    if (!this.initialSync) {
      this.initialSync = true;
      this.observerLocator.taskQueue.queueMicroTask(this);
    }
  };

  SelectValueObserver.prototype.call = function call(context, splices) {
    this.synchronizeOptions();
  };

  SelectValueObserver.prototype.synchronizeOptions = function synchronizeOptions() {
    var value = this.value;
    var isArray = void 0;

    if (Array.isArray(value)) {
      isArray = true;
    }

    var options = this.element.options;
    var i = options.length;
    var matcher = this.element.matcher || function (a, b) {
      return a === b;
    };

    var _loop = function _loop() {
      var option = options.item(i);
      var optionValue = option.hasOwnProperty('model') ? option.model : option.value;
      if (isArray) {
        option.selected = value.findIndex(function (item) {
          return !!matcher(optionValue, item);
        }) !== -1;
        return 'continue';
      }
      option.selected = !!matcher(optionValue, value);
    };

    while (i--) {
      var _ret = _loop();

      if (_ret === 'continue') continue;
    }
  };

  SelectValueObserver.prototype.synchronizeValue = function synchronizeValue() {
    var _this23 = this;

    var options = this.element.options;
    var count = 0;
    var value = [];

    for (var i = 0, ii = options.length; i < ii; i++) {
      var _option = options.item(i);
      if (!_option.selected) {
        continue;
      }
      value.push(_option.hasOwnProperty('model') ? _option.model : _option.value);
      count++;
    }

    if (this.element.multiple) {
      if (Array.isArray(this.value)) {
        var _ret2 = function () {
          var matcher = _this23.element.matcher || function (a, b) {
            return a === b;
          };

          var i = 0;

          var _loop2 = function _loop2() {
            var a = _this23.value[i];
            if (value.findIndex(function (b) {
              return matcher(a, b);
            }) === -1) {
              _this23.value.splice(i, 1);
            } else {
              i++;
            }
          };

          while (i < _this23.value.length) {
            _loop2();
          }

          i = 0;

          var _loop3 = function _loop3() {
            var a = value[i];
            if (_this23.value.findIndex(function (b) {
              return matcher(a, b);
            }) === -1) {
              _this23.value.push(a);
            }
            i++;
          };

          while (i < value.length) {
            _loop3();
          }
          return {
            v: void 0
          };
        }();

        if ((typeof _ret2 === 'undefined' ? 'undefined' : _typeof(_ret2)) === "object") return _ret2.v;
      }
    } else {
      if (count === 0) {
        value = null;
      } else {
        value = value[0];
      }
    }

    if (value !== this.value) {
      this.oldValue = this.value;
      this.value = value;
      this.notify();
    }
  };

  SelectValueObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.value;

    this.callSubscribers(newValue, oldValue);
  };

  SelectValueObserver.prototype.handleEvent = function handleEvent() {
    this.synchronizeValue();
  };

  SelectValueObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.handler.subscribe(this.element, this);
    }
    this.addSubscriber(context, callable);
  };

  SelectValueObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.handler.dispose();
    }
  };

  SelectValueObserver.prototype.bind = function bind() {
    var _this24 = this;

    this.domObserver = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].createMutationObserver(function () {
      _this24.synchronizeOptions();
      _this24.synchronizeValue();
    });
    this.domObserver.observe(this.element, { childList: true, subtree: true, characterData: true });
  };

  SelectValueObserver.prototype.unbind = function unbind() {
    this.domObserver.disconnect();
    this.domObserver = null;

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(selectArrayContext, this);
      this.arrayObserver = null;
    }
  };

  return SelectValueObserver;
}()) || _class10);

var ClassObserver = function () {
  function ClassObserver(element) {
    

    this.element = element;
    this.doNotCache = true;
    this.value = '';
    this.version = 0;
  }

  ClassObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  ClassObserver.prototype.setValue = function setValue(newValue) {
    var nameIndex = this.nameIndex || {};
    var version = this.version;
    var names = void 0;
    var name = void 0;

    if (newValue !== null && newValue !== undefined && newValue.length) {
      names = newValue.split(/\s+/);
      for (var i = 0, length = names.length; i < length; i++) {
        name = names[i];
        if (name === '') {
          continue;
        }
        nameIndex[name] = version;
        this.element.classList.add(name);
      }
    }

    this.value = newValue;
    this.nameIndex = nameIndex;
    this.version += 1;

    if (version === 0) {
      return;
    }

    version -= 1;
    for (name in nameIndex) {
      if (!nameIndex.hasOwnProperty(name) || nameIndex[name] !== version) {
        continue;
      }
      this.element.classList.remove(name);
    }
  };

  ClassObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "class" property is not supported.');
  };

  return ClassObserver;
}();

function hasDeclaredDependencies(descriptor) {
  return !!(descriptor && descriptor.get && descriptor.get.dependencies);
}

function declarePropertyDependencies(ctor, propertyName, dependencies) {
  var descriptor = Object.getOwnPropertyDescriptor(ctor.prototype, propertyName);
  descriptor.get.dependencies = dependencies;
}

function computedFrom() {
  for (var _len = arguments.length, rest = Array(_len), _key = 0; _key < _len; _key++) {
    rest[_key] = arguments[_key];
  }

  return function (target, key, descriptor) {
    descriptor.get.dependencies = rest;
    return descriptor;
  };
}

var ComputedExpression = function (_Expression19) {
  _inherits(ComputedExpression, _Expression19);

  function ComputedExpression(name, dependencies) {
    

    var _this25 = _possibleConstructorReturn(this, _Expression19.call(this));

    _this25.name = name;
    _this25.dependencies = dependencies;
    _this25.isAssignable = true;
    return _this25;
  }

  ComputedExpression.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return scope.bindingContext[this.name];
  };

  ComputedExpression.prototype.assign = function assign(scope, value) {
    scope.bindingContext[this.name] = value;
  };

  ComputedExpression.prototype.accept = function accept(visitor) {
    throw new Error('not implemented');
  };

  ComputedExpression.prototype.connect = function connect(binding, scope) {
    var dependencies = this.dependencies;
    var i = dependencies.length;
    while (i--) {
      dependencies[i].connect(binding, scope);
    }
  };

  return ComputedExpression;
}(Expression);

function createComputedObserver(obj, propertyName, descriptor, observerLocator) {
  var dependencies = descriptor.get.dependencies;
  if (!(dependencies instanceof ComputedExpression)) {
    var i = dependencies.length;
    while (i--) {
      dependencies[i] = observerLocator.parser.parse(dependencies[i]);
    }
    dependencies = descriptor.get.dependencies = new ComputedExpression(propertyName, dependencies);
  }

  var scope = { bindingContext: obj, overrideContext: createOverrideContext(obj) };
  return new ExpressionObserver(scope, dependencies, observerLocator);
}

var svgElements = void 0;
var svgPresentationElements = void 0;
var svgPresentationAttributes = void 0;
var svgAnalyzer = void 0;

if (typeof FEATURE_NO_SVG === 'undefined') {
  svgElements = {
    a: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'target', 'transform', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    altGlyph: ['class', 'dx', 'dy', 'externalResourcesRequired', 'format', 'glyphRef', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    altGlyphDef: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    altGlyphItem: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    animate: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    animateColor: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    animateMotion: ['accumulate', 'additive', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keyPoints', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'origin', 'path', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'rotate', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    animateTransform: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'type', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    circle: ['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'r', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    clipPath: ['class', 'clipPathUnits', 'externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    'color-profile': ['id', 'local', 'name', 'rendering-intent', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    cursor: ['externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    defs: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    desc: ['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space'],
    ellipse: ['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    feBlend: ['class', 'height', 'id', 'in', 'in2', 'mode', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feColorMatrix: ['class', 'height', 'id', 'in', 'result', 'style', 'type', 'values', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feComponentTransfer: ['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feComposite: ['class', 'height', 'id', 'in', 'in2', 'k1', 'k2', 'k3', 'k4', 'operator', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feConvolveMatrix: ['bias', 'class', 'divisor', 'edgeMode', 'height', 'id', 'in', 'kernelMatrix', 'kernelUnitLength', 'order', 'preserveAlpha', 'result', 'style', 'targetX', 'targetY', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feDiffuseLighting: ['class', 'diffuseConstant', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feDisplacementMap: ['class', 'height', 'id', 'in', 'in2', 'result', 'scale', 'style', 'width', 'x', 'xChannelSelector', 'xml:base', 'xml:lang', 'xml:space', 'y', 'yChannelSelector'],
    feDistantLight: ['azimuth', 'elevation', 'id', 'xml:base', 'xml:lang', 'xml:space'],
    feFlood: ['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feFuncA: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feFuncB: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feFuncG: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feFuncR: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feGaussianBlur: ['class', 'height', 'id', 'in', 'result', 'stdDeviation', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feImage: ['class', 'externalResourcesRequired', 'height', 'id', 'preserveAspectRatio', 'result', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feMerge: ['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feMergeNode: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    feMorphology: ['class', 'height', 'id', 'in', 'operator', 'radius', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feOffset: ['class', 'dx', 'dy', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    fePointLight: ['id', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z'],
    feSpecularLighting: ['class', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'specularConstant', 'specularExponent', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feSpotLight: ['id', 'limitingConeAngle', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'specularExponent', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z'],
    feTile: ['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feTurbulence: ['baseFrequency', 'class', 'height', 'id', 'numOctaves', 'result', 'seed', 'stitchTiles', 'style', 'type', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    filter: ['class', 'externalResourcesRequired', 'filterRes', 'filterUnits', 'height', 'id', 'primitiveUnits', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    font: ['class', 'externalResourcesRequired', 'horiz-adv-x', 'horiz-origin-x', 'horiz-origin-y', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face': ['accent-height', 'alphabetic', 'ascent', 'bbox', 'cap-height', 'descent', 'font-family', 'font-size', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'hanging', 'id', 'ideographic', 'mathematical', 'overline-position', 'overline-thickness', 'panose-1', 'slope', 'stemh', 'stemv', 'strikethrough-position', 'strikethrough-thickness', 'underline-position', 'underline-thickness', 'unicode-range', 'units-per-em', 'v-alphabetic', 'v-hanging', 'v-ideographic', 'v-mathematical', 'widths', 'x-height', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-format': ['id', 'string', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-name': ['id', 'name', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-src': ['id', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-uri': ['id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    foreignObject: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    g: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    glyph: ['arabic-form', 'class', 'd', 'glyph-name', 'horiz-adv-x', 'id', 'lang', 'orientation', 'style', 'unicode', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
    glyphRef: ['class', 'dx', 'dy', 'format', 'glyphRef', 'id', 'style', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    hkern: ['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space'],
    image: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    line: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'x1', 'x2', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2'],
    linearGradient: ['class', 'externalResourcesRequired', 'gradientTransform', 'gradientUnits', 'id', 'spreadMethod', 'style', 'x1', 'x2', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2'],
    marker: ['class', 'externalResourcesRequired', 'id', 'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space'],
    mask: ['class', 'externalResourcesRequired', 'height', 'id', 'maskContentUnits', 'maskUnits', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    metadata: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    'missing-glyph': ['class', 'd', 'horiz-adv-x', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
    mpath: ['externalResourcesRequired', 'id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    path: ['class', 'd', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'pathLength', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    pattern: ['class', 'externalResourcesRequired', 'height', 'id', 'patternContentUnits', 'patternTransform', 'patternUnits', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    polygon: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    polyline: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    radialGradient: ['class', 'cx', 'cy', 'externalResourcesRequired', 'fx', 'fy', 'gradientTransform', 'gradientUnits', 'id', 'r', 'spreadMethod', 'style', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    rect: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    script: ['externalResourcesRequired', 'id', 'type', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    set: ['attributeName', 'attributeType', 'begin', 'dur', 'end', 'externalResourcesRequired', 'fill', 'id', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    stop: ['class', 'id', 'offset', 'style', 'xml:base', 'xml:lang', 'xml:space'],
    style: ['id', 'media', 'title', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    svg: ['baseProfile', 'class', 'contentScriptType', 'contentStyleType', 'externalResourcesRequired', 'height', 'id', 'onabort', 'onactivate', 'onclick', 'onerror', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onresize', 'onscroll', 'onunload', 'onzoom', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'version', 'viewBox', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'zoomAndPan'],
    switch: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    symbol: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space'],
    text: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'transform', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    textPath: ['class', 'externalResourcesRequired', 'id', 'lengthAdjust', 'method', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'textLength', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    title: ['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space'],
    tref: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    tspan: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    use: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    view: ['externalResourcesRequired', 'id', 'preserveAspectRatio', 'viewBox', 'viewTarget', 'xml:base', 'xml:lang', 'xml:space', 'zoomAndPan'],
    vkern: ['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space']
  };


  svgPresentationElements = {
    'a': true,
    'altGlyph': true,
    'animate': true,
    'animateColor': true,
    'circle': true,
    'clipPath': true,
    'defs': true,
    'ellipse': true,
    'feBlend': true,
    'feColorMatrix': true,
    'feComponentTransfer': true,
    'feComposite': true,
    'feConvolveMatrix': true,
    'feDiffuseLighting': true,
    'feDisplacementMap': true,
    'feFlood': true,
    'feGaussianBlur': true,
    'feImage': true,
    'feMerge': true,
    'feMorphology': true,
    'feOffset': true,
    'feSpecularLighting': true,
    'feTile': true,
    'feTurbulence': true,
    'filter': true,
    'font': true,
    'foreignObject': true,
    'g': true,
    'glyph': true,
    'glyphRef': true,
    'image': true,
    'line': true,
    'linearGradient': true,
    'marker': true,
    'mask': true,
    'missing-glyph': true,
    'path': true,
    'pattern': true,
    'polygon': true,
    'polyline': true,
    'radialGradient': true,
    'rect': true,
    'stop': true,
    'svg': true,
    'switch': true,
    'symbol': true,
    'text': true,
    'textPath': true,
    'tref': true,
    'tspan': true,
    'use': true
  };

  svgPresentationAttributes = {
    'alignment-baseline': true,
    'baseline-shift': true,
    'clip-path': true,
    'clip-rule': true,
    'clip': true,
    'color-interpolation-filters': true,
    'color-interpolation': true,
    'color-profile': true,
    'color-rendering': true,
    'color': true,
    'cursor': true,
    'direction': true,
    'display': true,
    'dominant-baseline': true,
    'enable-background': true,
    'fill-opacity': true,
    'fill-rule': true,
    'fill': true,
    'filter': true,
    'flood-color': true,
    'flood-opacity': true,
    'font-family': true,
    'font-size-adjust': true,
    'font-size': true,
    'font-stretch': true,
    'font-style': true,
    'font-variant': true,
    'font-weight': true,
    'glyph-orientation-horizontal': true,
    'glyph-orientation-vertical': true,
    'image-rendering': true,
    'kerning': true,
    'letter-spacing': true,
    'lighting-color': true,
    'marker-end': true,
    'marker-mid': true,
    'marker-start': true,
    'mask': true,
    'opacity': true,
    'overflow': true,
    'pointer-events': true,
    'shape-rendering': true,
    'stop-color': true,
    'stop-opacity': true,
    'stroke-dasharray': true,
    'stroke-dashoffset': true,
    'stroke-linecap': true,
    'stroke-linejoin': true,
    'stroke-miterlimit': true,
    'stroke-opacity': true,
    'stroke-width': true,
    'stroke': true,
    'text-anchor': true,
    'text-decoration': true,
    'text-rendering': true,
    'unicode-bidi': true,
    'visibility': true,
    'word-spacing': true,
    'writing-mode': true
  };

  var createElement = function createElement(html) {
    var div = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].createElement('div');
    div.innerHTML = html;
    return div.firstChild;
  };

  svgAnalyzer = function () {
    function SVGAnalyzer() {
      

      if (createElement('<svg><altGlyph /></svg>').firstElementChild.nodeName === 'altglyph' && elements.altGlyph) {
        elements.altglyph = elements.altGlyph;
        delete elements.altGlyph;
        elements.altglyphdef = elements.altGlyphDef;
        delete elements.altGlyphDef;
        elements.altglyphitem = elements.altGlyphItem;
        delete elements.altGlyphItem;
        elements.glyphref = elements.glyphRef;
        delete elements.glyphRef;
      }
    }

    SVGAnalyzer.prototype.isStandardSvgAttribute = function isStandardSvgAttribute(nodeName, attributeName) {
      return presentationElements[nodeName] && presentationAttributes[attributeName] || elements[nodeName] && elements[nodeName].indexOf(attributeName) !== -1;
    };

    return SVGAnalyzer;
  }();
}

var elements = svgElements;
var presentationElements = svgPresentationElements;
var presentationAttributes = svgPresentationAttributes;
var SVGAnalyzer = svgAnalyzer || function () {
  function _class11() {
    
  }

  _class11.prototype.isStandardSvgAttribute = function isStandardSvgAttribute() {
    return false;
  };

  return _class11;
}();

var ObserverLocator = (_temp = _class12 = function () {
  function ObserverLocator(taskQueue, eventManager, dirtyChecker, svgAnalyzer, parser) {
    

    this.taskQueue = taskQueue;
    this.eventManager = eventManager;
    this.dirtyChecker = dirtyChecker;
    this.svgAnalyzer = svgAnalyzer;
    this.parser = parser;

    this.adapters = [];
    this.logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('observer-locator');
  }

  ObserverLocator.prototype.getObserver = function getObserver(obj, propertyName) {
    var observersLookup = obj.__observers__;
    var observer = void 0;

    if (observersLookup && propertyName in observersLookup) {
      return observersLookup[propertyName];
    }

    observer = this.createPropertyObserver(obj, propertyName);

    if (!observer.doNotCache) {
      if (observersLookup === undefined) {
        observersLookup = this.getOrCreateObserversLookup(obj);
      }

      observersLookup[propertyName] = observer;
    }

    return observer;
  };

  ObserverLocator.prototype.getOrCreateObserversLookup = function getOrCreateObserversLookup(obj) {
    return obj.__observers__ || this.createObserversLookup(obj);
  };

  ObserverLocator.prototype.createObserversLookup = function createObserversLookup(obj) {
    var value = {};

    if (!Reflect.defineProperty(obj, '__observers__', {
      enumerable: false,
      configurable: false,
      writable: false,
      value: value
    })) {
      this.logger.warn('Cannot add observers to object', obj);
    }

    return value;
  };

  ObserverLocator.prototype.addAdapter = function addAdapter(adapter) {
    this.adapters.push(adapter);
  };

  ObserverLocator.prototype.getAdapterObserver = function getAdapterObserver(obj, propertyName, descriptor) {
    for (var i = 0, ii = this.adapters.length; i < ii; i++) {
      var adapter = this.adapters[i];
      var observer = adapter.getObserver(obj, propertyName, descriptor);
      if (observer) {
        return observer;
      }
    }
    return null;
  };

  ObserverLocator.prototype.createPropertyObserver = function createPropertyObserver(obj, propertyName) {
    var descriptor = void 0;
    var handler = void 0;
    var xlinkResult = void 0;

    if (!(obj instanceof Object)) {
      return new PrimitiveObserver(obj, propertyName);
    }

    if (obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element) {
      if (propertyName === 'class') {
        return new ClassObserver(obj);
      }
      if (propertyName === 'style' || propertyName === 'css') {
        return new StyleObserver(obj, propertyName);
      }
      handler = this.eventManager.getElementHandler(obj, propertyName);
      if (propertyName === 'value' && obj.tagName.toLowerCase() === 'select') {
        return new SelectValueObserver(obj, handler, this);
      }
      if (propertyName === 'checked' && obj.tagName.toLowerCase() === 'input') {
        return new CheckedObserver(obj, handler, this);
      }
      if (handler) {
        return new ValueAttributeObserver(obj, propertyName, handler);
      }
      xlinkResult = /^xlink:(.+)$/.exec(propertyName);
      if (xlinkResult) {
        return new XLinkAttributeObserver(obj, propertyName, xlinkResult[1]);
      }
      if (propertyName === 'role' && (obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element || obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].SVGElement) || /^\w+:|^data-|^aria-/.test(propertyName) || obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].SVGElement && this.svgAnalyzer.isStandardSvgAttribute(obj.nodeName, propertyName)) {
        return new DataAttributeObserver(obj, propertyName);
      }
    }

    descriptor = Object.getPropertyDescriptor(obj, propertyName);

    if (hasDeclaredDependencies(descriptor)) {
      return createComputedObserver(obj, propertyName, descriptor, this);
    }

    if (descriptor) {
      var existingGetterOrSetter = descriptor.get || descriptor.set;
      if (existingGetterOrSetter) {
        if (existingGetterOrSetter.getObserver) {
          return existingGetterOrSetter.getObserver(obj);
        }

        var adapterObserver = this.getAdapterObserver(obj, propertyName, descriptor);
        if (adapterObserver) {
          return adapterObserver;
        }
        return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
      }
    }

    if (obj instanceof Array) {
      if (propertyName === 'length') {
        return this.getArrayObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    } else if (obj instanceof Map) {
      if (propertyName === 'size') {
        return this.getMapObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    } else if (obj instanceof Set) {
      if (propertyName === 'size') {
        return this.getSetObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    }

    return new SetterObserver(this.taskQueue, obj, propertyName);
  };

  ObserverLocator.prototype.getAccessor = function getAccessor(obj, propertyName) {
    if (obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element) {
      if (propertyName === 'class' || propertyName === 'style' || propertyName === 'css' || propertyName === 'value' && (obj.tagName.toLowerCase() === 'input' || obj.tagName.toLowerCase() === 'select') || propertyName === 'checked' && obj.tagName.toLowerCase() === 'input' || propertyName === 'model' && obj.tagName.toLowerCase() === 'input' || /^xlink:.+$/.exec(propertyName)) {
        return this.getObserver(obj, propertyName);
      }
      if (/^\w+:|^data-|^aria-/.test(propertyName) || obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].SVGElement && this.svgAnalyzer.isStandardSvgAttribute(obj.nodeName, propertyName) || obj.tagName.toLowerCase() === 'img' && propertyName === 'src' || obj.tagName.toLowerCase() === 'a' && propertyName === 'href') {
        return dataAttributeAccessor;
      }
    }
    return propertyAccessor;
  };

  ObserverLocator.prototype.getArrayObserver = function getArrayObserver(array) {
    return _getArrayObserver(this.taskQueue, array);
  };

  ObserverLocator.prototype.getMapObserver = function getMapObserver(map) {
    return _getMapObserver(this.taskQueue, map);
  };

  ObserverLocator.prototype.getSetObserver = function getSetObserver(set) {
    return _getSetObserver(this.taskQueue, set);
  };

  return ObserverLocator;
}(), _class12.inject = [__WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__["TaskQueue"], EventManager, DirtyChecker, SVGAnalyzer, Parser], _temp);

var ObjectObservationAdapter = function () {
  function ObjectObservationAdapter() {
    
  }

  ObjectObservationAdapter.prototype.getObserver = function getObserver(object, propertyName, descriptor) {
    throw new Error('BindingAdapters must implement getObserver(object, propertyName).');
  };

  return ObjectObservationAdapter;
}();

var BindingExpression = function () {
  function BindingExpression(observerLocator, targetProperty, sourceExpression, mode, lookupFunctions, attribute) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.sourceExpression = sourceExpression;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.attribute = attribute;
    this.discrete = false;
  }

  BindingExpression.prototype.createBinding = function createBinding(target) {
    return new Binding(this.observerLocator, this.sourceExpression, target, this.targetProperty, this.mode, this.lookupFunctions);
  };

  return BindingExpression;
}();

var Binding = (_dec10 = connectable(), _dec10(_class13 = function () {
  function Binding(observerLocator, sourceExpression, target, targetProperty, mode, lookupFunctions) {
    

    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.target = target;
    this.targetProperty = targetProperty;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
  }

  Binding.prototype.updateTarget = function updateTarget(value) {
    this.targetObserver.setValue(value, this.target, this.targetProperty);
  };

  Binding.prototype.updateSource = function updateSource(value) {
    this.sourceExpression.assign(this.source, value, this.lookupFunctions);
  };

  Binding.prototype.call = function call(context, newValue, oldValue) {
    if (!this.isBound) {
      return;
    }
    if (context === sourceContext) {
      oldValue = this.targetObserver.getValue(this.target, this.targetProperty);
      newValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      if (newValue !== oldValue) {
        this.updateTarget(newValue);
      }
      if (this.mode !== bindingMode.oneTime) {
        this._version++;
        this.sourceExpression.connect(this, this.source);
        this.unobserve(false);
      }
      return;
    }
    if (context === targetContext) {
      if (newValue !== this.sourceExpression.evaluate(this.source, this.lookupFunctions)) {
        this.updateSource(newValue);
      }
      return;
    }
    throw new Error('Unexpected call context ' + context);
  };

  Binding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }

    var mode = this.mode;
    if (!this.targetObserver) {
      var method = mode === bindingMode.twoWay || mode === bindingMode.fromView ? 'getObserver' : 'getAccessor';
      this.targetObserver = this.observerLocator[method](this.target, this.targetProperty);
    }

    if ('bind' in this.targetObserver) {
      this.targetObserver.bind();
    }
    if (this.mode !== bindingMode.fromView) {
      var value = this.sourceExpression.evaluate(source, this.lookupFunctions);
      this.updateTarget(value);
    }

    if (mode === bindingMode.oneTime) {
      return;
    } else if (mode === bindingMode.toView) {
      enqueueBindingConnect(this);
    } else if (mode === bindingMode.twoWay) {
      this.sourceExpression.connect(this, source);
      this.targetObserver.subscribe(targetContext, this);
    } else if (mode === bindingMode.fromView) {
      this.targetObserver.subscribe(targetContext, this);
    }
  };

  Binding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    if ('unbind' in this.targetObserver) {
      this.targetObserver.unbind();
    }
    if (this.targetObserver.unsubscribe) {
      this.targetObserver.unsubscribe(targetContext, this);
    }
    this.unobserve(true);
  };

  Binding.prototype.connect = function connect(evaluate) {
    if (!this.isBound) {
      return;
    }
    if (evaluate) {
      var value = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      this.updateTarget(value);
    }
    this.sourceExpression.connect(this, this.source);
  };

  return Binding;
}()) || _class13);

var CallExpression = function () {
  function CallExpression(observerLocator, targetProperty, sourceExpression, lookupFunctions) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.sourceExpression = sourceExpression;
    this.lookupFunctions = lookupFunctions;
  }

  CallExpression.prototype.createBinding = function createBinding(target) {
    return new Call(this.observerLocator, this.sourceExpression, target, this.targetProperty, this.lookupFunctions);
  };

  return CallExpression;
}();

var Call = function () {
  function Call(observerLocator, sourceExpression, target, targetProperty, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.target = target;
    this.targetProperty = observerLocator.getObserver(target, targetProperty);
    this.lookupFunctions = lookupFunctions;
  }

  Call.prototype.callSource = function callSource($event) {
    var overrideContext = this.source.overrideContext;
    Object.assign(overrideContext, $event);
    overrideContext.$event = $event;
    var mustEvaluate = true;
    var result = this.sourceExpression.evaluate(this.source, this.lookupFunctions, mustEvaluate);
    delete overrideContext.$event;
    for (var prop in $event) {
      delete overrideContext[prop];
    }
    return result;
  };

  Call.prototype.bind = function bind(source) {
    var _this26 = this;

    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this.targetProperty.setValue(function ($event) {
      return _this26.callSource($event);
    });
  };

  Call.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this.targetProperty.setValue(null);
  };

  return Call;
}();

var ValueConverterResource = function () {
  function ValueConverterResource(name) {
    

    this.name = name;
  }

  ValueConverterResource.convention = function convention(name) {
    if (name.endsWith('ValueConverter')) {
      return new ValueConverterResource(camelCase(name.substring(0, name.length - 14)));
    }
  };

  ValueConverterResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  ValueConverterResource.prototype.register = function register(registry, name) {
    registry.registerValueConverter(name || this.name, this.instance);
  };

  ValueConverterResource.prototype.load = function load(container, target) {};

  return ValueConverterResource;
}();

function valueConverter(nameOrTarget) {
  if (nameOrTarget === undefined || typeof nameOrTarget === 'string') {
    return function (target) {
      __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new ValueConverterResource(nameOrTarget), target);
    };
  }

  __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new ValueConverterResource(), nameOrTarget);
}

var BindingBehaviorResource = function () {
  function BindingBehaviorResource(name) {
    

    this.name = name;
  }

  BindingBehaviorResource.convention = function convention(name) {
    if (name.endsWith('BindingBehavior')) {
      return new BindingBehaviorResource(camelCase(name.substring(0, name.length - 15)));
    }
  };

  BindingBehaviorResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  BindingBehaviorResource.prototype.register = function register(registry, name) {
    registry.registerBindingBehavior(name || this.name, this.instance);
  };

  BindingBehaviorResource.prototype.load = function load(container, target) {};

  return BindingBehaviorResource;
}();

function bindingBehavior(nameOrTarget) {
  if (nameOrTarget === undefined || typeof nameOrTarget === 'string') {
    return function (target) {
      __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new BindingBehaviorResource(nameOrTarget), target);
    };
  }

  __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new BindingBehaviorResource(), nameOrTarget);
}

var ListenerExpression = function () {
  function ListenerExpression(eventManager, targetEvent, sourceExpression, delegationStrategy, preventDefault, lookupFunctions) {
    

    this.eventManager = eventManager;
    this.targetEvent = targetEvent;
    this.sourceExpression = sourceExpression;
    this.delegationStrategy = delegationStrategy;
    this.discrete = true;
    this.preventDefault = preventDefault;
    this.lookupFunctions = lookupFunctions;
  }

  ListenerExpression.prototype.createBinding = function createBinding(target) {
    return new Listener(this.eventManager, this.targetEvent, this.delegationStrategy, this.sourceExpression, target, this.preventDefault, this.lookupFunctions);
  };

  return ListenerExpression;
}();

var Listener = function () {
  function Listener(eventManager, targetEvent, delegationStrategy, sourceExpression, target, preventDefault, lookupFunctions) {
    

    this.eventManager = eventManager;
    this.targetEvent = targetEvent;
    this.delegationStrategy = delegationStrategy;
    this.sourceExpression = sourceExpression;
    this.target = target;
    this.preventDefault = preventDefault;
    this.lookupFunctions = lookupFunctions;
  }

  Listener.prototype.callSource = function callSource(event) {
    var overrideContext = this.source.overrideContext;
    overrideContext.$event = event;
    var mustEvaluate = true;
    var result = this.sourceExpression.evaluate(this.source, this.lookupFunctions, mustEvaluate);
    delete overrideContext.$event;
    if (result !== true && this.preventDefault) {
      event.preventDefault();
    }
    return result;
  };

  Listener.prototype.handleEvent = function handleEvent(event) {
    this.callSource(event);
  };

  Listener.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this._handler = this.eventManager.addEventListener(this.target, this.targetEvent, this, this.delegationStrategy, true);
  };

  Listener.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this._handler.dispose();
    this._handler = null;
  };

  return Listener;
}();

function getAU(element) {
  var au = element.au;

  if (au === undefined) {
    throw new Error('No Aurelia APIs are defined for the element: "' + element.tagName + '".');
  }

  return au;
}

var NameExpression = function () {
  function NameExpression(sourceExpression, apiName, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.apiName = apiName;
    this.lookupFunctions = lookupFunctions;
    this.discrete = true;
  }

  NameExpression.prototype.createBinding = function createBinding(target) {
    return new NameBinder(this.sourceExpression, NameExpression.locateAPI(target, this.apiName), this.lookupFunctions);
  };

  NameExpression.locateAPI = function locateAPI(element, apiName) {
    switch (apiName) {
      case 'element':
        return element;
      case 'controller':
        return getAU(element).controller;
      case 'view-model':
        return getAU(element).controller.viewModel;
      case 'view':
        return getAU(element).controller.view;
      default:
        var target = getAU(element)[apiName];

        if (target === undefined) {
          throw new Error('Attempted to reference "' + apiName + '", but it was not found amongst the target\'s API.');
        }

        return target.viewModel;
    }
  };

  return NameExpression;
}();

var NameBinder = function () {
  function NameBinder(sourceExpression, target, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.target = target;
    this.lookupFunctions = lookupFunctions;
  }

  NameBinder.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;
    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this.sourceExpression.assign(this.source, this.target, this.lookupFunctions);
  };

  NameBinder.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.evaluate(this.source, this.lookupFunctions) === this.target) {
      this.sourceExpression.assign(this.source, null, this.lookupFunctions);
    }
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
  };

  return NameBinder;
}();

var LookupFunctions = {
  bindingBehaviors: function bindingBehaviors(name) {
    return null;
  },
  valueConverters: function valueConverters(name) {
    return null;
  }
};

var BindingEngine = (_temp2 = _class14 = function () {
  function BindingEngine(observerLocator, parser) {
    

    this.observerLocator = observerLocator;
    this.parser = parser;
  }

  BindingEngine.prototype.createBindingExpression = function createBindingExpression(targetProperty, sourceExpression) {
    var mode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : bindingMode.toView;
    var lookupFunctions = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : LookupFunctions;

    return new BindingExpression(this.observerLocator, targetProperty, this.parser.parse(sourceExpression), mode, lookupFunctions);
  };

  BindingEngine.prototype.propertyObserver = function propertyObserver(obj, propertyName) {
    var _this27 = this;

    return {
      subscribe: function subscribe(callback) {
        var observer = _this27.observerLocator.getObserver(obj, propertyName);
        observer.subscribe(callback);
        return {
          dispose: function dispose() {
            return observer.unsubscribe(callback);
          }
        };
      }
    };
  };

  BindingEngine.prototype.collectionObserver = function collectionObserver(collection) {
    var _this28 = this;

    return {
      subscribe: function subscribe(callback) {
        var observer = void 0;
        if (collection instanceof Array) {
          observer = _this28.observerLocator.getArrayObserver(collection);
        } else if (collection instanceof Map) {
          observer = _this28.observerLocator.getMapObserver(collection);
        } else if (collection instanceof Set) {
          observer = _this28.observerLocator.getSetObserver(collection);
        } else {
          throw new Error('collection must be an instance of Array, Map or Set.');
        }
        observer.subscribe(callback);
        return {
          dispose: function dispose() {
            return observer.unsubscribe(callback);
          }
        };
      }
    };
  };

  BindingEngine.prototype.expressionObserver = function expressionObserver(bindingContext, expression) {
    var scope = { bindingContext: bindingContext, overrideContext: createOverrideContext(bindingContext) };
    return new ExpressionObserver(scope, this.parser.parse(expression), this.observerLocator, LookupFunctions);
  };

  BindingEngine.prototype.parseExpression = function parseExpression(expression) {
    return this.parser.parse(expression);
  };

  BindingEngine.prototype.registerAdapter = function registerAdapter(adapter) {
    this.observerLocator.addAdapter(adapter);
  };

  return BindingEngine;
}(), _class14.inject = [ObserverLocator, Parser], _temp2);

var setProto = Set.prototype;

function _getSetObserver(taskQueue, set) {
  return ModifySetObserver.for(taskQueue, set);
}

var ModifySetObserver = function (_ModifyCollectionObse3) {
  _inherits(ModifySetObserver, _ModifyCollectionObse3);

  function ModifySetObserver(taskQueue, set) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse3.call(this, taskQueue, set));
  }

  ModifySetObserver.for = function _for(taskQueue, set) {
    if (!('__set_observer__' in set)) {
      Reflect.defineProperty(set, '__set_observer__', {
        value: ModifySetObserver.create(taskQueue, set),
        enumerable: false, configurable: false
      });
    }
    return set.__set_observer__;
  };

  ModifySetObserver.create = function create(taskQueue, set) {
    var observer = new ModifySetObserver(taskQueue, set);

    var proto = setProto;
    if (proto.add !== set.add || proto.delete !== set.delete || proto.clear !== set.clear) {
      proto = {
        add: set.add,
        delete: set.delete,
        clear: set.clear
      };
    }

    set.add = function () {
      var type = 'add';
      var oldSize = set.size;
      var methodCallResult = proto.add.apply(set, arguments);
      var hasValue = set.size === oldSize;
      if (!hasValue) {
        observer.addChangeRecord({
          type: type,
          object: set,
          value: Array.from(set).pop()
        });
      }
      return methodCallResult;
    };

    set.delete = function () {
      var hasValue = set.has(arguments[0]);
      var methodCallResult = proto.delete.apply(set, arguments);
      if (hasValue) {
        observer.addChangeRecord({
          type: 'delete',
          object: set,
          value: arguments[0]
        });
      }
      return methodCallResult;
    };

    set.clear = function () {
      var methodCallResult = proto.clear.apply(set, arguments);
      observer.addChangeRecord({
        type: 'clear',
        object: set
      });
      return methodCallResult;
    };

    return observer;
  };

  return ModifySetObserver;
}(ModifyCollectionObserver);

function observable(targetOrConfig, key, descriptor) {
  function deco(target, key, descriptor, config) {
    var isClassDecorator = key === undefined;
    if (isClassDecorator) {
      target = target.prototype;
      key = typeof config === 'string' ? config : config.name;
    }

    var innerPropertyName = '_' + key;
    var innerPropertyDescriptor = {
      configurable: true,
      enumerable: false,
      writable: true
    };

    var callbackName = config && config.changeHandler || key + 'Changed';

    if (descriptor) {
      if (typeof descriptor.initializer === 'function') {
        innerPropertyDescriptor.value = descriptor.initializer();
      }
    } else {
      descriptor = {};
    }

    if (!('enumerable' in descriptor)) {
      descriptor.enumerable = true;
    }

    delete descriptor.value;
    delete descriptor.writable;
    delete descriptor.initializer;

    Reflect.defineProperty(target, innerPropertyName, innerPropertyDescriptor);

    descriptor.get = function () {
      return this[innerPropertyName];
    };
    descriptor.set = function (newValue) {
      var oldValue = this[innerPropertyName];
      if (newValue === oldValue) {
        return;
      }

      this[innerPropertyName] = newValue;
      Reflect.defineProperty(this, innerPropertyName, { enumerable: false });

      if (this[callbackName]) {
        this[callbackName](newValue, oldValue, key);
      }
    };

    descriptor.get.dependencies = [innerPropertyName];

    if (isClassDecorator) {
      Reflect.defineProperty(target, key, descriptor);
    } else {
      return descriptor;
    }
  }

  if (key === undefined) {
    return function (t, k, d) {
      return deco(t, k, d, targetOrConfig);
    };
  }
  return deco(targetOrConfig, key, descriptor);
}

var signals = {};

function connectBindingToSignal(binding, name) {
  if (!signals.hasOwnProperty(name)) {
    signals[name] = 0;
  }
  binding.observeProperty(signals, name);
}

function signalBindings(name) {
  if (signals.hasOwnProperty(name)) {
    signals[name]++;
  }
}

/***/ },

/***/ "aurelia-event-aggregator":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "EventAggregator", function() { return EventAggregator; });
/* harmony export (immutable) */ exports["includeEventsIn"] = includeEventsIn;
/* harmony export (immutable) */ exports["configure"] = configure;




var logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('event-aggregator');

var Handler = function () {
  function Handler(messageType, callback) {
    

    this.messageType = messageType;
    this.callback = callback;
  }

  Handler.prototype.handle = function handle(message) {
    if (message instanceof this.messageType) {
      this.callback.call(null, message);
    }
  };

  return Handler;
}();

function invokeCallback(callback, data, event) {
  try {
    callback(data, event);
  } catch (e) {
    logger.error(e);
  }
}

function invokeHandler(handler, data) {
  try {
    handler.handle(data);
  } catch (e) {
    logger.error(e);
  }
}

var EventAggregator = function () {
  function EventAggregator() {
    

    this.eventLookup = {};
    this.messageHandlers = [];
  }

  EventAggregator.prototype.publish = function publish(event, data) {
    var subscribers = void 0;
    var i = void 0;

    if (!event) {
      throw new Error('Event was invalid.');
    }

    if (typeof event === 'string') {
      subscribers = this.eventLookup[event];
      if (subscribers) {
        subscribers = subscribers.slice();
        i = subscribers.length;

        while (i--) {
          invokeCallback(subscribers[i], data, event);
        }
      }
    } else {
      subscribers = this.messageHandlers.slice();
      i = subscribers.length;

      while (i--) {
        invokeHandler(subscribers[i], event);
      }
    }
  };

  EventAggregator.prototype.subscribe = function subscribe(event, callback) {
    var handler = void 0;
    var subscribers = void 0;

    if (!event) {
      throw new Error('Event channel/type was invalid.');
    }

    if (typeof event === 'string') {
      handler = callback;
      subscribers = this.eventLookup[event] || (this.eventLookup[event] = []);
    } else {
      handler = new Handler(event, callback);
      subscribers = this.messageHandlers;
    }

    subscribers.push(handler);

    return {
      dispose: function dispose() {
        var idx = subscribers.indexOf(handler);
        if (idx !== -1) {
          subscribers.splice(idx, 1);
        }
      }
    };
  };

  EventAggregator.prototype.subscribeOnce = function subscribeOnce(event, callback) {
    var sub = this.subscribe(event, function (a, b) {
      sub.dispose();
      return callback(a, b);
    });

    return sub;
  };

  return EventAggregator;
}();

function includeEventsIn(obj) {
  var ea = new EventAggregator();

  obj.subscribeOnce = function (event, callback) {
    return ea.subscribeOnce(event, callback);
  };

  obj.subscribe = function (event, callback) {
    return ea.subscribe(event, callback);
  };

  obj.publish = function (event, data) {
    ea.publish(event, data);
  };

  return ea;
}

function configure(config) {
  config.instance(EventAggregator, includeEventsIn(config.aurelia));
}

/***/ },

/***/ "aurelia-framework":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_loader__ = __webpack_require__("aurelia-loader");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_loader___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_aurelia_loader__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_aurelia_task_queue__ = __webpack_require__(138);
/* harmony export (binding) */ __webpack_require__.d(exports, "Aurelia", function() { return Aurelia; });
/* harmony export (binding) */ __webpack_require__.d(exports, "FrameworkConfiguration", function() { return FrameworkConfiguration; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "_emptyParameters", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["_emptyParameters"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "InvocationHandler", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["InvocationHandler"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Container", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Container"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "autoinject", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["autoinject"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "inject", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["inject"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "invoker", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["invoker"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "invokeAsFactory", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["invokeAsFactory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "FactoryInvoker", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["FactoryInvoker"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "registration", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["registration"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "transient", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["transient"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "singleton", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["singleton"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TransientRegistration", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["TransientRegistration"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SingletonRegistration", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["SingletonRegistration"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "resolver", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["resolver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Strategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Strategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "StrategyResolver", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["StrategyResolver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Lazy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Lazy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "All", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["All"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Optional", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Optional"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Parent", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Parent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Factory", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Factory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "NewInstance", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["NewInstance"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getDecoratorDependencies", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["getDecoratorDependencies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "lazy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["lazy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "all", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["all"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "optional", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["optional"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "parent", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["parent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "factory", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["factory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "newInstance", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["newInstance"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getArrayObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getArrayObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getMapObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getMapObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getSetObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getSetObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "targetContext", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["targetContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "sourceContext", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["sourceContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "camelCase", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["camelCase"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "createOverrideContext", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["createOverrideContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getContextFor", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getContextFor"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "createScopeForTest", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["createScopeForTest"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "connectable", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["connectable"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "enqueueBindingConnect", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["enqueueBindingConnect"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "setConnectQueueThreshold", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["setConnectQueueThreshold"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "enableConnectQueue", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["enableConnectQueue"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "disableConnectQueue", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["disableConnectQueue"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getConnectQueueSize", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getConnectQueueSize"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "subscriberCollection", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["subscriberCollection"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ExpressionObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ExpressionObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "calcSplices", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["calcSplices"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "mergeSplice", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["mergeSplice"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "projectArraySplices", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["projectArraySplices"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getChangeRecords", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getChangeRecords"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ModifyCollectionObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ModifyCollectionObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CollectionLengthObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CollectionLengthObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Expression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Expression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingBehavior", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingBehavior"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ValueConverter", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ValueConverter"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Assign", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Assign"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Conditional", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Conditional"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessThis", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessThis"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessScope", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessScope"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessMember", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessMember"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessKeyed", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessKeyed"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallScope", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallScope"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallMember", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallMember"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallFunction", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallFunction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Binary", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Binary"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Unary", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Unary"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralPrimitive", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralPrimitive"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralString", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralString"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralTemplate", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralTemplate"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralArray", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralArray"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralObject", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralObject"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Unparser", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Unparser"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ExpressionCloner", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ExpressionCloner"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "cloneExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["cloneExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "bindingMode", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["bindingMode"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Parser", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Parser"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ParserImplementation", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ParserImplementation"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "delegationStrategy", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["delegationStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "EventManager", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["EventManager"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "EventSubscriber", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["EventSubscriber"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DirtyChecker", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["DirtyChecker"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DirtyCheckProperty", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["DirtyCheckProperty"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "propertyAccessor", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["propertyAccessor"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "PrimitiveObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["PrimitiveObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SetterObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["SetterObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "XLinkAttributeObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["XLinkAttributeObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "dataAttributeAccessor", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["dataAttributeAccessor"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DataAttributeObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["DataAttributeObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "StyleObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["StyleObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ValueAttributeObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ValueAttributeObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CheckedObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CheckedObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SelectValueObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["SelectValueObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ClassObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ClassObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "hasDeclaredDependencies", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["hasDeclaredDependencies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "declarePropertyDependencies", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["declarePropertyDependencies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "computedFrom", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["computedFrom"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ComputedExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ComputedExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "createComputedObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["createComputedObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "elements", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["elements"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "presentationElements", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["presentationElements"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "presentationAttributes", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["presentationAttributes"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SVGAnalyzer", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["SVGAnalyzer"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ObserverLocator", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ObserverLocator"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ObjectObservationAdapter", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ObjectObservationAdapter"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Binding", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Binding"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Call", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Call"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ValueConverterResource", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ValueConverterResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "valueConverter", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["valueConverter"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingBehaviorResource", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingBehaviorResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "bindingBehavior", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["bindingBehavior"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ListenerExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ListenerExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Listener", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Listener"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "NameExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["NameExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingEngine", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "observable", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["observable"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "connectBindingToSignal", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["connectBindingToSignal"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "signalBindings", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["signalBindings"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "metadata", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["metadata"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Origin", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["Origin"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "decorators", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["decorators"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "deprecated", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["deprecated"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "mixin", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "protocol", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["protocol"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "animationEvent", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["animationEvent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Animator", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["Animator"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionTransactionNotifier", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionTransactionNotifier"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionTransactionOwnershipToken", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionTransactionOwnershipToken"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionTransaction", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionTransaction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "_hyphenate", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["_hyphenate"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "_isAllWhitespace", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["_isAllWhitespace"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewEngineHooksResource", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngineHooksResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "viewEngineHooks", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["viewEngineHooks"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ElementEvents", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ElementEvents"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ResourceLoadContext", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ResourceLoadContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewCompileInstruction", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewCompileInstruction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BehaviorInstruction", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BehaviorInstruction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TargetInstruction", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TargetInstruction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "viewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["viewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "RelativeViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["RelativeViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ConventionalViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ConventionalViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "NoViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["NoViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TemplateRegistryViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TemplateRegistryViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "InlineViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["InlineViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "StaticViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["StaticViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewLocator", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewLocator"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingLanguage", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BindingLanguage"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SlotCustomAttribute", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["SlotCustomAttribute"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "PassThroughSlot", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["PassThroughSlot"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ShadowSlot", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ShadowSlot"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ShadowDOM", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ShadowDOM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "validateBehaviorName", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["validateBehaviorName"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewResources", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "View", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["View"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewSlot", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BoundViewFactory", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewFactory", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewFactory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewCompiler", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewCompiler"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ResourceModule", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ResourceModule"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ResourceDescription", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ResourceDescription"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ModuleAnalyzer", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ModuleAnalyzer"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewEngine", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Controller", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["Controller"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BehaviorPropertyObserver", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BehaviorPropertyObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindableProperty", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BindableProperty"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "HtmlBehaviorResource", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["HtmlBehaviorResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "children", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["children"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "child", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["child"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SwapStrategies", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["SwapStrategies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionEngine", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ElementConfigResource", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ElementConfigResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "resource", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["resource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "behavior", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["behavior"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "customElement", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "customAttribute", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "templateController", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "bindable", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "dynamicOptions", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["dynamicOptions"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "useShadowDOM", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "processAttributes", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["processAttributes"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "processContent", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["processContent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "containerless", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["containerless"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "useViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "useView", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useView"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "inlineView", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["inlineView"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "noView", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["noView"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "view", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["view"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "elementConfig", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["elementConfig"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "viewResources", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["viewResources"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TemplatingEngine", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TemplatingEngine"]; });
/* harmony namespace reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in __WEBPACK_IMPORTED_MODULE_2_aurelia_loader__) if(["Aurelia","FrameworkConfiguration","LogManager","default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(exports, key, function() { return __WEBPACK_IMPORTED_MODULE_2_aurelia_loader__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TaskQueue", function() { return __WEBPACK_IMPORTED_MODULE_8_aurelia_task_queue__["TaskQueue"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "relativeToFile", function() { return __WEBPACK_IMPORTED_MODULE_5_aurelia_path__["relativeToFile"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "join", function() { return __WEBPACK_IMPORTED_MODULE_5_aurelia_path__["join"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "buildQueryString", function() { return __WEBPACK_IMPORTED_MODULE_5_aurelia_path__["buildQueryString"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "parseQueryString", function() { return __WEBPACK_IMPORTED_MODULE_5_aurelia_path__["parseQueryString"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AggregateError", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["AggregateError"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "FEATURE", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["FEATURE"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "PLATFORM", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["PLATFORM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DOM", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "isInitialized", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["isInitialized"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "initializePAL", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["initializePAL"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "reset", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["reset"]; });







function preventActionlessFormSubmit() {
  __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].addEventListener('submit', evt => {
    const target = evt.target;
    const action = target.action;

    if (target.tagName.toLowerCase() === 'form' && !action) {
      evt.preventDefault();
    }
  });
}

let Aurelia = class Aurelia {
  constructor(loader, container, resources) {
    this.loader = loader || new __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["PLATFORM"].Loader();
    this.container = container || new __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Container"]().makeGlobal();
    this.resources = resources || new __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"]();
    this.use = new FrameworkConfiguration(this);
    this.logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('aurelia');
    this.hostConfigured = false;
    this.host = null;

    this.use.instance(Aurelia, this);
    this.use.instance(__WEBPACK_IMPORTED_MODULE_2_aurelia_loader__["Loader"], this.loader);
    this.use.instance(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"], this.resources);
  }

  start() {
    if (this._started) {
      return this._started;
    }

    this.logger.info('Aurelia Starting');
    return this._started = this.use.apply().then(() => {
      preventActionlessFormSubmit();

      if (!this.container.hasResolver(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BindingLanguage"])) {
        let message = 'You must configure Aurelia with a BindingLanguage implementation.';
        this.logger.error(message);
        throw new Error(message);
      }

      this.logger.info('Aurelia Started');
      let evt = __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].createCustomEvent('aurelia-started', { bubbles: true, cancelable: true });
      __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].dispatchEvent(evt);
      return this;
    });
  }

  enhance(bindingContext = {}, applicationHost = null) {
    this._configureHost(applicationHost || __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].querySelectorAll('body')[0]);

    return new Promise(resolve => {
      let engine = this.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TemplatingEngine"]);
      this.root = engine.enhance({ container: this.container, element: this.host, resources: this.resources, bindingContext: bindingContext });
      this.root.attached();
      this._onAureliaComposed();
      resolve(this);
    });
  }

  setRoot(root = null, applicationHost = null) {
    let instruction = {};

    if (this.root && this.root.viewModel && this.root.viewModel.router) {
      this.root.viewModel.router.deactivate();
      this.root.viewModel.router.reset();
    }

    this._configureHost(applicationHost);

    let engine = this.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TemplatingEngine"]);
    let transaction = this.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionTransaction"]);
    delete transaction.initialComposition;

    if (!root) {
      if (this.configModuleId) {
        root = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_path__["relativeToFile"])('./app', this.configModuleId);
      } else {
        root = 'app';
      }
    }

    instruction.viewModel = root;
    instruction.container = instruction.childContainer = this.container;
    instruction.viewSlot = this.hostSlot;
    instruction.host = this.host;

    return engine.compose(instruction).then(r => {
      this.root = r;
      instruction.viewSlot.attached();
      this._onAureliaComposed();
      return this;
    });
  }

  _configureHost(applicationHost) {
    if (this.hostConfigured) {
      return;
    }
    applicationHost = applicationHost || this.host;

    if (!applicationHost || typeof applicationHost === 'string') {
      this.host = __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].getElementById(applicationHost || 'applicationHost');
    } else {
      this.host = applicationHost;
    }

    if (!this.host) {
      throw new Error('No applicationHost was specified.');
    }

    this.hostConfigured = true;
    this.host.aurelia = this;
    this.hostSlot = new __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"](this.host, true);
    this.hostSlot.transformChildNodesIntoView();
    this.container.registerInstance(__WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].boundary, this.host);
  }

  _onAureliaComposed() {
    let evt = __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].createCustomEvent('aurelia-composed', { bubbles: true, cancelable: true });
    setTimeout(() => __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].dispatchEvent(evt), 1);
  }
};

const logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('aurelia');
const extPattern = /\.[^/.]+$/;

function runTasks(config, tasks) {
  let current;
  let next = () => {
    current = tasks.shift();
    if (current) {
      return Promise.resolve(current(config)).then(next);
    }

    return Promise.resolve();
  };

  return next();
}

function loadPlugin(fwConfig, loader, info) {
  logger.debug(`Loading plugin ${info.moduleId}.`);
  if (typeof info.moduleId === 'string') {
    fwConfig.resourcesRelativeTo = info.resourcesRelativeTo;

    let id = info.moduleId;

    if (info.resourcesRelativeTo.length > 1) {
      return loader.normalize(info.moduleId, info.resourcesRelativeTo[1]).then(normalizedId => _loadPlugin(normalizedId));
    }

    return _loadPlugin(id);
  } else if (typeof info.configure === 'function') {
    if (fwConfig.configuredPlugins.indexOf(info.configure) !== -1) {
      return Promise.resolve();
    }
    fwConfig.configuredPlugins.push(info.configure);

    return Promise.resolve(info.configure.call(null, fwConfig, info.config || {}));
  }
  throw new Error(invalidConfigMsg(info.moduleId || info.configure, 'plugin'));

  function _loadPlugin(moduleId) {
    return loader.loadModule(moduleId).then(m => {
      if ('configure' in m) {
        if (fwConfig.configuredPlugins.indexOf(m.configure) !== -1) {
          return Promise.resolve();
        }
        return Promise.resolve(m.configure(fwConfig, info.config || {})).then(() => {
          fwConfig.configuredPlugins.push(m.configure);
          fwConfig.resourcesRelativeTo = null;
          logger.debug(`Configured plugin ${info.moduleId}.`);
        });
      }

      fwConfig.resourcesRelativeTo = null;
      logger.debug(`Loaded plugin ${info.moduleId}.`);
    });
  }
}

function loadResources(aurelia, resourcesToLoad, appResources) {
  if (Object.keys(resourcesToLoad).length === 0) {
    return Promise.resolve();
  }
  let viewEngine = aurelia.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngine"]);

  return Promise.all(Object.keys(resourcesToLoad).map(n => _normalize(resourcesToLoad[n]))).then(loads => {
    let names = [];
    let importIds = [];

    loads.forEach(l => {
      names.push(undefined);
      importIds.push(l.importId);
    });

    return viewEngine.importViewResources(importIds, names, appResources);
  });

  function _normalize(load) {
    let moduleId = load.moduleId;
    let ext = getExt(moduleId);

    if (isOtherResource(moduleId)) {
      moduleId = removeExt(moduleId);
    }

    return aurelia.loader.normalize(moduleId, load.relativeTo).then(normalized => {
      return {
        name: load.moduleId,
        importId: isOtherResource(load.moduleId) ? addOriginalExt(normalized, ext) : normalized
      };
    });
  }

  function isOtherResource(name) {
    let ext = getExt(name);
    if (!ext) return false;
    if (ext === '') return false;
    if (ext === '.js' || ext === '.ts') return false;
    return true;
  }

  function removeExt(name) {
    return name.replace(extPattern, '');
  }

  function addOriginalExt(normalized, ext) {
    return removeExt(normalized) + '.' + ext;
  }
}

function getExt(name) {
  let match = name.match(extPattern);
  if (match && match.length > 0) {
    return match[0].split('.')[1];
  }
}

function loadBehaviors(config) {
  return Promise.all(config.behaviorsToLoad.map(m => m.load(config.container, m.target))).then(() => {
    config.behaviorsToLoad = null;
  });
}

function assertProcessed(plugins) {
  if (plugins.processed) {
    throw new Error('This config instance has already been applied. To load more plugins or global resources, create a new FrameworkConfiguration instance.');
  }
}

function invalidConfigMsg(cfg, type) {
  return `Invalid ${type} [${cfg}], ${type} must be specified as functions or relative module IDs.`;
}

let FrameworkConfiguration = class FrameworkConfiguration {
  constructor(aurelia) {
    this.aurelia = aurelia;
    this.container = aurelia.container;

    this.info = [];
    this.processed = false;
    this.preTasks = [];
    this.postTasks = [];

    this.behaviorsToLoad = [];

    this.configuredPlugins = [];
    this.resourcesToLoad = {};
    this.preTask(() => aurelia.loader.normalize('aurelia-bootstrapper').then(name => this.bootstrapperName = name));
    this.postTask(() => loadResources(aurelia, this.resourcesToLoad, aurelia.resources));
  }

  instance(type, instance) {
    this.container.registerInstance(type, instance);
    return this;
  }

  singleton(type, implementation) {
    this.container.registerSingleton(type, implementation);
    return this;
  }

  transient(type, implementation) {
    this.container.registerTransient(type, implementation);
    return this;
  }

  preTask(task) {
    assertProcessed(this);
    this.preTasks.push(task);
    return this;
  }

  postTask(task) {
    assertProcessed(this);
    this.postTasks.push(task);
    return this;
  }

  feature(plugin, config = {}) {
    switch (typeof plugin) {
      case 'string':
        let hasIndex = /\/index$/i.test(plugin);
        let moduleId = hasIndex || getExt(plugin) ? plugin : plugin + '/index';
        let root = hasIndex ? plugin.substr(0, plugin.length - 6) : plugin;
        this.info.push({ moduleId, resourcesRelativeTo: [root, ''], config });
        break;

      case 'function':
        this.info.push({ configure: plugin, config: config || {} });
        break;
      default:
        throw new Error(invalidConfigMsg(plugin, 'feature'));
    }
    return this;
  }

  globalResources(resources) {
    assertProcessed(this);

    let toAdd = Array.isArray(resources) ? resources : arguments;
    let resource;
    let resourcesRelativeTo = this.resourcesRelativeTo || ['', ''];

    for (let i = 0, ii = toAdd.length; i < ii; ++i) {
      resource = toAdd[i];
      switch (typeof resource) {
        case 'string':
          let parent = resourcesRelativeTo[0];
          let grandParent = resourcesRelativeTo[1];
          let name = resource;

          if ((resource.startsWith('./') || resource.startsWith('../')) && parent !== '') {
            name = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_path__["join"])(parent, resource);
          }

          this.resourcesToLoad[name] = { moduleId: name, relativeTo: grandParent };
          break;
        case 'function':
          let meta = this.aurelia.resources.autoRegister(this.container, resource);
          if (meta instanceof __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["HtmlBehaviorResource"] && meta.elementName !== null) {
            if (this.behaviorsToLoad.push(meta) === 1) {
              this.postTask(() => loadBehaviors(this));
            }
          }
          break;
        default:
          throw new Error(invalidConfigMsg(resource, 'resource'));
      }
    }

    return this;
  }

  globalName(resourcePath, newName) {
    assertProcessed(this);
    this.resourcesToLoad[resourcePath] = { moduleId: newName, relativeTo: '' };
    return this;
  }

  plugin(plugin, pluginConfig) {
    assertProcessed(this);

    let info;
    switch (typeof plugin) {
      case 'string':
        info = { moduleId: plugin, resourcesRelativeTo: [plugin, ''], config: pluginConfig || {} };
        break;
      case 'function':
        info = { configure: plugin, config: pluginConfig || {} };
        break;
      default:
        throw new Error(invalidConfigMsg(plugin, 'plugin'));
    }
    this.info.push(info);
    return this;
  }

  _addNormalizedPlugin(name, config) {
    let plugin = { moduleId: name, resourcesRelativeTo: [name, ''], config: config || {} };
    this.info.push(plugin);

    this.preTask(() => {
      let relativeTo = [name, this.bootstrapperName];
      plugin.moduleId = name;
      plugin.resourcesRelativeTo = relativeTo;
      return Promise.resolve();
    });

    return this;
  }

  defaultBindingLanguage() {
    return this._addNormalizedPlugin('aurelia-templating-binding');
  }

  router() {
    return this._addNormalizedPlugin('aurelia-templating-router');
  }

  history() {
    return this._addNormalizedPlugin('aurelia-history-browser');
  }

  defaultResources() {
    return this._addNormalizedPlugin('aurelia-templating-resources');
  }

  eventAggregator() {
    return this._addNormalizedPlugin('aurelia-event-aggregator');
  }

  basicConfiguration() {
    return this.defaultBindingLanguage().defaultResources().eventAggregator();
  }

  standardConfiguration() {
    return this.basicConfiguration().history().router();
  }

  developmentLogging(level) {
    let logLevel = level ? __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["logLevel"][level] : undefined;

    if (logLevel === undefined) {
      logLevel = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["logLevel"].debug;
    }

    this.preTask(() => {
      return this.aurelia.loader.normalize('aurelia-logging-console', this.bootstrapperName).then(name => {
        return this.aurelia.loader.loadModule(name).then(m => {
          __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["addAppender"](new m.ConsoleAppender());
          __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["setLevel"](logLevel);
        });
      });
    });

    return this;
  }

  apply() {
    if (this.processed) {
      return Promise.resolve();
    }

    return runTasks(this, this.preTasks).then(() => {
      let loader = this.aurelia.loader;
      let info = this.info;
      let current;

      let next = () => {
        current = info.shift();
        if (current) {
          return loadPlugin(this, loader, current).then(next);
        }

        this.processed = true;
        this.configuredPlugins = null;
        return Promise.resolve();
      };

      return next().then(() => runTasks(this, this.postTasks));
    });
  }
};










const LogManager = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__;
/* harmony export (immutable) */ exports["LogManager"] = LogManager;

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ "aurelia-history-browser":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_history__ = __webpack_require__(213);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony export (binding) */ __webpack_require__.d(exports, "BrowserHistory", function() { return BrowserHistory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DefaultLinkHandler", function() { return DefaultLinkHandler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LinkHandler", function() { return LinkHandler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure; });



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var LinkHandler = (function () {
    function LinkHandler() {
    }
    LinkHandler.prototype.activate = function (history) { };
    LinkHandler.prototype.deactivate = function () { };
    return LinkHandler;
}());
var DefaultLinkHandler = (function (_super) {
    __extends(DefaultLinkHandler, _super);
    function DefaultLinkHandler() {
        var _this = _super.call(this) || this;
        _this.handler = function (e) {
            var _a = DefaultLinkHandler.getEventInfo(e), shouldHandleEvent = _a.shouldHandleEvent, href = _a.href;
            if (shouldHandleEvent) {
                e.preventDefault();
                _this.history.navigate(href);
            }
        };
        return _this;
    }
    DefaultLinkHandler.prototype.activate = function (history) {
        if (history._hasPushState) {
            this.history = history;
            __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].addEventListener('click', this.handler, true);
        }
    };
    DefaultLinkHandler.prototype.deactivate = function () {
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].removeEventListener('click', this.handler, true);
    };
    DefaultLinkHandler.getEventInfo = function (event) {
        var $event = event;
        var info = {
            shouldHandleEvent: false,
            href: null,
            anchor: null
        };
        var target = DefaultLinkHandler.findClosestAnchor($event.target);
        if (!target || !DefaultLinkHandler.targetIsThisWindow(target)) {
            return info;
        }
        if (hasAttribute(target, 'download')
            || hasAttribute(target, 'router-ignore')
            || hasAttribute(target, 'data-router-ignore')) {
            return info;
        }
        if ($event.altKey || $event.ctrlKey || $event.metaKey || $event.shiftKey) {
            return info;
        }
        var href = target.getAttribute('href');
        info.anchor = target;
        info.href = href;
        var leftButtonClicked = $event.which === 1;
        var isRelative = href && !(href.charAt(0) === '#' || (/^[a-z]+:/i).test(href));
        info.shouldHandleEvent = leftButtonClicked && isRelative;
        return info;
    };
    DefaultLinkHandler.findClosestAnchor = function (el) {
        while (el) {
            if (el.tagName === 'A') {
                return el;
            }
            el = el.parentNode;
        }
    };
    DefaultLinkHandler.targetIsThisWindow = function (target) {
        var targetWindow = target.getAttribute('target');
        var win = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].global;
        return !targetWindow ||
            targetWindow === win.name ||
            targetWindow === '_self';
    };
    return DefaultLinkHandler;
}(LinkHandler));
var hasAttribute = function (el, attr) { return el.hasAttribute(attr); };

var BrowserHistory = (function (_super) {
    __extends(BrowserHistory, _super);
    function BrowserHistory(linkHandler) {
        var _this = _super.call(this) || this;
        _this._isActive = false;
        _this._checkUrlCallback = _this._checkUrl.bind(_this);
        _this.location = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].location;
        _this.history = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].history;
        _this.linkHandler = linkHandler;
        return _this;
    }
    BrowserHistory.prototype.activate = function (options) {
        if (this._isActive) {
            throw new Error('History has already been activated.');
        }
        var $history = this.history;
        var wantsPushState = !!options.pushState;
        this._isActive = true;
        var normalizedOptions = this.options = Object.assign({}, { root: '/' }, this.options, options);
        var rootUrl = this.root = ('/' + normalizedOptions.root + '/').replace(rootStripper, '/');
        var wantsHashChange = this._wantsHashChange = normalizedOptions.hashChange !== false;
        var hasPushState = this._hasPushState = !!(normalizedOptions.pushState && $history && $history.pushState);
        var eventName;
        if (hasPushState) {
            eventName = 'popstate';
        }
        else if (wantsHashChange) {
            eventName = 'hashchange';
        }
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].addEventListener(eventName, this._checkUrlCallback);
        if (wantsHashChange && wantsPushState) {
            var $location = this.location;
            var atRoot = $location.pathname.replace(/[^\/]$/, '$&/') === rootUrl;
            if (!hasPushState && !atRoot) {
                var fragment = this.fragment = this._getFragment(null, true);
                $location.replace(rootUrl + $location.search + '#' + fragment);
                return true;
            }
            else if (hasPushState && atRoot && $location.hash) {
                var fragment = this.fragment = this._getHash().replace(routeStripper, '');
                $history.replaceState({}, __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].title, rootUrl + fragment + $location.search);
            }
        }
        if (!this.fragment) {
            this.fragment = this._getFragment('');
        }
        this.linkHandler.activate(this);
        if (!normalizedOptions.silent) {
            return this._loadUrl('');
        }
    };
    BrowserHistory.prototype.deactivate = function () {
        var handler = this._checkUrlCallback;
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].removeEventListener('popstate', handler);
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].removeEventListener('hashchange', handler);
        this._isActive = false;
        this.linkHandler.deactivate();
    };
    BrowserHistory.prototype.getAbsoluteRoot = function () {
        var $location = this.location;
        var origin = createOrigin($location.protocol, $location.hostname, $location.port);
        return "" + origin + this.root;
    };
    BrowserHistory.prototype.navigate = function (fragment, _a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.trigger, trigger = _c === void 0 ? true : _c, _d = _b.replace, replace = _d === void 0 ? false : _d;
        var location = this.location;
        if (fragment && absoluteUrl.test(fragment)) {
            location.href = fragment;
            return true;
        }
        if (!this._isActive) {
            return false;
        }
        fragment = this._getFragment(fragment || '');
        if (this.fragment === fragment && !replace) {
            return false;
        }
        this.fragment = fragment;
        var url = this.root + fragment;
        if (fragment === '' && url !== '/') {
            url = url.slice(0, -1);
        }
        if (this._hasPushState) {
            url = url.replace('//', '/');
            this.history[replace ? 'replaceState' : 'pushState']({}, __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].title, url);
        }
        else if (this._wantsHashChange) {
            updateHash(location, fragment, replace);
        }
        else {
            location.assign(url);
        }
        if (trigger) {
            return this._loadUrl(fragment);
        }
        return true;
    };
    BrowserHistory.prototype.navigateBack = function () {
        this.history.back();
    };
    BrowserHistory.prototype.setTitle = function (title) {
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].title = title;
    };
    BrowserHistory.prototype.setState = function (key, value) {
        var $history = this.history;
        var state = Object.assign({}, $history.state);
        var _a = this.location, pathname = _a.pathname, search = _a.search, hash = _a.hash;
        state[key] = value;
        $history.replaceState(state, null, "" + pathname + search + hash);
    };
    BrowserHistory.prototype.getState = function (key) {
        var state = Object.assign({}, this.history.state);
        return state[key];
    };
    BrowserHistory.prototype.getHistoryIndex = function () {
        var historyIndex = this.getState('HistoryIndex');
        if (historyIndex === undefined) {
            historyIndex = this.history.length - 1;
            this.setState('HistoryIndex', historyIndex);
        }
        return historyIndex;
    };
    BrowserHistory.prototype.go = function (movement) {
        this.history.go(movement);
    };
    BrowserHistory.prototype._getHash = function () {
        return this.location.hash.substr(1);
    };
    BrowserHistory.prototype._getFragment = function (fragment, forcePushState) {
        var rootUrl;
        if (!fragment) {
            if (this._hasPushState || !this._wantsHashChange || forcePushState) {
                var location_1 = this.location;
                fragment = location_1.pathname + location_1.search;
                rootUrl = this.root.replace(trailingSlash, '');
                if (!fragment.indexOf(rootUrl)) {
                    fragment = fragment.substr(rootUrl.length);
                }
            }
            else {
                fragment = this._getHash();
            }
        }
        return '/' + fragment.replace(routeStripper, '');
    };
    BrowserHistory.prototype._checkUrl = function () {
        var current = this._getFragment('');
        if (current !== this.fragment) {
            this._loadUrl('');
        }
    };
    BrowserHistory.prototype._loadUrl = function (fragmentOverride) {
        var fragment = this.fragment = this._getFragment(fragmentOverride);
        return this.options.routeHandler ?
            this.options.routeHandler(fragment) :
            false;
    };
    BrowserHistory.inject = [LinkHandler];
    return BrowserHistory;
}(__WEBPACK_IMPORTED_MODULE_0_aurelia_history__["History"]));
var routeStripper = /^#?\/*|\s+$/g;
var rootStripper = /^\/+|\/+$/g;
var trailingSlash = /\/$/;
var absoluteUrl = /^([a-z][a-z0-9+\-.]*:)?\/\//i;
function updateHash($location, fragment, replace) {
    if (replace) {
        var href = $location.href.replace(/(javascript:|#).*$/, '');
        $location.replace(href + '#' + fragment);
    }
    else {
        $location.hash = '#' + fragment;
    }
}
function createOrigin(protocol, hostname, port) {
    return protocol + "//" + hostname + (port ? ':' + port : '');
}

function configure(config) {
    var $config = config;
    $config.singleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_history__["History"], BrowserHistory);
    $config.transient(LinkHandler, DefaultLinkHandler);
}


//# sourceMappingURL=aurelia-history-browser.js.map


/***/ },

/***/ "aurelia-logging-console":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(exports, "ConsoleAppender", function() { return ConsoleAppender; });


var ConsoleAppender = function () {
  function ConsoleAppender() {
    
  }

  ConsoleAppender.prototype.debug = function debug(logger) {
    var _console;

    for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      rest[_key - 1] = arguments[_key];
    }

    (_console = console).debug.apply(_console, ["DEBUG [" + logger.id + "]"].concat(rest));
  };

  ConsoleAppender.prototype.info = function info(logger) {
    var _console2;

    for (var _len2 = arguments.length, rest = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
      rest[_key2 - 1] = arguments[_key2];
    }

    (_console2 = console).info.apply(_console2, ["INFO [" + logger.id + "]"].concat(rest));
  };

  ConsoleAppender.prototype.warn = function warn(logger) {
    var _console3;

    for (var _len3 = arguments.length, rest = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
      rest[_key3 - 1] = arguments[_key3];
    }

    (_console3 = console).warn.apply(_console3, ["WARN [" + logger.id + "]"].concat(rest));
  };

  ConsoleAppender.prototype.error = function error(logger) {
    var _console4;

    for (var _len4 = arguments.length, rest = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
      rest[_key4 - 1] = arguments[_key4];
    }

    (_console4 = console).error.apply(_console4, ["ERROR [" + logger.id + "]"].concat(rest));
  };

  return ConsoleAppender;
}();

/***/ },

/***/ "aurelia-route-recognizer":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_path__ = __webpack_require__(23);
/* harmony export (binding) */ __webpack_require__.d(exports, "State", function() { return State; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StaticSegment", function() { return StaticSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DynamicSegment", function() { return DynamicSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StarSegment", function() { return StarSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "EpsilonSegment", function() { return EpsilonSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouteRecognizer", function() { return RouteRecognizer; });




var State = function () {
  function State(charSpec) {
    

    this.charSpec = charSpec;
    this.nextStates = [];
  }

  State.prototype.get = function get(charSpec) {
    for (var _iterator = this.nextStates, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
      var _ref;

      if (_isArray) {
        if (_i >= _iterator.length) break;
        _ref = _iterator[_i++];
      } else {
        _i = _iterator.next();
        if (_i.done) break;
        _ref = _i.value;
      }

      var child = _ref;

      var isEqual = child.charSpec.validChars === charSpec.validChars && child.charSpec.invalidChars === charSpec.invalidChars;

      if (isEqual) {
        return child;
      }
    }

    return undefined;
  };

  State.prototype.put = function put(charSpec) {
    var state = this.get(charSpec);

    if (state) {
      return state;
    }

    state = new State(charSpec);

    this.nextStates.push(state);

    if (charSpec.repeat) {
      state.nextStates.push(state);
    }

    return state;
  };

  State.prototype.match = function match(ch) {
    var nextStates = this.nextStates;
    var results = [];

    for (var i = 0, l = nextStates.length; i < l; i++) {
      var child = nextStates[i];
      var charSpec = child.charSpec;

      if (charSpec.validChars !== undefined) {
        if (charSpec.validChars.indexOf(ch) !== -1) {
          results.push(child);
        }
      } else if (charSpec.invalidChars !== undefined) {
        if (charSpec.invalidChars.indexOf(ch) === -1) {
          results.push(child);
        }
      }
    }

    return results;
  };

  return State;
}();

var specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\'];

var escapeRegex = new RegExp('(\\' + specials.join('|\\') + ')', 'g');

var StaticSegment = function () {
  function StaticSegment(string, caseSensitive) {
    

    this.string = string;
    this.caseSensitive = caseSensitive;
  }

  StaticSegment.prototype.eachChar = function eachChar(callback) {
    var s = this.string;
    for (var i = 0, ii = s.length; i < ii; ++i) {
      var ch = s[i];
      callback({ validChars: this.caseSensitive ? ch : ch.toUpperCase() + ch.toLowerCase() });
    }
  };

  StaticSegment.prototype.regex = function regex() {
    return this.string.replace(escapeRegex, '\\$1');
  };

  StaticSegment.prototype.generate = function generate() {
    return this.string;
  };

  return StaticSegment;
}();

var DynamicSegment = function () {
  function DynamicSegment(name, optional) {
    

    this.name = name;
    this.optional = optional;
  }

  DynamicSegment.prototype.eachChar = function eachChar(callback) {
    callback({ invalidChars: '/', repeat: true });
  };

  DynamicSegment.prototype.regex = function regex() {
    return '([^/]+)';
  };

  DynamicSegment.prototype.generate = function generate(params, consumed) {
    consumed[this.name] = true;
    return params[this.name];
  };

  return DynamicSegment;
}();

var StarSegment = function () {
  function StarSegment(name) {
    

    this.name = name;
  }

  StarSegment.prototype.eachChar = function eachChar(callback) {
    callback({ invalidChars: '', repeat: true });
  };

  StarSegment.prototype.regex = function regex() {
    return '(.+)';
  };

  StarSegment.prototype.generate = function generate(params, consumed) {
    consumed[this.name] = true;
    return params[this.name];
  };

  return StarSegment;
}();

var EpsilonSegment = function () {
  function EpsilonSegment() {
    
  }

  EpsilonSegment.prototype.eachChar = function eachChar() {};

  EpsilonSegment.prototype.regex = function regex() {
    return '';
  };

  EpsilonSegment.prototype.generate = function generate() {
    return '';
  };

  return EpsilonSegment;
}();

var RouteRecognizer = function () {
  function RouteRecognizer() {
    

    this.rootState = new State();
    this.names = {};
    this.routes = new Map();
  }

  RouteRecognizer.prototype.add = function add(route) {
    var _this = this;

    if (Array.isArray(route)) {
      route.forEach(function (r) {
        return _this.add(r);
      });
      return undefined;
    }

    var currentState = this.rootState;
    var skippableStates = [];
    var regex = '^';
    var types = { statics: 0, dynamics: 0, stars: 0 };
    var names = [];
    var routeName = route.handler.name;
    var isEmpty = true;
    var segments = parse(route.path, names, types, route.caseSensitive);

    for (var i = 0, ii = segments.length; i < ii; i++) {
      var segment = segments[i];
      if (segment instanceof EpsilonSegment) {
        continue;
      }

      var _addSegment = addSegment(currentState, segment),
          firstState = _addSegment[0],
          nextState = _addSegment[1];

      for (var j = 0, jj = skippableStates.length; j < jj; j++) {
        skippableStates[j].nextStates.push(firstState);
      }

      if (segment.optional) {
        skippableStates.push(nextState);
        regex += '(?:/' + segment.regex() + ')?';
      } else {
        currentState = nextState;
        regex += '/' + segment.regex();
        skippableStates.length = 0;
        isEmpty = false;
      }
    }

    if (isEmpty) {
      currentState = currentState.put({ validChars: '/' });
      regex += '/?';
    }

    var handlers = [{ handler: route.handler, names: names }];

    this.routes.set(route.handler, { segments: segments, handlers: handlers });
    if (routeName) {
      var routeNames = Array.isArray(routeName) ? routeName : [routeName];
      for (var _i2 = 0; _i2 < routeNames.length; _i2++) {
        if (!(routeNames[_i2] in this.names)) {
          this.names[routeNames[_i2]] = { segments: segments, handlers: handlers };
        }
      }
    }

    for (var _i3 = 0; _i3 < skippableStates.length; _i3++) {
      var state = skippableStates[_i3];
      state.handlers = handlers;
      state.regex = new RegExp(regex + '$', route.caseSensitive ? '' : 'i');
      state.types = types;
    }

    currentState.handlers = handlers;
    currentState.regex = new RegExp(regex + '$', route.caseSensitive ? '' : 'i');
    currentState.types = types;

    return currentState;
  };

  RouteRecognizer.prototype.getRoute = function getRoute(nameOrRoute) {
    return typeof nameOrRoute === 'string' ? this.names[nameOrRoute] : this.routes.get(nameOrRoute);
  };

  RouteRecognizer.prototype.handlersFor = function handlersFor(nameOrRoute) {
    var route = this.getRoute(nameOrRoute);
    if (!route) {
      throw new Error('There is no route named ' + nameOrRoute);
    }

    return [].concat(route.handlers);
  };

  RouteRecognizer.prototype.hasRoute = function hasRoute(nameOrRoute) {
    return !!this.getRoute(nameOrRoute);
  };

  RouteRecognizer.prototype.generate = function generate(nameOrRoute, params) {
    var route = this.getRoute(nameOrRoute);
    if (!route) {
      throw new Error('There is no route named ' + nameOrRoute);
    }

    var handler = route.handlers[0].handler;
    if (handler.generationUsesHref) {
      return handler.href;
    }

    var routeParams = Object.assign({}, params);
    var segments = route.segments;
    var consumed = {};
    var output = '';

    for (var i = 0, l = segments.length; i < l; i++) {
      var segment = segments[i];

      if (segment instanceof EpsilonSegment) {
        continue;
      }

      var segmentValue = segment.generate(routeParams, consumed);
      if (segmentValue === null || segmentValue === undefined) {
        if (!segment.optional) {
          throw new Error('A value is required for route parameter \'' + segment.name + '\' in route \'' + nameOrRoute + '\'.');
        }
      } else {
        output += '/';
        output += segmentValue;
      }
    }

    if (output.charAt(0) !== '/') {
      output = '/' + output;
    }

    for (var param in consumed) {
      delete routeParams[param];
    }

    var queryString = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_path__["buildQueryString"])(routeParams);
    output += queryString ? '?' + queryString : '';

    return output;
  };

  RouteRecognizer.prototype.recognize = function recognize(path) {
    var states = [this.rootState];
    var queryParams = {};
    var isSlashDropped = false;
    var normalizedPath = path;

    var queryStart = normalizedPath.indexOf('?');
    if (queryStart !== -1) {
      var queryString = normalizedPath.substr(queryStart + 1, normalizedPath.length);
      normalizedPath = normalizedPath.substr(0, queryStart);
      queryParams = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_path__["parseQueryString"])(queryString);
    }

    normalizedPath = decodeURI(normalizedPath);

    if (normalizedPath.charAt(0) !== '/') {
      normalizedPath = '/' + normalizedPath;
    }

    var pathLen = normalizedPath.length;
    if (pathLen > 1 && normalizedPath.charAt(pathLen - 1) === '/') {
      normalizedPath = normalizedPath.substr(0, pathLen - 1);
      isSlashDropped = true;
    }

    for (var i = 0, l = normalizedPath.length; i < l; i++) {
      states = recognizeChar(states, normalizedPath.charAt(i));
      if (!states.length) {
        break;
      }
    }

    var solutions = [];
    for (var _i4 = 0, _l = states.length; _i4 < _l; _i4++) {
      if (states[_i4].handlers) {
        solutions.push(states[_i4]);
      }
    }

    states = sortSolutions(solutions);

    var state = solutions[0];
    if (state && state.handlers) {
      if (isSlashDropped && state.regex.source.slice(-5) === '(.+)$') {
        normalizedPath = normalizedPath + '/';
      }

      return findHandler(state, normalizedPath, queryParams);
    }
  };

  return RouteRecognizer;
}();

var RecognizeResults = function RecognizeResults(queryParams) {
  

  this.splice = Array.prototype.splice;
  this.slice = Array.prototype.slice;
  this.push = Array.prototype.push;
  this.length = 0;
  this.queryParams = queryParams || {};
};

function parse(route, names, types, caseSensitive) {
  var normalizedRoute = route;
  if (route.charAt(0) === '/') {
    normalizedRoute = route.substr(1);
  }

  var results = [];

  var splitRoute = normalizedRoute.split('/');
  for (var i = 0, ii = splitRoute.length; i < ii; ++i) {
    var segment = splitRoute[i];

    var match = segment.match(/^:([^?]+)(\?)?$/);
    if (match) {
      var _match = match,
          _name = _match[1],
          optional = _match[2];

      if (_name.indexOf('=') !== -1) {
        throw new Error('Parameter ' + _name + ' in route ' + route + ' has a default value, which is not supported.');
      }
      results.push(new DynamicSegment(_name, !!optional));
      names.push(_name);
      types.dynamics++;
      continue;
    }

    match = segment.match(/^\*(.+)$/);
    if (match) {
      results.push(new StarSegment(match[1]));
      names.push(match[1]);
      types.stars++;
    } else if (segment === '') {
      results.push(new EpsilonSegment());
    } else {
      results.push(new StaticSegment(segment, caseSensitive));
      types.statics++;
    }
  }

  return results;
}

function sortSolutions(states) {
  return states.sort(function (a, b) {
    if (a.types.stars !== b.types.stars) {
      return a.types.stars - b.types.stars;
    }

    if (a.types.stars) {
      if (a.types.statics !== b.types.statics) {
        return b.types.statics - a.types.statics;
      }
      if (a.types.dynamics !== b.types.dynamics) {
        return b.types.dynamics - a.types.dynamics;
      }
    }

    if (a.types.dynamics !== b.types.dynamics) {
      return a.types.dynamics - b.types.dynamics;
    }

    if (a.types.statics !== b.types.statics) {
      return b.types.statics - a.types.statics;
    }

    return 0;
  });
}

function recognizeChar(states, ch) {
  var nextStates = [];

  for (var i = 0, l = states.length; i < l; i++) {
    var state = states[i];
    nextStates.push.apply(nextStates, state.match(ch));
  }

  return nextStates;
}

function findHandler(state, path, queryParams) {
  var handlers = state.handlers;
  var regex = state.regex;
  var captures = path.match(regex);
  var currentCapture = 1;
  var result = new RecognizeResults(queryParams);

  for (var i = 0, l = handlers.length; i < l; i++) {
    var _handler = handlers[i];
    var _names = _handler.names;
    var _params = {};

    for (var j = 0, m = _names.length; j < m; j++) {
      _params[_names[j]] = captures[currentCapture++];
    }

    result.push({ handler: _handler.handler, params: _params, isDynamic: !!_names.length });
  }

  return result;
}

function addSegment(currentState, segment) {
  var firstState = currentState.put({ validChars: '/' });
  var nextState = firstState;
  segment.eachChar(function (ch) {
    nextState = nextState.put(ch);
  });

  return [firstState, nextState];
}

/***/ },

/***/ "aurelia-router":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_history__ = __webpack_require__(213);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_route_recognizer__ = __webpack_require__("aurelia-route-recognizer");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_event_aggregator__ = __webpack_require__("aurelia-event-aggregator");
/* harmony export (binding) */ __webpack_require__.d(exports, "ActivateNextStep", function() { return ActivateNextStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AppRouter", function() { return AppRouter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BuildNavigationPlanStep", function() { return BuildNavigationPlanStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CanActivateNextStep", function() { return CanActivateNextStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CanDeactivatePreviousStep", function() { return CanDeactivatePreviousStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CommitChangesStep", function() { return CommitChangesStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DeactivatePreviousStep", function() { return DeactivatePreviousStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LoadRouteStep", function() { return LoadRouteStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NavModel", function() { return NavModel; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NavigationInstruction", function() { return NavigationInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Pipeline", function() { return Pipeline; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PipelineProvider", function() { return PipelineProvider; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PipelineSlotName", function() { return PipelineSlotName; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PipelineStatus", function() { return PipelineStatus; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Redirect", function() { return Redirect; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RedirectToRoute", function() { return RedirectToRoute; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouteLoader", function() { return RouteLoader; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Router", function() { return Router; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterConfiguration", function() { return RouterConfiguration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterEvent", function() { return RouterEvent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "activationStrategy", function() { return activationStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "isNavigationCommand", function() { return isNavigationCommand; });






/**
 * Class used to represent an instruction during a navigation.
 */
class NavigationInstruction {
    constructor(init) {
        /**
         * Current built viewport plan of this nav instruction
         */
        this.plan = null;
        this.options = {};
        Object.assign(this, init);
        this.params = this.params || {};
        this.viewPortInstructions = {};
        let ancestorParams = [];
        let current = this;
        do {
            let currentParams = Object.assign({}, current.params);
            if (current.config && current.config.hasChildRouter) {
                // remove the param for the injected child route segment
                delete currentParams[current.getWildCardName()];
            }
            ancestorParams.unshift(currentParams);
            current = current.parentInstruction;
        } while (current);
        let allParams = Object.assign({}, this.queryParams, ...ancestorParams);
        this.lifecycleArgs = [allParams, this.config, this];
    }
    /**
     * Gets an array containing this instruction and all child instructions for the current navigation.
     */
    getAllInstructions() {
        let instructions = [this];
        let viewPortInstructions = this.viewPortInstructions;
        for (let key in viewPortInstructions) {
            let childInstruction = viewPortInstructions[key].childNavigationInstruction;
            if (childInstruction) {
                instructions.push(...childInstruction.getAllInstructions());
            }
        }
        return instructions;
    }
    /**
     * Gets an array containing the instruction and all child instructions for the previous navigation.
     * Previous instructions are no longer available after navigation completes.
     */
    getAllPreviousInstructions() {
        return this.getAllInstructions().map(c => c.previousInstruction).filter(c => c);
    }
    addViewPortInstruction(nameOrInitOptions, strategy, moduleId, component) {
        let viewPortInstruction;
        let viewPortName = typeof nameOrInitOptions === 'string' ? nameOrInitOptions : nameOrInitOptions.name;
        const lifecycleArgs = this.lifecycleArgs;
        const config = Object.assign({}, lifecycleArgs[1], { currentViewPort: viewPortName });
        if (typeof nameOrInitOptions === 'string') {
            viewPortInstruction = {
                name: nameOrInitOptions,
                strategy: strategy,
                moduleId: moduleId,
                component: component,
                childRouter: component.childRouter,
                lifecycleArgs: [lifecycleArgs[0], config, lifecycleArgs[2]]
            };
        }
        else {
            viewPortInstruction = {
                name: viewPortName,
                strategy: nameOrInitOptions.strategy,
                component: nameOrInitOptions.component,
                moduleId: nameOrInitOptions.moduleId,
                childRouter: nameOrInitOptions.component.childRouter,
                lifecycleArgs: [lifecycleArgs[0], config, lifecycleArgs[2]]
            };
        }
        return this.viewPortInstructions[viewPortName] = viewPortInstruction;
    }
    /**
     * Gets the name of the route pattern's wildcard parameter, if applicable.
     */
    getWildCardName() {
        // todo: potential issue, or at least unsafe typings
        let configRoute = this.config.route;
        let wildcardIndex = configRoute.lastIndexOf('*');
        return configRoute.substr(wildcardIndex + 1);
    }
    /**
     * Gets the path and query string created by filling the route
     * pattern's wildcard parameter with the matching param.
     */
    getWildcardPath() {
        let wildcardName = this.getWildCardName();
        let path = this.params[wildcardName] || '';
        let queryString = this.queryString;
        if (queryString) {
            path += '?' + queryString;
        }
        return path;
    }
    /**
     * Gets the instruction's base URL, accounting for wildcard route parameters.
     */
    getBaseUrl() {
        let $encodeURI = encodeURI;
        let fragment = decodeURI(this.fragment);
        if (fragment === '') {
            let nonEmptyRoute = this.router.routes.find(route => {
                return route.name === this.config.name &&
                    route.route !== '';
            });
            if (nonEmptyRoute) {
                fragment = nonEmptyRoute.route;
            }
        }
        if (!this.params) {
            return $encodeURI(fragment);
        }
        let wildcardName = this.getWildCardName();
        let path = this.params[wildcardName] || '';
        if (!path) {
            return $encodeURI(fragment);
        }
        return $encodeURI(fragment.substr(0, fragment.lastIndexOf(path)));
    }
    /**
     * Finalize a viewport instruction
     * @internal
     */
    _commitChanges(waitToSwap) {
        let router = this.router;
        router.currentInstruction = this;
        const previousInstruction = this.previousInstruction;
        if (previousInstruction) {
            previousInstruction.config.navModel.isActive = false;
        }
        this.config.navModel.isActive = true;
        router.refreshNavigation();
        let loads = [];
        let delaySwaps = [];
        let viewPortInstructions = this.viewPortInstructions;
        for (let viewPortName in viewPortInstructions) {
            let viewPortInstruction = viewPortInstructions[viewPortName];
            let viewPort = router.viewPorts[viewPortName];
            if (!viewPort) {
                throw new Error(`There was no router-view found in the view for ${viewPortInstruction.moduleId}.`);
            }
            let childNavInstruction = viewPortInstruction.childNavigationInstruction;
            if (viewPortInstruction.strategy === "replace" /* Replace */) {
                if (childNavInstruction && childNavInstruction.parentCatchHandler) {
                    loads.push(childNavInstruction._commitChanges(waitToSwap));
                }
                else {
                    if (waitToSwap) {
                        delaySwaps.push({ viewPort, viewPortInstruction });
                    }
                    loads.push(viewPort
                        .process(viewPortInstruction, waitToSwap)
                        .then(() => childNavInstruction
                        ? childNavInstruction._commitChanges(waitToSwap)
                        : Promise.resolve()));
                }
            }
            else {
                if (childNavInstruction) {
                    loads.push(childNavInstruction._commitChanges(waitToSwap));
                }
            }
        }
        return Promise
            .all(loads)
            .then(() => {
            delaySwaps.forEach(x => x.viewPort.swap(x.viewPortInstruction));
            return null;
        })
            .then(() => prune(this));
    }
    /**@internal */
    _updateTitle() {
        let router = this.router;
        let title = this._buildTitle(router.titleSeparator);
        if (title) {
            router.history.setTitle(title);
        }
    }
    /**@internal */
    _buildTitle(separator = ' | ') {
        let title = '';
        let childTitles = [];
        let navModelTitle = this.config.navModel.title;
        let instructionRouter = this.router;
        let viewPortInstructions = this.viewPortInstructions;
        if (navModelTitle) {
            title = instructionRouter.transformTitle(navModelTitle);
        }
        for (let viewPortName in viewPortInstructions) {
            let viewPortInstruction = viewPortInstructions[viewPortName];
            let child_nav_instruction = viewPortInstruction.childNavigationInstruction;
            if (child_nav_instruction) {
                let childTitle = child_nav_instruction._buildTitle(separator);
                if (childTitle) {
                    childTitles.push(childTitle);
                }
            }
        }
        if (childTitles.length) {
            title = childTitles.join(separator) + (title ? separator : '') + title;
        }
        if (instructionRouter.title) {
            title += (title ? separator : '') + instructionRouter.transformTitle(instructionRouter.title);
        }
        return title;
    }
}
const prune = (instruction) => {
    instruction.previousInstruction = null;
    instruction.plan = null;
};

/**
* Class for storing and interacting with a route's navigation settings.
*/
class NavModel {
    constructor(router, relativeHref) {
        /**
        * True if this nav item is currently active.
        */
        this.isActive = false;
        /**
        * The title.
        */
        this.title = null;
        /**
        * This nav item's absolute href.
        */
        this.href = null;
        /**
        * This nav item's relative href.
        */
        this.relativeHref = null;
        /**
        * Data attached to the route at configuration time.
        */
        this.settings = {};
        /**
        * The route config.
        */
        this.config = null;
        this.router = router;
        this.relativeHref = relativeHref;
    }
    /**
    * Sets the route's title and updates document.title.
    *  If the a navigation is in progress, the change will be applied
    *  to document.title when the navigation completes.
    *
    * @param title The new title.
    */
    setTitle(title) {
        this.title = title;
        if (this.isActive) {
            this.router.updateTitle();
        }
    }
}

function _normalizeAbsolutePath(path, hasPushState, absolute = false) {
    if (!hasPushState && path[0] !== '#') {
        path = '#' + path;
    }
    if (hasPushState && absolute) {
        path = path.substring(1, path.length);
    }
    return path;
}
function _createRootedPath(fragment, baseUrl, hasPushState, absolute) {
    if (isAbsoluteUrl.test(fragment)) {
        return fragment;
    }
    let path = '';
    if (baseUrl.length && baseUrl[0] !== '/') {
        path += '/';
    }
    path += baseUrl;
    if ((!path.length || path[path.length - 1] !== '/') && fragment[0] !== '/') {
        path += '/';
    }
    if (path.length && path[path.length - 1] === '/' && fragment[0] === '/') {
        path = path.substring(0, path.length - 1);
    }
    return _normalizeAbsolutePath(path + fragment, hasPushState, absolute);
}
function _resolveUrl(fragment, baseUrl, hasPushState) {
    if (isRootedPath.test(fragment)) {
        return _normalizeAbsolutePath(fragment, hasPushState);
    }
    return _createRootedPath(fragment, baseUrl, hasPushState);
}
function _ensureArrayWithSingleRoutePerConfig(config) {
    let routeConfigs = [];
    if (Array.isArray(config.route)) {
        for (let i = 0, ii = config.route.length; i < ii; ++i) {
            let current = Object.assign({}, config);
            current.route = config.route[i];
            routeConfigs.push(current);
        }
    }
    else {
        routeConfigs.push(Object.assign({}, config));
    }
    return routeConfigs;
}
const isRootedPath = /^#?\//;
const isAbsoluteUrl = /^([a-z][a-z0-9+\-.]*:)?\/\//i;

/**
 * Class used to configure a [[Router]] instance.
 *
 * @constructor
 */
class RouterConfiguration {
    constructor() {
        this.instructions = [];
        this.options = {};
        this.pipelineSteps = [];
    }
    /**
     * Adds a step to be run during the [[Router]]'s navigation pipeline.
     *
     * @param name The name of the pipeline slot to insert the step into.
     * @param step The pipeline step.
     * @chainable
     */
    addPipelineStep(name, step) {
        if (step === null || step === undefined) {
            throw new Error('Pipeline step cannot be null or undefined.');
        }
        this.pipelineSteps.push({ name, step });
        return this;
    }
    /**
     * Adds a step to be run during the [[Router]]'s authorize pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addAuthorizeStep(step) {
        return this.addPipelineStep("authorize" /* Authorize */, step);
    }
    /**
     * Adds a step to be run during the [[Router]]'s preActivate pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addPreActivateStep(step) {
        return this.addPipelineStep("preActivate" /* PreActivate */, step);
    }
    /**
     * Adds a step to be run during the [[Router]]'s preRender pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addPreRenderStep(step) {
        return this.addPipelineStep("preRender" /* PreRender */, step);
    }
    /**
     * Adds a step to be run during the [[Router]]'s postRender pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addPostRenderStep(step) {
        return this.addPipelineStep("postRender" /* PostRender */, step);
    }
    /**
     * Configures a route that will be used if there is no previous location available on navigation cancellation.
     *
     * @param fragment The URL fragment to use as the navigation destination.
     * @chainable
     */
    fallbackRoute(fragment) {
        this._fallbackRoute = fragment;
        return this;
    }
    /**
     * Maps one or more routes to be registered with the router.
     *
     * @param route The [[RouteConfig]] to map, or an array of [[RouteConfig]] to map.
     * @chainable
     */
    map(route) {
        if (Array.isArray(route)) {
            route.forEach(r => this.map(r));
            return this;
        }
        return this.mapRoute(route);
    }
    /**
     * Configures defaults to use for any view ports.
     *
     * @param viewPortConfig a view port configuration object to use as a
     *  default, of the form { viewPortName: { moduleId } }.
     * @chainable
     */
    useViewPortDefaults(viewPortConfig) {
        this.viewPortDefaults = viewPortConfig;
        return this;
    }
    /**
     * Maps a single route to be registered with the router.
     *
     * @param route The [[RouteConfig]] to map.
     * @chainable
     */
    mapRoute(config) {
        this.instructions.push(router => {
            let routeConfigs = _ensureArrayWithSingleRoutePerConfig(config);
            let navModel;
            for (let i = 0, ii = routeConfigs.length; i < ii; ++i) {
                let routeConfig = routeConfigs[i];
                routeConfig.settings = routeConfig.settings || {};
                if (!navModel) {
                    navModel = router.createNavModel(routeConfig);
                }
                router.addRoute(routeConfig, navModel);
            }
        });
        return this;
    }
    /**
     * Registers an unknown route handler to be run when the URL fragment doesn't match any registered routes.
     *
     * @param config A string containing a moduleId to load, or a [[RouteConfig]], or a function that takes the
     *  [[NavigationInstruction]] and selects a moduleId to load.
     * @chainable
     */
    mapUnknownRoutes(config) {
        this.unknownRouteConfig = config;
        return this;
    }
    /**
     * Applies the current configuration to the specified [[Router]].
     *
     * @param router The [[Router]] to apply the configuration to.
     */
    exportToRouter(router) {
        let instructions = this.instructions;
        for (let i = 0, ii = instructions.length; i < ii; ++i) {
            instructions[i](router);
        }
        let { title, titleSeparator, unknownRouteConfig, _fallbackRoute, viewPortDefaults } = this;
        if (title) {
            router.title = title;
        }
        if (titleSeparator) {
            router.titleSeparator = titleSeparator;
        }
        if (unknownRouteConfig) {
            router.handleUnknownRoutes(unknownRouteConfig);
        }
        if (_fallbackRoute) {
            router.fallbackRoute = _fallbackRoute;
        }
        if (viewPortDefaults) {
            router.useViewPortDefaults(viewPortDefaults);
        }
        Object.assign(router.options, this.options);
        let pipelineSteps = this.pipelineSteps;
        let pipelineStepCount = pipelineSteps.length;
        if (pipelineStepCount) {
            if (!router.isRoot) {
                throw new Error('Pipeline steps can only be added to the root router');
            }
            let pipelineProvider = router.pipelineProvider;
            for (let i = 0, ii = pipelineStepCount; i < ii; ++i) {
                let { name, step } = pipelineSteps[i];
                pipelineProvider.addStep(name, step);
            }
        }
    }
}

/**
 * The primary class responsible for handling routing and navigation.
 */
class Router {
    /**
     * @param container The [[Container]] to use when child routers.
     * @param history The [[History]] implementation to delegate navigation requests to.
     */
    constructor(container, history) {
        /**
         * The parent router, or null if this instance is not a child router.
         */
        this.parent = null;
        this.options = {};
        /**
         * The defaults used when a viewport lacks specified content
         */
        this.viewPortDefaults = {};
        /**
         * Extension point to transform the document title before it is built and displayed.
         * By default, child routers delegate to the parent router, and the app router
         * returns the title unchanged.
         */
        this.transformTitle = (title) => {
            if (this.parent) {
                return this.parent.transformTitle(title);
            }
            return title;
        };
        this.container = container;
        this.history = history;
        this.reset();
    }
    /**
     * Fully resets the router's internal state. Primarily used internally by the framework when multiple calls to setRoot are made.
     * Use with caution (actually, avoid using this). Do not use this to simply change your navigation model.
     */
    reset() {
        this.viewPorts = {};
        this.routes = [];
        this.baseUrl = '';
        this.isConfigured = false;
        this.isNavigating = false;
        this.isExplicitNavigation = false;
        this.isExplicitNavigationBack = false;
        this.isNavigatingFirst = false;
        this.isNavigatingNew = false;
        this.isNavigatingRefresh = false;
        this.isNavigatingForward = false;
        this.isNavigatingBack = false;
        this.couldDeactivate = false;
        this.navigation = [];
        this.currentInstruction = null;
        this.viewPortDefaults = {};
        this._fallbackOrder = 100;
        this._recognizer = new __WEBPACK_IMPORTED_MODULE_3_aurelia_route_recognizer__["RouteRecognizer"]();
        this._childRecognizer = new __WEBPACK_IMPORTED_MODULE_3_aurelia_route_recognizer__["RouteRecognizer"]();
        this._configuredPromise = new Promise(resolve => {
            this._resolveConfiguredPromise = resolve;
        });
    }
    /**
     * Gets a value indicating whether or not this [[Router]] is the root in the router tree. I.e., it has no parent.
     */
    get isRoot() {
        return !this.parent;
    }
    /**
     * Registers a viewPort to be used as a rendering target for activated routes.
     *
     * @param viewPort The viewPort.
     * @param name The name of the viewPort. 'default' if unspecified.
     */
    registerViewPort(viewPort, name) {
        name = name || 'default';
        this.viewPorts[name] = viewPort;
    }
    /**
     * Returns a Promise that resolves when the router is configured.
     */
    ensureConfigured() {
        return this._configuredPromise;
    }
    /**
     * Configures the router.
     *
     * @param callbackOrConfig The [[RouterConfiguration]] or a callback that takes a [[RouterConfiguration]].
     */
    configure(callbackOrConfig) {
        this.isConfigured = true;
        let result = callbackOrConfig;
        let config;
        if (typeof callbackOrConfig === 'function') {
            config = new RouterConfiguration();
            result = callbackOrConfig(config);
        }
        return Promise
            .resolve(result)
            .then((c) => {
            if (c && c.exportToRouter) {
                config = c;
            }
            config.exportToRouter(this);
            this.isConfigured = true;
            this._resolveConfiguredPromise();
        });
    }
    /**
     * Navigates to a new location.
     *
     * @param fragment The URL fragment to use as the navigation destination.
     * @param options The navigation options.
     */
    navigate(fragment, options) {
        if (!this.isConfigured && this.parent) {
            return this.parent.navigate(fragment, options);
        }
        this.isExplicitNavigation = true;
        return this.history.navigate(_resolveUrl(fragment, this.baseUrl, this.history._hasPushState), options);
    }
    /**
     * Navigates to a new location corresponding to the route and params specified. Equivallent to [[Router.generate]] followed
     * by [[Router.navigate]].
     *
     * @param route The name of the route to use when generating the navigation location.
     * @param params The route parameters to be used when populating the route pattern.
     * @param options The navigation options.
     */
    navigateToRoute(route, params, options) {
        let path = this.generate(route, params);
        return this.navigate(path, options);
    }
    /**
     * Navigates back to the most recent location in history.
     */
    navigateBack() {
        this.isExplicitNavigationBack = true;
        this.history.navigateBack();
    }
    /**
     * Creates a child router of the current router.
     *
     * @param container The [[Container]] to provide to the child router. Uses the current [[Router]]'s [[Container]] if unspecified.
     * @returns {Router} The new child Router.
     */
    createChild(container) {
        let childRouter = new Router(container || this.container.createChild(), this.history);
        childRouter.parent = this;
        return childRouter;
    }
    /**
     * Generates a URL fragment matching the specified route pattern.
     *
     * @param name The name of the route whose pattern should be used to generate the fragment.
     * @param params The route params to be used to populate the route pattern.
     * @param options If options.absolute = true, then absolute url will be generated; otherwise, it will be relative url.
     * @returns {string} A string containing the generated URL fragment.
     */
    generate(nameOrRoute, params = {}, options = {}) {
        // A child recognizer generates routes for potential child routes. Any potential child route is added
        // to the childRoute property of params for the childRouter to recognize. When generating routes, we
        // use the childRecognizer when childRoute params are available to generate a child router enabled route.
        let recognizer = 'childRoute' in params ? this._childRecognizer : this._recognizer;
        let hasRoute = recognizer.hasRoute(nameOrRoute);
        if (!hasRoute) {
            if (this.parent) {
                return this.parent.generate(nameOrRoute, params, options);
            }
            throw new Error(`A route with name '${nameOrRoute}' could not be found. Check that \`name: '${nameOrRoute}'\` was specified in the route's config.`);
        }
        let path = recognizer.generate(nameOrRoute, params);
        let rootedPath = _createRootedPath(path, this.baseUrl, this.history._hasPushState, options.absolute);
        return options.absolute ? `${this.history.getAbsoluteRoot()}${rootedPath}` : rootedPath;
    }
    /**
     * Creates a [[NavModel]] for the specified route config.
     *
     * @param config The route config.
     */
    createNavModel(config) {
        let navModel = new NavModel(this, 'href' in config
            ? config.href
            // potential error when config.route is a string[] ?
            : config.route);
        navModel.title = config.title;
        navModel.order = config.nav;
        navModel.href = config.href;
        navModel.settings = config.settings;
        navModel.config = config;
        return navModel;
    }
    /**
     * Registers a new route with the router.
     *
     * @param config The [[RouteConfig]].
     * @param navModel The [[NavModel]] to use for the route. May be omitted for single-pattern routes.
     */
    addRoute(config, navModel) {
        if (Array.isArray(config.route)) {
            let routeConfigs = _ensureArrayWithSingleRoutePerConfig(config);
            // the following is wrong. todo: fix this after TS refactoring release
            routeConfigs.forEach(this.addRoute.bind(this));
            return;
        }
        validateRouteConfig(config);
        if (!('viewPorts' in config) && !config.navigationStrategy) {
            config.viewPorts = {
                'default': {
                    moduleId: config.moduleId,
                    view: config.view
                }
            };
        }
        if (!navModel) {
            navModel = this.createNavModel(config);
        }
        this.routes.push(config);
        let path = config.route;
        if (path.charAt(0) === '/') {
            path = path.substr(1);
        }
        let caseSensitive = config.caseSensitive === true;
        let state = this._recognizer.add({
            path: path,
            handler: config,
            caseSensitive: caseSensitive
        });
        if (path) {
            let settings = config.settings;
            delete config.settings;
            let withChild = JSON.parse(JSON.stringify(config));
            config.settings = settings;
            withChild.route = `${path}/*childRoute`;
            withChild.hasChildRouter = true;
            this._childRecognizer.add({
                path: withChild.route,
                handler: withChild,
                caseSensitive: caseSensitive
            });
            withChild.navModel = navModel;
            withChild.settings = config.settings;
            withChild.navigationStrategy = config.navigationStrategy;
        }
        config.navModel = navModel;
        let navigation = this.navigation;
        if ((navModel.order || navModel.order === 0) && navigation.indexOf(navModel) === -1) {
            if ((!navModel.href && navModel.href !== '') && (state.types.dynamics || state.types.stars)) {
                throw new Error('Invalid route config for "' + config.route + '" : dynamic routes must specify an "href:" to be included in the navigation model.');
            }
            if (typeof navModel.order !== 'number') {
                navModel.order = ++this._fallbackOrder;
            }
            navigation.push(navModel);
            // this is a potential error / inconsistency between browsers
            //
            // MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort
            // If compareFunction(a, b) returns 0, leave a and b unchanged with respect to each other,
            // but sorted with respect to all different elements.
            // Note: the ECMAscript standard does not guarantee this behaviour,
            // and thus not all browsers (e.g. Mozilla versions dating back to at least 2003) respect this.
            navigation.sort((a, b) => a.order - b.order);
        }
    }
    /**
     * Gets a value indicating whether or not this [[Router]] or one of its ancestors has a route registered with the specified name.
     *
     * @param name The name of the route to check.
     */
    hasRoute(name) {
        return !!(this._recognizer.hasRoute(name) || this.parent && this.parent.hasRoute(name));
    }
    /**
     * Gets a value indicating whether or not this [[Router]] has a route registered with the specified name.
     *
     * @param name The name of the route to check.
     */
    hasOwnRoute(name) {
        return this._recognizer.hasRoute(name);
    }
    /**
     * Register a handler to use when the incoming URL fragment doesn't match any registered routes.
     *
     * @param config The moduleId, or a function that selects the moduleId, or a [[RouteConfig]].
     */
    handleUnknownRoutes(config) {
        if (!config) {
            throw new Error('Invalid unknown route handler');
        }
        this.catchAllHandler = instruction => {
            return this
                ._createRouteConfig(config, instruction)
                .then(c => {
                instruction.config = c;
                return instruction;
            });
        };
    }
    /**
     * Updates the document title using the current navigation instruction.
     */
    updateTitle() {
        let parentRouter = this.parent;
        if (parentRouter) {
            return parentRouter.updateTitle();
        }
        let currentInstruction = this.currentInstruction;
        if (currentInstruction) {
            currentInstruction._updateTitle();
        }
        return undefined;
    }
    /**
     * Updates the navigation routes with hrefs relative to the current location.
     * Note: This method will likely move to a plugin in a future release.
     */
    refreshNavigation() {
        let nav = this.navigation;
        for (let i = 0, length = nav.length; i < length; i++) {
            let current = nav[i];
            if (!current.config.href) {
                current.href = _createRootedPath(current.relativeHref, this.baseUrl, this.history._hasPushState);
            }
            else {
                current.href = _normalizeAbsolutePath(current.config.href, this.history._hasPushState);
            }
        }
    }
    /**
     * Sets the default configuration for the view ports. This specifies how to
     *  populate a view port for which no module is specified. The default is
     *  an empty view/view-model pair.
     */
    useViewPortDefaults($viewPortDefaults) {
        // a workaround to have strong typings while not requiring to expose interface ViewPortInstruction
        let viewPortDefaults = $viewPortDefaults;
        for (let viewPortName in viewPortDefaults) {
            let viewPortConfig = viewPortDefaults[viewPortName];
            this.viewPortDefaults[viewPortName] = {
                moduleId: viewPortConfig.moduleId
            };
        }
    }
    /**@internal */
    _refreshBaseUrl() {
        let parentRouter = this.parent;
        if (parentRouter) {
            this.baseUrl = generateBaseUrl(parentRouter, parentRouter.currentInstruction);
        }
    }
    /**@internal */
    _createNavigationInstruction(url = '', parentInstruction = null) {
        let fragment = url;
        let queryString = '';
        let queryIndex = url.indexOf('?');
        if (queryIndex !== -1) {
            fragment = url.substr(0, queryIndex);
            queryString = url.substr(queryIndex + 1);
        }
        let urlRecognizationResults = this._recognizer.recognize(url);
        if (!urlRecognizationResults || !urlRecognizationResults.length) {
            urlRecognizationResults = this._childRecognizer.recognize(url);
        }
        let instructionInit = {
            fragment,
            queryString,
            config: null,
            parentInstruction,
            previousInstruction: this.currentInstruction,
            router: this,
            options: {
                compareQueryParams: this.options.compareQueryParams
            }
        };
        let result;
        if (urlRecognizationResults && urlRecognizationResults.length) {
            let first = urlRecognizationResults[0];
            let instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
                params: first.params,
                queryParams: first.queryParams || urlRecognizationResults.queryParams,
                config: first.config || first.handler
            }));
            if (typeof first.handler === 'function') {
                result = evaluateNavigationStrategy(instruction, first.handler, first);
            }
            else if (first.handler && typeof first.handler.navigationStrategy === 'function') {
                result = evaluateNavigationStrategy(instruction, first.handler.navigationStrategy, first.handler);
            }
            else {
                result = Promise.resolve(instruction);
            }
        }
        else if (this.catchAllHandler) {
            let instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
                params: { path: fragment },
                queryParams: urlRecognizationResults ? urlRecognizationResults.queryParams : {},
                config: null // config will be created by the catchAllHandler
            }));
            result = evaluateNavigationStrategy(instruction, this.catchAllHandler);
        }
        else if (this.parent) {
            let router = this._parentCatchAllHandler(this.parent);
            if (router) {
                let newParentInstruction = this._findParentInstructionFromRouter(router, parentInstruction);
                let instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
                    params: { path: fragment },
                    queryParams: urlRecognizationResults ? urlRecognizationResults.queryParams : {},
                    router: router,
                    parentInstruction: newParentInstruction,
                    parentCatchHandler: true,
                    config: null // config will be created by the chained parent catchAllHandler
                }));
                result = evaluateNavigationStrategy(instruction, router.catchAllHandler);
            }
        }
        if (result && parentInstruction) {
            this.baseUrl = generateBaseUrl(this.parent, parentInstruction);
        }
        return result || Promise.reject(new Error(`Route not found: ${url}`));
    }
    /**@internal */
    _findParentInstructionFromRouter(router, instruction) {
        if (instruction.router === router) {
            instruction.fragment = router.baseUrl; // need to change the fragment in case of a redirect instead of moduleId
            return instruction;
        }
        else if (instruction.parentInstruction) {
            return this._findParentInstructionFromRouter(router, instruction.parentInstruction);
        }
        return undefined;
    }
    /**@internal */
    _parentCatchAllHandler(router) {
        if (router.catchAllHandler) {
            return router;
        }
        else if (router.parent) {
            return this._parentCatchAllHandler(router.parent);
        }
        return false;
    }
    /**
     * @internal
     */
    _createRouteConfig(config, instruction) {
        return Promise
            .resolve(config)
            .then((c) => {
            if (typeof c === 'string') {
                return { moduleId: c };
            }
            else if (typeof c === 'function') {
                return c(instruction);
            }
            return c;
        })
            // typing here could be either RouteConfig or RedirectConfig
            // but temporarily treat both as RouteConfig
            // todo: improve typings precision
            .then((c) => typeof c === 'string' ? { moduleId: c } : c)
            .then((c) => {
            c.route = instruction.params.path;
            validateRouteConfig(c);
            if (!c.navModel) {
                c.navModel = this.createNavModel(c);
            }
            return c;
        });
    }
}
/* @internal exported for unit testing */
const generateBaseUrl = (router, instruction) => {
    return `${router.baseUrl || ''}${instruction.getBaseUrl() || ''}`;
};
/* @internal exported for unit testing */
const validateRouteConfig = (config) => {
    if (typeof config !== 'object') {
        throw new Error('Invalid Route Config');
    }
    if (typeof config.route !== 'string') {
        let name = config.name || '(no name)';
        throw new Error('Invalid Route Config for "' + name + '": You must specify a "route:" pattern.');
    }
    if (!('redirect' in config || config.moduleId || config.navigationStrategy || config.viewPorts)) {
        throw new Error('Invalid Route Config for "' + config.route + '": You must specify a "moduleId:", "redirect:", "navigationStrategy:", or "viewPorts:".');
    }
};
/* @internal exported for unit testing */
const evaluateNavigationStrategy = (instruction, evaluator, context) => {
    return Promise
        .resolve(evaluator.call(context, instruction))
        .then(() => {
        if (!('viewPorts' in instruction.config)) {
            instruction.config.viewPorts = {
                'default': {
                    moduleId: instruction.config.moduleId
                }
            };
        }
        return instruction;
    });
};

/**@internal exported for unit testing */
const createNextFn = (instruction, steps) => {
    let index = -1;
    const next = function () {
        index++;
        if (index < steps.length) {
            let currentStep = steps[index];
            try {
                return currentStep(instruction, next);
            }
            catch (e) {
                return next.reject(e);
            }
        }
        else {
            return next.complete();
        }
    };
    next.complete = createCompletionHandler(next, "completed" /* Completed */);
    next.cancel = createCompletionHandler(next, "canceled" /* Canceled */);
    next.reject = createCompletionHandler(next, "rejected" /* Rejected */);
    return next;
};
/**@internal exported for unit testing */
const createCompletionHandler = (next, status) => {
    return (output) => Promise
        .resolve({
        status,
        output,
        completed: status === "completed" /* Completed */
    });
};

/**
 * The class responsible for managing and processing the navigation pipeline.
 */
class Pipeline {
    constructor() {
        /**
         * The pipeline steps. And steps added via addStep will be converted to a function
         * The actualy running functions with correct step contexts of this pipeline
         */
        this.steps = [];
    }
    /**
     * Adds a step to the pipeline.
     *
     * @param step The pipeline step.
     */
    addStep(step) {
        let run;
        if (typeof step === 'function') {
            run = step;
        }
        else if (typeof step.getSteps === 'function') {
            // getSteps is to enable support open slots
            // where devs can add multiple steps into the same slot name
            let steps = step.getSteps();
            for (let i = 0, l = steps.length; i < l; i++) {
                this.addStep(steps[i]);
            }
            return this;
        }
        else {
            run = step.run.bind(step);
        }
        this.steps.push(run);
        return this;
    }
    /**
     * Runs the pipeline.
     *
     * @param instruction The navigation instruction to process.
     */
    run(instruction) {
        const nextFn = createNextFn(instruction, this.steps);
        return nextFn();
    }
}

/**
* Determines if the provided object is a navigation command.
* A navigation command is anything with a navigate method.
*
* @param obj The object to check.
*/
function isNavigationCommand(obj) {
    return obj && typeof obj.navigate === 'function';
}
/**
* Used during the activation lifecycle to cause a redirect.
*/
class Redirect {
    /**
     * @param url The URL fragment to use as the navigation destination.
     * @param options The navigation options.
     */
    constructor(url, options = {}) {
        this.url = url;
        this.options = Object.assign({ trigger: true, replace: true }, options);
        this.shouldContinueProcessing = false;
    }
    /**
     * Called by the activation system to set the child router.
     *
     * @param router The router.
     */
    setRouter(router) {
        this.router = router;
    }
    /**
     * Called by the navigation pipeline to navigate.
     *
     * @param appRouter The router to be redirected.
     */
    navigate(appRouter) {
        let navigatingRouter = this.options.useAppRouter ? appRouter : (this.router || appRouter);
        navigatingRouter.navigate(this.url, this.options);
    }
}
/**
 * Used during the activation lifecycle to cause a redirect to a named route.
 */
class RedirectToRoute {
    /**
     * @param route The name of the route.
     * @param params The parameters to be sent to the activation method.
     * @param options The options to use for navigation.
     */
    constructor(route, params = {}, options = {}) {
        this.route = route;
        this.params = params;
        this.options = Object.assign({ trigger: true, replace: true }, options);
        this.shouldContinueProcessing = false;
    }
    /**
     * Called by the activation system to set the child router.
     *
     * @param router The router.
     */
    setRouter(router) {
        this.router = router;
    }
    /**
     * Called by the navigation pipeline to navigate.
     *
     * @param appRouter The router to be redirected.
     */
    navigate(appRouter) {
        let navigatingRouter = this.options.useAppRouter ? appRouter : (this.router || appRouter);
        navigatingRouter.navigateToRoute(this.route, this.params, this.options);
    }
}

/**
 * @internal exported for unit testing
 */
function _buildNavigationPlan(instruction, forceLifecycleMinimum) {
    let config = instruction.config;
    if ('redirect' in config) {
        return buildRedirectPlan(instruction);
    }
    const prevInstruction = instruction.previousInstruction;
    const defaultViewPortConfigs = instruction.router.viewPortDefaults;
    if (prevInstruction) {
        return buildTransitionPlans(instruction, prevInstruction, defaultViewPortConfigs, forceLifecycleMinimum);
    }
    // first navigation, only need to prepare a few information for each viewport plan
    const viewPortPlans = {};
    let viewPortConfigs = config.viewPorts;
    for (let viewPortName in viewPortConfigs) {
        let viewPortConfig = viewPortConfigs[viewPortName];
        if (viewPortConfig.moduleId === null && viewPortName in defaultViewPortConfigs) {
            viewPortConfig = defaultViewPortConfigs[viewPortName];
        }
        viewPortPlans[viewPortName] = {
            name: viewPortName,
            strategy: "replace" /* Replace */,
            config: viewPortConfig
        };
    }
    return Promise.resolve(viewPortPlans);
}
/**
 * Build redirect plan based on config of a navigation instruction
 * @internal exported for unit testing
 */
const buildRedirectPlan = (instruction) => {
    const config = instruction.config;
    const router = instruction.router;
    return router
        ._createNavigationInstruction(config.redirect)
        .then(redirectInstruction => {
        const params = {};
        const originalInstructionParams = instruction.params;
        const redirectInstructionParams = redirectInstruction.params;
        for (let key in redirectInstructionParams) {
            // If the param on the redirect points to another param, e.g. { route: first/:this, redirect: second/:this }
            let val = redirectInstructionParams[key];
            if (typeof val === 'string' && val[0] === ':') {
                val = val.slice(1);
                // And if that param is found on the original instruction then use it
                if (val in originalInstructionParams) {
                    params[key] = originalInstructionParams[val];
                }
            }
            else {
                params[key] = redirectInstructionParams[key];
            }
        }
        let redirectLocation = router.generate(redirectInstruction.config, params, instruction.options);
        // Special handling for child routes
        for (let key in originalInstructionParams) {
            redirectLocation = redirectLocation.replace(`:${key}`, originalInstructionParams[key]);
        }
        let queryString = instruction.queryString;
        if (queryString) {
            redirectLocation += '?' + queryString;
        }
        return Promise.resolve(new Redirect(redirectLocation));
    });
};
/**
 * @param viewPortPlans the Plan record that holds information about built plans
 * @internal exported for unit testing
 */
const buildTransitionPlans = (currentInstruction, previousInstruction, defaultViewPortConfigs, forceLifecycleMinimum) => {
    let viewPortPlans = {};
    let newInstructionConfig = currentInstruction.config;
    let hasNewParams = hasDifferentParameterValues(previousInstruction, currentInstruction);
    let pending = [];
    let previousViewPortInstructions = previousInstruction.viewPortInstructions;
    for (let viewPortName in previousViewPortInstructions) {
        const prevViewPortInstruction = previousViewPortInstructions[viewPortName];
        const prevViewPortComponent = prevViewPortInstruction.component;
        const newInstructionViewPortConfigs = newInstructionConfig.viewPorts;
        // if this is invoked on a viewport without any changes, based on new url,
        // newViewPortConfig will be the existing viewport instruction
        let nextViewPortConfig = viewPortName in newInstructionViewPortConfigs
            ? newInstructionViewPortConfigs[viewPortName]
            : prevViewPortInstruction;
        if (nextViewPortConfig.moduleId === null && viewPortName in defaultViewPortConfigs) {
            nextViewPortConfig = defaultViewPortConfigs[viewPortName];
        }
        const viewPortActivationStrategy = determineActivationStrategy(currentInstruction, prevViewPortInstruction, nextViewPortConfig, hasNewParams, forceLifecycleMinimum);
        const viewPortPlan = viewPortPlans[viewPortName] = {
            name: viewPortName,
            // ViewPortInstruction can quack like a RouteConfig
            config: nextViewPortConfig,
            prevComponent: prevViewPortComponent,
            prevModuleId: prevViewPortInstruction.moduleId,
            strategy: viewPortActivationStrategy
        };
        // recursively build nav plans for all existing child routers/viewports of this viewport
        // this is possible because existing child viewports and routers already have necessary information
        // to process the wildcard path from parent instruction
        if (viewPortActivationStrategy !== "replace" /* Replace */ && prevViewPortInstruction.childRouter) {
            const path = currentInstruction.getWildcardPath();
            const task = prevViewPortInstruction
                .childRouter
                ._createNavigationInstruction(path, currentInstruction)
                .then((childInstruction) => {
                viewPortPlan.childNavigationInstruction = childInstruction;
                return _buildNavigationPlan(childInstruction, 
                // is it safe to assume viewPortPlan has not been changed from previous assignment?
                // if so, can just use local variable viewPortPlanStrategy
                // there could be user code modifying viewport plan during _createNavigationInstruction?
                viewPortPlan.strategy === "invoke-lifecycle" /* InvokeLifecycle */)
                    .then(childPlan => {
                    if (childPlan instanceof Redirect) {
                        return Promise.reject(childPlan);
                    }
                    childInstruction.plan = childPlan;
                    // for bluebird ?
                    return null;
                });
            });
            pending.push(task);
        }
    }
    return Promise.all(pending).then(() => viewPortPlans);
};
/**
 * @param newViewPortConfig if this is invoked on a viewport without any changes, based on new url, newViewPortConfig will be the existing viewport instruction
 * @internal exported for unit testing
 */
const determineActivationStrategy = (currentNavInstruction, prevViewPortInstruction, newViewPortConfig, 
// indicates whether there is difference between old and new url params
hasNewParams, forceLifecycleMinimum) => {
    let newInstructionConfig = currentNavInstruction.config;
    let prevViewPortViewModel = prevViewPortInstruction.component.viewModel;
    let viewPortPlanStrategy;
    if (prevViewPortInstruction.moduleId !== newViewPortConfig.moduleId) {
        viewPortPlanStrategy = "replace" /* Replace */;
    }
    else if ('determineActivationStrategy' in prevViewPortViewModel) {
        viewPortPlanStrategy = prevViewPortViewModel.determineActivationStrategy(...currentNavInstruction.lifecycleArgs);
    }
    else if (newInstructionConfig.activationStrategy) {
        viewPortPlanStrategy = newInstructionConfig.activationStrategy;
    }
    else if (hasNewParams || forceLifecycleMinimum) {
        viewPortPlanStrategy = "invoke-lifecycle" /* InvokeLifecycle */;
    }
    else {
        viewPortPlanStrategy = "no-change" /* NoChange */;
    }
    return viewPortPlanStrategy;
};
/**@internal exported for unit testing */
const hasDifferentParameterValues = (prev, next) => {
    let prevParams = prev.params;
    let nextParams = next.params;
    let nextWildCardName = next.config.hasChildRouter ? next.getWildCardName() : null;
    for (let key in nextParams) {
        if (key === nextWildCardName) {
            continue;
        }
        if (prevParams[key] !== nextParams[key]) {
            return true;
        }
    }
    for (let key in prevParams) {
        if (key === nextWildCardName) {
            continue;
        }
        if (prevParams[key] !== nextParams[key]) {
            return true;
        }
    }
    if (!next.options.compareQueryParams) {
        return false;
    }
    let prevQueryParams = prev.queryParams;
    let nextQueryParams = next.queryParams;
    for (let key in nextQueryParams) {
        if (prevQueryParams[key] !== nextQueryParams[key]) {
            return true;
        }
    }
    for (let key in prevQueryParams) {
        if (prevQueryParams[key] !== nextQueryParams[key]) {
            return true;
        }
    }
    return false;
};

/**
 * Transform a navigation instruction into viewport plan record object,
 * or a redirect request if user viewmodel demands
 */
class BuildNavigationPlanStep {
    run(navigationInstruction, next) {
        return _buildNavigationPlan(navigationInstruction)
            .then(plan => {
            if (plan instanceof Redirect) {
                return next.cancel(plan);
            }
            navigationInstruction.plan = plan;
            return next();
        })
            .catch(next.cancel);
    }
}

/**
 * @internal Exported for unit testing
 */
const loadNewRoute = (routeLoader, navigationInstruction) => {
    let loadingPlans = determineLoadingPlans(navigationInstruction);
    let loadPromises = loadingPlans.map((loadingPlan) => loadRoute(routeLoader, loadingPlan.navigationInstruction, loadingPlan.viewPortPlan));
    return Promise.all(loadPromises);
};
/**
 * @internal Exported for unit testing
 */
const determineLoadingPlans = (navigationInstruction, loadingPlans = []) => {
    let viewPortPlans = navigationInstruction.plan;
    for (let viewPortName in viewPortPlans) {
        let viewPortPlan = viewPortPlans[viewPortName];
        let childNavInstruction = viewPortPlan.childNavigationInstruction;
        if (viewPortPlan.strategy === "replace" /* Replace */) {
            loadingPlans.push({ viewPortPlan, navigationInstruction });
            if (childNavInstruction) {
                determineLoadingPlans(childNavInstruction, loadingPlans);
            }
        }
        else {
            let viewPortInstruction = navigationInstruction.addViewPortInstruction({
                name: viewPortName,
                strategy: viewPortPlan.strategy,
                moduleId: viewPortPlan.prevModuleId,
                component: viewPortPlan.prevComponent
            });
            if (childNavInstruction) {
                viewPortInstruction.childNavigationInstruction = childNavInstruction;
                determineLoadingPlans(childNavInstruction, loadingPlans);
            }
        }
    }
    return loadingPlans;
};
/**
 * @internal Exported for unit testing
 */
const loadRoute = (routeLoader, navigationInstruction, viewPortPlan) => {
    let planConfig = viewPortPlan.config;
    let moduleId = planConfig ? planConfig.moduleId : null;
    return loadComponent(routeLoader, navigationInstruction, planConfig)
        .then((component) => {
        let viewPortInstruction = navigationInstruction.addViewPortInstruction({
            name: viewPortPlan.name,
            strategy: viewPortPlan.strategy,
            moduleId: moduleId,
            component: component
        });
        let childRouter = component.childRouter;
        if (childRouter) {
            let path = navigationInstruction.getWildcardPath();
            return childRouter
                ._createNavigationInstruction(path, navigationInstruction)
                .then((childInstruction) => {
                viewPortPlan.childNavigationInstruction = childInstruction;
                return _buildNavigationPlan(childInstruction)
                    .then((childPlan) => {
                    if (childPlan instanceof Redirect) {
                        return Promise.reject(childPlan);
                    }
                    childInstruction.plan = childPlan;
                    viewPortInstruction.childNavigationInstruction = childInstruction;
                    return loadNewRoute(routeLoader, childInstruction);
                });
            });
        }
        // ts complains without this, though they are same
        return void 0;
    });
};
/**
 * Load a routed-component based on navigation instruction and route config
 * @internal exported for unit testing only
 */
const loadComponent = (routeLoader, navigationInstruction, config) => {
    let router = navigationInstruction.router;
    let lifecycleArgs = navigationInstruction.lifecycleArgs;
    return Promise.resolve()
        .then(() => routeLoader.loadRoute(router, config, navigationInstruction))
        .then(
    /**
     * @param component an object carrying information about loaded route
     * typically contains information about view model, childContainer, view and router
     */
    (component) => {
        let { viewModel, childContainer } = component;
        component.router = router;
        component.config = config;
        if ('configureRouter' in viewModel) {
            let childRouter = childContainer.getChildRouter();
            component.childRouter = childRouter;
            return childRouter
                .configure(c => viewModel.configureRouter(c, childRouter, lifecycleArgs[0], lifecycleArgs[1], lifecycleArgs[2]))
                .then(() => component);
        }
        return component;
    });
};

/**
 * Abstract class that is responsible for loading view / view model from a route config
 * The default implementation can be found in `aurelia-templating-router`
 */
class RouteLoader {
    /**
     * Load a route config based on its viewmodel / view configuration
     */
    // return typing: return typings used to be never
    // as it was a throw. Changing it to Promise<any> should not cause any issues
    loadRoute(router, config, navigationInstruction) {
        throw new Error('Route loaders must implement "loadRoute(router, config, navigationInstruction)".');
    }
}

/**
 * A pipeline step responsible for loading a route config of a navigation instruction
 */
class LoadRouteStep {
    /**@internal */
    static inject() { return [RouteLoader]; }
    constructor(routeLoader) {
        this.routeLoader = routeLoader;
    }
    /**
     * Run the internal to load route config of a navigation instruction to prepare for next steps in the pipeline
     */
    run(navigationInstruction, next) {
        return loadNewRoute(this.routeLoader, navigationInstruction)
            .then(next, next.cancel);
    }
}

/**
 * A pipeline step for instructing a piepline to commit changes on a navigation instruction
 */
class CommitChangesStep {
    run(navigationInstruction, next) {
        return navigationInstruction
            ._commitChanges(/*wait to swap?*/ true)
            .then(() => {
            navigationInstruction._updateTitle();
            return next();
        });
    }
}

/**
 * An optional interface describing the available activation strategies.
 * @internal Used internally.
 */
var InternalActivationStrategy;
(function (InternalActivationStrategy) {
    /**
     * Reuse the existing view model, without invoking Router lifecycle hooks.
     */
    InternalActivationStrategy["NoChange"] = "no-change";
    /**
     * Reuse the existing view model, invoking Router lifecycle hooks.
     */
    InternalActivationStrategy["InvokeLifecycle"] = "invoke-lifecycle";
    /**
     * Replace the existing view model, invoking Router lifecycle hooks.
     */
    InternalActivationStrategy["Replace"] = "replace";
})(InternalActivationStrategy || (InternalActivationStrategy = {}));
/**
 * The strategy to use when activating modules during navigation.
 */
// kept for compat reason
const activationStrategy = {
    noChange: "no-change" /* NoChange */,
    invokeLifecycle: "invoke-lifecycle" /* InvokeLifecycle */,
    replace: "replace" /* Replace */
};

/**
 * Recursively find list of deactivate-able view models
 * and invoke the either 'canDeactivate' or 'deactivate' on each
 * @internal exported for unit testing
 */
const processDeactivatable = (navigationInstruction, callbackName, next, ignoreResult) => {
    let plan = navigationInstruction.plan;
    let infos = findDeactivatable(plan, callbackName);
    let i = infos.length; // query from inside out
    function inspect(val) {
        if (ignoreResult || shouldContinue(val)) {
            return iterate();
        }
        return next.cancel(val);
    }
    function iterate() {
        if (i--) {
            try {
                let viewModel = infos[i];
                let result = viewModel[callbackName](navigationInstruction);
                return processPotential(result, inspect, next.cancel);
            }
            catch (error) {
                return next.cancel(error);
            }
        }
        navigationInstruction.router.couldDeactivate = true;
        return next();
    }
    return iterate();
};
/**
 * Recursively find and returns a list of deactivate-able view models
 * @internal exported for unit testing
 */
const findDeactivatable = (plan, callbackName, list = []) => {
    for (let viewPortName in plan) {
        let viewPortPlan = plan[viewPortName];
        let prevComponent = viewPortPlan.prevComponent;
        if ((viewPortPlan.strategy === activationStrategy.invokeLifecycle || viewPortPlan.strategy === activationStrategy.replace)
            && prevComponent) {
            let viewModel = prevComponent.viewModel;
            if (callbackName in viewModel) {
                list.push(viewModel);
            }
        }
        if (viewPortPlan.strategy === activationStrategy.replace && prevComponent) {
            addPreviousDeactivatable(prevComponent, callbackName, list);
        }
        else if (viewPortPlan.childNavigationInstruction) {
            findDeactivatable(viewPortPlan.childNavigationInstruction.plan, callbackName, list);
        }
    }
    return list;
};
/**
 * @internal exported for unit testing
 */
const addPreviousDeactivatable = (component, callbackName, list) => {
    let childRouter = component.childRouter;
    if (childRouter && childRouter.currentInstruction) {
        let viewPortInstructions = childRouter.currentInstruction.viewPortInstructions;
        for (let viewPortName in viewPortInstructions) {
            let viewPortInstruction = viewPortInstructions[viewPortName];
            let prevComponent = viewPortInstruction.component;
            let prevViewModel = prevComponent.viewModel;
            if (callbackName in prevViewModel) {
                list.push(prevViewModel);
            }
            addPreviousDeactivatable(prevComponent, callbackName, list);
        }
    }
};
/**
 * @internal exported for unit testing
 */
const processActivatable = (navigationInstruction, callbackName, next, ignoreResult) => {
    let infos = findActivatable(navigationInstruction, callbackName);
    let length = infos.length;
    let i = -1; // query from top down
    function inspect(val, router) {
        if (ignoreResult || shouldContinue(val, router)) {
            return iterate();
        }
        return next.cancel(val);
    }
    function iterate() {
        i++;
        if (i < length) {
            try {
                let current = infos[i];
                let result = current.viewModel[callbackName](...current.lifecycleArgs);
                return processPotential(result, (val) => inspect(val, current.router), next.cancel);
            }
            catch (error) {
                return next.cancel(error);
            }
        }
        return next();
    }
    return iterate();
};
/**
 * Find list of activatable view model and add to list (3rd parameter)
 * @internal exported for unit testing
 */
const findActivatable = (navigationInstruction, callbackName, list = [], router) => {
    let plan = navigationInstruction.plan;
    Object
        .keys(plan)
        .forEach((viewPortName) => {
        let viewPortPlan = plan[viewPortName];
        let viewPortInstruction = navigationInstruction.viewPortInstructions[viewPortName];
        let viewPortComponent = viewPortInstruction.component;
        let viewModel = viewPortComponent.viewModel;
        if ((viewPortPlan.strategy === activationStrategy.invokeLifecycle
            || viewPortPlan.strategy === activationStrategy.replace)
            && callbackName in viewModel) {
            list.push({
                viewModel,
                lifecycleArgs: viewPortInstruction.lifecycleArgs,
                router
            });
        }
        let childNavInstruction = viewPortPlan.childNavigationInstruction;
        if (childNavInstruction) {
            findActivatable(childNavInstruction, callbackName, list, viewPortComponent.childRouter || router);
        }
    });
    return list;
};
const shouldContinue = (output, router) => {
    if (output instanceof Error) {
        return false;
    }
    if (isNavigationCommand(output)) {
        if (typeof output.setRouter === 'function') {
            output.setRouter(router);
        }
        return !!output.shouldContinueProcessing;
    }
    if (output === undefined) {
        return true;
    }
    return output;
};
/**
 * wraps a subscription, allowing unsubscribe calls even if
 * the first value comes synchronously
 */
class SafeSubscription {
    constructor(subscriptionFunc) {
        this._subscribed = true;
        this._subscription = subscriptionFunc(this);
        if (!this._subscribed) {
            this.unsubscribe();
        }
    }
    get subscribed() {
        return this._subscribed;
    }
    unsubscribe() {
        if (this._subscribed && this._subscription) {
            this._subscription.unsubscribe();
        }
        this._subscribed = false;
    }
}
/**
 * A function to process return value from `activate`/`canActivate` steps
 * Supports observable/promise
 *
 * For observable, resolve at first next() or on complete()
 */
const processPotential = (obj, resolve, reject) => {
    // if promise like
    if (obj && typeof obj.then === 'function') {
        return Promise.resolve(obj).then(resolve).catch(reject);
    }
    // if observable
    if (obj && typeof obj.subscribe === 'function') {
        let obs = obj;
        return new SafeSubscription(sub => obs.subscribe({
            next() {
                if (sub.subscribed) {
                    sub.unsubscribe();
                    resolve(obj);
                }
            },
            error(error) {
                if (sub.subscribed) {
                    sub.unsubscribe();
                    reject(error);
                }
            },
            complete() {
                if (sub.subscribed) {
                    sub.unsubscribe();
                    resolve(obj);
                }
            }
        }));
    }
    // else just resolve
    try {
        return resolve(obj);
    }
    catch (error) {
        return reject(error);
    }
};

/**
 * A pipeline step responsible for finding and activating method `canDeactivate` on a view model of a route
 */
class CanDeactivatePreviousStep {
    run(navigationInstruction, next) {
        return processDeactivatable(navigationInstruction, 'canDeactivate', next);
    }
}
/**
 * A pipeline step responsible for finding and activating method `canActivate` on a view model of a route
 */
class CanActivateNextStep {
    run(navigationInstruction, next) {
        return processActivatable(navigationInstruction, 'canActivate', next);
    }
}
/**
 * A pipeline step responsible for finding and activating method `deactivate` on a view model of a route
 */
class DeactivatePreviousStep {
    run(navigationInstruction, next) {
        return processDeactivatable(navigationInstruction, 'deactivate', next, true);
    }
}
/**
 * A pipeline step responsible for finding and activating method `activate` on a view model of a route
 */
class ActivateNextStep {
    run(navigationInstruction, next) {
        return processActivatable(navigationInstruction, 'activate', next, true);
    }
}

/**
 * A multi-slots Pipeline Placeholder Step for hooking into a pipeline execution
 */
class PipelineSlot {
    constructor(container, name, alias) {
        this.steps = [];
        this.container = container;
        this.slotName = name;
        this.slotAlias = alias;
    }
    getSteps() {
        return this.steps.map(x => this.container.get(x));
    }
}
/**
 * Class responsible for creating the navigation pipeline.
 */
class PipelineProvider {
    /**@internal */
    static inject() { return [__WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Container"]]; }
    constructor(container) {
        this.container = container;
        this.steps = [
            BuildNavigationPlanStep,
            CanDeactivatePreviousStep,
            LoadRouteStep,
            createPipelineSlot(container, "authorize" /* Authorize */),
            CanActivateNextStep,
            createPipelineSlot(container, "preActivate" /* PreActivate */, 'modelbind'),
            // NOTE: app state changes start below - point of no return
            DeactivatePreviousStep,
            ActivateNextStep,
            createPipelineSlot(container, "preRender" /* PreRender */, 'precommit'),
            CommitChangesStep,
            createPipelineSlot(container, "postRender" /* PostRender */, 'postcomplete')
        ];
    }
    /**
     * Create the navigation pipeline.
     */
    createPipeline(useCanDeactivateStep = true) {
        let pipeline = new Pipeline();
        this.steps.forEach(step => {
            if (useCanDeactivateStep || step !== CanDeactivatePreviousStep) {
                pipeline.addStep(this.container.get(step));
            }
        });
        return pipeline;
    }
    /**@internal */
    _findStep(name) {
        // Steps that are not PipelineSlots are constructor functions, and they will automatically fail. Probably.
        return this.steps.find(x => x.slotName === name || x.slotAlias === name);
    }
    /**
     * Adds a step into the pipeline at a known slot location.
     */
    addStep(name, step) {
        let found = this._findStep(name);
        if (found) {
            let slotSteps = found.steps;
            // prevent duplicates
            if (!slotSteps.includes(step)) {
                slotSteps.push(step);
            }
        }
        else {
            throw new Error(`Invalid pipeline slot name: ${name}.`);
        }
    }
    /**
     * Removes a step from a slot in the pipeline
     */
    removeStep(name, step) {
        let slot = this._findStep(name);
        if (slot) {
            let slotSteps = slot.steps;
            slotSteps.splice(slotSteps.indexOf(step), 1);
        }
    }
    /**
     * Clears all steps from a slot in the pipeline
     * @internal
     */
    _clearSteps(name = '') {
        let slot = this._findStep(name);
        if (slot) {
            slot.steps = [];
        }
    }
    /**
     * Resets all pipeline slots
     */
    reset() {
        this._clearSteps("authorize" /* Authorize */);
        this._clearSteps("preActivate" /* PreActivate */);
        this._clearSteps("preRender" /* PreRender */);
        this._clearSteps("postRender" /* PostRender */);
    }
}
/**@internal */
const createPipelineSlot = (container, name, alias) => {
    return new PipelineSlot(container, name, alias);
};

const logger = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"])('app-router');
/**
 * The main application router.
 */
class AppRouter extends Router {
    /**@internal */
    static inject() { return [__WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Container"], __WEBPACK_IMPORTED_MODULE_2_aurelia_history__["History"], PipelineProvider, __WEBPACK_IMPORTED_MODULE_4_aurelia_event_aggregator__["EventAggregator"]]; }
    constructor(container, history, pipelineProvider, events) {
        super(container, history); // Note the super will call reset internally.
        this.pipelineProvider = pipelineProvider;
        this.events = events;
    }
    /**
     * Fully resets the router's internal state. Primarily used internally by the framework when multiple calls to setRoot are made.
     * Use with caution (actually, avoid using this). Do not use this to simply change your navigation model.
     */
    reset() {
        super.reset();
        this.maxInstructionCount = 10;
        if (!this._queue) {
            this._queue = [];
        }
        else {
            this._queue.length = 0;
        }
    }
    /**
     * Loads the specified URL.
     *
     * @param url The URL fragment to load.
     */
    loadUrl(url) {
        return this
            ._createNavigationInstruction(url)
            .then(instruction => this._queueInstruction(instruction))
            .catch(error => {
            logger.error(error);
            restorePreviousLocation(this);
        });
    }
    /**
     * Registers a viewPort to be used as a rendering target for activated routes.
     *
     * @param viewPort The viewPort. This is typically a <router-view/> element in Aurelia default impl
     * @param name The name of the viewPort. 'default' if unspecified.
     */
    registerViewPort(viewPort, name) {
        // having strong typing without changing public API
        const $viewPort = viewPort;
        super.registerViewPort($viewPort, name);
        // beside adding viewport to the registry of this instance
        // AppRouter also configure routing/history to start routing functionality
        // There are situation where there are more than 1 <router-view/> element at root view
        // in that case, still only activate once via the following guard
        if (!this.isActive) {
            const viewModel = this._findViewModel($viewPort);
            if ('configureRouter' in viewModel) {
                // If there are more than one <router-view/> element at root view
                // use this flag to guard against configure method being invoked multiple times
                // this flag is set inside method configure
                if (!this.isConfigured) {
                    // replace the real resolve with a noop to guarantee that any action in base class Router
                    // won't resolve the configurePromise prematurely
                    const resolveConfiguredPromise = this._resolveConfiguredPromise;
                    this._resolveConfiguredPromise = () => { };
                    return this
                        .configure(config => Promise
                        .resolve(viewModel.configureRouter(config, this))
                        // an issue with configure interface. Should be fixed there
                        // todo: fix this via configure interface in router
                        .then(() => config))
                        .then(() => {
                        this.activate();
                        resolveConfiguredPromise();
                    });
                }
            }
            else {
                this.activate();
            }
        }
        // when a viewport is added dynamically to a root view that is already activated
        // just process the navigation instruction
        else {
            this._dequeueInstruction();
        }
        return Promise.resolve();
    }
    /**
     * Activates the router. This instructs the router to begin listening for history changes and processing instructions.
     *
     * @params options The set of options to activate the router with.
     */
    activate(options) {
        if (this.isActive) {
            return;
        }
        this.isActive = true;
        // route handler property is responsible for handling url change
        // the interface of aurelia-history isn't clear on this perspective
        this.options = Object.assign({ routeHandler: this.loadUrl.bind(this) }, this.options, options);
        this.history.activate(this.options);
        this._dequeueInstruction();
    }
    /**
     * Deactivates the router.
     */
    deactivate() {
        this.isActive = false;
        this.history.deactivate();
    }
    /**@internal */
    _queueInstruction(instruction) {
        return new Promise((resolve) => {
            instruction.resolve = resolve;
            this._queue.unshift(instruction);
            this._dequeueInstruction();
        });
    }
    /**@internal */
    _dequeueInstruction(instructionCount = 0) {
        return Promise.resolve().then(() => {
            if (this.isNavigating && !instructionCount) {
                // ts complains about inconsistent returns without void 0
                return void 0;
            }
            let instruction = this._queue.shift();
            this._queue.length = 0;
            if (!instruction) {
                // ts complains about inconsistent returns without void 0
                return void 0;
            }
            this.isNavigating = true;
            let navtracker = this.history.getState('NavigationTracker');
            let currentNavTracker = this.currentNavigationTracker;
            if (!navtracker && !currentNavTracker) {
                this.isNavigatingFirst = true;
                this.isNavigatingNew = true;
            }
            else if (!navtracker) {
                this.isNavigatingNew = true;
            }
            else if (!currentNavTracker) {
                this.isNavigatingRefresh = true;
            }
            else if (currentNavTracker < navtracker) {
                this.isNavigatingForward = true;
            }
            else if (currentNavTracker > navtracker) {
                this.isNavigatingBack = true;
            }
            if (!navtracker) {
                navtracker = Date.now();
                this.history.setState('NavigationTracker', navtracker);
            }
            this.currentNavigationTracker = navtracker;
            instruction.previousInstruction = this.currentInstruction;
            let maxInstructionCount = this.maxInstructionCount;
            if (!instructionCount) {
                this.events.publish("router:navigation:processing" /* Processing */, { instruction });
            }
            else if (instructionCount === maxInstructionCount - 1) {
                logger.error(`${instructionCount + 1} navigation instructions have been attempted without success. Restoring last known good location.`);
                restorePreviousLocation(this);
                return this._dequeueInstruction(instructionCount + 1);
            }
            else if (instructionCount > maxInstructionCount) {
                throw new Error('Maximum navigation attempts exceeded. Giving up.');
            }
            let pipeline = this.pipelineProvider.createPipeline(!this.couldDeactivate);
            return pipeline
                .run(instruction)
                .then(result => processResult(instruction, result, instructionCount, this))
                .catch(error => {
                return { output: error instanceof Error ? error : new Error(error) };
            })
                .then(result => resolveInstruction(instruction, result, !!instructionCount, this));
        });
    }
    /**@internal */
    _findViewModel(viewPort) {
        if (this.container.viewModel) {
            return this.container.viewModel;
        }
        if (viewPort.container) {
            let container = viewPort.container;
            while (container) {
                if (container.viewModel) {
                    this.container.viewModel = container.viewModel;
                    return container.viewModel;
                }
                container = container.parent;
            }
        }
        return undefined;
    }
}
const processResult = (instruction, result, instructionCount, router) => {
    if (!(result && 'completed' in result && 'output' in result)) {
        result = result || {};
        result.output = new Error(`Expected router pipeline to return a navigation result, but got [${JSON.stringify(result)}] instead.`);
    }
    let finalResult = null;
    let navigationCommandResult = null;
    if (isNavigationCommand(result.output)) {
        navigationCommandResult = result.output.navigate(router);
    }
    else {
        finalResult = result;
        if (!result.completed) {
            if (result.output instanceof Error) {
                logger.error(result.output.toString());
            }
            restorePreviousLocation(router);
        }
    }
    return Promise.resolve(navigationCommandResult)
        .then(_ => router._dequeueInstruction(instructionCount + 1))
        .then(innerResult => finalResult || innerResult || result);
};
const resolveInstruction = (instruction, result, isInnerInstruction, router) => {
    instruction.resolve(result);
    let eventAggregator = router.events;
    let eventArgs = { instruction, result };
    if (!isInnerInstruction) {
        router.isNavigating = false;
        router.isExplicitNavigation = false;
        router.isExplicitNavigationBack = false;
        router.isNavigatingFirst = false;
        router.isNavigatingNew = false;
        router.isNavigatingRefresh = false;
        router.isNavigatingForward = false;
        router.isNavigatingBack = false;
        router.couldDeactivate = false;
        let eventName;
        if (result.output instanceof Error) {
            eventName = "router:navigation:error" /* Error */;
        }
        else if (!result.completed) {
            eventName = "router:navigation:canceled" /* Canceled */;
        }
        else {
            let queryString = instruction.queryString ? ('?' + instruction.queryString) : '';
            router.history.previousLocation = instruction.fragment + queryString;
            eventName = "router:navigation:success" /* Success */;
        }
        eventAggregator.publish(eventName, eventArgs);
        eventAggregator.publish("router:navigation:complete" /* Complete */, eventArgs);
    }
    else {
        eventAggregator.publish("router:navigation:child:complete" /* ChildComplete */, eventArgs);
    }
    return result;
};
const restorePreviousLocation = (router) => {
    let previousLocation = router.history.previousLocation;
    if (previousLocation) {
        router.navigate(previousLocation, { trigger: false, replace: true });
    }
    else if (router.fallbackRoute) {
        router.navigate(router.fallbackRoute, { trigger: true, replace: true });
    }
    else {
        logger.error('Router navigation failed, and no previous location or fallbackRoute could be restored.');
    }
};

/**
* The status of a Pipeline.
*/
var PipelineStatus;
(function (PipelineStatus) {
    PipelineStatus["Completed"] = "completed";
    PipelineStatus["Canceled"] = "canceled";
    PipelineStatus["Rejected"] = "rejected";
    PipelineStatus["Running"] = "running";
})(PipelineStatus || (PipelineStatus = {}));

/**
 * A list of known router events used by the Aurelia router
 * to signal the pipeline has come to a certain state
 */
// const enum is preserved in tsconfig
var RouterEvent;
(function (RouterEvent) {
    RouterEvent["Processing"] = "router:navigation:processing";
    RouterEvent["Error"] = "router:navigation:error";
    RouterEvent["Canceled"] = "router:navigation:canceled";
    RouterEvent["Complete"] = "router:navigation:complete";
    RouterEvent["Success"] = "router:navigation:success";
    RouterEvent["ChildComplete"] = "router:navigation:child:complete";
})(RouterEvent || (RouterEvent = {}));

/**
 * Available pipeline slot names to insert interceptor into router pipeline
 */
// const enum is preserved in tsconfig
var PipelineSlotName;
(function (PipelineSlotName) {
    /**
     * Authorization slot. Invoked early in the pipeline,
     * before `canActivate` hook of incoming route
     */
    PipelineSlotName["Authorize"] = "authorize";
    /**
     * Pre-activation slot. Invoked early in the pipeline,
     * Invoked timing:
     *   - after Authorization slot
     *   - after canActivate hook on new view model
     *   - before deactivate hook on old view model
     *   - before activate hook on new view model
     */
    PipelineSlotName["PreActivate"] = "preActivate";
    /**
     * Pre-render slot. Invoked later in the pipeline
     * Invokcation timing:
     *   - after activate hook on new view model
     *   - before commit step on new navigation instruction
     */
    PipelineSlotName["PreRender"] = "preRender";
    /**
     * Post-render slot. Invoked last in the pipeline
     */
    PipelineSlotName["PostRender"] = "postRender";
})(PipelineSlotName || (PipelineSlotName = {}));


//# sourceMappingURL=aurelia-router.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ "aurelia-templating-binding":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__ = __webpack_require__(44);
/* harmony export (binding) */ __webpack_require__.d(exports, "AttributeMap", function() { return AttributeMap; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InterpolationBindingExpression", function() { return InterpolationBindingExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InterpolationBinding", function() { return InterpolationBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ChildInterpolationBinding", function() { return ChildInterpolationBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetExpression", function() { return LetExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetBinding", function() { return LetBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetInterpolationBindingExpression", function() { return LetInterpolationBindingExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetInterpolationBinding", function() { return LetInterpolationBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SyntaxInterpreter", function() { return SyntaxInterpreter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplatingBindingLanguage", function() { return TemplatingBindingLanguage; });
/* harmony export (immutable) */ exports["configure"] = configure;
var _class, _temp, _dec, _class2, _dec2, _class3, _class4, _temp2, _class5, _temp3;

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }







var AttributeMap = (_temp = _class = function () {
  function AttributeMap(svg) {
    

    this.elements = Object.create(null);
    this.allElements = Object.create(null);

    this.svg = svg;

    this.registerUniversal('accesskey', 'accessKey');
    this.registerUniversal('contenteditable', 'contentEditable');
    this.registerUniversal('tabindex', 'tabIndex');
    this.registerUniversal('textcontent', 'textContent');
    this.registerUniversal('innerhtml', 'innerHTML');
    this.registerUniversal('scrolltop', 'scrollTop');
    this.registerUniversal('scrollleft', 'scrollLeft');
    this.registerUniversal('readonly', 'readOnly');

    this.register('label', 'for', 'htmlFor');

    this.register('img', 'usemap', 'useMap');

    this.register('input', 'maxlength', 'maxLength');
    this.register('input', 'minlength', 'minLength');
    this.register('input', 'formaction', 'formAction');
    this.register('input', 'formenctype', 'formEncType');
    this.register('input', 'formmethod', 'formMethod');
    this.register('input', 'formnovalidate', 'formNoValidate');
    this.register('input', 'formtarget', 'formTarget');

    this.register('textarea', 'maxlength', 'maxLength');

    this.register('td', 'rowspan', 'rowSpan');
    this.register('td', 'colspan', 'colSpan');
    this.register('th', 'rowspan', 'rowSpan');
    this.register('th', 'colspan', 'colSpan');
  }

  AttributeMap.prototype.register = function register(elementName, attributeName, propertyName) {
    elementName = elementName.toLowerCase();
    attributeName = attributeName.toLowerCase();
    var element = this.elements[elementName] = this.elements[elementName] || Object.create(null);
    element[attributeName] = propertyName;
  };

  AttributeMap.prototype.registerUniversal = function registerUniversal(attributeName, propertyName) {
    attributeName = attributeName.toLowerCase();
    this.allElements[attributeName] = propertyName;
  };

  AttributeMap.prototype.map = function map(elementName, attributeName) {
    if (this.svg.isStandardSvgAttribute(elementName, attributeName)) {
      return attributeName;
    }
    elementName = elementName.toLowerCase();
    attributeName = attributeName.toLowerCase();
    var element = this.elements[elementName];
    if (element !== undefined && attributeName in element) {
      return element[attributeName];
    }
    if (attributeName in this.allElements) {
      return this.allElements[attributeName];
    }

    if (/(?:^data-)|(?:^aria-)|:/.test(attributeName)) {
      return attributeName;
    }
    return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["camelCase"])(attributeName);
  };

  return AttributeMap;
}(), _class.inject = [__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["SVGAnalyzer"]], _temp);

var InterpolationBindingExpression = function () {
  function InterpolationBindingExpression(observerLocator, targetProperty, parts, mode, lookupFunctions, attribute) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.parts = parts;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.attribute = this.attrToRemove = attribute;
    this.discrete = false;
  }

  InterpolationBindingExpression.prototype.createBinding = function createBinding(target) {
    if (this.parts.length === 3) {
      return new ChildInterpolationBinding(target, this.observerLocator, this.parts[1], this.mode, this.lookupFunctions, this.targetProperty, this.parts[0], this.parts[2]);
    }
    return new InterpolationBinding(this.observerLocator, this.parts, target, this.targetProperty, this.mode, this.lookupFunctions);
  };

  return InterpolationBindingExpression;
}();

function validateTarget(target, propertyName) {
  if (propertyName === 'style') {
    __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating-binding').info('Internet Explorer does not support interpolation in "style" attributes.  Use the style attribute\'s alias, "css" instead.');
  } else if (target.parentElement && target.parentElement.nodeName === 'TEXTAREA' && propertyName === 'textContent') {
    throw new Error('Interpolation binding cannot be used in the content of a textarea element.  Use <textarea value.bind="expression"></textarea> instead.');
  }
}

var InterpolationBinding = function () {
  function InterpolationBinding(observerLocator, parts, target, targetProperty, mode, lookupFunctions) {
    

    validateTarget(target, targetProperty);
    this.observerLocator = observerLocator;
    this.parts = parts;
    this.target = target;
    this.targetProperty = targetProperty;
    this.targetAccessor = observerLocator.getAccessor(target, targetProperty);
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
  }

  InterpolationBinding.prototype.interpolate = function interpolate() {
    if (this.isBound) {
      var value = '';
      var parts = this.parts;
      for (var i = 0, ii = parts.length; i < ii; i++) {
        value += i % 2 === 0 ? parts[i] : this['childBinding' + i].value;
      }
      this.targetAccessor.setValue(value, this.target, this.targetProperty);
    }
  };

  InterpolationBinding.prototype.updateOneTimeBindings = function updateOneTimeBindings() {
    for (var i = 1, ii = this.parts.length; i < ii; i += 2) {
      var child = this['childBinding' + i];
      if (child.mode === __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime) {
        child.call();
      }
    }
  };

  InterpolationBinding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.source = source;

    var parts = this.parts;
    for (var i = 1, ii = parts.length; i < ii; i += 2) {
      var binding = new ChildInterpolationBinding(this, this.observerLocator, parts[i], this.mode, this.lookupFunctions);
      binding.bind(source);
      this['childBinding' + i] = binding;
    }

    this.isBound = true;
    this.interpolate();
  };

  InterpolationBinding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    this.source = null;
    var parts = this.parts;
    for (var i = 1, ii = parts.length; i < ii; i += 2) {
      var name = 'childBinding' + i;
      this[name].unbind();
    }
  };

  return InterpolationBinding;
}();

var ChildInterpolationBinding = (_dec = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["connectable"])(), _dec(_class2 = function () {
  function ChildInterpolationBinding(target, observerLocator, sourceExpression, mode, lookupFunctions, targetProperty, left, right) {
    

    if (target instanceof InterpolationBinding) {
      this.parent = target;
    } else {
      validateTarget(target, targetProperty);
      this.target = target;
      this.targetProperty = targetProperty;
      this.targetAccessor = observerLocator.getAccessor(target, targetProperty);
    }
    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.left = left;
    this.right = right;
  }

  ChildInterpolationBinding.prototype.updateTarget = function updateTarget(value) {
    value = value === null || value === undefined ? '' : value.toString();
    if (value !== this.value) {
      this.value = value;
      if (this.parent) {
        this.parent.interpolate();
      } else {
        this.targetAccessor.setValue(this.left + value + this.right, this.target, this.targetProperty);
      }
    }
  };

  ChildInterpolationBinding.prototype.call = function call() {
    if (!this.isBound) {
      return;
    }

    this.rawValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
    this.updateTarget(this.rawValue);

    if (this.mode !== __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime) {
      this._version++;
      this.sourceExpression.connect(this, this.source);
      if (this.rawValue instanceof Array) {
        this.observeArray(this.rawValue);
      }
      this.unobserve(false);
    }
  };

  ChildInterpolationBinding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    var sourceExpression = this.sourceExpression;
    if (sourceExpression.bind) {
      sourceExpression.bind(this, source, this.lookupFunctions);
    }

    this.rawValue = sourceExpression.evaluate(source, this.lookupFunctions);
    this.updateTarget(this.rawValue);

    if (this.mode === __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay) {
      __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["enqueueBindingConnect"])(this);
    }
  };

  ChildInterpolationBinding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    var sourceExpression = this.sourceExpression;
    if (sourceExpression.unbind) {
      sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this.value = null;
    this.rawValue = null;
    this.unobserve(true);
  };

  ChildInterpolationBinding.prototype.connect = function connect(evaluate) {
    if (!this.isBound) {
      return;
    }
    if (evaluate) {
      this.rawValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      this.updateTarget(this.rawValue);
    }
    this.sourceExpression.connect(this, this.source);
    if (this.rawValue instanceof Array) {
      this.observeArray(this.rawValue);
    }
  };

  return ChildInterpolationBinding;
}()) || _class2);

var LetExpression = function () {
  function LetExpression(observerLocator, targetProperty, sourceExpression, lookupFunctions, toBindingContext) {
    

    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.targetProperty = targetProperty;
    this.lookupFunctions = lookupFunctions;
    this.toBindingContext = toBindingContext;
  }

  LetExpression.prototype.createBinding = function createBinding() {
    return new LetBinding(this.observerLocator, this.sourceExpression, this.targetProperty, this.lookupFunctions, this.toBindingContext);
  };

  return LetExpression;
}();

var LetBinding = (_dec2 = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["connectable"])(), _dec2(_class3 = function () {
  function LetBinding(observerLocator, sourceExpression, targetProperty, lookupFunctions, toBindingContext) {
    

    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.targetProperty = targetProperty;
    this.lookupFunctions = lookupFunctions;
    this.source = null;
    this.target = null;
    this.toBindingContext = toBindingContext;
  }

  LetBinding.prototype.updateTarget = function updateTarget() {
    var value = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
    this.target[this.targetProperty] = value;
  };

  LetBinding.prototype.call = function call(context) {
    if (!this.isBound) {
      return;
    }
    if (context === __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["sourceContext"]) {
      this.updateTarget();
      return;
    }
    throw new Error('Unexpected call context ' + context);
  };

  LetBinding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }

    this.isBound = true;
    this.source = source;
    this.target = this.toBindingContext ? source.bindingContext : source.overrideContext;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }

    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["enqueueBindingConnect"])(this);
  };

  LetBinding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this.target = null;
    this.unobserve(true);
  };

  LetBinding.prototype.connect = function connect() {
    if (!this.isBound) {
      return;
    }
    this.updateTarget();
    this.sourceExpression.connect(this, this.source);
  };

  return LetBinding;
}()) || _class3);

var LetInterpolationBindingExpression = function () {
  function LetInterpolationBindingExpression(observerLocator, targetProperty, parts, lookupFunctions, toBindingContext) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.parts = parts;
    this.lookupFunctions = lookupFunctions;
    this.toBindingContext = toBindingContext;
  }

  LetInterpolationBindingExpression.prototype.createBinding = function createBinding() {
    return new LetInterpolationBinding(this.observerLocator, this.targetProperty, this.parts, this.lookupFunctions, this.toBindingContext);
  };

  return LetInterpolationBindingExpression;
}();

var LetInterpolationBinding = function () {
  function LetInterpolationBinding(observerLocator, targetProperty, parts, lookupFunctions, toBindingContext) {
    

    this.observerLocator = observerLocator;
    this.parts = parts;
    this.targetProperty = targetProperty;
    this.lookupFunctions = lookupFunctions;
    this.toBindingContext = toBindingContext;
    this.target = null;
  }

  LetInterpolationBinding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }

    this.isBound = true;
    this.source = source;
    this.target = this.toBindingContext ? source.bindingContext : source.overrideContext;

    this.interpolationBinding = this.createInterpolationBinding();
    this.interpolationBinding.bind(source);
  };

  LetInterpolationBinding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    this.source = null;
    this.target = null;
    this.interpolationBinding.unbind();
    this.interpolationBinding = null;
  };

  LetInterpolationBinding.prototype.createInterpolationBinding = function createInterpolationBinding() {
    if (this.parts.length === 3) {
      return new ChildInterpolationBinding(this.target, this.observerLocator, this.parts[1], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay, this.lookupFunctions, this.targetProperty, this.parts[0], this.parts[2]);
    }
    return new InterpolationBinding(this.observerLocator, this.parts, this.target, this.targetProperty, __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay, this.lookupFunctions);
  };

  return LetInterpolationBinding;
}();

var SyntaxInterpreter = (_temp2 = _class4 = function () {
  function SyntaxInterpreter(parser, observerLocator, eventManager, attributeMap) {
    

    this.parser = parser;
    this.observerLocator = observerLocator;
    this.eventManager = eventManager;
    this.attributeMap = attributeMap;
  }

  SyntaxInterpreter.prototype.interpret = function interpret(resources, element, info, existingInstruction, context) {
    if (info.command in this) {
      return this[info.command](resources, element, info, existingInstruction, context);
    }

    return this.handleUnknownCommand(resources, element, info, existingInstruction, context);
  };

  SyntaxInterpreter.prototype.handleUnknownCommand = function handleUnknownCommand(resources, element, info, existingInstruction, context) {
    __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating-binding').warn('Unknown binding command.', info);
    return existingInstruction;
  };

  SyntaxInterpreter.prototype.determineDefaultBindingMode = function determineDefaultBindingMode(element, attrName, context) {
    var tagName = element.tagName.toLowerCase();

    if (tagName === 'input' && (attrName === 'value' || attrName === 'files') && element.type !== 'checkbox' && element.type !== 'radio' || tagName === 'input' && attrName === 'checked' && (element.type === 'checkbox' || element.type === 'radio') || (tagName === 'textarea' || tagName === 'select') && attrName === 'value' || (attrName === 'textcontent' || attrName === 'innerhtml') && element.contentEditable === 'true' || attrName === 'scrolltop' || attrName === 'scrollleft') {
      return __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].twoWay;
    }

    if (context && attrName in context.attributes && context.attributes[attrName] && context.attributes[attrName].defaultBindingMode >= __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime) {
      return context.attributes[attrName].defaultBindingMode;
    }

    return __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay;
  };

  SyntaxInterpreter.prototype.bind = function bind(resources, element, info, existingInstruction, context) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), info.defaultBindingMode === undefined || info.defaultBindingMode === null ? this.determineDefaultBindingMode(element, info.attrName, context) : info.defaultBindingMode, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype.trigger = function trigger(resources, element, info) {
    return new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ListenerExpression"](this.eventManager, info.attrName, this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["delegationStrategy"].none, true, resources.lookupFunctions);
  };

  SyntaxInterpreter.prototype.capture = function capture(resources, element, info) {
    return new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ListenerExpression"](this.eventManager, info.attrName, this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["delegationStrategy"].capturing, true, resources.lookupFunctions);
  };

  SyntaxInterpreter.prototype.delegate = function delegate(resources, element, info) {
    return new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ListenerExpression"](this.eventManager, info.attrName, this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["delegationStrategy"].bubbling, true, resources.lookupFunctions);
  };

  SyntaxInterpreter.prototype.call = function call(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["CallExpression"](this.observerLocator, info.attrName, this.parser.parse(info.attrValue), resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype.options = function options(resources, element, info, existingInstruction, context) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
    var attrValue = info.attrValue;
    var language = this.language;
    var name = null;
    var target = '';
    var current = void 0;
    var i = void 0;
    var ii = void 0;
    var inString = false;
    var inEscape = false;
    var foundName = false;

    for (i = 0, ii = attrValue.length; i < ii; ++i) {
      current = attrValue[i];

      if (current === ';' && !inString) {
        if (!foundName) {
          name = this._getPrimaryPropertyName(resources, context);
        }
        info = language.inspectAttribute(resources, '?', name, target.trim());
        language.createAttributeInstruction(resources, element, info, instruction, context);

        if (!instruction.attributes[info.attrName]) {
          instruction.attributes[info.attrName] = info.attrValue;
        }

        target = '';
        name = null;
      } else if (current === ':' && name === null) {
        foundName = true;
        name = target.trim();
        target = '';
      } else if (current === '\\') {
        target += current;
        inEscape = true;
        continue;
      } else {
        target += current;

        if (name !== null && inEscape === false && current === '\'') {
          inString = !inString;
        }
      }

      inEscape = false;
    }

    if (!foundName) {
      name = this._getPrimaryPropertyName(resources, context);
    }

    if (name !== null) {
      info = language.inspectAttribute(resources, '?', name, target.trim());
      language.createAttributeInstruction(resources, element, info, instruction, context);

      if (!instruction.attributes[info.attrName]) {
        instruction.attributes[info.attrName] = info.attrValue;
      }
    }

    return instruction;
  };

  SyntaxInterpreter.prototype._getPrimaryPropertyName = function _getPrimaryPropertyName(resources, context) {
    var type = resources.getAttribute(context.attributeName);
    if (type && type.primaryProperty) {
      return type.primaryProperty.attribute;
    }
    return null;
  };

  SyntaxInterpreter.prototype['for'] = function _for(resources, element, info, existingInstruction) {
    var parts = void 0;
    var keyValue = void 0;
    var instruction = void 0;
    var attrValue = void 0;
    var isDestructuring = void 0;

    attrValue = info.attrValue;
    isDestructuring = attrValue.match(/^ *[[].+[\]]/);
    parts = isDestructuring ? attrValue.split('of ') : attrValue.split(' of ');

    if (parts.length !== 2) {
      throw new Error('Incorrect syntax for "for". The form is: "$local of $items" or "[$key, $value] of $items".');
    }

    instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    if (isDestructuring) {
      keyValue = parts[0].replace(/[[\]]/g, '').replace(/,/g, ' ').replace(/\s+/g, ' ').trim().split(' ');
      instruction.attributes.key = keyValue[0];
      instruction.attributes.value = keyValue[1];
    } else {
      instruction.attributes.local = parts[0];
    }

    instruction.attributes.items = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, 'items', this.parser.parse(parts[1]), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['two-way'] = function twoWay(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].twoWay, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['to-view'] = function toView(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['from-view'] = function fromView(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].fromView, resources.lookupFunctions);

    return instruction;
  };

  SyntaxInterpreter.prototype['one-time'] = function oneTime(resources, element, info, existingInstruction) {
    var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);

    instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime, resources.lookupFunctions);

    return instruction;
  };

  return SyntaxInterpreter;
}(), _class4.inject = [__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["Parser"], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ObserverLocator"], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["EventManager"], AttributeMap], _temp2);

SyntaxInterpreter.prototype['one-way'] = SyntaxInterpreter.prototype['to-view'];

var info = {};

var TemplatingBindingLanguage = (_temp3 = _class5 = function (_BindingLanguage) {
  _inherits(TemplatingBindingLanguage, _BindingLanguage);

  function TemplatingBindingLanguage(parser, observerLocator, syntaxInterpreter, attributeMap) {
    

    var _this = _possibleConstructorReturn(this, _BindingLanguage.call(this));

    _this.parser = parser;
    _this.observerLocator = observerLocator;
    _this.syntaxInterpreter = syntaxInterpreter;
    _this.emptyStringExpression = _this.parser.parse('\'\'');
    syntaxInterpreter.language = _this;
    _this.attributeMap = attributeMap;
    _this.toBindingContextAttr = 'to-binding-context';
    return _this;
  }

  TemplatingBindingLanguage.prototype.inspectAttribute = function inspectAttribute(resources, elementName, attrName, attrValue) {
    var parts = attrName.split('.');

    info.defaultBindingMode = null;

    if (parts.length === 2) {
      info.attrName = parts[0].trim();
      info.attrValue = attrValue;
      info.command = parts[1].trim();

      if (info.command === 'ref') {
        info.expression = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["NameExpression"](this.parser.parse(attrValue), info.attrName, resources.lookupFunctions);
        info.command = null;
        info.attrName = 'ref';
      } else {
        info.expression = null;
      }
    } else if (attrName === 'ref') {
      info.attrName = attrName;
      info.attrValue = attrValue;
      info.command = null;
      info.expression = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["NameExpression"](this.parser.parse(attrValue), 'element', resources.lookupFunctions);
    } else {
      info.attrName = attrName;
      info.attrValue = attrValue;
      info.command = null;
      var interpolationParts = this.parseInterpolation(resources, attrValue);
      if (interpolationParts === null) {
        info.expression = null;
      } else {
        info.expression = new InterpolationBindingExpression(this.observerLocator, this.attributeMap.map(elementName, attrName), interpolationParts, __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay, resources.lookupFunctions, attrName);
      }
    }

    return info;
  };

  TemplatingBindingLanguage.prototype.createAttributeInstruction = function createAttributeInstruction(resources, element, theInfo, existingInstruction, context) {
    var instruction = void 0;

    if (theInfo.expression) {
      if (theInfo.attrName === 'ref') {
        return theInfo.expression;
      }

      instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BehaviorInstruction"].attribute(theInfo.attrName);
      instruction.attributes[theInfo.attrName] = theInfo.expression;
    } else if (theInfo.command) {
      instruction = this.syntaxInterpreter.interpret(resources, element, theInfo, existingInstruction, context);
    }

    return instruction;
  };

  TemplatingBindingLanguage.prototype.createLetExpressions = function createLetExpressions(resources, letElement) {
    var expressions = [];
    var attributes = letElement.attributes;

    var attr = void 0;

    var parts = void 0;
    var attrName = void 0;
    var attrValue = void 0;
    var command = void 0;
    var toBindingContextAttr = this.toBindingContextAttr;
    var toBindingContext = letElement.hasAttribute(toBindingContextAttr);
    for (var i = 0, ii = attributes.length; ii > i; ++i) {
      attr = attributes[i];
      attrName = attr.name;
      attrValue = attr.nodeValue;
      parts = attrName.split('.');

      if (attrName === toBindingContextAttr) {
        continue;
      }

      if (parts.length === 2) {
        command = parts[1];
        if (command !== 'bind') {
          __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating-binding-language').warn('Detected invalid let command. Expected "' + parts[0] + '.bind", given "' + attrName + '"');
          continue;
        }
        expressions.push(new LetExpression(this.observerLocator, __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["camelCase"])(parts[0]), this.parser.parse(attrValue), resources.lookupFunctions, toBindingContext));
      } else {
        attrName = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["camelCase"])(attrName);
        parts = this.parseInterpolation(resources, attrValue);
        if (parts === null) {
          __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('templating-binding-language').warn('Detected string literal in let bindings. Did you mean "' + attrName + '.bind=' + attrValue + '" or "' + attrName + '=${' + attrValue + '}" ?');
        }
        if (parts) {
          expressions.push(new LetInterpolationBindingExpression(this.observerLocator, attrName, parts, resources.lookupFunctions, toBindingContext));
        } else {
          expressions.push(new LetExpression(this.observerLocator, attrName, new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["LiteralString"](attrValue), resources.lookupFunctions, toBindingContext));
        }
      }
    }
    return expressions;
  };

  TemplatingBindingLanguage.prototype.inspectTextContent = function inspectTextContent(resources, value) {
    var parts = this.parseInterpolation(resources, value);
    if (parts === null) {
      return null;
    }
    return new InterpolationBindingExpression(this.observerLocator, 'textContent', parts, __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay, resources.lookupFunctions, 'textContent');
  };

  TemplatingBindingLanguage.prototype.parseInterpolation = function parseInterpolation(resources, value) {
    var i = value.indexOf('${', 0);
    var ii = value.length;
    var char = void 0;
    var pos = 0;
    var open = 0;
    var quote = null;
    var interpolationStart = void 0;
    var parts = void 0;
    var partIndex = 0;

    while (i >= 0 && i < ii - 2) {
      open = 1;
      interpolationStart = i;
      i += 2;

      do {
        char = value[i];
        i++;

        if (char === "'" || char === '"') {
          if (quote === null) {
            quote = char;
          } else if (quote === char) {
            quote = null;
          }
          continue;
        }

        if (char === '\\') {
          i++;
          continue;
        }

        if (quote !== null) {
          continue;
        }

        if (char === '{') {
          open++;
        } else if (char === '}') {
          open--;
        }
      } while (open > 0 && i < ii);

      if (open === 0) {
        parts = parts || [];
        if (value[interpolationStart - 1] === '\\' && value[interpolationStart - 2] !== '\\') {
          parts[partIndex] = value.substring(pos, interpolationStart - 1) + value.substring(interpolationStart, i);
          partIndex++;
          parts[partIndex] = this.emptyStringExpression;
          partIndex++;
        } else {
          parts[partIndex] = value.substring(pos, interpolationStart);
          partIndex++;
          parts[partIndex] = this.parser.parse(value.substring(interpolationStart + 2, i - 1));
          partIndex++;
        }
        pos = i;
        i = value.indexOf('${', i);
      } else {
        break;
      }
    }

    if (partIndex === 0) {
      return null;
    }

    parts[partIndex] = value.substr(pos);
    return parts;
  };

  return TemplatingBindingLanguage;
}(__WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BindingLanguage"]), _class5.inject = [__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["Parser"], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ObserverLocator"], SyntaxInterpreter, AttributeMap], _temp3);

function configure(config) {
  config.container.registerSingleton(__WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BindingLanguage"], TemplatingBindingLanguage);
  config.container.registerAlias(__WEBPACK_IMPORTED_MODULE_2_aurelia_templating__["BindingLanguage"], TemplatingBindingLanguage);
}

/***/ },

/***/ "aurelia-templating-resources":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_loader__ = __webpack_require__("aurelia-loader");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_loader___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_aurelia_loader__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_aurelia_metadata__ = __webpack_require__(58);
/* harmony export (binding) */ __webpack_require__.d(exports, "AbstractRepeater", function() { return AbstractRepeater; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ArrayRepeatStrategy", function() { return ArrayRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AttrBindingBehavior", function() { return AttrBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingSignaler", function() { return BindingSignaler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Compose", function() { return Compose; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DebounceBindingBehavior", function() { return DebounceBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Else", function() { return Else; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Focus", function() { return Focus; });
/* harmony export (binding) */ __webpack_require__.d(exports, "FromViewBindingBehavior", function() { return FromViewBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "HTMLSanitizer", function() { return HTMLSanitizer; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Hide", function() { return Hide; });
/* harmony export (binding) */ __webpack_require__.d(exports, "If", function() { return If; });
/* harmony export (binding) */ __webpack_require__.d(exports, "MapRepeatStrategy", function() { return MapRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NullRepeatStrategy", function() { return NullRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NumberRepeatStrategy", function() { return NumberRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "OneTimeBindingBehavior", function() { return OneTimeBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "OneWayBindingBehavior", function() { return OneWayBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Repeat", function() { return Repeat; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RepeatStrategyLocator", function() { return RepeatStrategyLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Replaceable", function() { return Replaceable; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SanitizeHTMLValueConverter", function() { return SanitizeHTMLValueConverter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SelfBindingBehavior", function() { return SelfBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SetRepeatStrategy", function() { return SetRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Show", function() { return Show; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SignalBindingBehavior", function() { return SignalBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ThrottleBindingBehavior", function() { return ThrottleBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ToViewBindingBehavior", function() { return ToViewBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TwoWayBindingBehavior", function() { return TwoWayBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "UpdateTriggerBindingBehavior", function() { return UpdateTriggerBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "With", function() { return With; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure$1; });
/* harmony export (binding) */ __webpack_require__.d(exports, "createFullOverrideContext", function() { return createFullOverrideContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getItemsSourceExpression", function() { return getItemsSourceExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "isOneTime", function() { return isOneTime; });
/* harmony export (binding) */ __webpack_require__.d(exports, "unwrapExpression", function() { return unwrapExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "updateOneTimeBinding", function() { return updateOneTimeBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "updateOverrideContext", function() { return updateOverrideContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "viewsRequireLifecycle", function() { return viewsRequireLifecycle; });










/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

var ActivationStrategy;
(function (ActivationStrategy) {
    ActivationStrategy["InvokeLifecycle"] = "invoke-lifecycle";
    ActivationStrategy["Replace"] = "replace";
})(ActivationStrategy || (ActivationStrategy = {}));
var Compose = (function () {
    function Compose(element, container, compositionEngine, viewSlot, viewResources, taskQueue) {
        this.activationStrategy = ActivationStrategy.InvokeLifecycle;
        this.element = element;
        this.container = container;
        this.compositionEngine = compositionEngine;
        this.viewSlot = viewSlot;
        this.viewResources = viewResources;
        this.taskQueue = taskQueue;
        this.currentController = null;
        this.currentViewModel = null;
        this.changes = Object.create(null);
    }
    Compose.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Container"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"], __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__["TaskQueue"]];
    };
    Compose.prototype.created = function (owningView) {
        this.owningView = owningView;
    };
    Compose.prototype.bind = function (bindingContext, overrideContext) {
        this.bindingContext = bindingContext;
        this.overrideContext = overrideContext;
        var changes = this.changes;
        changes.view = this.view;
        changes.viewModel = this.viewModel;
        changes.model = this.model;
        if (!this.pendingTask) {
            processChanges(this);
        }
    };
    Compose.prototype.unbind = function () {
        this.changes = Object.create(null);
        this.bindingContext = null;
        this.overrideContext = null;
        var returnToCache = true;
        var skipAnimation = true;
        this.viewSlot.removeAll(returnToCache, skipAnimation);
    };
    Compose.prototype.modelChanged = function (newValue, oldValue) {
        this.changes.model = newValue;
        requestUpdate(this);
    };
    Compose.prototype.viewChanged = function (newValue, oldValue) {
        this.changes.view = newValue;
        requestUpdate(this);
    };
    Compose.prototype.viewModelChanged = function (newValue, oldValue) {
        this.changes.viewModel = newValue;
        requestUpdate(this);
    };
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "model", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "view", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "viewModel", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "activationStrategy", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "swapOrder", void 0);
    Compose = __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["noView"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"])('compose')
    ], Compose);
    return Compose;
}());
function isEmpty(obj) {
    for (var _ in obj) {
        return false;
    }
    return true;
}
function tryActivateViewModel(vm, model) {
    if (vm && typeof vm.activate === 'function') {
        return Promise.resolve(vm.activate(model));
    }
}
function createInstruction(composer, instruction) {
    return Object.assign(instruction, {
        bindingContext: composer.bindingContext,
        overrideContext: composer.overrideContext,
        owningView: composer.owningView,
        container: composer.container,
        viewSlot: composer.viewSlot,
        viewResources: composer.viewResources,
        currentController: composer.currentController,
        host: composer.element,
        swapOrder: composer.swapOrder
    });
}
function processChanges(composer) {
    var changes = composer.changes;
    composer.changes = Object.create(null);
    if (needsReInitialization(composer, changes)) {
        var instruction = {
            view: composer.view,
            viewModel: composer.currentViewModel || composer.viewModel,
            model: composer.model
        };
        instruction = Object.assign(instruction, changes);
        instruction = createInstruction(composer, instruction);
        composer.pendingTask = composer.compositionEngine.compose(instruction).then(function (controller) {
            composer.currentController = controller;
            composer.currentViewModel = controller ? controller.viewModel : null;
        });
    }
    else {
        composer.pendingTask = tryActivateViewModel(composer.currentViewModel, changes.model);
        if (!composer.pendingTask) {
            return;
        }
    }
    composer.pendingTask = composer.pendingTask
        .then(function () {
        completeCompositionTask(composer);
    }, function (reason) {
        completeCompositionTask(composer);
        throw reason;
    });
}
function completeCompositionTask(composer) {
    composer.pendingTask = null;
    if (!isEmpty(composer.changes)) {
        processChanges(composer);
    }
}
function requestUpdate(composer) {
    if (composer.pendingTask || composer.updateRequested) {
        return;
    }
    composer.updateRequested = true;
    composer.taskQueue.queueMicroTask(function () {
        composer.updateRequested = false;
        processChanges(composer);
    });
}
function needsReInitialization(composer, changes) {
    var activationStrategy = composer.activationStrategy;
    var vm = composer.currentViewModel;
    if (vm && typeof vm.determineActivationStrategy === 'function') {
        activationStrategy = vm.determineActivationStrategy();
    }
    return 'view' in changes
        || 'viewModel' in changes
        || activationStrategy === ActivationStrategy.Replace;
}

var IfCore = (function () {
    function IfCore(viewFactory, viewSlot) {
        this.viewFactory = viewFactory;
        this.viewSlot = viewSlot;
        this.view = null;
        this.bindingContext = null;
        this.overrideContext = null;
        this.showing = false;
        this.cache = true;
    }
    IfCore.prototype.bind = function (bindingContext, overrideContext) {
        this.bindingContext = bindingContext;
        this.overrideContext = overrideContext;
    };
    IfCore.prototype.unbind = function () {
        if (this.view === null) {
            return;
        }
        this.view.unbind();
        if (!this.viewFactory.isCaching) {
            return;
        }
        if (this.showing) {
            this.showing = false;
            this.viewSlot.remove(this.view, true, true);
        }
        else {
            this.view.returnToCache();
        }
        this.view = null;
    };
    IfCore.prototype._show = function () {
        if (this.showing) {
            if (!this.view.isBound) {
                this.view.bind(this.bindingContext, this.overrideContext);
            }
            return;
        }
        if (this.view === null) {
            this.view = this.viewFactory.create();
        }
        if (!this.view.isBound) {
            this.view.bind(this.bindingContext, this.overrideContext);
        }
        this.showing = true;
        return this.viewSlot.add(this.view);
    };
    IfCore.prototype._hide = function () {
        var _this = this;
        if (!this.showing) {
            return;
        }
        this.showing = false;
        var removed = this.viewSlot.remove(this.view);
        if (removed instanceof Promise) {
            return removed.then(function () {
                _this._unbindView();
            });
        }
        this._unbindView();
    };
    IfCore.prototype._unbindView = function () {
        var cache = this.cache === 'false' ? false : !!this.cache;
        this.view.unbind();
        if (!cache) {
            this.view = null;
        }
    };
    return IfCore;
}());

var If = (function (_super) {
    __extends(If, _super);
    function If() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.cache = true;
        return _this;
    }
    If.prototype.bind = function (bindingContext, overrideContext) {
        _super.prototype.bind.call(this, bindingContext, overrideContext);
        if (this.condition) {
            this._show();
        }
        else {
            this._hide();
        }
    };
    If.prototype.conditionChanged = function (newValue) {
        this._update(newValue);
    };
    If.prototype._update = function (show) {
        var _this = this;
        if (this.animating) {
            return;
        }
        var promise;
        if (this.elseVm) {
            promise = show ? this._swap(this.elseVm, this) : this._swap(this, this.elseVm);
        }
        else {
            promise = show ? this._show() : this._hide();
        }
        if (promise) {
            this.animating = true;
            promise.then(function () {
                _this.animating = false;
                if (_this.condition !== _this.showing) {
                    _this._update(_this.condition);
                }
            });
        }
    };
    If.prototype._swap = function (remove, add) {
        switch (this.swapOrder) {
            case 'before':
                return Promise.resolve(add._show()).then(function () { return remove._hide(); });
            case 'with':
                return Promise.all([remove._hide(), add._show()]);
            default:
                var promise = remove._hide();
                return promise ? promise.then(function () { return add._show(); }) : add._show();
        }
    };
    __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"])({ primaryProperty: true })
    ], If.prototype, "condition", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], If.prototype, "swapOrder", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], If.prototype, "cache", void 0);
    If = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('if'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], If);
    return If;
}(IfCore));

var Else = (function (_super) {
    __extends(Else, _super);
    function Else(viewFactory, viewSlot) {
        var _this = _super.call(this, viewFactory, viewSlot) || this;
        _this._registerInIf();
        return _this;
    }
    Else.prototype.bind = function (bindingContext, overrideContext) {
        _super.prototype.bind.call(this, bindingContext, overrideContext);
        if (this.ifVm.condition) {
            this._hide();
        }
        else {
            this._show();
        }
    };
    Else.prototype._registerInIf = function () {
        var previous = this.viewSlot.anchor.previousSibling;
        while (previous && !previous.au) {
            previous = previous.previousSibling;
        }
        if (!previous || !previous.au.if) {
            throw new Error("Can't find matching If for Else custom attribute.");
        }
        this.ifVm = previous.au.if.viewModel;
        this.ifVm.elseVm = this;
    };
    Else = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('else'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], Else);
    return Else;
}(IfCore));

var With = (function () {
    function With(viewFactory, viewSlot) {
        this.viewFactory = viewFactory;
        this.viewSlot = viewSlot;
        this.parentOverrideContext = null;
        this.view = null;
    }
    With.prototype.bind = function (bindingContext, overrideContext) {
        this.parentOverrideContext = overrideContext;
        this.valueChanged(this.value);
    };
    With.prototype.valueChanged = function (newValue) {
        var overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["createOverrideContext"])(newValue, this.parentOverrideContext);
        var view = this.view;
        if (!view) {
            view = this.view = this.viewFactory.create();
            view.bind(newValue, overrideContext);
            this.viewSlot.add(view);
        }
        else {
            view.bind(newValue, overrideContext);
        }
    };
    With.prototype.unbind = function () {
        var view = this.view;
        this.parentOverrideContext = null;
        if (view) {
            view.unbind();
        }
    };
    With = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('with'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], With);
    return With;
}());

var oneTime = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].oneTime;
function updateOverrideContexts(views, startIndex) {
    var length = views.length;
    if (startIndex > 0) {
        startIndex = startIndex - 1;
    }
    for (; startIndex < length; ++startIndex) {
        updateOverrideContext(views[startIndex].overrideContext, startIndex, length);
    }
}
function createFullOverrideContext(repeat, data, index, length, key) {
    var bindingContext = {};
    var overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["createOverrideContext"])(bindingContext, repeat.scope.overrideContext);
    if (typeof key !== 'undefined') {
        bindingContext[repeat.key] = key;
        bindingContext[repeat.value] = data;
    }
    else {
        bindingContext[repeat.local] = data;
    }
    updateOverrideContext(overrideContext, index, length);
    return overrideContext;
}
function updateOverrideContext(overrideContext, index, length) {
    var first = (index === 0);
    var last = (index === length - 1);
    var even = index % 2 === 0;
    overrideContext.$index = index;
    overrideContext.$first = first;
    overrideContext.$last = last;
    overrideContext.$middle = !(first || last);
    overrideContext.$odd = !even;
    overrideContext.$even = even;
}
function getItemsSourceExpression(instruction, attrName) {
    return instruction.behaviorInstructions
        .filter(function (bi) { return bi.originalAttrName === attrName; })[0]
        .attributes
        .items
        .sourceExpression;
}
function unwrapExpression(expression) {
    var unwrapped = false;
    while (expression instanceof __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["BindingBehavior"]) {
        expression = expression.expression;
    }
    while (expression instanceof __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["ValueConverter"]) {
        expression = expression.expression;
        unwrapped = true;
    }
    return unwrapped ? expression : null;
}
function isOneTime(expression) {
    while (expression instanceof __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["BindingBehavior"]) {
        if (expression.name === 'oneTime') {
            return true;
        }
        expression = expression.expression;
    }
    return false;
}
function updateOneTimeBinding(binding) {
    if (binding.call && binding.mode === oneTime) {
        binding.call(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["sourceContext"]);
    }
    else if (binding.updateOneTimeBindings) {
        binding.updateOneTimeBindings();
    }
}
function indexOf(array, item, matcher, startIndex) {
    if (!matcher) {
        return array.indexOf(item);
    }
    var length = array.length;
    for (var index = startIndex || 0; index < length; index++) {
        if (matcher(array[index], item)) {
            return index;
        }
    }
    return -1;
}

var ArrayRepeatStrategy = (function () {
    function ArrayRepeatStrategy() {
    }
    ArrayRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
        return observerLocator.getArrayObserver(items);
    };
    ArrayRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        var _this = this;
        var $repeat = repeat;
        var itemsLength = items.length;
        if (!items || itemsLength === 0) {
            $repeat.removeAllViews(true, !$repeat.viewsRequireLifecycle);
            return;
        }
        var children = $repeat.views();
        var viewsLength = children.length;
        if (viewsLength === 0) {
            this._standardProcessInstanceChanged($repeat, items);
            return;
        }
        if ($repeat.viewsRequireLifecycle) {
            var childrenSnapshot = children.slice(0);
            var itemNameInBindingContext = $repeat.local;
            var matcher_1 = $repeat.matcher();
            var itemsPreviouslyInViews_1 = [];
            var viewsToRemove = [];
            for (var index = 0; index < viewsLength; index++) {
                var view = childrenSnapshot[index];
                var oldItem = view.bindingContext[itemNameInBindingContext];
                if (indexOf(items, oldItem, matcher_1) === -1) {
                    viewsToRemove.push(view);
                }
                else {
                    itemsPreviouslyInViews_1.push(oldItem);
                }
            }
            var updateViews = void 0;
            var removePromise = void 0;
            if (itemsPreviouslyInViews_1.length > 0) {
                removePromise = $repeat.removeViews(viewsToRemove, true, !$repeat.viewsRequireLifecycle);
                updateViews = function () {
                    for (var index = 0; index < itemsLength; index++) {
                        var item = items[index];
                        var indexOfView = indexOf(itemsPreviouslyInViews_1, item, matcher_1, index);
                        var view = void 0;
                        if (indexOfView === -1) {
                            var overrideContext = createFullOverrideContext($repeat, items[index], index, itemsLength);
                            $repeat.insertView(index, overrideContext.bindingContext, overrideContext);
                            itemsPreviouslyInViews_1.splice(index, 0, undefined);
                        }
                        else if (indexOfView === index) {
                            view = children[indexOfView];
                            itemsPreviouslyInViews_1[indexOfView] = undefined;
                        }
                        else {
                            view = children[indexOfView];
                            $repeat.moveView(indexOfView, index);
                            itemsPreviouslyInViews_1.splice(indexOfView, 1);
                            itemsPreviouslyInViews_1.splice(index, 0, undefined);
                        }
                        if (view) {
                            updateOverrideContext(view.overrideContext, index, itemsLength);
                        }
                    }
                    _this._inPlaceProcessItems($repeat, items);
                };
            }
            else {
                removePromise = $repeat.removeAllViews(true, !$repeat.viewsRequireLifecycle);
                updateViews = function () { return _this._standardProcessInstanceChanged($repeat, items); };
            }
            if (removePromise instanceof Promise) {
                removePromise.then(updateViews);
            }
            else {
                updateViews();
            }
        }
        else {
            this._inPlaceProcessItems($repeat, items);
        }
    };
    ArrayRepeatStrategy.prototype._standardProcessInstanceChanged = function (repeat, items) {
        for (var i = 0, ii = items.length; i < ii; i++) {
            var overrideContext = createFullOverrideContext(repeat, items[i], i, ii);
            repeat.addView(overrideContext.bindingContext, overrideContext);
        }
    };
    ArrayRepeatStrategy.prototype._inPlaceProcessItems = function (repeat, items) {
        var itemsLength = items.length;
        var viewsLength = repeat.viewCount();
        while (viewsLength > itemsLength) {
            viewsLength--;
            repeat.removeView(viewsLength, true, !repeat.viewsRequireLifecycle);
        }
        var local = repeat.local;
        for (var i = 0; i < viewsLength; i++) {
            var view = repeat.view(i);
            var last = i === itemsLength - 1;
            var middle = i !== 0 && !last;
            var bindingContext = view.bindingContext;
            var overrideContext = view.overrideContext;
            if (bindingContext[local] === items[i]
                && overrideContext.$middle === middle
                && overrideContext.$last === last) {
                continue;
            }
            bindingContext[local] = items[i];
            overrideContext.$middle = middle;
            overrideContext.$last = last;
            repeat.updateBindings(view);
        }
        for (var i = viewsLength; i < itemsLength; i++) {
            var overrideContext = createFullOverrideContext(repeat, items[i], i, itemsLength);
            repeat.addView(overrideContext.bindingContext, overrideContext);
        }
    };
    ArrayRepeatStrategy.prototype.instanceMutated = function (repeat, array, splices) {
        var _this = this;
        if (repeat.__queuedSplices) {
            for (var i = 0, ii = splices.length; i < ii; ++i) {
                var _a = splices[i], index = _a.index, removed = _a.removed, addedCount = _a.addedCount;
                __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["mergeSplice"])(repeat.__queuedSplices, index, removed, addedCount);
            }
            repeat.__array = array.slice(0);
            return;
        }
        var maybePromise = this._runSplices(repeat, array.slice(0), splices);
        if (maybePromise instanceof Promise) {
            var queuedSplices_1 = repeat.__queuedSplices = [];
            var runQueuedSplices_1 = function () {
                if (!queuedSplices_1.length) {
                    repeat.__queuedSplices = undefined;
                    repeat.__array = undefined;
                    return;
                }
                var nextPromise = _this._runSplices(repeat, repeat.__array, queuedSplices_1) || Promise.resolve();
                queuedSplices_1 = repeat.__queuedSplices = [];
                nextPromise.then(runQueuedSplices_1);
            };
            maybePromise.then(runQueuedSplices_1);
        }
    };
    ArrayRepeatStrategy.prototype._runSplices = function (repeat, array, splices) {
        var _this = this;
        var removeDelta = 0;
        var rmPromises = [];
        for (var i = 0, ii = splices.length; i < ii; ++i) {
            var splice = splices[i];
            var removed = splice.removed;
            for (var j = 0, jj = removed.length; j < jj; ++j) {
                var viewOrPromise = repeat.removeView(splice.index + removeDelta + rmPromises.length, true);
                if (viewOrPromise instanceof Promise) {
                    rmPromises.push(viewOrPromise);
                }
            }
            removeDelta -= splice.addedCount;
        }
        if (rmPromises.length > 0) {
            return Promise.all(rmPromises).then(function () {
                var spliceIndexLow = _this._handleAddedSplices(repeat, array, splices);
                updateOverrideContexts(repeat.views(), spliceIndexLow);
            });
        }
        var spliceIndexLow = this._handleAddedSplices(repeat, array, splices);
        updateOverrideContexts(repeat.views(), spliceIndexLow);
        return undefined;
    };
    ArrayRepeatStrategy.prototype._handleAddedSplices = function (repeat, array, splices) {
        var spliceIndex;
        var spliceIndexLow;
        var arrayLength = array.length;
        for (var i = 0, ii = splices.length; i < ii; ++i) {
            var splice = splices[i];
            var addIndex = spliceIndex = splice.index;
            var end = splice.index + splice.addedCount;
            if (typeof spliceIndexLow === 'undefined' || spliceIndexLow === null || spliceIndexLow > splice.index) {
                spliceIndexLow = spliceIndex;
            }
            for (; addIndex < end; ++addIndex) {
                var overrideContext = createFullOverrideContext(repeat, array[addIndex], addIndex, arrayLength);
                repeat.insertView(addIndex, overrideContext.bindingContext, overrideContext);
            }
        }
        return spliceIndexLow;
    };
    return ArrayRepeatStrategy;
}());

var MapRepeatStrategy = (function () {
    function MapRepeatStrategy() {
    }
    MapRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
        return observerLocator.getMapObserver(items);
    };
    MapRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        var _this = this;
        var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
        if (removePromise instanceof Promise) {
            removePromise.then(function () { return _this._standardProcessItems(repeat, items); });
            return;
        }
        this._standardProcessItems(repeat, items);
    };
    MapRepeatStrategy.prototype._standardProcessItems = function (repeat, items) {
        var index = 0;
        var overrideContext;
        items.forEach(function (value, key) {
            overrideContext = createFullOverrideContext(repeat, value, index, items.size, key);
            repeat.addView(overrideContext.bindingContext, overrideContext);
            ++index;
        });
    };
    MapRepeatStrategy.prototype.instanceMutated = function (repeat, map, records) {
        var key;
        var i;
        var ii;
        var overrideContext;
        var removeIndex;
        var addIndex;
        var record;
        var rmPromises = [];
        var viewOrPromise;
        for (i = 0, ii = records.length; i < ii; ++i) {
            record = records[i];
            key = record.key;
            switch (record.type) {
                case 'update':
                    removeIndex = this._getViewIndexByKey(repeat, key);
                    viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
                    if (viewOrPromise instanceof Promise) {
                        rmPromises.push(viewOrPromise);
                    }
                    overrideContext = createFullOverrideContext(repeat, map.get(key), removeIndex, map.size, key);
                    repeat.insertView(removeIndex, overrideContext.bindingContext, overrideContext);
                    break;
                case 'add':
                    addIndex = repeat.viewCount() <= map.size - 1 ? repeat.viewCount() : map.size - 1;
                    overrideContext = createFullOverrideContext(repeat, map.get(key), addIndex, map.size, key);
                    repeat.insertView(map.size - 1, overrideContext.bindingContext, overrideContext);
                    break;
                case 'delete':
                    if (record.oldValue === undefined) {
                        return;
                    }
                    removeIndex = this._getViewIndexByKey(repeat, key);
                    viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
                    if (viewOrPromise instanceof Promise) {
                        rmPromises.push(viewOrPromise);
                    }
                    break;
                case 'clear':
                    repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
                    break;
                default:
                    continue;
            }
        }
        if (rmPromises.length > 0) {
            Promise.all(rmPromises).then(function () {
                updateOverrideContexts(repeat.views(), 0);
            });
        }
        else {
            updateOverrideContexts(repeat.views(), 0);
        }
    };
    MapRepeatStrategy.prototype._getViewIndexByKey = function (repeat, key) {
        var i;
        var ii;
        var child;
        for (i = 0, ii = repeat.viewCount(); i < ii; ++i) {
            child = repeat.view(i);
            if (child.bindingContext[repeat.key] === key) {
                return i;
            }
        }
        return undefined;
    };
    return MapRepeatStrategy;
}());

var NullRepeatStrategy = (function () {
    function NullRepeatStrategy() {
    }
    NullRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        repeat.removeAllViews(true);
    };
    NullRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
    };
    return NullRepeatStrategy;
}());

var NumberRepeatStrategy = (function () {
    function NumberRepeatStrategy() {
    }
    NumberRepeatStrategy.prototype.getCollectionObserver = function () {
        return null;
    };
    NumberRepeatStrategy.prototype.instanceChanged = function (repeat, value) {
        var _this = this;
        var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
        if (removePromise instanceof Promise) {
            removePromise.then(function () { return _this._standardProcessItems(repeat, value); });
            return;
        }
        this._standardProcessItems(repeat, value);
    };
    NumberRepeatStrategy.prototype._standardProcessItems = function (repeat, value) {
        var childrenLength = repeat.viewCount();
        var i;
        var ii;
        var overrideContext;
        var viewsToRemove;
        value = Math.floor(value);
        viewsToRemove = childrenLength - value;
        if (viewsToRemove > 0) {
            if (viewsToRemove > childrenLength) {
                viewsToRemove = childrenLength;
            }
            for (i = 0, ii = viewsToRemove; i < ii; ++i) {
                repeat.removeView(childrenLength - (i + 1), true, !repeat.viewsRequireLifecycle);
            }
            return;
        }
        for (i = childrenLength, ii = value; i < ii; ++i) {
            overrideContext = createFullOverrideContext(repeat, i, i, ii);
            repeat.addView(overrideContext.bindingContext, overrideContext);
        }
        updateOverrideContexts(repeat.views(), 0);
    };
    return NumberRepeatStrategy;
}());

var SetRepeatStrategy = (function () {
    function SetRepeatStrategy() {
    }
    SetRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
        return observerLocator.getSetObserver(items);
    };
    SetRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        var _this = this;
        var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
        if (removePromise instanceof Promise) {
            removePromise.then(function () { return _this._standardProcessItems(repeat, items); });
            return;
        }
        this._standardProcessItems(repeat, items);
    };
    SetRepeatStrategy.prototype._standardProcessItems = function (repeat, items) {
        var index = 0;
        var overrideContext;
        items.forEach(function (value) {
            overrideContext = createFullOverrideContext(repeat, value, index, items.size);
            repeat.addView(overrideContext.bindingContext, overrideContext);
            ++index;
        });
    };
    SetRepeatStrategy.prototype.instanceMutated = function (repeat, set, records) {
        var value;
        var i;
        var ii;
        var overrideContext;
        var removeIndex;
        var record;
        var rmPromises = [];
        var viewOrPromise;
        for (i = 0, ii = records.length; i < ii; ++i) {
            record = records[i];
            value = record.value;
            switch (record.type) {
                case 'add':
                    var size = Math.max(set.size - 1, 0);
                    overrideContext = createFullOverrideContext(repeat, value, size, set.size);
                    repeat.insertView(size, overrideContext.bindingContext, overrideContext);
                    break;
                case 'delete':
                    removeIndex = this._getViewIndexByValue(repeat, value);
                    viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
                    if (viewOrPromise instanceof Promise) {
                        rmPromises.push(viewOrPromise);
                    }
                    break;
                case 'clear':
                    repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
                    break;
                default:
                    continue;
            }
        }
        if (rmPromises.length > 0) {
            Promise.all(rmPromises).then(function () {
                updateOverrideContexts(repeat.views(), 0);
            });
        }
        else {
            updateOverrideContexts(repeat.views(), 0);
        }
    };
    SetRepeatStrategy.prototype._getViewIndexByValue = function (repeat, value) {
        var i;
        var ii;
        var child;
        for (i = 0, ii = repeat.viewCount(); i < ii; ++i) {
            child = repeat.view(i);
            if (child.bindingContext[repeat.local] === value) {
                return i;
            }
        }
        return undefined;
    };
    return SetRepeatStrategy;
}());

var RepeatStrategyLocator = (function () {
    function RepeatStrategyLocator() {
        this.matchers = [];
        this.strategies = [];
        this.addStrategy(function (items) { return items === null || items === undefined; }, new NullRepeatStrategy());
        this.addStrategy(function (items) { return items instanceof Array; }, new ArrayRepeatStrategy());
        this.addStrategy(function (items) { return items instanceof Map; }, new MapRepeatStrategy());
        this.addStrategy(function (items) { return items instanceof Set; }, new SetRepeatStrategy());
        this.addStrategy(function (items) { return typeof items === 'number'; }, new NumberRepeatStrategy());
    }
    RepeatStrategyLocator.prototype.addStrategy = function (matcher, strategy) {
        this.matchers.push(matcher);
        this.strategies.push(strategy);
    };
    RepeatStrategyLocator.prototype.getStrategy = function (items) {
        var matchers = this.matchers;
        for (var i = 0, ii = matchers.length; i < ii; ++i) {
            if (matchers[i](items)) {
                return this.strategies[i];
            }
        }
        return null;
    };
    return RepeatStrategyLocator;
}());

var lifecycleOptionalBehaviors = ['focus', 'if', 'else', 'repeat', 'show', 'hide', 'with'];
function behaviorRequiresLifecycle(instruction) {
    var t = instruction.type;
    var name = t.elementName !== null ? t.elementName : t.attributeName;
    return lifecycleOptionalBehaviors.indexOf(name) === -1 && (t.handlesAttached || t.handlesBind || t.handlesCreated || t.handlesDetached || t.handlesUnbind)
        || t.viewFactory && viewsRequireLifecycle(t.viewFactory)
        || instruction.viewFactory && viewsRequireLifecycle(instruction.viewFactory);
}
function targetRequiresLifecycle(instruction) {
    var behaviors = instruction.behaviorInstructions;
    if (behaviors) {
        var i = behaviors.length;
        while (i--) {
            if (behaviorRequiresLifecycle(behaviors[i])) {
                return true;
            }
        }
    }
    return instruction.viewFactory && viewsRequireLifecycle(instruction.viewFactory);
}
function viewsRequireLifecycle(viewFactory) {
    if ('_viewsRequireLifecycle' in viewFactory) {
        return viewFactory._viewsRequireLifecycle;
    }
    viewFactory._viewsRequireLifecycle = false;
    if (viewFactory.viewFactory) {
        viewFactory._viewsRequireLifecycle = viewsRequireLifecycle(viewFactory.viewFactory);
        return viewFactory._viewsRequireLifecycle;
    }
    if (viewFactory.template.querySelector('.au-animate')) {
        viewFactory._viewsRequireLifecycle = true;
        return true;
    }
    for (var id in viewFactory.instructions) {
        if (targetRequiresLifecycle(viewFactory.instructions[id])) {
            viewFactory._viewsRequireLifecycle = true;
            return true;
        }
    }
    viewFactory._viewsRequireLifecycle = false;
    return false;
}

var AbstractRepeater = (function () {
    function AbstractRepeater(options) {
        Object.assign(this, {
            local: 'items',
            viewsRequireLifecycle: true
        }, options);
    }
    AbstractRepeater.prototype.viewCount = function () {
        throw new Error('subclass must implement `viewCount`');
    };
    AbstractRepeater.prototype.views = function () {
        throw new Error('subclass must implement `views`');
    };
    AbstractRepeater.prototype.view = function (index) {
        throw new Error('subclass must implement `view`');
    };
    AbstractRepeater.prototype.matcher = function () {
        throw new Error('subclass must implement `matcher`');
    };
    AbstractRepeater.prototype.addView = function (bindingContext, overrideContext) {
        throw new Error('subclass must implement `addView`');
    };
    AbstractRepeater.prototype.insertView = function (index, bindingContext, overrideContext) {
        throw new Error('subclass must implement `insertView`');
    };
    AbstractRepeater.prototype.moveView = function (sourceIndex, targetIndex) {
        throw new Error('subclass must implement `moveView`');
    };
    AbstractRepeater.prototype.removeAllViews = function (returnToCache, skipAnimation) {
        throw new Error('subclass must implement `removeAllViews`');
    };
    AbstractRepeater.prototype.removeViews = function (viewsToRemove, returnToCache, skipAnimation) {
        throw new Error('subclass must implement `removeView`');
    };
    AbstractRepeater.prototype.removeView = function (index, returnToCache, skipAnimation) {
        throw new Error('subclass must implement `removeView`');
    };
    AbstractRepeater.prototype.updateBindings = function (view) {
        throw new Error('subclass must implement `updateBindings`');
    };
    return AbstractRepeater;
}());

var matcherExtractionMarker = '__marker_extracted__';
var Repeat = (function (_super) {
    __extends(Repeat, _super);
    function Repeat(viewFactory, instruction, viewSlot, viewResources, observerLocator, strategyLocator) {
        var _this = _super.call(this, {
            local: 'item',
            viewsRequireLifecycle: viewsRequireLifecycle(viewFactory)
        }) || this;
        _this.viewFactory = viewFactory;
        _this.instruction = instruction;
        _this.viewSlot = viewSlot;
        _this.lookupFunctions = viewResources.lookupFunctions;
        _this.observerLocator = observerLocator;
        _this.key = 'key';
        _this.value = 'value';
        _this.strategyLocator = strategyLocator;
        _this.ignoreMutation = false;
        _this.sourceExpression = getItemsSourceExpression(_this.instruction, 'repeat.for');
        _this.isOneTime = isOneTime(_this.sourceExpression);
        _this.viewsRequireLifecycle = viewsRequireLifecycle(viewFactory);
        return _this;
    }
    Repeat_1 = Repeat;
    Repeat.prototype.call = function (context, changes) {
        this[context](this.items, changes);
    };
    Repeat.prototype.bind = function (bindingContext, overrideContext) {
        this.scope = { bindingContext: bindingContext, overrideContext: overrideContext };
        var instruction = this.instruction;
        if (!(matcherExtractionMarker in instruction)) {
            instruction[matcherExtractionMarker] = this._captureAndRemoveMatcherBinding();
        }
        this.matcherBinding = instruction[matcherExtractionMarker];
        this.itemsChanged();
    };
    Repeat.prototype.unbind = function () {
        this.scope = null;
        this.items = null;
        this.matcherBinding = null;
        this.viewSlot.removeAll(true, true);
        this._unsubscribeCollection();
    };
    Repeat.prototype._unsubscribeCollection = function () {
        if (this.collectionObserver) {
            this.collectionObserver.unsubscribe(this.callContext, this);
            this.collectionObserver = null;
            this.callContext = null;
        }
    };
    Repeat.prototype.itemsChanged = function () {
        var _this = this;
        this._unsubscribeCollection();
        if (!this.scope) {
            return;
        }
        var items = this.items;
        this.strategy = this.strategyLocator.getStrategy(items);
        if (!this.strategy) {
            throw new Error("Value for '" + this.sourceExpression + "' is non-repeatable");
        }
        if (!this.isOneTime && !this._observeInnerCollection()) {
            this._observeCollection();
        }
        this.ignoreMutation = true;
        this.strategy.instanceChanged(this, items);
        this.observerLocator.taskQueue.queueMicroTask(function () {
            _this.ignoreMutation = false;
        });
    };
    Repeat.prototype._getInnerCollection = function () {
        var expression = unwrapExpression(this.sourceExpression);
        if (!expression) {
            return null;
        }
        return expression.evaluate(this.scope, null);
    };
    Repeat.prototype.handleCollectionMutated = function (collection, changes) {
        if (!this.collectionObserver) {
            return;
        }
        if (this.ignoreMutation) {
            return;
        }
        this.strategy.instanceMutated(this, collection, changes);
    };
    Repeat.prototype.handleInnerCollectionMutated = function (collection, changes) {
        var _this = this;
        if (!this.collectionObserver) {
            return;
        }
        if (this.ignoreMutation) {
            return;
        }
        this.ignoreMutation = true;
        var newItems = this.sourceExpression.evaluate(this.scope, this.lookupFunctions);
        this.observerLocator.taskQueue.queueMicroTask(function () { return _this.ignoreMutation = false; });
        if (newItems === this.items) {
            this.itemsChanged();
        }
        else {
            this.items = newItems;
        }
    };
    Repeat.prototype._observeInnerCollection = function () {
        var items = this._getInnerCollection();
        var strategy = this.strategyLocator.getStrategy(items);
        if (!strategy) {
            return false;
        }
        this.collectionObserver = strategy.getCollectionObserver(this.observerLocator, items);
        if (!this.collectionObserver) {
            return false;
        }
        this.callContext = 'handleInnerCollectionMutated';
        this.collectionObserver.subscribe(this.callContext, this);
        return true;
    };
    Repeat.prototype._observeCollection = function () {
        var items = this.items;
        this.collectionObserver = this.strategy.getCollectionObserver(this.observerLocator, items);
        if (this.collectionObserver) {
            this.callContext = 'handleCollectionMutated';
            this.collectionObserver.subscribe(this.callContext, this);
        }
    };
    Repeat.prototype._captureAndRemoveMatcherBinding = function () {
        var viewFactory = this.viewFactory.viewFactory;
        if (viewFactory) {
            var template = viewFactory.template;
            var instructions = viewFactory.instructions;
            if (Repeat_1.useInnerMatcher) {
                return extractMatcherBindingExpression(instructions);
            }
            if (getChildrenCount(template) > 1) {
                return undefined;
            }
            var repeatedElement = getFirstElementChild(template);
            if (!repeatedElement.hasAttribute('au-target-id')) {
                return undefined;
            }
            var repeatedElementTargetId = repeatedElement.getAttribute('au-target-id');
            return extractMatcherBindingExpression(instructions, repeatedElementTargetId);
        }
        return undefined;
    };
    Repeat.prototype.viewCount = function () { return this.viewSlot.children.length; };
    Repeat.prototype.views = function () { return this.viewSlot.children; };
    Repeat.prototype.view = function (index) { return this.viewSlot.children[index]; };
    Repeat.prototype.matcher = function () {
        var matcherBinding = this.matcherBinding;
        return matcherBinding
            ? matcherBinding.sourceExpression.evaluate(this.scope, matcherBinding.lookupFunctions)
            : null;
    };
    Repeat.prototype.addView = function (bindingContext, overrideContext) {
        var view = this.viewFactory.create();
        view.bind(bindingContext, overrideContext);
        this.viewSlot.add(view);
    };
    Repeat.prototype.insertView = function (index, bindingContext, overrideContext) {
        var view = this.viewFactory.create();
        view.bind(bindingContext, overrideContext);
        this.viewSlot.insert(index, view);
    };
    Repeat.prototype.moveView = function (sourceIndex, targetIndex) {
        this.viewSlot.move(sourceIndex, targetIndex);
    };
    Repeat.prototype.removeAllViews = function (returnToCache, skipAnimation) {
        return this.viewSlot.removeAll(returnToCache, skipAnimation);
    };
    Repeat.prototype.removeViews = function (viewsToRemove, returnToCache, skipAnimation) {
        return this.viewSlot.removeMany(viewsToRemove, returnToCache, skipAnimation);
    };
    Repeat.prototype.removeView = function (index, returnToCache, skipAnimation) {
        return this.viewSlot.removeAt(index, returnToCache, skipAnimation);
    };
    Repeat.prototype.updateBindings = function (view) {
        var $view = view;
        var j = $view.bindings.length;
        while (j--) {
            updateOneTimeBinding($view.bindings[j]);
        }
        j = $view.controllers.length;
        while (j--) {
            var k = $view.controllers[j].boundProperties.length;
            while (k--) {
                var binding = $view.controllers[j].boundProperties[k].binding;
                updateOneTimeBinding(binding);
            }
        }
    };
    var Repeat_1;
    Repeat.useInnerMatcher = true;
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "items", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "local", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "key", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "value", void 0);
    Repeat = Repeat_1 = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('repeat'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TargetInstruction"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"], __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["ObserverLocator"], RepeatStrategyLocator)
    ], Repeat);
    return Repeat;
}(AbstractRepeater));
var extractMatcherBindingExpression = function (instructions, targetedElementId) {
    var instructionIds = Object.keys(instructions);
    for (var i = 0; i < instructionIds.length; i++) {
        var instructionId = instructionIds[i];
        if (targetedElementId !== undefined && instructionId !== targetedElementId) {
            continue;
        }
        var expressions = instructions[instructionId].expressions;
        if (expressions) {
            for (var ii = 0; ii < expressions.length; ii++) {
                if (expressions[ii].targetProperty === 'matcher') {
                    var matcherBindingExpression = expressions[ii];
                    expressions.splice(ii, 1);
                    return matcherBindingExpression;
                }
            }
        }
    }
};
var getChildrenCount = function (el) {
    var childNodes = el.childNodes;
    var count = 0;
    for (var i = 0, ii = childNodes.length; ii > i; ++i) {
        if (childNodes[i].nodeType === 1) {
            ++count;
        }
    }
    return count;
};
var getFirstElementChild = function (el) {
    var firstChild = el.firstChild;
    while (firstChild !== null) {
        if (firstChild.nodeType === 1) {
            return firstChild;
        }
        firstChild = firstChild.nextSibling;
    }
    return null;
};

var aureliaHideClassName = 'aurelia-hide';
var aureliaHideClass = "." + aureliaHideClassName + " { display:none !important; }";
function injectAureliaHideStyleAtHead() {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(aureliaHideClass);
}
function injectAureliaHideStyleAtBoundary(domBoundary) {
    if (__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["FEATURE"].shadowDOM && domBoundary && !domBoundary.hasAureliaHideStyle) {
        domBoundary.hasAureliaHideStyle = true;
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(aureliaHideClass, domBoundary);
    }
}

var Show = (function () {
    function Show(element, animator, domBoundary) {
        this.element = element;
        this.animator = animator;
        this.domBoundary = domBoundary;
    }
    Show.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["Animator"], __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Optional"].of(__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].boundary, true)];
    };
    Show.prototype.created = function () {
        injectAureliaHideStyleAtBoundary(this.domBoundary);
    };
    Show.prototype.valueChanged = function (newValue) {
        var element = this.element;
        var animator = this.animator;
        if (newValue) {
            animator.removeClass(element, aureliaHideClassName);
        }
        else {
            animator.addClass(element, aureliaHideClassName);
        }
    };
    Show.prototype.bind = function (bindingContext) {
        this.valueChanged(this.value);
    };
    Show = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('show')
    ], Show);
    return Show;
}());

var Hide = (function () {
    function Hide(element, animator, domBoundary) {
        this.element = element;
        this.animator = animator;
        this.domBoundary = domBoundary;
    }
    Hide.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["Animator"], __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Optional"].of(__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].boundary, true)];
    };
    Hide.prototype.created = function () {
        injectAureliaHideStyleAtBoundary(this.domBoundary);
    };
    Hide.prototype.valueChanged = function (newValue) {
        if (newValue) {
            this.animator.addClass(this.element, aureliaHideClassName);
        }
        else {
            this.animator.removeClass(this.element, aureliaHideClassName);
        }
    };
    Hide.prototype.bind = function (bindingContext) {
        this.valueChanged(this.value);
    };
    Hide.prototype.value = function (value) {
        throw new Error('Method not implemented.');
    };
    Hide = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('hide')
    ], Hide);
    return Hide;
}());

var SCRIPT_REGEX = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
var needsToWarn = true;
var HTMLSanitizer = (function () {
    function HTMLSanitizer() {
    }
    HTMLSanitizer.prototype.sanitize = function (input) {
        if (needsToWarn) {
            needsToWarn = false;
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["getLogger"])('html-sanitizer')
                .warn("CAUTION: The default HTMLSanitizer does NOT provide security against a wide variety of sophisticated XSS attacks,\nand should not be relied on for sanitizing input from unknown sources.\nPlease see https://aurelia.io/docs/binding/basics#element-content for instructions on how to use a secure solution like DOMPurify or sanitize-html.");
        }
        return input.replace(SCRIPT_REGEX, '');
    };
    return HTMLSanitizer;
}());

var SanitizeHTMLValueConverter = (function () {
    function SanitizeHTMLValueConverter(sanitizer) {
        this.sanitizer = sanitizer;
    }
    SanitizeHTMLValueConverter.prototype.toView = function (untrustedMarkup) {
        if (untrustedMarkup === null || untrustedMarkup === undefined) {
            return null;
        }
        return this.sanitizer.sanitize(untrustedMarkup);
    };
    SanitizeHTMLValueConverter = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["valueConverter"])('sanitizeHTML'),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(HTMLSanitizer)
    ], SanitizeHTMLValueConverter);
    return SanitizeHTMLValueConverter;
}());

var Replaceable = (function () {
    function Replaceable(viewFactory, viewSlot) {
        this.viewFactory = viewFactory;
        this.viewSlot = viewSlot;
        this.view = null;
    }
    Replaceable.prototype.bind = function (bindingContext, overrideContext) {
        if (this.view === null) {
            this.view = this.viewFactory.create();
            this.viewSlot.add(this.view);
        }
        this.view.bind(bindingContext, overrideContext);
    };
    Replaceable.prototype.unbind = function () {
        this.view.unbind();
    };
    Replaceable = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('replaceable'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], Replaceable);
    return Replaceable;
}());

var Focus = (function () {
    function Focus(element, taskQueue) {
        this.element = element;
        this.taskQueue = taskQueue;
        this.isAttached = false;
        this.needsApply = false;
    }
    Focus.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__["TaskQueue"]];
    };
    Focus.prototype.valueChanged = function (newValue) {
        if (this.isAttached) {
            this._apply();
        }
        else {
            this.needsApply = true;
        }
    };
    Focus.prototype._apply = function () {
        var _this = this;
        if (this.value) {
            this.taskQueue.queueMicroTask(function () {
                if (_this.value) {
                    _this.element.focus();
                }
            });
        }
        else {
            this.element.blur();
        }
    };
    Focus.prototype.attached = function () {
        this.isAttached = true;
        if (this.needsApply) {
            this.needsApply = false;
            this._apply();
        }
        this.element.addEventListener('focus', this);
        this.element.addEventListener('blur', this);
    };
    Focus.prototype.detached = function () {
        this.isAttached = false;
        this.element.removeEventListener('focus', this);
        this.element.removeEventListener('blur', this);
    };
    Focus.prototype.handleEvent = function (e) {
        if (e.type === 'focus') {
            this.value = true;
        }
        else if (__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].activeElement !== this.element) {
            this.value = false;
        }
    };
    Focus = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('focus', __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay)
    ], Focus);
    return Focus;
}());

var cssUrlMatcher = /url\((?!['"]data)([^)]+)\)/gi;
function fixupCSSUrls(address, css) {
    if (typeof css !== 'string') {
        throw new Error("Failed loading required CSS file: " + address);
    }
    return css.replace(cssUrlMatcher, function (match, p1) {
        var quote = p1.charAt(0);
        if (quote === '\'' || quote === '"') {
            p1 = p1.substr(1, p1.length - 2);
        }
        return 'url(\'' + __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_path__["relativeToFile"])(p1, address) + '\')';
    });
}
var CSSResource = (function () {
    function CSSResource(address) {
        this.address = address;
        this._scoped = null;
        this._global = false;
        this._alreadyGloballyInjected = false;
    }
    CSSResource.prototype.initialize = function (container, Target) {
        this._scoped = new Target(this);
    };
    CSSResource.prototype.register = function (registry, name) {
        if (name === 'scoped') {
            registry.registerViewEngineHooks(this._scoped);
        }
        else {
            this._global = true;
        }
    };
    CSSResource.prototype.load = function (container) {
        var _this = this;
        return container.get(__WEBPACK_IMPORTED_MODULE_6_aurelia_loader__["Loader"])
            .loadText(this.address)
            .catch(function (err) { return null; })
            .then(function (text) {
            text = fixupCSSUrls(_this.address, text);
            _this._scoped.css = text;
            if (_this._global) {
                _this._alreadyGloballyInjected = true;
                __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(text);
            }
        });
    };
    return CSSResource;
}());
var CSSViewEngineHooks = (function () {
    function CSSViewEngineHooks(owner) {
        this.owner = owner;
        this.css = null;
    }
    CSSViewEngineHooks.prototype.beforeCompile = function (content, resources, instruction) {
        if (instruction.targetShadowDOM) {
            __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(this.css, content, true);
        }
        else if (__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["FEATURE"].scopedCSS) {
            var styleNode = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(this.css, content, true);
            styleNode.setAttribute('scoped', 'scoped');
        }
        else if (this._global && !this.owner._alreadyGloballyInjected) {
            __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(this.css);
            this.owner._alreadyGloballyInjected = true;
        }
    };
    return CSSViewEngineHooks;
}());
function _createCSSResource(address) {
    var ViewCSS = (function (_super) {
        __extends(ViewCSS, _super);
        function ViewCSS() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        ViewCSS = __decorate([
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["resource"])(new CSSResource(address))
        ], ViewCSS);
        return ViewCSS;
    }(CSSViewEngineHooks));
    return ViewCSS;
}

var AttrBindingBehavior = (function () {
    function AttrBindingBehavior() {
    }
    AttrBindingBehavior.prototype.bind = function (binding, source) {
        binding.targetObserver = new __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["DataAttributeObserver"](binding.target, binding.targetProperty);
    };
    AttrBindingBehavior.prototype.unbind = function (binding, source) {
    };
    AttrBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('attr')
    ], AttrBindingBehavior);
    return AttrBindingBehavior;
}());

var modeBindingBehavior = {
    bind: function (binding, source, lookupFunctions) {
        binding.originalMode = binding.mode;
        binding.mode = this.mode;
    },
    unbind: function (binding, source) {
        binding.mode = binding.originalMode;
        binding.originalMode = null;
    }
};
var OneTimeBindingBehavior = (function () {
    function OneTimeBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].oneTime;
    }
    OneTimeBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('oneTime')
    ], OneTimeBindingBehavior);
    return OneTimeBindingBehavior;
}());
var OneWayBindingBehavior = (function () {
    function OneWayBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].toView;
    }
    OneWayBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('oneWay')
    ], OneWayBindingBehavior);
    return OneWayBindingBehavior;
}());
var ToViewBindingBehavior = (function () {
    function ToViewBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].toView;
    }
    ToViewBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('toView')
    ], ToViewBindingBehavior);
    return ToViewBindingBehavior;
}());
var FromViewBindingBehavior = (function () {
    function FromViewBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].fromView;
    }
    FromViewBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('fromView')
    ], FromViewBindingBehavior);
    return FromViewBindingBehavior;
}());
var TwoWayBindingBehavior = (function () {
    function TwoWayBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay;
    }
    TwoWayBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('twoWay')
    ], TwoWayBindingBehavior);
    return TwoWayBindingBehavior;
}());

function throttle(newValue) {
    var _this = this;
    var state = this.throttleState;
    var elapsed = +new Date() - state.last;
    if (elapsed >= state.delay) {
        clearTimeout(state.timeoutId);
        state.timeoutId = null;
        state.last = +new Date();
        this.throttledMethod(newValue);
        return;
    }
    state.newValue = newValue;
    if (state.timeoutId === null) {
        state.timeoutId = setTimeout(function () {
            state.timeoutId = null;
            state.last = +new Date();
            _this.throttledMethod(state.newValue);
        }, state.delay - elapsed);
    }
}
var ThrottleBindingBehavior = (function () {
    function ThrottleBindingBehavior() {
    }
    ThrottleBindingBehavior.prototype.bind = function (binding, source, delay) {
        if (delay === void 0) { delay = 200; }
        var methodToThrottle = 'updateTarget';
        if (binding.callSource) {
            methodToThrottle = 'callSource';
        }
        else if (binding.updateSource && binding.mode === __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay) {
            methodToThrottle = 'updateSource';
        }
        binding.throttledMethod = binding[methodToThrottle];
        binding.throttledMethod.originalName = methodToThrottle;
        binding[methodToThrottle] = throttle;
        binding.throttleState = {
            delay: delay,
            last: 0,
            timeoutId: null
        };
    };
    ThrottleBindingBehavior.prototype.unbind = function (binding, source) {
        var methodToRestore = binding.throttledMethod.originalName;
        binding[methodToRestore] = binding.throttledMethod;
        binding.throttledMethod = null;
        clearTimeout(binding.throttleState.timeoutId);
        binding.throttleState = null;
    };
    ThrottleBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('throttle')
    ], ThrottleBindingBehavior);
    return ThrottleBindingBehavior;
}());

var unset = {};
function debounceCallSource(event) {
    var _this = this;
    var state = this.debounceState;
    clearTimeout(state.timeoutId);
    state.timeoutId = setTimeout(function () { return _this.debouncedMethod(event); }, state.delay);
}
function debounceCall(context, newValue, oldValue) {
    var _this = this;
    var state = this.debounceState;
    clearTimeout(state.timeoutId);
    if (context !== state.callContextToDebounce) {
        state.oldValue = unset;
        this.debouncedMethod(context, newValue, oldValue);
        return;
    }
    if (state.oldValue === unset) {
        state.oldValue = oldValue;
    }
    state.timeoutId = setTimeout(function () {
        var _oldValue = state.oldValue;
        state.oldValue = unset;
        _this.debouncedMethod(context, newValue, _oldValue);
    }, state.delay);
}
var DebounceBindingBehavior = (function () {
    function DebounceBindingBehavior() {
    }
    DebounceBindingBehavior.prototype.bind = function (binding, source, delay) {
        if (delay === void 0) { delay = 200; }
        var isCallSource = binding.callSource !== undefined;
        var methodToDebounce = isCallSource ? 'callSource' : 'call';
        var debouncer = isCallSource ? debounceCallSource : debounceCall;
        var mode = binding.mode;
        var callContextToDebounce = mode === __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay || mode === __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].fromView ? __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["targetContext"] : __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["sourceContext"];
        binding.debouncedMethod = binding[methodToDebounce];
        binding.debouncedMethod.originalName = methodToDebounce;
        binding[methodToDebounce] = debouncer;
        binding.debounceState = {
            callContextToDebounce: callContextToDebounce,
            delay: delay,
            timeoutId: 0,
            oldValue: unset
        };
    };
    DebounceBindingBehavior.prototype.unbind = function (binding, source) {
        var methodToRestore = binding.debouncedMethod.originalName;
        binding[methodToRestore] = binding.debouncedMethod;
        binding.debouncedMethod = null;
        clearTimeout(binding.debounceState.timeoutId);
        binding.debounceState = null;
    };
    DebounceBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('debounce')
    ], DebounceBindingBehavior);
    return DebounceBindingBehavior;
}());

function findOriginalEventTarget(event) {
    return (event.path && event.path[0]) || (event.deepPath && event.deepPath[0]) || event.target;
}
function handleSelfEvent(event) {
    var target = findOriginalEventTarget(event);
    if (this.target !== target) {
        return;
    }
    this.selfEventCallSource(event);
}
var SelfBindingBehavior = (function () {
    function SelfBindingBehavior() {
    }
    SelfBindingBehavior.prototype.bind = function (binding, source) {
        if (!binding.callSource || !binding.targetEvent) {
            throw new Error('Self binding behavior only supports event.');
        }
        binding.selfEventCallSource = binding.callSource;
        binding.callSource = handleSelfEvent;
    };
    SelfBindingBehavior.prototype.unbind = function (binding, source) {
        binding.callSource = binding.selfEventCallSource;
        binding.selfEventCallSource = null;
    };
    SelfBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('self')
    ], SelfBindingBehavior);
    return SelfBindingBehavior;
}());

var BindingSignaler = (function () {
    function BindingSignaler() {
        this.signals = {};
    }
    BindingSignaler.prototype.signal = function (name) {
        var bindings = this.signals[name];
        if (!bindings) {
            return;
        }
        var i = bindings.length;
        while (i--) {
            bindings[i].call(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["sourceContext"]);
        }
    };
    return BindingSignaler;
}());

var SignalBindingBehavior = (function () {
    function SignalBindingBehavior(bindingSignaler) {
        this.signals = bindingSignaler.signals;
    }
    SignalBindingBehavior.inject = function () { return [BindingSignaler]; };
    SignalBindingBehavior.prototype.bind = function (binding, source) {
        var names = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            names[_i - 2] = arguments[_i];
        }
        if (!binding.updateTarget) {
            throw new Error('Only property bindings and string interpolation bindings can be signaled.  Trigger, delegate and call bindings cannot be signaled.');
        }
        var signals = this.signals;
        if (names.length === 1) {
            var name_1 = names[0];
            var bindings = signals[name_1] || (signals[name_1] = []);
            bindings.push(binding);
            binding.signalName = name_1;
        }
        else if (names.length > 1) {
            var i = names.length;
            while (i--) {
                var name_2 = names[i];
                var bindings = signals[name_2] || (signals[name_2] = []);
                bindings.push(binding);
            }
            binding.signalName = names;
        }
        else {
            throw new Error('Signal name is required.');
        }
    };
    SignalBindingBehavior.prototype.unbind = function (binding, source) {
        var signals = this.signals;
        var name = binding.signalName;
        binding.signalName = null;
        if (Array.isArray(name)) {
            var names = name;
            var i = names.length;
            while (i--) {
                var n = names[i];
                var bindings = signals[n];
                bindings.splice(bindings.indexOf(binding), 1);
            }
        }
        else {
            var bindings = signals[name];
            bindings.splice(bindings.indexOf(binding), 1);
        }
    };
    SignalBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('signal')
    ], SignalBindingBehavior);
    return SignalBindingBehavior;
}());

var eventNamesRequired = 'The updateTrigger binding behavior requires at least one event name argument: eg <input value.bind="firstName & updateTrigger:\'blur\'">';
var notApplicableMessage = 'The updateTrigger binding behavior can only be applied to two-way/ from-view bindings on input/select elements.';
var UpdateTriggerBindingBehavior = (function () {
    function UpdateTriggerBindingBehavior() {
    }
    UpdateTriggerBindingBehavior.prototype.bind = function (binding, source) {
        var events = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            events[_i - 2] = arguments[_i];
        }
        if (events.length === 0) {
            throw new Error(eventNamesRequired);
        }
        if (binding.mode !== __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay && binding.mode !== __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].fromView) {
            throw new Error(notApplicableMessage);
        }
        var targetObserver = binding.observerLocator.getObserver(binding.target, binding.targetProperty);
        if (!targetObserver.handler) {
            throw new Error(notApplicableMessage);
        }
        binding.targetObserver = targetObserver;
        targetObserver.originalHandler = binding.targetObserver.handler;
        var handler = new __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["EventSubscriber"](events);
        targetObserver.handler = handler;
    };
    UpdateTriggerBindingBehavior.prototype.unbind = function (binding, source) {
        var targetObserver = binding.targetObserver;
        targetObserver.handler.dispose();
        targetObserver.handler = targetObserver.originalHandler;
        targetObserver.originalHandler = null;
    };
    UpdateTriggerBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('updateTrigger')
    ], UpdateTriggerBindingBehavior);
    return UpdateTriggerBindingBehavior;
}());

function _createDynamicElement(_a) {
    var name = _a.name, viewUrl = _a.viewUrl, bindableNames = _a.bindableNames, useShadowDOMmode = _a.useShadowDOMmode;
    var DynamicElement = (function () {
        function DynamicElement() {
        }
        DynamicElement.prototype.bind = function (bindingContext) {
            this.$parent = bindingContext;
        };
        DynamicElement = __decorate([
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"])(name),
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useView"])(viewUrl)
        ], DynamicElement);
        return DynamicElement;
    }());
    for (var i = 0, ii = bindableNames.length; i < ii; ++i) {
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"])(bindableNames[i])(DynamicElement);
    }
    switch (useShadowDOMmode) {
        case 'open':
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"])({ mode: 'open' })(DynamicElement);
            break;
        case 'closed':
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"])({ mode: 'closed' })(DynamicElement);
            break;
        case '':
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"])(DynamicElement);
            break;
        case null:
            break;
        default:
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["getLogger"])('aurelia-html-only-element')
                .warn("Expected 'use-shadow-dom' value to be \"close\", \"open\" or \"\", received " + useShadowDOMmode);
            break;
    }
    return DynamicElement;
}

function getElementName(address) {
    return /([^\/^\?]+)\.html/i.exec(address)[1].toLowerCase();
}
function configure(config) {
    var viewEngine = config.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngine"]);
    var loader = config.aurelia.loader;
    viewEngine.addResourcePlugin('.html', {
        'fetch': function (viewUrl) {
            return loader.loadTemplate(viewUrl).then(function (registryEntry) {
                var _a;
                var bindableNames = registryEntry.template.getAttribute('bindable');
                var useShadowDOMmode = registryEntry.template.getAttribute('use-shadow-dom');
                var name = getElementName(viewUrl);
                if (bindableNames) {
                    bindableNames = bindableNames.split(',').map(function (x) { return x.trim(); });
                    registryEntry.template.removeAttribute('bindable');
                }
                else {
                    bindableNames = [];
                }
                return _a = {}, _a[name] = _createDynamicElement({ name: name, viewUrl: viewUrl, bindableNames: bindableNames, useShadowDOMmode: useShadowDOMmode }), _a;
            });
        }
    });
}

function configure$1(config) {
    injectAureliaHideStyleAtHead();
    config.globalResources(Compose, If, Else, With, Repeat, Show, Hide, Replaceable, Focus, SanitizeHTMLValueConverter, OneTimeBindingBehavior, OneWayBindingBehavior, ToViewBindingBehavior, FromViewBindingBehavior, TwoWayBindingBehavior, ThrottleBindingBehavior, DebounceBindingBehavior, SelfBindingBehavior, SignalBindingBehavior, UpdateTriggerBindingBehavior, AttrBindingBehavior);
    configure(config);
    var viewEngine = config.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngine"]);
    var styleResourcePlugin = {
        fetch: function (address) {
            var _a;
            return _a = {}, _a[address] = _createCSSResource(address), _a;
        }
    };
    ['.css', '.less', '.sass', '.scss', '.styl'].forEach(function (ext) { return viewEngine.addResourcePlugin(ext, styleResourcePlugin); });
}


//# sourceMappingURL=aurelia-templating-resources.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ "aurelia-templating-router":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_router__ = __webpack_require__("aurelia-router");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "RouteHref", function() { return RouteHref; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterView", function() { return RouterView; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplatingRouteLoader", function() { return TemplatingRouteLoader; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure; });









class EmptyLayoutViewModel {
}
/**
 * Implementation of Aurelia Router ViewPort. Responsible for loading route, composing and swapping routes views
 */
class RouterView {
    constructor(element, container, viewSlot, router, viewLocator, compositionTransaction, compositionEngine) {
        this.element = element;
        this.container = container;
        this.viewSlot = viewSlot;
        this.router = router;
        this.viewLocator = viewLocator;
        this.compositionTransaction = compositionTransaction;
        this.compositionEngine = compositionEngine;
        // add this <router-view/> to router view ports lookup based on name attribute
        // when this router is the root router-view
        // also trigger AppRouter registerViewPort extra flow
        this.router.registerViewPort(this, this.element.getAttribute('name'));
        // Each <router-view/> process its instruction as a composition transaction
        // there are differences between intial composition and subsequent compositions
        // also there are differences between root composition and child <router-view/> composition
        // mark the first composition transaction with a property initialComposition to distinguish it
        // when the root <router-view/> gets new instruction for the first time
        if (!('initialComposition' in compositionTransaction)) {
            compositionTransaction.initialComposition = true;
            this.compositionTransactionNotifier = compositionTransaction.enlist();
        }
    }
    /**@internal */
    static inject() {
        return [__WEBPACK_IMPORTED_MODULE_6_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_4_aurelia_dependency_injection__["Container"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"], __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewLocator"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionTransaction"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"]];
    }
    created(owningView) {
        this.owningView = owningView;
    }
    bind(bindingContext, overrideContext) {
        // router needs to get access to view model of current route parent
        // doing it in generic way via viewModel property on container
        this.container.viewModel = bindingContext;
        this.overrideContext = overrideContext;
    }
    /**
     * Implementation of `aurelia-router` ViewPort interface, responsible for templating related part in routing Pipeline
     */
    process($viewPortInstruction, waitToSwap) {
        // have strong typings without exposing it in public typings, this is to ensure maximum backward compat
        const viewPortInstruction = $viewPortInstruction;
        const component = viewPortInstruction.component;
        const childContainer = component.childContainer;
        const viewModel = component.viewModel;
        const viewModelResource = component.viewModelResource;
        const metadata = viewModelResource.metadata;
        const config = component.router.currentInstruction.config;
        const viewPortConfig = config.viewPorts ? (config.viewPorts[viewPortInstruction.name] || {}) : {};
        childContainer.get(RouterViewLocator)._notify(this);
        // layoutInstruction is our layout viewModel
        const layoutInstruction = {
            viewModel: viewPortConfig.layoutViewModel || config.layoutViewModel || this.layoutViewModel,
            view: viewPortConfig.layoutView || config.layoutView || this.layoutView,
            model: viewPortConfig.layoutModel || config.layoutModel || this.layoutModel,
            router: viewPortInstruction.component.router,
            childContainer: childContainer,
            viewSlot: this.viewSlot
        };
        // viewport will be a thin wrapper around composition engine
        // to process instruction/configuration from users
        // preparing all information related to a composition process
        // first by getting view strategy of a ViewPortComponent View
        const viewStrategy = this.viewLocator.getViewStrategy(component.view || viewModel);
        if (viewStrategy && component.view) {
            viewStrategy.makeRelativeTo(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(component.router.container.viewModel.constructor).moduleId);
        }
        // using metadata of a custom element view model to load appropriate view-factory instance
        return metadata
            .load(childContainer, viewModelResource.value, null, viewStrategy, true)
            // for custom element, viewFactory typing is always ViewFactory
            // for custom attribute, it will be HtmlBehaviorResource
            .then((viewFactory) => {
            // if this is not the first time that this <router-view/> is composing its instruction
            // try to capture ownership of the composition transaction
            // child <router-view/> will not be able to capture, since root <router-view/> typically captures
            // the ownership token
            if (!this.compositionTransactionNotifier) {
                this.compositionTransactionOwnershipToken = this.compositionTransaction.tryCapture();
            }
            if (layoutInstruction.viewModel || layoutInstruction.view) {
                viewPortInstruction.layoutInstruction = layoutInstruction;
            }
            const viewPortComponentBehaviorInstruction = __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BehaviorInstruction"].dynamic(this.element, viewModel, viewFactory);
            viewPortInstruction.controller = metadata.create(childContainer, viewPortComponentBehaviorInstruction);
            if (waitToSwap) {
                return null;
            }
            this.swap(viewPortInstruction);
        });
    }
    swap($viewPortInstruction) {
        // have strong typings without exposing it in public typings, this is to ensure maximum backward compat
        const viewPortInstruction = $viewPortInstruction;
        const viewPortController = viewPortInstruction.controller;
        const layoutInstruction = viewPortInstruction.layoutInstruction;
        const previousView = this.view;
        // Final step of swapping a <router-view/> ViewPortComponent
        const work = () => {
            const swapStrategy = __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["SwapStrategies"][this.swapOrder] || __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["SwapStrategies"].after;
            const viewSlot = this.viewSlot;
            swapStrategy(viewSlot, previousView, () => Promise.resolve(viewSlot.add(this.view))).then(() => {
                this._notify();
            });
        };
        // Ensure all users setups have been completed
        const ready = (owningView_or_layoutView) => {
            viewPortController.automate(this.overrideContext, owningView_or_layoutView);
            const transactionOwnerShipToken = this.compositionTransactionOwnershipToken;
            // if this router-view is the root <router-view/> of a normal startup via aurelia.setRoot
            // attemp to take control of the transaction
            // if ownership can be taken
            // wait for transaction to complete before swapping
            if (transactionOwnerShipToken) {
                return transactionOwnerShipToken
                    .waitForCompositionComplete()
                    .then(() => {
                    this.compositionTransactionOwnershipToken = null;
                    return work();
                });
            }
            // otherwise, just swap
            return work();
        };
        // If there is layout instruction, new to compose layout before processing ViewPortComponent
        // layout controller/view/view-model is composed using composition engine APIs
        if (layoutInstruction) {
            if (!layoutInstruction.viewModel) {
                // createController chokes if there's no viewmodel, so create a dummy one
                // but avoid using a POJO as it creates unwanted metadata in Object constructor
                layoutInstruction.viewModel = new EmptyLayoutViewModel();
            }
            // using composition engine to create compose layout
            return this.compositionEngine
                // first create controller from layoutInstruction
                // and treat it as CompositionContext
                // then emulate slot projection with ViewPortComponent view
                .createController(layoutInstruction)
                .then((layoutController) => {
                const layoutView = layoutController.view;
                __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ShadowDOM"].distributeView(viewPortController.view, layoutController.slots || layoutView.slots);
                // when there is a layout
                // view hierarchy is: <router-view/> owner view -> layout view -> ViewPortComponent view
                layoutController.automate(__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(layoutInstruction.viewModel), this.owningView);
                layoutView.children.push(viewPortController.view);
                return layoutView || layoutController;
            })
                .then((newView) => {
                this.view = newView;
                return ready(newView);
            });
        }
        // if there is no layout, then get ViewPortComponent view ready as view property
        // and process controller/swapping
        // when there is no layout
        // view hierarchy is: <router-view/> owner view -> ViewPortComponent view
        this.view = viewPortController.view;
        return ready(this.owningView);
    }
    /**
     * Notify composition transaction that this router has finished processing
     * Happens when this <router-view/> is the root router-view
     * @internal
     */
    _notify() {
        const notifier = this.compositionTransactionNotifier;
        if (notifier) {
            notifier.done();
            this.compositionTransactionNotifier = null;
        }
    }
}
/**
 * @internal Actively avoid using decorator to reduce the amount of code generated
 *
 * There is no view to compose by default in a router view
 * This custom element is responsible for composing its own view, based on current config
 */
RouterView.$view = null;
/**
 * @internal Actively avoid using decorator to reduce the amount of code generated
 */
RouterView.$resource = {
    name: 'router-view',
    bindables: ['swapOrder', 'layoutView', 'layoutViewModel', 'layoutModel', 'inherit-binding-context']
};
/**
* Locator which finds the nearest RouterView, relative to the current dependency injection container.
*/
class RouterViewLocator {
    /**
    * Creates an instance of the RouterViewLocator class.
    */
    constructor() {
        this.promise = new Promise((resolve) => this.resolve = resolve);
    }
    /**
    * Finds the nearest RouterView instance.
    * @returns A promise that will be resolved with the located RouterView instance.
    */
    findNearest() {
        return this.promise;
    }
    /**@internal */
    _notify(routerView) {
        this.resolve(routerView);
    }
}

/**@internal exported for unit testing */
class EmptyClass {
}
__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["inlineView"])('<template></template>')(EmptyClass);
/**
 * Default implementation of `RouteLoader` used for loading component based on a route config
 */
class TemplatingRouteLoader extends __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["RouteLoader"] {
    constructor(compositionEngine) {
        super();
        this.compositionEngine = compositionEngine;
    }
    /**
     * Resolve a view model from a RouteConfig
     * Throws when there is neither "moduleId" nor "viewModel" property
     * @internal
     */
    resolveViewModel(router, config) {
        return new Promise((resolve, reject) => {
            let viewModel;
            if ('moduleId' in config) {
                let moduleId = config.moduleId;
                if (moduleId === null) {
                    viewModel = EmptyClass;
                }
                else {
                    // this requires container of router has passes a certain point
                    // where a view model has been setup on the container
                    // it will fail in enhance scenario because no viewport has been registered
                    moduleId = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2_aurelia_path__["relativeToFile"])(moduleId, __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(router.container.viewModel.constructor).moduleId);
                    if (/\.html/i.test(moduleId)) {
                        viewModel = createDynamicClass(moduleId);
                    }
                    else {
                        viewModel = moduleId;
                    }
                }
                return resolve(viewModel);
            }
            // todo: add if ('viewModel' in config) to support static view model resolution
            reject(new Error('Invalid route config. No "moduleId" found.'));
        });
    }
    /**
     * Create child container based on a router container
     * Also ensures that child router are properly constructed in the newly created child container
     * @internal
     */
    createChildContainer(router) {
        const childContainer = router.container.createChild();
        childContainer.registerSingleton(RouterViewLocator);
        childContainer.getChildRouter = function () {
            let childRouter;
            childContainer.registerHandler(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], () => childRouter || (childRouter = router.createChild(childContainer)));
            return childContainer.get(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"]);
        };
        return childContainer;
    }
    /**
     * Load corresponding component of a route config of a navigation instruction
     */
    loadRoute(router, config, _navInstruction) {
        return this
            .resolveViewModel(router, config)
            .then(viewModel => this.compositionEngine.ensureViewModel({
            viewModel: viewModel,
            childContainer: this.createChildContainer(router),
            view: config.view || config.viewStrategy,
            router: router
        }));
    }
}
/**@internal */
TemplatingRouteLoader.inject = [__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"]];
/**@internal exported for unit testing */
function createDynamicClass(moduleId) {
    const name = /([^\/^\?]+)\.html/i.exec(moduleId)[1];
    class DynamicClass {
        bind(bindingContext) {
            this.$parent = bindingContext;
        }
    }
    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"])(name)(DynamicClass);
    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useView"])(moduleId)(DynamicClass);
    return DynamicClass;
}

const logger = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_logging__["getLogger"])('route-href');
/**
 * Helper custom attribute to help associate an element with a route by name
 */
class RouteHref {
    constructor(router, element) {
        this.router = router;
        this.element = element;
        this.attribute = 'href';
    }
    /*@internal */
    static inject() {
        return [__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_6_aurelia_pal__["DOM"].Element];
    }
    bind() {
        this.isActive = true;
        this.processChange();
    }
    unbind() {
        this.isActive = false;
    }
    attributeChanged(value, previous) {
        if (previous) {
            this.element.removeAttribute(previous);
        }
        return this.processChange();
    }
    processChange() {
        return this.router
            .ensureConfigured()
            .then(() => {
            if (!this.isActive) {
                // returning null to avoid Bluebird warning
                return null;
            }
            const element = this.element;
            const href = this.router.generate(this.route, this.params);
            if (element.au.controller) {
                element.au.controller.viewModel[this.attribute] = href;
            }
            else {
                element.setAttribute(this.attribute, href);
            }
            // returning null to avoid Bluebird warning
            return null;
        })
            .catch((reason) => {
            logger.error(reason);
        });
    }
}
/**
 * @internal Actively avoid using decorator to reduce the amount of code generated
 */
RouteHref.$resource = {
    type: 'attribute',
    name: 'route-href',
    bindables: [
        { name: 'route', changeHandler: 'processChange', primaryProperty: true },
        { name: 'params', changeHandler: 'processChange' },
        'attribute'
    ] // type definition of Aurelia templating is wrong
};

function configure(config) {
    config
        .singleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["RouteLoader"], TemplatingRouteLoader)
        .singleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["AppRouter"])
        .globalResources(RouterView, RouteHref);
    config.container.registerAlias(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["AppRouter"]);
}


//# sourceMappingURL=aurelia-templating-router.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ }

},[1354]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyZWxpYS5idW5kbGUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24vZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10YXNrLXF1ZXVlL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10YXNrLXF1ZXVlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1oaXN0b3J5L2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1oaXN0b3J5LmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10ZW1wbGF0aW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1sb2dnaW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1sb2dnaW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1iaW5kaW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1iaW5kaW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1mcmFtZXdvcmsvZGlzdC9lczIwMTUvYXVyZWxpYS1mcmFtZXdvcmsuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWhpc3RvcnktYnJvd3Nlci9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtaGlzdG9yeS1icm93c2VyLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1sb2dnaW5nLWNvbnNvbGUvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWxvZ2dpbmctY29uc29sZS5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtcm91dGUtcmVjb2duaXplci9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtcm91dGUtcmVjb2duaXplci5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtcm91dGVyL2Rpc3QvZXMyMDE1L2F1cmVsaWEtcm91dGVyLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmcvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZy5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci9kaXN0L2VzMjAxNS9hdXJlbGlhLXRlbXBsYXRpbmctcm91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1ldGFkYXRhLCBwcm90b2NvbCB9IGZyb20gJ2F1cmVsaWEtbWV0YWRhdGEnO1xuaW1wb3J0IHsgQWdncmVnYXRlRXJyb3IgfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXHJcbnRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXHJcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5USElTIENPREUgSVMgUFJPVklERUQgT04gQU4gKkFTIElTKiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXHJcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcclxuV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIFRJVExFLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSxcclxuTUVSQ0hBTlRBQkxJVFkgT1IgTk9OLUlORlJJTkdFTUVOVC5cclxuXHJcblNlZSB0aGUgQXBhY2hlIFZlcnNpb24gMi4wIExpY2Vuc2UgZm9yIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xyXG5hbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcblxyXG5mdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5mdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XG5cbmZ1bmN0aW9uIGlzSW5qZWN0YWJsZShwb3RlbnRpYWxUYXJnZXQpIHtcclxuICAgIHJldHVybiAhIXBvdGVudGlhbFRhcmdldDtcclxufVxyXG5mdW5jdGlvbiBhdXRvaW5qZWN0KHBvdGVudGlhbFRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKCF0YXJnZXQuaGFzT3duUHJvcGVydHkoJ2luamVjdCcpKSB7XHJcbiAgICAgICAgICAgIHRhcmdldC5pbmplY3QgPSAobWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhLnBhcmFtVHlwZXMsIHRhcmdldCkgfHxcclxuICAgICAgICAgICAgICAgIF9lbXB0eVBhcmFtZXRlcnMpLnNsaWNlKCk7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQuaW5qZWN0ICYmIHRhcmdldC5pbmplY3QubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5pbmplY3RbdGFyZ2V0LmluamVjdC5sZW5ndGggLSAxXSA9PT0gT2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmluamVjdC5zcGxpY2UoLTEsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGlmIChpc0luamVjdGFibGUocG90ZW50aWFsVGFyZ2V0KSkge1xyXG4gICAgICAgIHJldHVybiBkZWNvKHBvdGVudGlhbFRhcmdldCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVjbztcclxufVxyXG5mdW5jdGlvbiBpbmplY3QoKSB7XHJcbiAgICB2YXIgcmVzdCA9IFtdO1xyXG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICByZXN0W19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwgX2tleSwgZGVzY3JpcHRvcikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgZGVzY3JpcHRvciA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgYXV0b2luamVjdCh0YXJnZXQpO1xyXG4gICAgICAgICAgICBpZiAocmVzdC5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldC5pbmplY3RbZGVzY3JpcHRvcl0gPSByZXN0WzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRlc2NyaXB0b3IpIHtcclxuICAgICAgICAgICAgdmFyIGZuID0gZGVzY3JpcHRvci52YWx1ZTtcclxuICAgICAgICAgICAgZm4uaW5qZWN0ID0gcmVzdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRhcmdldC5pbmplY3QgPSByZXN0O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cblxudmFyIHJlc29sdmVyID0gcHJvdG9jb2wuY3JlYXRlKCdhdXJlbGlhOnJlc29sdmVyJywgZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgaWYgKCEodHlwZW9mIHRhcmdldC5nZXQgPT09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgICAgcmV0dXJuICdSZXNvbHZlcnMgbXVzdCBpbXBsZW1lbnQ6IGdldChjb250YWluZXI6IENvbnRhaW5lciwga2V5OiBhbnkpOiBhbnknO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn0pO1xyXG52YXIgU3RyYXRlZ3k7XHJcbihmdW5jdGlvbiAoU3RyYXRlZ3kpIHtcclxuICAgIFN0cmF0ZWd5W1N0cmF0ZWd5W1wiaW5zdGFuY2VcIl0gPSAwXSA9IFwiaW5zdGFuY2VcIjtcclxuICAgIFN0cmF0ZWd5W1N0cmF0ZWd5W1wic2luZ2xldG9uXCJdID0gMV0gPSBcInNpbmdsZXRvblwiO1xyXG4gICAgU3RyYXRlZ3lbU3RyYXRlZ3lbXCJ0cmFuc2llbnRcIl0gPSAyXSA9IFwidHJhbnNpZW50XCI7XHJcbiAgICBTdHJhdGVneVtTdHJhdGVneVtcImZ1bmN0aW9uXCJdID0gM10gPSBcImZ1bmN0aW9uXCI7XHJcbiAgICBTdHJhdGVneVtTdHJhdGVneVtcImFycmF5XCJdID0gNF0gPSBcImFycmF5XCI7XHJcbiAgICBTdHJhdGVneVtTdHJhdGVneVtcImFsaWFzXCJdID0gNV0gPSBcImFsaWFzXCI7XHJcbn0pKFN0cmF0ZWd5IHx8IChTdHJhdGVneSA9IHt9KSk7XHJcbmZ1bmN0aW9uIGlzU3RyYXRlZ3koYWN0dWFsLCBleHBlY3RlZCwgc3RhdGUpIHtcclxuICAgIHJldHVybiBhY3R1YWwgPT09IGV4cGVjdGVkO1xyXG59XHJcbnZhciBTdHJhdGVneVJlc29sdmVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFN0cmF0ZWd5UmVzb2x2ZXIoc3RyYXRlZ3ksIHN0YXRlKSB7XHJcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9IHN0cmF0ZWd5O1xyXG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuICAgIH1cclxuICAgIFN0cmF0ZWd5UmVzb2x2ZXIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGtleSkge1xyXG4gICAgICAgIGlmIChpc1N0cmF0ZWd5KHRoaXMuc3RyYXRlZ3ksIFN0cmF0ZWd5Lmluc3RhbmNlLCB0aGlzLnN0YXRlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzU3RyYXRlZ3kodGhpcy5zdHJhdGVneSwgU3RyYXRlZ3kuc2luZ2xldG9uLCB0aGlzLnN0YXRlKSkge1xyXG4gICAgICAgICAgICB2YXIgc2luZ2xldG9uID0gY29udGFpbmVyLmludm9rZSh0aGlzLnN0YXRlKTtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHNpbmdsZXRvbjtcclxuICAgICAgICAgICAgdGhpcy5zdHJhdGVneSA9IDA7XHJcbiAgICAgICAgICAgIHJldHVybiBzaW5nbGV0b247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc1N0cmF0ZWd5KHRoaXMuc3RyYXRlZ3ksIFN0cmF0ZWd5LnRyYW5zaWVudCwgdGhpcy5zdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5pbnZva2UodGhpcy5zdGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc1N0cmF0ZWd5KHRoaXMuc3RyYXRlZ3ksIFN0cmF0ZWd5LmZ1bmN0aW9uLCB0aGlzLnN0YXRlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZShjb250YWluZXIsIGtleSwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc1N0cmF0ZWd5KHRoaXMuc3RyYXRlZ3ksIFN0cmF0ZWd5LmFycmF5LCB0aGlzLnN0YXRlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZVswXS5nZXQoY29udGFpbmVyLCBrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNTdHJhdGVneSh0aGlzLnN0cmF0ZWd5LCBTdHJhdGVneS5hbGlhcywgdGhpcy5zdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXQodGhpcy5zdGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzdHJhdGVneTogJyArIHRoaXMuc3RyYXRlZ3kpO1xyXG4gICAgfTtcclxuICAgIFN0cmF0ZWd5UmVzb2x2ZXIgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXNvbHZlcigpLFxyXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTnVtYmVyLCBPYmplY3RdKVxyXG4gICAgXSwgU3RyYXRlZ3lSZXNvbHZlcik7XHJcbiAgICByZXR1cm4gU3RyYXRlZ3lSZXNvbHZlcjtcclxufSgpKTtcclxudmFyIExhenkgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTGF6eShrZXkpIHtcclxuICAgICAgICB0aGlzLl9rZXkgPSBrZXk7XHJcbiAgICB9XHJcbiAgICBMYXp5XzEgPSBMYXp5O1xyXG4gICAgTGF6eS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbnRhaW5lci5nZXQoX3RoaXMuX2tleSk7IH07XHJcbiAgICB9O1xyXG4gICAgTGF6eS5vZiA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gbmV3IExhenlfMShrZXkpO1xyXG4gICAgfTtcclxuICAgIHZhciBMYXp5XzE7XHJcbiAgICBMYXp5ID0gTGF6eV8xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgcmVzb2x2ZXIoKSxcclxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pXHJcbiAgICBdLCBMYXp5KTtcclxuICAgIHJldHVybiBMYXp5O1xyXG59KCkpO1xyXG52YXIgQWxsID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFsbChrZXkpIHtcclxuICAgICAgICB0aGlzLl9rZXkgPSBrZXk7XHJcbiAgICB9XHJcbiAgICBBbGxfMSA9IEFsbDtcclxuICAgIEFsbC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHJldHVybiBjb250YWluZXIuZ2V0QWxsKHRoaXMuX2tleSk7XHJcbiAgICB9O1xyXG4gICAgQWxsLm9mID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQWxsXzEoa2V5KTtcclxuICAgIH07XHJcbiAgICB2YXIgQWxsXzE7XHJcbiAgICBBbGwgPSBBbGxfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHJlc29sdmVyKCksXHJcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKVxyXG4gICAgXSwgQWxsKTtcclxuICAgIHJldHVybiBBbGw7XHJcbn0oKSk7XHJcbnZhciBPcHRpb25hbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBPcHRpb25hbChrZXksIGNoZWNrUGFyZW50KSB7XHJcbiAgICAgICAgaWYgKGNoZWNrUGFyZW50ID09PSB2b2lkIDApIHsgY2hlY2tQYXJlbnQgPSB0cnVlOyB9XHJcbiAgICAgICAgdGhpcy5fa2V5ID0ga2V5O1xyXG4gICAgICAgIHRoaXMuX2NoZWNrUGFyZW50ID0gY2hlY2tQYXJlbnQ7XHJcbiAgICB9XHJcbiAgICBPcHRpb25hbF8xID0gT3B0aW9uYWw7XHJcbiAgICBPcHRpb25hbC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIGlmIChjb250YWluZXIuaGFzUmVzb2x2ZXIodGhpcy5fa2V5LCB0aGlzLl9jaGVja1BhcmVudCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXQodGhpcy5fa2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgT3B0aW9uYWwub2YgPSBmdW5jdGlvbiAoa2V5LCBjaGVja1BhcmVudCkge1xyXG4gICAgICAgIGlmIChjaGVja1BhcmVudCA9PT0gdm9pZCAwKSB7IGNoZWNrUGFyZW50ID0gdHJ1ZTsgfVxyXG4gICAgICAgIHJldHVybiBuZXcgT3B0aW9uYWxfMShrZXksIGNoZWNrUGFyZW50KTtcclxuICAgIH07XHJcbiAgICB2YXIgT3B0aW9uYWxfMTtcclxuICAgIE9wdGlvbmFsID0gT3B0aW9uYWxfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHJlc29sdmVyKCksXHJcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3QsIEJvb2xlYW5dKVxyXG4gICAgXSwgT3B0aW9uYWwpO1xyXG4gICAgcmV0dXJuIE9wdGlvbmFsO1xyXG59KCkpO1xyXG52YXIgUGFyZW50ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFBhcmVudChrZXkpIHtcclxuICAgICAgICB0aGlzLl9rZXkgPSBrZXk7XHJcbiAgICB9XHJcbiAgICBQYXJlbnRfMSA9IFBhcmVudDtcclxuICAgIFBhcmVudC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHJldHVybiBjb250YWluZXIucGFyZW50ID8gY29udGFpbmVyLnBhcmVudC5nZXQodGhpcy5fa2V5KSA6IG51bGw7XHJcbiAgICB9O1xyXG4gICAgUGFyZW50Lm9mID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUGFyZW50XzEoa2V5KTtcclxuICAgIH07XHJcbiAgICB2YXIgUGFyZW50XzE7XHJcbiAgICBQYXJlbnQgPSBQYXJlbnRfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHJlc29sdmVyKCksXHJcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKVxyXG4gICAgXSwgUGFyZW50KTtcclxuICAgIHJldHVybiBQYXJlbnQ7XHJcbn0oKSk7XHJcbnZhciBGYWN0b3J5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEZhY3Rvcnkoa2V5KSB7XHJcbiAgICAgICAgdGhpcy5fa2V5ID0ga2V5O1xyXG4gICAgfVxyXG4gICAgRmFjdG9yeV8xID0gRmFjdG9yeTtcclxuICAgIEZhY3RvcnkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICB2YXIgZm4gPSB0aGlzLl9rZXk7XHJcbiAgICAgICAgdmFyIHJlc29sdmVyID0gY29udGFpbmVyLmdldFJlc29sdmVyKGZuKTtcclxuICAgICAgICBpZiAocmVzb2x2ZXIgJiYgcmVzb2x2ZXIuc3RyYXRlZ3kgPT09IFN0cmF0ZWd5LmZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgIGZuID0gcmVzb2x2ZXIuc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN0ID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0W19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5pbnZva2UoZm4sIHJlc3QpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgRmFjdG9yeS5vZiA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZhY3RvcnlfMShrZXkpO1xyXG4gICAgfTtcclxuICAgIHZhciBGYWN0b3J5XzE7XHJcbiAgICBGYWN0b3J5ID0gRmFjdG9yeV8xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgcmVzb2x2ZXIoKSxcclxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdF0pXHJcbiAgICBdLCBGYWN0b3J5KTtcclxuICAgIHJldHVybiBGYWN0b3J5O1xyXG59KCkpO1xyXG52YXIgTmV3SW5zdGFuY2UgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTmV3SW5zdGFuY2Uoa2V5KSB7XHJcbiAgICAgICAgdmFyIGR5bmFtaWNEZXBlbmRlbmNpZXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICBkeW5hbWljRGVwZW5kZW5jaWVzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmtleSA9IGtleTtcclxuICAgICAgICB0aGlzLmFzS2V5ID0ga2V5O1xyXG4gICAgICAgIHRoaXMuZHluYW1pY0RlcGVuZGVuY2llcyA9IGR5bmFtaWNEZXBlbmRlbmNpZXM7XHJcbiAgICB9XHJcbiAgICBOZXdJbnN0YW5jZV8xID0gTmV3SW5zdGFuY2U7XHJcbiAgICBOZXdJbnN0YW5jZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHZhciBkeW5hbWljRGVwZW5kZW5jaWVzID0gdGhpcy5keW5hbWljRGVwZW5kZW5jaWVzLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgPyB0aGlzLmR5bmFtaWNEZXBlbmRlbmNpZXMubWFwKGZ1bmN0aW9uIChkZXBlbmRlbmN5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVwZW5kZW5jeVsncHJvdG9jb2w6YXVyZWxpYTpyZXNvbHZlciddXHJcbiAgICAgICAgICAgICAgICAgICAgPyBkZXBlbmRlbmN5LmdldChjb250YWluZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgOiBjb250YWluZXIuZ2V0KGRlcGVuZGVuY3kpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgZm4gPSB0aGlzLmtleTtcclxuICAgICAgICB2YXIgcmVzb2x2ZXIgPSBjb250YWluZXIuZ2V0UmVzb2x2ZXIoZm4pO1xyXG4gICAgICAgIGlmIChyZXNvbHZlciAmJiByZXNvbHZlci5zdHJhdGVneSA9PT0gMykge1xyXG4gICAgICAgICAgICBmbiA9IHJlc29sdmVyLnN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaW5zdGFuY2UgPSBjb250YWluZXIuaW52b2tlKGZuLCBkeW5hbWljRGVwZW5kZW5jaWVzKTtcclxuICAgICAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZSh0aGlzLmFzS2V5LCBpbnN0YW5jZSk7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgfTtcclxuICAgIE5ld0luc3RhbmNlLnByb3RvdHlwZS5hcyA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICB0aGlzLmFzS2V5ID0ga2V5O1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIE5ld0luc3RhbmNlLm9mID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHZhciBkeW5hbWljRGVwZW5kZW5jaWVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgZHluYW1pY0RlcGVuZGVuY2llc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyAoTmV3SW5zdGFuY2VfMS5iaW5kLmFwcGx5KE5ld0luc3RhbmNlXzEsIFt2b2lkIDAsIGtleV0uY29uY2F0KGR5bmFtaWNEZXBlbmRlbmNpZXMpKSkoKTtcclxuICAgIH07XHJcbiAgICB2YXIgTmV3SW5zdGFuY2VfMTtcclxuICAgIE5ld0luc3RhbmNlID0gTmV3SW5zdGFuY2VfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHJlc29sdmVyKCksXHJcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3QsIE9iamVjdF0pXHJcbiAgICBdLCBOZXdJbnN0YW5jZSk7XHJcbiAgICByZXR1cm4gTmV3SW5zdGFuY2U7XHJcbn0oKSk7XHJcbmZ1bmN0aW9uIGdldERlY29yYXRvckRlcGVuZGVuY2llcyh0YXJnZXQpIHtcclxuICAgIGF1dG9pbmplY3QodGFyZ2V0KTtcclxuICAgIHJldHVybiB0YXJnZXQuaW5qZWN0O1xyXG59XHJcbmZ1bmN0aW9uIGxhenkoa2V5VmFsdWUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBfa2V5LCBpbmRleCkge1xyXG4gICAgICAgIHZhciBpbmplY3QkJDEgPSBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXModGFyZ2V0KTtcclxuICAgICAgICBpbmplY3QkJDFbaW5kZXhdID0gTGF6eS5vZihrZXlWYWx1ZSk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGFsbChrZXlWYWx1ZSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIF9rZXksIGluZGV4KSB7XHJcbiAgICAgICAgdmFyIGluamVjdCQkMSA9IGdldERlY29yYXRvckRlcGVuZGVuY2llcyh0YXJnZXQpO1xyXG4gICAgICAgIGluamVjdCQkMVtpbmRleF0gPSBBbGwub2Yoa2V5VmFsdWUpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBvcHRpb25hbChjaGVja1BhcmVudE9yVGFyZ2V0KSB7XHJcbiAgICBpZiAoY2hlY2tQYXJlbnRPclRhcmdldCA9PT0gdm9pZCAwKSB7IGNoZWNrUGFyZW50T3JUYXJnZXQgPSB0cnVlOyB9XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uIChjaGVja1BhcmVudCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBfa2V5LCBpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgaW5qZWN0JCQxID0gZ2V0RGVjb3JhdG9yRGVwZW5kZW5jaWVzKHRhcmdldCk7XHJcbiAgICAgICAgICAgIGluamVjdCQkMVtpbmRleF0gPSBPcHRpb25hbC5vZihpbmplY3QkJDFbaW5kZXhdLCBjaGVja1BhcmVudCk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBpZiAodHlwZW9mIGNoZWNrUGFyZW50T3JUYXJnZXQgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgIHJldHVybiBkZWNvKGNoZWNrUGFyZW50T3JUYXJnZXQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRlY28odHJ1ZSk7XHJcbn1cclxuZnVuY3Rpb24gcGFyZW50KHRhcmdldCwgX2tleSwgaW5kZXgpIHtcclxuICAgIHZhciBpbmplY3QkJDEgPSBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXModGFyZ2V0KTtcclxuICAgIGluamVjdCQkMVtpbmRleF0gPSBQYXJlbnQub2YoaW5qZWN0JCQxW2luZGV4XSk7XHJcbn1cclxuZnVuY3Rpb24gZmFjdG9yeShrZXlWYWx1ZSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIF9rZXksIGluZGV4KSB7XHJcbiAgICAgICAgdmFyIGluamVjdCQkMSA9IGdldERlY29yYXRvckRlcGVuZGVuY2llcyh0YXJnZXQpO1xyXG4gICAgICAgIGluamVjdCQkMVtpbmRleF0gPSBGYWN0b3J5Lm9mKGtleVZhbHVlKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gbmV3SW5zdGFuY2UoYXNLZXlPclRhcmdldCkge1xyXG4gICAgdmFyIGR5bmFtaWNEZXBlbmRlbmNpZXMgPSBbXTtcclxuICAgIGZvciAodmFyIF9pID0gMTsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgZHluYW1pY0RlcGVuZGVuY2llc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcclxuICAgIH1cclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKGFzS2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIF9rZXksIGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZhciBpbmplY3QkJDEgPSBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXModGFyZ2V0KTtcclxuICAgICAgICAgICAgaW5qZWN0JCQxW2luZGV4XSA9IE5ld0luc3RhbmNlLm9mLmFwcGx5KE5ld0luc3RhbmNlLCBbaW5qZWN0JCQxW2luZGV4XV0uY29uY2F0KGR5bmFtaWNEZXBlbmRlbmNpZXMpKTtcclxuICAgICAgICAgICAgaWYgKCEhYXNLZXkpIHtcclxuICAgICAgICAgICAgICAgIGluamVjdCQkMVtpbmRleF0uYXMoYXNLZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAxKSB7XHJcbiAgICAgICAgcmV0dXJuIGRlY28oYXNLZXlPclRhcmdldCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVjbygpO1xyXG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlS2V5KGtleSkge1xyXG4gICAgaWYgKGtleSA9PT0gbnVsbCB8fCBrZXkgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcigna2V5L3ZhbHVlIGNhbm5vdCBiZSBudWxsIG9yIHVuZGVmaW5lZC4gQXJlIHlvdSB0cnlpbmcgdG8gaW5qZWN0L3JlZ2lzdGVyIHNvbWV0aGluZyB0aGF0IGRvZXNuXFwndCBleGlzdCB3aXRoIERJPycpO1xyXG4gICAgfVxyXG59XHJcbnZhciBfZW1wdHlQYXJhbWV0ZXJzID0gT2JqZWN0LmZyZWV6ZShbXSk7XHJcbm1ldGFkYXRhLnJlZ2lzdHJhdGlvbiA9ICdhdXJlbGlhOnJlZ2lzdHJhdGlvbic7XHJcbm1ldGFkYXRhLmludm9rZXIgPSAnYXVyZWxpYTppbnZva2VyJztcclxudmFyIHJlc29sdmVyRGVjb3JhdGVzID0gcmVzb2x2ZXIuZGVjb3JhdGVzO1xyXG52YXIgSW52b2NhdGlvbkhhbmRsZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSW52b2NhdGlvbkhhbmRsZXIoZm4sIGludm9rZXIsIGRlcGVuZGVuY2llcykge1xyXG4gICAgICAgIHRoaXMuZm4gPSBmbjtcclxuICAgICAgICB0aGlzLmludm9rZXIgPSBpbnZva2VyO1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzO1xyXG4gICAgfVxyXG4gICAgSW52b2NhdGlvbkhhbmRsZXIucHJvdG90eXBlLmludm9rZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGR5bmFtaWNEZXBlbmRlbmNpZXMpIHtcclxuICAgICAgICByZXR1cm4gZHluYW1pY0RlcGVuZGVuY2llcyAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gdGhpcy5pbnZva2VyLmludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzKGNvbnRhaW5lciwgdGhpcy5mbiwgdGhpcy5kZXBlbmRlbmNpZXMsIGR5bmFtaWNEZXBlbmRlbmNpZXMpXHJcbiAgICAgICAgICAgIDogdGhpcy5pbnZva2VyLmludm9rZShjb250YWluZXIsIHRoaXMuZm4sIHRoaXMuZGVwZW5kZW5jaWVzKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSW52b2NhdGlvbkhhbmRsZXI7XHJcbn0oKSk7XHJcbmZ1bmN0aW9uIGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzKGNvbnRhaW5lciwgZm4sIHN0YXRpY0RlcGVuZGVuY2llcywgZHluYW1pY0RlcGVuZGVuY2llcykge1xyXG4gICAgdmFyIGkgPSBzdGF0aWNEZXBlbmRlbmNpZXMubGVuZ3RoO1xyXG4gICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoaSk7XHJcbiAgICB2YXIgbG9va3VwO1xyXG4gICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgIGxvb2t1cCA9IHN0YXRpY0RlcGVuZGVuY2llc1tpXTtcclxuICAgICAgICBpZiAobG9va3VwID09PSBudWxsIHx8IGxvb2t1cCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29uc3RydWN0b3IgUGFyYW1ldGVyIHdpdGggaW5kZXggJyArXHJcbiAgICAgICAgICAgICAgICBpICtcclxuICAgICAgICAgICAgICAgICcgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkLiBBcmUgeW91IHRyeWluZyB0byBpbmplY3QvcmVnaXN0ZXIgc29tZXRoaW5nIHRoYXQgZG9lc25cXCd0IGV4aXN0IHdpdGggREk/Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBhcmdzW2ldID0gY29udGFpbmVyLmdldChsb29rdXApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChkeW5hbWljRGVwZW5kZW5jaWVzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBhcmdzID0gYXJncy5jb25jYXQoZHluYW1pY0RlcGVuZGVuY2llcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QoZm4sIGFyZ3MpO1xyXG59XHJcbnZhciBjbGFzc0ludm9rZXIgPSB7XHJcbiAgICBpbnZva2U6IGZ1bmN0aW9uIChjb250YWluZXIsIFR5cGUsIGRlcHMpIHtcclxuICAgICAgICB2YXIgaW5zdGFuY2VzID0gZGVwcy5tYXAoZnVuY3Rpb24gKGRlcCkgeyByZXR1cm4gY29udGFpbmVyLmdldChkZXApOyB9KTtcclxuICAgICAgICByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QoVHlwZSwgaW5zdGFuY2VzKTtcclxuICAgIH0sXHJcbiAgICBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llczogaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXNcclxufTtcclxuZnVuY3Rpb24gZ2V0RGVwZW5kZW5jaWVzKGYpIHtcclxuICAgIGlmICghZi5oYXNPd25Qcm9wZXJ0eSgnaW5qZWN0JykpIHtcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGYuaW5qZWN0ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgcmV0dXJuIGYuaW5qZWN0KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZi5pbmplY3Q7XHJcbn1cclxudmFyIENvbnRhaW5lciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb250YWluZXIoY29uZmlndXJhdGlvbikge1xyXG4gICAgICAgIGlmIChjb25maWd1cmF0aW9uID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY29uZmlndXJhdGlvbiA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9jb25maWd1cmF0aW9uID0gY29uZmlndXJhdGlvbjtcclxuICAgICAgICB0aGlzLl9vbkhhbmRsZXJDcmVhdGVkID0gY29uZmlndXJhdGlvbi5vbkhhbmRsZXJDcmVhdGVkO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZXJzID1cclxuICAgICAgICAgICAgY29uZmlndXJhdGlvbi5oYW5kbGVycyB8fCAoY29uZmlndXJhdGlvbi5oYW5kbGVycyA9IG5ldyBNYXAoKSk7XHJcbiAgICAgICAgdGhpcy5fcmVzb2x2ZXJzID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMucm9vdCA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5tYWtlR2xvYmFsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIENvbnRhaW5lci5pbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5zZXRIYW5kbGVyQ3JlYXRlZENhbGxiYWNrID0gZnVuY3Rpb24gKG9uSGFuZGxlckNyZWF0ZWQpIHtcclxuICAgICAgICB0aGlzLl9vbkhhbmRsZXJDcmVhdGVkID0gb25IYW5kbGVyQ3JlYXRlZDtcclxuICAgICAgICB0aGlzLl9jb25maWd1cmF0aW9uLm9uSGFuZGxlckNyZWF0ZWQgPSBvbkhhbmRsZXJDcmVhdGVkO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJJbnN0YW5jZSA9IGZ1bmN0aW9uIChrZXksIGluc3RhbmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDAsIGluc3RhbmNlID09PSB1bmRlZmluZWQgPyBrZXkgOiBpbnN0YW5jZSkpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJTaW5nbGV0b24gPSBmdW5jdGlvbiAoa2V5LCBmbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigxLCBmbiA9PT0gdW5kZWZpbmVkID8ga2V5IDogZm4pKTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVyVHJhbnNpZW50ID0gZnVuY3Rpb24gKGtleSwgZm4pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlclJlc29sdmVyKGtleSwgbmV3IFN0cmF0ZWd5UmVzb2x2ZXIoMiwgZm4gPT09IHVuZGVmaW5lZCA/IGtleSA6IGZuKSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3RlckhhbmRsZXIgPSBmdW5jdGlvbiAoa2V5LCBoYW5kbGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDMsIGhhbmRsZXIpKTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVyQWxpYXMgPSBmdW5jdGlvbiAob3JpZ2luYWxLZXksIGFsaWFzS2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihhbGlhc0tleSwgbmV3IFN0cmF0ZWd5UmVzb2x2ZXIoNSwgb3JpZ2luYWxLZXkpKTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVyUmVzb2x2ZXIgPSBmdW5jdGlvbiAoa2V5LCByZXNvbHZlciQkMSkge1xyXG4gICAgICAgIHZhbGlkYXRlS2V5KGtleSk7XHJcbiAgICAgICAgdmFyIGFsbFJlc29sdmVycyA9IHRoaXMuX3Jlc29sdmVycztcclxuICAgICAgICB2YXIgcmVzdWx0ID0gYWxsUmVzb2x2ZXJzLmdldChrZXkpO1xyXG4gICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBhbGxSZXNvbHZlcnMuc2V0KGtleSwgcmVzb2x2ZXIkJDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChyZXN1bHQuc3RyYXRlZ3kgPT09IDQpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnN0YXRlLnB1c2gocmVzb2x2ZXIkJDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYWxsUmVzb2x2ZXJzLnNldChrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDQsIFtyZXN1bHQsIHJlc29sdmVyJCQxXSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzb2x2ZXIkJDE7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5hdXRvUmVnaXN0ZXIgPSBmdW5jdGlvbiAoa2V5LCBmbikge1xyXG4gICAgICAgIGZuID0gZm4gPT09IHVuZGVmaW5lZCA/IGtleSA6IGZuO1xyXG4gICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbiA9IG1ldGFkYXRhLmdldChtZXRhZGF0YS5yZWdpc3RyYXRpb24sIGZuKTtcclxuICAgICAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlclJlc29sdmVyKGtleSwgbmV3IFN0cmF0ZWd5UmVzb2x2ZXIoMSwgZm4pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVnaXN0cmF0aW9uLnJlZ2lzdGVyUmVzb2x2ZXIodGhpcywga2V5LCBmbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigwLCBmbikpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuYXV0b1JlZ2lzdGVyQWxsID0gZnVuY3Rpb24gKGZucykge1xyXG4gICAgICAgIHZhciBpID0gZm5zLmxlbmd0aDtcclxuICAgICAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXV0b1JlZ2lzdGVyKGZuc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUudW5yZWdpc3RlciA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICB0aGlzLl9yZXNvbHZlcnMuZGVsZXRlKGtleSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5oYXNSZXNvbHZlciA9IGZ1bmN0aW9uIChrZXksIGNoZWNrUGFyZW50KSB7XHJcbiAgICAgICAgaWYgKGNoZWNrUGFyZW50ID09PSB2b2lkIDApIHsgY2hlY2tQYXJlbnQgPSBmYWxzZTsgfVxyXG4gICAgICAgIHZhbGlkYXRlS2V5KGtleSk7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLl9yZXNvbHZlcnMuaGFzKGtleSkgfHxcclxuICAgICAgICAgICAgKGNoZWNrUGFyZW50ICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudCAhPT0gbnVsbCAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQuaGFzUmVzb2x2ZXIoa2V5LCBjaGVja1BhcmVudCkpKTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmdldFJlc29sdmVyID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yZXNvbHZlcnMuZ2V0KGtleSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdmFsaWRhdGVLZXkoa2V5KTtcclxuICAgICAgICBpZiAoa2V5ID09PSBDb250YWluZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNvbHZlckRlY29yYXRlcyhrZXkpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBrZXkuZ2V0KHRoaXMsIGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXNvbHZlciQkMSA9IHRoaXMuX3Jlc29sdmVycy5nZXQoa2V5KTtcclxuICAgICAgICBpZiAocmVzb2x2ZXIkJDEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmF1dG9SZWdpc3RlcihrZXkpLmdldCh0aGlzLCBrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZWdpc3RyYXRpb24gPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVnaXN0cmF0aW9uLCBrZXkpO1xyXG4gICAgICAgICAgICBpZiAocmVnaXN0cmF0aW9uID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5fZ2V0KGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJhdGlvbi5yZWdpc3RlclJlc29sdmVyKHRoaXMsIGtleSwga2V5KS5nZXQodGhpcywga2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmVyJCQxLmdldCh0aGlzLCBrZXkpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuX2dldCA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICB2YXIgcmVzb2x2ZXIkJDEgPSB0aGlzLl9yZXNvbHZlcnMuZ2V0KGtleSk7XHJcbiAgICAgICAgaWYgKHJlc29sdmVyJCQxID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRvUmVnaXN0ZXIoa2V5KS5nZXQodGhpcywga2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuX2dldChrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzb2x2ZXIkJDEuZ2V0KHRoaXMsIGtleSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdmFsaWRhdGVLZXkoa2V5KTtcclxuICAgICAgICB2YXIgcmVzb2x2ZXIkJDEgPSB0aGlzLl9yZXNvbHZlcnMuZ2V0KGtleSk7XHJcbiAgICAgICAgaWYgKHJlc29sdmVyJCQxID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2VtcHR5UGFyYW1ldGVycztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuZ2V0QWxsKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNvbHZlciQkMS5zdHJhdGVneSA9PT0gNCkge1xyXG4gICAgICAgICAgICB2YXIgc3RhdGUgPSByZXNvbHZlciQkMS5zdGF0ZTtcclxuICAgICAgICAgICAgdmFyIGkgPSBzdGF0ZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KGkpO1xyXG4gICAgICAgICAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzW2ldID0gc3RhdGVbaV0uZ2V0KHRoaXMsIGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbcmVzb2x2ZXIkJDEuZ2V0KHRoaXMsIGtleSldO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuY3JlYXRlQ2hpbGQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNoaWxkID0gbmV3IENvbnRhaW5lcih0aGlzLl9jb25maWd1cmF0aW9uKTtcclxuICAgICAgICBjaGlsZC5yb290ID0gdGhpcy5yb290O1xyXG4gICAgICAgIGNoaWxkLnBhcmVudCA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24gKGZuLCBkeW5hbWljRGVwZW5kZW5jaWVzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSB0aGlzLl9oYW5kbGVycy5nZXQoZm4pO1xyXG4gICAgICAgICAgICBpZiAoaGFuZGxlciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVyID0gdGhpcy5fY3JlYXRlSW52b2NhdGlvbkhhbmRsZXIoZm4pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlcnMuc2V0KGZuLCBoYW5kbGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlci5pbnZva2UodGhpcywgZHluYW1pY0RlcGVuZGVuY2llcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBBZ2dyZWdhdGVFcnJvcihcIkVycm9yIGludm9raW5nIFwiICsgZm4ubmFtZSArIFwiLiBDaGVjayB0aGUgaW5uZXIgZXJyb3IgZm9yIGRldGFpbHMuXCIsIGUsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLl9jcmVhdGVJbnZvY2F0aW9uSGFuZGxlciA9IGZ1bmN0aW9uIChmbikge1xyXG4gICAgICAgIHZhciBkZXBlbmRlbmNpZXM7XHJcbiAgICAgICAgaWYgKGZuLmluamVjdCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGRlcGVuZGVuY2llcyA9XHJcbiAgICAgICAgICAgICAgICBtZXRhZGF0YS5nZXRPd24obWV0YWRhdGEucGFyYW1UeXBlcywgZm4pIHx8IF9lbXB0eVBhcmFtZXRlcnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBkZXBlbmRlbmNpZXMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGN0b3IgPSBmbjtcclxuICAgICAgICAgICAgd2hpbGUgKHR5cGVvZiBjdG9yID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMucHVzaC5hcHBseShkZXBlbmRlbmNpZXMsIGdldERlcGVuZGVuY2llcyhjdG9yKSk7XHJcbiAgICAgICAgICAgICAgICBjdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGN0b3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpbnZva2VyID0gbWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhLmludm9rZXIsIGZuKSB8fCBjbGFzc0ludm9rZXI7XHJcbiAgICAgICAgdmFyIGhhbmRsZXIgPSBuZXcgSW52b2NhdGlvbkhhbmRsZXIoZm4sIGludm9rZXIsIGRlcGVuZGVuY2llcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX29uSGFuZGxlckNyZWF0ZWQgIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICA/IHRoaXMuX29uSGFuZGxlckNyZWF0ZWQoaGFuZGxlcilcclxuICAgICAgICAgICAgOiBoYW5kbGVyO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDb250YWluZXI7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIGludm9rZXIodmFsdWUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLmludm9rZXIsIHZhbHVlLCB0YXJnZXQpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBpbnZva2VBc0ZhY3RvcnkocG90ZW50aWFsVGFyZ2V0KSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEuaW52b2tlciwgRmFjdG9yeUludm9rZXIuaW5zdGFuY2UsIHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHBvdGVudGlhbFRhcmdldCA/IGRlY28ocG90ZW50aWFsVGFyZ2V0KSA6IGRlY287XHJcbn1cclxudmFyIEZhY3RvcnlJbnZva2VyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEZhY3RvcnlJbnZva2VyKCkge1xyXG4gICAgfVxyXG4gICAgRmFjdG9yeUludm9rZXIucHJvdG90eXBlLmludm9rZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGZuLCBkZXBlbmRlbmNpZXMpIHtcclxuICAgICAgICB2YXIgaSA9IGRlcGVuZGVuY2llcy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoaSk7XHJcbiAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICBhcmdzW2ldID0gY29udGFpbmVyLmdldChkZXBlbmRlbmNpZXNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZm4uYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcclxuICAgIH07XHJcbiAgICBGYWN0b3J5SW52b2tlci5wcm90b3R5cGUuaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBmbiwgc3RhdGljRGVwZW5kZW5jaWVzLCBkeW5hbWljRGVwZW5kZW5jaWVzKSB7XHJcbiAgICAgICAgdmFyIGkgPSBzdGF0aWNEZXBlbmRlbmNpZXMubGVuZ3RoO1xyXG4gICAgICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGkpO1xyXG4gICAgICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICAgICAgYXJnc1tpXSA9IGNvbnRhaW5lci5nZXQoc3RhdGljRGVwZW5kZW5jaWVzW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGR5bmFtaWNEZXBlbmRlbmNpZXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBhcmdzID0gYXJncy5jb25jYXQoZHluYW1pY0RlcGVuZGVuY2llcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmbi5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBGYWN0b3J5SW52b2tlcjtcclxufSgpKTtcclxuRmFjdG9yeUludm9rZXIuaW5zdGFuY2UgPSBuZXcgRmFjdG9yeUludm9rZXIoKTtcblxuZnVuY3Rpb24gcmVnaXN0cmF0aW9uKHZhbHVlKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZWdpc3RyYXRpb24sIHZhbHVlLCB0YXJnZXQpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiB0cmFuc2llbnQoa2V5KSB7XHJcbiAgICByZXR1cm4gcmVnaXN0cmF0aW9uKG5ldyBUcmFuc2llbnRSZWdpc3RyYXRpb24oa2V5KSk7XHJcbn1cclxuZnVuY3Rpb24gc2luZ2xldG9uKGtleU9yUmVnaXN0ZXJJbkNoaWxkLCByZWdpc3RlckluQ2hpbGQpIHtcclxuICAgIGlmIChyZWdpc3RlckluQ2hpbGQgPT09IHZvaWQgMCkgeyByZWdpc3RlckluQ2hpbGQgPSBmYWxzZTsgfVxyXG4gICAgcmV0dXJuIHJlZ2lzdHJhdGlvbihuZXcgU2luZ2xldG9uUmVnaXN0cmF0aW9uKGtleU9yUmVnaXN0ZXJJbkNoaWxkLCByZWdpc3RlckluQ2hpbGQpKTtcclxufVxyXG52YXIgVHJhbnNpZW50UmVnaXN0cmF0aW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRyYW5zaWVudFJlZ2lzdHJhdGlvbihrZXkpIHtcclxuICAgICAgICB0aGlzLl9rZXkgPSBrZXk7XHJcbiAgICB9XHJcbiAgICBUcmFuc2llbnRSZWdpc3RyYXRpb24ucHJvdG90eXBlLnJlZ2lzdGVyUmVzb2x2ZXIgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBrZXksIGZuKSB7XHJcbiAgICAgICAgdmFyIGV4aXN0aW5nUmVzb2x2ZXIgPSBjb250YWluZXIuZ2V0UmVzb2x2ZXIodGhpcy5fa2V5IHx8IGtleSk7XHJcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nUmVzb2x2ZXIgPT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICA/IGNvbnRhaW5lci5yZWdpc3RlclRyYW5zaWVudCgodGhpcy5fa2V5IHx8IGtleSksIGZuKVxyXG4gICAgICAgICAgICA6IGV4aXN0aW5nUmVzb2x2ZXI7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFRyYW5zaWVudFJlZ2lzdHJhdGlvbjtcclxufSgpKTtcclxudmFyIFNpbmdsZXRvblJlZ2lzdHJhdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTaW5nbGV0b25SZWdpc3RyYXRpb24oa2V5T3JSZWdpc3RlckluQ2hpbGQsIHJlZ2lzdGVySW5DaGlsZCkge1xyXG4gICAgICAgIGlmIChyZWdpc3RlckluQ2hpbGQgPT09IHZvaWQgMCkgeyByZWdpc3RlckluQ2hpbGQgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmICh0eXBlb2Yga2V5T3JSZWdpc3RlckluQ2hpbGQgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RlckluQ2hpbGQgPSBrZXlPclJlZ2lzdGVySW5DaGlsZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2tleSA9IGtleU9yUmVnaXN0ZXJJbkNoaWxkO1xyXG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RlckluQ2hpbGQgPSByZWdpc3RlckluQ2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgU2luZ2xldG9uUmVnaXN0cmF0aW9uLnByb3RvdHlwZS5yZWdpc3RlclJlc29sdmVyID0gZnVuY3Rpb24gKGNvbnRhaW5lciwga2V5LCBmbikge1xyXG4gICAgICAgIHZhciB0YXJnZXRDb250YWluZXIgPSB0aGlzLl9yZWdpc3RlckluQ2hpbGQgPyBjb250YWluZXIgOiBjb250YWluZXIucm9vdDtcclxuICAgICAgICB2YXIgZXhpc3RpbmdSZXNvbHZlciA9IHRhcmdldENvbnRhaW5lci5nZXRSZXNvbHZlcih0aGlzLl9rZXkgfHwga2V5KTtcclxuICAgICAgICByZXR1cm4gZXhpc3RpbmdSZXNvbHZlciA9PT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gdGFyZ2V0Q29udGFpbmVyLnJlZ2lzdGVyU2luZ2xldG9uKHRoaXMuX2tleSB8fCBrZXksIGZuKVxyXG4gICAgICAgICAgICA6IGV4aXN0aW5nUmVzb2x2ZXI7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNpbmdsZXRvblJlZ2lzdHJhdGlvbjtcclxufSgpKTtcblxuZXhwb3J0IHsgX2VtcHR5UGFyYW1ldGVycywgSW52b2NhdGlvbkhhbmRsZXIsIENvbnRhaW5lciwgYXV0b2luamVjdCwgaW5qZWN0LCBpbnZva2VyLCBpbnZva2VBc0ZhY3RvcnksIEZhY3RvcnlJbnZva2VyLCByZWdpc3RyYXRpb24sIHRyYW5zaWVudCwgc2luZ2xldG9uLCBUcmFuc2llbnRSZWdpc3RyYXRpb24sIFNpbmdsZXRvblJlZ2lzdHJhdGlvbiwgcmVzb2x2ZXIsIFN0cmF0ZWd5LCBTdHJhdGVneVJlc29sdmVyLCBMYXp5LCBBbGwsIE9wdGlvbmFsLCBQYXJlbnQsIEZhY3RvcnksIE5ld0luc3RhbmNlLCBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXMsIGxhenksIGFsbCwgb3B0aW9uYWwsIHBhcmVudCwgZmFjdG9yeSwgbmV3SW5zdGFuY2UgfTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbi5qc1xuLy8gbW9kdWxlIGlkID0gMVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJ2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cblxuXG5pbXBvcnQgeyBET00sIEZFQVRVUkUgfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5cbnZhciBzdGFja1NlcGFyYXRvciA9ICdcXG5FbnF1ZXVlZCBpbiBUYXNrUXVldWUgYnk6XFxuJztcbnZhciBtaWNyb1N0YWNrU2VwYXJhdG9yID0gJ1xcbkVucXVldWVkIGluIE1pY3JvVGFza1F1ZXVlIGJ5Olxcbic7XG5cbmZ1bmN0aW9uIG1ha2VSZXF1ZXN0Rmx1c2hGcm9tTXV0YXRpb25PYnNlcnZlcihmbHVzaCkge1xuICB2YXIgb2JzZXJ2ZXIgPSBET00uY3JlYXRlTXV0YXRpb25PYnNlcnZlcihmbHVzaCk7XG4gIHZhciB2YWwgPSAnYSc7XG4gIHZhciBub2RlID0gRE9NLmNyZWF0ZVRleHROb2RlKCdhJyk7XG4gIHZhciB2YWx1ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB2YWx1ZXMuYSA9ICdiJztcbiAgdmFsdWVzLmIgPSAnYSc7XG4gIG9ic2VydmVyLm9ic2VydmUobm9kZSwgeyBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pO1xuICByZXR1cm4gZnVuY3Rpb24gcmVxdWVzdEZsdXNoKCkge1xuICAgIG5vZGUuZGF0YSA9IHZhbCA9IHZhbHVlc1t2YWxdO1xuICB9O1xufVxuXG5mdW5jdGlvbiBtYWtlUmVxdWVzdEZsdXNoRnJvbVRpbWVyKGZsdXNoKSB7XG4gIHJldHVybiBmdW5jdGlvbiByZXF1ZXN0Rmx1c2goKSB7XG4gICAgdmFyIHRpbWVvdXRIYW5kbGUgPSBzZXRUaW1lb3V0KGhhbmRsZUZsdXNoVGltZXIsIDApO1xuXG4gICAgdmFyIGludGVydmFsSGFuZGxlID0gc2V0SW50ZXJ2YWwoaGFuZGxlRmx1c2hUaW1lciwgNTApO1xuICAgIGZ1bmN0aW9uIGhhbmRsZUZsdXNoVGltZXIoKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dEhhbmRsZSk7XG4gICAgICBjbGVhckludGVydmFsKGludGVydmFsSGFuZGxlKTtcbiAgICAgIGZsdXNoKCk7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBvbkVycm9yKGVycm9yLCB0YXNrLCBsb25nU3RhY2tzKSB7XG4gIGlmIChsb25nU3RhY2tzICYmIHRhc2suc3RhY2sgJiYgKHR5cGVvZiBlcnJvciA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZXJyb3IpKSA9PT0gJ29iamVjdCcgJiYgZXJyb3IgIT09IG51bGwpIHtcbiAgICBlcnJvci5zdGFjayA9IGZpbHRlckZsdXNoU3RhY2soZXJyb3Iuc3RhY2spICsgdGFzay5zdGFjaztcbiAgfVxuXG4gIGlmICgnb25FcnJvcicgaW4gdGFzaykge1xuICAgIHRhc2sub25FcnJvcihlcnJvcik7XG4gIH0gZWxzZSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9LCAwKTtcbiAgfVxufVxuXG5leHBvcnQgdmFyIFRhc2tRdWV1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGFza1F1ZXVlKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBcblxuICAgIHRoaXMuZmx1c2hpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmxvbmdTdGFja3MgPSBmYWxzZTtcblxuICAgIHRoaXMubWljcm9UYXNrUXVldWUgPSBbXTtcbiAgICB0aGlzLm1pY3JvVGFza1F1ZXVlQ2FwYWNpdHkgPSAxMDI0O1xuICAgIHRoaXMudGFza1F1ZXVlID0gW107XG5cbiAgICBpZiAoRkVBVFVSRS5tdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaE1pY3JvVGFza1F1ZXVlID0gbWFrZVJlcXVlc3RGbHVzaEZyb21NdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLmZsdXNoTWljcm9UYXNrUXVldWUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaE1pY3JvVGFza1F1ZXVlID0gbWFrZVJlcXVlc3RGbHVzaEZyb21UaW1lcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5mbHVzaE1pY3JvVGFza1F1ZXVlKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnJlcXVlc3RGbHVzaFRhc2tRdWV1ZSA9IG1ha2VSZXF1ZXN0Rmx1c2hGcm9tVGltZXIoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIF90aGlzLmZsdXNoVGFza1F1ZXVlKCk7XG4gICAgfSk7XG4gIH1cblxuICBUYXNrUXVldWUucHJvdG90eXBlLl9mbHVzaFF1ZXVlID0gZnVuY3Rpb24gX2ZsdXNoUXVldWUocXVldWUsIGNhcGFjaXR5KSB7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgdGFzayA9IHZvaWQgMDtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLmZsdXNoaW5nID0gdHJ1ZTtcbiAgICAgIHdoaWxlIChpbmRleCA8IHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICB0YXNrID0gcXVldWVbaW5kZXhdO1xuICAgICAgICBpZiAodGhpcy5sb25nU3RhY2tzKSB7XG4gICAgICAgICAgdGhpcy5zdGFjayA9IHR5cGVvZiB0YXNrLnN0YWNrID09PSAnc3RyaW5nJyA/IHRhc2suc3RhY2sgOiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGFzay5jYWxsKCk7XG4gICAgICAgIGluZGV4Kys7XG5cbiAgICAgICAgaWYgKGluZGV4ID4gY2FwYWNpdHkpIHtcbiAgICAgICAgICBmb3IgKHZhciBzY2FuID0gMCwgbmV3TGVuZ3RoID0gcXVldWUubGVuZ3RoIC0gaW5kZXg7IHNjYW4gPCBuZXdMZW5ndGg7IHNjYW4rKykge1xuICAgICAgICAgICAgcXVldWVbc2Nhbl0gPSBxdWV1ZVtzY2FuICsgaW5kZXhdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHF1ZXVlLmxlbmd0aCAtPSBpbmRleDtcbiAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgb25FcnJvcihlcnJvciwgdGFzaywgdGhpcy5sb25nU3RhY2tzKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5mbHVzaGluZyA9IGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICBUYXNrUXVldWUucHJvdG90eXBlLnF1ZXVlTWljcm9UYXNrID0gZnVuY3Rpb24gcXVldWVNaWNyb1Rhc2sodGFzaykge1xuICAgIGlmICh0aGlzLm1pY3JvVGFza1F1ZXVlLmxlbmd0aCA8IDEpIHtcbiAgICAgIHRoaXMucmVxdWVzdEZsdXNoTWljcm9UYXNrUXVldWUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sb25nU3RhY2tzKSB7XG4gICAgICB0YXNrLnN0YWNrID0gdGhpcy5wcmVwYXJlUXVldWVTdGFjayhtaWNyb1N0YWNrU2VwYXJhdG9yKTtcbiAgICB9XG5cbiAgICB0aGlzLm1pY3JvVGFza1F1ZXVlLnB1c2godGFzayk7XG4gIH07XG5cbiAgVGFza1F1ZXVlLnByb3RvdHlwZS5xdWV1ZVRhc2sgPSBmdW5jdGlvbiBxdWV1ZVRhc2sodGFzaykge1xuICAgIGlmICh0aGlzLnRhc2tRdWV1ZS5sZW5ndGggPCAxKSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaFRhc2tRdWV1ZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmxvbmdTdGFja3MpIHtcbiAgICAgIHRhc2suc3RhY2sgPSB0aGlzLnByZXBhcmVRdWV1ZVN0YWNrKHN0YWNrU2VwYXJhdG9yKTtcbiAgICB9XG5cbiAgICB0aGlzLnRhc2tRdWV1ZS5wdXNoKHRhc2spO1xuICB9O1xuXG4gIFRhc2tRdWV1ZS5wcm90b3R5cGUuZmx1c2hUYXNrUXVldWUgPSBmdW5jdGlvbiBmbHVzaFRhc2tRdWV1ZSgpIHtcbiAgICB2YXIgcXVldWUgPSB0aGlzLnRhc2tRdWV1ZTtcbiAgICB0aGlzLnRhc2tRdWV1ZSA9IFtdO1xuICAgIHRoaXMuX2ZsdXNoUXVldWUocXVldWUsIE51bWJlci5NQVhfVkFMVUUpO1xuICB9O1xuXG4gIFRhc2tRdWV1ZS5wcm90b3R5cGUuZmx1c2hNaWNyb1Rhc2tRdWV1ZSA9IGZ1bmN0aW9uIGZsdXNoTWljcm9UYXNrUXVldWUoKSB7XG4gICAgdmFyIHF1ZXVlID0gdGhpcy5taWNyb1Rhc2tRdWV1ZTtcbiAgICB0aGlzLl9mbHVzaFF1ZXVlKHF1ZXVlLCB0aGlzLm1pY3JvVGFza1F1ZXVlQ2FwYWNpdHkpO1xuICAgIHF1ZXVlLmxlbmd0aCA9IDA7XG4gIH07XG5cbiAgVGFza1F1ZXVlLnByb3RvdHlwZS5wcmVwYXJlUXVldWVTdGFjayA9IGZ1bmN0aW9uIHByZXBhcmVRdWV1ZVN0YWNrKHNlcGFyYXRvcikge1xuICAgIHZhciBzdGFjayA9IHNlcGFyYXRvciArIGZpbHRlclF1ZXVlU3RhY2soY2FwdHVyZVN0YWNrKCkpO1xuXG4gICAgaWYgKHR5cGVvZiB0aGlzLnN0YWNrID09PSAnc3RyaW5nJykge1xuICAgICAgc3RhY2sgPSBmaWx0ZXJGbHVzaFN0YWNrKHN0YWNrKSArIHRoaXMuc3RhY2s7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YWNrO1xuICB9O1xuXG4gIHJldHVybiBUYXNrUXVldWU7XG59KCk7XG5cbmZ1bmN0aW9uIGNhcHR1cmVTdGFjaygpIHtcbiAgdmFyIGVycm9yID0gbmV3IEVycm9yKCk7XG5cbiAgaWYgKGVycm9yLnN0YWNrKSB7XG4gICAgcmV0dXJuIGVycm9yLnN0YWNrO1xuICB9XG5cbiAgdHJ5IHtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBlLnN0YWNrO1xuICB9XG59XG5cbmZ1bmN0aW9uIGZpbHRlclF1ZXVlU3RhY2soc3RhY2spIHtcbiAgcmV0dXJuIHN0YWNrLnJlcGxhY2UoL15bXFxzXFxTXSo/XFxicXVldWUoTWljcm8pP1Rhc2tcXGJbXlxcbl0qXFxuLywgJycpO1xufVxuXG5mdW5jdGlvbiBmaWx0ZXJGbHVzaFN0YWNrKHN0YWNrKSB7XG4gIHZhciBpbmRleCA9IHN0YWNrLmxhc3RJbmRleE9mKCdmbHVzaE1pY3JvVGFza1F1ZXVlJyk7XG5cbiAgaWYgKGluZGV4IDwgMCkge1xuICAgIGluZGV4ID0gc3RhY2subGFzdEluZGV4T2YoJ2ZsdXNoVGFza1F1ZXVlJyk7XG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgcmV0dXJuIHN0YWNrO1xuICAgIH1cbiAgfVxuXG4gIGluZGV4ID0gc3RhY2subGFzdEluZGV4T2YoJ1xcbicsIGluZGV4KTtcblxuICByZXR1cm4gaW5kZXggPCAwID8gc3RhY2sgOiBzdGFjay5zdWJzdHIoMCwgaW5kZXgpO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRhc2stcXVldWUvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRhc2stcXVldWUuanNcbi8vIG1vZHVsZSBpZCA9IDEzOFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJcblxuZnVuY3Rpb24gbWkobmFtZSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0hpc3RvcnkgbXVzdCBpbXBsZW1lbnQgJyArIG5hbWUgKyAnKCkuJyk7XG59XG5cbmV4cG9ydCB2YXIgSGlzdG9yeSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSGlzdG9yeSgpIHtcbiAgICBcbiAgfVxuXG4gIEhpc3RvcnkucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gYWN0aXZhdGUob3B0aW9ucykge1xuICAgIG1pKCdhY3RpdmF0ZScpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiBkZWFjdGl2YXRlKCkge1xuICAgIG1pKCdkZWFjdGl2YXRlJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuZ2V0QWJzb2x1dGVSb290ID0gZnVuY3Rpb24gZ2V0QWJzb2x1dGVSb290KCkge1xuICAgIG1pKCdnZXRBYnNvbHV0ZVJvb3QnKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIG5hdmlnYXRlKGZyYWdtZW50LCBvcHRpb25zKSB7XG4gICAgbWkoJ25hdmlnYXRlJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUubmF2aWdhdGVCYWNrID0gZnVuY3Rpb24gbmF2aWdhdGVCYWNrKCkge1xuICAgIG1pKCduYXZpZ2F0ZUJhY2snKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5zZXRUaXRsZSA9IGZ1bmN0aW9uIHNldFRpdGxlKHRpdGxlKSB7XG4gICAgbWkoJ3NldFRpdGxlJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiBzZXRTdGF0ZShrZXksIHZhbHVlKSB7XG4gICAgbWkoJ3NldFN0YXRlJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuZ2V0U3RhdGUgPSBmdW5jdGlvbiBnZXRTdGF0ZShrZXkpIHtcbiAgICBtaSgnZ2V0U3RhdGUnKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5nZXRIaXN0b3J5SW5kZXggPSBmdW5jdGlvbiBnZXRIaXN0b3J5SW5kZXgoKSB7XG4gICAgbWkoJ2dldEhpc3RvcnlJbmRleCcpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLmdvID0gZnVuY3Rpb24gZ28obW92ZW1lbnQpIHtcbiAgICBtaSgnZ28nKTtcbiAgfTtcblxuICByZXR1cm4gSGlzdG9yeTtcbn0oKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1oaXN0b3J5L2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1oaXN0b3J5LmpzXG4vLyBtb2R1bGUgaWQgPSAyMTNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwidmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG52YXIgX2NsYXNzLCBfdGVtcCwgX2NsYXNzMiwgX3RlbXAyLCBfZGVjLCBfY2xhc3MzLCBfZGVjMiwgX2NsYXNzNCwgX2RlYzMsIF9jbGFzczUsIF9kZWM0LCBfY2xhc3M2LCBfZGVjNSwgX2NsYXNzNywgX2RlYzYsIF9jbGFzczgsIF9jbGFzczksIF90ZW1wMywgX2NsYXNzMTAsIF90ZW1wNCwgX2NsYXNzMTIsIF9jbGFzczE0LCBfdGVtcDUsIF9kZWM3LCBfY2xhc3MxNSwgX2RlYzgsIF9jbGFzczE2LCBfZGVjOSwgX2NsYXNzMTc7XG5cblxuXG5pbXBvcnQgKiBhcyBMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5pbXBvcnQgeyBtZXRhZGF0YSwgT3JpZ2luLCBwcm90b2NvbCB9IGZyb20gJ2F1cmVsaWEtbWV0YWRhdGEnO1xuaW1wb3J0IHsgRE9NLCBQTEFURk9STSwgRkVBVFVSRSB9IGZyb20gJ2F1cmVsaWEtcGFsJztcbmltcG9ydCB7IFRlbXBsYXRlUmVnaXN0cnlFbnRyeSwgTG9hZGVyIH0gZnJvbSAnYXVyZWxpYS1sb2FkZXInO1xuaW1wb3J0IHsgcmVsYXRpdmVUb0ZpbGUgfSBmcm9tICdhdXJlbGlhLXBhdGgnO1xuaW1wb3J0IHsgU2NvcGUsIEV4cHJlc3Npb24sIFZhbHVlQ29udmVydGVyUmVzb3VyY2UsIEJpbmRpbmdCZWhhdmlvclJlc291cmNlLCBjYW1lbENhc2UsIEJpbmRpbmcsIGNyZWF0ZU92ZXJyaWRlQ29udGV4dCwgc3Vic2NyaWJlckNvbGxlY3Rpb24sIGJpbmRpbmdNb2RlLCBPYnNlcnZlckxvY2F0b3IsIEV2ZW50TWFuYWdlciB9IGZyb20gJ2F1cmVsaWEtYmluZGluZyc7XG5pbXBvcnQgeyBDb250YWluZXIsIHJlc29sdmVyLCBpbmplY3QgfSBmcm9tICdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJztcbmltcG9ydCB7IFRhc2tRdWV1ZSB9IGZyb20gJ2F1cmVsaWEtdGFzay1xdWV1ZSc7XG5cbmV4cG9ydCB2YXIgYW5pbWF0aW9uRXZlbnQgPSB7XG4gIGVudGVyQmVnaW46ICdhbmltYXRpb246ZW50ZXI6YmVnaW4nLFxuICBlbnRlckFjdGl2ZTogJ2FuaW1hdGlvbjplbnRlcjphY3RpdmUnLFxuICBlbnRlckRvbmU6ICdhbmltYXRpb246ZW50ZXI6ZG9uZScsXG4gIGVudGVyVGltZW91dDogJ2FuaW1hdGlvbjplbnRlcjp0aW1lb3V0JyxcblxuICBsZWF2ZUJlZ2luOiAnYW5pbWF0aW9uOmxlYXZlOmJlZ2luJyxcbiAgbGVhdmVBY3RpdmU6ICdhbmltYXRpb246bGVhdmU6YWN0aXZlJyxcbiAgbGVhdmVEb25lOiAnYW5pbWF0aW9uOmxlYXZlOmRvbmUnLFxuICBsZWF2ZVRpbWVvdXQ6ICdhbmltYXRpb246bGVhdmU6dGltZW91dCcsXG5cbiAgc3RhZ2dlck5leHQ6ICdhbmltYXRpb246c3RhZ2dlcjpuZXh0JyxcblxuICByZW1vdmVDbGFzc0JlZ2luOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczpiZWdpbicsXG4gIHJlbW92ZUNsYXNzQWN0aXZlOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczphY3RpdmUnLFxuICByZW1vdmVDbGFzc0RvbmU6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOmRvbmUnLFxuICByZW1vdmVDbGFzc1RpbWVvdXQ6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOnRpbWVvdXQnLFxuXG4gIGFkZENsYXNzQmVnaW46ICdhbmltYXRpb246YWRkLWNsYXNzOmJlZ2luJyxcbiAgYWRkQ2xhc3NBY3RpdmU6ICdhbmltYXRpb246YWRkLWNsYXNzOmFjdGl2ZScsXG4gIGFkZENsYXNzRG9uZTogJ2FuaW1hdGlvbjphZGQtY2xhc3M6ZG9uZScsXG4gIGFkZENsYXNzVGltZW91dDogJ2FuaW1hdGlvbjphZGQtY2xhc3M6dGltZW91dCcsXG5cbiAgYW5pbWF0ZUJlZ2luOiAnYW5pbWF0aW9uOmFuaW1hdGU6YmVnaW4nLFxuICBhbmltYXRlQWN0aXZlOiAnYW5pbWF0aW9uOmFuaW1hdGU6YWN0aXZlJyxcbiAgYW5pbWF0ZURvbmU6ICdhbmltYXRpb246YW5pbWF0ZTpkb25lJyxcbiAgYW5pbWF0ZVRpbWVvdXQ6ICdhbmltYXRpb246YW5pbWF0ZTp0aW1lb3V0JyxcblxuICBzZXF1ZW5jZUJlZ2luOiAnYW5pbWF0aW9uOnNlcXVlbmNlOmJlZ2luJyxcbiAgc2VxdWVuY2VEb25lOiAnYW5pbWF0aW9uOnNlcXVlbmNlOmRvbmUnXG59O1xuXG5leHBvcnQgdmFyIEFuaW1hdG9yID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBbmltYXRvcigpIHtcbiAgICBcbiAgfVxuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uIGVudGVyKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcbiAgfTtcblxuICBBbmltYXRvci5wcm90b3R5cGUubGVhdmUgPSBmdW5jdGlvbiBsZWF2ZShlbGVtZW50KSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gIH07XG5cbiAgQW5pbWF0b3IucHJvdG90eXBlLnJlbW92ZUNsYXNzID0gZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gIH07XG5cbiAgQW5pbWF0b3IucHJvdG90eXBlLmFkZENsYXNzID0gZnVuY3Rpb24gYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gIH07XG5cbiAgQW5pbWF0b3IucHJvdG90eXBlLmFuaW1hdGUgPSBmdW5jdGlvbiBhbmltYXRlKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xuICB9O1xuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS5ydW5TZXF1ZW5jZSA9IGZ1bmN0aW9uIHJ1blNlcXVlbmNlKGFuaW1hdGlvbnMpIHt9O1xuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS5yZWdpc3RlckVmZmVjdCA9IGZ1bmN0aW9uIHJlZ2lzdGVyRWZmZWN0KGVmZmVjdE5hbWUsIHByb3BlcnRpZXMpIHt9O1xuXG4gIEFuaW1hdG9yLnByb3RvdHlwZS51bnJlZ2lzdGVyRWZmZWN0ID0gZnVuY3Rpb24gdW5yZWdpc3RlckVmZmVjdChlZmZlY3ROYW1lKSB7fTtcblxuICByZXR1cm4gQW5pbWF0b3I7XG59KCk7XG5cbmV4cG9ydCB2YXIgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIob3duZXIpIHtcbiAgICBcblxuICAgIHRoaXMub3duZXIgPSBvd25lcjtcbiAgICB0aGlzLm93bmVyLl9jb21wb3NpdGlvbkNvdW50Kys7XG4gIH1cblxuICBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIucHJvdG90eXBlLmRvbmUgPSBmdW5jdGlvbiBkb25lKCkge1xuICAgIHRoaXMub3duZXIuX2NvbXBvc2l0aW9uQ291bnQtLTtcbiAgICB0aGlzLm93bmVyLl90cnlDb21wbGV0ZVRyYW5zYWN0aW9uKCk7XG4gIH07XG5cbiAgcmV0dXJuIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcjtcbn0oKTtcblxuZXhwb3J0IHZhciBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbihvd25lcikge1xuICAgIFxuXG4gICAgdGhpcy5vd25lciA9IG93bmVyO1xuICAgIHRoaXMub3duZXIuX293bmVyc2hpcFRva2VuID0gdGhpcztcbiAgICB0aGlzLnRoZW5hYmxlID0gdGhpcy5fY3JlYXRlVGhlbmFibGUoKTtcbiAgfVxuXG4gIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi5wcm90b3R5cGUud2FpdEZvckNvbXBvc2l0aW9uQ29tcGxldGUgPSBmdW5jdGlvbiB3YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSgpIHtcbiAgICB0aGlzLm93bmVyLl90cnlDb21wbGV0ZVRyYW5zYWN0aW9uKCk7XG4gICAgcmV0dXJuIHRoaXMudGhlbmFibGU7XG4gIH07XG5cbiAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gcmVzb2x2ZSgpIHtcbiAgICB0aGlzLl9yZXNvbHZlQ2FsbGJhY2soKTtcbiAgfTtcblxuICBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ucHJvdG90eXBlLl9jcmVhdGVUaGVuYWJsZSA9IGZ1bmN0aW9uIF9jcmVhdGVUaGVuYWJsZSgpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIF90aGlzLl9yZXNvbHZlQ2FsbGJhY2sgPSByZXNvbHZlO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW47XG59KCk7XG5cbmV4cG9ydCB2YXIgQ29tcG9zaXRpb25UcmFuc2FjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29tcG9zaXRpb25UcmFuc2FjdGlvbigpIHtcbiAgICBcblxuICAgIHRoaXMuX293bmVyc2hpcFRva2VuID0gbnVsbDtcbiAgICB0aGlzLl9jb21wb3NpdGlvbkNvdW50ID0gMDtcbiAgfVxuXG4gIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24ucHJvdG90eXBlLnRyeUNhcHR1cmUgPSBmdW5jdGlvbiB0cnlDYXB0dXJlKCkge1xuICAgIHJldHVybiB0aGlzLl9vd25lcnNoaXBUb2tlbiA9PT0gbnVsbCA/IG5ldyBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4odGhpcykgOiBudWxsO1xuICB9O1xuXG4gIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24ucHJvdG90eXBlLmVubGlzdCA9IGZ1bmN0aW9uIGVubGlzdCgpIHtcbiAgICByZXR1cm4gbmV3IENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcih0aGlzKTtcbiAgfTtcblxuICBDb21wb3NpdGlvblRyYW5zYWN0aW9uLnByb3RvdHlwZS5fdHJ5Q29tcGxldGVUcmFuc2FjdGlvbiA9IGZ1bmN0aW9uIF90cnlDb21wbGV0ZVRyYW5zYWN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9jb21wb3NpdGlvbkNvdW50IDw9IDApIHtcbiAgICAgIHRoaXMuX2NvbXBvc2l0aW9uQ291bnQgPSAwO1xuXG4gICAgICBpZiAodGhpcy5fb3duZXJzaGlwVG9rZW4gIT09IG51bGwpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5fb3duZXJzaGlwVG9rZW47XG4gICAgICAgIHRoaXMuX293bmVyc2hpcFRva2VuID0gbnVsbDtcbiAgICAgICAgdG9rZW4ucmVzb2x2ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ29tcG9zaXRpb25UcmFuc2FjdGlvbjtcbn0oKTtcblxudmFyIGNhcGl0YWxNYXRjaGVyID0gLyhbQS1aXSkvZztcblxuZnVuY3Rpb24gYWRkSHlwaGVuQW5kTG93ZXIoY2hhcikge1xuICByZXR1cm4gJy0nICsgY2hhci50b0xvd2VyQ2FzZSgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX2h5cGhlbmF0ZShuYW1lKSB7XG4gIHJldHVybiAobmFtZS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIG5hbWUuc2xpY2UoMSkpLnJlcGxhY2UoY2FwaXRhbE1hdGNoZXIsIGFkZEh5cGhlbkFuZExvd2VyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9pc0FsbFdoaXRlc3BhY2Uobm9kZSkge1xuICByZXR1cm4gIShub2RlLmF1SW50ZXJwb2xhdGlvblRhcmdldCB8fCAvW15cXHRcXG5cXHIgXS8udGVzdChub2RlLnRleHRDb250ZW50KSk7XG59XG5cbmV4cG9ydCB2YXIgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCkge1xuICAgIFxuICB9XG5cbiAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KSB7XG4gICAgdGhpcy5pbnN0YW5jZSA9IGNvbnRhaW5lci5nZXQodGFyZ2V0KTtcbiAgfTtcblxuICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihyZWdpc3RyeSwgbmFtZSkge1xuICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyVmlld0VuZ2luZUhvb2tzKHRoaXMuaW5zdGFuY2UpO1xuICB9O1xuXG4gIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gbG9hZChjb250YWluZXIsIHRhcmdldCkge307XG5cbiAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UuY29udmVudGlvbiA9IGZ1bmN0aW9uIGNvbnZlbnRpb24obmFtZSkge1xuICAgIGlmIChuYW1lLmVuZHNXaXRoKCdWaWV3RW5naW5lSG9va3MnKSkge1xuICAgICAgcmV0dXJuIG5ldyBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gVmlld0VuZ2luZUhvb2tzUmVzb3VyY2U7XG59KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiB2aWV3RW5naW5lSG9va3ModGFyZ2V0KSB7XG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0KSB7XG4gICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UoKSwgdCk7XG4gIH07XG5cbiAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XG59XG5cbmV4cG9ydCB2YXIgRWxlbWVudEV2ZW50cyA9IChfdGVtcCA9IF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRWxlbWVudEV2ZW50cyhlbGVtZW50KSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IHt9O1xuICB9XG5cbiAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuX2VucXVldWVIYW5kbGVyID0gZnVuY3Rpb24gX2VucXVldWVIYW5kbGVyKGhhbmRsZXIpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdID0gdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXSB8fCBbXTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdLnB1c2goaGFuZGxlcik7XG4gIH07XG5cbiAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuX2RlcXVldWVIYW5kbGVyID0gZnVuY3Rpb24gX2RlcXVldWVIYW5kbGVyKGhhbmRsZXIpIHtcbiAgICB2YXIgaW5kZXggPSB2b2lkIDA7XG4gICAgdmFyIHN1YnNjcmlwdGlvbnMgPSB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdO1xuICAgIGlmIChzdWJzY3JpcHRpb25zKSB7XG4gICAgICBpbmRleCA9IHN1YnNjcmlwdGlvbnMuaW5kZXhPZihoYW5kbGVyKTtcbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhbmRsZXI7XG4gIH07XG5cbiAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUucHVibGlzaCA9IGZ1bmN0aW9uIHB1Ymxpc2goZXZlbnROYW1lKSB7XG4gICAgdmFyIGRldGFpbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgdmFyIGJ1YmJsZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHRydWU7XG4gICAgdmFyIGNhbmNlbGFibGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IHRydWU7XG5cbiAgICB2YXIgZXZlbnQgPSBET00uY3JlYXRlQ3VzdG9tRXZlbnQoZXZlbnROYW1lLCB7IGNhbmNlbGFibGU6IGNhbmNlbGFibGUsIGJ1YmJsZXM6IGJ1YmJsZXMsIGRldGFpbDogZGV0YWlsIH0pO1xuICAgIHRoaXMuZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgfTtcblxuICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBpZiAoY2FwdHVyZU9yT3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNhcHR1cmVPck9wdGlvbnMgPSBFbGVtZW50RXZlbnRzLmRlZmF1bHRMaXN0ZW5lck9wdGlvbnM7XG4gICAgICB9XG4gICAgICB2YXIgZXZlbnRIYW5kbGVyID0gbmV3IEV2ZW50SGFuZGxlckltcGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zLCBmYWxzZSk7XG4gICAgICByZXR1cm4gZXZlbnRIYW5kbGVyO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uIHN1YnNjcmliZU9uY2UoZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBpZiAoY2FwdHVyZU9yT3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNhcHR1cmVPck9wdGlvbnMgPSBFbGVtZW50RXZlbnRzLmRlZmF1bHRMaXN0ZW5lck9wdGlvbnM7XG4gICAgICB9XG4gICAgICB2YXIgZXZlbnRIYW5kbGVyID0gbmV3IEV2ZW50SGFuZGxlckltcGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zLCB0cnVlKTtcbiAgICAgIHJldHVybiBldmVudEhhbmRsZXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gZGlzcG9zZShldmVudE5hbWUpIHtcbiAgICBpZiAoZXZlbnROYW1lICYmIHR5cGVvZiBldmVudE5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IHRoaXMuc3Vic2NyaXB0aW9uc1tldmVudE5hbWVdO1xuICAgICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgICAgd2hpbGUgKHN1YnNjcmlwdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbnMucG9wKCk7XG4gICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNwb3NlQWxsKCk7XG4gICAgfVxuICB9O1xuXG4gIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLmRpc3Bvc2VBbGwgPSBmdW5jdGlvbiBkaXNwb3NlQWxsKCkge1xuICAgIGZvciAodmFyIF9rZXkgaW4gdGhpcy5zdWJzY3JpcHRpb25zKSB7XG4gICAgICB0aGlzLmRpc3Bvc2UoX2tleSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBFbGVtZW50RXZlbnRzO1xufSgpLCBfY2xhc3MuZGVmYXVsdExpc3RlbmVyT3B0aW9ucyA9IHRydWUsIF90ZW1wKTtcblxudmFyIEV2ZW50SGFuZGxlckltcGwgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV2ZW50SGFuZGxlckltcGwob3duZXIsIGV2ZW50TmFtZSwgaGFuZGxlciwgY2FwdHVyZU9yT3B0aW9ucywgb25jZSkge1xuICAgIFxuXG4gICAgdGhpcy5vd25lciA9IG93bmVyO1xuICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG5cbiAgICB0aGlzLmNhcHR1cmUgPSB0eXBlb2YgY2FwdHVyZU9yT3B0aW9ucyA9PT0gJ2Jvb2xlYW4nID8gY2FwdHVyZU9yT3B0aW9ucyA6IGNhcHR1cmVPck9wdGlvbnMuY2FwdHVyZTtcbiAgICB0aGlzLmJ1YmJsZXMgPSAhdGhpcy5jYXB0dXJlO1xuICAgIHRoaXMuY2FwdHVyZU9yT3B0aW9ucyA9IGNhcHR1cmVPck9wdGlvbnM7XG4gICAgdGhpcy5vbmNlID0gb25jZTtcbiAgICBvd25lci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLCBjYXB0dXJlT3JPcHRpb25zKTtcbiAgICBvd25lci5fZW5xdWV1ZUhhbmRsZXIodGhpcyk7XG4gIH1cblxuICBFdmVudEhhbmRsZXJJbXBsLnByb3RvdHlwZS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGUpIHtcbiAgICB2YXIgZm4gPSB0aGlzLmhhbmRsZXI7XG4gICAgZm4oZSk7XG4gICAgaWYgKHRoaXMub25jZSkge1xuICAgICAgdGhpcy5kaXNwb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIEV2ZW50SGFuZGxlckltcGwucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgIHRoaXMub3duZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCB0aGlzLCB0aGlzLmNhcHR1cmVPck9wdGlvbnMpO1xuICAgIHRoaXMub3duZXIuX2RlcXVldWVIYW5kbGVyKHRoaXMpO1xuICAgIHRoaXMub3duZXIgPSB0aGlzLmhhbmRsZXIgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBFdmVudEhhbmRsZXJJbXBsO1xufSgpO1xuXG5leHBvcnQgdmFyIFJlc291cmNlTG9hZENvbnRleHQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlc291cmNlTG9hZENvbnRleHQoKSB7XG4gICAgXG5cbiAgICB0aGlzLmRlcGVuZGVuY2llcyA9IHt9O1xuICB9XG5cbiAgUmVzb3VyY2VMb2FkQ29udGV4dC5wcm90b3R5cGUuYWRkRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIGFkZERlcGVuZGVuY3kodXJsKSB7XG4gICAgdGhpcy5kZXBlbmRlbmNpZXNbdXJsXSA9IHRydWU7XG4gIH07XG5cbiAgUmVzb3VyY2VMb2FkQ29udGV4dC5wcm90b3R5cGUuaGFzRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIGhhc0RlcGVuZGVuY3kodXJsKSB7XG4gICAgcmV0dXJuIHVybCBpbiB0aGlzLmRlcGVuZGVuY2llcztcbiAgfTtcblxuICByZXR1cm4gUmVzb3VyY2VMb2FkQ29udGV4dDtcbn0oKTtcblxuZXhwb3J0IHZhciBWaWV3Q29tcGlsZUluc3RydWN0aW9uID0gZnVuY3Rpb24gVmlld0NvbXBpbGVJbnN0cnVjdGlvbigpIHtcbiAgdmFyIHRhcmdldFNoYWRvd0RPTSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7XG4gIHZhciBjb21waWxlU3Vycm9nYXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTtcblxuICBcblxuICB0aGlzLnRhcmdldFNoYWRvd0RPTSA9IHRhcmdldFNoYWRvd0RPTTtcbiAgdGhpcy5jb21waWxlU3Vycm9nYXRlID0gY29tcGlsZVN1cnJvZ2F0ZTtcbiAgdGhpcy5hc3NvY2lhdGVkTW9kdWxlSWQgPSBudWxsO1xufTtcblxuVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWwgPSBuZXcgVmlld0NvbXBpbGVJbnN0cnVjdGlvbigpO1xuXG5leHBvcnQgdmFyIEJlaGF2aW9ySW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKSB7XG4gICAgXG4gIH1cblxuICBCZWhhdmlvckluc3RydWN0aW9uLmVuaGFuY2UgPSBmdW5jdGlvbiBlbmhhbmNlKCkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24uZW5oYW5jZSA9IHRydWU7XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIEJlaGF2aW9ySW5zdHJ1Y3Rpb24udW5pdFRlc3QgPSBmdW5jdGlvbiB1bml0VGVzdCh0eXBlLCBhdHRyaWJ1dGVzKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcbiAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcyB8fCB7fTtcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgQmVoYXZpb3JJbnN0cnVjdGlvbi5lbGVtZW50ID0gZnVuY3Rpb24gZWxlbWVudChub2RlLCB0eXBlKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcbiAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzID0ge307XG4gICAgaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIgPSAhKG5vZGUuaGFzQXR0cmlidXRlKCdjb250YWluZXJsZXNzJykgfHwgdHlwZS5jb250YWluZXJsZXNzKTtcbiAgICBpbnN0cnVjdGlvbi5pbml0aWF0ZWRCeUJlaGF2aW9yID0gdHJ1ZTtcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUgPSBmdW5jdGlvbiBhdHRyaWJ1dGUoYXR0ck5hbWUsIHR5cGUpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLmF0dHJOYW1lID0gYXR0ck5hbWU7XG4gICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGUgfHwgbnVsbDtcbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzID0ge307XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZHluYW1pYyA9IGZ1bmN0aW9uIGR5bmFtaWMoaG9zdCwgdmlld01vZGVsLCB2aWV3RmFjdG9yeSkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24uaG9zdCA9IGhvc3Q7XG4gICAgaW5zdHJ1Y3Rpb24udmlld01vZGVsID0gdmlld01vZGVsO1xuICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XG4gICAgaW5zdHJ1Y3Rpb24uaW5oZXJpdEJpbmRpbmdDb250ZXh0ID0gdHJ1ZTtcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgcmV0dXJuIEJlaGF2aW9ySW5zdHJ1Y3Rpb247XG59KCk7XG5cbnZhciBiaVByb3RvID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5wcm90b3R5cGU7XG5iaVByb3RvLmluaXRpYXRlZEJ5QmVoYXZpb3IgPSBmYWxzZTtcbmJpUHJvdG8uZW5oYW5jZSA9IGZhbHNlO1xuYmlQcm90by5wYXJ0UmVwbGFjZW1lbnRzID0gbnVsbDtcbmJpUHJvdG8udmlld0ZhY3RvcnkgPSBudWxsO1xuYmlQcm90by5vcmlnaW5hbEF0dHJOYW1lID0gbnVsbDtcbmJpUHJvdG8uc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gZmFsc2U7XG5iaVByb3RvLmNvbnRlbnRGYWN0b3J5ID0gbnVsbDtcbmJpUHJvdG8udmlld01vZGVsID0gbnVsbDtcbmJpUHJvdG8uYW5jaG9ySXNDb250YWluZXIgPSBmYWxzZTtcbmJpUHJvdG8uaG9zdCA9IG51bGw7XG5iaVByb3RvLmF0dHJpYnV0ZXMgPSBudWxsO1xuYmlQcm90by50eXBlID0gbnVsbDtcbmJpUHJvdG8uYXR0ck5hbWUgPSBudWxsO1xuYmlQcm90by5pbmhlcml0QmluZGluZ0NvbnRleHQgPSBmYWxzZTtcblxuQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWwgPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xuXG5leHBvcnQgdmFyIFRhcmdldEluc3RydWN0aW9uID0gKF90ZW1wMiA9IF9jbGFzczIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFRhcmdldEluc3RydWN0aW9uKCkge1xuICAgIFxuICB9XG5cbiAgVGFyZ2V0SW5zdHJ1Y3Rpb24uc2hhZG93U2xvdCA9IGZ1bmN0aW9uIHNoYWRvd1Nsb3QocGFyZW50SW5qZWN0b3JJZCkge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xuICAgIGluc3RydWN0aW9uLnNoYWRvd1Nsb3QgPSB0cnVlO1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBUYXJnZXRJbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGNvbnRlbnRFeHByZXNzaW9uKGV4cHJlc3Npb24pIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcbiAgICBpbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFRhcmdldEluc3RydWN0aW9uLmxldEVsZW1lbnQgPSBmdW5jdGlvbiBsZXRFbGVtZW50KGV4cHJlc3Npb25zKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBleHByZXNzaW9ucztcbiAgICBpbnN0cnVjdGlvbi5sZXRFbGVtZW50ID0gdHJ1ZTtcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgVGFyZ2V0SW5zdHJ1Y3Rpb24ubGlmdGluZyA9IGZ1bmN0aW9uIGxpZnRpbmcocGFyZW50SW5qZWN0b3JJZCwgbGlmdGluZ0luc3RydWN0aW9uKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZCA9IHBhcmVudEluamVjdG9ySWQ7XG4gICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBUYXJnZXRJbnN0cnVjdGlvbi5ub0V4cHJlc3Npb25zO1xuICAgIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gW2xpZnRpbmdJbnN0cnVjdGlvbl07XG4gICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSBsaWZ0aW5nSW5zdHJ1Y3Rpb24udmlld0ZhY3Rvcnk7XG4gICAgaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzID0gW2xpZnRpbmdJbnN0cnVjdGlvbi50eXBlLnRhcmdldF07XG4gICAgaW5zdHJ1Y3Rpb24ubGlmdGluZyA9IHRydWU7XG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFRhcmdldEluc3RydWN0aW9uLm5vcm1hbCA9IGZ1bmN0aW9uIG5vcm1hbChpbmplY3RvcklkLCBwYXJlbnRJbmplY3RvcklkLCBwcm92aWRlcnMsIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLCBleHByZXNzaW9ucywgZWxlbWVudEluc3RydWN0aW9uKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XG4gICAgaW5zdHJ1Y3Rpb24uaW5qZWN0b3JJZCA9IGluamVjdG9ySWQ7XG4gICAgaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZCA9IHBhcmVudEluamVjdG9ySWQ7XG4gICAgaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzID0gcHJvdmlkZXJzO1xuICAgIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gYmVoYXZpb3JJbnN0cnVjdGlvbnM7XG4gICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBleHByZXNzaW9ucztcbiAgICBpbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lciA9IGVsZW1lbnRJbnN0cnVjdGlvbiA/IGVsZW1lbnRJbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lciA6IHRydWU7XG4gICAgaW5zdHJ1Y3Rpb24uZWxlbWVudEluc3RydWN0aW9uID0gZWxlbWVudEluc3RydWN0aW9uO1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICBUYXJnZXRJbnN0cnVjdGlvbi5zdXJyb2dhdGUgPSBmdW5jdGlvbiBzdXJyb2dhdGUocHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIHZhbHVlcykge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xuICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gZXhwcmVzc2lvbnM7XG4gICAgaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBiZWhhdmlvckluc3RydWN0aW9ucztcbiAgICBpbnN0cnVjdGlvbi5wcm92aWRlcnMgPSBwcm92aWRlcnM7XG4gICAgaW5zdHJ1Y3Rpb24udmFsdWVzID0gdmFsdWVzO1xuICAgIHJldHVybiBpbnN0cnVjdGlvbjtcbiAgfTtcblxuICByZXR1cm4gVGFyZ2V0SW5zdHJ1Y3Rpb247XG59KCksIF9jbGFzczIubm9FeHByZXNzaW9ucyA9IE9iamVjdC5mcmVlemUoW10pLCBfdGVtcDIpO1xuXG52YXIgdGlQcm90byA9IFRhcmdldEluc3RydWN0aW9uLnByb3RvdHlwZTtcblxudGlQcm90by5pbmplY3RvcklkID0gbnVsbDtcbnRpUHJvdG8ucGFyZW50SW5qZWN0b3JJZCA9IG51bGw7XG5cbnRpUHJvdG8uc2hhZG93U2xvdCA9IGZhbHNlO1xudGlQcm90by5zbG90TmFtZSA9IG51bGw7XG50aVByb3RvLnNsb3RGYWxsYmFja0ZhY3RvcnkgPSBudWxsO1xuXG50aVByb3RvLmNvbnRlbnRFeHByZXNzaW9uID0gbnVsbDtcbnRpUHJvdG8ubGV0RWxlbWVudCA9IGZhbHNlO1xuXG50aVByb3RvLmV4cHJlc3Npb25zID0gbnVsbDtcbnRpUHJvdG8uZXhwcmVzc2lvbnMgPSBudWxsO1xudGlQcm90by5wcm92aWRlcnMgPSBudWxsO1xuXG50aVByb3RvLnZpZXdGYWN0b3J5ID0gbnVsbDtcblxudGlQcm90by5hbmNob3JJc0NvbnRhaW5lciA9IGZhbHNlO1xudGlQcm90by5lbGVtZW50SW5zdHJ1Y3Rpb24gPSBudWxsO1xudGlQcm90by5saWZ0aW5nID0gZmFsc2U7XG5cbnRpUHJvdG8udmFsdWVzID0gbnVsbDtcblxuZXhwb3J0IHZhciB2aWV3U3RyYXRlZ3kgPSBwcm90b2NvbC5jcmVhdGUoJ2F1cmVsaWE6dmlldy1zdHJhdGVneScsIHtcbiAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKHRhcmdldCkge1xuICAgIGlmICghKHR5cGVvZiB0YXJnZXQubG9hZFZpZXdGYWN0b3J5ID09PSAnZnVuY3Rpb24nKSkge1xuICAgICAgcmV0dXJuICdWaWV3IHN0cmF0ZWdpZXMgbXVzdCBpbXBsZW1lbnQ6IGxvYWRWaWV3RmFjdG9yeSh2aWV3RW5naW5lOiBWaWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb246IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0PzogUmVzb3VyY2VMb2FkQ29udGV4dCk6IFByb21pc2U8Vmlld0ZhY3Rvcnk+JztcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcbiAgY29tcG9zZTogZnVuY3Rpb24gY29tcG9zZSh0YXJnZXQpIHtcbiAgICBpZiAoISh0eXBlb2YgdGFyZ2V0Lm1ha2VSZWxhdGl2ZVRvID09PSAnZnVuY3Rpb24nKSkge1xuICAgICAgdGFyZ2V0Lm1ha2VSZWxhdGl2ZVRvID0gUExBVEZPUk0ubm9vcDtcbiAgICB9XG4gIH1cbn0pO1xuXG5leHBvcnQgdmFyIFJlbGF0aXZlVmlld1N0cmF0ZWd5ID0gKF9kZWMgPSB2aWV3U3RyYXRlZ3koKSwgX2RlYyhfY2xhc3MzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBSZWxhdGl2ZVZpZXdTdHJhdGVneShwYXRoKSB7XG4gICAgXG5cbiAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gbnVsbDtcbiAgfVxuXG4gIFJlbGF0aXZlVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XG4gICAgaWYgKHRoaXMuYWJzb2x1dGVQYXRoID09PSBudWxsICYmIHRoaXMubW9kdWxlSWQpIHtcbiAgICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gcmVsYXRpdmVUb0ZpbGUodGhpcy5wYXRoLCB0aGlzLm1vZHVsZUlkKTtcbiAgICB9XG5cbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcbiAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkodGhpcy5hYnNvbHV0ZVBhdGggfHwgdGhpcy5wYXRoLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xuICB9O1xuXG4gIFJlbGF0aXZlVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5tYWtlUmVsYXRpdmVUbyA9IGZ1bmN0aW9uIG1ha2VSZWxhdGl2ZVRvKGZpbGUpIHtcbiAgICBpZiAodGhpcy5hYnNvbHV0ZVBhdGggPT09IG51bGwpIHtcbiAgICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gcmVsYXRpdmVUb0ZpbGUodGhpcy5wYXRoLCBmaWxlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFJlbGF0aXZlVmlld1N0cmF0ZWd5O1xufSgpKSB8fCBfY2xhc3MzKTtcblxuZXhwb3J0IHZhciBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kgPSAoX2RlYzIgPSB2aWV3U3RyYXRlZ3koKSwgX2RlYzIoX2NsYXNzNCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5KHZpZXdMb2NhdG9yLCBvcmlnaW4pIHtcbiAgICBcblxuICAgIHRoaXMubW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XG4gICAgdGhpcy52aWV3VXJsID0gdmlld0xvY2F0b3IuY29udmVydE9yaWdpblRvVmlld1VybChvcmlnaW4pO1xuICB9XG5cbiAgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XG4gICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XG4gICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KHRoaXMudmlld1VybCwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcbiAgfTtcblxuICByZXR1cm4gQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5O1xufSgpKSB8fCBfY2xhc3M0KTtcblxuZXhwb3J0IHZhciBOb1ZpZXdTdHJhdGVneSA9IChfZGVjMyA9IHZpZXdTdHJhdGVneSgpLCBfZGVjMyhfY2xhc3M1ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBOb1ZpZXdTdHJhdGVneShkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XG4gICAgXG5cbiAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcyB8fCBudWxsO1xuICAgIHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwgPSBkZXBlbmRlbmN5QmFzZVVybCB8fCAnJztcbiAgfVxuXG4gIE5vVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XG4gICAgdmFyIGVudHJ5ID0gdGhpcy5lbnRyeTtcbiAgICB2YXIgZGVwZW5kZW5jaWVzID0gdGhpcy5kZXBlbmRlbmNpZXM7XG5cbiAgICBpZiAoZW50cnkgJiYgZW50cnkuZmFjdG9yeUlzUmVhZHkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuXG4gICAgdGhpcy5lbnRyeSA9IGVudHJ5ID0gbmV3IFRlbXBsYXRlUmVnaXN0cnlFbnRyeSh0aGlzLm1vZHVsZUlkIHx8IHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwpO1xuXG4gICAgZW50cnkuZGVwZW5kZW5jaWVzID0gW107XG4gICAgZW50cnkudGVtcGxhdGVJc0xvYWRlZCA9IHRydWU7XG5cbiAgICBpZiAoZGVwZW5kZW5jaWVzICE9PSBudWxsKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkZXBlbmRlbmNpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICB2YXIgY3VycmVudCA9IGRlcGVuZGVuY2llc1tpXTtcblxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBjdXJyZW50ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbnRyeS5hZGREZXBlbmRlbmN5KGN1cnJlbnQuZnJvbSwgY3VycmVudC5hcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcblxuICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeShlbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcbiAgfTtcblxuICByZXR1cm4gTm9WaWV3U3RyYXRlZ3k7XG59KCkpIHx8IF9jbGFzczUpO1xuXG5leHBvcnQgdmFyIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kgPSAoX2RlYzQgPSB2aWV3U3RyYXRlZ3koKSwgX2RlYzQoX2NsYXNzNiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneShtb2R1bGVJZCwgZW50cnkpIHtcbiAgICBcblxuICAgIHRoaXMubW9kdWxlSWQgPSBtb2R1bGVJZDtcbiAgICB0aGlzLmVudHJ5ID0gZW50cnk7XG4gIH1cblxuICBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XG4gICAgdmFyIGVudHJ5ID0gdGhpcy5lbnRyeTtcblxuICAgIGlmIChlbnRyeS5mYWN0b3J5SXNSZWFkeSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShlbnRyeS5mYWN0b3J5KTtcbiAgICB9XG5cbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcbiAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkoZW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCk7XG4gIH07XG5cbiAgcmV0dXJuIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3k7XG59KCkpIHx8IF9jbGFzczYpO1xuXG5leHBvcnQgdmFyIElubGluZVZpZXdTdHJhdGVneSA9IChfZGVjNSA9IHZpZXdTdHJhdGVneSgpLCBfZGVjNShfY2xhc3M3ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBJbmxpbmVWaWV3U3RyYXRlZ3kobWFya3VwLCBkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XG4gICAgXG5cbiAgICB0aGlzLm1hcmt1cCA9IG1hcmt1cDtcbiAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcyB8fCBudWxsO1xuICAgIHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwgPSBkZXBlbmRlbmN5QmFzZVVybCB8fCAnJztcbiAgfVxuXG4gIElubGluZVZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gbG9hZFZpZXdGYWN0b3J5KHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xuICAgIHZhciBlbnRyeSA9IHRoaXMuZW50cnk7XG4gICAgdmFyIGRlcGVuZGVuY2llcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xuXG4gICAgaWYgKGVudHJ5ICYmIGVudHJ5LmZhY3RvcnlJc1JlYWR5KSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVudHJ5LmZhY3RvcnkpO1xuICAgIH1cblxuICAgIHRoaXMuZW50cnkgPSBlbnRyeSA9IG5ldyBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkodGhpcy5tb2R1bGVJZCB8fCB0aGlzLmRlcGVuZGVuY3lCYXNlVXJsKTtcbiAgICBlbnRyeS50ZW1wbGF0ZSA9IERPTS5jcmVhdGVUZW1wbGF0ZUZyb21NYXJrdXAodGhpcy5tYXJrdXApO1xuXG4gICAgaWYgKGRlcGVuZGVuY2llcyAhPT0gbnVsbCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZGVwZW5kZW5jaWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBkZXBlbmRlbmNpZXNbaV07XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgY3VycmVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGVudHJ5LmFkZERlcGVuZGVuY3koY3VycmVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50LmZyb20sIGN1cnJlbnQuYXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XG4gICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KGVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xuICB9O1xuXG4gIHJldHVybiBJbmxpbmVWaWV3U3RyYXRlZ3k7XG59KCkpIHx8IF9jbGFzczcpO1xuXG5leHBvcnQgdmFyIFN0YXRpY1ZpZXdTdHJhdGVneSA9IChfZGVjNiA9IHZpZXdTdHJhdGVneSgpLCBfZGVjNihfY2xhc3M4ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTdGF0aWNWaWV3U3RyYXRlZ3koY29uZmlnKSB7XG4gICAgXG5cbiAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycgfHwgY29uZmlnIGluc3RhbmNlb2YgRE9NLkVsZW1lbnQgJiYgY29uZmlnLnRhZ05hbWUgPT09ICdURU1QTEFURScpIHtcbiAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgdGVtcGxhdGU6IGNvbmZpZ1xuICAgICAgfTtcbiAgICB9XG4gICAgdGhpcy50ZW1wbGF0ZSA9IGNvbmZpZy50ZW1wbGF0ZTtcbiAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGNvbmZpZy5kZXBlbmRlbmNpZXMgfHwgW107XG4gICAgdGhpcy5mYWN0b3J5SXNSZWFkeSA9IGZhbHNlO1xuICAgIHRoaXMub25SZWFkeSA9IG51bGw7XG4gICAgdGhpcy5tb2R1bGVJZCA9ICd1bmRlZmluZWQnO1xuICB9XG5cbiAgU3RhdGljVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICBpZiAodGhpcy5mYWN0b3J5SXNSZWFkeSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmZhY3RvcnkpO1xuICAgIH1cbiAgICB2YXIgZGVwcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xuICAgIGRlcHMgPSB0eXBlb2YgZGVwcyA9PT0gJ2Z1bmN0aW9uJyA/IGRlcHMoKSA6IGRlcHM7XG4gICAgZGVwcyA9IGRlcHMgPyBkZXBzIDogW107XG4gICAgZGVwcyA9IEFycmF5LmlzQXJyYXkoZGVwcykgPyBkZXBzIDogW2RlcHNdO1xuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGRlcHMpLnRoZW4oZnVuY3Rpb24gKGRlcGVuZGVuY2llcykge1xuICAgICAgdmFyIGNvbnRhaW5lciA9IHZpZXdFbmdpbmUuY29udGFpbmVyO1xuICAgICAgdmFyIGFwcFJlc291cmNlcyA9IHZpZXdFbmdpbmUuYXBwUmVzb3VyY2VzO1xuICAgICAgdmFyIHZpZXdDb21waWxlciA9IHZpZXdFbmdpbmUudmlld0NvbXBpbGVyO1xuICAgICAgdmFyIHZpZXdSZXNvdXJjZXMgPSBuZXcgVmlld1Jlc291cmNlcyhhcHBSZXNvdXJjZXMpO1xuXG4gICAgICB2YXIgcmVzb3VyY2UgPSB2b2lkIDA7XG4gICAgICB2YXIgZWxEZXBzID0gW107XG5cbiAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgdmlld1Jlc291cmNlcy5hdXRvUmVnaXN0ZXIoY29udGFpbmVyLCB0YXJnZXQpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSBkZXBlbmRlbmNpZXMsIF9pc0FycmF5ID0gQXJyYXkuaXNBcnJheShfaXRlcmF0b3IpLCBfaSA9IDAsIF9pdGVyYXRvciA9IF9pc0FycmF5ID8gX2l0ZXJhdG9yIDogX2l0ZXJhdG9yW1N5bWJvbC5pdGVyYXRvcl0oKTs7KSB7XG4gICAgICAgIHZhciBfcmVmO1xuXG4gICAgICAgIGlmIChfaXNBcnJheSkge1xuICAgICAgICAgIGlmIChfaSA+PSBfaXRlcmF0b3IubGVuZ3RoKSBicmVhaztcbiAgICAgICAgICBfcmVmID0gX2l0ZXJhdG9yW19pKytdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF9pID0gX2l0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICBpZiAoX2kuZG9uZSkgYnJlYWs7XG4gICAgICAgICAgX3JlZiA9IF9pLnZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGRlcCA9IF9yZWY7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBkZXAgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXNvdXJjZSA9IHZpZXdSZXNvdXJjZXMuYXV0b1JlZ2lzdGVyKGNvbnRhaW5lciwgZGVwKTtcbiAgICAgICAgICBpZiAocmVzb3VyY2UuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGVsRGVwcy5wdXNoKHJlc291cmNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZGVwICYmICh0eXBlb2YgZGVwID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihkZXApKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICBmb3IgKHZhciBfa2V5MiBpbiBkZXApIHtcbiAgICAgICAgICAgIHZhciBleHBvcnRlZCA9IGRlcFtfa2V5Ml07XG4gICAgICAgICAgICBpZiAodHlwZW9mIGV4cG9ydGVkID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgIHJlc291cmNlID0gdmlld1Jlc291cmNlcy5hdXRvUmVnaXN0ZXIoY29udGFpbmVyLCBleHBvcnRlZCk7XG4gICAgICAgICAgICAgIGlmIChyZXNvdXJjZS5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGVsRGVwcy5wdXNoKHJlc291cmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RlcGVuZGVuY3kgbmVpdGhlciBmdW5jdGlvbiBub3Igb2JqZWN0LiBSZWNlaXZlZDogXCInICsgKHR5cGVvZiBkZXAgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGRlcCkpICsgJ1wiJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGVsRGVwcy5tYXAoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBlbC5sb2FkKGNvbnRhaW5lciwgZWwudGFyZ2V0KTtcbiAgICAgIH0pKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGZhY3RvcnkgPSBfdGhpczIudGVtcGxhdGUgIT09IG51bGwgPyB2aWV3Q29tcGlsZXIuY29tcGlsZShfdGhpczIudGVtcGxhdGUsIHZpZXdSZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbikgOiBudWxsO1xuICAgICAgICBfdGhpczIuZmFjdG9yeUlzUmVhZHkgPSB0cnVlO1xuICAgICAgICBfdGhpczIuZmFjdG9yeSA9IGZhY3Rvcnk7XG4gICAgICAgIHJldHVybiBmYWN0b3J5O1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIFN0YXRpY1ZpZXdTdHJhdGVneTtcbn0oKSkgfHwgX2NsYXNzOCk7XG5cbmV4cG9ydCB2YXIgVmlld0xvY2F0b3IgPSAoX3RlbXAzID0gX2NsYXNzOSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVmlld0xvY2F0b3IoKSB7XG4gICAgXG4gIH1cblxuICBWaWV3TG9jYXRvci5wcm90b3R5cGUuZ2V0Vmlld1N0cmF0ZWd5ID0gZnVuY3Rpb24gZ2V0Vmlld1N0cmF0ZWd5KHZhbHVlKSB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHZhbHVlKSkgPT09ICdvYmplY3QnICYmICdnZXRWaWV3U3RyYXRlZ3knIGluIHZhbHVlKSB7XG4gICAgICB2YXIgX29yaWdpbiA9IE9yaWdpbi5nZXQodmFsdWUuY29uc3RydWN0b3IpO1xuXG4gICAgICB2YWx1ZSA9IHZhbHVlLmdldFZpZXdTdHJhdGVneSgpO1xuXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICB2YWx1ZSA9IG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneSh2YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHZpZXdTdHJhdGVneS5hc3NlcnQodmFsdWUpO1xuXG4gICAgICBpZiAoX29yaWdpbi5tb2R1bGVJZCkge1xuICAgICAgICB2YWx1ZS5tYWtlUmVsYXRpdmVUbyhfb3JpZ2luLm1vZHVsZUlkKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2YWx1ZSA9IG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHZpZXdTdHJhdGVneS52YWxpZGF0ZSh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB2YWx1ZSA9IHZhbHVlLmNvbnN0cnVjdG9yO1xuICAgIH1cblxuICAgIGlmICgnJHZpZXcnIGluIHZhbHVlKSB7XG4gICAgICB2YXIgYyA9IHZhbHVlLiR2aWV3O1xuICAgICAgdmFyIF92aWV3ID0gdm9pZCAwO1xuICAgICAgYyA9IHR5cGVvZiBjID09PSAnZnVuY3Rpb24nID8gYy5jYWxsKHZhbHVlKSA6IGM7XG4gICAgICBpZiAoYyA9PT0gbnVsbCkge1xuICAgICAgICBfdmlldyA9IG5ldyBOb1ZpZXdTdHJhdGVneSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3ZpZXcgPSBjIGluc3RhbmNlb2YgU3RhdGljVmlld1N0cmF0ZWd5ID8gYyA6IG5ldyBTdGF0aWNWaWV3U3RyYXRlZ3koYyk7XG4gICAgICB9XG4gICAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIF92aWV3LCB2YWx1ZSk7XG4gICAgICByZXR1cm4gX3ZpZXc7XG4gICAgfVxuXG4gICAgdmFyIG9yaWdpbiA9IE9yaWdpbi5nZXQodmFsdWUpO1xuICAgIHZhciBzdHJhdGVneSA9IG1ldGFkYXRhLmdldChWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSwgdmFsdWUpO1xuXG4gICAgaWYgKCFzdHJhdGVneSkge1xuICAgICAgaWYgKCFvcmlnaW4ubW9kdWxlSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZGV0ZXJtaW5lIGRlZmF1bHQgdmlldyBzdHJhdGVneSBmb3Igb2JqZWN0LicsIHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgc3RyYXRlZ3kgPSB0aGlzLmNyZWF0ZUZhbGxiYWNrVmlld1N0cmF0ZWd5KG9yaWdpbik7XG4gICAgfSBlbHNlIGlmIChvcmlnaW4ubW9kdWxlSWQpIHtcbiAgICAgIHN0cmF0ZWd5Lm1vZHVsZUlkID0gb3JpZ2luLm1vZHVsZUlkO1xuICAgIH1cblxuICAgIHJldHVybiBzdHJhdGVneTtcbiAgfTtcblxuICBWaWV3TG9jYXRvci5wcm90b3R5cGUuY3JlYXRlRmFsbGJhY2tWaWV3U3RyYXRlZ3kgPSBmdW5jdGlvbiBjcmVhdGVGYWxsYmFja1ZpZXdTdHJhdGVneShvcmlnaW4pIHtcbiAgICByZXR1cm4gbmV3IENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSh0aGlzLCBvcmlnaW4pO1xuICB9O1xuXG4gIFZpZXdMb2NhdG9yLnByb3RvdHlwZS5jb252ZXJ0T3JpZ2luVG9WaWV3VXJsID0gZnVuY3Rpb24gY29udmVydE9yaWdpblRvVmlld1VybChvcmlnaW4pIHtcbiAgICB2YXIgbW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XG4gICAgdmFyIGlkID0gbW9kdWxlSWQuZW5kc1dpdGgoJy5qcycpIHx8IG1vZHVsZUlkLmVuZHNXaXRoKCcudHMnKSA/IG1vZHVsZUlkLnN1YnN0cmluZygwLCBtb2R1bGVJZC5sZW5ndGggLSAzKSA6IG1vZHVsZUlkO1xuICAgIHJldHVybiBpZCArICcuaHRtbCc7XG4gIH07XG5cbiAgcmV0dXJuIFZpZXdMb2NhdG9yO1xufSgpLCBfY2xhc3M5LnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5ID0gJ2F1cmVsaWE6dmlldy1zdHJhdGVneScsIF90ZW1wMyk7XG5cbmZ1bmN0aW9uIG1pKG5hbWUpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdCaW5kaW5nTGFuZ3VhZ2UgbXVzdCBpbXBsZW1lbnQgJyArIG5hbWUgKyAnKCkuJyk7XG59XG5cbmV4cG9ydCB2YXIgQmluZGluZ0xhbmd1YWdlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kaW5nTGFuZ3VhZ2UoKSB7XG4gICAgXG4gIH1cblxuICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmluc3BlY3RBdHRyaWJ1dGUgPSBmdW5jdGlvbiBpbnNwZWN0QXR0cmlidXRlKHJlc291cmNlcywgZWxlbWVudE5hbWUsIGF0dHJOYW1lLCBhdHRyVmFsdWUpIHtcbiAgICBtaSgnaW5zcGVjdEF0dHJpYnV0ZScpO1xuICB9O1xuXG4gIEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbiBjcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24pIHtcbiAgICBtaSgnY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24nKTtcbiAgfTtcblxuICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUxldEV4cHJlc3Npb25zID0gZnVuY3Rpb24gY3JlYXRlTGV0RXhwcmVzc2lvbnMocmVzb3VyY2VzLCBlbGVtZW50KSB7XG4gICAgbWkoJ2NyZWF0ZUxldEV4cHJlc3Npb25zJyk7XG4gIH07XG5cbiAgQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5pbnNwZWN0VGV4dENvbnRlbnQgPSBmdW5jdGlvbiBpbnNwZWN0VGV4dENvbnRlbnQocmVzb3VyY2VzLCB2YWx1ZSkge1xuICAgIG1pKCdpbnNwZWN0VGV4dENvbnRlbnQnKTtcbiAgfTtcblxuICByZXR1cm4gQmluZGluZ0xhbmd1YWdlO1xufSgpO1xuXG52YXIgbm9Ob2RlcyA9IE9iamVjdC5mcmVlemUoW10pO1xuXG5leHBvcnQgdmFyIFNsb3RDdXN0b21BdHRyaWJ1dGUgPSBmdW5jdGlvbiAoKSB7XG4gIFNsb3RDdXN0b21BdHRyaWJ1dGUuaW5qZWN0ID0gZnVuY3Rpb24gaW5qZWN0KCkge1xuICAgIHJldHVybiBbRE9NLkVsZW1lbnRdO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFNsb3RDdXN0b21BdHRyaWJ1dGUoZWxlbWVudCkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmVsZW1lbnQuYXVTbG90QXR0cmlidXRlID0gdGhpcztcbiAgfVxuXG4gIFNsb3RDdXN0b21BdHRyaWJ1dGUucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIHZhbHVlQ2hhbmdlZChuZXdWYWx1ZSwgb2xkVmFsdWUpIHt9O1xuXG4gIHJldHVybiBTbG90Q3VzdG9tQXR0cmlidXRlO1xufSgpO1xuXG5leHBvcnQgdmFyIFBhc3NUaHJvdWdoU2xvdCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUGFzc1Rocm91Z2hTbG90KGFuY2hvciwgbmFtZSwgZGVzdGluYXRpb25OYW1lLCBmYWxsYmFja0ZhY3RvcnkpIHtcbiAgICBcblxuICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xuICAgIHRoaXMuYW5jaG9yLnZpZXdTbG90ID0gdGhpcztcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuZGVzdGluYXRpb25OYW1lID0gZGVzdGluYXRpb25OYW1lO1xuICAgIHRoaXMuZmFsbGJhY2tGYWN0b3J5ID0gZmFsbGJhY2tGYWN0b3J5O1xuICAgIHRoaXMuZGVzdGluYXRpb25TbG90ID0gbnVsbDtcblxuICAgIHRoaXMucHJvamVjdGlvbnMgPSAwO1xuXG4gICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XG5cbiAgICB2YXIgYXR0ciA9IG5ldyBTbG90Q3VzdG9tQXR0cmlidXRlKHRoaXMuYW5jaG9yKTtcbiAgICBhdHRyLnZhbHVlID0gdGhpcy5kZXN0aW5hdGlvbk5hbWU7XG4gIH1cblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnJlbmRlckZhbGxiYWNrQ29udGVudCA9IGZ1bmN0aW9uIHJlbmRlckZhbGxiYWNrQ29udGVudCh2aWV3LCBub2RlcywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50VmlldyA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5jb250ZW50VmlldyA9IHRoaXMuZmFsbGJhY2tGYWN0b3J5LmNyZWF0ZSh0aGlzLm93bmVyVmlldy5jb250YWluZXIpO1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHRoaXMub3duZXJWaWV3LmJpbmRpbmdDb250ZXh0LCB0aGlzLm93bmVyVmlldy5vdmVycmlkZUNvbnRleHQpO1xuXG4gICAgICB2YXIgc2xvdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgc2xvdHNbdGhpcy5kZXN0aW5hdGlvblNsb3QubmFtZV0gPSB0aGlzLmRlc3RpbmF0aW9uU2xvdDtcblxuICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHRoaXMuY29udGVudFZpZXcsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgdGhpcy5kZXN0aW5hdGlvblNsb3QubmFtZSk7XG4gICAgfVxuICB9O1xuXG4gIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucGFzc1Rocm91Z2hUbyA9IGZ1bmN0aW9uIHBhc3NUaHJvdWdoVG8oZGVzdGluYXRpb25TbG90KSB7XG4gICAgdGhpcy5kZXN0aW5hdGlvblNsb3QgPSBkZXN0aW5hdGlvblNsb3Q7XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5hZGROb2RlID0gZnVuY3Rpb24gYWRkTm9kZSh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xuICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ICE9PSBudWxsKSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LnJlbW92ZU5vZGVzKCk7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LmRldGFjaGVkKCk7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LnVuYmluZCgpO1xuICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKG5vZGUudmlld1Nsb3QgaW5zdGFuY2VvZiBQYXNzVGhyb3VnaFNsb3QpIHtcbiAgICAgIG5vZGUudmlld1Nsb3QucGFzc1Rocm91Z2hUbyh0aGlzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnByb2plY3Rpb25zKys7XG4gICAgdGhpcy5kZXN0aW5hdGlvblNsb3QuYWRkTm9kZSh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5yZW1vdmVWaWV3ID0gZnVuY3Rpb24gcmVtb3ZlVmlldyh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XG4gICAgdGhpcy5wcm9qZWN0aW9ucy0tO1xuICAgIHRoaXMuZGVzdGluYXRpb25TbG90LnJlbW92ZVZpZXcodmlldywgcHJvamVjdGlvblNvdXJjZSk7XG5cbiAgICBpZiAodGhpcy5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XG4gICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudChudWxsLCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcbiAgICB9XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiByZW1vdmVBbGwocHJvamVjdGlvblNvdXJjZSkge1xuICAgIHRoaXMucHJvamVjdGlvbnMgPSAwO1xuICAgIHRoaXMuZGVzdGluYXRpb25TbG90LnJlbW92ZUFsbChwcm9qZWN0aW9uU291cmNlKTtcblxuICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcbiAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KG51bGwsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xuICAgIH1cbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnByb2plY3RGcm9tID0gZnVuY3Rpb24gcHJvamVjdEZyb20odmlldywgcHJvamVjdGlvblNvdXJjZSkge1xuICAgIHRoaXMuZGVzdGluYXRpb25TbG90LnByb2plY3RGcm9tKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpO1xuICB9O1xuXG4gIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uIGNyZWF0ZWQob3duZXJWaWV3KSB7XG4gICAgdGhpcy5vd25lclZpZXcgPSBvd25lclZpZXc7XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZCh2aWV3KSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh2aWV3LmJpbmRpbmdDb250ZXh0LCB2aWV3Lm92ZXJyaWRlQ29udGV4dCk7XG4gICAgfVxuICB9O1xuXG4gIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiBhdHRhY2hlZCgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5hdHRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gZGV0YWNoZWQoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcbiAgICB9XG4gIH07XG5cbiAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XG4gICAgfVxuICB9O1xuXG4gIF9jcmVhdGVDbGFzcyhQYXNzVGhyb3VnaFNsb3QsIFt7XG4gICAga2V5OiAnbmVlZHNGYWxsYmFja1JlbmRlcmluZycsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5mYWxsYmFja0ZhY3RvcnkgJiYgdGhpcy5wcm9qZWN0aW9ucyA9PT0gMDtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gUGFzc1Rocm91Z2hTbG90O1xufSgpO1xuXG5leHBvcnQgdmFyIFNoYWRvd1Nsb3QgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNoYWRvd1Nsb3QoYW5jaG9yLCBuYW1lLCBmYWxsYmFja0ZhY3RvcnkpIHtcbiAgICBcblxuICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xuICAgIHRoaXMuYW5jaG9yLmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UgPSB0cnVlO1xuICAgIHRoaXMuYW5jaG9yLnZpZXdTbG90ID0gdGhpcztcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuZmFsbGJhY2tGYWN0b3J5ID0gZmFsbGJhY2tGYWN0b3J5O1xuICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xuICAgIHRoaXMucHJvamVjdGlvbnMgPSAwO1xuXG4gICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuICAgIHRoaXMucHJvamVjdEZyb21BbmNob3JzID0gbnVsbDtcbiAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdHMgPSBudWxsO1xuICB9XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUuYWRkTm9kZSA9IGZ1bmN0aW9uIGFkZE5vZGUodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uKSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcucmVtb3ZlTm9kZXMoKTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAobm9kZS52aWV3U2xvdCBpbnN0YW5jZW9mIFBhc3NUaHJvdWdoU2xvdCkge1xuICAgICAgbm9kZS52aWV3U2xvdC5wYXNzVGhyb3VnaFRvKHRoaXMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU2xvdHMgIT09IG51bGwpIHtcbiAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXModmlldywgW25vZGVdLCB0aGlzLmRlc3RpbmF0aW9uU2xvdHMsIHRoaXMsIGluZGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZS5hdU93bmVyVmlldyA9IHZpZXc7XG4gICAgICBub2RlLmF1UHJvamVjdGlvblNvdXJjZSA9IHByb2plY3Rpb25Tb3VyY2U7XG4gICAgICBub2RlLmF1QXNzaWduZWRTbG90ID0gdGhpcztcblxuICAgICAgdmFyIGFuY2hvciA9IHRoaXMuX2ZpbmRBbmNob3Iodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xuICAgICAgdmFyIHBhcmVudCA9IGFuY2hvci5wYXJlbnROb2RlO1xuXG4gICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIGFuY2hvcik7XG4gICAgICB0aGlzLmNoaWxkcmVuLnB1c2gobm9kZSk7XG4gICAgICB0aGlzLnByb2plY3Rpb25zKys7XG4gICAgfVxuICB9O1xuXG4gIFNoYWRvd1Nsb3QucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiByZW1vdmVWaWV3KHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcbiAgICBpZiAodGhpcy5kZXN0aW5hdGlvblNsb3RzICE9PSBudWxsKSB7XG4gICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLmRlc3RpbmF0aW9uU2xvdHMsIHRoaXMpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb250ZW50VmlldyAmJiB0aGlzLmNvbnRlbnRWaWV3Lmhhc1Nsb3RzKSB7XG4gICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLmNvbnRlbnRWaWV3LnNsb3RzLCBwcm9qZWN0aW9uU291cmNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGZvdW5kID0gdGhpcy5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiB4LmF1U2xvdFByb2plY3RGcm9tID09PSBwcm9qZWN0aW9uU291cmNlO1xuICAgICAgfSk7XG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgdmFyIF9jaGlsZHJlbiA9IGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuO1xuICAgICAgICB2YXIgb3duQ2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IF9jaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgdmFyIF9jaGlsZCA9IF9jaGlsZHJlbltpXTtcblxuICAgICAgICAgIGlmIChfY2hpbGQuYXVPd25lclZpZXcgPT09IHZpZXcpIHtcbiAgICAgICAgICAgIF9jaGlsZHJlbi5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB2aWV3LmZyYWdtZW50LmFwcGVuZENoaWxkKF9jaGlsZCk7XG4gICAgICAgICAgICBpLS07aWktLTtcblxuICAgICAgICAgICAgdGhpcy5wcm9qZWN0aW9ucy0tO1xuICAgICAgICAgICAgdmFyIGlkeCA9IG93bkNoaWxkcmVuLmluZGV4T2YoX2NoaWxkKTtcbiAgICAgICAgICAgIGlmIChpZHggPiAtMSkge1xuICAgICAgICAgICAgICBvd25DaGlsZHJlbi5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJGYWxsYmFja0NvbnRlbnQodmlldywgbm9Ob2RlcywgcHJvamVjdGlvblNvdXJjZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUucmVtb3ZlQWxsID0gZnVuY3Rpb24gcmVtb3ZlQWxsKHByb2plY3Rpb25Tb3VyY2UpIHtcbiAgICBpZiAodGhpcy5kZXN0aW5hdGlvblNsb3RzICE9PSBudWxsKSB7XG4gICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlQWxsKHRoaXMuZGVzdGluYXRpb25TbG90cywgdGhpcyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbnRlbnRWaWV3ICYmIHRoaXMuY29udGVudFZpZXcuaGFzU2xvdHMpIHtcbiAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwodGhpcy5jb250ZW50Vmlldy5zbG90cywgcHJvamVjdGlvblNvdXJjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBmb3VuZCA9IHRoaXMuY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoeCkge1xuICAgICAgICByZXR1cm4geC5hdVNsb3RQcm9qZWN0RnJvbSA9PT0gcHJvamVjdGlvblNvdXJjZTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgdmFyIF9jaGlsZHJlbjIgPSBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbjtcbiAgICAgICAgdmFyIG93bkNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcblxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBfY2hpbGRyZW4yLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICB2YXIgX2NoaWxkMiA9IF9jaGlsZHJlbjJbaV07XG4gICAgICAgICAgX2NoaWxkMi5hdU93bmVyVmlldy5mcmFnbWVudC5hcHBlbmRDaGlsZChfY2hpbGQyKTtcblxuICAgICAgICAgIHRoaXMucHJvamVjdGlvbnMtLTtcbiAgICAgICAgICB2YXIgaWR4ID0gb3duQ2hpbGRyZW4uaW5kZXhPZihfY2hpbGQyKTtcbiAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcbiAgICAgICAgICAgIG93bkNoaWxkcmVuLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuID0gW107XG5cbiAgICAgICAgaWYgKHRoaXMubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xuICAgICAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KG51bGwsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIFNoYWRvd1Nsb3QucHJvdG90eXBlLl9maW5kQW5jaG9yID0gZnVuY3Rpb24gX2ZpbmRBbmNob3Iodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpIHtcbiAgICBpZiAocHJvamVjdGlvblNvdXJjZSkge1xuICAgICAgdmFyIGZvdW5kID0gdGhpcy5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiB4LmF1U2xvdFByb2plY3RGcm9tID09PSBwcm9qZWN0aW9uU291cmNlO1xuICAgICAgfSk7XG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgaWYgKGluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2YXIgX2NoaWxkcmVuMyA9IGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuO1xuICAgICAgICAgIHZhciB2aWV3SW5kZXggPSAtMTtcbiAgICAgICAgICB2YXIgbGFzdFZpZXcgPSB2b2lkIDA7XG5cbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBfY2hpbGRyZW4zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gX2NoaWxkcmVuM1tpXTtcblxuICAgICAgICAgICAgaWYgKGN1cnJlbnQuYXVPd25lclZpZXcgIT09IGxhc3RWaWV3KSB7XG4gICAgICAgICAgICAgIHZpZXdJbmRleCsrO1xuICAgICAgICAgICAgICBsYXN0VmlldyA9IGN1cnJlbnQuYXVPd25lclZpZXc7XG5cbiAgICAgICAgICAgICAgaWYgKHZpZXdJbmRleCA+PSBpbmRleCAmJiBsYXN0VmlldyAhPT0gdmlldykge1xuICAgICAgICAgICAgICAgIF9jaGlsZHJlbjMuc3BsaWNlKGksIDAsIG5vZGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW4ucHVzaChub2RlKTtcbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmFuY2hvcjtcbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5wcm9qZWN0VG8gPSBmdW5jdGlvbiBwcm9qZWN0VG8oc2xvdHMpIHtcbiAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdHMgPSBzbG90cztcbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5wcm9qZWN0RnJvbSA9IGZ1bmN0aW9uIHByb2plY3RGcm9tKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcbiAgICB2YXIgYW5jaG9yID0gRE9NLmNyZWF0ZUNvbW1lbnQoJ2FuY2hvcicpO1xuICAgIHZhciBwYXJlbnQgPSB0aGlzLmFuY2hvci5wYXJlbnROb2RlO1xuICAgIGFuY2hvci5hdVNsb3RQcm9qZWN0RnJvbSA9IHByb2plY3Rpb25Tb3VyY2U7XG4gICAgYW5jaG9yLmF1T3duZXJWaWV3ID0gdmlldztcbiAgICBhbmNob3IuYXVQcm9qZWN0aW9uQ2hpbGRyZW4gPSBbXTtcbiAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGFuY2hvciwgdGhpcy5hbmNob3IpO1xuICAgIHRoaXMuY2hpbGRyZW4ucHVzaChhbmNob3IpO1xuXG4gICAgaWYgKHRoaXMucHJvamVjdEZyb21BbmNob3JzID09PSBudWxsKSB7XG4gICAgICB0aGlzLnByb2plY3RGcm9tQW5jaG9ycyA9IFtdO1xuICAgIH1cblxuICAgIHRoaXMucHJvamVjdEZyb21BbmNob3JzLnB1c2goYW5jaG9yKTtcbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5yZW5kZXJGYWxsYmFja0NvbnRlbnQgPSBmdW5jdGlvbiByZW5kZXJGYWxsYmFja0NvbnRlbnQodmlldywgbm9kZXMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XG4gICAgaWYgKHRoaXMuY29udGVudFZpZXcgPT09IG51bGwpIHtcbiAgICAgIHRoaXMuY29udGVudFZpZXcgPSB0aGlzLmZhbGxiYWNrRmFjdG9yeS5jcmVhdGUodGhpcy5vd25lclZpZXcuY29udGFpbmVyKTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh0aGlzLm93bmVyVmlldy5iaW5kaW5nQ29udGV4dCwgdGhpcy5vd25lclZpZXcub3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgIHRoaXMuY29udGVudFZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUodGhpcy5hbmNob3IpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3Lmhhc1Nsb3RzKSB7XG4gICAgICB2YXIgc2xvdHMgPSB0aGlzLmNvbnRlbnRWaWV3LnNsb3RzO1xuICAgICAgdmFyIHByb2plY3RGcm9tQW5jaG9ycyA9IHRoaXMucHJvamVjdEZyb21BbmNob3JzO1xuXG4gICAgICBpZiAocHJvamVjdEZyb21BbmNob3JzICE9PSBudWxsKSB7XG4gICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XG4gICAgICAgICAgdmFyIHNsb3QgPSBzbG90c1tzbG90TmFtZV07XG5cbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBwcm9qZWN0RnJvbUFuY2hvcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgICAgdmFyIGFuY2hvciA9IHByb2plY3RGcm9tQW5jaG9yc1tpXTtcbiAgICAgICAgICAgIHNsb3QucHJvamVjdEZyb20oYW5jaG9yLmF1T3duZXJWaWV3LCBhbmNob3IuYXVTbG90UHJvamVjdEZyb20pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmZhbGxiYWNrU2xvdHMgPSBzbG90cztcbiAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXModmlldywgbm9kZXMsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XG4gICAgfVxuICB9O1xuXG4gIFNoYWRvd1Nsb3QucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiBjcmVhdGVkKG93bmVyVmlldykge1xuICAgIHRoaXMub3duZXJWaWV3ID0gb3duZXJWaWV3O1xuICB9O1xuXG4gIFNoYWRvd1Nsb3QucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHZpZXcpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHZpZXcuYmluZGluZ0NvbnRleHQsIHZpZXcub3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9XG4gIH07XG5cbiAgU2hhZG93U2xvdC5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiBhdHRhY2hlZCgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy5hdHRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBTaGFkb3dTbG90LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uIGRldGFjaGVkKCkge1xuICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3LmRldGFjaGVkKCk7XG4gICAgfVxuICB9O1xuXG4gIFNoYWRvd1Nsb3QucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xuICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcbiAgICB9XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKFNoYWRvd1Nsb3QsIFt7XG4gICAga2V5OiAnbmVlZHNGYWxsYmFja1JlbmRlcmluZycsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5mYWxsYmFja0ZhY3RvcnkgJiYgdGhpcy5wcm9qZWN0aW9ucyA9PT0gMDtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gU2hhZG93U2xvdDtcbn0oKTtcblxuZXhwb3J0IHZhciBTaGFkb3dET00gPSAoX3RlbXA0ID0gX2NsYXNzMTAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNoYWRvd0RPTSgpIHtcbiAgICBcbiAgfVxuXG4gIFNoYWRvd0RPTS5nZXRTbG90TmFtZSA9IGZ1bmN0aW9uIGdldFNsb3ROYW1lKG5vZGUpIHtcbiAgICBpZiAobm9kZS5hdVNsb3RBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIFNoYWRvd0RPTS5kZWZhdWx0U2xvdEtleTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZS5hdVNsb3RBdHRyaWJ1dGUudmFsdWU7XG4gIH07XG5cbiAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3ID0gZnVuY3Rpb24gZGlzdHJpYnV0ZVZpZXcodmlldywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCBkZXN0aW5hdGlvbk92ZXJyaWRlKSB7XG4gICAgdmFyIG5vZGVzID0gdm9pZCAwO1xuXG4gICAgaWYgKHZpZXcgPT09IG51bGwpIHtcbiAgICAgIG5vZGVzID0gbm9Ob2RlcztcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGNoaWxkTm9kZXMgPSB2aWV3LmZyYWdtZW50LmNoaWxkTm9kZXM7XG4gICAgICB2YXIgaWkgPSBjaGlsZE5vZGVzLmxlbmd0aDtcbiAgICAgIG5vZGVzID0gbmV3IEFycmF5KGlpKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIG5vZGVzW2ldID0gY2hpbGROb2Rlc1tpXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzKHZpZXcsIG5vZGVzLCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uT3ZlcnJpZGUpO1xuICB9O1xuXG4gIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3ID0gZnVuY3Rpb24gdW5kaXN0cmlidXRlVmlldyh2aWV3LCBzbG90cywgcHJvamVjdGlvblNvdXJjZSkge1xuICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XG4gICAgICBzbG90c1tzbG90TmFtZV0ucmVtb3ZlVmlldyh2aWV3LCBwcm9qZWN0aW9uU291cmNlKTtcbiAgICB9XG4gIH07XG5cbiAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCA9IGZ1bmN0aW9uIHVuZGlzdHJpYnV0ZUFsbChzbG90cywgcHJvamVjdGlvblNvdXJjZSkge1xuICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XG4gICAgICBzbG90c1tzbG90TmFtZV0ucmVtb3ZlQWxsKHByb2plY3Rpb25Tb3VyY2UpO1xuICAgIH1cbiAgfTtcblxuICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzID0gZnVuY3Rpb24gZGlzdHJpYnV0ZU5vZGVzKHZpZXcsIG5vZGVzLCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uT3ZlcnJpZGUpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBub2Rlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICB2YXIgY3VycmVudE5vZGUgPSBub2Rlc1tpXTtcbiAgICAgIHZhciBub2RlVHlwZSA9IGN1cnJlbnROb2RlLm5vZGVUeXBlO1xuXG4gICAgICBpZiAoY3VycmVudE5vZGUuaXNDb250ZW50UHJvamVjdGlvblNvdXJjZSkge1xuICAgICAgICBjdXJyZW50Tm9kZS52aWV3U2xvdC5wcm9qZWN0VG8oc2xvdHMpO1xuXG4gICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XG4gICAgICAgICAgc2xvdHNbc2xvdE5hbWVdLnByb2plY3RGcm9tKHZpZXcsIGN1cnJlbnROb2RlLnZpZXdTbG90KTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgaWktLTtpLS07XG4gICAgICB9IGVsc2UgaWYgKG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSAzIHx8IGN1cnJlbnROb2RlLnZpZXdTbG90IGluc3RhbmNlb2YgUGFzc1Rocm91Z2hTbG90KSB7XG4gICAgICAgIGlmIChub2RlVHlwZSA9PT0gMyAmJiBfaXNBbGxXaGl0ZXNwYWNlKGN1cnJlbnROb2RlKSkge1xuICAgICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBpaS0tO2ktLTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgZm91bmQgPSBzbG90c1tkZXN0aW5hdGlvbk92ZXJyaWRlIHx8IFNoYWRvd0RPTS5nZXRTbG90TmFtZShjdXJyZW50Tm9kZSldO1xuXG4gICAgICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgICAgICBmb3VuZC5hZGROb2RlKHZpZXcsIGN1cnJlbnROb2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XG4gICAgICAgICAgICBub2Rlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBpaS0tO2ktLTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgaWktLTtpLS07XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yICh2YXIgX3Nsb3ROYW1lIGluIHNsb3RzKSB7XG4gICAgICB2YXIgc2xvdCA9IHNsb3RzW19zbG90TmFtZV07XG5cbiAgICAgIGlmIChzbG90Lm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcbiAgICAgICAgc2xvdC5yZW5kZXJGYWxsYmFja0NvbnRlbnQodmlldywgbm9kZXMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFNoYWRvd0RPTTtcbn0oKSwgX2NsYXNzMTAuZGVmYXVsdFNsb3RLZXkgPSAnX19hdS1kZWZhdWx0LXNsb3Qta2V5X18nLCBfdGVtcDQpO1xuXG5mdW5jdGlvbiByZWdpc3Rlcihsb29rdXAsIG5hbWUsIHJlc291cmNlLCB0eXBlKSB7XG4gIGlmICghbmFtZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBleGlzdGluZyA9IGxvb2t1cFtuYW1lXTtcbiAgaWYgKGV4aXN0aW5nKSB7XG4gICAgaWYgKGV4aXN0aW5nICE9PSByZXNvdXJjZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0ZWQgdG8gcmVnaXN0ZXIgJyArIHR5cGUgKyAnIHdoZW4gb25lIHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cy4gTmFtZTogJyArIG5hbWUgKyAnLicpO1xuICAgIH1cblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvb2t1cFtuYW1lXSA9IHJlc291cmNlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZSwgdHlwZSkge1xuICBpZiAoL1tBLVpdLy50ZXN0KG5hbWUpKSB7XG4gICAgdmFyIG5ld05hbWUgPSBfaHlwaGVuYXRlKG5hbWUpO1xuICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJykud2FybignXFwnJyArIG5hbWUgKyAnXFwnIGlzIG5vdCBhIHZhbGlkICcgKyB0eXBlICsgJyBuYW1lIGFuZCBoYXMgYmVlbiBjb252ZXJ0ZWQgdG8gXFwnJyArIG5ld05hbWUgKyAnXFwnLiBVcHBlci1jYXNlIGxldHRlcnMgYXJlIG5vdCBhbGxvd2VkIGJlY2F1c2UgdGhlIERPTSBpcyBub3QgY2FzZS1zZW5zaXRpdmUuJyk7XG4gICAgcmV0dXJuIG5ld05hbWU7XG4gIH1cbiAgcmV0dXJuIG5hbWU7XG59XG5cbnZhciBjb252ZW50aW9uTWFyayA9ICdfX2F1X3Jlc291cmNlX18nO1xuXG5leHBvcnQgdmFyIFZpZXdSZXNvdXJjZXMgPSBmdW5jdGlvbiAoKSB7XG4gIFZpZXdSZXNvdXJjZXMuY29udmVudGlvbiA9IGZ1bmN0aW9uIGNvbnZlbnRpb24odGFyZ2V0LCBleGlzdGluZykge1xuICAgIHZhciByZXNvdXJjZSA9IHZvaWQgMDtcblxuICAgIGlmIChleGlzdGluZyAmJiBjb252ZW50aW9uTWFyayBpbiBleGlzdGluZykge1xuICAgICAgcmV0dXJuIGV4aXN0aW5nO1xuICAgIH1cbiAgICBpZiAoJyRyZXNvdXJjZScgaW4gdGFyZ2V0KSB7XG4gICAgICB2YXIgY29uZmlnID0gdGFyZ2V0LiRyZXNvdXJjZTtcblxuICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJlc291cmNlID0gZXhpc3RpbmcgfHwgbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XG4gICAgICAgIHJlc291cmNlW2NvbnZlbnRpb25NYXJrXSA9IHRydWU7XG4gICAgICAgIGlmICghcmVzb3VyY2UuZWxlbWVudE5hbWUpIHtcbiAgICAgICAgICByZXNvdXJjZS5lbGVtZW50TmFtZSA9IHZhbGlkYXRlQmVoYXZpb3JOYW1lKGNvbmZpZywgJ2N1c3RvbSBlbGVtZW50Jyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgY29uZmlnID0gY29uZmlnLmNhbGwodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBjb25maWcgPSB7IG5hbWU6IGNvbmZpZyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKTtcblxuICAgICAgICB2YXIgcmVzb3VyY2VUeXBlID0gY29uZmlnLnR5cGUgfHwgJ2VsZW1lbnQnO1xuXG4gICAgICAgIHZhciBfbmFtZSA9IGNvbmZpZy5uYW1lO1xuICAgICAgICBzd2l0Y2ggKHJlc291cmNlVHlwZSkge1xuICAgICAgICAgIGNhc2UgJ2VsZW1lbnQnOmNhc2UgJ2F0dHJpYnV0ZSc6XG4gICAgICAgICAgICByZXNvdXJjZSA9IGV4aXN0aW5nIHx8IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xuICAgICAgICAgICAgcmVzb3VyY2VbY29udmVudGlvbk1hcmtdID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGUgPT09ICdlbGVtZW50Jykge1xuICAgICAgICAgICAgICBpZiAoIXJlc291cmNlLmVsZW1lbnROYW1lKSB7XG4gICAgICAgICAgICAgICAgcmVzb3VyY2UuZWxlbWVudE5hbWUgPSBfbmFtZSA/IHZhbGlkYXRlQmVoYXZpb3JOYW1lKF9uYW1lLCAnY3VzdG9tIGVsZW1lbnQnKSA6IF9oeXBoZW5hdGUodGFyZ2V0Lm5hbWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAoIXJlc291cmNlLmF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXNvdXJjZS5hdHRyaWJ1dGVOYW1lID0gX25hbWUgPyB2YWxpZGF0ZUJlaGF2aW9yTmFtZShfbmFtZSwgJ2N1c3RvbSBhdHRyaWJ1dGUnKSA6IF9oeXBoZW5hdGUodGFyZ2V0Lm5hbWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJ3RlbXBsYXRlQ29udHJvbGxlcicgaW4gY29uZmlnKSB7XG4gICAgICAgICAgICAgIGNvbmZpZy5saWZ0c0NvbnRlbnQgPSBjb25maWcudGVtcGxhdGVDb250cm9sbGVyO1xuICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLnRlbXBsYXRlQ29udHJvbGxlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgnZGVmYXVsdEJpbmRpbmdNb2RlJyBpbiBjb25maWcgJiYgcmVzb3VyY2UuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgY29uZmlnLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IGNvbmZpZy5kZWZhdWx0QmluZGluZ01vZGU7XG4gICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcuZGVmYXVsdEJpbmRpbmdNb2RlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkZWxldGUgY29uZmlnLm5hbWU7XG5cbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVzb3VyY2UsIGNvbmZpZyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICd2YWx1ZUNvbnZlcnRlcic6XG4gICAgICAgICAgICByZXNvdXJjZSA9IG5ldyBWYWx1ZUNvbnZlcnRlclJlc291cmNlKGNhbWVsQ2FzZShfbmFtZSB8fCB0YXJnZXQubmFtZSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnYmluZGluZ0JlaGF2aW9yJzpcbiAgICAgICAgICAgIHJlc291cmNlID0gbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKGNhbWVsQ2FzZShfbmFtZSB8fCB0YXJnZXQubmFtZSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAndmlld0VuZ2luZUhvb2tzJzpcbiAgICAgICAgICAgIHJlc291cmNlID0gbmV3IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocmVzb3VyY2UgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xuICAgICAgICB2YXIgX2JpbmRhYmxlcyA9IHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnID8gdW5kZWZpbmVkIDogY29uZmlnLmJpbmRhYmxlcztcbiAgICAgICAgdmFyIGN1cnJlbnRQcm9wcyA9IHJlc291cmNlLnByb3BlcnRpZXM7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KF9iaW5kYWJsZXMpKSB7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gX2JpbmRhYmxlcy5sZW5ndGg7IGlpID4gaTsgKytpKSB7XG4gICAgICAgICAgICB2YXIgcHJvcCA9IF9iaW5kYWJsZXNbaV07XG4gICAgICAgICAgICBpZiAoIXByb3AgfHwgdHlwZW9mIHByb3AgIT09ICdzdHJpbmcnICYmICFwcm9wLm5hbWUpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGJpbmRhYmxlIHByb3BlcnR5IGF0IFwiJyArIGkgKyAnXCIgZm9yIGNsYXNzIFwiJyArIHRhcmdldC5uYW1lICsgJ1wiLiBFeHBlY3RlZCBlaXRoZXIgYSBzdHJpbmcgb3IgYW4gb2JqZWN0IHdpdGggXCJuYW1lXCIgcHJvcGVydHkuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbmV3UHJvcCA9IG5ldyBCaW5kYWJsZVByb3BlcnR5KHByb3ApO1xuXG4gICAgICAgICAgICB2YXIgZXhpc3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gY3VycmVudFByb3BzLmxlbmd0aDsgamogPiBqOyArK2opIHtcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQcm9wc1tqXS5uYW1lID09PSBuZXdQcm9wLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBleGlzdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV4aXN0ZWQpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdQcm9wLnJlZ2lzdGVyV2l0aCh0YXJnZXQsIHJlc291cmNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc291cmNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFZpZXdSZXNvdXJjZXMocGFyZW50LCB2aWV3VXJsKSB7XG4gICAgXG5cbiAgICB0aGlzLmJpbmRpbmdMYW5ndWFnZSA9IG51bGw7XG5cbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudCB8fCBudWxsO1xuICAgIHRoaXMuaGFzUGFyZW50ID0gdGhpcy5wYXJlbnQgIT09IG51bGw7XG4gICAgdGhpcy52aWV3VXJsID0gdmlld1VybCB8fCAnJztcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IHtcbiAgICAgIHZhbHVlQ29udmVydGVyczogdGhpcy5nZXRWYWx1ZUNvbnZlcnRlci5iaW5kKHRoaXMpLFxuICAgICAgYmluZGluZ0JlaGF2aW9yczogdGhpcy5nZXRCaW5kaW5nQmVoYXZpb3IuYmluZCh0aGlzKVxuICAgIH07XG4gICAgdGhpcy5hdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmVsZW1lbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLnZhbHVlQ29udmVydGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5iaW5kaW5nQmVoYXZpb3JzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmF0dHJpYnV0ZU1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy52YWx1ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHRoaXMuYmVmb3JlQ29tcGlsZSA9IHRoaXMuYWZ0ZXJDb21waWxlID0gdGhpcy5iZWZvcmVDcmVhdGUgPSB0aGlzLmFmdGVyQ3JlYXRlID0gdGhpcy5iZWZvcmVCaW5kID0gdGhpcy5iZWZvcmVVbmJpbmQgPSBmYWxzZTtcbiAgfVxuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLl90cnlBZGRIb29rID0gZnVuY3Rpb24gX3RyeUFkZEhvb2sob2JqLCBuYW1lKSB7XG4gICAgaWYgKHR5cGVvZiBvYmpbbmFtZV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhciBmdW5jID0gb2JqW25hbWVdLmJpbmQob2JqKTtcbiAgICAgIHZhciBjb3VudGVyID0gMTtcbiAgICAgIHZhciBjYWxsYmFja05hbWUgPSB2b2lkIDA7XG5cbiAgICAgIHdoaWxlICh0aGlzW2NhbGxiYWNrTmFtZSA9IG5hbWUgKyBjb3VudGVyLnRvU3RyaW5nKCldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY291bnRlcisrO1xuICAgICAgfVxuXG4gICAgICB0aGlzW25hbWVdID0gdHJ1ZTtcbiAgICAgIHRoaXNbY2FsbGJhY2tOYW1lXSA9IGZ1bmM7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLl9pbnZva2VIb29rID0gZnVuY3Rpb24gX2ludm9rZUhvb2sobmFtZSwgb25lLCB0d28sIHRocmVlLCBmb3VyKSB7XG4gICAgaWYgKHRoaXMuaGFzUGFyZW50KSB7XG4gICAgICB0aGlzLnBhcmVudC5faW52b2tlSG9vayhuYW1lLCBvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzW25hbWVdKSB7XG4gICAgICB0aGlzW25hbWUgKyAnMSddKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XG5cbiAgICAgIHZhciBjYWxsYmFja05hbWUgPSBuYW1lICsgJzInO1xuICAgICAgaWYgKHRoaXNbY2FsbGJhY2tOYW1lXSkge1xuICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcblxuICAgICAgICBjYWxsYmFja05hbWUgPSBuYW1lICsgJzMnO1xuICAgICAgICBpZiAodGhpc1tjYWxsYmFja05hbWVdKSB7XG4gICAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XG5cbiAgICAgICAgICB2YXIgY291bnRlciA9IDQ7XG5cbiAgICAgICAgICB3aGlsZSAodGhpc1tjYWxsYmFja05hbWUgPSBuYW1lICsgY291bnRlci50b1N0cmluZygpXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcbiAgICAgICAgICAgIGNvdW50ZXIrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3RW5naW5lSG9va3MgPSBmdW5jdGlvbiByZWdpc3RlclZpZXdFbmdpbmVIb29rcyhob29rcykge1xuICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVDb21waWxlJyk7XG4gICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2FmdGVyQ29tcGlsZScpO1xuICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVDcmVhdGUnKTtcbiAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYWZ0ZXJDcmVhdGUnKTtcbiAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYmVmb3JlQmluZCcpO1xuICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVVbmJpbmQnKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRCaW5kaW5nTGFuZ3VhZ2UgPSBmdW5jdGlvbiBnZXRCaW5kaW5nTGFuZ3VhZ2UoYmluZGluZ0xhbmd1YWdlRmFsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nTGFuZ3VhZ2UgfHwgKHRoaXMuYmluZGluZ0xhbmd1YWdlID0gYmluZGluZ0xhbmd1YWdlRmFsbGJhY2spO1xuICB9O1xuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnBhdGNoSW5QYXJlbnQgPSBmdW5jdGlvbiBwYXRjaEluUGFyZW50KG5ld1BhcmVudCkge1xuICAgIHZhciBvcmlnaW5hbFBhcmVudCA9IHRoaXMucGFyZW50O1xuXG4gICAgdGhpcy5wYXJlbnQgPSBuZXdQYXJlbnQgfHwgbnVsbDtcbiAgICB0aGlzLmhhc1BhcmVudCA9IHRoaXMucGFyZW50ICE9PSBudWxsO1xuXG4gICAgaWYgKG5ld1BhcmVudC5wYXJlbnQgPT09IG51bGwpIHtcbiAgICAgIG5ld1BhcmVudC5wYXJlbnQgPSBvcmlnaW5hbFBhcmVudDtcbiAgICAgIG5ld1BhcmVudC5oYXNQYXJlbnQgPSBvcmlnaW5hbFBhcmVudCAhPT0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVsYXRpdmVUb1ZpZXcgPSBmdW5jdGlvbiByZWxhdGl2ZVRvVmlldyhwYXRoKSB7XG4gICAgcmV0dXJuIHJlbGF0aXZlVG9GaWxlKHBhdGgsIHRoaXMudmlld1VybCk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJFbGVtZW50ID0gZnVuY3Rpb24gcmVnaXN0ZXJFbGVtZW50KHRhZ05hbWUsIGJlaGF2aW9yKSB7XG4gICAgcmVnaXN0ZXIodGhpcy5lbGVtZW50cywgdGFnTmFtZSwgYmVoYXZpb3IsICdhbiBFbGVtZW50Jyk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uIGdldEVsZW1lbnQodGFnTmFtZSkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW3RhZ05hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldEVsZW1lbnQodGFnTmFtZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5tYXBBdHRyaWJ1dGUgPSBmdW5jdGlvbiBtYXBBdHRyaWJ1dGUoYXR0cmlidXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlTWFwW2F0dHJpYnV0ZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQubWFwQXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckF0dHJpYnV0ZSA9IGZ1bmN0aW9uIHJlZ2lzdGVyQXR0cmlidXRlKGF0dHJpYnV0ZSwgYmVoYXZpb3IsIGtub3duQXR0cmlidXRlKSB7XG4gICAgdGhpcy5hdHRyaWJ1dGVNYXBbYXR0cmlidXRlXSA9IGtub3duQXR0cmlidXRlO1xuICAgIHJlZ2lzdGVyKHRoaXMuYXR0cmlidXRlcywgYXR0cmlidXRlLCBiZWhhdmlvciwgJ2FuIEF0dHJpYnV0ZScpO1xuICB9O1xuXG4gIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIGdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpIHtcbiAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlclZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gcmVnaXN0ZXJWYWx1ZUNvbnZlcnRlcihuYW1lLCB2YWx1ZUNvbnZlcnRlcikge1xuICAgIHJlZ2lzdGVyKHRoaXMudmFsdWVDb252ZXJ0ZXJzLCBuYW1lLCB2YWx1ZUNvbnZlcnRlciwgJ2EgVmFsdWVDb252ZXJ0ZXInKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIGdldFZhbHVlQ29udmVydGVyKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZUNvbnZlcnRlcnNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0VmFsdWVDb252ZXJ0ZXIobmFtZSkgOiBudWxsKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIHJlZ2lzdGVyQmluZGluZ0JlaGF2aW9yKG5hbWUsIGJpbmRpbmdCZWhhdmlvcikge1xuICAgIHJlZ2lzdGVyKHRoaXMuYmluZGluZ0JlaGF2aW9ycywgbmFtZSwgYmluZGluZ0JlaGF2aW9yLCAnYSBCaW5kaW5nQmVoYXZpb3InKTtcbiAgfTtcblxuICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiBnZXRCaW5kaW5nQmVoYXZpb3IobmFtZSkge1xuICAgIHJldHVybiB0aGlzLmJpbmRpbmdCZWhhdmlvcnNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0QmluZGluZ0JlaGF2aW9yKG5hbWUpIDogbnVsbCk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWYWx1ZSA9IGZ1bmN0aW9uIHJlZ2lzdGVyVmFsdWUobmFtZSwgdmFsdWUpIHtcbiAgICByZWdpc3Rlcih0aGlzLnZhbHVlcywgbmFtZSwgdmFsdWUsICdhIHZhbHVlJyk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZShuYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVzW25hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldFZhbHVlKG5hbWUpIDogbnVsbCk7XG4gIH07XG5cbiAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuYXV0b1JlZ2lzdGVyID0gZnVuY3Rpb24gYXV0b1JlZ2lzdGVyKGNvbnRhaW5lciwgaW1wbCkge1xuICAgIHZhciByZXNvdXJjZVR5cGVNZXRhID0gbWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhLnJlc291cmNlLCBpbXBsKTtcbiAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSkge1xuICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xuICAgICAgICBWaWV3UmVzb3VyY2VzLmNvbnZlbnRpb24oaW1wbCwgcmVzb3VyY2VUeXBlTWV0YSk7XG5cbiAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gbnVsbCAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSBudWxsKSB7XG4gICAgICAgICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUsIHJlc291cmNlVHlwZU1ldGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGltcGwubmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IFZpZXdSZXNvdXJjZXMuY29udmVudGlvbihpbXBsKSB8fCBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSkgfHwgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSkgfHwgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUpIHx8IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLmNvbnZlbnRpb24oaW1wbC5uYW1lKTtcbiAgICAgIGlmICghcmVzb3VyY2VUeXBlTWV0YSkge1xuICAgICAgICByZXNvdXJjZVR5cGVNZXRhID0gbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XG4gICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGltcGwubmFtZSk7XG4gICAgICB9XG4gICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIHJlc291cmNlVHlwZU1ldGEsIGltcGwpO1xuICAgIH1cbiAgICByZXNvdXJjZVR5cGVNZXRhLmluaXRpYWxpemUoY29udGFpbmVyLCBpbXBsKTtcbiAgICByZXNvdXJjZVR5cGVNZXRhLnJlZ2lzdGVyKHRoaXMpO1xuICAgIHJldHVybiByZXNvdXJjZVR5cGVNZXRhO1xuICB9O1xuXG4gIHJldHVybiBWaWV3UmVzb3VyY2VzO1xufSgpO1xuXG5leHBvcnQgdmFyIFZpZXcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFZpZXcoY29udGFpbmVyLCB2aWV3RmFjdG9yeSwgZnJhZ21lbnQsIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNsb3RzKSB7XG4gICAgXG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XG4gICAgdGhpcy5yZXNvdXJjZXMgPSB2aWV3RmFjdG9yeS5yZXNvdXJjZXM7XG4gICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50O1xuICAgIHRoaXMuZmlyc3RDaGlsZCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7XG4gICAgdGhpcy5sYXN0Q2hpbGQgPSBmcmFnbWVudC5sYXN0Q2hpbGQ7XG4gICAgdGhpcy5jb250cm9sbGVycyA9IGNvbnRyb2xsZXJzO1xuICAgIHRoaXMuYmluZGluZ3MgPSBiaW5kaW5ncztcbiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XG4gICAgdGhpcy5zbG90cyA9IHNsb3RzO1xuICAgIHRoaXMuaGFzU2xvdHMgPSBmYWxzZTtcbiAgICB0aGlzLmZyb21DYWNoZSA9IGZhbHNlO1xuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xuICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xuICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLmNvbnRyb2xsZXIgPSBudWxsO1xuICAgIHRoaXMudmlld01vZGVsU2NvcGUgPSBudWxsO1xuICAgIHRoaXMuYW5pbWF0YWJsZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5faXNVc2VyQ29udHJvbGxlZCA9IGZhbHNlO1xuICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xuXG4gICAgZm9yICh2YXIgX2tleTMgaW4gc2xvdHMpIHtcbiAgICAgIHRoaXMuaGFzU2xvdHMgPSB0cnVlO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgVmlldy5wcm90b3R5cGUucmV0dXJuVG9DYWNoZSA9IGZ1bmN0aW9uIHJldHVyblRvQ2FjaGUoKSB7XG4gICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh0aGlzKTtcbiAgfTtcblxuICBWaWV3LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gY3JlYXRlZCgpIHtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcblxuICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY29udHJvbGxlcnNbaV0uY3JlYXRlZCh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCwgX3N5c3RlbVVwZGF0ZSkge1xuICAgIHZhciBjb250cm9sbGVycyA9IHZvaWQgMDtcbiAgICB2YXIgYmluZGluZ3MgPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkcmVuID0gdm9pZCAwO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcblxuICAgIGlmIChfc3lzdGVtVXBkYXRlICYmIHRoaXMuX2lzVXNlckNvbnRyb2xsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5iaW5kaW5nQ29udGV4dCA9PT0gYmluZGluZ0NvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cblxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0O1xuICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0IHx8IGNyZWF0ZU92ZXJyaWRlQ29udGV4dChiaW5kaW5nQ29udGV4dCk7XG5cbiAgICB0aGlzLnJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlQmluZCcsIHRoaXMpO1xuXG4gICAgYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzO1xuICAgIGZvciAoaSA9IDAsIGlpID0gYmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgYmluZGluZ3NbaV0uYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy52aWV3TW9kZWxTY29wZSAhPT0gbnVsbCkge1xuICAgICAgYmluZGluZ0NvbnRleHQuYmluZCh0aGlzLnZpZXdNb2RlbFNjb3BlLmJpbmRpbmdDb250ZXh0LCB0aGlzLnZpZXdNb2RlbFNjb3BlLm92ZXJyaWRlQ29udGV4dCk7XG4gICAgICB0aGlzLnZpZXdNb2RlbFNjb3BlID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XG4gICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjb250cm9sbGVyc1tpXS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGNoaWxkcmVuW2ldLmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaGFzU2xvdHMpIHtcbiAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh0aGlzLmNvbnRlbnRWaWV3LCB0aGlzLnNsb3RzKTtcbiAgICB9XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUuYWRkQmluZGluZyA9IGZ1bmN0aW9uIGFkZEJpbmRpbmcoYmluZGluZykge1xuICAgIHRoaXMuYmluZGluZ3MucHVzaChiaW5kaW5nKTtcblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGJpbmRpbmcuYmluZCh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIHZhciBjb250cm9sbGVycyA9IHZvaWQgMDtcbiAgICB2YXIgYmluZGluZ3MgPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkcmVuID0gdm9pZCAwO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgICAgdGhpcy5yZXNvdXJjZXMuX2ludm9rZUhvb2soJ2JlZm9yZVVuYmluZCcsIHRoaXMpO1xuXG4gICAgICBpZiAodGhpcy5jb250cm9sbGVyICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlci51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzO1xuICAgICAgZm9yIChpID0gMCwgaWkgPSBiaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGJpbmRpbmdzW2ldLnVuYmluZCgpO1xuICAgICAgfVxuXG4gICAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgY29udHJvbGxlcnNbaV0udW5iaW5kKCk7XG4gICAgICB9XG5cbiAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBjaGlsZHJlbltpXS51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XG4gICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIFZpZXcucHJvdG90eXBlLmluc2VydE5vZGVzQmVmb3JlID0gZnVuY3Rpb24gaW5zZXJ0Tm9kZXNCZWZvcmUocmVmTm9kZSkge1xuICAgIHJlZk5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5mcmFnbWVudCwgcmVmTm9kZSk7XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUuYXBwZW5kTm9kZXNUbyA9IGZ1bmN0aW9uIGFwcGVuZE5vZGVzVG8ocGFyZW50KSB7XG4gICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZnJhZ21lbnQpO1xuICB9O1xuXG4gIFZpZXcucHJvdG90eXBlLnJlbW92ZU5vZGVzID0gZnVuY3Rpb24gcmVtb3ZlTm9kZXMoKSB7XG4gICAgdmFyIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudDtcbiAgICB2YXIgY3VycmVudCA9IHRoaXMuZmlyc3RDaGlsZDtcbiAgICB2YXIgZW5kID0gdGhpcy5sYXN0Q2hpbGQ7XG4gICAgdmFyIG5leHQgPSB2b2lkIDA7XG5cbiAgICB3aGlsZSAoY3VycmVudCkge1xuICAgICAgbmV4dCA9IGN1cnJlbnQubmV4dFNpYmxpbmc7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChjdXJyZW50KTtcblxuICAgICAgaWYgKGN1cnJlbnQgPT09IGVuZCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY3VycmVudCA9IG5leHQ7XG4gICAgfVxuICB9O1xuXG4gIFZpZXcucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gYXR0YWNoZWQoKSB7XG4gICAgdmFyIGNvbnRyb2xsZXJzID0gdm9pZCAwO1xuICAgIHZhciBjaGlsZHJlbiA9IHZvaWQgMDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0F0dGFjaGVkID0gdHJ1ZTtcblxuICAgIGlmICh0aGlzLmNvbnRyb2xsZXIgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuY29udHJvbGxlci5hdHRhY2hlZCgpO1xuICAgIH1cblxuICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcbiAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGNvbnRyb2xsZXJzW2ldLmF0dGFjaGVkKCk7XG4gICAgfVxuXG4gICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgY2hpbGRyZW5baV0uYXR0YWNoZWQoKTtcbiAgICB9XG4gIH07XG5cbiAgVmlldy5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiBkZXRhY2hlZCgpIHtcbiAgICB2YXIgY29udHJvbGxlcnMgPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkcmVuID0gdm9pZCAwO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xuXG4gICAgICBpZiAodGhpcy5jb250cm9sbGVyICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuY29udHJvbGxlci5kZXRhY2hlZCgpO1xuICAgICAgfVxuXG4gICAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgY29udHJvbGxlcnNbaV0uZGV0YWNoZWQoKTtcbiAgICAgIH1cblxuICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGNoaWxkcmVuW2ldLmRldGFjaGVkKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBWaWV3O1xufSgpO1xuXG5mdW5jdGlvbiBnZXRBbmltYXRhYmxlRWxlbWVudCh2aWV3KSB7XG4gIGlmICh2aWV3LmFuaW1hdGFibGVFbGVtZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdmlldy5hbmltYXRhYmxlRWxlbWVudDtcbiAgfVxuXG4gIHZhciBjdXJyZW50ID0gdmlldy5maXJzdENoaWxkO1xuXG4gIHdoaWxlIChjdXJyZW50ICYmIGN1cnJlbnQubm9kZVR5cGUgIT09IDEpIHtcbiAgICBjdXJyZW50ID0gY3VycmVudC5uZXh0U2libGluZztcbiAgfVxuXG4gIGlmIChjdXJyZW50ICYmIGN1cnJlbnQubm9kZVR5cGUgPT09IDEpIHtcbiAgICByZXR1cm4gdmlldy5hbmltYXRhYmxlRWxlbWVudCA9IGN1cnJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhdS1hbmltYXRlJykgPyBjdXJyZW50IDogbnVsbDtcbiAgfVxuXG4gIHJldHVybiB2aWV3LmFuaW1hdGFibGVFbGVtZW50ID0gbnVsbDtcbn1cblxuZXhwb3J0IHZhciBWaWV3U2xvdCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVmlld1Nsb3QoYW5jaG9yLCBhbmNob3JJc0NvbnRhaW5lcikge1xuICAgIHZhciBhbmltYXRvciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogQW5pbWF0b3IuaW5zdGFuY2U7XG5cbiAgICBcblxuICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xuICAgIHRoaXMuYW5jaG9ySXNDb250YWluZXIgPSBhbmNob3JJc0NvbnRhaW5lcjtcbiAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XG4gICAgdGhpcy5hbmltYXRvciA9IGFuaW1hdG9yO1xuICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRlbnRTZWxlY3RvcnMgPSBudWxsO1xuICAgIGFuY2hvci52aWV3U2xvdCA9IHRoaXM7XG4gICAgYW5jaG9yLmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UgPSBmYWxzZTtcbiAgfVxuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5hbmltYXRlVmlldyA9IGZ1bmN0aW9uIGFuaW1hdGVWaWV3KHZpZXcpIHtcbiAgICB2YXIgZGlyZWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnZW50ZXInO1xuXG4gICAgdmFyIGFuaW1hdGFibGVFbGVtZW50ID0gZ2V0QW5pbWF0YWJsZUVsZW1lbnQodmlldyk7XG5cbiAgICBpZiAoYW5pbWF0YWJsZUVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgJ2VudGVyJzpcbiAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRvci5lbnRlcihhbmltYXRhYmxlRWxlbWVudCk7XG4gICAgICAgIGNhc2UgJ2xlYXZlJzpcbiAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRvci5sZWF2ZShhbmltYXRhYmxlRWxlbWVudCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGFuaW1hdGlvbiBkaXJlY3Rpb246ICcgKyBkaXJlY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUudHJhbnNmb3JtQ2hpbGROb2Rlc0ludG9WaWV3ID0gZnVuY3Rpb24gdHJhbnNmb3JtQ2hpbGROb2Rlc0ludG9WaWV3KCkge1xuICAgIHZhciBwYXJlbnQgPSB0aGlzLmFuY2hvcjtcblxuICAgIHRoaXMuY2hpbGRyZW4ucHVzaCh7XG4gICAgICBmcmFnbWVudDogcGFyZW50LFxuICAgICAgZmlyc3RDaGlsZDogcGFyZW50LmZpcnN0Q2hpbGQsXG4gICAgICBsYXN0Q2hpbGQ6IHBhcmVudC5sYXN0Q2hpbGQsXG4gICAgICByZXR1cm5Ub0NhY2hlOiBmdW5jdGlvbiByZXR1cm5Ub0NhY2hlKCkge30sXG4gICAgICByZW1vdmVOb2RlczogZnVuY3Rpb24gcmVtb3ZlTm9kZXMoKSB7XG4gICAgICAgIHZhciBsYXN0ID0gdm9pZCAwO1xuXG4gICAgICAgIHdoaWxlIChsYXN0ID0gcGFyZW50Lmxhc3RDaGlsZCkge1xuICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChsYXN0KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7fSxcbiAgICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7fSxcbiAgICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKCkge30sXG4gICAgICBhdHRhY2hlZDogZnVuY3Rpb24gYXR0YWNoZWQoKSB7fSxcbiAgICAgIGRldGFjaGVkOiBmdW5jdGlvbiBkZXRhY2hlZCgpIHt9XG4gICAgfSk7XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkcmVuID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgaWYgKHRoaXMuYmluZGluZ0NvbnRleHQgPT09IGJpbmRpbmdDb250ZXh0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51bmJpbmQoKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBiaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0IHx8IHRoaXMuYmluZGluZ0NvbnRleHQ7XG4gICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgfHwgdGhpcy5vdmVycmlkZUNvbnRleHQ7XG5cbiAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjaGlsZHJlbltpXS5iaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQsIHRydWUpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIHZhciBpID0gdm9pZCAwO1xuICAgICAgdmFyIGlpID0gdm9pZCAwO1xuICAgICAgdmFyIF9jaGlsZHJlbjQgPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xuICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xuXG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IF9jaGlsZHJlbjQubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBfY2hpbGRyZW40W2ldLnVuYmluZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gYWRkKHZpZXcpIHtcbiAgICBpZiAodGhpcy5hbmNob3JJc0NvbnRhaW5lcikge1xuICAgICAgdmlldy5hcHBlbmROb2Rlc1RvKHRoaXMuYW5jaG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmlldy5pbnNlcnROb2Rlc0JlZm9yZSh0aGlzLmFuY2hvcik7XG4gICAgfVxuXG4gICAgdGhpcy5jaGlsZHJlbi5wdXNoKHZpZXcpO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdmlldy5hdHRhY2hlZCgpO1xuICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZVZpZXcodmlldywgJ2VudGVyJyk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbiBpbnNlcnQoaW5kZXgsIHZpZXcpIHtcbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIHZhciBsZW5ndGggPSBjaGlsZHJlbi5sZW5ndGg7XG5cbiAgICBpZiAoaW5kZXggPT09IDAgJiYgbGVuZ3RoID09PSAwIHx8IGluZGV4ID49IGxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuYWRkKHZpZXcpO1xuICAgIH1cblxuICAgIHZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUoY2hpbGRyZW5baW5kZXhdLmZpcnN0Q2hpbGQpO1xuICAgIGNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgdmlldyk7XG5cbiAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XG4gICAgICB2aWV3LmF0dGFjaGVkKCk7XG4gICAgICByZXR1cm4gdGhpcy5hbmltYXRlVmlldyh2aWV3LCAnZW50ZXInKTtcbiAgICB9XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiBtb3ZlKHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xuICAgIGlmIChzb3VyY2VJbmRleCA9PT0gdGFyZ2V0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIHZhciB2aWV3ID0gY2hpbGRyZW5bc291cmNlSW5kZXhdO1xuXG4gICAgdmlldy5yZW1vdmVOb2RlcygpO1xuICAgIHZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUoY2hpbGRyZW5bdGFyZ2V0SW5kZXhdLmZpcnN0Q2hpbGQpO1xuICAgIGNoaWxkcmVuLnNwbGljZShzb3VyY2VJbmRleCwgMSk7XG4gICAgY2hpbGRyZW4uc3BsaWNlKHRhcmdldEluZGV4LCAwLCB2aWV3KTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gcmVtb3ZlKHZpZXcsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmVBdCh0aGlzLmNoaWxkcmVuLmluZGV4T2YodmlldyksIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5yZW1vdmVNYW55ID0gZnVuY3Rpb24gcmVtb3ZlTWFueSh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XG4gICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIHZhciBpaSA9IHZpZXdzVG9SZW1vdmUubGVuZ3RoO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBybVByb21pc2VzID0gW107XG5cbiAgICB2aWV3c1RvUmVtb3ZlLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBpZiAoc2tpcEFuaW1hdGlvbikge1xuICAgICAgICBjaGlsZC5yZW1vdmVOb2RlcygpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBhbmltYXRpb24gPSBfdGhpczMuYW5pbWF0ZVZpZXcoY2hpbGQsICdsZWF2ZScpO1xuICAgICAgaWYgKGFuaW1hdGlvbikge1xuICAgICAgICBybVByb21pc2VzLnB1c2goYW5pbWF0aW9uLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjaGlsZC5yZW1vdmVOb2RlcygpO1xuICAgICAgICB9KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjaGlsZC5yZW1vdmVOb2RlcygpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIHJlbW92ZUFjdGlvbiA9IGZ1bmN0aW9uIHJlbW92ZUFjdGlvbigpIHtcbiAgICAgIGlmIChfdGhpczMuaXNBdHRhY2hlZCkge1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgIHZpZXdzVG9SZW1vdmVbaV0uZGV0YWNoZWQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgIHZpZXdzVG9SZW1vdmVbaV0ucmV0dXJuVG9DYWNoZSgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGNoaWxkcmVuLmluZGV4T2Yodmlld3NUb1JlbW92ZVtpXSk7XG4gICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAocm1Qcm9taXNlcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwocm1Qcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZW1vdmVBY3Rpb24oKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiByZW1vdmVBY3Rpb24oKTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlQXQgPSBmdW5jdGlvbiByZW1vdmVBdChpbmRleCwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xuICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgdmFyIHZpZXcgPSB0aGlzLmNoaWxkcmVuW2luZGV4XTtcblxuICAgIHZhciByZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiByZW1vdmVBY3Rpb24oKSB7XG4gICAgICBpbmRleCA9IF90aGlzNC5jaGlsZHJlbi5pbmRleE9mKHZpZXcpO1xuICAgICAgdmlldy5yZW1vdmVOb2RlcygpO1xuICAgICAgX3RoaXM0LmNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgIGlmIChfdGhpczQuaXNBdHRhY2hlZCkge1xuICAgICAgICB2aWV3LmRldGFjaGVkKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XG4gICAgICAgIHZpZXcucmV0dXJuVG9DYWNoZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdmlldztcbiAgICB9O1xuXG4gICAgaWYgKCFza2lwQW5pbWF0aW9uKSB7XG4gICAgICB2YXIgYW5pbWF0aW9uID0gdGhpcy5hbmltYXRlVmlldyh2aWV3LCAnbGVhdmUnKTtcbiAgICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIGFuaW1hdGlvbi50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZW1vdmVBY3Rpb24oKTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlQWxsID0gZnVuY3Rpb24gcmVtb3ZlQWxsKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcbiAgICB2YXIgX3RoaXM1ID0gdGhpcztcblxuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgdmFyIGlpID0gY2hpbGRyZW4ubGVuZ3RoO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBybVByb21pc2VzID0gW107XG5cbiAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgaWYgKHNraXBBbmltYXRpb24pIHtcbiAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgYW5pbWF0aW9uID0gX3RoaXM1LmFuaW1hdGVWaWV3KGNoaWxkLCAnbGVhdmUnKTtcbiAgICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgICAgcm1Qcm9taXNlcy5wdXNoKGFuaW1hdGlvbi50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGQucmVtb3ZlTm9kZXMoKTtcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciByZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiByZW1vdmVBY3Rpb24oKSB7XG4gICAgICBpZiAoX3RoaXM1LmlzQXR0YWNoZWQpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgdmFyIF9jaGlsZDMgPSBjaGlsZHJlbltpXTtcblxuICAgICAgICAgIGlmIChfY2hpbGQzKSB7XG4gICAgICAgICAgICBfY2hpbGQzLnJldHVyblRvQ2FjaGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgX3RoaXM1LmNoaWxkcmVuID0gW107XG4gICAgfTtcblxuICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChybVByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJlbW92ZUFjdGlvbigpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlbW92ZUFjdGlvbigpO1xuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uIGF0dGFjaGVkKCkge1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgY2hpbGRyZW4gPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNBdHRhY2hlZCA9IHRydWU7XG5cbiAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjaGlsZCA9IGNoaWxkcmVuW2ldO1xuICAgICAgY2hpbGQuYXR0YWNoZWQoKTtcbiAgICAgIHRoaXMuYW5pbWF0ZVZpZXcoY2hpbGQsICdlbnRlcicpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiBkZXRhY2hlZCgpIHtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIGNoaWxkcmVuID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XG4gICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgVmlld1Nsb3QucHJvdG90eXBlLnByb2plY3RUbyA9IGZ1bmN0aW9uIHByb2plY3RUbyhzbG90cykge1xuICAgIHZhciBfdGhpczYgPSB0aGlzO1xuXG4gICAgdGhpcy5wcm9qZWN0VG9TbG90cyA9IHNsb3RzO1xuICAgIHRoaXMuYWRkID0gdGhpcy5fcHJvamVjdGlvbkFkZDtcbiAgICB0aGlzLmluc2VydCA9IHRoaXMuX3Byb2plY3Rpb25JbnNlcnQ7XG4gICAgdGhpcy5tb3ZlID0gdGhpcy5fcHJvamVjdGlvbk1vdmU7XG4gICAgdGhpcy5yZW1vdmUgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlO1xuICAgIHRoaXMucmVtb3ZlQXQgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlQXQ7XG4gICAgdGhpcy5yZW1vdmVNYW55ID0gdGhpcy5fcHJvamVjdGlvblJlbW92ZU1hbnk7XG4gICAgdGhpcy5yZW1vdmVBbGwgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlQWxsO1xuICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAodmlldykge1xuICAgICAgcmV0dXJuIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3LCBzbG90cywgX3RoaXM2KTtcbiAgICB9KTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25BZGQgPSBmdW5jdGlvbiBfcHJvamVjdGlvbkFkZCh2aWV3KSB7XG4gICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMpO1xuXG4gICAgdGhpcy5jaGlsZHJlbi5wdXNoKHZpZXcpO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdmlldy5hdHRhY2hlZCgpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25JbnNlcnQgPSBmdW5jdGlvbiBfcHJvamVjdGlvbkluc2VydChpbmRleCwgdmlldykge1xuICAgIGlmIChpbmRleCA9PT0gMCAmJiAhdGhpcy5jaGlsZHJlbi5sZW5ndGggfHwgaW5kZXggPj0gdGhpcy5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgIHRoaXMuYWRkKHZpZXcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcywgaW5kZXgpO1xuXG4gICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgdmlldyk7XG5cbiAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgICAgdmlldy5hdHRhY2hlZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25Nb3ZlID0gZnVuY3Rpb24gX3Byb2plY3Rpb25Nb3ZlKHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xuICAgIGlmIChzb3VyY2VJbmRleCA9PT0gdGFyZ2V0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuICAgIHZhciB2aWV3ID0gY2hpbGRyZW5bc291cmNlSW5kZXhdO1xuXG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XG4gICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMsIHRhcmdldEluZGV4KTtcblxuICAgIGNoaWxkcmVuLnNwbGljZShzb3VyY2VJbmRleCwgMSk7XG4gICAgY2hpbGRyZW4uc3BsaWNlKHRhcmdldEluZGV4LCAwLCB2aWV3KTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmUgPSBmdW5jdGlvbiBfcHJvamVjdGlvblJlbW92ZSh2aWV3LCByZXR1cm5Ub0NhY2hlKSB7XG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XG4gICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UodGhpcy5jaGlsZHJlbi5pbmRleE9mKHZpZXcpLCAxKTtcblxuICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcbiAgICAgIHZpZXcuZGV0YWNoZWQoKTtcbiAgICB9XG4gICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcbiAgICAgIHZpZXcucmV0dXJuVG9DYWNoZSgpO1xuICAgIH1cbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVBdCA9IGZ1bmN0aW9uIF9wcm9qZWN0aW9uUmVtb3ZlQXQoaW5kZXgsIHJldHVyblRvQ2FjaGUpIHtcbiAgICB2YXIgdmlldyA9IHRoaXMuY2hpbGRyZW5baW5kZXhdO1xuXG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XG4gICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdmlldy5kZXRhY2hlZCgpO1xuICAgIH1cbiAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xuICAgICAgdmlldy5yZXR1cm5Ub0NhY2hlKCk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvblJlbW92ZU1hbnkgPSBmdW5jdGlvbiBfcHJvamVjdGlvblJlbW92ZU1hbnkodmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSkge1xuICAgIHZhciBfdGhpczcgPSB0aGlzO1xuXG4gICAgdmlld3NUb1JlbW92ZS5mb3JFYWNoKGZ1bmN0aW9uICh2aWV3KSB7XG4gICAgICByZXR1cm4gX3RoaXM3LnJlbW92ZSh2aWV3LCByZXR1cm5Ub0NhY2hlKTtcbiAgICB9KTtcbiAgfTtcblxuICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVBbGwgPSBmdW5jdGlvbiBfcHJvamVjdGlvblJlbW92ZUFsbChyZXR1cm5Ub0NhY2hlKSB7XG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCh0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcblxuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XG4gICAgdmFyIGlpID0gY2hpbGRyZW4ubGVuZ3RoO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpaTsgKytpKSB7XG4gICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xuICAgICAgICBjaGlsZHJlbltpXS5yZXR1cm5Ub0NhY2hlKCk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgfTtcblxuICByZXR1cm4gVmlld1Nsb3Q7XG59KCk7XG5cbnZhciBQcm92aWRlclJlc29sdmVyID0gcmVzb2x2ZXIoX2NsYXNzMTIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFByb3ZpZGVyUmVzb2x2ZXIoKSB7XG4gICAgXG4gIH1cblxuICBQcm92aWRlclJlc29sdmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY29udGFpbmVyLCBrZXkpIHtcbiAgICB2YXIgaWQgPSBrZXkuX19wcm92aWRlcklkX187XG4gICAgcmV0dXJuIGlkIGluIGNvbnRhaW5lciA/IGNvbnRhaW5lcltpZF0gOiBjb250YWluZXJbaWRdID0gY29udGFpbmVyLmludm9rZShrZXkpO1xuICB9O1xuXG4gIHJldHVybiBQcm92aWRlclJlc29sdmVyO1xufSgpKSB8fCBfY2xhc3MxMjtcblxudmFyIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSA9IG5ldyBQcm92aWRlclJlc29sdmVyKCk7XG5cbmZ1bmN0aW9uIGVsZW1lbnRDb250YWluZXJHZXQoa2V5KSB7XG4gIGlmIChrZXkgPT09IERPTS5FbGVtZW50KSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgfVxuXG4gIGlmIChrZXkgPT09IEJvdW5kVmlld0ZhY3RvcnkpIHtcbiAgICBpZiAodGhpcy5ib3VuZFZpZXdGYWN0b3J5KSB7XG4gICAgICByZXR1cm4gdGhpcy5ib3VuZFZpZXdGYWN0b3J5O1xuICAgIH1cblxuICAgIHZhciBmYWN0b3J5ID0gdGhpcy5pbnN0cnVjdGlvbi52aWV3RmFjdG9yeTtcbiAgICB2YXIgX3BhcnRSZXBsYWNlbWVudHMgPSB0aGlzLnBhcnRSZXBsYWNlbWVudHM7XG5cbiAgICBpZiAoX3BhcnRSZXBsYWNlbWVudHMpIHtcbiAgICAgIGZhY3RvcnkgPSBfcGFydFJlcGxhY2VtZW50c1tmYWN0b3J5LnBhcnRdIHx8IGZhY3Rvcnk7XG4gICAgfVxuXG4gICAgdGhpcy5ib3VuZFZpZXdGYWN0b3J5ID0gbmV3IEJvdW5kVmlld0ZhY3RvcnkodGhpcywgZmFjdG9yeSwgX3BhcnRSZXBsYWNlbWVudHMpO1xuICAgIHJldHVybiB0aGlzLmJvdW5kVmlld0ZhY3Rvcnk7XG4gIH1cblxuICBpZiAoa2V5ID09PSBWaWV3U2xvdCkge1xuICAgIGlmICh0aGlzLnZpZXdTbG90ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMudmlld1Nsb3QgPSBuZXcgVmlld1Nsb3QodGhpcy5lbGVtZW50LCB0aGlzLmluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKTtcbiAgICAgIHRoaXMuZWxlbWVudC5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlID0gdGhpcy5pbnN0cnVjdGlvbi5saWZ0aW5nO1xuICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHRoaXMudmlld1Nsb3QpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnZpZXdTbG90O1xuICB9XG5cbiAgaWYgKGtleSA9PT0gRWxlbWVudEV2ZW50cykge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRFdmVudHMgfHwgKHRoaXMuZWxlbWVudEV2ZW50cyA9IG5ldyBFbGVtZW50RXZlbnRzKHRoaXMuZWxlbWVudCkpO1xuICB9XG5cbiAgaWYgKGtleSA9PT0gQ29tcG9zaXRpb25UcmFuc2FjdGlvbikge1xuICAgIHJldHVybiB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gfHwgKHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbiA9IHRoaXMucGFyZW50LmdldChrZXkpKTtcbiAgfVxuXG4gIGlmIChrZXkgPT09IFZpZXdSZXNvdXJjZXMpIHtcbiAgICByZXR1cm4gdGhpcy52aWV3UmVzb3VyY2VzO1xuICB9XG5cbiAgaWYgKGtleSA9PT0gVGFyZ2V0SW5zdHJ1Y3Rpb24pIHtcbiAgICByZXR1cm4gdGhpcy5pbnN0cnVjdGlvbjtcbiAgfVxuXG4gIHJldHVybiB0aGlzLnN1cGVyR2V0KGtleSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRDb250YWluZXIocGFyZW50LCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY2hpbGRyZW4sIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcykge1xuICB2YXIgY29udGFpbmVyID0gcGFyZW50LmNyZWF0ZUNoaWxkKCk7XG4gIHZhciBwcm92aWRlcnMgPSB2b2lkIDA7XG4gIHZhciBpID0gdm9pZCAwO1xuXG4gIGNvbnRhaW5lci5lbGVtZW50ID0gZWxlbWVudDtcbiAgY29udGFpbmVyLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XG4gIGNvbnRhaW5lci5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICBjb250YWluZXIudmlld1Jlc291cmNlcyA9IHJlc291cmNlcztcbiAgY29udGFpbmVyLnBhcnRSZXBsYWNlbWVudHMgPSBwYXJ0UmVwbGFjZW1lbnRzO1xuXG4gIHByb3ZpZGVycyA9IGluc3RydWN0aW9uLnByb3ZpZGVycztcbiAgaSA9IHByb3ZpZGVycy5sZW5ndGg7XG5cbiAgd2hpbGUgKGktLSkge1xuICAgIGNvbnRhaW5lci5fcmVzb2x2ZXJzLnNldChwcm92aWRlcnNbaV0sIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSk7XG4gIH1cblxuICBjb250YWluZXIuc3VwZXJHZXQgPSBjb250YWluZXIuZ2V0O1xuICBjb250YWluZXIuZ2V0ID0gZWxlbWVudENvbnRhaW5lckdldDtcblxuICByZXR1cm4gY29udGFpbmVyO1xufVxuXG5mdW5jdGlvbiBoYXNBdHRyaWJ1dGUobmFtZSkge1xuICByZXR1cm4gdGhpcy5fZWxlbWVudC5oYXNBdHRyaWJ1dGUobmFtZSk7XG59XG5cbmZ1bmN0aW9uIGdldEF0dHJpYnV0ZShuYW1lKSB7XG4gIHJldHVybiB0aGlzLl9lbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKTtcbn1cblxuZnVuY3Rpb24gc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKSB7XG4gIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbn1cblxuZnVuY3Rpb24gbWFrZUVsZW1lbnRJbnRvQW5jaG9yKGVsZW1lbnQsIGVsZW1lbnRJbnN0cnVjdGlvbikge1xuICB2YXIgYW5jaG9yID0gRE9NLmNyZWF0ZUNvbW1lbnQoJ2FuY2hvcicpO1xuXG4gIGlmIChlbGVtZW50SW5zdHJ1Y3Rpb24pIHtcbiAgICB2YXIgZmlyc3RDaGlsZCA9IGVsZW1lbnQuZmlyc3RDaGlsZDtcblxuICAgIGlmIChmaXJzdENoaWxkICYmIGZpcnN0Q2hpbGQudGFnTmFtZSA9PT0gJ0FVLUNPTlRFTlQnKSB7XG4gICAgICBhbmNob3IuY29udGVudEVsZW1lbnQgPSBmaXJzdENoaWxkO1xuICAgIH1cblxuICAgIGFuY2hvci5fZWxlbWVudCA9IGVsZW1lbnQ7XG5cbiAgICBhbmNob3IuaGFzQXR0cmlidXRlID0gaGFzQXR0cmlidXRlO1xuICAgIGFuY2hvci5nZXRBdHRyaWJ1dGUgPSBnZXRBdHRyaWJ1dGU7XG4gICAgYW5jaG9yLnNldEF0dHJpYnV0ZSA9IHNldEF0dHJpYnV0ZTtcbiAgfVxuXG4gIERPTS5yZXBsYWNlTm9kZShhbmNob3IsIGVsZW1lbnQpO1xuXG4gIHJldHVybiBhbmNob3I7XG59XG5cbmZ1bmN0aW9uIGFwcGx5SW5zdHJ1Y3Rpb25zKGNvbnRhaW5lcnMsIGVsZW1lbnQsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cywgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKSB7XG4gIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zO1xuICB2YXIgZXhwcmVzc2lvbnMgPSBpbnN0cnVjdGlvbi5leHByZXNzaW9ucztcbiAgdmFyIGVsZW1lbnRDb250YWluZXIgPSB2b2lkIDA7XG4gIHZhciBpID0gdm9pZCAwO1xuICB2YXIgaWkgPSB2b2lkIDA7XG4gIHZhciBjdXJyZW50ID0gdm9pZCAwO1xuICB2YXIgaW5zdGFuY2UgPSB2b2lkIDA7XG5cbiAgaWYgKGluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uKSB7XG4gICAgYmluZGluZ3MucHVzaChpbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbi5jcmVhdGVCaW5kaW5nKGVsZW1lbnQubmV4dFNpYmxpbmcpKTtcbiAgICBlbGVtZW50Lm5leHRTaWJsaW5nLmF1SW50ZXJwb2xhdGlvblRhcmdldCA9IHRydWU7XG4gICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpbnN0cnVjdGlvbi5zaGFkb3dTbG90KSB7XG4gICAgdmFyIGNvbW1lbnRBbmNob3IgPSBET00uY3JlYXRlQ29tbWVudCgnc2xvdCcpO1xuICAgIHZhciBzbG90ID0gdm9pZCAwO1xuXG4gICAgaWYgKGluc3RydWN0aW9uLnNsb3REZXN0aW5hdGlvbikge1xuICAgICAgc2xvdCA9IG5ldyBQYXNzVGhyb3VnaFNsb3QoY29tbWVudEFuY2hvciwgaW5zdHJ1Y3Rpb24uc2xvdE5hbWUsIGluc3RydWN0aW9uLnNsb3REZXN0aW5hdGlvbiwgaW5zdHJ1Y3Rpb24uc2xvdEZhbGxiYWNrRmFjdG9yeSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNsb3QgPSBuZXcgU2hhZG93U2xvdChjb21tZW50QW5jaG9yLCBpbnN0cnVjdGlvbi5zbG90TmFtZSwgaW5zdHJ1Y3Rpb24uc2xvdEZhbGxiYWNrRmFjdG9yeSk7XG4gICAgfVxuXG4gICAgRE9NLnJlcGxhY2VOb2RlKGNvbW1lbnRBbmNob3IsIGVsZW1lbnQpO1xuICAgIHNoYWRvd1Nsb3RzW2luc3RydWN0aW9uLnNsb3ROYW1lXSA9IHNsb3Q7XG4gICAgY29udHJvbGxlcnMucHVzaChzbG90KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaW5zdHJ1Y3Rpb24ubGV0RWxlbWVudCkge1xuICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgYmluZGluZ3MucHVzaChleHByZXNzaW9uc1tpXS5jcmVhdGVCaW5kaW5nKCkpO1xuICAgIH1cbiAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCkge1xuICAgIGlmICghaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpIHtcbiAgICAgIGVsZW1lbnQgPSBtYWtlRWxlbWVudEludG9BbmNob3IoZWxlbWVudCwgaW5zdHJ1Y3Rpb24uZWxlbWVudEluc3RydWN0aW9uKTtcbiAgICB9XG5cbiAgICBjb250YWluZXJzW2luc3RydWN0aW9uLmluamVjdG9ySWRdID0gZWxlbWVudENvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnRDb250YWluZXIoY29udGFpbmVyc1tpbnN0cnVjdGlvbi5wYXJlbnRJbmplY3RvcklkXSwgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNoaWxkcmVuLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjdXJyZW50ID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XG4gICAgICBpbnN0YW5jZSA9IGN1cnJlbnQudHlwZS5jcmVhdGUoZWxlbWVudENvbnRhaW5lciwgY3VycmVudCwgZWxlbWVudCwgYmluZGluZ3MpO1xuICAgICAgY29udHJvbGxlcnMucHVzaChpbnN0YW5jZSk7XG4gICAgfVxuICB9XG5cbiAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgYmluZGluZ3MucHVzaChleHByZXNzaW9uc1tpXS5jcmVhdGVCaW5kaW5nKGVsZW1lbnQpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzdHlsZVN0cmluZ1RvT2JqZWN0KHN0eWxlLCB0YXJnZXQpIHtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBzdHlsZS5zcGxpdCgnOycpO1xuICB2YXIgZmlyc3RJbmRleE9mQ29sb24gPSB2b2lkIDA7XG4gIHZhciBpID0gdm9pZCAwO1xuICB2YXIgY3VycmVudCA9IHZvaWQgMDtcbiAgdmFyIGtleSA9IHZvaWQgMDtcbiAgdmFyIHZhbHVlID0gdm9pZCAwO1xuXG4gIHRhcmdldCA9IHRhcmdldCB8fCB7fTtcblxuICBmb3IgKGkgPSAwOyBpIDwgYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuICAgIGN1cnJlbnQgPSBhdHRyaWJ1dGVzW2ldO1xuICAgIGZpcnN0SW5kZXhPZkNvbG9uID0gY3VycmVudC5pbmRleE9mKCc6Jyk7XG4gICAga2V5ID0gY3VycmVudC5zdWJzdHJpbmcoMCwgZmlyc3RJbmRleE9mQ29sb24pLnRyaW0oKTtcbiAgICB2YWx1ZSA9IGN1cnJlbnQuc3Vic3RyaW5nKGZpcnN0SW5kZXhPZkNvbG9uICsgMSkudHJpbSgpO1xuICAgIHRhcmdldFtrZXldID0gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufVxuXG5mdW5jdGlvbiBzdHlsZU9iamVjdFRvU3RyaW5nKG9iaikge1xuICB2YXIgcmVzdWx0ID0gJyc7XG5cbiAgZm9yICh2YXIgX2tleTQgaW4gb2JqKSB7XG4gICAgcmVzdWx0ICs9IF9rZXk0ICsgJzonICsgb2JqW19rZXk0XSArICc7JztcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGFwcGx5U3Vycm9nYXRlSW5zdHJ1Y3Rpb24oY29udGFpbmVyLCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbikge1xuICB2YXIgYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucztcbiAgdmFyIGV4cHJlc3Npb25zID0gaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnM7XG4gIHZhciBwcm92aWRlcnMgPSBpbnN0cnVjdGlvbi5wcm92aWRlcnM7XG4gIHZhciB2YWx1ZXMgPSBpbnN0cnVjdGlvbi52YWx1ZXM7XG4gIHZhciBpID0gdm9pZCAwO1xuICB2YXIgaWkgPSB2b2lkIDA7XG4gIHZhciBjdXJyZW50ID0gdm9pZCAwO1xuICB2YXIgaW5zdGFuY2UgPSB2b2lkIDA7XG4gIHZhciBjdXJyZW50QXR0cmlidXRlVmFsdWUgPSB2b2lkIDA7XG5cbiAgaSA9IHByb3ZpZGVycy5sZW5ndGg7XG4gIHdoaWxlIChpLS0pIHtcbiAgICBjb250YWluZXIuX3Jlc29sdmVycy5zZXQocHJvdmlkZXJzW2ldLCBwcm92aWRlclJlc29sdmVySW5zdGFuY2UpO1xuICB9XG5cbiAgZm9yICh2YXIgX2tleTUgaW4gdmFsdWVzKSB7XG4gICAgY3VycmVudEF0dHJpYnV0ZVZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoX2tleTUpO1xuXG4gICAgaWYgKGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSkge1xuICAgICAgaWYgKF9rZXk1ID09PSAnY2xhc3MnKSB7XG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsIGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSArICcgJyArIHZhbHVlc1tfa2V5NV0pO1xuICAgICAgfSBlbHNlIGlmIChfa2V5NSA9PT0gJ3N0eWxlJykge1xuICAgICAgICB2YXIgc3R5bGVPYmplY3QgPSBzdHlsZVN0cmluZ1RvT2JqZWN0KHZhbHVlc1tfa2V5NV0pO1xuICAgICAgICBzdHlsZVN0cmluZ1RvT2JqZWN0KGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSwgc3R5bGVPYmplY3QpO1xuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZU9iamVjdFRvU3RyaW5nKHN0eWxlT2JqZWN0KSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKF9rZXk1LCB2YWx1ZXNbX2tleTVdKTtcbiAgICB9XG4gIH1cblxuICBpZiAoYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoKSB7XG4gICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBjdXJyZW50ID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XG4gICAgICBpbnN0YW5jZSA9IGN1cnJlbnQudHlwZS5jcmVhdGUoY29udGFpbmVyLCBjdXJyZW50LCBlbGVtZW50LCBiaW5kaW5ncyk7XG5cbiAgICAgIGlmIChpbnN0YW5jZS5jb250ZW50Vmlldykge1xuICAgICAgICBjaGlsZHJlbi5wdXNoKGluc3RhbmNlLmNvbnRlbnRWaWV3KTtcbiAgICAgIH1cblxuICAgICAgY29udHJvbGxlcnMucHVzaChpbnN0YW5jZSk7XG4gICAgfVxuICB9XG5cbiAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgYmluZGluZ3MucHVzaChleHByZXNzaW9uc1tpXS5jcmVhdGVCaW5kaW5nKGVsZW1lbnQpKTtcbiAgfVxufVxuXG5leHBvcnQgdmFyIEJvdW5kVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJvdW5kVmlld0ZhY3RvcnkocGFyZW50Q29udGFpbmVyLCB2aWV3RmFjdG9yeSwgcGFydFJlcGxhY2VtZW50cykge1xuICAgIFxuXG4gICAgdGhpcy5wYXJlbnRDb250YWluZXIgPSBwYXJlbnRDb250YWluZXI7XG4gICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIHRoaXMuZmFjdG9yeUNyZWF0ZUluc3RydWN0aW9uID0geyBwYXJ0UmVwbGFjZW1lbnRzOiBwYXJ0UmVwbGFjZW1lbnRzIH07XG4gIH1cblxuICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSh0aGlzLnBhcmVudENvbnRhaW5lci5jcmVhdGVDaGlsZCgpLCB0aGlzLmZhY3RvcnlDcmVhdGVJbnN0cnVjdGlvbik7XG4gICAgdmlldy5faXNVc2VyQ29udHJvbGxlZCA9IHRydWU7XG4gICAgcmV0dXJuIHZpZXc7XG4gIH07XG5cbiAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gc2V0Q2FjaGVTaXplKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcbiAgICB0aGlzLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KTtcbiAgfTtcblxuICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gZ2V0Q2FjaGVkVmlldygpIHtcbiAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5nZXRDYWNoZWRWaWV3KCk7XG4gIH07XG5cbiAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiByZXR1cm5WaWV3VG9DYWNoZSh2aWV3KSB7XG4gICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh2aWV3KTtcbiAgfTtcblxuICBfY3JlYXRlQ2xhc3MoQm91bmRWaWV3RmFjdG9yeSwgW3tcbiAgICBrZXk6ICdpc0NhY2hpbmcnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBCb3VuZFZpZXdGYWN0b3J5O1xufSgpO1xuXG5leHBvcnQgdmFyIFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWaWV3RmFjdG9yeSh0ZW1wbGF0ZSwgaW5zdHJ1Y3Rpb25zLCByZXNvdXJjZXMpIHtcbiAgICBcblxuICAgIHRoaXMuaXNDYWNoaW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7XG4gICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XG4gICAgdGhpcy5jYWNoZVNpemUgPSAtMTtcbiAgICB0aGlzLmNhY2hlID0gbnVsbDtcbiAgfVxuXG4gIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5zZXRDYWNoZVNpemUgPSBmdW5jdGlvbiBzZXRDYWNoZVNpemUoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCkge1xuICAgIGlmIChzaXplKSB7XG4gICAgICBpZiAoc2l6ZSA9PT0gJyonKSB7XG4gICAgICAgIHNpemUgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2l6ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgc2l6ZSA9IHBhcnNlSW50KHNpemUsIDEwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYWNoZVNpemUgPT09IC0xIHx8ICFkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KSB7XG4gICAgICB0aGlzLmNhY2hlU2l6ZSA9IHNpemU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FjaGVTaXplID4gMCkge1xuICAgICAgdGhpcy5jYWNoZSA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNhY2hlID0gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLmlzQ2FjaGluZyA9IHRoaXMuY2FjaGVTaXplID4gMDtcbiAgfTtcblxuICBWaWV3RmFjdG9yeS5wcm90b3R5cGUuZ2V0Q2FjaGVkVmlldyA9IGZ1bmN0aW9uIGdldENhY2hlZFZpZXcoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FjaGUgIT09IG51bGwgPyB0aGlzLmNhY2hlLnBvcCgpIHx8IG51bGwgOiBudWxsO1xuICB9O1xuXG4gIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5yZXR1cm5WaWV3VG9DYWNoZSA9IGZ1bmN0aW9uIHJldHVyblZpZXdUb0NhY2hlKHZpZXcpIHtcbiAgICBpZiAodmlldy5pc0F0dGFjaGVkKSB7XG4gICAgICB2aWV3LmRldGFjaGVkKCk7XG4gICAgfVxuXG4gICAgaWYgKHZpZXcuaXNCb3VuZCkge1xuICAgICAgdmlldy51bmJpbmQoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYWNoZSAhPT0gbnVsbCAmJiB0aGlzLmNhY2hlLmxlbmd0aCA8IHRoaXMuY2FjaGVTaXplKSB7XG4gICAgICB2aWV3LmZyb21DYWNoZSA9IHRydWU7XG4gICAgICB0aGlzLmNhY2hlLnB1c2godmlldyk7XG4gICAgfVxuICB9O1xuXG4gIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoY29udGFpbmVyLCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCkge1xuICAgIGNyZWF0ZUluc3RydWN0aW9uID0gY3JlYXRlSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWw7XG5cbiAgICB2YXIgY2FjaGVkVmlldyA9IHRoaXMuZ2V0Q2FjaGVkVmlldygpO1xuICAgIGlmIChjYWNoZWRWaWV3ICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gY2FjaGVkVmlldztcbiAgICB9XG5cbiAgICB2YXIgZnJhZ21lbnQgPSBjcmVhdGVJbnN0cnVjdGlvbi5lbmhhbmNlID8gdGhpcy50ZW1wbGF0ZSA6IHRoaXMudGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICAgIHZhciBpbnN0cnVjdGFibGVzID0gZnJhZ21lbnQucXVlcnlTZWxlY3RvckFsbCgnLmF1LXRhcmdldCcpO1xuICAgIHZhciBpbnN0cnVjdGlvbnMgPSB0aGlzLmluc3RydWN0aW9ucztcbiAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XG4gICAgdmFyIGNvbnRyb2xsZXJzID0gW107XG4gICAgdmFyIGJpbmRpbmdzID0gW107XG4gICAgdmFyIGNoaWxkcmVuID0gW107XG4gICAgdmFyIHNoYWRvd1Nsb3RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB2YXIgY29udGFpbmVycyA9IHsgcm9vdDogY29udGFpbmVyIH07XG4gICAgdmFyIHBhcnRSZXBsYWNlbWVudHMgPSBjcmVhdGVJbnN0cnVjdGlvbi5wYXJ0UmVwbGFjZW1lbnRzO1xuICAgIHZhciBpID0gdm9pZCAwO1xuICAgIHZhciBpaSA9IHZvaWQgMDtcbiAgICB2YXIgdmlldyA9IHZvaWQgMDtcbiAgICB2YXIgaW5zdHJ1Y3RhYmxlID0gdm9pZCAwO1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IHZvaWQgMDtcblxuICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVDcmVhdGUnLCB0aGlzLCBjb250YWluZXIsIGZyYWdtZW50LCBjcmVhdGVJbnN0cnVjdGlvbik7XG5cbiAgICBpZiAoZWxlbWVudCAmJiB0aGlzLnN1cnJvZ2F0ZUluc3RydWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBhcHBseVN1cnJvZ2F0ZUluc3RydWN0aW9uKGNvbnRhaW5lciwgZWxlbWVudCwgdGhpcy5zdXJyb2dhdGVJbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbik7XG4gICAgfVxuXG4gICAgaWYgKGNyZWF0ZUluc3RydWN0aW9uLmVuaGFuY2UgJiYgZnJhZ21lbnQuaGFzQXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKSkge1xuICAgICAgaW5zdHJ1Y3RhYmxlID0gZnJhZ21lbnQ7XG4gICAgICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uc1tpbnN0cnVjdGFibGUuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKV07XG4gICAgICBhcHBseUluc3RydWN0aW9ucyhjb250YWluZXJzLCBpbnN0cnVjdGFibGUsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cywgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKTtcbiAgICB9XG5cbiAgICBmb3IgKGkgPSAwLCBpaSA9IGluc3RydWN0YWJsZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgaW5zdHJ1Y3RhYmxlID0gaW5zdHJ1Y3RhYmxlc1tpXTtcbiAgICAgIGluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb25zW2luc3RydWN0YWJsZS5nZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpXTtcbiAgICAgIGFwcGx5SW5zdHJ1Y3Rpb25zKGNvbnRhaW5lcnMsIGluc3RydWN0YWJsZSwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpO1xuICAgIH1cblxuICAgIHZpZXcgPSBuZXcgVmlldyhjb250YWluZXIsIHRoaXMsIGZyYWdtZW50LCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cyk7XG5cbiAgICBpZiAoIWNyZWF0ZUluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IpIHtcbiAgICAgIHZpZXcuY3JlYXRlZCgpO1xuICAgIH1cblxuICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdhZnRlckNyZWF0ZScsIHZpZXcpO1xuXG4gICAgcmV0dXJuIHZpZXc7XG4gIH07XG5cbiAgcmV0dXJuIFZpZXdGYWN0b3J5O1xufSgpO1xuXG52YXIgbmV4dEluamVjdG9ySWQgPSAwO1xuZnVuY3Rpb24gZ2V0TmV4dEluamVjdG9ySWQoKSB7XG4gIHJldHVybiArK25leHRJbmplY3RvcklkO1xufVxuXG52YXIgbGFzdEFVVGFyZ2V0SUQgPSAwO1xuZnVuY3Rpb24gZ2V0TmV4dEFVVGFyZ2V0SUQoKSB7XG4gIHJldHVybiAoKytsYXN0QVVUYXJnZXRJRCkudG9TdHJpbmcoKTtcbn1cblxuZnVuY3Rpb24gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChlbGVtZW50KSB7XG4gIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpO1xuICB2YXIgYXVUYXJnZXRJRCA9IGdldE5leHRBVVRhcmdldElEKCk7XG5cbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgdmFsdWUgPyB2YWx1ZSArICcgYXUtdGFyZ2V0JyA6ICdhdS10YXJnZXQnKTtcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcsIGF1VGFyZ2V0SUQpO1xuXG4gIHJldHVybiBhdVRhcmdldElEO1xufVxuXG5mdW5jdGlvbiBtYWtlU2hhZG93U2xvdChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbnMsIHBhcmVudEluamVjdG9ySWQpIHtcbiAgdmFyIGF1U2hhZG93U2xvdCA9IERPTS5jcmVhdGVFbGVtZW50KCdhdS1zaGFkb3ctc2xvdCcpO1xuICBET00ucmVwbGFjZU5vZGUoYXVTaGFkb3dTbG90LCBub2RlKTtcblxuICB2YXIgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQoYXVTaGFkb3dTbG90KTtcbiAgdmFyIGluc3RydWN0aW9uID0gVGFyZ2V0SW5zdHJ1Y3Rpb24uc2hhZG93U2xvdChwYXJlbnRJbmplY3RvcklkKTtcblxuICBpbnN0cnVjdGlvbi5zbG90TmFtZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCduYW1lJykgfHwgU2hhZG93RE9NLmRlZmF1bHRTbG90S2V5O1xuICBpbnN0cnVjdGlvbi5zbG90RGVzdGluYXRpb24gPSBub2RlLmdldEF0dHJpYnV0ZSgnc2xvdCcpO1xuXG4gIGlmIChub2RlLmlubmVySFRNTC50cmltKCkpIHtcbiAgICB2YXIgZnJhZ21lbnQgPSBET00uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHZhciBfY2hpbGQ0ID0gdm9pZCAwO1xuXG4gICAgd2hpbGUgKF9jaGlsZDQgPSBub2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKF9jaGlsZDQpO1xuICAgIH1cblxuICAgIGluc3RydWN0aW9uLnNsb3RGYWxsYmFja0ZhY3RvcnkgPSBjb21waWxlci5jb21waWxlKGZyYWdtZW50LCByZXNvdXJjZXMpO1xuICB9XG5cbiAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gaW5zdHJ1Y3Rpb247XG5cbiAgcmV0dXJuIGF1U2hhZG93U2xvdDtcbn1cblxudmFyIGRlZmF1bHRMZXRIYW5kbGVyID0gQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5jcmVhdGVMZXRFeHByZXNzaW9ucztcblxuZXhwb3J0IHZhciBWaWV3Q29tcGlsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIFZpZXdDb21waWxlci5pbmplY3QgPSBmdW5jdGlvbiBpbmplY3QoKSB7XG4gICAgcmV0dXJuIFtCaW5kaW5nTGFuZ3VhZ2UsIFZpZXdSZXNvdXJjZXNdO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFZpZXdDb21waWxlcihiaW5kaW5nTGFuZ3VhZ2UsIHJlc291cmNlcykge1xuICAgIFxuXG4gICAgdGhpcy5iaW5kaW5nTGFuZ3VhZ2UgPSBiaW5kaW5nTGFuZ3VhZ2U7XG4gICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XG4gIH1cblxuICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLmNvbXBpbGUgPSBmdW5jdGlvbiBjb21waWxlKHNvdXJjZSwgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24pIHtcbiAgICByZXNvdXJjZXMgPSByZXNvdXJjZXMgfHwgdGhpcy5yZXNvdXJjZXM7XG4gICAgY29tcGlsZUluc3RydWN0aW9uID0gY29tcGlsZUluc3RydWN0aW9uIHx8IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24ubm9ybWFsO1xuICAgIHNvdXJjZSA9IHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnID8gRE9NLmNyZWF0ZVRlbXBsYXRlRnJvbU1hcmt1cChzb3VyY2UpIDogc291cmNlO1xuXG4gICAgdmFyIGNvbnRlbnQgPSB2b2lkIDA7XG4gICAgdmFyIHBhcnQgPSB2b2lkIDA7XG4gICAgdmFyIGNhY2hlU2l6ZSA9IHZvaWQgMDtcblxuICAgIGlmIChzb3VyY2UuY29udGVudCkge1xuICAgICAgcGFydCA9IHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3BhcnQnKTtcbiAgICAgIGNhY2hlU2l6ZSA9IHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcbiAgICAgIGNvbnRlbnQgPSBET00uYWRvcHROb2RlKHNvdXJjZS5jb250ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGVudCA9IHNvdXJjZTtcbiAgICB9XG5cbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NID0gY29tcGlsZUluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSAmJiBGRUFUVVJFLnNoYWRvd0RPTTtcbiAgICByZXNvdXJjZXMuX2ludm9rZUhvb2soJ2JlZm9yZUNvbXBpbGUnLCBjb250ZW50LCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbik7XG5cbiAgICB2YXIgaW5zdHJ1Y3Rpb25zID0ge307XG4gICAgdGhpcy5fY29tcGlsZU5vZGUoY29udGVudCwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHNvdXJjZSwgJ3Jvb3QnLCAhY29tcGlsZUluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSk7XG5cbiAgICB2YXIgZmlyc3RDaGlsZCA9IGNvbnRlbnQuZmlyc3RDaGlsZDtcbiAgICBpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICB2YXIgdGFyZ2V0SWQgPSBmaXJzdENoaWxkLmdldEF0dHJpYnV0ZSgnYXUtdGFyZ2V0LWlkJyk7XG4gICAgICBpZiAodGFyZ2V0SWQpIHtcbiAgICAgICAgdmFyIGlucyA9IGluc3RydWN0aW9uc1t0YXJnZXRJZF07XG5cbiAgICAgICAgaWYgKGlucy5zaGFkb3dTbG90IHx8IGlucy5saWZ0aW5nIHx8IGlucy5lbGVtZW50SW5zdHJ1Y3Rpb24gJiYgIWlucy5lbGVtZW50SW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpIHtcbiAgICAgICAgICBjb250ZW50Lmluc2VydEJlZm9yZShET00uY3JlYXRlQ29tbWVudCgndmlldycpLCBmaXJzdENoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBmYWN0b3J5ID0gbmV3IFZpZXdGYWN0b3J5KGNvbnRlbnQsIGluc3RydWN0aW9ucywgcmVzb3VyY2VzKTtcblxuICAgIGZhY3Rvcnkuc3Vycm9nYXRlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24uY29tcGlsZVN1cnJvZ2F0ZSA/IHRoaXMuX2NvbXBpbGVTdXJyb2dhdGUoc291cmNlLCByZXNvdXJjZXMpIDogbnVsbDtcbiAgICBmYWN0b3J5LnBhcnQgPSBwYXJ0O1xuXG4gICAgaWYgKGNhY2hlU2l6ZSkge1xuICAgICAgZmFjdG9yeS5zZXRDYWNoZVNpemUoY2FjaGVTaXplKTtcbiAgICB9XG5cbiAgICByZXNvdXJjZXMuX2ludm9rZUhvb2soJ2FmdGVyQ29tcGlsZScsIGZhY3RvcnkpO1xuXG4gICAgcmV0dXJuIGZhY3Rvcnk7XG4gIH07XG5cbiAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29tcGlsZU5vZGUgPSBmdW5jdGlvbiBfY29tcGlsZU5vZGUobm9kZSwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHBhcmVudE5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKSB7XG4gICAgc3dpdGNoIChub2RlLm5vZGVUeXBlKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB0aGlzLl9jb21waWxlRWxlbWVudChub2RlLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgcGFyZW50Tm9kZSwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pO1xuICAgICAgY2FzZSAzOlxuICAgICAgICB2YXIgZXhwcmVzc2lvbiA9IHJlc291cmNlcy5nZXRCaW5kaW5nTGFuZ3VhZ2UodGhpcy5iaW5kaW5nTGFuZ3VhZ2UpLmluc3BlY3RUZXh0Q29udGVudChyZXNvdXJjZXMsIG5vZGUud2hvbGVUZXh0KTtcbiAgICAgICAgaWYgKGV4cHJlc3Npb24pIHtcbiAgICAgICAgICB2YXIgbWFya2VyID0gRE9NLmNyZWF0ZUVsZW1lbnQoJ2F1LW1hcmtlcicpO1xuICAgICAgICAgIHZhciBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChtYXJrZXIpO1xuICAgICAgICAgIChub2RlLnBhcmVudE5vZGUgfHwgcGFyZW50Tm9kZSkuaW5zZXJ0QmVmb3JlKG1hcmtlciwgbm9kZSk7XG4gICAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9ICcgJztcbiAgICAgICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbihleHByZXNzaW9uKTtcblxuICAgICAgICAgIHdoaWxlIChub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgIChub2RlLnBhcmVudE5vZGUgfHwgcGFyZW50Tm9kZSkucmVtb3ZlQ2hpbGQobm9kZS5uZXh0U2libGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdoaWxlIChub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgICAgIGNhc2UgMTE6XG4gICAgICAgIHZhciBjdXJyZW50Q2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XG4gICAgICAgIHdoaWxlIChjdXJyZW50Q2hpbGQpIHtcbiAgICAgICAgICBjdXJyZW50Q2hpbGQgPSB0aGlzLl9jb21waWxlTm9kZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBub2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgfTtcblxuICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb21waWxlU3Vycm9nYXRlID0gZnVuY3Rpb24gX2NvbXBpbGVTdXJyb2dhdGUobm9kZSwgcmVzb3VyY2VzKSB7XG4gICAgdmFyIHRhZ05hbWUgPSBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlcztcbiAgICB2YXIgYmluZGluZ0xhbmd1YWdlID0gcmVzb3VyY2VzLmdldEJpbmRpbmdMYW5ndWFnZSh0aGlzLmJpbmRpbmdMYW5ndWFnZSk7XG4gICAgdmFyIGtub3duQXR0cmlidXRlID0gdm9pZCAwO1xuICAgIHZhciBwcm9wZXJ0eSA9IHZvaWQgMDtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBhdHRyID0gdm9pZCAwO1xuICAgIHZhciBhdHRyTmFtZSA9IHZvaWQgMDtcbiAgICB2YXIgYXR0clZhbHVlID0gdm9pZCAwO1xuICAgIHZhciBpbmZvID0gdm9pZCAwO1xuICAgIHZhciB0eXBlID0gdm9pZCAwO1xuICAgIHZhciBleHByZXNzaW9ucyA9IFtdO1xuICAgIHZhciBleHByZXNzaW9uID0gdm9pZCAwO1xuICAgIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IFtdO1xuICAgIHZhciB2YWx1ZXMgPSB7fTtcbiAgICB2YXIgaGFzVmFsdWVzID0gZmFsc2U7XG4gICAgdmFyIHByb3ZpZGVycyA9IFtdO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGF0dHIgPSBhdHRyaWJ1dGVzW2ldO1xuICAgICAgYXR0ck5hbWUgPSBhdHRyLm5hbWU7XG4gICAgICBhdHRyVmFsdWUgPSBhdHRyLnZhbHVlO1xuXG4gICAgICBpbmZvID0gYmluZGluZ0xhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCB0YWdOYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKTtcbiAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgICBpZiAodHlwZSkge1xuICAgICAgICBrbm93bkF0dHJpYnV0ZSA9IHJlc291cmNlcy5tYXBBdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG4gICAgICAgIGlmIChrbm93bkF0dHJpYnV0ZSkge1xuICAgICAgICAgIHByb3BlcnR5ID0gdHlwZS5hdHRyaWJ1dGVzW2tub3duQXR0cmlidXRlXTtcblxuICAgICAgICAgIGlmIChwcm9wZXJ0eSkge1xuICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBwcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XG5cbiAgICAgICAgICAgIGlmICghaW5mby5jb21tYW5kICYmICFpbmZvLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgICAgaW5mby5jb21tYW5kID0gcHJvcGVydHkuaGFzT3B0aW9ucyA/ICdvcHRpb25zJyA6IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpbmZvLmNvbW1hbmQgJiYgaW5mby5jb21tYW5kICE9PSAnb3B0aW9ucycgJiYgdHlwZS5wcmltYXJ5UHJvcGVydHkpIHtcbiAgICAgICAgICAgICAgdmFyIF9wcmltYXJ5UHJvcGVydHkgPSB0eXBlLnByaW1hcnlQcm9wZXJ0eTtcbiAgICAgICAgICAgICAgYXR0ck5hbWUgPSBpbmZvLmF0dHJOYW1lID0gX3ByaW1hcnlQcm9wZXJ0eS5hdHRyaWJ1dGU7XG5cbiAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBfcHJpbWFyeVByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCB1bmRlZmluZWQsIHR5cGUpO1xuXG4gICAgICBpZiAoaW5zdHJ1Y3Rpb24pIHtcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmFsdGVyZWRBdHRyKSB7XG4gICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5zdHJ1Y3Rpb24uYXR0ck5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmRpc2NyZXRlKSB7XG4gICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdGhpcy5fY29uZmlndXJlUHJvcGVydGllcyhpbnN0cnVjdGlvbiwgcmVzb3VyY2VzKTtcblxuICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGNhbm5vdCBwbGFjZSBhIHRlbXBsYXRlIGNvbnRyb2xsZXIgb24gYSBzdXJyb2dhdGUgZWxlbWVudC4nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5zdHJ1Y3Rpb24uYXR0ck5hbWVdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShhdHRyTmFtZSwgdHlwZSk7XG4gICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tyZXNvdXJjZXMubWFwQXR0cmlidXRlKGF0dHJOYW1lKV0gPSBhdHRyVmFsdWU7XG5cbiAgICAgICAgICBpZiAodHlwZS5saWZ0c0NvbnRlbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGNhbm5vdCBwbGFjZSBhIHRlbXBsYXRlIGNvbnRyb2xsZXIgb24gYSBzdXJyb2dhdGUgZWxlbWVudC4nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGF0dHJOYW1lICE9PSAnaWQnICYmIGF0dHJOYW1lICE9PSAncGFydCcgJiYgYXR0ck5hbWUgIT09ICdyZXBsYWNlLXBhcnQnKSB7XG4gICAgICAgICAgaGFzVmFsdWVzID0gdHJ1ZTtcbiAgICAgICAgICB2YWx1ZXNbYXR0ck5hbWVdID0gYXR0clZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGV4cHJlc3Npb25zLmxlbmd0aCB8fCBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGggfHwgaGFzVmFsdWVzKSB7XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcbiAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZS5jb21waWxlKHRoaXMsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pO1xuICAgICAgICBwcm92aWRlcnMucHVzaChpbnN0cnVjdGlvbi50eXBlLnRhcmdldCk7XG4gICAgICB9XG5cbiAgICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbnNbaV07XG4gICAgICAgIGlmIChleHByZXNzaW9uLmF0dHJUb1JlbW92ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoZXhwcmVzc2lvbi5hdHRyVG9SZW1vdmUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBUYXJnZXRJbnN0cnVjdGlvbi5zdXJyb2dhdGUocHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIHZhbHVlcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29tcGlsZUVsZW1lbnQgPSBmdW5jdGlvbiBfY29tcGlsZUVsZW1lbnQobm9kZSwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHBhcmVudE5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKSB7XG4gICAgdmFyIHRhZ05hbWUgPSBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlcztcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBbXTtcbiAgICB2YXIgZXhwcmVzc2lvbiA9IHZvaWQgMDtcbiAgICB2YXIgYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBbXTtcbiAgICB2YXIgcHJvdmlkZXJzID0gW107XG4gICAgdmFyIGJpbmRpbmdMYW5ndWFnZSA9IHJlc291cmNlcy5nZXRCaW5kaW5nTGFuZ3VhZ2UodGhpcy5iaW5kaW5nTGFuZ3VhZ2UpO1xuICAgIHZhciBsaWZ0aW5nSW5zdHJ1Y3Rpb24gPSB2b2lkIDA7XG4gICAgdmFyIHZpZXdGYWN0b3J5ID0gdm9pZCAwO1xuICAgIHZhciB0eXBlID0gdm9pZCAwO1xuICAgIHZhciBlbGVtZW50SW5zdHJ1Y3Rpb24gPSB2b2lkIDA7XG4gICAgdmFyIGVsZW1lbnRQcm9wZXJ0eSA9IHZvaWQgMDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIGF0dHIgPSB2b2lkIDA7XG4gICAgdmFyIGF0dHJOYW1lID0gdm9pZCAwO1xuICAgIHZhciBhdHRyVmFsdWUgPSB2b2lkIDA7XG4gICAgdmFyIG9yaWdpbmFsQXR0ck5hbWUgPSB2b2lkIDA7XG4gICAgdmFyIGluc3RydWN0aW9uID0gdm9pZCAwO1xuICAgIHZhciBpbmZvID0gdm9pZCAwO1xuICAgIHZhciBwcm9wZXJ0eSA9IHZvaWQgMDtcbiAgICB2YXIga25vd25BdHRyaWJ1dGUgPSB2b2lkIDA7XG4gICAgdmFyIGF1VGFyZ2V0SUQgPSB2b2lkIDA7XG4gICAgdmFyIGluamVjdG9ySWQgPSB2b2lkIDA7XG5cbiAgICBpZiAodGFnTmFtZSA9PT0gJ3Nsb3QnKSB7XG4gICAgICBpZiAodGFyZ2V0TGlnaHRET00pIHtcbiAgICAgICAgbm9kZSA9IG1ha2VTaGFkb3dTbG90KHRoaXMsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb25zLCBwYXJlbnRJbmplY3RvcklkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xuICAgIH0gZWxzZSBpZiAodGFnTmFtZSA9PT0gJ3RlbXBsYXRlJykge1xuICAgICAgaWYgKCEoJ2NvbnRlbnQnIGluIG5vZGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGNhbm5vdCBwbGFjZSBhIHRlbXBsYXRlIGVsZW1lbnQgd2l0aGluICcgKyBub2RlLm5hbWVzcGFjZVVSSSArICcgbmFtZXNwYWNlJyk7XG4gICAgICB9XG4gICAgICB2aWV3RmFjdG9yeSA9IHRoaXMuY29tcGlsZShub2RlLCByZXNvdXJjZXMpO1xuICAgICAgdmlld0ZhY3RvcnkucGFydCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdwYXJ0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0RWxlbWVudChub2RlLmdldEF0dHJpYnV0ZSgnYXMtZWxlbWVudCcpIHx8IHRhZ05hbWUpO1xuXG4gICAgICBpZiAodGFnTmFtZSA9PT0gJ2xldCcgJiYgIXR5cGUgJiYgYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUxldEV4cHJlc3Npb25zICE9PSBkZWZhdWx0TGV0SGFuZGxlcikge1xuICAgICAgICBleHByZXNzaW9ucyA9IGJpbmRpbmdMYW5ndWFnZS5jcmVhdGVMZXRFeHByZXNzaW9ucyhyZXNvdXJjZXMsIG5vZGUpO1xuICAgICAgICBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChub2RlKTtcbiAgICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubGV0RWxlbWVudChleHByZXNzaW9ucyk7XG4gICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgZWxlbWVudEluc3RydWN0aW9uID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5lbGVtZW50KG5vZGUsIHR5cGUpO1xuICAgICAgICB0eXBlLnByb2Nlc3NBdHRyaWJ1dGVzKHRoaXMsIHJlc291cmNlcywgbm9kZSwgYXR0cmlidXRlcywgZWxlbWVudEluc3RydWN0aW9uKTtcbiAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChlbGVtZW50SW5zdHJ1Y3Rpb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoaSA9IDAsIGlpID0gYXR0cmlidXRlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICBhdHRyID0gYXR0cmlidXRlc1tpXTtcbiAgICAgIG9yaWdpbmFsQXR0ck5hbWUgPSBhdHRyTmFtZSA9IGF0dHIubmFtZTtcbiAgICAgIGF0dHJWYWx1ZSA9IGF0dHIudmFsdWU7XG4gICAgICBpbmZvID0gYmluZGluZ0xhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCB0YWdOYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKTtcblxuICAgICAgaWYgKHRhcmdldExpZ2h0RE9NICYmIGluZm8uYXR0ck5hbWUgPT09ICdzbG90Jykge1xuICAgICAgICBpbmZvLmF0dHJOYW1lID0gYXR0ck5hbWUgPSAnYXUtc2xvdCc7XG4gICAgICB9XG5cbiAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuICAgICAgZWxlbWVudFByb3BlcnR5ID0gbnVsbDtcblxuICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAga25vd25BdHRyaWJ1dGUgPSByZXNvdXJjZXMubWFwQXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuICAgICAgICBpZiAoa25vd25BdHRyaWJ1dGUpIHtcbiAgICAgICAgICBwcm9wZXJ0eSA9IHR5cGUuYXR0cmlidXRlc1trbm93bkF0dHJpYnV0ZV07XG5cbiAgICAgICAgICBpZiAocHJvcGVydHkpIHtcbiAgICAgICAgICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gcHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xuXG4gICAgICAgICAgICBpZiAoIWluZm8uY29tbWFuZCAmJiAhaW5mby5leHByZXNzaW9uKSB7XG4gICAgICAgICAgICAgIGluZm8uY29tbWFuZCA9IHByb3BlcnR5Lmhhc09wdGlvbnMgPyAnb3B0aW9ucycgOiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaW5mby5jb21tYW5kICYmIGluZm8uY29tbWFuZCAhPT0gJ29wdGlvbnMnICYmIHR5cGUucHJpbWFyeVByb3BlcnR5KSB7XG4gICAgICAgICAgICAgIHZhciBfcHJpbWFyeVByb3BlcnR5MiA9IHR5cGUucHJpbWFyeVByb3BlcnR5O1xuICAgICAgICAgICAgICBhdHRyTmFtZSA9IGluZm8uYXR0ck5hbWUgPSBfcHJpbWFyeVByb3BlcnR5Mi5hdHRyaWJ1dGU7XG5cbiAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBfcHJpbWFyeVByb3BlcnR5Mi5kZWZhdWx0QmluZGluZ01vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGVsZW1lbnRJbnN0cnVjdGlvbikge1xuICAgICAgICBlbGVtZW50UHJvcGVydHkgPSBlbGVtZW50SW5zdHJ1Y3Rpb24udHlwZS5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdO1xuICAgICAgICBpZiAoZWxlbWVudFByb3BlcnR5KSB7XG4gICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBlbGVtZW50UHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChlbGVtZW50UHJvcGVydHkpIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCB1bmRlZmluZWQsIHR5cGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5zdHJ1Y3Rpb24pIHtcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmFsdGVyZWRBdHRyKSB7XG4gICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5zdHJ1Y3Rpb24uYXR0ck5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmRpc2NyZXRlKSB7XG4gICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdGhpcy5fY29uZmlndXJlUHJvcGVydGllcyhpbnN0cnVjdGlvbiwgcmVzb3VyY2VzKTtcblxuICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XG4gICAgICAgICAgICAgIGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUgPSBvcmlnaW5hbEF0dHJOYW1lO1xuICAgICAgICAgICAgICBsaWZ0aW5nSW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGluc3RydWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnRQcm9wZXJ0eSkge1xuICAgICAgICAgICAgZWxlbWVudEluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0udGFyZ2V0UHJvcGVydHkgPSBlbGVtZW50UHJvcGVydHkubmFtZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luc3RydWN0aW9uLmF0dHJOYW1lXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgIGluc3RydWN0aW9uID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoYXR0ck5hbWUsIHR5cGUpO1xuICAgICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShhdHRyTmFtZSldID0gYXR0clZhbHVlO1xuXG4gICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XG4gICAgICAgICAgICBpbnN0cnVjdGlvbi5vcmlnaW5hbEF0dHJOYW1lID0gb3JpZ2luYWxBdHRyTmFtZTtcbiAgICAgICAgICAgIGxpZnRpbmdJbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50UHJvcGVydHkpIHtcbiAgICAgICAgICBlbGVtZW50SW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1thdHRyTmFtZV0gPSBhdHRyVmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobGlmdGluZ0luc3RydWN0aW9uKSB7XG4gICAgICBsaWZ0aW5nSW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcbiAgICAgIG5vZGUgPSBsaWZ0aW5nSW5zdHJ1Y3Rpb24udHlwZS5jb21waWxlKHRoaXMsIHJlc291cmNlcywgbm9kZSwgbGlmdGluZ0luc3RydWN0aW9uLCBwYXJlbnROb2RlKTtcbiAgICAgIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KG5vZGUpO1xuICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubGlmdGluZyhwYXJlbnRJbmplY3RvcklkLCBsaWZ0aW5nSW5zdHJ1Y3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgICAgIGlmIChleHByZXNzaW9ucy5sZW5ndGggfHwgYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgIGluamVjdG9ySWQgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGggPyBnZXROZXh0SW5qZWN0b3JJZCgpIDogZmFsc2U7XG5cbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcbiAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlLmNvbXBpbGUodGhpcywgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbiwgcGFyZW50Tm9kZSk7XG4gICAgICAgICAgcHJvdmlkZXJzLnB1c2goaW5zdHJ1Y3Rpb24udHlwZS50YXJnZXQpO1xuICAgICAgICAgIHNraXBDb250ZW50UHJvY2Vzc2luZyA9IHNraXBDb250ZW50UHJvY2Vzc2luZyB8fCBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3Npbmc7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbnNbaV07XG4gICAgICAgICAgaWYgKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChub2RlKTtcbiAgICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubm9ybWFsKGluamVjdG9ySWQsIHBhcmVudEluamVjdG9ySWQsIHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2tpcENvbnRlbnRQcm9jZXNzaW5nKSB7XG4gICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgfVxuXG4gICAgICB2YXIgY3VycmVudENoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuICAgICAgd2hpbGUgKGN1cnJlbnRDaGlsZCkge1xuICAgICAgICBjdXJyZW50Q2hpbGQgPSB0aGlzLl9jb21waWxlTm9kZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBub2RlLCBpbmplY3RvcklkIHx8IHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcbiAgfTtcblxuICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb25maWd1cmVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gX2NvbmZpZ3VyZVByb3BlcnRpZXMoaW5zdHJ1Y3Rpb24sIHJlc291cmNlcykge1xuICAgIHZhciB0eXBlID0gaW5zdHJ1Y3Rpb24udHlwZTtcbiAgICB2YXIgYXR0ck5hbWUgPSBpbnN0cnVjdGlvbi5hdHRyTmFtZTtcbiAgICB2YXIgYXR0cmlidXRlcyA9IGluc3RydWN0aW9uLmF0dHJpYnV0ZXM7XG4gICAgdmFyIHByb3BlcnR5ID0gdm9pZCAwO1xuICAgIHZhciBrZXkgPSB2b2lkIDA7XG4gICAgdmFyIHZhbHVlID0gdm9pZCAwO1xuXG4gICAgdmFyIGtub3duQXR0cmlidXRlID0gcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShhdHRyTmFtZSk7XG4gICAgaWYgKGtub3duQXR0cmlidXRlICYmIGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMgJiYga25vd25BdHRyaWJ1dGUgIT09IGF0dHJOYW1lKSB7XG4gICAgICBhdHRyaWJ1dGVzW2tub3duQXR0cmlidXRlXSA9IGF0dHJpYnV0ZXNbYXR0ck5hbWVdO1xuICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbYXR0ck5hbWVdO1xuICAgIH1cblxuICAgIGZvciAoa2V5IGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgIHZhbHVlID0gYXR0cmlidXRlc1trZXldO1xuXG4gICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodmFsdWUpKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcHJvcGVydHkgPSB0eXBlLmF0dHJpYnV0ZXNba2V5XTtcblxuICAgICAgICBpZiAocHJvcGVydHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhbHVlLnRhcmdldFByb3BlcnR5ID0gcHJvcGVydHkubmFtZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWx1ZS50YXJnZXRQcm9wZXJ0eSA9IGtleTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gVmlld0NvbXBpbGVyO1xufSgpO1xuXG5leHBvcnQgdmFyIFJlc291cmNlTW9kdWxlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBSZXNvdXJjZU1vZHVsZShtb2R1bGVJZCkge1xuICAgIFxuXG4gICAgdGhpcy5pZCA9IG1vZHVsZUlkO1xuICAgIHRoaXMubW9kdWxlSW5zdGFuY2UgPSBudWxsO1xuICAgIHRoaXMubWFpblJlc291cmNlID0gbnVsbDtcbiAgICB0aGlzLnJlc291cmNlcyA9IG51bGw7XG4gICAgdGhpcy52aWV3U3RyYXRlZ3kgPSBudWxsO1xuICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIHRoaXMub25Mb2FkZWQgPSBudWxsO1xuICAgIHRoaXMubG9hZENvbnRleHQgPSBudWxsO1xuICB9XG5cbiAgUmVzb3VyY2VNb2R1bGUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lcikge1xuICAgIHZhciBjdXJyZW50ID0gdGhpcy5tYWluUmVzb3VyY2U7XG4gICAgdmFyIHJlc291cmNlcyA9IHRoaXMucmVzb3VyY2VzO1xuICAgIHZhciB2cyA9IHRoaXMudmlld1N0cmF0ZWd5O1xuXG4gICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICBpZiAoY3VycmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjdXJyZW50Lm1ldGFkYXRhLnZpZXdTdHJhdGVneSA9IHZzO1xuICAgICAgY3VycmVudC5pbml0aWFsaXplKGNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGN1cnJlbnQgPSByZXNvdXJjZXNbaV07XG4gICAgICBjdXJyZW50Lm1ldGFkYXRhLnZpZXdTdHJhdGVneSA9IHZzO1xuICAgICAgY3VycmVudC5pbml0aWFsaXplKGNvbnRhaW5lcik7XG4gICAgfVxuICB9O1xuXG4gIFJlc291cmNlTW9kdWxlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgdmFyIG1haW4gPSB0aGlzLm1haW5SZXNvdXJjZTtcbiAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XG5cbiAgICBpZiAobWFpbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBtYWluLnJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKTtcbiAgICAgIG5hbWUgPSBudWxsO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICByZXNvdXJjZXNbaV0ucmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpO1xuICAgICAgbmFtZSA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIFJlc291cmNlTW9kdWxlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gbG9hZChjb250YWluZXIsIGxvYWRDb250ZXh0KSB7XG4gICAgaWYgKHRoaXMub25Mb2FkZWQgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiB0aGlzLmxvYWRDb250ZXh0ID09PSBsb2FkQ29udGV4dCA/IFByb21pc2UucmVzb2x2ZSgpIDogdGhpcy5vbkxvYWRlZDtcbiAgICB9XG5cbiAgICB2YXIgbWFpbiA9IHRoaXMubWFpblJlc291cmNlO1xuICAgIHZhciByZXNvdXJjZXMgPSB0aGlzLnJlc291cmNlcztcbiAgICB2YXIgbG9hZHMgPSB2b2lkIDA7XG5cbiAgICBpZiAobWFpbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsb2FkcyA9IG5ldyBBcnJheShyZXNvdXJjZXMubGVuZ3RoICsgMSk7XG4gICAgICBsb2Fkc1swXSA9IG1haW4ubG9hZChjb250YWluZXIsIGxvYWRDb250ZXh0KTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIGxvYWRzW2kgKyAxXSA9IHJlc291cmNlc1tpXS5sb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2FkcyA9IG5ldyBBcnJheShyZXNvdXJjZXMubGVuZ3RoKTtcbiAgICAgIGZvciAodmFyIF9pMiA9IDAsIF9paSA9IHJlc291cmNlcy5sZW5ndGg7IF9pMiA8IF9paTsgKytfaTIpIHtcbiAgICAgICAgbG9hZHNbX2kyXSA9IHJlc291cmNlc1tfaTJdLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5sb2FkQ29udGV4dCA9IGxvYWRDb250ZXh0O1xuICAgIHRoaXMub25Mb2FkZWQgPSBQcm9taXNlLmFsbChsb2Fkcyk7XG4gICAgcmV0dXJuIHRoaXMub25Mb2FkZWQ7XG4gIH07XG5cbiAgcmV0dXJuIFJlc291cmNlTW9kdWxlO1xufSgpO1xuXG5leHBvcnQgdmFyIFJlc291cmNlRGVzY3JpcHRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKSB7XG4gICAgXG5cbiAgICBpZiAoIXJlc291cmNlVHlwZU1ldGEpIHtcbiAgICAgIHJlc291cmNlVHlwZU1ldGEgPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVzb3VyY2UsIGV4cG9ydGVkVmFsdWUpO1xuXG4gICAgICBpZiAoIXJlc291cmNlVHlwZU1ldGEpIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xuICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xuICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIHJlc291cmNlVHlwZU1ldGEsIGV4cG9ydGVkVmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UpIHtcbiAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcbiAgICAgIH0gZWxzZSBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xuICAgICAgfSBlbHNlIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xuICAgICAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSwgcmVzb3VyY2VUeXBlTWV0YSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghcmVzb3VyY2VUeXBlTWV0YS5uYW1lKSB7XG4gICAgICByZXNvdXJjZVR5cGVNZXRhLm5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XG4gICAgfVxuXG4gICAgdGhpcy5tZXRhZGF0YSA9IHJlc291cmNlVHlwZU1ldGE7XG4gICAgdGhpcy52YWx1ZSA9IGV4cG9ydGVkVmFsdWU7XG4gIH1cblxuICBSZXNvdXJjZURlc2NyaXB0aW9uLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gaW5pdGlhbGl6ZShjb250YWluZXIpIHtcbiAgICB0aGlzLm1ldGFkYXRhLmluaXRpYWxpemUoY29udGFpbmVyLCB0aGlzLnZhbHVlKTtcbiAgfTtcblxuICBSZXNvdXJjZURlc2NyaXB0aW9uLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgdGhpcy5tZXRhZGF0YS5yZWdpc3RlcihyZWdpc3RyeSwgbmFtZSk7XG4gIH07XG5cbiAgUmVzb3VyY2VEZXNjcmlwdGlvbi5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCkge1xuICAgIHJldHVybiB0aGlzLm1ldGFkYXRhLmxvYWQoY29udGFpbmVyLCB0aGlzLnZhbHVlLCBsb2FkQ29udGV4dCk7XG4gIH07XG5cbiAgcmV0dXJuIFJlc291cmNlRGVzY3JpcHRpb247XG59KCk7XG5cbmV4cG9ydCB2YXIgTW9kdWxlQW5hbHl6ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE1vZHVsZUFuYWx5emVyKCkge1xuICAgIFxuXG4gICAgdGhpcy5jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIH1cblxuICBNb2R1bGVBbmFseXplci5wcm90b3R5cGUuZ2V0QW5hbHlzaXMgPSBmdW5jdGlvbiBnZXRBbmFseXNpcyhtb2R1bGVJZCkge1xuICAgIHJldHVybiB0aGlzLmNhY2hlW21vZHVsZUlkXTtcbiAgfTtcblxuICBNb2R1bGVBbmFseXplci5wcm90b3R5cGUuYW5hbHl6ZSA9IGZ1bmN0aW9uIGFuYWx5emUobW9kdWxlSWQsIG1vZHVsZUluc3RhbmNlLCBtYWluUmVzb3VyY2VLZXkpIHtcbiAgICB2YXIgbWFpblJlc291cmNlID0gdm9pZCAwO1xuICAgIHZhciBmYWxsYmFja1ZhbHVlID0gdm9pZCAwO1xuICAgIHZhciBmYWxsYmFja0tleSA9IHZvaWQgMDtcbiAgICB2YXIgcmVzb3VyY2VUeXBlTWV0YSA9IHZvaWQgMDtcbiAgICB2YXIga2V5ID0gdm9pZCAwO1xuICAgIHZhciBleHBvcnRlZFZhbHVlID0gdm9pZCAwO1xuICAgIHZhciByZXNvdXJjZXMgPSBbXTtcbiAgICB2YXIgY29udmVudGlvbmFsID0gdm9pZCAwO1xuICAgIHZhciB2cyA9IHZvaWQgMDtcbiAgICB2YXIgcmVzb3VyY2VNb2R1bGUgPSB2b2lkIDA7XG5cbiAgICByZXNvdXJjZU1vZHVsZSA9IHRoaXMuY2FjaGVbbW9kdWxlSWRdO1xuICAgIGlmIChyZXNvdXJjZU1vZHVsZSkge1xuICAgICAgcmV0dXJuIHJlc291cmNlTW9kdWxlO1xuICAgIH1cblxuICAgIHJlc291cmNlTW9kdWxlID0gbmV3IFJlc291cmNlTW9kdWxlKG1vZHVsZUlkKTtcbiAgICB0aGlzLmNhY2hlW21vZHVsZUlkXSA9IHJlc291cmNlTW9kdWxlO1xuXG4gICAgaWYgKHR5cGVvZiBtb2R1bGVJbnN0YW5jZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbW9kdWxlSW5zdGFuY2UgPSB7ICdkZWZhdWx0JzogbW9kdWxlSW5zdGFuY2UgfTtcbiAgICB9XG5cbiAgICBpZiAobWFpblJlc291cmNlS2V5KSB7XG4gICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihtYWluUmVzb3VyY2VLZXksIG1vZHVsZUluc3RhbmNlW21haW5SZXNvdXJjZUtleV0pO1xuICAgIH1cblxuICAgIGZvciAoa2V5IGluIG1vZHVsZUluc3RhbmNlKSB7XG4gICAgICBleHBvcnRlZFZhbHVlID0gbW9kdWxlSW5zdGFuY2Vba2V5XTtcblxuICAgICAgaWYgKGtleSA9PT0gbWFpblJlc291cmNlS2V5IHx8IHR5cGVvZiBleHBvcnRlZFZhbHVlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICByZXNvdXJjZVR5cGVNZXRhID0gbWV0YWRhdGEuZ2V0KG1ldGFkYXRhLnJlc291cmNlLCBleHBvcnRlZFZhbHVlKTtcblxuICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEpIHtcbiAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xuICAgICAgICAgIFZpZXdSZXNvdXJjZXMuY29udmVudGlvbihleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKTtcblxuICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXksIHJlc291cmNlVHlwZU1ldGEpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIW1haW5SZXNvdXJjZSAmJiByZXNvdXJjZVR5cGVNZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xuICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgcmVzb3VyY2VUeXBlTWV0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmlld1N0cmF0ZWd5LmRlY29yYXRlcyhleHBvcnRlZFZhbHVlKSkge1xuICAgICAgICB2cyA9IGV4cG9ydGVkVmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKGV4cG9ydGVkVmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkpIHtcbiAgICAgICAgdnMgPSBuZXcgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneShtb2R1bGVJZCwgZXhwb3J0ZWRWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY29udmVudGlvbmFsID0gVmlld1Jlc291cmNlcy5jb252ZW50aW9uKGV4cG9ydGVkVmFsdWUpKSB7XG4gICAgICAgICAgaWYgKGNvbnZlbnRpb25hbC5lbGVtZW50TmFtZSAhPT0gbnVsbCAmJiAhbWFpblJlc291cmNlKSB7XG4gICAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgY29udmVudGlvbmFsLCBleHBvcnRlZFZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb252ZW50aW9uYWwgPSBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSkpIHtcbiAgICAgICAgICBpZiAoY29udmVudGlvbmFsLmVsZW1lbnROYW1lICE9PSBudWxsICYmICFtYWluUmVzb3VyY2UpIHtcbiAgICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGNvbnZlbnRpb25hbCwgZXhwb3J0ZWRWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29udmVudGlvbmFsID0gVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5jb252ZW50aW9uKGtleSkgfHwgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXkpIHx8IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLmNvbnZlbnRpb24oa2V5KSkge1xuICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKSk7XG4gICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBjb252ZW50aW9uYWwsIGV4cG9ydGVkVmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKCFmYWxsYmFja1ZhbHVlKSB7XG4gICAgICAgICAgZmFsbGJhY2tWYWx1ZSA9IGV4cG9ydGVkVmFsdWU7XG4gICAgICAgICAgZmFsbGJhY2tLZXkgPSBrZXk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW1haW5SZXNvdXJjZSAmJiBmYWxsYmFja1ZhbHVlKSB7XG4gICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihmYWxsYmFja0tleSwgZmFsbGJhY2tWYWx1ZSk7XG4gICAgfVxuXG4gICAgcmVzb3VyY2VNb2R1bGUubW9kdWxlSW5zdGFuY2UgPSBtb2R1bGVJbnN0YW5jZTtcbiAgICByZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2UgPSBtYWluUmVzb3VyY2U7XG4gICAgcmVzb3VyY2VNb2R1bGUucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xuICAgIHJlc291cmNlTW9kdWxlLnZpZXdTdHJhdGVneSA9IHZzO1xuXG4gICAgcmV0dXJuIHJlc291cmNlTW9kdWxlO1xuICB9O1xuXG4gIHJldHVybiBNb2R1bGVBbmFseXplcjtcbn0oKTtcblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJyk7XG5cbmZ1bmN0aW9uIGVuc3VyZVJlZ2lzdHJ5RW50cnkobG9hZGVyLCB1cmxPclJlZ2lzdHJ5RW50cnkpIHtcbiAgaWYgKHVybE9yUmVnaXN0cnlFbnRyeSBpbnN0YW5jZW9mIFRlbXBsYXRlUmVnaXN0cnlFbnRyeSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodXJsT3JSZWdpc3RyeUVudHJ5KTtcbiAgfVxuXG4gIHJldHVybiBsb2FkZXIubG9hZFRlbXBsYXRlKHVybE9yUmVnaXN0cnlFbnRyeSk7XG59XG5cbnZhciBQcm94eVZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQcm94eVZpZXdGYWN0b3J5KHByb21pc2UpIHtcbiAgICB2YXIgX3RoaXM4ID0gdGhpcztcblxuICAgIFxuXG4gICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4gX3RoaXM4LnZpZXdGYWN0b3J5ID0geDtcbiAgICB9KTtcbiAgfVxuXG4gIFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShjb250YWluZXIsIGJpbmRpbmdDb250ZXh0LCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCkge1xuICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIGJpbmRpbmdDb250ZXh0LCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCk7XG4gIH07XG5cbiAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gc2V0Q2FjaGVTaXplKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcbiAgICB0aGlzLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KTtcbiAgfTtcblxuICBQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gZ2V0Q2FjaGVkVmlldygpIHtcbiAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5nZXRDYWNoZWRWaWV3KCk7XG4gIH07XG5cbiAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiByZXR1cm5WaWV3VG9DYWNoZSh2aWV3KSB7XG4gICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh2aWV3KTtcbiAgfTtcblxuICBfY3JlYXRlQ2xhc3MoUHJveHlWaWV3RmFjdG9yeSwgW3tcbiAgICBrZXk6ICdpc0NhY2hpbmcnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBQcm94eVZpZXdGYWN0b3J5O1xufSgpO1xuXG52YXIgYXVTbG90QmVoYXZpb3IgPSBudWxsO1xuXG5leHBvcnQgdmFyIFZpZXdFbmdpbmUgPSAoX3RlbXA1ID0gX2NsYXNzMTQgPSBmdW5jdGlvbiAoKSB7XG4gIFZpZXdFbmdpbmUuaW5qZWN0ID0gZnVuY3Rpb24gaW5qZWN0KCkge1xuICAgIHJldHVybiBbTG9hZGVyLCBDb250YWluZXIsIFZpZXdDb21waWxlciwgTW9kdWxlQW5hbHl6ZXIsIFZpZXdSZXNvdXJjZXNdO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFZpZXdFbmdpbmUobG9hZGVyLCBjb250YWluZXIsIHZpZXdDb21waWxlciwgbW9kdWxlQW5hbHl6ZXIsIGFwcFJlc291cmNlcykge1xuICAgIFxuXG4gICAgdGhpcy5sb2FkZXIgPSBsb2FkZXI7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy52aWV3Q29tcGlsZXIgPSB2aWV3Q29tcGlsZXI7XG4gICAgdGhpcy5tb2R1bGVBbmFseXplciA9IG1vZHVsZUFuYWx5emVyO1xuICAgIHRoaXMuYXBwUmVzb3VyY2VzID0gYXBwUmVzb3VyY2VzO1xuICAgIHRoaXMuX3BsdWdpbk1hcCA9IHt9O1xuXG4gICAgaWYgKGF1U2xvdEJlaGF2aW9yID09PSBudWxsKSB7XG4gICAgICBhdVNsb3RCZWhhdmlvciA9IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xuICAgICAgYXVTbG90QmVoYXZpb3IuYXR0cmlidXRlTmFtZSA9ICdhdS1zbG90JztcbiAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgYXVTbG90QmVoYXZpb3IsIFNsb3RDdXN0b21BdHRyaWJ1dGUpO1xuICAgIH1cblxuICAgIGF1U2xvdEJlaGF2aW9yLmluaXRpYWxpemUoY29udGFpbmVyLCBTbG90Q3VzdG9tQXR0cmlidXRlKTtcbiAgICBhdVNsb3RCZWhhdmlvci5yZWdpc3RlcihhcHBSZXNvdXJjZXMpO1xuICB9XG5cbiAgVmlld0VuZ2luZS5wcm90b3R5cGUuYWRkUmVzb3VyY2VQbHVnaW4gPSBmdW5jdGlvbiBhZGRSZXNvdXJjZVBsdWdpbihleHRlbnNpb24sIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdmFyIG5hbWUgPSBleHRlbnNpb24ucmVwbGFjZSgnLicsICcnKSArICctcmVzb3VyY2UtcGx1Z2luJztcbiAgICB0aGlzLl9wbHVnaW5NYXBbZXh0ZW5zaW9uXSA9IG5hbWU7XG4gICAgdGhpcy5sb2FkZXIuYWRkUGx1Z2luKG5hbWUsIGltcGxlbWVudGF0aW9uKTtcbiAgfTtcblxuICBWaWV3RW5naW5lLnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiBsb2FkVmlld0ZhY3RvcnkodXJsT3JSZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcbiAgICB2YXIgX3RoaXM5ID0gdGhpcztcblxuICAgIGxvYWRDb250ZXh0ID0gbG9hZENvbnRleHQgfHwgbmV3IFJlc291cmNlTG9hZENvbnRleHQoKTtcblxuICAgIHJldHVybiBlbnN1cmVSZWdpc3RyeUVudHJ5KHRoaXMubG9hZGVyLCB1cmxPclJlZ2lzdHJ5RW50cnkpLnRoZW4oZnVuY3Rpb24gKHJlZ2lzdHJ5RW50cnkpIHtcbiAgICAgIHZhciB1cmwgPSByZWdpc3RyeUVudHJ5LmFkZHJlc3M7XG5cbiAgICAgIGlmIChyZWdpc3RyeUVudHJ5Lm9uUmVhZHkpIHtcbiAgICAgICAgaWYgKCFsb2FkQ29udGV4dC5oYXNEZXBlbmRlbmN5KHVybCkpIHtcbiAgICAgICAgICBsb2FkQ29udGV4dC5hZGREZXBlbmRlbmN5KHVybCk7XG4gICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkub25SZWFkeTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZWdpc3RyeUVudHJ5LnRlbXBsYXRlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkub25SZWFkeTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IFByb3h5Vmlld0ZhY3RvcnkocmVnaXN0cnlFbnRyeS5vblJlYWR5KSk7XG4gICAgICB9XG5cbiAgICAgIGxvYWRDb250ZXh0LmFkZERlcGVuZGVuY3kodXJsKTtcblxuICAgICAgcmVnaXN0cnlFbnRyeS5vblJlYWR5ID0gX3RoaXM5LmxvYWRUZW1wbGF0ZVJlc291cmNlcyhyZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpLnRoZW4oZnVuY3Rpb24gKHJlc291cmNlcykge1xuICAgICAgICByZWdpc3RyeUVudHJ5LnJlc291cmNlcyA9IHJlc291cmNlcztcblxuICAgICAgICBpZiAocmVnaXN0cnlFbnRyeS50ZW1wbGF0ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5LmZhY3RvcnkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHZpZXdGYWN0b3J5ID0gX3RoaXM5LnZpZXdDb21waWxlci5jb21waWxlKHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkuZmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5Lm9uUmVhZHk7XG4gICAgfSk7XG4gIH07XG5cbiAgVmlld0VuZ2luZS5wcm90b3R5cGUubG9hZFRlbXBsYXRlUmVzb3VyY2VzID0gZnVuY3Rpb24gbG9hZFRlbXBsYXRlUmVzb3VyY2VzKHJlZ2lzdHJ5RW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xuICAgIHZhciByZXNvdXJjZXMgPSBuZXcgVmlld1Jlc291cmNlcyh0aGlzLmFwcFJlc291cmNlcywgcmVnaXN0cnlFbnRyeS5hZGRyZXNzKTtcbiAgICB2YXIgZGVwZW5kZW5jaWVzID0gcmVnaXN0cnlFbnRyeS5kZXBlbmRlbmNpZXM7XG4gICAgdmFyIGltcG9ydElkcyA9IHZvaWQgMDtcbiAgICB2YXIgbmFtZXMgPSB2b2lkIDA7XG5cbiAgICBjb21waWxlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24gfHwgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWw7XG5cbiAgICBpZiAoZGVwZW5kZW5jaWVzLmxlbmd0aCA9PT0gMCAmJiAhY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNvdXJjZXMpO1xuICAgIH1cblxuICAgIGltcG9ydElkcyA9IGRlcGVuZGVuY2llcy5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgIHJldHVybiB4LnNyYztcbiAgICB9KTtcbiAgICBuYW1lcyA9IGRlcGVuZGVuY2llcy5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgIHJldHVybiB4Lm5hbWU7XG4gICAgfSk7XG4gICAgbG9nZ2VyLmRlYnVnKCdpbXBvcnRpbmcgcmVzb3VyY2VzIGZvciAnICsgcmVnaXN0cnlFbnRyeS5hZGRyZXNzLCBpbXBvcnRJZHMpO1xuXG4gICAgaWYgKHRhcmdldCkge1xuICAgICAgdmFyIHZpZXdNb2RlbFJlcXVpcmVzID0gbWV0YWRhdGEuZ2V0KFZpZXdFbmdpbmUudmlld01vZGVsUmVxdWlyZU1ldGFkYXRhS2V5LCB0YXJnZXQpO1xuICAgICAgaWYgKHZpZXdNb2RlbFJlcXVpcmVzKSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZUltcG9ydENvdW50ID0gaW1wb3J0SWRzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdmlld01vZGVsUmVxdWlyZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgIHZhciByZXEgPSB2aWV3TW9kZWxSZXF1aXJlc1tpXTtcbiAgICAgICAgICB2YXIgaW1wb3J0SWQgPSB0eXBlb2YgcmVxID09PSAnZnVuY3Rpb24nID8gT3JpZ2luLmdldChyZXEpLm1vZHVsZUlkIDogcmVsYXRpdmVUb0ZpbGUocmVxLnNyYyB8fCByZXEsIHJlZ2lzdHJ5RW50cnkuYWRkcmVzcyk7XG5cbiAgICAgICAgICBpZiAoaW1wb3J0SWRzLmluZGV4T2YoaW1wb3J0SWQpID09PSAtMSkge1xuICAgICAgICAgICAgaW1wb3J0SWRzLnB1c2goaW1wb3J0SWQpO1xuICAgICAgICAgICAgbmFtZXMucHVzaChyZXEuYXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsb2dnZXIuZGVidWcoJ2ltcG9ydGluZyBWaWV3TW9kZWwgcmVzb3VyY2VzIGZvciAnICsgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCwgaW1wb3J0SWRzLnNsaWNlKHRlbXBsYXRlSW1wb3J0Q291bnQpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5pbXBvcnRWaWV3UmVzb3VyY2VzKGltcG9ydElkcywgbmFtZXMsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCk7XG4gIH07XG5cbiAgVmlld0VuZ2luZS5wcm90b3R5cGUuaW1wb3J0Vmlld01vZGVsUmVzb3VyY2UgPSBmdW5jdGlvbiBpbXBvcnRWaWV3TW9kZWxSZXNvdXJjZShtb2R1bGVJbXBvcnQsIG1vZHVsZU1lbWJlcikge1xuICAgIHZhciBfdGhpczEwID0gdGhpcztcblxuICAgIHJldHVybiB0aGlzLmxvYWRlci5sb2FkTW9kdWxlKG1vZHVsZUltcG9ydCkudGhlbihmdW5jdGlvbiAodmlld01vZGVsTW9kdWxlKSB7XG4gICAgICB2YXIgbm9ybWFsaXplZElkID0gT3JpZ2luLmdldCh2aWV3TW9kZWxNb2R1bGUpLm1vZHVsZUlkO1xuICAgICAgdmFyIHJlc291cmNlTW9kdWxlID0gX3RoaXMxMC5tb2R1bGVBbmFseXplci5hbmFseXplKG5vcm1hbGl6ZWRJZCwgdmlld01vZGVsTW9kdWxlLCBtb2R1bGVNZW1iZXIpO1xuXG4gICAgICBpZiAoIXJlc291cmNlTW9kdWxlLm1haW5SZXNvdXJjZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHZpZXcgbW9kZWwgZm91bmQgaW4gbW9kdWxlIFwiJyArIG1vZHVsZUltcG9ydCArICdcIi4nKTtcbiAgICAgIH1cblxuICAgICAgcmVzb3VyY2VNb2R1bGUuaW5pdGlhbGl6ZShfdGhpczEwLmNvbnRhaW5lcik7XG5cbiAgICAgIHJldHVybiByZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2U7XG4gICAgfSk7XG4gIH07XG5cbiAgVmlld0VuZ2luZS5wcm90b3R5cGUuaW1wb3J0Vmlld1Jlc291cmNlcyA9IGZ1bmN0aW9uIGltcG9ydFZpZXdSZXNvdXJjZXMobW9kdWxlSWRzLCBuYW1lcywgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KSB7XG4gICAgdmFyIF90aGlzMTEgPSB0aGlzO1xuXG4gICAgbG9hZENvbnRleHQgPSBsb2FkQ29udGV4dCB8fCBuZXcgUmVzb3VyY2VMb2FkQ29udGV4dCgpO1xuICAgIGNvbXBpbGVJbnN0cnVjdGlvbiA9IGNvbXBpbGVJbnN0cnVjdGlvbiB8fCBWaWV3Q29tcGlsZUluc3RydWN0aW9uLm5vcm1hbDtcblxuICAgIG1vZHVsZUlkcyA9IG1vZHVsZUlkcy5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgIHJldHVybiBfdGhpczExLl9hcHBseUxvYWRlclBsdWdpbih4KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmxvYWRlci5sb2FkQWxsTW9kdWxlcyhtb2R1bGVJZHMpLnRoZW4oZnVuY3Rpb24gKGltcG9ydHMpIHtcbiAgICAgIHZhciBpID0gdm9pZCAwO1xuICAgICAgdmFyIGlpID0gdm9pZCAwO1xuICAgICAgdmFyIGFuYWx5c2lzID0gdm9pZCAwO1xuICAgICAgdmFyIG5vcm1hbGl6ZWRJZCA9IHZvaWQgMDtcbiAgICAgIHZhciBjdXJyZW50ID0gdm9pZCAwO1xuICAgICAgdmFyIGFzc29jaWF0ZWRNb2R1bGUgPSB2b2lkIDA7XG4gICAgICB2YXIgY29udGFpbmVyID0gX3RoaXMxMS5jb250YWluZXI7XG4gICAgICB2YXIgbW9kdWxlQW5hbHl6ZXIgPSBfdGhpczExLm1vZHVsZUFuYWx5emVyO1xuICAgICAgdmFyIGFsbEFuYWx5c2lzID0gbmV3IEFycmF5KGltcG9ydHMubGVuZ3RoKTtcblxuICAgICAgZm9yIChpID0gMCwgaWkgPSBpbXBvcnRzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgY3VycmVudCA9IGltcG9ydHNbaV07XG4gICAgICAgIG5vcm1hbGl6ZWRJZCA9IE9yaWdpbi5nZXQoY3VycmVudCkubW9kdWxlSWQ7XG5cbiAgICAgICAgYW5hbHlzaXMgPSBtb2R1bGVBbmFseXplci5hbmFseXplKG5vcm1hbGl6ZWRJZCwgY3VycmVudCk7XG4gICAgICAgIGFuYWx5c2lzLmluaXRpYWxpemUoY29udGFpbmVyKTtcbiAgICAgICAgYW5hbHlzaXMucmVnaXN0ZXIocmVzb3VyY2VzLCBuYW1lc1tpXSk7XG5cbiAgICAgICAgYWxsQW5hbHlzaXNbaV0gPSBhbmFseXNpcztcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpIHtcbiAgICAgICAgYXNzb2NpYXRlZE1vZHVsZSA9IG1vZHVsZUFuYWx5emVyLmdldEFuYWx5c2lzKGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpO1xuXG4gICAgICAgIGlmIChhc3NvY2lhdGVkTW9kdWxlKSB7XG4gICAgICAgICAgYXNzb2NpYXRlZE1vZHVsZS5yZWdpc3RlcihyZXNvdXJjZXMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZvciAoaSA9IDAsIGlpID0gYWxsQW5hbHlzaXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICBhbGxBbmFseXNpc1tpXSA9IGFsbEFuYWx5c2lzW2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChhbGxBbmFseXNpcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZXNvdXJjZXM7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBWaWV3RW5naW5lLnByb3RvdHlwZS5fYXBwbHlMb2FkZXJQbHVnaW4gPSBmdW5jdGlvbiBfYXBwbHlMb2FkZXJQbHVnaW4oaWQpIHtcbiAgICB2YXIgaW5kZXggPSBpZC5sYXN0SW5kZXhPZignLicpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHZhciBleHQgPSBpZC5zdWJzdHJpbmcoaW5kZXgpO1xuICAgICAgdmFyIHBsdWdpbk5hbWUgPSB0aGlzLl9wbHVnaW5NYXBbZXh0XTtcblxuICAgICAgaWYgKHBsdWdpbk5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmxvYWRlci5hcHBseVBsdWdpblRvVXJsKGlkLCBwbHVnaW5OYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaWQ7XG4gIH07XG5cbiAgcmV0dXJuIFZpZXdFbmdpbmU7XG59KCksIF9jbGFzczE0LnZpZXdNb2RlbFJlcXVpcmVNZXRhZGF0YUtleSA9ICdhdXJlbGlhOnZpZXctbW9kZWwtcmVxdWlyZScsIF90ZW1wNSk7XG5cbmV4cG9ydCB2YXIgQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29udHJvbGxlcihiZWhhdmlvciwgaW5zdHJ1Y3Rpb24sIHZpZXdNb2RlbCwgY29udGFpbmVyKSB7XG4gICAgXG5cbiAgICB0aGlzLmJlaGF2aW9yID0gYmVoYXZpb3I7XG4gICAgdGhpcy5pbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xuICAgIHRoaXMudmlld01vZGVsID0gdmlld01vZGVsO1xuICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xuICAgIHRoaXMudmlldyA9IG51bGw7XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgdGhpcy5zY29wZSA9IG51bGw7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5lbGVtZW50RXZlbnRzID0gY29udGFpbmVyLmVsZW1lbnRFdmVudHMgfHwgbnVsbDtcblxuICAgIHZhciBvYnNlcnZlckxvb2t1cCA9IGJlaGF2aW9yLm9ic2VydmVyTG9jYXRvci5nZXRPckNyZWF0ZU9ic2VydmVyc0xvb2t1cCh2aWV3TW9kZWwpO1xuICAgIHZhciBoYW5kbGVzQmluZCA9IGJlaGF2aW9yLmhhbmRsZXNCaW5kO1xuICAgIHZhciBhdHRyaWJ1dGVzID0gaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcztcbiAgICB2YXIgYm91bmRQcm9wZXJ0aWVzID0gdGhpcy5ib3VuZFByb3BlcnRpZXMgPSBbXTtcbiAgICB2YXIgcHJvcGVydGllcyA9IGJlaGF2aW9yLnByb3BlcnRpZXM7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuXG4gICAgYmVoYXZpb3IuX2Vuc3VyZVByb3BlcnRpZXNEZWZpbmVkKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXApO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIHByb3BlcnRpZXNbaV0uX2luaXRpYWxpemUodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYXR0cmlidXRlcywgaGFuZGxlc0JpbmQsIGJvdW5kUHJvcGVydGllcyk7XG4gICAgfVxuICB9XG5cbiAgQ29udHJvbGxlci5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uIGNyZWF0ZWQob3duaW5nVmlldykge1xuICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNDcmVhdGVkKSB7XG4gICAgICB0aGlzLnZpZXdNb2RlbC5jcmVhdGVkKG93bmluZ1ZpZXcsIHRoaXMudmlldyk7XG4gICAgfVxuICB9O1xuXG4gIENvbnRyb2xsZXIucHJvdG90eXBlLmF1dG9tYXRlID0gZnVuY3Rpb24gYXV0b21hdGUob3ZlcnJpZGVDb250ZXh0LCBvd25pbmdWaWV3KSB7XG4gICAgdGhpcy52aWV3LmJpbmRpbmdDb250ZXh0ID0gdGhpcy52aWV3TW9kZWw7XG4gICAgdGhpcy52aWV3Lm92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dCB8fCBjcmVhdGVPdmVycmlkZUNvbnRleHQodGhpcy52aWV3TW9kZWwpO1xuICAgIHRoaXMudmlldy5faXNVc2VyQ29udHJvbGxlZCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzQ3JlYXRlZCkge1xuICAgICAgdGhpcy52aWV3TW9kZWwuY3JlYXRlZChvd25pbmdWaWV3IHx8IG51bGwsIHRoaXMudmlldyk7XG4gICAgfVxuXG4gICAgdGhpcy5iaW5kKHRoaXMudmlldyk7XG4gIH07XG5cbiAgQ29udHJvbGxlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoc2NvcGUpIHtcbiAgICB2YXIgc2tpcFNlbGZTdWJzY3JpYmVyID0gdGhpcy5iZWhhdmlvci5oYW5kbGVzQmluZDtcbiAgICB2YXIgYm91bmRQcm9wZXJ0aWVzID0gdGhpcy5ib3VuZFByb3BlcnRpZXM7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciB4ID0gdm9pZCAwO1xuICAgIHZhciBvYnNlcnZlciA9IHZvaWQgMDtcbiAgICB2YXIgc2VsZlN1YnNjcmliZXIgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zY29wZSA9PT0gc2NvcGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cblxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zY29wZSA9IHNjb3BlO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBib3VuZFByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgeCA9IGJvdW5kUHJvcGVydGllc1tpXTtcbiAgICAgIG9ic2VydmVyID0geC5vYnNlcnZlcjtcbiAgICAgIHNlbGZTdWJzY3JpYmVyID0gb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXI7XG4gICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gZmFsc2U7XG5cbiAgICAgIGlmIChza2lwU2VsZlN1YnNjcmliZXIpIHtcbiAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICB4LmJpbmRpbmcuYmluZChzY29wZSk7XG4gICAgICBvYnNlcnZlci5jYWxsKCk7XG5cbiAgICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSB0cnVlO1xuICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBzZWxmU3Vic2NyaWJlcjtcbiAgICB9XG5cbiAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gdm9pZCAwO1xuICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcbiAgICAgIGlmIChza2lwU2VsZlN1YnNjcmliZXIpIHtcbiAgICAgICAgdGhpcy52aWV3LnZpZXdNb2RlbFNjb3BlID0gc2NvcGU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnZpZXdNb2RlbCA9PT0gc2NvcGUub3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0KSB7XG4gICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pbnN0cnVjdGlvbi5pbmhlcml0QmluZGluZ0NvbnRleHQpIHtcbiAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0KHRoaXMudmlld01vZGVsLCBzY29wZS5vdmVycmlkZUNvbnRleHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0KHRoaXMudmlld01vZGVsKTtcbiAgICAgICAgb3ZlcnJpZGVDb250ZXh0Ll9fcGFyZW50T3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0O1xuICAgICAgfVxuXG4gICAgICB0aGlzLnZpZXcuYmluZCh0aGlzLnZpZXdNb2RlbCwgb3ZlcnJpZGVDb250ZXh0KTtcbiAgICB9IGVsc2UgaWYgKHNraXBTZWxmU3Vic2NyaWJlcikge1xuICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0O1xuXG4gICAgICBpZiAoc2NvcGUub3ZlcnJpZGVDb250ZXh0Ll9fcGFyZW50T3ZlcnJpZGVDb250ZXh0ICE9PSB1bmRlZmluZWQgJiYgdGhpcy52aWV3TW9kZWwudmlld0ZhY3RvcnkgJiYgdGhpcy52aWV3TW9kZWwudmlld0ZhY3RvcnkuZmFjdG9yeUNyZWF0ZUluc3RydWN0aW9uLnBhcnRSZXBsYWNlbWVudHMpIHtcbiAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gT2JqZWN0LmFzc2lnbih7fSwgc2NvcGUub3ZlcnJpZGVDb250ZXh0KTtcbiAgICAgICAgb3ZlcnJpZGVDb250ZXh0LnBhcmVudE92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dC5fX3BhcmVudE92ZXJyaWRlQ29udGV4dDtcbiAgICAgIH1cbiAgICAgIHRoaXMudmlld01vZGVsLmJpbmQoc2NvcGUuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XG4gICAgfVxuICB9O1xuXG4gIENvbnRyb2xsZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICB2YXIgX2JvdW5kUHJvcGVydGllcyA9IHRoaXMuYm91bmRQcm9wZXJ0aWVzO1xuICAgICAgdmFyIF9pMyA9IHZvaWQgMDtcbiAgICAgIHZhciBfaWkyID0gdm9pZCAwO1xuXG4gICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2NvcGUgPSBudWxsO1xuXG4gICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc1VuYmluZCkge1xuICAgICAgICB0aGlzLnZpZXdNb2RlbC51bmJpbmQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuZWxlbWVudEV2ZW50cyAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLmVsZW1lbnRFdmVudHMuZGlzcG9zZUFsbCgpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKF9pMyA9IDAsIF9paTIgPSBfYm91bmRQcm9wZXJ0aWVzLmxlbmd0aDsgX2kzIDwgX2lpMjsgKytfaTMpIHtcbiAgICAgICAgX2JvdW5kUHJvcGVydGllc1tfaTNdLmJpbmRpbmcudW5iaW5kKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIENvbnRyb2xsZXIucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gYXR0YWNoZWQoKSB7XG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNBdHRhY2hlZCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzQXR0YWNoZWQpIHtcbiAgICAgIHRoaXMudmlld01vZGVsLmF0dGFjaGVkKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudmlldyAhPT0gbnVsbCkge1xuICAgICAgdGhpcy52aWV3LmF0dGFjaGVkKCk7XG4gICAgfVxuICB9O1xuXG4gIENvbnRyb2xsZXIucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gZGV0YWNoZWQoKSB7XG4gICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xuICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XG5cbiAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy52aWV3LmRldGFjaGVkKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNEZXRhY2hlZCkge1xuICAgICAgICB0aGlzLnZpZXdNb2RlbC5kZXRhY2hlZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ29udHJvbGxlcjtcbn0oKTtcblxuZXhwb3J0IHZhciBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIgPSAoX2RlYzcgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjNyhfY2xhc3MxNSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyKHRhc2tRdWV1ZSwgb2JqLCBwcm9wZXJ0eU5hbWUsIHNlbGZTdWJzY3JpYmVyLCBpbml0aWFsVmFsdWUpIHtcbiAgICBcblxuICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xuICAgIHRoaXMub2JqID0gb2JqO1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICAgIHRoaXMubm90cXVldWVkID0gdHJ1ZTtcbiAgICB0aGlzLnB1Ymxpc2hpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XG4gICAgdGhpcy5jdXJyZW50VmFsdWUgPSB0aGlzLm9sZFZhbHVlID0gaW5pdGlhbFZhbHVlO1xuICB9XG5cbiAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRWYWx1ZTtcbiAgfTtcblxuICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcblxuICAgIGlmICghT2JqZWN0LmlzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSBvbGRWYWx1ZTtcbiAgICAgIHRoaXMuY3VycmVudFZhbHVlID0gbmV3VmFsdWU7XG5cbiAgICAgIGlmICh0aGlzLnB1Ymxpc2hpbmcgJiYgdGhpcy5ub3RxdWV1ZWQpIHtcbiAgICAgICAgaWYgKHRoaXMudGFza1F1ZXVlLmZsdXNoaW5nKSB7XG4gICAgICAgICAgdGhpcy5jYWxsKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5ub3RxdWV1ZWQgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5jdXJyZW50VmFsdWU7XG5cbiAgICB0aGlzLm5vdHF1ZXVlZCA9IHRydWU7XG5cbiAgICBpZiAoT2JqZWN0LmlzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZWxmU3Vic2NyaWJlcikge1xuICAgICAgdGhpcy5zZWxmU3Vic2NyaWJlcihuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgdGhpcy5vbGRWYWx1ZSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIHJldHVybiBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczE1KTtcblxuZnVuY3Rpb24gZ2V0T2JzZXJ2ZXIoaW5zdGFuY2UsIG5hbWUpIHtcbiAgdmFyIGxvb2t1cCA9IGluc3RhbmNlLl9fb2JzZXJ2ZXJzX187XG5cbiAgaWYgKGxvb2t1cCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdmFyIGN0b3IgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoaW5zdGFuY2UpLmNvbnN0cnVjdG9yO1xuICAgIHZhciBfYmVoYXZpb3IgPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVzb3VyY2UsIGN0b3IpO1xuICAgIGlmICghX2JlaGF2aW9yLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgIF9iZWhhdmlvci5pbml0aWFsaXplKENvbnRhaW5lci5pbnN0YW5jZSB8fCBuZXcgQ29udGFpbmVyKCksIGluc3RhbmNlLmNvbnN0cnVjdG9yKTtcbiAgICB9XG5cbiAgICBsb29rdXAgPSBfYmVoYXZpb3Iub2JzZXJ2ZXJMb2NhdG9yLmdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwKGluc3RhbmNlKTtcbiAgICBfYmVoYXZpb3IuX2Vuc3VyZVByb3BlcnRpZXNEZWZpbmVkKGluc3RhbmNlLCBsb29rdXApO1xuICB9XG5cbiAgcmV0dXJuIGxvb2t1cFtuYW1lXTtcbn1cblxuZXhwb3J0IHZhciBCaW5kYWJsZVByb3BlcnR5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kYWJsZVByb3BlcnR5KG5hbWVPckNvbmZpZykge1xuICAgIFxuXG4gICAgaWYgKHR5cGVvZiBuYW1lT3JDb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLm5hbWUgPSBuYW1lT3JDb25maWc7XG4gICAgfSBlbHNlIHtcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgbmFtZU9yQ29uZmlnKTtcbiAgICB9XG5cbiAgICB0aGlzLmF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlIHx8IF9oeXBoZW5hdGUodGhpcy5uYW1lKTtcbiAgICB2YXIgZGVmYXVsdEJpbmRpbmdNb2RlID0gdGhpcy5kZWZhdWx0QmluZGluZ01vZGU7XG4gICAgaWYgKGRlZmF1bHRCaW5kaW5nTW9kZSA9PT0gbnVsbCB8fCBkZWZhdWx0QmluZGluZ01vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5kZWZhdWx0QmluZGluZ01vZGUgPSBiaW5kaW5nTW9kZS5vbmVXYXk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZGVmYXVsdEJpbmRpbmdNb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5kZWZhdWx0QmluZGluZ01vZGUgPSBiaW5kaW5nTW9kZVtkZWZhdWx0QmluZGluZ01vZGVdIHx8IGJpbmRpbmdNb2RlLm9uZVdheTtcbiAgICB9XG4gICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gdGhpcy5jaGFuZ2VIYW5kbGVyIHx8IG51bGw7XG4gICAgdGhpcy5vd25lciA9IG51bGw7XG4gICAgdGhpcy5kZXNjcmlwdG9yID0gbnVsbDtcbiAgfVxuXG4gIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLnJlZ2lzdGVyV2l0aCA9IGZ1bmN0aW9uIHJlZ2lzdGVyV2l0aCh0YXJnZXQsIGJlaGF2aW9yLCBkZXNjcmlwdG9yKSB7XG4gICAgYmVoYXZpb3IucHJvcGVydGllcy5wdXNoKHRoaXMpO1xuICAgIGJlaGF2aW9yLmF0dHJpYnV0ZXNbdGhpcy5hdHRyaWJ1dGVdID0gdGhpcztcbiAgICB0aGlzLm93bmVyID0gYmVoYXZpb3I7XG5cbiAgICBpZiAoZGVzY3JpcHRvcikge1xuICAgICAgdGhpcy5kZXNjcmlwdG9yID0gZGVzY3JpcHRvcjtcbiAgICAgIHJldHVybiB0aGlzLl9jb25maWd1cmVEZXNjcmlwdG9yKGRlc2NyaXB0b3IpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuX2NvbmZpZ3VyZURlc2NyaXB0b3IgPSBmdW5jdGlvbiBfY29uZmlndXJlRGVzY3JpcHRvcihkZXNjcmlwdG9yKSB7XG4gICAgdmFyIG5hbWUgPSB0aGlzLm5hbWU7XG5cbiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gdHJ1ZTtcblxuICAgIGlmICgnaW5pdGlhbGl6ZXInIGluIGRlc2NyaXB0b3IpIHtcbiAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gZGVzY3JpcHRvci5pbml0aWFsaXplcjtcbiAgICAgIGRlbGV0ZSBkZXNjcmlwdG9yLmluaXRpYWxpemVyO1xuICAgICAgZGVsZXRlIGRlc2NyaXB0b3Iud3JpdGFibGU7XG4gICAgfVxuXG4gICAgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikge1xuICAgICAgdGhpcy5kZWZhdWx0VmFsdWUgPSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgICAgZGVsZXRlIGRlc2NyaXB0b3IudmFsdWU7XG4gICAgICBkZWxldGUgZGVzY3JpcHRvci53cml0YWJsZTtcbiAgICB9XG5cbiAgICBkZXNjcmlwdG9yLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBnZXRPYnNlcnZlcih0aGlzLCBuYW1lKS5nZXRWYWx1ZSgpO1xuICAgIH07XG5cbiAgICBkZXNjcmlwdG9yLnNldCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgZ2V0T2JzZXJ2ZXIodGhpcywgbmFtZSkuc2V0VmFsdWUodmFsdWUpO1xuICAgIH07XG5cbiAgICBkZXNjcmlwdG9yLmdldC5nZXRPYnNlcnZlciA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiBnZXRPYnNlcnZlcihvYmosIG5hbWUpO1xuICAgIH07XG5cbiAgICByZXR1cm4gZGVzY3JpcHRvcjtcbiAgfTtcblxuICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5kZWZpbmVPbiA9IGZ1bmN0aW9uIGRlZmluZU9uKHRhcmdldCwgYmVoYXZpb3IpIHtcbiAgICB2YXIgbmFtZSA9IHRoaXMubmFtZTtcbiAgICB2YXIgaGFuZGxlck5hbWUgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyID09PSBudWxsKSB7XG4gICAgICBoYW5kbGVyTmFtZSA9IG5hbWUgKyAnQ2hhbmdlZCc7XG4gICAgICBpZiAoaGFuZGxlck5hbWUgaW4gdGFyZ2V0LnByb3RvdHlwZSkge1xuICAgICAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSBoYW5kbGVyTmFtZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5kZXNjcmlwdG9yID09PSBudWxsKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LnByb3RvdHlwZSwgbmFtZSwgdGhpcy5fY29uZmlndXJlRGVzY3JpcHRvcihiZWhhdmlvciwge30pKTtcbiAgICB9XG4gIH07XG5cbiAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuY3JlYXRlT2JzZXJ2ZXIgPSBmdW5jdGlvbiBjcmVhdGVPYnNlcnZlcih2aWV3TW9kZWwpIHtcbiAgICB2YXIgc2VsZlN1YnNjcmliZXIgPSBudWxsO1xuICAgIHZhciBkZWZhdWx0VmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcbiAgICB2YXIgY2hhbmdlSGFuZGxlck5hbWUgPSB0aGlzLmNoYW5nZUhhbmRsZXI7XG4gICAgdmFyIG5hbWUgPSB0aGlzLm5hbWU7XG4gICAgdmFyIGluaXRpYWxWYWx1ZSA9IHZvaWQgMDtcblxuICAgIGlmICh0aGlzLmhhc09wdGlvbnMpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZUhhbmRsZXJOYW1lIGluIHZpZXdNb2RlbCkge1xuICAgICAgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xuICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIHNlbGZTdWJzY3JpYmVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgICAgICB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIHNlbGZTdWJzY3JpYmVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiB2aWV3TW9kZWxbY2hhbmdlSGFuZGxlck5hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgncHJvcGVydHlDaGFuZ2VkJyBpbiB2aWV3TW9kZWwpIHtcbiAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoY2hhbmdlSGFuZGxlck5hbWUgIT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2hhbmdlIGhhbmRsZXIgJyArIGNoYW5nZUhhbmRsZXJOYW1lICsgJyB3YXMgc3BlY2lmaWVkIGJ1dCBub3QgZGVjbGFyZWQgb24gdGhlIGNsYXNzLicpO1xuICAgIH1cblxuICAgIGlmIChkZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaW5pdGlhbFZhbHVlID0gdHlwZW9mIGRlZmF1bHRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyA/IGRlZmF1bHRWYWx1ZS5jYWxsKHZpZXdNb2RlbCkgOiBkZWZhdWx0VmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIodGhpcy5vd25lci50YXNrUXVldWUsIHZpZXdNb2RlbCwgdGhpcy5uYW1lLCBzZWxmU3Vic2NyaWJlciwgaW5pdGlhbFZhbHVlKTtcbiAgfTtcblxuICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIF9pbml0aWFsaXplKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGF0dHJpYnV0ZXMsIGJlaGF2aW9ySGFuZGxlc0JpbmQsIGJvdW5kUHJvcGVydGllcykge1xuICAgIHZhciBzZWxmU3Vic2NyaWJlciA9IHZvaWQgMDtcbiAgICB2YXIgb2JzZXJ2ZXIgPSB2b2lkIDA7XG4gICAgdmFyIGF0dHJpYnV0ZSA9IHZvaWQgMDtcbiAgICB2YXIgZGVmYXVsdFZhbHVlID0gdGhpcy5kZWZhdWx0VmFsdWU7XG5cbiAgICBpZiAodGhpcy5pc0R5bmFtaWMpIHtcbiAgICAgIGZvciAodmFyIF9rZXk2IGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgdGhpcy5fY3JlYXRlRHluYW1pY1Byb3BlcnR5KHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGJlaGF2aW9ySGFuZGxlc0JpbmQsIF9rZXk2LCBhdHRyaWJ1dGVzW19rZXk2XSwgYm91bmRQcm9wZXJ0aWVzKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCF0aGlzLmhhc09wdGlvbnMpIHtcbiAgICAgIG9ic2VydmVyID0gb2JzZXJ2ZXJMb29rdXBbdGhpcy5uYW1lXTtcblxuICAgICAgaWYgKGF0dHJpYnV0ZXMgIT09IG51bGwpIHtcbiAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBvYnNlcnZlci5zZWxmU3Vic2NyaWJlcjtcbiAgICAgICAgYXR0cmlidXRlID0gYXR0cmlidXRlc1t0aGlzLmF0dHJpYnV0ZV07XG5cbiAgICAgICAgaWYgKGJlaGF2aW9ySGFuZGxlc0JpbmQpIHtcbiAgICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB2aWV3TW9kZWxbdGhpcy5uYW1lXSA9IGF0dHJpYnV0ZTtcbiAgICAgICAgICBvYnNlcnZlci5jYWxsKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXR0cmlidXRlKSB7XG4gICAgICAgICAgYm91bmRQcm9wZXJ0aWVzLnB1c2goeyBvYnNlcnZlcjogb2JzZXJ2ZXIsIGJpbmRpbmc6IGF0dHJpYnV0ZS5jcmVhdGVCaW5kaW5nKHZpZXdNb2RlbCkgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBvYnNlcnZlci5jYWxsKCk7XG4gICAgICAgIH1cblxuICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IHNlbGZTdWJzY3JpYmVyO1xuICAgICAgfVxuXG4gICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuX2NyZWF0ZUR5bmFtaWNQcm9wZXJ0eSA9IGZ1bmN0aW9uIF9jcmVhdGVEeW5hbWljUHJvcGVydHkodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYmVoYXZpb3JIYW5kbGVzQmluZCwgbmFtZSwgYXR0cmlidXRlLCBib3VuZFByb3BlcnRpZXMpIHtcbiAgICB2YXIgY2hhbmdlSGFuZGxlck5hbWUgPSBuYW1lICsgJ0NoYW5nZWQnO1xuICAgIHZhciBzZWxmU3Vic2NyaWJlciA9IG51bGw7XG4gICAgdmFyIG9ic2VydmVyID0gdm9pZCAwO1xuICAgIHZhciBpbmZvID0gdm9pZCAwO1xuXG4gICAgaWYgKGNoYW5nZUhhbmRsZXJOYW1lIGluIHZpZXdNb2RlbCkge1xuICAgICAgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xuICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIHNlbGZTdWJzY3JpYmVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgICAgICB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIHNlbGZTdWJzY3JpYmVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiB2aWV3TW9kZWxbY2hhbmdlSGFuZGxlck5hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgncHJvcGVydHlDaGFuZ2VkJyBpbiB2aWV3TW9kZWwpIHtcbiAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIG9ic2VydmVyID0gb2JzZXJ2ZXJMb29rdXBbbmFtZV0gPSBuZXcgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyKHRoaXMub3duZXIudGFza1F1ZXVlLCB2aWV3TW9kZWwsIG5hbWUsIHNlbGZTdWJzY3JpYmVyKTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh2aWV3TW9kZWwsIG5hbWUsIHtcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBnZXQ6IG9ic2VydmVyLmdldFZhbHVlLmJpbmQob2JzZXJ2ZXIpLFxuICAgICAgc2V0OiBvYnNlcnZlci5zZXRWYWx1ZS5iaW5kKG9ic2VydmVyKVxuICAgIH0pO1xuXG4gICAgaWYgKGJlaGF2aW9ySGFuZGxlc0JpbmQpIHtcbiAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHZpZXdNb2RlbFtuYW1lXSA9IGF0dHJpYnV0ZTtcbiAgICAgIG9ic2VydmVyLmNhbGwoKTtcbiAgICB9IGVsc2UgaWYgKGF0dHJpYnV0ZSkge1xuICAgICAgaW5mbyA9IHsgb2JzZXJ2ZXI6IG9ic2VydmVyLCBiaW5kaW5nOiBhdHRyaWJ1dGUuY3JlYXRlQmluZGluZyh2aWV3TW9kZWwpIH07XG4gICAgICBib3VuZFByb3BlcnRpZXMucHVzaChpbmZvKTtcbiAgICB9XG5cbiAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gdHJ1ZTtcbiAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IHNlbGZTdWJzY3JpYmVyO1xuICB9O1xuXG4gIHJldHVybiBCaW5kYWJsZVByb3BlcnR5O1xufSgpO1xuXG52YXIgbGFzdFByb3ZpZGVySWQgPSAwO1xuXG5mdW5jdGlvbiBuZXh0UHJvdmlkZXJJZCgpIHtcbiAgcmV0dXJuICsrbGFzdFByb3ZpZGVySWQ7XG59XG5cbmZ1bmN0aW9uIGRvUHJvY2Vzc0NvbnRlbnQoKSB7XG4gIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gZG9Qcm9jZXNzQXR0cmlidXRlcygpIHt9XG5cbmV4cG9ydCB2YXIgSHRtbEJlaGF2aW9yUmVzb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEh0bWxCZWhhdmlvclJlc291cmNlKCkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50TmFtZSA9IG51bGw7XG4gICAgdGhpcy5hdHRyaWJ1dGVOYW1lID0gbnVsbDtcbiAgICB0aGlzLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmxpZnRzQ29udGVudCA9IGZhbHNlO1xuICAgIHRoaXMudGFyZ2V0U2hhZG93RE9NID0gZmFsc2U7XG4gICAgdGhpcy5zaGFkb3dET01PcHRpb25zID0gbnVsbDtcbiAgICB0aGlzLnByb2Nlc3NBdHRyaWJ1dGVzID0gZG9Qcm9jZXNzQXR0cmlidXRlcztcbiAgICB0aGlzLnByb2Nlc3NDb250ZW50ID0gZG9Qcm9jZXNzQ29udGVudDtcbiAgICB0aGlzLnVzZXNTaGFkb3dET00gPSBmYWxzZTtcbiAgICB0aGlzLmNoaWxkQmluZGluZ3MgPSBudWxsO1xuICAgIHRoaXMuaGFzRHluYW1pY09wdGlvbnMgPSBmYWxzZTtcbiAgICB0aGlzLmNvbnRhaW5lcmxlc3MgPSBmYWxzZTtcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBbXTtcbiAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnByaW1hcnlQcm9wZXJ0eSA9IG51bGw7XG4gIH1cblxuICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gY29udmVudGlvbihuYW1lLCBleGlzdGluZykge1xuICAgIHZhciBiZWhhdmlvciA9IHZvaWQgMDtcblxuICAgIGlmIChuYW1lLmVuZHNXaXRoKCdDdXN0b21BdHRyaWJ1dGUnKSkge1xuICAgICAgYmVoYXZpb3IgPSBleGlzdGluZyB8fCBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcbiAgICAgIGJlaGF2aW9yLmF0dHJpYnV0ZU5hbWUgPSBfaHlwaGVuYXRlKG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoIC0gMTUpKTtcbiAgICB9XG5cbiAgICBpZiAobmFtZS5lbmRzV2l0aCgnQ3VzdG9tRWxlbWVudCcpKSB7XG4gICAgICBiZWhhdmlvciA9IGV4aXN0aW5nIHx8IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xuICAgICAgYmVoYXZpb3IuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoIC0gMTMpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYmVoYXZpb3I7XG4gIH07XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmFkZENoaWxkQmluZGluZyA9IGZ1bmN0aW9uIGFkZENoaWxkQmluZGluZyhiZWhhdmlvcikge1xuICAgIGlmICh0aGlzLmNoaWxkQmluZGluZ3MgPT09IG51bGwpIHtcbiAgICAgIHRoaXMuY2hpbGRCaW5kaW5ncyA9IFtdO1xuICAgIH1cblxuICAgIHRoaXMuY2hpbGRCaW5kaW5ncy5wdXNoKGJlaGF2aW9yKTtcbiAgfTtcblxuICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB2YXIgcHJvdG8gPSB0YXJnZXQucHJvdG90eXBlO1xuICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xuICAgIHZhciBhdHRyaWJ1dGVOYW1lID0gdGhpcy5hdHRyaWJ1dGVOYW1lO1xuICAgIHZhciBhdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGUgPSB0aGlzLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZTtcbiAgICB2YXIgaSA9IHZvaWQgMDtcbiAgICB2YXIgaWkgPSB2b2lkIDA7XG4gICAgdmFyIGN1cnJlbnQgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB0YXJnZXQuX19wcm92aWRlcklkX18gPSBuZXh0UHJvdmlkZXJJZCgpO1xuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBjb250YWluZXIuZ2V0KE9ic2VydmVyTG9jYXRvcik7XG4gICAgdGhpcy50YXNrUXVldWUgPSBjb250YWluZXIuZ2V0KFRhc2tRdWV1ZSk7XG5cbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnVzZXNTaGFkb3dET00gPSB0aGlzLnRhcmdldFNoYWRvd0RPTSAmJiBGRUFUVVJFLnNoYWRvd0RPTTtcbiAgICB0aGlzLmhhbmRsZXNDcmVhdGVkID0gJ2NyZWF0ZWQnIGluIHByb3RvO1xuICAgIHRoaXMuaGFuZGxlc0JpbmQgPSAnYmluZCcgaW4gcHJvdG87XG4gICAgdGhpcy5oYW5kbGVzVW5iaW5kID0gJ3VuYmluZCcgaW4gcHJvdG87XG4gICAgdGhpcy5oYW5kbGVzQXR0YWNoZWQgPSAnYXR0YWNoZWQnIGluIHByb3RvO1xuICAgIHRoaXMuaGFuZGxlc0RldGFjaGVkID0gJ2RldGFjaGVkJyBpbiBwcm90bztcbiAgICB0aGlzLmh0bWxOYW1lID0gdGhpcy5lbGVtZW50TmFtZSB8fCB0aGlzLmF0dHJpYnV0ZU5hbWU7XG5cbiAgICBpZiAoYXR0cmlidXRlTmFtZSAhPT0gbnVsbCkge1xuICAgICAgaWYgKHByb3BlcnRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5ldyBCaW5kYWJsZVByb3BlcnR5KHtcbiAgICAgICAgICBuYW1lOiAndmFsdWUnLFxuICAgICAgICAgIGNoYW5nZUhhbmRsZXI6ICd2YWx1ZUNoYW5nZWQnIGluIHByb3RvID8gJ3ZhbHVlQ2hhbmdlZCcgOiBudWxsLFxuICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICBkZWZhdWx0QmluZGluZ01vZGU6IGF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZVxuICAgICAgICB9KS5yZWdpc3RlcldpdGgodGFyZ2V0LCB0aGlzKTtcbiAgICAgIH1cblxuICAgICAgY3VycmVudCA9IHByb3BlcnRpZXNbMF07XG5cbiAgICAgIGlmIChwcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMSAmJiBjdXJyZW50Lm5hbWUgPT09ICd2YWx1ZScpIHtcbiAgICAgICAgY3VycmVudC5pc0R5bmFtaWMgPSBjdXJyZW50Lmhhc09wdGlvbnMgPSB0aGlzLmhhc0R5bmFtaWNPcHRpb25zO1xuICAgICAgICBjdXJyZW50LmRlZmluZU9uKHRhcmdldCwgdGhpcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgICAgICAgIHByb3BlcnRpZXNbaV0uZGVmaW5lT24odGFyZ2V0LCB0aGlzKTtcbiAgICAgICAgICBpZiAocHJvcGVydGllc1tpXS5wcmltYXJ5UHJvcGVydHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByaW1hcnlQcm9wZXJ0eSkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgb25lIGJpbmRhYmxlIHByb3BlcnR5IG9uIGEgY3VzdG9tIGVsZW1lbnQgY2FuIGJlIGRlZmluZWQgYXMgdGhlIGRlZmF1bHQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucHJpbWFyeVByb3BlcnR5ID0gcHJvcGVydGllc1tpXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50ID0gbmV3IEJpbmRhYmxlUHJvcGVydHkoe1xuICAgICAgICAgIG5hbWU6ICd2YWx1ZScsXG4gICAgICAgICAgY2hhbmdlSGFuZGxlcjogJ3ZhbHVlQ2hhbmdlZCcgaW4gcHJvdG8gPyAndmFsdWVDaGFuZ2VkJyA6IG51bGwsXG4gICAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGVOYW1lLFxuICAgICAgICAgIGRlZmF1bHRCaW5kaW5nTW9kZTogYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGN1cnJlbnQuaGFzT3B0aW9ucyA9IHRydWU7XG4gICAgICAgIGN1cnJlbnQucmVnaXN0ZXJXaXRoKHRhcmdldCwgdGhpcyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIHByb3BlcnRpZXNbaV0uZGVmaW5lT24odGFyZ2V0LCB0aGlzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fY29weUluaGVyaXRlZFByb3BlcnRpZXMoY29udGFpbmVyLCB0YXJnZXQpO1xuICAgIH1cbiAgfTtcblxuICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihyZWdpc3RyeSwgbmFtZSkge1xuICAgIHZhciBfdGhpczEyID0gdGhpcztcblxuICAgIGlmICh0aGlzLmF0dHJpYnV0ZU5hbWUgIT09IG51bGwpIHtcbiAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyQXR0cmlidXRlKG5hbWUgfHwgdGhpcy5hdHRyaWJ1dGVOYW1lLCB0aGlzLCB0aGlzLmF0dHJpYnV0ZU5hbWUpO1xuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmFsaWFzZXMpKSB7XG4gICAgICAgIHRoaXMuYWxpYXNlcy5mb3JFYWNoKGZ1bmN0aW9uIChhbGlhcykge1xuICAgICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyQXR0cmlidXRlKGFsaWFzLCBfdGhpczEyLCBfdGhpczEyLmF0dHJpYnV0ZU5hbWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xuICAgICAgcmVnaXN0cnkucmVnaXN0ZXJFbGVtZW50KG5hbWUgfHwgdGhpcy5lbGVtZW50TmFtZSwgdGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gbG9hZChjb250YWluZXIsIHRhcmdldCwgbG9hZENvbnRleHQsIHZpZXdTdHJhdGVneSwgdHJhbnNpZW50Vmlldykge1xuICAgIHZhciBfdGhpczEzID0gdGhpcztcblxuICAgIHZhciBvcHRpb25zID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcbiAgICAgIHZpZXdTdHJhdGVneSA9IGNvbnRhaW5lci5nZXQoVmlld0xvY2F0b3IpLmdldFZpZXdTdHJhdGVneSh2aWV3U3RyYXRlZ3kgfHwgdGhpcy52aWV3U3RyYXRlZ3kgfHwgdGFyZ2V0KTtcbiAgICAgIG9wdGlvbnMgPSBuZXcgVmlld0NvbXBpbGVJbnN0cnVjdGlvbih0aGlzLnRhcmdldFNoYWRvd0RPTSwgdHJ1ZSk7XG5cbiAgICAgIGlmICghdmlld1N0cmF0ZWd5Lm1vZHVsZUlkKSB7XG4gICAgICAgIHZpZXdTdHJhdGVneS5tb2R1bGVJZCA9IE9yaWdpbi5nZXQodGFyZ2V0KS5tb2R1bGVJZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZpZXdTdHJhdGVneS5sb2FkVmlld0ZhY3RvcnkoY29udGFpbmVyLmdldChWaWV3RW5naW5lKSwgb3B0aW9ucywgbG9hZENvbnRleHQsIHRhcmdldCkudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHtcbiAgICAgICAgaWYgKCF0cmFuc2llbnRWaWV3IHx8ICFfdGhpczEzLnZpZXdGYWN0b3J5KSB7XG4gICAgICAgICAgX3RoaXMxMy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZpZXdGYWN0b3J5O1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzKTtcbiAgfTtcblxuICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuY29tcGlsZSA9IGZ1bmN0aW9uIGNvbXBpbGUoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24sIHBhcmVudE5vZGUpIHtcbiAgICBpZiAodGhpcy5saWZ0c0NvbnRlbnQpIHtcbiAgICAgIGlmICghaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkpIHtcbiAgICAgICAgdmFyIF90ZW1wbGF0ZSA9IERPTS5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICAgICAgICB2YXIgZnJhZ21lbnQgPSBET00uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICB2YXIgY2FjaGVTaXplID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcbiAgICAgICAgdmFyIHBhcnQgPSBub2RlLmdldEF0dHJpYnV0ZSgncGFydCcpO1xuXG4gICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUpO1xuICAgICAgICBET00ucmVwbGFjZU5vZGUoX3RlbXBsYXRlLCBub2RlLCBwYXJlbnROb2RlKTtcbiAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gY29tcGlsZXIuY29tcGlsZShmcmFnbWVudCwgcmVzb3VyY2VzKTtcblxuICAgICAgICBpZiAocGFydCkge1xuICAgICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5LnBhcnQgPSBwYXJ0O1xuICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKCdwYXJ0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2FjaGVTaXplKSB7XG4gICAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3Rvcnkuc2V0Q2FjaGVTaXplKGNhY2hlU2l6ZSk7XG4gICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGUgPSBfdGVtcGxhdGU7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XG4gICAgICB2YXIgX3BhcnRSZXBsYWNlbWVudHMyID0ge307XG5cbiAgICAgIGlmICh0aGlzLnByb2Nlc3NDb250ZW50KGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKSAmJiBub2RlLmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICB2YXIgY3VycmVudENoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSB0aGlzLnVzZXNTaGFkb3dET00gPyBudWxsIDogRE9NLmNyZWF0ZUVsZW1lbnQoJ2F1LWNvbnRlbnQnKTtcbiAgICAgICAgdmFyIG5leHRTaWJsaW5nID0gdm9pZCAwO1xuICAgICAgICB2YXIgdG9SZXBsYWNlID0gdm9pZCAwO1xuXG4gICAgICAgIHdoaWxlIChjdXJyZW50Q2hpbGQpIHtcbiAgICAgICAgICBuZXh0U2libGluZyA9IGN1cnJlbnRDaGlsZC5uZXh0U2libGluZztcblxuICAgICAgICAgIGlmIChjdXJyZW50Q2hpbGQudGFnTmFtZSA9PT0gJ1RFTVBMQVRFJyAmJiAodG9SZXBsYWNlID0gY3VycmVudENoaWxkLmdldEF0dHJpYnV0ZSgncmVwbGFjZS1wYXJ0JykpKSB7XG4gICAgICAgICAgICBfcGFydFJlcGxhY2VtZW50czJbdG9SZXBsYWNlXSA9IGNvbXBpbGVyLmNvbXBpbGUoY3VycmVudENoaWxkLCByZXNvdXJjZXMpO1xuICAgICAgICAgICAgRE9NLnJlbW92ZU5vZGUoY3VycmVudENoaWxkLCBwYXJlbnROb2RlKTtcbiAgICAgICAgICAgIGluc3RydWN0aW9uLnBhcnRSZXBsYWNlbWVudHMgPSBfcGFydFJlcGxhY2VtZW50czI7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb250ZW50RWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRDaGlsZC5ub2RlVHlwZSA9PT0gMyAmJiBfaXNBbGxXaGl0ZXNwYWNlKGN1cnJlbnRDaGlsZCkpIHtcbiAgICAgICAgICAgICAgRE9NLnJlbW92ZU5vZGUoY3VycmVudENoaWxkLCBwYXJlbnROb2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50LmFwcGVuZENoaWxkKGN1cnJlbnRDaGlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY3VycmVudENoaWxkID0gbmV4dFNpYmxpbmc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29udGVudEVsZW1lbnQgIT09IG51bGwgJiYgY29udGVudEVsZW1lbnQuaGFzQ2hpbGROb2RlcygpKSB7XG4gICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjb250ZW50RWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluc3RydWN0aW9uLnNraXBDb250ZW50UHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghdGhpcy5wcm9jZXNzQ29udGVudChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbikpIHtcbiAgICAgIGluc3RydWN0aW9uLnNraXBDb250ZW50UHJvY2Vzc2luZyA9IHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH07XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShjb250YWluZXIsIGluc3RydWN0aW9uLCBlbGVtZW50LCBiaW5kaW5ncykge1xuICAgIHZhciB2aWV3SG9zdCA9IHZvaWQgMDtcbiAgICB2YXIgYXUgPSBudWxsO1xuXG4gICAgaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLm5vcm1hbDtcbiAgICBlbGVtZW50ID0gZWxlbWVudCB8fCBudWxsO1xuICAgIGJpbmRpbmdzID0gYmluZGluZ3MgfHwgbnVsbDtcblxuICAgIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsICYmIGVsZW1lbnQpIHtcbiAgICAgIGlmICh0aGlzLnVzZXNTaGFkb3dET00pIHtcbiAgICAgICAgdmlld0hvc3QgPSBlbGVtZW50LmF0dGFjaFNoYWRvdyh0aGlzLnNoYWRvd0RPTU9wdGlvbnMpO1xuICAgICAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uYm91bmRhcnksIHZpZXdIb3N0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZpZXdIb3N0ID0gZWxlbWVudDtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0U2hhZG93RE9NKSB7XG4gICAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoRE9NLmJvdW5kYXJ5LCB2aWV3SG9zdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgZWxlbWVudC5hdSA9IGF1ID0gZWxlbWVudC5hdSB8fCB7fTtcbiAgICB9XG5cbiAgICB2YXIgdmlld01vZGVsID0gaW5zdHJ1Y3Rpb24udmlld01vZGVsIHx8IGNvbnRhaW5lci5nZXQodGhpcy50YXJnZXQpO1xuICAgIHZhciBjb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXIodGhpcywgaW5zdHJ1Y3Rpb24sIHZpZXdNb2RlbCwgY29udGFpbmVyKTtcbiAgICB2YXIgY2hpbGRCaW5kaW5ncyA9IHRoaXMuY2hpbGRCaW5kaW5ncztcbiAgICB2YXIgdmlld0ZhY3RvcnkgPSB2b2lkIDA7XG5cbiAgICBpZiAodGhpcy5saWZ0c0NvbnRlbnQpIHtcbiAgICAgIGF1LmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xuICAgIH0gZWxzZSBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xuICAgICAgdmlld0ZhY3RvcnkgPSBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSB8fCB0aGlzLnZpZXdGYWN0b3J5O1xuICAgICAgY29udGFpbmVyLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcblxuICAgICAgaWYgKHZpZXdGYWN0b3J5KSB7XG4gICAgICAgIGNvbnRyb2xsZXIudmlldyA9IHZpZXdGYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIGluc3RydWN0aW9uLCBlbGVtZW50KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHtcbiAgICAgICAgYXUuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XG5cbiAgICAgICAgaWYgKGNvbnRyb2xsZXIudmlldykge1xuICAgICAgICAgIGlmICghdGhpcy51c2VzU2hhZG93RE9NICYmIChlbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxIHx8IGVsZW1lbnQuY29udGVudEVsZW1lbnQpKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSBlbGVtZW50LmNoaWxkTm9kZXNbMF0gfHwgZWxlbWVudC5jb250ZW50RWxlbWVudDtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5jb250ZW50VmlldyA9IHsgZnJhZ21lbnQ6IGNvbnRlbnRFbGVtZW50IH07XG4gICAgICAgICAgICBjb250ZW50RWxlbWVudC5wYXJlbnROb2RlICYmIERPTS5yZW1vdmVOb2RlKGNvbnRlbnRFbGVtZW50KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpIHtcbiAgICAgICAgICAgIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIF9pNCA9IDAsIF9paTMgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgX2k0IDwgX2lpMzsgKytfaTQpIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuYWRkQmluZGluZyhjaGlsZEJpbmRpbmdzW19pNF0uY3JlYXRlKGVsZW1lbnQsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hcHBlbmROb2Rlc1RvKHZpZXdIb3N0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29udHJvbGxlci52aWV3Lmluc2VydE5vZGVzQmVmb3JlKHZpZXdIb3N0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xuICAgICAgICAgIGZvciAodmFyIF9pNSA9IDAsIF9paTQgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgX2k1IDwgX2lpNDsgKytfaTUpIHtcbiAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tfaTVdLmNyZWF0ZShlbGVtZW50LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoY29udHJvbGxlci52aWV3KSB7XG4gICAgICAgIGNvbnRyb2xsZXIudmlldy5jb250cm9sbGVyID0gY29udHJvbGxlcjtcblxuICAgICAgICBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xuICAgICAgICAgIGZvciAodmFyIF9pNiA9IDAsIF9paTUgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgX2k2IDwgX2lpNTsgKytfaTYpIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hZGRCaW5kaW5nKGNoaWxkQmluZGluZ3NbX2k2XS5jcmVhdGUoaW5zdHJ1Y3Rpb24uaG9zdCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcbiAgICAgICAgZm9yICh2YXIgX2k3ID0gMCwgX2lpNiA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBfaTcgPCBfaWk2OyArK19pNykge1xuICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tfaTddLmNyZWF0ZShpbnN0cnVjdGlvbi5ob3N0LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xuICAgICAgZm9yICh2YXIgX2k4ID0gMCwgX2lpNyA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBfaTggPCBfaWk3OyArK19pOCkge1xuICAgICAgICBiaW5kaW5ncy5wdXNoKGNoaWxkQmluZGluZ3NbX2k4XS5jcmVhdGUoZWxlbWVudCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGF1ICE9PSBudWxsKSB7XG4gICAgICBhdVt0aGlzLmh0bWxOYW1lXSA9IGNvbnRyb2xsZXI7XG4gICAgfVxuXG4gICAgaWYgKGluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IgJiYgdmlld0ZhY3RvcnkpIHtcbiAgICAgIGNvbnRyb2xsZXIudmlldy5jcmVhdGVkKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbnRyb2xsZXI7XG4gIH07XG5cbiAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLl9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZCA9IGZ1bmN0aW9uIF9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZChpbnN0YW5jZSwgbG9va3VwKSB7XG4gICAgdmFyIHByb3BlcnRpZXMgPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBvYnNlcnZlciA9IHZvaWQgMDtcblxuICAgIGlmICgnX19wcm9wZXJ0aWVzRGVmaW5lZF9fJyBpbiBsb29rdXApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb29rdXAuX19wcm9wZXJ0aWVzRGVmaW5lZF9fID0gdHJ1ZTtcbiAgICBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xuXG4gICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIG9ic2VydmVyID0gcHJvcGVydGllc1tpXS5jcmVhdGVPYnNlcnZlcihpbnN0YW5jZSk7XG5cbiAgICAgIGlmIChvYnNlcnZlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxvb2t1cFtvYnNlcnZlci5wcm9wZXJ0eU5hbWVdID0gb2JzZXJ2ZXI7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5fY29weUluaGVyaXRlZFByb3BlcnRpZXMgPSBmdW5jdGlvbiBfY29weUluaGVyaXRlZFByb3BlcnRpZXMoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB2YXIgX3RoaXMxNCA9IHRoaXM7XG5cbiAgICB2YXIgYmVoYXZpb3IgPSB2b2lkIDA7XG4gICAgdmFyIGRlcml2ZWQgPSB0YXJnZXQ7XG5cbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgdmFyIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldC5wcm90b3R5cGUpO1xuICAgICAgdGFyZ2V0ID0gcHJvdG8gJiYgcHJvdG8uY29uc3RydWN0b3I7XG4gICAgICBpZiAoIXRhcmdldCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBiZWhhdmlvciA9IG1ldGFkYXRhLmdldE93bihtZXRhZGF0YS5yZXNvdXJjZSwgdGFyZ2V0KTtcbiAgICAgIGlmIChiZWhhdmlvcikge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgYmVoYXZpb3IuaW5pdGlhbGl6ZShjb250YWluZXIsIHRhcmdldCk7XG5cbiAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChfaTksIF9paTgpIHtcbiAgICAgIHZhciBwcm9wID0gYmVoYXZpb3IucHJvcGVydGllc1tfaTldO1xuXG4gICAgICBpZiAoX3RoaXMxNC5wcm9wZXJ0aWVzLnNvbWUoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgcmV0dXJuIHAubmFtZSA9PT0gcHJvcC5uYW1lO1xuICAgICAgfSkpIHtcbiAgICAgICAgcmV0dXJuICdjb250aW51ZSc7XG4gICAgICB9XG5cbiAgICAgIG5ldyBCaW5kYWJsZVByb3BlcnR5KHByb3ApLnJlZ2lzdGVyV2l0aChkZXJpdmVkLCBfdGhpczE0KTtcbiAgICB9O1xuXG4gICAgZm9yICh2YXIgX2k5ID0gMCwgX2lpOCA9IGJlaGF2aW9yLnByb3BlcnRpZXMubGVuZ3RoOyBfaTkgPCBfaWk4OyArK19pOSkge1xuICAgICAgdmFyIF9yZXQgPSBfbG9vcChfaTksIF9paTgpO1xuXG4gICAgICBpZiAoX3JldCA9PT0gJ2NvbnRpbnVlJykgY29udGludWU7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBIdG1sQmVoYXZpb3JSZXNvdXJjZTtcbn0oKTtcblxuZnVuY3Rpb24gY3JlYXRlQ2hpbGRPYnNlcnZlckRlY29yYXRvcihzZWxlY3Rvck9yQ29uZmlnLCBhbGwpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikge1xuICAgIHZhciBhY3R1YWxUYXJnZXQgPSB0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyA/IHRhcmdldC5jb25zdHJ1Y3RvciA6IHRhcmdldDtcbiAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgYWN0dWFsVGFyZ2V0KTtcblxuICAgIGlmICh0eXBlb2Ygc2VsZWN0b3JPckNvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHNlbGVjdG9yT3JDb25maWcgPSB7XG4gICAgICAgIHNlbGVjdG9yOiBzZWxlY3Rvck9yQ29uZmlnLFxuICAgICAgICBuYW1lOiBrZXlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKGRlc2NyaXB0b3IpIHtcbiAgICAgIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO1xuICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO1xuICAgIH1cblxuICAgIHNlbGVjdG9yT3JDb25maWcuYWxsID0gYWxsO1xuICAgIHIuYWRkQ2hpbGRCaW5kaW5nKG5ldyBDaGlsZE9ic2VydmVyKHNlbGVjdG9yT3JDb25maWcpKTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNoaWxkcmVuKHNlbGVjdG9yT3JDb25maWcpIHtcbiAgcmV0dXJuIGNyZWF0ZUNoaWxkT2JzZXJ2ZXJEZWNvcmF0b3Ioc2VsZWN0b3JPckNvbmZpZywgdHJ1ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGlsZChzZWxlY3Rvck9yQ29uZmlnKSB7XG4gIHJldHVybiBjcmVhdGVDaGlsZE9ic2VydmVyRGVjb3JhdG9yKHNlbGVjdG9yT3JDb25maWcsIGZhbHNlKTtcbn1cblxudmFyIENoaWxkT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENoaWxkT2JzZXJ2ZXIoY29uZmlnKSB7XG4gICAgXG5cbiAgICB0aGlzLm5hbWUgPSBjb25maWcubmFtZTtcbiAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSBjb25maWcuY2hhbmdlSGFuZGxlciB8fCB0aGlzLm5hbWUgKyAnQ2hhbmdlZCc7XG4gICAgdGhpcy5zZWxlY3RvciA9IGNvbmZpZy5zZWxlY3RvcjtcbiAgICB0aGlzLmFsbCA9IGNvbmZpZy5hbGw7XG4gIH1cblxuICBDaGlsZE9ic2VydmVyLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUodmlld0hvc3QsIHZpZXdNb2RlbCwgY29udHJvbGxlcikge1xuICAgIHJldHVybiBuZXcgQ2hpbGRPYnNlcnZlckJpbmRlcih0aGlzLnNlbGVjdG9yLCB2aWV3SG9zdCwgdGhpcy5uYW1lLCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIsIHRoaXMuY2hhbmdlSGFuZGxlciwgdGhpcy5hbGwpO1xuICB9O1xuXG4gIHJldHVybiBDaGlsZE9ic2VydmVyO1xufSgpO1xuXG52YXIgbm9NdXRhdGlvbnMgPSBbXTtcblxuZnVuY3Rpb24gdHJhY2tNdXRhdGlvbihncm91cGVkTXV0YXRpb25zLCBiaW5kZXIsIHJlY29yZCkge1xuICB2YXIgbXV0YXRpb25zID0gZ3JvdXBlZE11dGF0aW9ucy5nZXQoYmluZGVyKTtcblxuICBpZiAoIW11dGF0aW9ucykge1xuICAgIG11dGF0aW9ucyA9IFtdO1xuICAgIGdyb3VwZWRNdXRhdGlvbnMuc2V0KGJpbmRlciwgbXV0YXRpb25zKTtcbiAgfVxuXG4gIG11dGF0aW9ucy5wdXNoKHJlY29yZCk7XG59XG5cbmZ1bmN0aW9uIG9uQ2hpbGRDaGFuZ2UobXV0YXRpb25zLCBvYnNlcnZlcikge1xuICB2YXIgYmluZGVycyA9IG9ic2VydmVyLmJpbmRlcnM7XG4gIHZhciBiaW5kZXJzTGVuZ3RoID0gYmluZGVycy5sZW5ndGg7XG5cbiAgdmFyIGdyb3VwZWRNdXRhdGlvbnMgPSBuZXcgTWFwKCk7XG5cbiAgZm9yICh2YXIgX2kxMCA9IDAsIF9paTkgPSBtdXRhdGlvbnMubGVuZ3RoOyBfaTEwIDwgX2lpOTsgKytfaTEwKSB7XG4gICAgdmFyIHJlY29yZCA9IG11dGF0aW9uc1tfaTEwXTtcbiAgICB2YXIgYWRkZWQgPSByZWNvcmQuYWRkZWROb2RlcztcbiAgICB2YXIgcmVtb3ZlZCA9IHJlY29yZC5yZW1vdmVkTm9kZXM7XG5cbiAgICBmb3IgKHZhciBqID0gMCwgamogPSByZW1vdmVkLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcbiAgICAgIHZhciBfbm9kZSA9IHJlbW92ZWRbal07XG4gICAgICBpZiAoX25vZGUubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBiaW5kZXJzTGVuZ3RoOyArK2spIHtcbiAgICAgICAgICB2YXIgYmluZGVyID0gYmluZGVyc1trXTtcblxuICAgICAgICAgIGlmIChiaW5kZXIub25SZW1vdmUoX25vZGUpKSB7XG4gICAgICAgICAgICB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIGJpbmRlciwgcmVjb3JkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBfaiA9IDAsIF9qaiA9IGFkZGVkLmxlbmd0aDsgX2ogPCBfamo7ICsrX2opIHtcbiAgICAgIHZhciBfbm9kZTIgPSBhZGRlZFtfal07XG4gICAgICBpZiAoX25vZGUyLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgIGZvciAodmFyIF9rID0gMDsgX2sgPCBiaW5kZXJzTGVuZ3RoOyArK19rKSB7XG4gICAgICAgICAgdmFyIF9iaW5kZXIgPSBiaW5kZXJzW19rXTtcblxuICAgICAgICAgIGlmIChfYmluZGVyLm9uQWRkKF9ub2RlMikpIHtcbiAgICAgICAgICAgIHRyYWNrTXV0YXRpb24oZ3JvdXBlZE11dGF0aW9ucywgX2JpbmRlciwgcmVjb3JkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBncm91cGVkTXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gKG11dGF0aW9uUmVjb3JkcywgYmluZGVyKSB7XG4gICAgaWYgKGJpbmRlci5pc0JvdW5kICYmIGJpbmRlci5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XG4gICAgICBiaW5kZXIudmlld01vZGVsW2JpbmRlci5jaGFuZ2VIYW5kbGVyXShtdXRhdGlvblJlY29yZHMpO1xuICAgIH1cbiAgfSk7XG59XG5cbnZhciBDaGlsZE9ic2VydmVyQmluZGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDaGlsZE9ic2VydmVyQmluZGVyKHNlbGVjdG9yLCB2aWV3SG9zdCwgcHJvcGVydHksIHZpZXdNb2RlbCwgY29udHJvbGxlciwgY2hhbmdlSGFuZGxlciwgYWxsKSB7XG4gICAgXG5cbiAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7XG5cbiAgICB0aGlzLnZpZXdIb3N0ID0gdmlld0hvc3Q7XG4gICAgdGhpcy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xuICAgIHRoaXMudmlld01vZGVsID0gdmlld01vZGVsO1xuICAgIHRoaXMuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XG4gICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gY2hhbmdlSGFuZGxlciBpbiB2aWV3TW9kZWwgPyBjaGFuZ2VIYW5kbGVyIDogbnVsbDtcbiAgICB0aGlzLnVzZXNTaGFkb3dET00gPSBjb250cm9sbGVyLmJlaGF2aW9yLnVzZXNTaGFkb3dET007XG4gICAgdGhpcy5hbGwgPSBhbGw7XG5cbiAgICBpZiAoIXRoaXMudXNlc1NoYWRvd0RPTSAmJiBjb250cm9sbGVyLnZpZXcgJiYgY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3KSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICB9XG5cbiAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uIG1hdGNoZXMoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50Lm1hdGNoZXModGhpcy5zZWxlY3RvcikpIHtcbiAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgY29udGVudFZpZXcgPSB0aGlzLmNvbnRlbnRWaWV3O1xuICAgICAgdmFyIGFzc2lnbmVkU2xvdCA9IGVsZW1lbnQuYXVBc3NpZ25lZFNsb3Q7XG5cbiAgICAgIGlmIChhc3NpZ25lZFNsb3QgJiYgYXNzaWduZWRTbG90LnByb2plY3RGcm9tQW5jaG9ycykge1xuICAgICAgICB2YXIgYW5jaG9ycyA9IGFzc2lnbmVkU2xvdC5wcm9qZWN0RnJvbUFuY2hvcnM7XG5cbiAgICAgICAgZm9yICh2YXIgX2kxMSA9IDAsIF9paTEwID0gYW5jaG9ycy5sZW5ndGg7IF9pMTEgPCBfaWkxMDsgKytfaTExKSB7XG4gICAgICAgICAgaWYgKGFuY2hvcnNbX2kxMV0uYXVPd25lclZpZXcgPT09IGNvbnRlbnRWaWV3KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbGVtZW50LmF1T3duZXJWaWV3ID09PSBjb250ZW50VmlldztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoc291cmNlKSB7XG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgaWYgKHRoaXMuc291cmNlID09PSBzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG5cbiAgICB2YXIgdmlld0hvc3QgPSB0aGlzLnZpZXdIb3N0O1xuICAgIHZhciB2aWV3TW9kZWwgPSB0aGlzLnZpZXdNb2RlbDtcbiAgICB2YXIgb2JzZXJ2ZXIgPSB2aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXztcblxuICAgIGlmICghb2JzZXJ2ZXIpIHtcbiAgICAgIG9ic2VydmVyID0gdmlld0hvc3QuX19jaGlsZE9ic2VydmVyX18gPSBET00uY3JlYXRlTXV0YXRpb25PYnNlcnZlcihvbkNoaWxkQ2hhbmdlKTtcblxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgc3VidHJlZTogIXRoaXMudXNlc1NoYWRvd0RPTVxuICAgICAgfTtcblxuICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3SG9zdCwgb3B0aW9ucyk7XG4gICAgICBvYnNlcnZlci5iaW5kZXJzID0gW107XG4gICAgfVxuXG4gICAgb2JzZXJ2ZXIuYmluZGVycy5wdXNoKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMudXNlc1NoYWRvd0RPTSkge1xuICAgICAgdmFyIGN1cnJlbnQgPSB2aWV3SG9zdC5maXJzdEVsZW1lbnRDaGlsZDtcblxuICAgICAgaWYgKHRoaXMuYWxsKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IHZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XTtcbiAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgIGl0ZW1zID0gdmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaXRlbXMuc3BsaWNlKDApO1xuICAgICAgICB9XG5cbiAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHtcbiAgICAgICAgICBpZiAodGhpcy5tYXRjaGVzKGN1cnJlbnQpKSB7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKGN1cnJlbnQuYXUgJiYgY3VycmVudC5hdS5jb250cm9sbGVyID8gY3VycmVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbCA6IGN1cnJlbnQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm5leHRFbGVtZW50U2libGluZztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLmNoYW5nZUhhbmRsZXJdKG5vTXV0YXRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHtcbiAgICAgICAgICBpZiAodGhpcy5tYXRjaGVzKGN1cnJlbnQpKSB7XG4gICAgICAgICAgICB2YXIgX3ZhbHVlID0gY3VycmVudC5hdSAmJiBjdXJyZW50LmF1LmNvbnRyb2xsZXIgPyBjdXJyZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogY3VycmVudDtcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gX3ZhbHVlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0oX3ZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLm9uUmVtb3ZlID0gZnVuY3Rpb24gb25SZW1vdmUoZWxlbWVudCkge1xuICAgIGlmICh0aGlzLm1hdGNoZXMoZWxlbWVudCkpIHtcbiAgICAgIHZhciBfdmFsdWUyID0gZWxlbWVudC5hdSAmJiBlbGVtZW50LmF1LmNvbnRyb2xsZXIgPyBlbGVtZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogZWxlbWVudDtcblxuICAgICAgaWYgKHRoaXMuYWxsKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldIHx8ICh0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IFtdKTtcbiAgICAgICAgdmFyIGluZGV4ID0gaXRlbXMuaW5kZXhPZihfdmFsdWUyKTtcblxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgaXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgY3VycmVudFZhbHVlID0gdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV07XG4gICAgICBpZiAoY3VycmVudFZhbHVlID09PSBfdmFsdWUyKSB7XG4gICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gbnVsbDtcblxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kICYmIHRoaXMuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0oX3ZhbHVlMik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUub25BZGQgPSBmdW5jdGlvbiBvbkFkZChlbGVtZW50KSB7XG4gICAgaWYgKHRoaXMubWF0Y2hlcyhlbGVtZW50KSkge1xuICAgICAgdmFyIF92YWx1ZTMgPSBlbGVtZW50LmF1ICYmIGVsZW1lbnQuYXUuY29udHJvbGxlciA/IGVsZW1lbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBlbGVtZW50O1xuXG4gICAgICBpZiAodGhpcy5hbGwpIHtcbiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gfHwgKHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW10pO1xuXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdG9yID09PSAnKicpIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKF92YWx1ZTMpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgdmFyIHByZXYgPSBlbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG5cbiAgICAgICAgd2hpbGUgKHByZXYpIHtcbiAgICAgICAgICBpZiAodGhpcy5tYXRjaGVzKHByZXYpKSB7XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByZXYgPSBwcmV2LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICAgIH1cblxuICAgICAgICBpdGVtcy5zcGxpY2UoaW5kZXgsIDAsIF92YWx1ZTMpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBfdmFsdWUzO1xuXG4gICAgICBpZiAodGhpcy5pc0JvdW5kICYmIHRoaXMuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLmNoYW5nZUhhbmRsZXJdKF92YWx1ZTMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHZhciBjaGlsZE9ic2VydmVyID0gdGhpcy52aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXztcbiAgICBpZiAoY2hpbGRPYnNlcnZlcikge1xuICAgICAgdmFyIGJpbmRlcnMgPSBjaGlsZE9ic2VydmVyLmJpbmRlcnM7XG4gICAgICBpZiAoYmluZGVycyAmJiBiaW5kZXJzLmxlbmd0aCkge1xuICAgICAgICB2YXIgaWR4ID0gYmluZGVycy5pbmRleE9mKHRoaXMpO1xuICAgICAgICBpZiAoaWR4ICE9PSAtMSkge1xuICAgICAgICAgIGJpbmRlcnMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJpbmRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgY2hpbGRPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgdGhpcy52aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMudXNlc1NoYWRvd0RPTSkge1xuICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDaGlsZE9ic2VydmVyQmluZGVyO1xufSgpO1xuXG5mdW5jdGlvbiByZW1vdmUodmlld1Nsb3QsIHByZXZpb3VzKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHByZXZpb3VzKSA/IHZpZXdTbG90LnJlbW92ZU1hbnkocHJldmlvdXMsIHRydWUpIDogdmlld1Nsb3QucmVtb3ZlKHByZXZpb3VzLCB0cnVlKTtcbn1cblxuZXhwb3J0IHZhciBTd2FwU3RyYXRlZ2llcyA9IHtcbiAgYmVmb3JlOiBmdW5jdGlvbiBiZWZvcmUodmlld1Nsb3QsIHByZXZpb3VzLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBwcmV2aW91cyA9PT0gdW5kZWZpbmVkID8gY2FsbGJhY2soKSA6IGNhbGxiYWNrKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcmVtb3ZlKHZpZXdTbG90LCBwcmV2aW91cyk7XG4gICAgfSk7XG4gIH0sXG4gIHdpdGg6IGZ1bmN0aW9uIF93aXRoKHZpZXdTbG90LCBwcmV2aW91cywgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gcHJldmlvdXMgPT09IHVuZGVmaW5lZCA/IGNhbGxiYWNrKCkgOiBQcm9taXNlLmFsbChbcmVtb3ZlKHZpZXdTbG90LCBwcmV2aW91cyksIGNhbGxiYWNrKCldKTtcbiAgfSxcbiAgYWZ0ZXI6IGZ1bmN0aW9uIGFmdGVyKHZpZXdTbG90LCBwcmV2aW91cywgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZpZXdTbG90LnJlbW92ZUFsbCh0cnVlKSkudGhlbihjYWxsYmFjayk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHRyeUFjdGl2YXRlVmlld01vZGVsKGNvbnRleHQpIHtcbiAgaWYgKGNvbnRleHQuc2tpcEFjdGl2YXRpb24gfHwgdHlwZW9mIGNvbnRleHQudmlld01vZGVsLmFjdGl2YXRlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgcmV0dXJuIGNvbnRleHQudmlld01vZGVsLmFjdGl2YXRlKGNvbnRleHQubW9kZWwpIHx8IFByb21pc2UucmVzb2x2ZSgpO1xufVxuXG5leHBvcnQgdmFyIENvbXBvc2l0aW9uRW5naW5lID0gKF9kZWM4ID0gaW5qZWN0KFZpZXdFbmdpbmUsIFZpZXdMb2NhdG9yKSwgX2RlYzgoX2NsYXNzMTYgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbXBvc2l0aW9uRW5naW5lKHZpZXdFbmdpbmUsIHZpZXdMb2NhdG9yKSB7XG4gICAgXG5cbiAgICB0aGlzLnZpZXdFbmdpbmUgPSB2aWV3RW5naW5lO1xuICAgIHRoaXMudmlld0xvY2F0b3IgPSB2aWV3TG9jYXRvcjtcbiAgfVxuXG4gIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5fc3dhcCA9IGZ1bmN0aW9uIF9zd2FwKGNvbnRleHQsIHZpZXcpIHtcbiAgICB2YXIgc3dhcFN0cmF0ZWd5ID0gU3dhcFN0cmF0ZWdpZXNbY29udGV4dC5zd2FwT3JkZXJdIHx8IFN3YXBTdHJhdGVnaWVzLmFmdGVyO1xuICAgIHZhciBwcmV2aW91c1ZpZXdzID0gY29udGV4dC52aWV3U2xvdC5jaGlsZHJlbi5zbGljZSgpO1xuXG4gICAgcmV0dXJuIHN3YXBTdHJhdGVneShjb250ZXh0LnZpZXdTbG90LCBwcmV2aW91c1ZpZXdzLCBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbnRleHQudmlld1Nsb3QuYWRkKHZpZXcpKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNvbnRleHQuY3VycmVudENvbnRyb2xsZXIpIHtcbiAgICAgICAgICBjb250ZXh0LmN1cnJlbnRDb250cm9sbGVyLnVuYmluZCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xuICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllci5kb25lKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLl9jcmVhdGVDb250cm9sbGVyQW5kU3dhcCA9IGZ1bmN0aW9uIF9jcmVhdGVDb250cm9sbGVyQW5kU3dhcChjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzMTUgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlQ29udHJvbGxlcihjb250ZXh0KS50aGVuKGZ1bmN0aW9uIChjb250cm9sbGVyKSB7XG4gICAgICBpZiAoY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLndhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29udHJvbGxlci5hdXRvbWF0ZShjb250ZXh0Lm92ZXJyaWRlQ29udGV4dCwgY29udGV4dC5vd25pbmdWaWV3KTtcblxuICAgICAgICAgIHJldHVybiBfdGhpczE1Ll9zd2FwKGNvbnRleHQsIGNvbnRyb2xsZXIudmlldyk7XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjb250cm9sbGVyO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29udHJvbGxlci5hdXRvbWF0ZShjb250ZXh0Lm92ZXJyaWRlQ29udGV4dCwgY29udGV4dC5vd25pbmdWaWV3KTtcblxuICAgICAgcmV0dXJuIF90aGlzMTUuX3N3YXAoY29udGV4dCwgY29udHJvbGxlci52aWV3KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXI7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBDb21wb3NpdGlvbkVuZ2luZS5wcm90b3R5cGUuY3JlYXRlQ29udHJvbGxlciA9IGZ1bmN0aW9uIGNyZWF0ZUNvbnRyb2xsZXIoY29udGV4dCkge1xuICAgIHZhciBfdGhpczE2ID0gdGhpcztcblxuICAgIHZhciBjaGlsZENvbnRhaW5lciA9IHZvaWQgMDtcbiAgICB2YXIgdmlld01vZGVsID0gdm9pZCAwO1xuICAgIHZhciB2aWV3TW9kZWxSZXNvdXJjZSA9IHZvaWQgMDtcblxuICAgIHZhciBtID0gdm9pZCAwO1xuXG4gICAgcmV0dXJuIHRoaXMuZW5zdXJlVmlld01vZGVsKGNvbnRleHQpLnRoZW4odHJ5QWN0aXZhdGVWaWV3TW9kZWwpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgY2hpbGRDb250YWluZXIgPSBjb250ZXh0LmNoaWxkQ29udGFpbmVyO1xuICAgICAgdmlld01vZGVsID0gY29udGV4dC52aWV3TW9kZWw7XG4gICAgICB2aWV3TW9kZWxSZXNvdXJjZSA9IGNvbnRleHQudmlld01vZGVsUmVzb3VyY2U7XG4gICAgICBtID0gdmlld01vZGVsUmVzb3VyY2UubWV0YWRhdGE7XG5cbiAgICAgIHZhciB2aWV3U3RyYXRlZ3kgPSBfdGhpczE2LnZpZXdMb2NhdG9yLmdldFZpZXdTdHJhdGVneShjb250ZXh0LnZpZXcgfHwgdmlld01vZGVsKTtcblxuICAgICAgaWYgKGNvbnRleHQudmlld1Jlc291cmNlcykge1xuICAgICAgICB2aWV3U3RyYXRlZ3kubWFrZVJlbGF0aXZlVG8oY29udGV4dC52aWV3UmVzb3VyY2VzLnZpZXdVcmwpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbS5sb2FkKGNoaWxkQ29udGFpbmVyLCB2aWV3TW9kZWxSZXNvdXJjZS52YWx1ZSwgbnVsbCwgdmlld1N0cmF0ZWd5LCB0cnVlKTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uICh2aWV3RmFjdG9yeSkge1xuICAgICAgcmV0dXJuIG0uY3JlYXRlKGNoaWxkQ29udGFpbmVyLCBCZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWMoY29udGV4dC5ob3N0LCB2aWV3TW9kZWwsIHZpZXdGYWN0b3J5KSk7XG4gICAgfSk7XG4gIH07XG5cbiAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLmVuc3VyZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIGVuc3VyZVZpZXdNb2RlbChjb250ZXh0KSB7XG4gICAgdmFyIGNoaWxkQ29udGFpbmVyID0gY29udGV4dC5jaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXIgfHwgY29udGV4dC5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcblxuICAgIGlmICh0eXBlb2YgY29udGV4dC52aWV3TW9kZWwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBjb250ZXh0LnZpZXdNb2RlbCA9IGNvbnRleHQudmlld1Jlc291cmNlcyA/IGNvbnRleHQudmlld1Jlc291cmNlcy5yZWxhdGl2ZVRvVmlldyhjb250ZXh0LnZpZXdNb2RlbCkgOiBjb250ZXh0LnZpZXdNb2RlbDtcblxuICAgICAgcmV0dXJuIHRoaXMudmlld0VuZ2luZS5pbXBvcnRWaWV3TW9kZWxSZXNvdXJjZShjb250ZXh0LnZpZXdNb2RlbCkudGhlbihmdW5jdGlvbiAodmlld01vZGVsUmVzb3VyY2UpIHtcbiAgICAgICAgY2hpbGRDb250YWluZXIuYXV0b1JlZ2lzdGVyKHZpZXdNb2RlbFJlc291cmNlLnZhbHVlKTtcblxuICAgICAgICBpZiAoY29udGV4dC5ob3N0KSB7XG4gICAgICAgICAgY2hpbGRDb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uRWxlbWVudCwgY29udGV4dC5ob3N0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQudmlld01vZGVsID0gY2hpbGRDb250YWluZXIudmlld01vZGVsID0gY2hpbGRDb250YWluZXIuZ2V0KHZpZXdNb2RlbFJlc291cmNlLnZhbHVlKTtcbiAgICAgICAgY29udGV4dC52aWV3TW9kZWxSZXNvdXJjZSA9IHZpZXdNb2RlbFJlc291cmNlO1xuICAgICAgICByZXR1cm4gY29udGV4dDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBjdG9yID0gY29udGV4dC52aWV3TW9kZWwuY29uc3RydWN0b3I7XG4gICAgdmFyIGlzQ2xhc3MgPSB0eXBlb2YgY29udGV4dC52aWV3TW9kZWwgPT09ICdmdW5jdGlvbic7XG4gICAgaWYgKGlzQ2xhc3MpIHtcbiAgICAgIGN0b3IgPSBjb250ZXh0LnZpZXdNb2RlbDtcbiAgICAgIGNoaWxkQ29udGFpbmVyLmF1dG9SZWdpc3RlcihjdG9yKTtcbiAgICB9XG4gICAgdmFyIG0gPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGN0b3IpO1xuXG4gICAgbS5lbGVtZW50TmFtZSA9IG0uZWxlbWVudE5hbWUgfHwgJ2R5bmFtaWMtZWxlbWVudCc7XG5cbiAgICBtLmluaXRpYWxpemUoaXNDbGFzcyA/IGNoaWxkQ29udGFpbmVyIDogY29udGV4dC5jb250YWluZXIgfHwgY2hpbGRDb250YWluZXIsIGN0b3IpO1xuXG4gICAgY29udGV4dC52aWV3TW9kZWxSZXNvdXJjZSA9IHsgbWV0YWRhdGE6IG0sIHZhbHVlOiBjdG9yIH07XG5cbiAgICBpZiAoY29udGV4dC5ob3N0KSB7XG4gICAgICBjaGlsZENvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKERPTS5FbGVtZW50LCBjb250ZXh0Lmhvc3QpO1xuICAgIH1cbiAgICBjaGlsZENvbnRhaW5lci52aWV3TW9kZWwgPSBjb250ZXh0LnZpZXdNb2RlbCA9IGlzQ2xhc3MgPyBjaGlsZENvbnRhaW5lci5nZXQoY3RvcikgOiBjb250ZXh0LnZpZXdNb2RlbDtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbnRleHQpO1xuICB9O1xuXG4gIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5jb21wb3NlID0gZnVuY3Rpb24gY29tcG9zZShjb250ZXh0KSB7XG4gICAgdmFyIF90aGlzMTcgPSB0aGlzO1xuXG4gICAgY29udGV4dC5jaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXIgfHwgY29udGV4dC5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcbiAgICBjb250ZXh0LnZpZXcgPSB0aGlzLnZpZXdMb2NhdG9yLmdldFZpZXdTdHJhdGVneShjb250ZXh0LnZpZXcpO1xuXG4gICAgdmFyIHRyYW5zYWN0aW9uID0gY29udGV4dC5jaGlsZENvbnRhaW5lci5nZXQoQ29tcG9zaXRpb25UcmFuc2FjdGlvbik7XG4gICAgdmFyIGNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IHRyYW5zYWN0aW9uLnRyeUNhcHR1cmUoKTtcblxuICAgIGlmIChjb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4pIHtcbiAgICAgIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IHRyYW5zYWN0aW9uLmVubGlzdCgpO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0LnZpZXdNb2RlbCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUNvbnRyb2xsZXJBbmRTd2FwKGNvbnRleHQpO1xuICAgIH0gZWxzZSBpZiAoY29udGV4dC52aWV3KSB7XG4gICAgICBpZiAoY29udGV4dC52aWV3UmVzb3VyY2VzKSB7XG4gICAgICAgIGNvbnRleHQudmlldy5tYWtlUmVsYXRpdmVUbyhjb250ZXh0LnZpZXdSZXNvdXJjZXMudmlld1VybCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb250ZXh0LnZpZXcubG9hZFZpZXdGYWN0b3J5KHRoaXMudmlld0VuZ2luZSwgbmV3IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24oKSkudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHZpZXdGYWN0b3J5LmNyZWF0ZShjb250ZXh0LmNoaWxkQ29udGFpbmVyKTtcbiAgICAgICAgcmVzdWx0LmJpbmQoY29udGV4dC5iaW5kaW5nQ29udGV4dCwgY29udGV4dC5vdmVycmlkZUNvbnRleHQpO1xuXG4gICAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbikge1xuICAgICAgICAgIHJldHVybiBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi53YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzMTcuX3N3YXAoY29udGV4dCwgcmVzdWx0KTtcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gX3RoaXMxNy5fc3dhcChjb250ZXh0LCByZXN1bHQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChjb250ZXh0LnZpZXdTbG90KSB7XG4gICAgICBjb250ZXh0LnZpZXdTbG90LnJlbW92ZUFsbCgpO1xuXG4gICAgICBpZiAoY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIpIHtcbiAgICAgICAgY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIuZG9uZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gIH07XG5cbiAgcmV0dXJuIENvbXBvc2l0aW9uRW5naW5lO1xufSgpKSB8fCBfY2xhc3MxNik7XG5cbmV4cG9ydCB2YXIgRWxlbWVudENvbmZpZ1Jlc291cmNlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFbGVtZW50Q29uZmlnUmVzb3VyY2UoKSB7XG4gICAgXG4gIH1cblxuICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KSB7fTtcblxuICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpIHt9O1xuXG4gIEVsZW1lbnRDb25maWdSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB2YXIgY29uZmlnID0gbmV3IHRhcmdldCgpO1xuICAgIHZhciBldmVudE1hbmFnZXIgPSBjb250YWluZXIuZ2V0KEV2ZW50TWFuYWdlcik7XG4gICAgZXZlbnRNYW5hZ2VyLnJlZ2lzdGVyRWxlbWVudENvbmZpZyhjb25maWcpO1xuICB9O1xuXG4gIHJldHVybiBFbGVtZW50Q29uZmlnUmVzb3VyY2U7XG59KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNvdXJjZShpbnN0YW5jZU9yQ29uZmlnKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdmFyIGlzQ29uZmlnID0gdHlwZW9mIGluc3RhbmNlT3JDb25maWcgPT09ICdzdHJpbmcnIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0YW5jZU9yQ29uZmlnKSA9PT0gT2JqZWN0LnByb3RvdHlwZTtcbiAgICBpZiAoaXNDb25maWcpIHtcbiAgICAgIHRhcmdldC4kcmVzb3VyY2UgPSBpbnN0YW5jZU9yQ29uZmlnO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGluc3RhbmNlT3JDb25maWcsIHRhcmdldCk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmVoYXZpb3Iob3ZlcnJpZGUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBpZiAob3ZlcnJpZGUgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xuICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBvdmVycmlkZSwgdGFyZ2V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHRhcmdldCk7XG4gICAgICBPYmplY3QuYXNzaWduKHIsIG92ZXJyaWRlKTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjdXN0b21FbGVtZW50KG5hbWUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdGFyZ2V0KTtcbiAgICByLmVsZW1lbnROYW1lID0gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZSwgJ2N1c3RvbSBlbGVtZW50Jyk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjdXN0b21BdHRyaWJ1dGUobmFtZSwgZGVmYXVsdEJpbmRpbmdNb2RlLCBhbGlhc2VzKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHRhcmdldCk7XG4gICAgci5hdHRyaWJ1dGVOYW1lID0gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZSwgJ2N1c3RvbSBhdHRyaWJ1dGUnKTtcbiAgICByLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IGRlZmF1bHRCaW5kaW5nTW9kZTtcbiAgICByLmFsaWFzZXMgPSBhbGlhc2VzO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdGVtcGxhdGVDb250cm9sbGVyKHRhcmdldCkge1xuICB2YXIgZGVjbyA9IGZ1bmN0aW9uIGRlY28odCkge1xuICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcbiAgICByLmxpZnRzQ29udGVudCA9IHRydWU7XG4gIH07XG5cbiAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBiaW5kYWJsZShuYW1lT3JDb25maWdPclRhcmdldCwga2V5LCBkZXNjcmlwdG9yKSB7XG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0YXJnZXQsIGtleTIsIGRlc2NyaXB0b3IyKSB7XG4gICAgdmFyIGFjdHVhbFRhcmdldCA9IGtleTIgPyB0YXJnZXQuY29uc3RydWN0b3IgOiB0YXJnZXQ7XG4gICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGFjdHVhbFRhcmdldCk7XG4gICAgdmFyIHByb3AgPSB2b2lkIDA7XG5cbiAgICBpZiAoa2V5Mikge1xuICAgICAgbmFtZU9yQ29uZmlnT3JUYXJnZXQgPSBuYW1lT3JDb25maWdPclRhcmdldCB8fCB7fTtcbiAgICAgIG5hbWVPckNvbmZpZ09yVGFyZ2V0Lm5hbWUgPSBrZXkyO1xuICAgIH1cblxuICAgIHByb3AgPSBuZXcgQmluZGFibGVQcm9wZXJ0eShuYW1lT3JDb25maWdPclRhcmdldCk7XG4gICAgcmV0dXJuIHByb3AucmVnaXN0ZXJXaXRoKGFjdHVhbFRhcmdldCwgciwgZGVzY3JpcHRvcjIpO1xuICB9O1xuXG4gIGlmICghbmFtZU9yQ29uZmlnT3JUYXJnZXQpIHtcbiAgICByZXR1cm4gZGVjbztcbiAgfVxuXG4gIGlmIChrZXkpIHtcbiAgICB2YXIgX3RhcmdldCA9IG5hbWVPckNvbmZpZ09yVGFyZ2V0O1xuICAgIG5hbWVPckNvbmZpZ09yVGFyZ2V0ID0gbnVsbDtcbiAgICByZXR1cm4gZGVjbyhfdGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpO1xuICB9XG5cbiAgcmV0dXJuIGRlY287XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkeW5hbWljT3B0aW9ucyh0YXJnZXQpIHtcbiAgdmFyIGRlY28gPSBmdW5jdGlvbiBkZWNvKHQpIHtcbiAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XG4gICAgci5oYXNEeW5hbWljT3B0aW9ucyA9IHRydWU7XG4gIH07XG5cbiAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XG59XG5cbnZhciBkZWZhdWx0U2hhZG93RE9NT3B0aW9ucyA9IHsgbW9kZTogJ29wZW4nIH07XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VTaGFkb3dET00odGFyZ2V0T3JPcHRpb25zKSB7XG4gIHZhciBvcHRpb25zID0gdHlwZW9mIHRhcmdldE9yT3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJyB8fCAhdGFyZ2V0T3JPcHRpb25zID8gZGVmYXVsdFNoYWRvd0RPTU9wdGlvbnMgOiB0YXJnZXRPck9wdGlvbnM7XG5cbiAgdmFyIGRlY28gPSBmdW5jdGlvbiBkZWNvKHQpIHtcbiAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XG4gICAgci50YXJnZXRTaGFkb3dET00gPSB0cnVlO1xuICAgIHIuc2hhZG93RE9NT3B0aW9ucyA9IG9wdGlvbnM7XG4gIH07XG5cbiAgcmV0dXJuIHR5cGVvZiB0YXJnZXRPck9wdGlvbnMgPT09ICdmdW5jdGlvbicgPyBkZWNvKHRhcmdldE9yT3B0aW9ucykgOiBkZWNvO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvY2Vzc0F0dHJpYnV0ZXMocHJvY2Vzc29yKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcbiAgICByLnByb2Nlc3NBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGF0dHJpYnV0ZXMsIGVsZW1lbnRJbnN0cnVjdGlvbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcHJvY2Vzc29yKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGF0dHJpYnV0ZXMsIGVsZW1lbnRJbnN0cnVjdGlvbik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBMb2dNYW5hZ2VyLmdldExvZ2dlcigndGVtcGxhdGluZycpLmVycm9yKGVycm9yKTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xufVxuXG5mdW5jdGlvbiBkb05vdFByb2Nlc3NDb250ZW50KCkge1xuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzQ29udGVudChwcm9jZXNzb3IpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7XG4gICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xuICAgIHIucHJvY2Vzc0NvbnRlbnQgPSBwcm9jZXNzb3IgPyBmdW5jdGlvbiAoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBwcm9jZXNzb3IoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmcnKS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IDogZG9Ob3RQcm9jZXNzQ29udGVudDtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnRhaW5lcmxlc3ModGFyZ2V0KSB7XG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0KSB7XG4gICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xuICAgIHIuY29udGFpbmVybGVzcyA9IHRydWU7XG4gIH07XG5cbiAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VWaWV3U3RyYXRlZ3koc3RyYXRlZ3kpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIHN0cmF0ZWd5LCB0YXJnZXQpO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlVmlldyhwYXRoKSB7XG4gIHJldHVybiB1c2VWaWV3U3RyYXRlZ3kobmV3IFJlbGF0aXZlVmlld1N0cmF0ZWd5KHBhdGgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlubGluZVZpZXcobWFya3VwLCBkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XG4gIHJldHVybiB1c2VWaWV3U3RyYXRlZ3kobmV3IElubGluZVZpZXdTdHJhdGVneShtYXJrdXAsIGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vVmlldyh0YXJnZXRPckRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpIHtcbiAgdmFyIHRhcmdldCA9IHZvaWQgMDtcbiAgdmFyIGRlcGVuZGVuY2llcyA9IHZvaWQgMDtcbiAgaWYgKHR5cGVvZiB0YXJnZXRPckRlcGVuZGVuY2llcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHRhcmdldCA9IHRhcmdldE9yRGVwZW5kZW5jaWVzO1xuICB9IGVsc2Uge1xuICAgIGRlcGVuZGVuY2llcyA9IHRhcmdldE9yRGVwZW5kZW5jaWVzO1xuICAgIHRhcmdldCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0KSB7XG4gICAgbWV0YWRhdGEuZGVmaW5lKFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5LCBuZXcgTm9WaWV3U3RyYXRlZ3koZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCksIHQpO1xuICB9O1xuXG4gIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmlldyh0ZW1wbGF0ZU9yQ29uZmlnKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdGFyZ2V0LiR2aWV3ID0gdGVtcGxhdGVPckNvbmZpZztcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVsZW1lbnRDb25maWcodGFyZ2V0KSB7XG4gIHZhciBkZWNvID0gZnVuY3Rpb24gZGVjbyh0KSB7XG4gICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgRWxlbWVudENvbmZpZ1Jlc291cmNlKCksIHQpO1xuICB9O1xuXG4gIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmlld1Jlc291cmNlcygpIHtcbiAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHJlc291cmNlcyA9IEFycmF5KF9sZW4pLCBfa2V5NyA9IDA7IF9rZXk3IDwgX2xlbjsgX2tleTcrKykge1xuICAgIHJlc291cmNlc1tfa2V5N10gPSBhcmd1bWVudHNbX2tleTddO1xuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0VuZ2luZS52aWV3TW9kZWxSZXF1aXJlTWV0YWRhdGFLZXksIHJlc291cmNlcywgdGFyZ2V0KTtcbiAgfTtcbn1cblxuZXhwb3J0IHZhciBUZW1wbGF0aW5nRW5naW5lID0gKF9kZWM5ID0gaW5qZWN0KENvbnRhaW5lciwgTW9kdWxlQW5hbHl6ZXIsIFZpZXdDb21waWxlciwgQ29tcG9zaXRpb25FbmdpbmUpLCBfZGVjOShfY2xhc3MxNyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVGVtcGxhdGluZ0VuZ2luZShjb250YWluZXIsIG1vZHVsZUFuYWx5emVyLCB2aWV3Q29tcGlsZXIsIGNvbXBvc2l0aW9uRW5naW5lKSB7XG4gICAgXG5cbiAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5fbW9kdWxlQW5hbHl6ZXIgPSBtb2R1bGVBbmFseXplcjtcbiAgICB0aGlzLl92aWV3Q29tcGlsZXIgPSB2aWV3Q29tcGlsZXI7XG4gICAgdGhpcy5fY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcbiAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShBbmltYXRvciwgQW5pbWF0b3IuaW5zdGFuY2UgPSBuZXcgQW5pbWF0b3IoKSk7XG4gIH1cblxuICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5jb25maWd1cmVBbmltYXRvciA9IGZ1bmN0aW9uIGNvbmZpZ3VyZUFuaW1hdG9yKGFuaW1hdG9yKSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnVucmVnaXN0ZXIoQW5pbWF0b3IpO1xuICAgIHRoaXMuX2NvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKEFuaW1hdG9yLCBBbmltYXRvci5pbnN0YW5jZSA9IGFuaW1hdG9yKTtcbiAgfTtcblxuICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5jb21wb3NlID0gZnVuY3Rpb24gY29tcG9zZShjb250ZXh0KSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbXBvc2l0aW9uRW5naW5lLmNvbXBvc2UoY29udGV4dCk7XG4gIH07XG5cbiAgVGVtcGxhdGluZ0VuZ2luZS5wcm90b3R5cGUuZW5oYW5jZSA9IGZ1bmN0aW9uIGVuaGFuY2UoaW5zdHJ1Y3Rpb24pIHtcbiAgICBpZiAoaW5zdHJ1Y3Rpb24gaW5zdGFuY2VvZiBET00uRWxlbWVudCkge1xuICAgICAgaW5zdHJ1Y3Rpb24gPSB7IGVsZW1lbnQ6IGluc3RydWN0aW9uIH07XG4gICAgfVxuXG4gICAgdmFyIGNvbXBpbGVySW5zdHJ1Y3Rpb25zID0geyBsZXRFeHByZXNzaW9uczogW10gfTtcbiAgICB2YXIgcmVzb3VyY2VzID0gaW5zdHJ1Y3Rpb24ucmVzb3VyY2VzIHx8IHRoaXMuX2NvbnRhaW5lci5nZXQoVmlld1Jlc291cmNlcyk7XG5cbiAgICB0aGlzLl92aWV3Q29tcGlsZXIuX2NvbXBpbGVOb2RlKGluc3RydWN0aW9uLmVsZW1lbnQsIHJlc291cmNlcywgY29tcGlsZXJJbnN0cnVjdGlvbnMsIGluc3RydWN0aW9uLmVsZW1lbnQucGFyZW50Tm9kZSwgJ3Jvb3QnLCB0cnVlKTtcblxuICAgIHZhciBmYWN0b3J5ID0gbmV3IFZpZXdGYWN0b3J5KGluc3RydWN0aW9uLmVsZW1lbnQsIGNvbXBpbGVySW5zdHJ1Y3Rpb25zLCByZXNvdXJjZXMpO1xuICAgIHZhciBjb250YWluZXIgPSBpbnN0cnVjdGlvbi5jb250YWluZXIgfHwgdGhpcy5fY29udGFpbmVyLmNyZWF0ZUNoaWxkKCk7XG4gICAgdmFyIHZpZXcgPSBmYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZW5oYW5jZSgpKTtcblxuICAgIHZpZXcuYmluZChpbnN0cnVjdGlvbi5iaW5kaW5nQ29udGV4dCB8fCB7fSwgaW5zdHJ1Y3Rpb24ub3ZlcnJpZGVDb250ZXh0KTtcblxuICAgIHZpZXcuZmlyc3RDaGlsZCA9IHZpZXcubGFzdENoaWxkID0gdmlldy5mcmFnbWVudDtcbiAgICB2aWV3LmZyYWdtZW50ID0gRE9NLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB2aWV3LmF0dGFjaGVkKCk7XG5cbiAgICByZXR1cm4gdmlldztcbiAgfTtcblxuICByZXR1cm4gVGVtcGxhdGluZ0VuZ2luZTtcbn0oKSkgfHwgX2NsYXNzMTcpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmcvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmcuanNcbi8vIG1vZHVsZSBpZCA9IDQ0XG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIlxuXG5leHBvcnQgdmFyIGxvZ0xldmVsID0ge1xuICBub25lOiAwLFxuICBlcnJvcjogMTAsXG4gIHdhcm46IDIwLFxuICBpbmZvOiAzMCxcbiAgZGVidWc6IDQwXG59O1xuXG52YXIgbG9nZ2VycyA9IHt9O1xudmFyIGFwcGVuZGVycyA9IFtdO1xudmFyIGdsb2JhbERlZmF1bHRMZXZlbCA9IGxvZ0xldmVsLm5vbmU7XG5cbnZhciBzdGFuZGFyZExldmVscyA9IFsnbm9uZScsICdlcnJvcicsICd3YXJuJywgJ2luZm8nLCAnZGVidWcnXTtcbmZ1bmN0aW9uIGlzU3RhbmRhcmRMZXZlbChsZXZlbCkge1xuICByZXR1cm4gc3RhbmRhcmRMZXZlbHMuZmlsdGVyKGZ1bmN0aW9uIChsKSB7XG4gICAgcmV0dXJuIGwgPT09IGxldmVsO1xuICB9KS5sZW5ndGggPiAwO1xufVxuXG5mdW5jdGlvbiBhcHBlbmRBcmdzKCkge1xuICByZXR1cm4gW3RoaXNdLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTtcbn1cblxuZnVuY3Rpb24gbG9nRmFjdG9yeShsZXZlbCkge1xuICB2YXIgdGhyZXNob2xkID0gbG9nTGV2ZWxbbGV2ZWxdO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmxldmVsIDwgdGhyZXNob2xkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGFyZ3MgPSBhcHBlbmRBcmdzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgdmFyIGkgPSBhcHBlbmRlcnMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIHZhciBfYXBwZW5kZXJzJGk7XG5cbiAgICAgIChfYXBwZW5kZXJzJGkgPSBhcHBlbmRlcnNbaV0pW2xldmVsXS5hcHBseShfYXBwZW5kZXJzJGksIGFyZ3MpO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gbG9nRmFjdG9yeUN1c3RvbShsZXZlbCkge1xuICB2YXIgdGhyZXNob2xkID0gbG9nTGV2ZWxbbGV2ZWxdO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmxldmVsIDwgdGhyZXNob2xkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGFyZ3MgPSBhcHBlbmRBcmdzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgdmFyIGkgPSBhcHBlbmRlcnMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIHZhciBhcHBlbmRlciA9IGFwcGVuZGVyc1tpXTtcbiAgICAgIGlmIChhcHBlbmRlcltsZXZlbF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhcHBlbmRlcltsZXZlbF0uYXBwbHkoYXBwZW5kZXIsIGFyZ3MpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gY29ubmVjdExvZ2dlcnMoKSB7XG4gIHZhciBwcm90byA9IExvZ2dlci5wcm90b3R5cGU7XG4gIGZvciAodmFyIF9sZXZlbCBpbiBsb2dMZXZlbCkge1xuICAgIGlmIChpc1N0YW5kYXJkTGV2ZWwoX2xldmVsKSkge1xuICAgICAgaWYgKF9sZXZlbCAhPT0gJ25vbmUnKSB7XG4gICAgICAgIHByb3RvW19sZXZlbF0gPSBsb2dGYWN0b3J5KF9sZXZlbCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb3RvW19sZXZlbF0gPSBsb2dGYWN0b3J5Q3VzdG9tKF9sZXZlbCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGRpc2Nvbm5lY3RMb2dnZXJzKCkge1xuICB2YXIgcHJvdG8gPSBMb2dnZXIucHJvdG90eXBlO1xuICBmb3IgKHZhciBfbGV2ZWwyIGluIGxvZ0xldmVsKSB7XG4gICAgaWYgKF9sZXZlbDIgIT09ICdub25lJykge1xuICAgICAgcHJvdG9bX2xldmVsMl0gPSBmdW5jdGlvbiAoKSB7fTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExvZ2dlcihpZCkge1xuICByZXR1cm4gbG9nZ2Vyc1tpZF0gfHwgbmV3IExvZ2dlcihpZCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRBcHBlbmRlcihhcHBlbmRlcikge1xuICBpZiAoYXBwZW5kZXJzLnB1c2goYXBwZW5kZXIpID09PSAxKSB7XG4gICAgY29ubmVjdExvZ2dlcnMoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQXBwZW5kZXIoYXBwZW5kZXIpIHtcbiAgYXBwZW5kZXJzID0gYXBwZW5kZXJzLmZpbHRlcihmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybiBhICE9PSBhcHBlbmRlcjtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHBlbmRlcnMoKSB7XG4gIHJldHVybiBbXS5jb25jYXQoYXBwZW5kZXJzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyQXBwZW5kZXJzKCkge1xuICBhcHBlbmRlcnMgPSBbXTtcbiAgZGlzY29ubmVjdExvZ2dlcnMoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZEN1c3RvbUxldmVsKG5hbWUsIHZhbHVlKSB7XG4gIGlmIChsb2dMZXZlbFtuYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgRXJyb3IoJ0xvZyBsZXZlbCBcIicgKyBuYW1lICsgJ1wiIGFscmVhZHkgZXhpc3RzLicpO1xuICB9XG5cbiAgaWYgKGlzTmFOKHZhbHVlKSkge1xuICAgIHRocm93IEVycm9yKCdWYWx1ZSBtdXN0IGJlIGEgbnVtYmVyLicpO1xuICB9XG5cbiAgbG9nTGV2ZWxbbmFtZV0gPSB2YWx1ZTtcblxuICBpZiAoYXBwZW5kZXJzLmxlbmd0aCA+IDApIHtcbiAgICBjb25uZWN0TG9nZ2VycygpO1xuICB9IGVsc2Uge1xuICAgIExvZ2dlci5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbiAoKSB7fTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQ3VzdG9tTGV2ZWwobmFtZSkge1xuICBpZiAobG9nTGV2ZWxbbmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpc1N0YW5kYXJkTGV2ZWwobmFtZSkpIHtcbiAgICB0aHJvdyBFcnJvcignQnVpbHQtaW4gbG9nIGxldmVsIFwiJyArIG5hbWUgKyAnXCIgY2Fubm90IGJlIHJlbW92ZWQuJyk7XG4gIH1cblxuICBkZWxldGUgbG9nTGV2ZWxbbmFtZV07XG4gIGRlbGV0ZSBMb2dnZXIucHJvdG90eXBlW25hbWVdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0TGV2ZWwobGV2ZWwpIHtcbiAgZ2xvYmFsRGVmYXVsdExldmVsID0gbGV2ZWw7XG4gIGZvciAodmFyIGtleSBpbiBsb2dnZXJzKSB7XG4gICAgbG9nZ2Vyc1trZXldLnNldExldmVsKGxldmVsKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGV2ZWwoKSB7XG4gIHJldHVybiBnbG9iYWxEZWZhdWx0TGV2ZWw7XG59XG5cbmV4cG9ydCB2YXIgTG9nZ2VyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBMb2dnZXIoaWQpIHtcbiAgICBcblxuICAgIHZhciBjYWNoZWQgPSBsb2dnZXJzW2lkXTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIGxvZ2dlcnNbaWRdID0gdGhpcztcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5sZXZlbCA9IGdsb2JhbERlZmF1bHRMZXZlbDtcbiAgfVxuXG4gIExvZ2dlci5wcm90b3R5cGUuZGVidWcgPSBmdW5jdGlvbiBkZWJ1ZyhtZXNzYWdlKSB7fTtcblxuICBMb2dnZXIucHJvdG90eXBlLmluZm8gPSBmdW5jdGlvbiBpbmZvKG1lc3NhZ2UpIHt9O1xuXG4gIExvZ2dlci5wcm90b3R5cGUud2FybiA9IGZ1bmN0aW9uIHdhcm4obWVzc2FnZSkge307XG5cbiAgTG9nZ2VyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHt9O1xuXG4gIExvZ2dlci5wcm90b3R5cGUuc2V0TGV2ZWwgPSBmdW5jdGlvbiBzZXRMZXZlbChsZXZlbCkge1xuICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgfTtcblxuICBMb2dnZXIucHJvdG90eXBlLmlzRGVidWdFbmFibGVkID0gZnVuY3Rpb24gaXNEZWJ1Z0VuYWJsZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMubGV2ZWwgPT09IGxvZ0xldmVsLmRlYnVnO1xuICB9O1xuXG4gIHJldHVybiBMb2dnZXI7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtbG9nZ2luZy9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtbG9nZ2luZy5qc1xuLy8gbW9kdWxlIGlkID0gNzBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiZXhwb3J0IHsgX2dldEFycmF5T2JzZXJ2ZXIgYXMgZ2V0QXJyYXlPYnNlcnZlciB9O1xuZXhwb3J0IHsgX2dldE1hcE9ic2VydmVyIGFzIGdldE1hcE9ic2VydmVyIH07XG5leHBvcnQgeyBfZ2V0U2V0T2JzZXJ2ZXIgYXMgZ2V0U2V0T2JzZXJ2ZXIgfTtcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG52YXIgX2RlYywgX2RlYzIsIF9jbGFzcywgX2RlYzMsIF9jbGFzczIsIF9kZWM0LCBfY2xhc3MzLCBfZGVjNSwgX2NsYXNzNSwgX2RlYzYsIF9jbGFzczcsIF9kZWM3LCBfY2xhc3M4LCBfZGVjOCwgX2NsYXNzOSwgX2RlYzksIF9jbGFzczEwLCBfY2xhc3MxMiwgX3RlbXAsIF9kZWMxMCwgX2NsYXNzMTMsIF9jbGFzczE0LCBfdGVtcDI7XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikgPyBjYWxsIDogc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxuXG5cbmltcG9ydCAqIGFzIExvZ01hbmFnZXIgZnJvbSAnYXVyZWxpYS1sb2dnaW5nJztcbmltcG9ydCB7IFBMQVRGT1JNLCBET00gfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5pbXBvcnQgeyBUYXNrUXVldWUgfSBmcm9tICdhdXJlbGlhLXRhc2stcXVldWUnO1xuaW1wb3J0IHsgbWV0YWRhdGEgfSBmcm9tICdhdXJlbGlhLW1ldGFkYXRhJztcblxuZXhwb3J0IHZhciB0YXJnZXRDb250ZXh0ID0gJ0JpbmRpbmc6dGFyZ2V0JztcbmV4cG9ydCB2YXIgc291cmNlQ29udGV4dCA9ICdCaW5kaW5nOnNvdXJjZSc7XG5cbnZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG5leHBvcnQgZnVuY3Rpb24gY2FtZWxDYXNlKG5hbWUpIHtcbiAgaWYgKG5hbWUgaW4gbWFwKSB7XG4gICAgcmV0dXJuIG1hcFtuYW1lXTtcbiAgfVxuICB2YXIgcmVzdWx0ID0gbmFtZS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIG5hbWUuc2xpY2UoMSkucmVwbGFjZSgvW18uLV0oXFx3fCQpL2csIGZ1bmN0aW9uIChfLCB4KSB7XG4gICAgcmV0dXJuIHgudG9VcHBlckNhc2UoKTtcbiAgfSk7XG4gIG1hcFtuYW1lXSA9IHJlc3VsdDtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU92ZXJyaWRlQ29udGV4dChiaW5kaW5nQ29udGV4dCwgcGFyZW50T3ZlcnJpZGVDb250ZXh0KSB7XG4gIHJldHVybiB7XG4gICAgYmluZGluZ0NvbnRleHQ6IGJpbmRpbmdDb250ZXh0LFxuICAgIHBhcmVudE92ZXJyaWRlQ29udGV4dDogcGFyZW50T3ZlcnJpZGVDb250ZXh0IHx8IG51bGxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbnRleHRGb3IobmFtZSwgc2NvcGUsIGFuY2VzdG9yKSB7XG4gIHZhciBvYyA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcblxuICBpZiAoYW5jZXN0b3IpIHtcbiAgICB3aGlsZSAoYW5jZXN0b3IgJiYgb2MpIHtcbiAgICAgIGFuY2VzdG9yLS07XG4gICAgICBvYyA9IG9jLnBhcmVudE92ZXJyaWRlQ29udGV4dDtcbiAgICB9XG4gICAgaWYgKGFuY2VzdG9yIHx8ICFvYykge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIG5hbWUgaW4gb2MgPyBvYyA6IG9jLmJpbmRpbmdDb250ZXh0O1xuICB9XG5cbiAgd2hpbGUgKG9jICYmICEobmFtZSBpbiBvYykgJiYgIShvYy5iaW5kaW5nQ29udGV4dCAmJiBuYW1lIGluIG9jLmJpbmRpbmdDb250ZXh0KSkge1xuICAgIG9jID0gb2MucGFyZW50T3ZlcnJpZGVDb250ZXh0O1xuICB9XG4gIGlmIChvYykge1xuICAgIHJldHVybiBuYW1lIGluIG9jID8gb2MgOiBvYy5iaW5kaW5nQ29udGV4dDtcbiAgfVxuXG4gIHJldHVybiBzY29wZS5iaW5kaW5nQ29udGV4dCB8fCBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTY29wZUZvclRlc3QoYmluZGluZ0NvbnRleHQsIHBhcmVudEJpbmRpbmdDb250ZXh0KSB7XG4gIGlmIChwYXJlbnRCaW5kaW5nQ29udGV4dCkge1xuICAgIHJldHVybiB7XG4gICAgICBiaW5kaW5nQ29udGV4dDogYmluZGluZ0NvbnRleHQsXG4gICAgICBvdmVycmlkZUNvbnRleHQ6IGNyZWF0ZU92ZXJyaWRlQ29udGV4dChiaW5kaW5nQ29udGV4dCwgY3JlYXRlT3ZlcnJpZGVDb250ZXh0KHBhcmVudEJpbmRpbmdDb250ZXh0KSlcbiAgICB9O1xuICB9XG4gIHJldHVybiB7XG4gICAgYmluZGluZ0NvbnRleHQ6IGJpbmRpbmdDb250ZXh0LFxuICAgIG92ZXJyaWRlQ29udGV4dDogY3JlYXRlT3ZlcnJpZGVDb250ZXh0KGJpbmRpbmdDb250ZXh0KVxuICB9O1xufVxuXG52YXIgc2xvdE5hbWVzID0gW107XG52YXIgdmVyc2lvblNsb3ROYW1lcyA9IFtdO1xudmFyIGxhc3RTbG90ID0gLTE7XG5mdW5jdGlvbiBlbnN1cmVFbm91Z2hTbG90TmFtZXMoY3VycmVudFNsb3QpIHtcbiAgaWYgKGN1cnJlbnRTbG90ID09PSBsYXN0U2xvdCkge1xuICAgIGxhc3RTbG90ICs9IDU7XG4gICAgdmFyIGlpID0gc2xvdE5hbWVzLmxlbmd0aCA9IHZlcnNpb25TbG90TmFtZXMubGVuZ3RoID0gbGFzdFNsb3QgKyAxO1xuICAgIGZvciAodmFyIGkgPSBjdXJyZW50U2xvdCArIDE7IGkgPCBpaTsgKytpKSB7XG4gICAgICBzbG90TmFtZXNbaV0gPSAnX29ic2VydmVyJyArIGk7XG4gICAgICB2ZXJzaW9uU2xvdE5hbWVzW2ldID0gJ19vYnNlcnZlclZlcnNpb24nICsgaTtcbiAgICB9XG4gIH1cbn1cbmVuc3VyZUVub3VnaFNsb3ROYW1lcygtMSk7XG5cbmZ1bmN0aW9uIGFkZE9ic2VydmVyKG9ic2VydmVyKSB7XG4gIHZhciBvYnNlcnZlclNsb3RzID0gdGhpcy5fb2JzZXJ2ZXJTbG90cyA9PT0gdW5kZWZpbmVkID8gMCA6IHRoaXMuX29ic2VydmVyU2xvdHM7XG4gIHZhciBpID0gb2JzZXJ2ZXJTbG90cztcbiAgd2hpbGUgKGktLSAmJiB0aGlzW3Nsb3ROYW1lc1tpXV0gIT09IG9ic2VydmVyKSB7fVxuXG4gIGlmIChpID09PSAtMSkge1xuICAgIGkgPSAwO1xuICAgIHdoaWxlICh0aGlzW3Nsb3ROYW1lc1tpXV0pIHtcbiAgICAgIGkrKztcbiAgICB9XG4gICAgdGhpc1tzbG90TmFtZXNbaV1dID0gb2JzZXJ2ZXI7XG4gICAgb2JzZXJ2ZXIuc3Vic2NyaWJlKHNvdXJjZUNvbnRleHQsIHRoaXMpO1xuXG4gICAgaWYgKGkgPT09IG9ic2VydmVyU2xvdHMpIHtcbiAgICAgIHRoaXMuX29ic2VydmVyU2xvdHMgPSBpICsgMTtcbiAgICB9XG4gIH1cblxuICBpZiAodGhpcy5fdmVyc2lvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fdmVyc2lvbiA9IDA7XG4gIH1cbiAgdGhpc1t2ZXJzaW9uU2xvdE5hbWVzW2ldXSA9IHRoaXMuX3ZlcnNpb247XG4gIGVuc3VyZUVub3VnaFNsb3ROYW1lcyhpKTtcbn1cblxuZnVuY3Rpb24gb2JzZXJ2ZVByb3BlcnR5KG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gIHZhciBvYnNlcnZlciA9IHRoaXMub2JzZXJ2ZXJMb2NhdG9yLmdldE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgYWRkT2JzZXJ2ZXIuY2FsbCh0aGlzLCBvYnNlcnZlcik7XG59XG5cbmZ1bmN0aW9uIG9ic2VydmVBcnJheShhcnJheSkge1xuICB2YXIgb2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKGFycmF5KTtcbiAgYWRkT2JzZXJ2ZXIuY2FsbCh0aGlzLCBvYnNlcnZlcik7XG59XG5cbmZ1bmN0aW9uIHVub2JzZXJ2ZShhbGwpIHtcbiAgdmFyIGkgPSB0aGlzLl9vYnNlcnZlclNsb3RzO1xuICB3aGlsZSAoaS0tKSB7XG4gICAgaWYgKGFsbCB8fCB0aGlzW3ZlcnNpb25TbG90TmFtZXNbaV1dICE9PSB0aGlzLl92ZXJzaW9uKSB7XG4gICAgICB2YXIgb2JzZXJ2ZXIgPSB0aGlzW3Nsb3ROYW1lc1tpXV07XG4gICAgICB0aGlzW3Nsb3ROYW1lc1tpXV0gPSBudWxsO1xuICAgICAgaWYgKG9ic2VydmVyKSB7XG4gICAgICAgIG9ic2VydmVyLnVuc3Vic2NyaWJlKHNvdXJjZUNvbnRleHQsIHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29ubmVjdGFibGUoKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5vYnNlcnZlUHJvcGVydHkgPSBvYnNlcnZlUHJvcGVydHk7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5vYnNlcnZlQXJyYXkgPSBvYnNlcnZlQXJyYXk7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS51bm9ic2VydmUgPSB1bm9ic2VydmU7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5hZGRPYnNlcnZlciA9IGFkZE9ic2VydmVyO1xuICB9O1xufVxuXG52YXIgcXVldWUgPSBbXTtcbnZhciBxdWV1ZWQgPSB7fTtcbnZhciBuZXh0SWQgPSAwO1xudmFyIG1pbmltdW1JbW1lZGlhdGUgPSAxMDA7XG52YXIgZnJhbWVCdWRnZXQgPSAxNTtcblxudmFyIGlzRmx1c2hSZXF1ZXN0ZWQgPSBmYWxzZTtcbnZhciBpbW1lZGlhdGUgPSAwO1xuXG5mdW5jdGlvbiBmbHVzaChhbmltYXRpb25GcmFtZVN0YXJ0KSB7XG4gIHZhciBsZW5ndGggPSBxdWV1ZS5sZW5ndGg7XG4gIHZhciBpID0gMDtcbiAgd2hpbGUgKGkgPCBsZW5ndGgpIHtcbiAgICB2YXIgYmluZGluZyA9IHF1ZXVlW2ldO1xuICAgIHF1ZXVlZFtiaW5kaW5nLl9fY29ubmVjdFF1ZXVlSWRdID0gZmFsc2U7XG4gICAgYmluZGluZy5jb25uZWN0KHRydWUpO1xuICAgIGkrKztcblxuICAgIGlmIChpICUgMTAwID09PSAwICYmIFBMQVRGT1JNLnBlcmZvcm1hbmNlLm5vdygpIC0gYW5pbWF0aW9uRnJhbWVTdGFydCA+IGZyYW1lQnVkZ2V0KSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcXVldWUuc3BsaWNlKDAsIGkpO1xuXG4gIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICBQTEFURk9STS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZmx1c2gpO1xuICB9IGVsc2Uge1xuICAgIGlzRmx1c2hSZXF1ZXN0ZWQgPSBmYWxzZTtcbiAgICBpbW1lZGlhdGUgPSAwO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbnF1ZXVlQmluZGluZ0Nvbm5lY3QoYmluZGluZykge1xuICBpZiAoaW1tZWRpYXRlIDwgbWluaW11bUltbWVkaWF0ZSkge1xuICAgIGltbWVkaWF0ZSsrO1xuICAgIGJpbmRpbmcuY29ubmVjdChmYWxzZSk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGlkID0gYmluZGluZy5fX2Nvbm5lY3RRdWV1ZUlkO1xuICAgIGlmIChpZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZCA9IG5leHRJZDtcbiAgICAgIG5leHRJZCsrO1xuICAgICAgYmluZGluZy5fX2Nvbm5lY3RRdWV1ZUlkID0gaWQ7XG4gICAgfVxuXG4gICAgaWYgKCFxdWV1ZWRbaWRdKSB7XG4gICAgICBxdWV1ZS5wdXNoKGJpbmRpbmcpO1xuICAgICAgcXVldWVkW2lkXSA9IHRydWU7XG4gICAgfVxuICB9XG4gIGlmICghaXNGbHVzaFJlcXVlc3RlZCkge1xuICAgIGlzRmx1c2hSZXF1ZXN0ZWQgPSB0cnVlO1xuICAgIFBMQVRGT1JNLnJlcXVlc3RBbmltYXRpb25GcmFtZShmbHVzaCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldENvbm5lY3RRdWV1ZVRocmVzaG9sZCh2YWx1ZSkge1xuICBtaW5pbXVtSW1tZWRpYXRlID0gdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVDb25uZWN0UXVldWUoKSB7XG4gIHNldENvbm5lY3RRdWV1ZVRocmVzaG9sZCgxMDApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGlzYWJsZUNvbm5lY3RRdWV1ZSgpIHtcbiAgc2V0Q29ubmVjdFF1ZXVlVGhyZXNob2xkKE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbm5lY3RRdWV1ZVNpemUoKSB7XG4gIHJldHVybiBxdWV1ZS5sZW5ndGg7XG59XG5cbmZ1bmN0aW9uIGFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgaWYgKHRoaXMuaGFzU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKCF0aGlzLl9jb250ZXh0MCkge1xuICAgIHRoaXMuX2NvbnRleHQwID0gY29udGV4dDtcbiAgICB0aGlzLl9jYWxsYWJsZTAgPSBjYWxsYWJsZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIXRoaXMuX2NvbnRleHQxKSB7XG4gICAgdGhpcy5fY29udGV4dDEgPSBjb250ZXh0O1xuICAgIHRoaXMuX2NhbGxhYmxlMSA9IGNhbGxhYmxlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghdGhpcy5fY29udGV4dDIpIHtcbiAgICB0aGlzLl9jb250ZXh0MiA9IGNvbnRleHQ7XG4gICAgdGhpcy5fY2FsbGFibGUyID0gY2FsbGFibGU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKCF0aGlzLl9jb250ZXh0c1Jlc3QpIHtcbiAgICB0aGlzLl9jb250ZXh0c1Jlc3QgPSBbY29udGV4dF07XG4gICAgdGhpcy5fY2FsbGFibGVzUmVzdCA9IFtjYWxsYWJsZV07XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgdGhpcy5fY29udGV4dHNSZXN0LnB1c2goY29udGV4dCk7XG4gIHRoaXMuX2NhbGxhYmxlc1Jlc3QucHVzaChjYWxsYWJsZSk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiByZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gIGlmICh0aGlzLl9jb250ZXh0MCA9PT0gY29udGV4dCAmJiB0aGlzLl9jYWxsYWJsZTAgPT09IGNhbGxhYmxlKSB7XG4gICAgdGhpcy5fY29udGV4dDAgPSBudWxsO1xuICAgIHRoaXMuX2NhbGxhYmxlMCA9IG51bGw7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHRoaXMuX2NvbnRleHQxID09PSBjb250ZXh0ICYmIHRoaXMuX2NhbGxhYmxlMSA9PT0gY2FsbGFibGUpIHtcbiAgICB0aGlzLl9jb250ZXh0MSA9IG51bGw7XG4gICAgdGhpcy5fY2FsbGFibGUxID0gbnVsbDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAodGhpcy5fY29udGV4dDIgPT09IGNvbnRleHQgJiYgdGhpcy5fY2FsbGFibGUyID09PSBjYWxsYWJsZSkge1xuICAgIHRoaXMuX2NvbnRleHQyID0gbnVsbDtcbiAgICB0aGlzLl9jYWxsYWJsZTIgPSBudWxsO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHZhciBjYWxsYWJsZXMgPSB0aGlzLl9jYWxsYWJsZXNSZXN0O1xuICBpZiAoY2FsbGFibGVzID09PSB1bmRlZmluZWQgfHwgY2FsbGFibGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB2YXIgY29udGV4dHMgPSB0aGlzLl9jb250ZXh0c1Jlc3Q7XG4gIHZhciBpID0gMDtcbiAgd2hpbGUgKCEoY2FsbGFibGVzW2ldID09PSBjYWxsYWJsZSAmJiBjb250ZXh0c1tpXSA9PT0gY29udGV4dCkgJiYgY2FsbGFibGVzLmxlbmd0aCA+IGkpIHtcbiAgICBpKys7XG4gIH1cbiAgaWYgKGkgPj0gY2FsbGFibGVzLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb250ZXh0cy5zcGxpY2UoaSwgMSk7XG4gIGNhbGxhYmxlcy5zcGxpY2UoaSwgMSk7XG4gIHJldHVybiB0cnVlO1xufVxuXG52YXIgYXJyYXlQb29sMSA9IFtdO1xudmFyIGFycmF5UG9vbDIgPSBbXTtcbnZhciBwb29sVXRpbGl6YXRpb24gPSBbXTtcblxuZnVuY3Rpb24gY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICB2YXIgY29udGV4dDAgPSB0aGlzLl9jb250ZXh0MDtcbiAgdmFyIGNhbGxhYmxlMCA9IHRoaXMuX2NhbGxhYmxlMDtcbiAgdmFyIGNvbnRleHQxID0gdGhpcy5fY29udGV4dDE7XG4gIHZhciBjYWxsYWJsZTEgPSB0aGlzLl9jYWxsYWJsZTE7XG4gIHZhciBjb250ZXh0MiA9IHRoaXMuX2NvbnRleHQyO1xuICB2YXIgY2FsbGFibGUyID0gdGhpcy5fY2FsbGFibGUyO1xuICB2YXIgbGVuZ3RoID0gdGhpcy5fY29udGV4dHNSZXN0ID8gdGhpcy5fY29udGV4dHNSZXN0Lmxlbmd0aCA6IDA7XG4gIHZhciBjb250ZXh0c1Jlc3QgPSB2b2lkIDA7XG4gIHZhciBjYWxsYWJsZXNSZXN0ID0gdm9pZCAwO1xuICB2YXIgcG9vbEluZGV4ID0gdm9pZCAwO1xuICB2YXIgaSA9IHZvaWQgMDtcbiAgaWYgKGxlbmd0aCkge1xuICAgIHBvb2xJbmRleCA9IHBvb2xVdGlsaXphdGlvbi5sZW5ndGg7XG4gICAgd2hpbGUgKHBvb2xJbmRleC0tICYmIHBvb2xVdGlsaXphdGlvbltwb29sSW5kZXhdKSB7fVxuICAgIGlmIChwb29sSW5kZXggPCAwKSB7XG4gICAgICBwb29sSW5kZXggPSBwb29sVXRpbGl6YXRpb24ubGVuZ3RoO1xuICAgICAgY29udGV4dHNSZXN0ID0gW107XG4gICAgICBjYWxsYWJsZXNSZXN0ID0gW107XG4gICAgICBwb29sVXRpbGl6YXRpb24ucHVzaCh0cnVlKTtcbiAgICAgIGFycmF5UG9vbDEucHVzaChjb250ZXh0c1Jlc3QpO1xuICAgICAgYXJyYXlQb29sMi5wdXNoKGNhbGxhYmxlc1Jlc3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb29sVXRpbGl6YXRpb25bcG9vbEluZGV4XSA9IHRydWU7XG4gICAgICBjb250ZXh0c1Jlc3QgPSBhcnJheVBvb2wxW3Bvb2xJbmRleF07XG4gICAgICBjYWxsYWJsZXNSZXN0ID0gYXJyYXlQb29sMltwb29sSW5kZXhdO1xuICAgIH1cblxuICAgIGkgPSBsZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgY29udGV4dHNSZXN0W2ldID0gdGhpcy5fY29udGV4dHNSZXN0W2ldO1xuICAgICAgY2FsbGFibGVzUmVzdFtpXSA9IHRoaXMuX2NhbGxhYmxlc1Jlc3RbaV07XG4gICAgfVxuICB9XG5cbiAgaWYgKGNvbnRleHQwKSB7XG4gICAgaWYgKGNhbGxhYmxlMCkge1xuICAgICAgY2FsbGFibGUwLmNhbGwoY29udGV4dDAsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRleHQwKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfVxuICB9XG4gIGlmIChjb250ZXh0MSkge1xuICAgIGlmIChjYWxsYWJsZTEpIHtcbiAgICAgIGNhbGxhYmxlMS5jYWxsKGNvbnRleHQxLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0MShuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH1cbiAgfVxuICBpZiAoY29udGV4dDIpIHtcbiAgICBpZiAoY2FsbGFibGUyKSB7XG4gICAgICBjYWxsYWJsZTIuY2FsbChjb250ZXh0MiwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGV4dDIobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9XG4gIH1cbiAgaWYgKGxlbmd0aCkge1xuICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGNhbGxhYmxlID0gY2FsbGFibGVzUmVzdFtpXTtcbiAgICAgIHZhciBjb250ZXh0ID0gY29udGV4dHNSZXN0W2ldO1xuICAgICAgaWYgKGNhbGxhYmxlKSB7XG4gICAgICAgIGNhbGxhYmxlLmNhbGwoY29udGV4dCwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRleHQobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGNvbnRleHRzUmVzdFtpXSA9IG51bGw7XG4gICAgICBjYWxsYWJsZXNSZXN0W2ldID0gbnVsbDtcbiAgICB9XG4gICAgcG9vbFV0aWxpemF0aW9uW3Bvb2xJbmRleF0gPSBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYXNTdWJzY3JpYmVycygpIHtcbiAgcmV0dXJuICEhKHRoaXMuX2NvbnRleHQwIHx8IHRoaXMuX2NvbnRleHQxIHx8IHRoaXMuX2NvbnRleHQyIHx8IHRoaXMuX2NvbnRleHRzUmVzdCAmJiB0aGlzLl9jb250ZXh0c1Jlc3QubGVuZ3RoKTtcbn1cblxuZnVuY3Rpb24gaGFzU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkge1xuICB2YXIgaGFzID0gdGhpcy5fY29udGV4dDAgPT09IGNvbnRleHQgJiYgdGhpcy5fY2FsbGFibGUwID09PSBjYWxsYWJsZSB8fCB0aGlzLl9jb250ZXh0MSA9PT0gY29udGV4dCAmJiB0aGlzLl9jYWxsYWJsZTEgPT09IGNhbGxhYmxlIHx8IHRoaXMuX2NvbnRleHQyID09PSBjb250ZXh0ICYmIHRoaXMuX2NhbGxhYmxlMiA9PT0gY2FsbGFibGU7XG4gIGlmIChoYXMpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICB2YXIgaW5kZXggPSB2b2lkIDA7XG4gIHZhciBjb250ZXh0cyA9IHRoaXMuX2NvbnRleHRzUmVzdDtcbiAgaWYgKCFjb250ZXh0cyB8fCAoaW5kZXggPSBjb250ZXh0cy5sZW5ndGgpID09PSAwKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHZhciBjYWxsYWJsZXMgPSB0aGlzLl9jYWxsYWJsZXNSZXN0O1xuICB3aGlsZSAoaW5kZXgtLSkge1xuICAgIGlmIChjb250ZXh0c1tpbmRleF0gPT09IGNvbnRleHQgJiYgY2FsbGFibGVzW2luZGV4XSA9PT0gY2FsbGFibGUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdWJzY3JpYmVyQ29sbGVjdGlvbigpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICB0YXJnZXQucHJvdG90eXBlLmFkZFN1YnNjcmliZXIgPSBhZGRTdWJzY3JpYmVyO1xuICAgIHRhcmdldC5wcm90b3R5cGUucmVtb3ZlU3Vic2NyaWJlciA9IHJlbW92ZVN1YnNjcmliZXI7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5jYWxsU3Vic2NyaWJlcnMgPSBjYWxsU3Vic2NyaWJlcnM7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5oYXNTdWJzY3JpYmVycyA9IGhhc1N1YnNjcmliZXJzO1xuICAgIHRhcmdldC5wcm90b3R5cGUuaGFzU3Vic2NyaWJlciA9IGhhc1N1YnNjcmliZXI7XG4gIH07XG59XG5cbmV4cG9ydCB2YXIgRXhwcmVzc2lvbk9ic2VydmVyID0gKF9kZWMgPSBjb25uZWN0YWJsZSgpLCBfZGVjMiA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWMoX2NsYXNzID0gX2RlYzIoX2NsYXNzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFeHByZXNzaW9uT2JzZXJ2ZXIoc2NvcGUsIGV4cHJlc3Npb24sIG9ic2VydmVyTG9jYXRvciwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLnNjb3BlID0gc2NvcGU7XG4gICAgdGhpcy5leHByZXNzaW9uID0gZXhwcmVzc2lvbjtcbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIEV4cHJlc3Npb25PYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBFeHByZXNzaW9uT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB0aGlzLmV4cHJlc3Npb24uYXNzaWduKHRoaXMuc2NvcGUsIG5ld1ZhbHVlKTtcbiAgfTtcblxuICBFeHByZXNzaW9uT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMuZXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNjb3BlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICB0aGlzLmV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNjb3BlKTtcbiAgICB9XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBjb250ZXh0IGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgICAgICAgX3RoaXMudW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfTtcblxuICBFeHByZXNzaW9uT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAodGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSAmJiAhdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLnVub2JzZXJ2ZSh0cnVlKTtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9O1xuXG4gIEV4cHJlc3Npb25PYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xuICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfVxuICAgIHRoaXMuX3ZlcnNpb24rKztcbiAgICB0aGlzLmV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNjb3BlKTtcbiAgICB0aGlzLnVub2JzZXJ2ZShmYWxzZSk7XG4gIH07XG5cbiAgcmV0dXJuIEV4cHJlc3Npb25PYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzKSB8fCBfY2xhc3MpO1xuXG5mdW5jdGlvbiBpc0luZGV4KHMpIHtcbiAgcmV0dXJuICtzID09PSBzID4+PiAwO1xufVxuXG5mdW5jdGlvbiB0b051bWJlcihzKSB7XG4gIHJldHVybiArcztcbn1cblxuZnVuY3Rpb24gbmV3U3BsaWNlKGluZGV4LCByZW1vdmVkLCBhZGRlZENvdW50KSB7XG4gIHJldHVybiB7XG4gICAgaW5kZXg6IGluZGV4LFxuICAgIHJlbW92ZWQ6IHJlbW92ZWQsXG4gICAgYWRkZWRDb3VudDogYWRkZWRDb3VudFxuICB9O1xufVxuXG52YXIgRURJVF9MRUFWRSA9IDA7XG52YXIgRURJVF9VUERBVEUgPSAxO1xudmFyIEVESVRfQUREID0gMjtcbnZhciBFRElUX0RFTEVURSA9IDM7XG5cbmZ1bmN0aW9uIEFycmF5U3BsaWNlKCkge31cblxuQXJyYXlTcGxpY2UucHJvdG90eXBlID0ge1xuICBjYWxjRWRpdERpc3RhbmNlczogZnVuY3Rpb24gY2FsY0VkaXREaXN0YW5jZXMoY3VycmVudCwgY3VycmVudFN0YXJ0LCBjdXJyZW50RW5kLCBvbGQsIG9sZFN0YXJ0LCBvbGRFbmQpIHtcbiAgICB2YXIgcm93Q291bnQgPSBvbGRFbmQgLSBvbGRTdGFydCArIDE7XG4gICAgdmFyIGNvbHVtbkNvdW50ID0gY3VycmVudEVuZCAtIGN1cnJlbnRTdGFydCArIDE7XG4gICAgdmFyIGRpc3RhbmNlcyA9IG5ldyBBcnJheShyb3dDb3VudCk7XG4gICAgdmFyIG5vcnRoID0gdm9pZCAwO1xuICAgIHZhciB3ZXN0ID0gdm9pZCAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3dDb3VudDsgKytpKSB7XG4gICAgICBkaXN0YW5jZXNbaV0gPSBuZXcgQXJyYXkoY29sdW1uQ291bnQpO1xuICAgICAgZGlzdGFuY2VzW2ldWzBdID0gaTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvbHVtbkNvdW50OyArK2opIHtcbiAgICAgIGRpc3RhbmNlc1swXVtqXSA9IGo7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IHJvd0NvdW50OyArK19pKSB7XG4gICAgICBmb3IgKHZhciBfaiA9IDE7IF9qIDwgY29sdW1uQ291bnQ7ICsrX2opIHtcbiAgICAgICAgaWYgKHRoaXMuZXF1YWxzKGN1cnJlbnRbY3VycmVudFN0YXJ0ICsgX2ogLSAxXSwgb2xkW29sZFN0YXJ0ICsgX2kgLSAxXSkpIHtcbiAgICAgICAgICBkaXN0YW5jZXNbX2ldW19qXSA9IGRpc3RhbmNlc1tfaSAtIDFdW19qIC0gMV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm9ydGggPSBkaXN0YW5jZXNbX2kgLSAxXVtfal0gKyAxO1xuICAgICAgICAgIHdlc3QgPSBkaXN0YW5jZXNbX2ldW19qIC0gMV0gKyAxO1xuICAgICAgICAgIGRpc3RhbmNlc1tfaV1bX2pdID0gbm9ydGggPCB3ZXN0ID8gbm9ydGggOiB3ZXN0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRpc3RhbmNlcztcbiAgfSxcblxuICBzcGxpY2VPcGVyYXRpb25zRnJvbUVkaXREaXN0YW5jZXM6IGZ1bmN0aW9uIHNwbGljZU9wZXJhdGlvbnNGcm9tRWRpdERpc3RhbmNlcyhkaXN0YW5jZXMpIHtcbiAgICB2YXIgaSA9IGRpc3RhbmNlcy5sZW5ndGggLSAxO1xuICAgIHZhciBqID0gZGlzdGFuY2VzWzBdLmxlbmd0aCAtIDE7XG4gICAgdmFyIGN1cnJlbnQgPSBkaXN0YW5jZXNbaV1bal07XG4gICAgdmFyIGVkaXRzID0gW107XG4gICAgd2hpbGUgKGkgPiAwIHx8IGogPiAwKSB7XG4gICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICBlZGl0cy5wdXNoKEVESVRfQUREKTtcbiAgICAgICAgai0tO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChqID09PSAwKSB7XG4gICAgICAgIGVkaXRzLnB1c2goRURJVF9ERUxFVEUpO1xuICAgICAgICBpLS07XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdmFyIG5vcnRoV2VzdCA9IGRpc3RhbmNlc1tpIC0gMV1baiAtIDFdO1xuICAgICAgdmFyIHdlc3QgPSBkaXN0YW5jZXNbaSAtIDFdW2pdO1xuICAgICAgdmFyIG5vcnRoID0gZGlzdGFuY2VzW2ldW2ogLSAxXTtcblxuICAgICAgdmFyIG1pbiA9IHZvaWQgMDtcbiAgICAgIGlmICh3ZXN0IDwgbm9ydGgpIHtcbiAgICAgICAgbWluID0gd2VzdCA8IG5vcnRoV2VzdCA/IHdlc3QgOiBub3J0aFdlc3Q7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtaW4gPSBub3J0aCA8IG5vcnRoV2VzdCA/IG5vcnRoIDogbm9ydGhXZXN0O1xuICAgICAgfVxuXG4gICAgICBpZiAobWluID09PSBub3J0aFdlc3QpIHtcbiAgICAgICAgaWYgKG5vcnRoV2VzdCA9PT0gY3VycmVudCkge1xuICAgICAgICAgIGVkaXRzLnB1c2goRURJVF9MRUFWRSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWRpdHMucHVzaChFRElUX1VQREFURSk7XG4gICAgICAgICAgY3VycmVudCA9IG5vcnRoV2VzdDtcbiAgICAgICAgfVxuICAgICAgICBpLS07XG4gICAgICAgIGotLTtcbiAgICAgIH0gZWxzZSBpZiAobWluID09PSB3ZXN0KSB7XG4gICAgICAgIGVkaXRzLnB1c2goRURJVF9ERUxFVEUpO1xuICAgICAgICBpLS07XG4gICAgICAgIGN1cnJlbnQgPSB3ZXN0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWRpdHMucHVzaChFRElUX0FERCk7XG4gICAgICAgIGotLTtcbiAgICAgICAgY3VycmVudCA9IG5vcnRoO1xuICAgICAgfVxuICAgIH1cblxuICAgIGVkaXRzLnJldmVyc2UoKTtcbiAgICByZXR1cm4gZWRpdHM7XG4gIH0sXG5cbiAgY2FsY1NwbGljZXM6IGZ1bmN0aW9uIGNhbGNTcGxpY2VzKGN1cnJlbnQsIGN1cnJlbnRTdGFydCwgY3VycmVudEVuZCwgb2xkLCBvbGRTdGFydCwgb2xkRW5kKSB7XG4gICAgdmFyIHByZWZpeENvdW50ID0gMDtcbiAgICB2YXIgc3VmZml4Q291bnQgPSAwO1xuXG4gICAgdmFyIG1pbkxlbmd0aCA9IE1hdGgubWluKGN1cnJlbnRFbmQgLSBjdXJyZW50U3RhcnQsIG9sZEVuZCAtIG9sZFN0YXJ0KTtcbiAgICBpZiAoY3VycmVudFN0YXJ0ID09PSAwICYmIG9sZFN0YXJ0ID09PSAwKSB7XG4gICAgICBwcmVmaXhDb3VudCA9IHRoaXMuc2hhcmVkUHJlZml4KGN1cnJlbnQsIG9sZCwgbWluTGVuZ3RoKTtcbiAgICB9XG5cbiAgICBpZiAoY3VycmVudEVuZCA9PT0gY3VycmVudC5sZW5ndGggJiYgb2xkRW5kID09PSBvbGQubGVuZ3RoKSB7XG4gICAgICBzdWZmaXhDb3VudCA9IHRoaXMuc2hhcmVkU3VmZml4KGN1cnJlbnQsIG9sZCwgbWluTGVuZ3RoIC0gcHJlZml4Q291bnQpO1xuICAgIH1cblxuICAgIGN1cnJlbnRTdGFydCArPSBwcmVmaXhDb3VudDtcbiAgICBvbGRTdGFydCArPSBwcmVmaXhDb3VudDtcbiAgICBjdXJyZW50RW5kIC09IHN1ZmZpeENvdW50O1xuICAgIG9sZEVuZCAtPSBzdWZmaXhDb3VudDtcblxuICAgIGlmIChjdXJyZW50RW5kIC0gY3VycmVudFN0YXJ0ID09PSAwICYmIG9sZEVuZCAtIG9sZFN0YXJ0ID09PSAwKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRTdGFydCA9PT0gY3VycmVudEVuZCkge1xuICAgICAgdmFyIF9zcGxpY2UgPSBuZXdTcGxpY2UoY3VycmVudFN0YXJ0LCBbXSwgMCk7XG4gICAgICB3aGlsZSAob2xkU3RhcnQgPCBvbGRFbmQpIHtcbiAgICAgICAgX3NwbGljZS5yZW1vdmVkLnB1c2gob2xkW29sZFN0YXJ0KytdKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFtfc3BsaWNlXTtcbiAgICB9IGVsc2UgaWYgKG9sZFN0YXJ0ID09PSBvbGRFbmQpIHtcbiAgICAgIHJldHVybiBbbmV3U3BsaWNlKGN1cnJlbnRTdGFydCwgW10sIGN1cnJlbnRFbmQgLSBjdXJyZW50U3RhcnQpXTtcbiAgICB9XG5cbiAgICB2YXIgb3BzID0gdGhpcy5zcGxpY2VPcGVyYXRpb25zRnJvbUVkaXREaXN0YW5jZXModGhpcy5jYWxjRWRpdERpc3RhbmNlcyhjdXJyZW50LCBjdXJyZW50U3RhcnQsIGN1cnJlbnRFbmQsIG9sZCwgb2xkU3RhcnQsIG9sZEVuZCkpO1xuXG4gICAgdmFyIHNwbGljZSA9IHVuZGVmaW5lZDtcbiAgICB2YXIgc3BsaWNlcyA9IFtdO1xuICAgIHZhciBpbmRleCA9IGN1cnJlbnRTdGFydDtcbiAgICB2YXIgb2xkSW5kZXggPSBvbGRTdGFydDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wcy5sZW5ndGg7ICsraSkge1xuICAgICAgc3dpdGNoIChvcHNbaV0pIHtcbiAgICAgICAgY2FzZSBFRElUX0xFQVZFOlxuICAgICAgICAgIGlmIChzcGxpY2UpIHtcbiAgICAgICAgICAgIHNwbGljZXMucHVzaChzcGxpY2UpO1xuICAgICAgICAgICAgc3BsaWNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgb2xkSW5kZXgrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBFRElUX1VQREFURTpcbiAgICAgICAgICBpZiAoIXNwbGljZSkge1xuICAgICAgICAgICAgc3BsaWNlID0gbmV3U3BsaWNlKGluZGV4LCBbXSwgMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3BsaWNlLmFkZGVkQ291bnQrKztcbiAgICAgICAgICBpbmRleCsrO1xuXG4gICAgICAgICAgc3BsaWNlLnJlbW92ZWQucHVzaChvbGRbb2xkSW5kZXhdKTtcbiAgICAgICAgICBvbGRJbmRleCsrO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEVESVRfQUREOlxuICAgICAgICAgIGlmICghc3BsaWNlKSB7XG4gICAgICAgICAgICBzcGxpY2UgPSBuZXdTcGxpY2UoaW5kZXgsIFtdLCAwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzcGxpY2UuYWRkZWRDb3VudCsrO1xuICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRURJVF9ERUxFVEU6XG4gICAgICAgICAgaWYgKCFzcGxpY2UpIHtcbiAgICAgICAgICAgIHNwbGljZSA9IG5ld1NwbGljZShpbmRleCwgW10sIDApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNwbGljZS5yZW1vdmVkLnB1c2gob2xkW29sZEluZGV4XSk7XG4gICAgICAgICAgb2xkSW5kZXgrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3BsaWNlKSB7XG4gICAgICBzcGxpY2VzLnB1c2goc3BsaWNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHNwbGljZXM7XG4gIH0sXG5cbiAgc2hhcmVkUHJlZml4OiBmdW5jdGlvbiBzaGFyZWRQcmVmaXgoY3VycmVudCwgb2xkLCBzZWFyY2hMZW5ndGgpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlYXJjaExlbmd0aDsgKytpKSB7XG4gICAgICBpZiAoIXRoaXMuZXF1YWxzKGN1cnJlbnRbaV0sIG9sZFtpXSkpIHtcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlYXJjaExlbmd0aDtcbiAgfSxcblxuICBzaGFyZWRTdWZmaXg6IGZ1bmN0aW9uIHNoYXJlZFN1ZmZpeChjdXJyZW50LCBvbGQsIHNlYXJjaExlbmd0aCkge1xuICAgIHZhciBpbmRleDEgPSBjdXJyZW50Lmxlbmd0aDtcbiAgICB2YXIgaW5kZXgyID0gb2xkLmxlbmd0aDtcbiAgICB2YXIgY291bnQgPSAwO1xuICAgIHdoaWxlIChjb3VudCA8IHNlYXJjaExlbmd0aCAmJiB0aGlzLmVxdWFscyhjdXJyZW50Wy0taW5kZXgxXSwgb2xkWy0taW5kZXgyXSkpIHtcbiAgICAgIGNvdW50Kys7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvdW50O1xuICB9LFxuXG4gIGNhbGN1bGF0ZVNwbGljZXM6IGZ1bmN0aW9uIGNhbGN1bGF0ZVNwbGljZXMoY3VycmVudCwgcHJldmlvdXMpIHtcbiAgICByZXR1cm4gdGhpcy5jYWxjU3BsaWNlcyhjdXJyZW50LCAwLCBjdXJyZW50Lmxlbmd0aCwgcHJldmlvdXMsIDAsIHByZXZpb3VzLmxlbmd0aCk7XG4gIH0sXG5cbiAgZXF1YWxzOiBmdW5jdGlvbiBlcXVhbHMoY3VycmVudFZhbHVlLCBwcmV2aW91c1ZhbHVlKSB7XG4gICAgcmV0dXJuIGN1cnJlbnRWYWx1ZSA9PT0gcHJldmlvdXNWYWx1ZTtcbiAgfVxufTtcblxudmFyIGFycmF5U3BsaWNlID0gbmV3IEFycmF5U3BsaWNlKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjU3BsaWNlcyhjdXJyZW50LCBjdXJyZW50U3RhcnQsIGN1cnJlbnRFbmQsIG9sZCwgb2xkU3RhcnQsIG9sZEVuZCkge1xuICByZXR1cm4gYXJyYXlTcGxpY2UuY2FsY1NwbGljZXMoY3VycmVudCwgY3VycmVudFN0YXJ0LCBjdXJyZW50RW5kLCBvbGQsIG9sZFN0YXJ0LCBvbGRFbmQpO1xufVxuXG5mdW5jdGlvbiBpbnRlcnNlY3Qoc3RhcnQxLCBlbmQxLCBzdGFydDIsIGVuZDIpIHtcbiAgaWYgKGVuZDEgPCBzdGFydDIgfHwgZW5kMiA8IHN0YXJ0MSkge1xuICAgIHJldHVybiAtMTtcbiAgfVxuXG4gIGlmIChlbmQxID09PSBzdGFydDIgfHwgZW5kMiA9PT0gc3RhcnQxKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBpZiAoc3RhcnQxIDwgc3RhcnQyKSB7XG4gICAgaWYgKGVuZDEgPCBlbmQyKSB7XG4gICAgICByZXR1cm4gZW5kMSAtIHN0YXJ0MjtcbiAgICB9XG5cbiAgICByZXR1cm4gZW5kMiAtIHN0YXJ0MjtcbiAgfVxuXG4gIGlmIChlbmQyIDwgZW5kMSkge1xuICAgIHJldHVybiBlbmQyIC0gc3RhcnQxO1xuICB9XG5cbiAgcmV0dXJuIGVuZDEgLSBzdGFydDE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZVNwbGljZShzcGxpY2VzLCBpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCkge1xuICB2YXIgc3BsaWNlID0gbmV3U3BsaWNlKGluZGV4LCByZW1vdmVkLCBhZGRlZENvdW50KTtcblxuICB2YXIgaW5zZXJ0ZWQgPSBmYWxzZTtcbiAgdmFyIGluc2VydGlvbk9mZnNldCA9IDA7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGxpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGN1cnJlbnQgPSBzcGxpY2VzW2ldO1xuICAgIGN1cnJlbnQuaW5kZXggKz0gaW5zZXJ0aW9uT2Zmc2V0O1xuXG4gICAgaWYgKGluc2VydGVkKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICB2YXIgaW50ZXJzZWN0Q291bnQgPSBpbnRlcnNlY3Qoc3BsaWNlLmluZGV4LCBzcGxpY2UuaW5kZXggKyBzcGxpY2UucmVtb3ZlZC5sZW5ndGgsIGN1cnJlbnQuaW5kZXgsIGN1cnJlbnQuaW5kZXggKyBjdXJyZW50LmFkZGVkQ291bnQpO1xuXG4gICAgaWYgKGludGVyc2VjdENvdW50ID49IDApIHtcblxuICAgICAgc3BsaWNlcy5zcGxpY2UoaSwgMSk7XG4gICAgICBpLS07XG5cbiAgICAgIGluc2VydGlvbk9mZnNldCAtPSBjdXJyZW50LmFkZGVkQ291bnQgLSBjdXJyZW50LnJlbW92ZWQubGVuZ3RoO1xuXG4gICAgICBzcGxpY2UuYWRkZWRDb3VudCArPSBjdXJyZW50LmFkZGVkQ291bnQgLSBpbnRlcnNlY3RDb3VudDtcbiAgICAgIHZhciBkZWxldGVDb3VudCA9IHNwbGljZS5yZW1vdmVkLmxlbmd0aCArIGN1cnJlbnQucmVtb3ZlZC5sZW5ndGggLSBpbnRlcnNlY3RDb3VudDtcblxuICAgICAgaWYgKCFzcGxpY2UuYWRkZWRDb3VudCAmJiAhZGVsZXRlQ291bnQpIHtcbiAgICAgICAgaW5zZXJ0ZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGN1cnJlbnRSZW1vdmVkID0gY3VycmVudC5yZW1vdmVkO1xuXG4gICAgICAgIGlmIChzcGxpY2UuaW5kZXggPCBjdXJyZW50LmluZGV4KSB7XG4gICAgICAgICAgdmFyIHByZXBlbmQgPSBzcGxpY2UucmVtb3ZlZC5zbGljZSgwLCBjdXJyZW50LmluZGV4IC0gc3BsaWNlLmluZGV4KTtcbiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShwcmVwZW5kLCBjdXJyZW50UmVtb3ZlZCk7XG4gICAgICAgICAgY3VycmVudFJlbW92ZWQgPSBwcmVwZW5kO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNwbGljZS5pbmRleCArIHNwbGljZS5yZW1vdmVkLmxlbmd0aCA+IGN1cnJlbnQuaW5kZXggKyBjdXJyZW50LmFkZGVkQ291bnQpIHtcbiAgICAgICAgICB2YXIgYXBwZW5kID0gc3BsaWNlLnJlbW92ZWQuc2xpY2UoY3VycmVudC5pbmRleCArIGN1cnJlbnQuYWRkZWRDb3VudCAtIHNwbGljZS5pbmRleCk7XG4gICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoY3VycmVudFJlbW92ZWQsIGFwcGVuZCk7XG4gICAgICAgIH1cblxuICAgICAgICBzcGxpY2UucmVtb3ZlZCA9IGN1cnJlbnRSZW1vdmVkO1xuICAgICAgICBpZiAoY3VycmVudC5pbmRleCA8IHNwbGljZS5pbmRleCkge1xuICAgICAgICAgIHNwbGljZS5pbmRleCA9IGN1cnJlbnQuaW5kZXg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHNwbGljZS5pbmRleCA8IGN1cnJlbnQuaW5kZXgpIHtcblxuICAgICAgaW5zZXJ0ZWQgPSB0cnVlO1xuXG4gICAgICBzcGxpY2VzLnNwbGljZShpLCAwLCBzcGxpY2UpO1xuICAgICAgaSsrO1xuXG4gICAgICB2YXIgb2Zmc2V0ID0gc3BsaWNlLmFkZGVkQ291bnQgLSBzcGxpY2UucmVtb3ZlZC5sZW5ndGg7XG4gICAgICBjdXJyZW50LmluZGV4ICs9IG9mZnNldDtcbiAgICAgIGluc2VydGlvbk9mZnNldCArPSBvZmZzZXQ7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFpbnNlcnRlZCkge1xuICAgIHNwbGljZXMucHVzaChzcGxpY2UpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUluaXRpYWxTcGxpY2VzKGFycmF5LCBjaGFuZ2VSZWNvcmRzKSB7XG4gIHZhciBzcGxpY2VzID0gW107XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFuZ2VSZWNvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHJlY29yZCA9IGNoYW5nZVJlY29yZHNbaV07XG4gICAgc3dpdGNoIChyZWNvcmQudHlwZSkge1xuICAgICAgY2FzZSAnc3BsaWNlJzpcbiAgICAgICAgbWVyZ2VTcGxpY2Uoc3BsaWNlcywgcmVjb3JkLmluZGV4LCByZWNvcmQucmVtb3ZlZC5zbGljZSgpLCByZWNvcmQuYWRkZWRDb3VudCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYWRkJzpcbiAgICAgIGNhc2UgJ3VwZGF0ZSc6XG4gICAgICBjYXNlICdkZWxldGUnOlxuICAgICAgICBpZiAoIWlzSW5kZXgocmVjb3JkLm5hbWUpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaW5kZXggPSB0b051bWJlcihyZWNvcmQubmFtZSk7XG4gICAgICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1lcmdlU3BsaWNlKHNwbGljZXMsIGluZGV4LCBbcmVjb3JkLm9sZFZhbHVlXSwgcmVjb3JkLnR5cGUgPT09ICdkZWxldGUnID8gMCA6IDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VuZXhwZWN0ZWQgcmVjb3JkIHR5cGU6ICcgKyBKU09OLnN0cmluZ2lmeShyZWNvcmQpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHNwbGljZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9qZWN0QXJyYXlTcGxpY2VzKGFycmF5LCBjaGFuZ2VSZWNvcmRzKSB7XG4gIHZhciBzcGxpY2VzID0gW107XG5cbiAgY3JlYXRlSW5pdGlhbFNwbGljZXMoYXJyYXksIGNoYW5nZVJlY29yZHMpLmZvckVhY2goZnVuY3Rpb24gKHNwbGljZSkge1xuICAgIGlmIChzcGxpY2UuYWRkZWRDb3VudCA9PT0gMSAmJiBzcGxpY2UucmVtb3ZlZC5sZW5ndGggPT09IDEpIHtcbiAgICAgIGlmIChzcGxpY2UucmVtb3ZlZFswXSAhPT0gYXJyYXlbc3BsaWNlLmluZGV4XSkge1xuICAgICAgICBzcGxpY2VzLnB1c2goc3BsaWNlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNwbGljZXMgPSBzcGxpY2VzLmNvbmNhdChjYWxjU3BsaWNlcyhhcnJheSwgc3BsaWNlLmluZGV4LCBzcGxpY2UuaW5kZXggKyBzcGxpY2UuYWRkZWRDb3VudCwgc3BsaWNlLnJlbW92ZWQsIDAsIHNwbGljZS5yZW1vdmVkLmxlbmd0aCkpO1xuICB9KTtcblxuICByZXR1cm4gc3BsaWNlcztcbn1cblxuZnVuY3Rpb24gbmV3UmVjb3JkKHR5cGUsIG9iamVjdCwga2V5LCBvbGRWYWx1ZSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IHR5cGUsXG4gICAgb2JqZWN0OiBvYmplY3QsXG4gICAga2V5OiBrZXksXG4gICAgb2xkVmFsdWU6IG9sZFZhbHVlXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDaGFuZ2VSZWNvcmRzKG1hcCkge1xuICB2YXIgZW50cmllcyA9IG5ldyBBcnJheShtYXAuc2l6ZSk7XG4gIHZhciBrZXlzID0gbWFwLmtleXMoKTtcbiAgdmFyIGkgPSAwO1xuICB2YXIgaXRlbSA9IHZvaWQgMDtcblxuICB3aGlsZSAoaXRlbSA9IGtleXMubmV4dCgpKSB7XG4gICAgaWYgKGl0ZW0uZG9uZSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgZW50cmllc1tpXSA9IG5ld1JlY29yZCgnYWRkZWQnLCBtYXAsIGl0ZW0udmFsdWUpO1xuICAgIGkrKztcbiAgfVxuXG4gIHJldHVybiBlbnRyaWVzO1xufVxuXG5leHBvcnQgdmFyIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlciA9IChfZGVjMyA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWMzKF9jbGFzczIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcih0YXNrUXVldWUsIGNvbGxlY3Rpb24pIHtcbiAgICBcblxuICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG4gICAgdGhpcy5jaGFuZ2VSZWNvcmRzID0gbnVsbDtcbiAgICB0aGlzLm9sZENvbGxlY3Rpb24gPSBudWxsO1xuICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWUgPSBjb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwIHx8IGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBTZXQgPyAnc2l6ZScgOiAnbGVuZ3RoJztcbiAgfVxuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuYWRkQ2hhbmdlUmVjb3JkID0gZnVuY3Rpb24gYWRkQ2hhbmdlUmVjb3JkKGNoYW5nZVJlY29yZCkge1xuICAgIGlmICghdGhpcy5oYXNTdWJzY3JpYmVycygpICYmICF0aGlzLmxlbmd0aE9ic2VydmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZVJlY29yZC50eXBlID09PSAnc3BsaWNlJykge1xuICAgICAgdmFyIGluZGV4ID0gY2hhbmdlUmVjb3JkLmluZGV4O1xuICAgICAgdmFyIGFycmF5TGVuZ3RoID0gY2hhbmdlUmVjb3JkLm9iamVjdC5sZW5ndGg7XG4gICAgICBpZiAoaW5kZXggPiBhcnJheUxlbmd0aCkge1xuICAgICAgICBpbmRleCA9IGFycmF5TGVuZ3RoIC0gY2hhbmdlUmVjb3JkLmFkZGVkQ291bnQ7XG4gICAgICB9IGVsc2UgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IGFycmF5TGVuZ3RoICsgY2hhbmdlUmVjb3JkLnJlbW92ZWQubGVuZ3RoICsgaW5kZXggLSBjaGFuZ2VSZWNvcmQuYWRkZWRDb3VudDtcbiAgICAgIH1cbiAgICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgaW5kZXggPSAwO1xuICAgICAgfVxuICAgICAgY2hhbmdlUmVjb3JkLmluZGV4ID0gaW5kZXg7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2hhbmdlUmVjb3JkcyA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5jaGFuZ2VSZWNvcmRzID0gW2NoYW5nZVJlY29yZF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbmdlUmVjb3Jkcy5wdXNoKGNoYW5nZVJlY29yZCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnF1ZXVlZCkge1xuICAgICAgdGhpcy5xdWV1ZWQgPSB0cnVlO1xuICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuZmx1c2hDaGFuZ2VSZWNvcmRzID0gZnVuY3Rpb24gZmx1c2hDaGFuZ2VSZWNvcmRzKCkge1xuICAgIGlmICh0aGlzLmNoYW5nZVJlY29yZHMgJiYgdGhpcy5jaGFuZ2VSZWNvcmRzLmxlbmd0aCB8fCB0aGlzLm9sZENvbGxlY3Rpb24pIHtcbiAgICAgIHRoaXMuY2FsbCgpO1xuICAgIH1cbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gcmVzZXQob2xkQ29sbGVjdGlvbikge1xuICAgIHRoaXMub2xkQ29sbGVjdGlvbiA9IG9sZENvbGxlY3Rpb247XG5cbiAgICBpZiAodGhpcy5oYXNTdWJzY3JpYmVycygpICYmICF0aGlzLnF1ZXVlZCkge1xuICAgICAgdGhpcy5xdWV1ZWQgPSB0cnVlO1xuICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuZ2V0TGVuZ3RoT2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRMZW5ndGhPYnNlcnZlcigpIHtcbiAgICByZXR1cm4gdGhpcy5sZW5ndGhPYnNlcnZlciB8fCAodGhpcy5sZW5ndGhPYnNlcnZlciA9IG5ldyBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIodGhpcy5jb2xsZWN0aW9uKSk7XG4gIH07XG5cbiAgTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbCgpIHtcbiAgICB2YXIgY2hhbmdlUmVjb3JkcyA9IHRoaXMuY2hhbmdlUmVjb3JkcztcbiAgICB2YXIgb2xkQ29sbGVjdGlvbiA9IHRoaXMub2xkQ29sbGVjdGlvbjtcbiAgICB2YXIgcmVjb3JkcyA9IHZvaWQgMDtcblxuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG4gICAgdGhpcy5jaGFuZ2VSZWNvcmRzID0gW107XG4gICAgdGhpcy5vbGRDb2xsZWN0aW9uID0gbnVsbDtcblxuICAgIGlmICh0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIGlmIChvbGRDb2xsZWN0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb24gaW5zdGFuY2VvZiBNYXAgfHwgdGhpcy5jb2xsZWN0aW9uIGluc3RhbmNlb2YgU2V0KSB7XG4gICAgICAgICAgcmVjb3JkcyA9IGdldENoYW5nZVJlY29yZHMob2xkQ29sbGVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVjb3JkcyA9IGNhbGNTcGxpY2VzKHRoaXMuY29sbGVjdGlvbiwgMCwgdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCwgb2xkQ29sbGVjdGlvbiwgMCwgb2xkQ29sbGVjdGlvbi5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwIHx8IHRoaXMuY29sbGVjdGlvbiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgICAgIHJlY29yZHMgPSBjaGFuZ2VSZWNvcmRzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY29yZHMgPSBwcm9qZWN0QXJyYXlTcGxpY2VzKHRoaXMuY29sbGVjdGlvbiwgY2hhbmdlUmVjb3Jkcyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMocmVjb3Jkcyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubGVuZ3RoT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMubGVuZ3RoT2JzZXJ2ZXIuY2FsbCh0aGlzLmNvbGxlY3Rpb25bdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzMik7XG5cbmV4cG9ydCB2YXIgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyID0gKF9kZWM0ID0gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSwgX2RlYzQoX2NsYXNzMyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyKGNvbGxlY3Rpb24pIHtcbiAgICBcblxuICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWUgPSBjb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwIHx8IGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBTZXQgPyAnc2l6ZScgOiAnbGVuZ3RoJztcbiAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IGNvbGxlY3Rpb25bdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWVdO1xuICB9XG5cbiAgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmNvbGxlY3Rpb25bdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHRoaXMuY29sbGVjdGlvblt0aGlzLmxlbmd0aFByb3BlcnR5TmFtZV0gPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKG5ld1ZhbHVlKSB7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5jdXJyZW50VmFsdWU7XG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIHJldHVybiBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczMpO1xuXG52YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTtcbnZhciBwb3AgPSBhcnJheVByb3RvLnBvcDtcbnZhciBwdXNoID0gYXJyYXlQcm90by5wdXNoO1xudmFyIHJldmVyc2UgPSBhcnJheVByb3RvLnJldmVyc2U7XG52YXIgc2hpZnQgPSBhcnJheVByb3RvLnNoaWZ0O1xudmFyIHNvcnQgPSBhcnJheVByb3RvLnNvcnQ7XG52YXIgc3BsaWNlID0gYXJyYXlQcm90by5zcGxpY2U7XG52YXIgdW5zaGlmdCA9IGFycmF5UHJvdG8udW5zaGlmdDtcblxuaWYgKGFycmF5UHJvdG8uX19hdV9wYXRjaGVkX18pIHtcbiAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ2FycmF5LW9ic2VydmF0aW9uJykud2FybignRGV0ZWN0ZWQgMm5kIGF0dGVtcHQgb2YgcGF0Y2hpbmcgYXJyYXkgZnJvbSBBdXJlbGlhIGJpbmRpbmcuJyArICcgVGhpcyBpcyBwcm9iYWJseSBjYXVzZWQgYnkgZGVwZW5kZW5jeSBtaXNtYXRjaCBiZXR3ZWVuIGNvcmUgbW9kdWxlcyBhbmQgYSAzcmQgcGFydHkgcGx1Z2luLicgKyAnIFBsZWFzZSBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1cmVsaWEvY2xpL3B1bGwvOTA2IGlmIHlvdSBhcmUgdXNpbmcgd2VicGFjay4nKTtcbn0gZWxzZSB7XG4gIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkoYXJyYXlQcm90bywgJ19fYXVfcGF0Y2hlZF9fJywgeyB2YWx1ZTogMSB9KTtcbiAgYXJyYXlQcm90by5wb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5vdEVtcHR5ID0gdGhpcy5sZW5ndGggPiAwO1xuICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcG9wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKG5vdEVtcHR5ICYmIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICAgIG5hbWU6IHRoaXMubGVuZ3RoLFxuICAgICAgICBvbGRWYWx1ZTogbWV0aG9kQ2FsbFJlc3VsdFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICB9O1xuXG4gIGFycmF5UHJvdG8ucHVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHB1c2guYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgdHlwZTogJ3NwbGljZScsXG4gICAgICAgIG9iamVjdDogdGhpcyxcbiAgICAgICAgaW5kZXg6IHRoaXMubGVuZ3RoIC0gYXJndW1lbnRzLmxlbmd0aCxcbiAgICAgICAgcmVtb3ZlZDogW10sXG4gICAgICAgIGFkZGVkQ291bnQ6IGFyZ3VtZW50cy5sZW5ndGhcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgfTtcblxuICBhcnJheVByb3RvLnJldmVyc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG9sZEFycmF5ID0gdm9pZCAwO1xuICAgIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5mbHVzaENoYW5nZVJlY29yZHMoKTtcbiAgICAgIG9sZEFycmF5ID0gdGhpcy5zbGljZSgpO1xuICAgIH1cbiAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHJldmVyc2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18ucmVzZXQob2xkQXJyYXkpO1xuICAgIH1cbiAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgfTtcblxuICBhcnJheVByb3RvLnNoaWZ0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3RFbXB0eSA9IHRoaXMubGVuZ3RoID4gMDtcbiAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHNoaWZ0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKG5vdEVtcHR5ICYmIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICAgIG5hbWU6IDAsXG4gICAgICAgIG9sZFZhbHVlOiBtZXRob2RDYWxsUmVzdWx0XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gIH07XG5cbiAgYXJyYXlQcm90by5zb3J0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBvbGRBcnJheSA9IHZvaWQgMDtcbiAgICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uZmx1c2hDaGFuZ2VSZWNvcmRzKCk7XG4gICAgICBvbGRBcnJheSA9IHRoaXMuc2xpY2UoKTtcbiAgICB9XG4gICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBzb3J0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLnJlc2V0KG9sZEFycmF5KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gIH07XG5cbiAgYXJyYXlQcm90by5zcGxpY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBzcGxpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgdHlwZTogJ3NwbGljZScsXG4gICAgICAgIG9iamVjdDogdGhpcyxcbiAgICAgICAgaW5kZXg6ICthcmd1bWVudHNbMF0sXG4gICAgICAgIHJlbW92ZWQ6IG1ldGhvZENhbGxSZXN1bHQsXG4gICAgICAgIGFkZGVkQ291bnQ6IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzLmxlbmd0aCAtIDIgOiAwXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gIH07XG5cbiAgYXJyYXlQcm90by51bnNoaWZ0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gdW5zaGlmdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICB0eXBlOiAnc3BsaWNlJyxcbiAgICAgICAgb2JqZWN0OiB0aGlzLFxuICAgICAgICBpbmRleDogMCxcbiAgICAgICAgcmVtb3ZlZDogW10sXG4gICAgICAgIGFkZGVkQ291bnQ6IGFyZ3VtZW50cy5sZW5ndGhcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgfTtcbn1cblxuZnVuY3Rpb24gX2dldEFycmF5T2JzZXJ2ZXIodGFza1F1ZXVlLCBhcnJheSkge1xuICByZXR1cm4gTW9kaWZ5QXJyYXlPYnNlcnZlci5mb3IodGFza1F1ZXVlLCBhcnJheSk7XG59XG5cbnZhciBNb2RpZnlBcnJheU9ic2VydmVyID0gZnVuY3Rpb24gKF9Nb2RpZnlDb2xsZWN0aW9uT2JzZSkge1xuICBfaW5oZXJpdHMoTW9kaWZ5QXJyYXlPYnNlcnZlciwgX01vZGlmeUNvbGxlY3Rpb25PYnNlKTtcblxuICBmdW5jdGlvbiBNb2RpZnlBcnJheU9ic2VydmVyKHRhc2tRdWV1ZSwgYXJyYXkpIHtcbiAgICBcblxuICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UuY2FsbCh0aGlzLCB0YXNrUXVldWUsIGFycmF5KSk7XG4gIH1cblxuICBNb2RpZnlBcnJheU9ic2VydmVyLmZvciA9IGZ1bmN0aW9uIF9mb3IodGFza1F1ZXVlLCBhcnJheSkge1xuICAgIGlmICghKCdfX2FycmF5X29ic2VydmVyX18nIGluIGFycmF5KSkge1xuICAgICAgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eShhcnJheSwgJ19fYXJyYXlfb2JzZXJ2ZXJfXycsIHtcbiAgICAgICAgdmFsdWU6IE1vZGlmeUFycmF5T2JzZXJ2ZXIuY3JlYXRlKHRhc2tRdWV1ZSwgYXJyYXkpLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBhcnJheS5fX2FycmF5X29ic2VydmVyX187XG4gIH07XG5cbiAgTW9kaWZ5QXJyYXlPYnNlcnZlci5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUodGFza1F1ZXVlLCBhcnJheSkge1xuICAgIHJldHVybiBuZXcgTW9kaWZ5QXJyYXlPYnNlcnZlcih0YXNrUXVldWUsIGFycmF5KTtcbiAgfTtcblxuICByZXR1cm4gTW9kaWZ5QXJyYXlPYnNlcnZlcjtcbn0oTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyKTtcblxuZXhwb3J0IHZhciBFeHByZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFeHByZXNzaW9uKCkge1xuICAgIFxuXG4gICAgdGhpcy5pc0Fzc2lnbmFibGUgPSBmYWxzZTtcbiAgfVxuXG4gIEV4cHJlc3Npb24ucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucywgYXJncykge1xuICAgIHRocm93IG5ldyBFcnJvcignQmluZGluZyBleHByZXNzaW9uIFwiJyArIHRoaXMgKyAnXCIgY2Fubm90IGJlIGV2YWx1YXRlZC4nKTtcbiAgfTtcblxuICBFeHByZXNzaW9uLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JpbmRpbmcgZXhwcmVzc2lvbiBcIicgKyB0aGlzICsgJ1wiIGNhbm5vdCBiZSBhc3NpZ25lZCB0by4nKTtcbiAgfTtcblxuICBFeHByZXNzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0eXBlb2YgRkVBVFVSRV9OT19VTlBBUlNFUiA9PT0gJ3VuZGVmaW5lZCcgPyBfVW5wYXJzZXIudW5wYXJzZSh0aGlzKSA6IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIHJldHVybiBFeHByZXNzaW9uO1xufSgpO1xuXG5leHBvcnQgdmFyIEJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbikge1xuICBfaW5oZXJpdHMoQmluZGluZ0JlaGF2aW9yLCBfRXhwcmVzc2lvbik7XG5cbiAgZnVuY3Rpb24gQmluZGluZ0JlaGF2aW9yKGV4cHJlc3Npb24sIG5hbWUsIGFyZ3MpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMy5leHByZXNzaW9uID0gZXhwcmVzc2lvbjtcbiAgICBfdGhpczMubmFtZSA9IG5hbWU7XG4gICAgX3RoaXMzLmFyZ3MgPSBhcmdzO1xuICAgIHJldHVybiBfdGhpczM7XG4gIH1cblxuICBCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uLmFzc2lnbihzY29wZSwgdmFsdWUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QmluZGluZ0JlaGF2aW9yKHRoaXMpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmV4cHJlc3Npb24uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChiaW5kaW5nLCBzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgaWYgKHRoaXMuZXhwcmVzc2lvbi5leHByZXNzaW9uICYmIHRoaXMuZXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICB0aGlzLmV4cHJlc3Npb24uYmluZChiaW5kaW5nLCBzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgdmFyIGJlaGF2aW9yID0gbG9va3VwRnVuY3Rpb25zLmJpbmRpbmdCZWhhdmlvcnModGhpcy5uYW1lKTtcbiAgICBpZiAoIWJlaGF2aW9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIEJpbmRpbmdCZWhhdmlvciBuYW1lZCBcIicgKyB0aGlzLm5hbWUgKyAnXCIgd2FzIGZvdW5kIScpO1xuICAgIH1cbiAgICB2YXIgYmVoYXZpb3JLZXkgPSAnYmVoYXZpb3ItJyArIHRoaXMubmFtZTtcbiAgICBpZiAoYmluZGluZ1tiZWhhdmlvcktleV0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQSBiaW5kaW5nIGJlaGF2aW9yIG5hbWVkIFwiJyArIHRoaXMubmFtZSArICdcIiBoYXMgYWxyZWFkeSBiZWVuIGFwcGxpZWQgdG8gXCInICsgdGhpcy5leHByZXNzaW9uICsgJ1wiJyk7XG4gICAgfVxuICAgIGJpbmRpbmdbYmVoYXZpb3JLZXldID0gYmVoYXZpb3I7XG4gICAgYmVoYXZpb3IuYmluZC5hcHBseShiZWhhdmlvciwgW2JpbmRpbmcsIHNjb3BlXS5jb25jYXQoZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgYmluZGluZy5sb29rdXBGdW5jdGlvbnMpKSk7XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgYmVoYXZpb3JLZXkgPSAnYmVoYXZpb3ItJyArIHRoaXMubmFtZTtcbiAgICBiaW5kaW5nW2JlaGF2aW9yS2V5XS51bmJpbmQoYmluZGluZywgc2NvcGUpO1xuICAgIGJpbmRpbmdbYmVoYXZpb3JLZXldID0gbnVsbDtcbiAgICBpZiAodGhpcy5leHByZXNzaW9uLmV4cHJlc3Npb24gJiYgdGhpcy5leHByZXNzaW9uLnVuYmluZCkge1xuICAgICAgdGhpcy5leHByZXNzaW9uLnVuYmluZChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBCaW5kaW5nQmVoYXZpb3I7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIFZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMikge1xuICBfaW5oZXJpdHMoVmFsdWVDb252ZXJ0ZXIsIF9FeHByZXNzaW9uMik7XG5cbiAgZnVuY3Rpb24gVmFsdWVDb252ZXJ0ZXIoZXhwcmVzc2lvbiwgbmFtZSwgYXJncykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzNCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzNC5leHByZXNzaW9uID0gZXhwcmVzc2lvbjtcbiAgICBfdGhpczQubmFtZSA9IG5hbWU7XG4gICAgX3RoaXM0LmFyZ3MgPSBhcmdzO1xuICAgIF90aGlzNC5hbGxBcmdzID0gW2V4cHJlc3Npb25dLmNvbmNhdChhcmdzKTtcbiAgICByZXR1cm4gX3RoaXM0O1xuICB9XG5cbiAgVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBjb252ZXJ0ZXIgPSBsb29rdXBGdW5jdGlvbnMudmFsdWVDb252ZXJ0ZXJzKHRoaXMubmFtZSk7XG4gICAgaWYgKCFjb252ZXJ0ZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVmFsdWVDb252ZXJ0ZXIgbmFtZWQgXCInICsgdGhpcy5uYW1lICsgJ1wiIHdhcyBmb3VuZCEnKTtcbiAgICB9XG5cbiAgICBpZiAoJ3RvVmlldycgaW4gY29udmVydGVyKSB7XG4gICAgICByZXR1cm4gY29udmVydGVyLnRvVmlldy5hcHBseShjb252ZXJ0ZXIsIGV2YWxMaXN0KHNjb3BlLCB0aGlzLmFsbEFyZ3MsIGxvb2t1cEZ1bmN0aW9ucykpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmFsbEFyZ3NbMF0uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLmFzc2lnbiA9IGZ1bmN0aW9uIGFzc2lnbihzY29wZSwgdmFsdWUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBjb252ZXJ0ZXIgPSBsb29rdXBGdW5jdGlvbnMudmFsdWVDb252ZXJ0ZXJzKHRoaXMubmFtZSk7XG4gICAgaWYgKCFjb252ZXJ0ZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVmFsdWVDb252ZXJ0ZXIgbmFtZWQgXCInICsgdGhpcy5uYW1lICsgJ1wiIHdhcyBmb3VuZCEnKTtcbiAgICB9XG5cbiAgICBpZiAoJ2Zyb21WaWV3JyBpbiBjb252ZXJ0ZXIpIHtcbiAgICAgIHZhbHVlID0gY29udmVydGVyLmZyb21WaWV3LmFwcGx5KGNvbnZlcnRlciwgW3ZhbHVlXS5jb25jYXQoZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgbG9va3VwRnVuY3Rpb25zKSkpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmFsbEFyZ3NbMF0uYXNzaWduKHNjb3BlLCB2YWx1ZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBWYWx1ZUNvbnZlcnRlci5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdFZhbHVlQ29udmVydGVyKHRoaXMpO1xuICB9O1xuXG4gIFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHZhciBleHByZXNzaW9ucyA9IHRoaXMuYWxsQXJncztcbiAgICB2YXIgaSA9IGV4cHJlc3Npb25zLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBleHByZXNzaW9uc1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gICAgdmFyIGNvbnZlcnRlciA9IGJpbmRpbmcubG9va3VwRnVuY3Rpb25zLnZhbHVlQ29udmVydGVycyh0aGlzLm5hbWUpO1xuICAgIGlmICghY29udmVydGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFZhbHVlQ29udmVydGVyIG5hbWVkIFwiJyArIHRoaXMubmFtZSArICdcIiB3YXMgZm91bmQhJyk7XG4gICAgfVxuICAgIHZhciBzaWduYWxzID0gY29udmVydGVyLnNpZ25hbHM7XG4gICAgaWYgKHNpZ25hbHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpID0gc2lnbmFscy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgY29ubmVjdEJpbmRpbmdUb1NpZ25hbChiaW5kaW5nLCBzaWduYWxzW2ldKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFZhbHVlQ29udmVydGVyO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBBc3NpZ24gPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24zKSB7XG4gIF9pbmhlcml0cyhBc3NpZ24sIF9FeHByZXNzaW9uMyk7XG5cbiAgZnVuY3Rpb24gQXNzaWduKHRhcmdldCwgdmFsdWUpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczUgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjMuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczUudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIF90aGlzNS52YWx1ZSA9IHZhbHVlO1xuICAgIF90aGlzNS5pc0Fzc2lnbmFibGUgPSB0cnVlO1xuICAgIHJldHVybiBfdGhpczU7XG4gIH1cblxuICBBc3NpZ24ucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnRhcmdldC5hc3NpZ24oc2NvcGUsIHRoaXMudmFsdWUuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykpO1xuICB9O1xuXG4gIEFzc2lnbi5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc3Rvcikge1xuICAgIHZpc3Rvci52aXNpdEFzc2lnbih0aGlzKTtcbiAgfTtcblxuICBBc3NpZ24ucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7fTtcblxuICBBc3NpZ24ucHJvdG90eXBlLmFzc2lnbiA9IGZ1bmN0aW9uIGFzc2lnbihzY29wZSwgdmFsdWUpIHtcbiAgICB0aGlzLnZhbHVlLmFzc2lnbihzY29wZSwgdmFsdWUpO1xuICAgIHRoaXMudGFyZ2V0LmFzc2lnbihzY29wZSwgdmFsdWUpO1xuICB9O1xuXG4gIHJldHVybiBBc3NpZ247XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIENvbmRpdGlvbmFsID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uNCkge1xuICBfaW5oZXJpdHMoQ29uZGl0aW9uYWwsIF9FeHByZXNzaW9uNCk7XG5cbiAgZnVuY3Rpb24gQ29uZGl0aW9uYWwoY29uZGl0aW9uLCB5ZXMsIG5vKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXM2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb240LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXM2LmNvbmRpdGlvbiA9IGNvbmRpdGlvbjtcbiAgICBfdGhpczYueWVzID0geWVzO1xuICAgIF90aGlzNi5ubyA9IG5vO1xuICAgIHJldHVybiBfdGhpczY7XG4gIH1cblxuICBDb25kaXRpb25hbC5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgcmV0dXJuICEhdGhpcy5jb25kaXRpb24uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykgPyB0aGlzLnllcy5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSA6IHRoaXMubm8uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQ29uZGl0aW9uYWwucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRDb25kaXRpb25hbCh0aGlzKTtcbiAgfTtcblxuICBDb25kaXRpb25hbC5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmNvbmRpdGlvbi5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICBpZiAodGhpcy5jb25kaXRpb24uZXZhbHVhdGUoc2NvcGUpKSB7XG4gICAgICB0aGlzLnllcy5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uby5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENvbmRpdGlvbmFsO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBBY2Nlc3NUaGlzID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uNSkge1xuICBfaW5oZXJpdHMoQWNjZXNzVGhpcywgX0V4cHJlc3Npb241KTtcblxuICBmdW5jdGlvbiBBY2Nlc3NUaGlzKGFuY2VzdG9yKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXM3ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb241LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXM3LmFuY2VzdG9yID0gYW5jZXN0b3I7XG4gICAgcmV0dXJuIF90aGlzNztcbiAgfVxuXG4gIEFjY2Vzc1RoaXMucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBvYyA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcbiAgICB2YXIgaSA9IHRoaXMuYW5jZXN0b3I7XG4gICAgd2hpbGUgKGktLSAmJiBvYykge1xuICAgICAgb2MgPSBvYy5wYXJlbnRPdmVycmlkZUNvbnRleHQ7XG4gICAgfVxuICAgIHJldHVybiBpIDwgMSAmJiBvYyA/IG9jLmJpbmRpbmdDb250ZXh0IDogdW5kZWZpbmVkO1xuICB9O1xuXG4gIEFjY2Vzc1RoaXMucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRBY2Nlc3NUaGlzKHRoaXMpO1xuICB9O1xuXG4gIEFjY2Vzc1RoaXMucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7fTtcblxuICByZXR1cm4gQWNjZXNzVGhpcztcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgQWNjZXNzU2NvcGUgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb242KSB7XG4gIF9pbmhlcml0cyhBY2Nlc3NTY29wZSwgX0V4cHJlc3Npb242KTtcblxuICBmdW5jdGlvbiBBY2Nlc3NTY29wZShuYW1lLCBhbmNlc3Rvcikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzOCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uNi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzOC5uYW1lID0gbmFtZTtcbiAgICBfdGhpczguYW5jZXN0b3IgPSBhbmNlc3RvcjtcbiAgICBfdGhpczguaXNBc3NpZ25hYmxlID0gdHJ1ZTtcbiAgICByZXR1cm4gX3RoaXM4O1xuICB9XG5cbiAgQWNjZXNzU2NvcGUucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBjb250ZXh0ID0gZ2V0Q29udGV4dEZvcih0aGlzLm5hbWUsIHNjb3BlLCB0aGlzLmFuY2VzdG9yKTtcbiAgICByZXR1cm4gY29udGV4dFt0aGlzLm5hbWVdO1xuICB9O1xuXG4gIEFjY2Vzc1Njb3BlLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlKSB7XG4gICAgdmFyIGNvbnRleHQgPSBnZXRDb250ZXh0Rm9yKHRoaXMubmFtZSwgc2NvcGUsIHRoaXMuYW5jZXN0b3IpO1xuICAgIHJldHVybiBjb250ZXh0ID8gY29udGV4dFt0aGlzLm5hbWVdID0gdmFsdWUgOiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgQWNjZXNzU2NvcGUucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRBY2Nlc3NTY29wZSh0aGlzKTtcbiAgfTtcblxuICBBY2Nlc3NTY29wZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgY29udGV4dCA9IGdldENvbnRleHRGb3IodGhpcy5uYW1lLCBzY29wZSwgdGhpcy5hbmNlc3Rvcik7XG4gICAgYmluZGluZy5vYnNlcnZlUHJvcGVydHkoY29udGV4dCwgdGhpcy5uYW1lKTtcbiAgfTtcblxuICByZXR1cm4gQWNjZXNzU2NvcGU7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIEFjY2Vzc01lbWJlciA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjcpIHtcbiAgX2luaGVyaXRzKEFjY2Vzc01lbWJlciwgX0V4cHJlc3Npb243KTtcblxuICBmdW5jdGlvbiBBY2Nlc3NNZW1iZXIob2JqZWN0LCBuYW1lKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXM5ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb243LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXM5Lm9iamVjdCA9IG9iamVjdDtcbiAgICBfdGhpczkubmFtZSA9IG5hbWU7XG4gICAgX3RoaXM5LmlzQXNzaWduYWJsZSA9IHRydWU7XG4gICAgcmV0dXJuIF90aGlzOTtcbiAgfVxuXG4gIEFjY2Vzc01lbWJlci5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcy5vYmplY3QuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgcmV0dXJuIGluc3RhbmNlID09PSBudWxsIHx8IGluc3RhbmNlID09PSB1bmRlZmluZWQgPyBpbnN0YW5jZSA6IGluc3RhbmNlW3RoaXMubmFtZV07XG4gIH07XG5cbiAgQWNjZXNzTWVtYmVyLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcy5vYmplY3QuZXZhbHVhdGUoc2NvcGUpO1xuXG4gICAgaWYgKGluc3RhbmNlID09PSBudWxsIHx8IGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGluc3RhbmNlID0ge307XG4gICAgICB0aGlzLm9iamVjdC5hc3NpZ24oc2NvcGUsIGluc3RhbmNlKTtcbiAgICB9XG5cbiAgICBpbnN0YW5jZVt0aGlzLm5hbWVdID0gdmFsdWU7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9O1xuXG4gIEFjY2Vzc01lbWJlci5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdEFjY2Vzc01lbWJlcih0aGlzKTtcbiAgfTtcblxuICBBY2Nlc3NNZW1iZXIucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5vYmplY3QuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgdmFyIG9iaiA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlKTtcbiAgICBpZiAob2JqKSB7XG4gICAgICBiaW5kaW5nLm9ic2VydmVQcm9wZXJ0eShvYmosIHRoaXMubmFtZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBBY2Nlc3NNZW1iZXI7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIEFjY2Vzc0tleWVkID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uOCkge1xuICBfaW5oZXJpdHMoQWNjZXNzS2V5ZWQsIF9FeHByZXNzaW9uOCk7XG5cbiAgZnVuY3Rpb24gQWNjZXNzS2V5ZWQob2JqZWN0LCBrZXkpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczEwID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb244LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxMC5vYmplY3QgPSBvYmplY3Q7XG4gICAgX3RoaXMxMC5rZXkgPSBrZXk7XG4gICAgX3RoaXMxMC5pc0Fzc2lnbmFibGUgPSB0cnVlO1xuICAgIHJldHVybiBfdGhpczEwO1xuICB9XG5cbiAgQWNjZXNzS2V5ZWQucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHZhciBsb29rdXAgPSB0aGlzLmtleS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICByZXR1cm4gZ2V0S2V5ZWQoaW5zdGFuY2UsIGxvb2t1cCk7XG4gIH07XG5cbiAgQWNjZXNzS2V5ZWQucHJvdG90eXBlLmFzc2lnbiA9IGZ1bmN0aW9uIGFzc2lnbihzY29wZSwgdmFsdWUpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgdmFyIGxvb2t1cCA9IHRoaXMua2V5LmV2YWx1YXRlKHNjb3BlKTtcbiAgICByZXR1cm4gc2V0S2V5ZWQoaW5zdGFuY2UsIGxvb2t1cCwgdmFsdWUpO1xuICB9O1xuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QWNjZXNzS2V5ZWQodGhpcyk7XG4gIH07XG5cbiAgQWNjZXNzS2V5ZWQucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5vYmplY3QuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgdmFyIG9iaiA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlKTtcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICB0aGlzLmtleS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICAgIHZhciBrZXkgPSB0aGlzLmtleS5ldmFsdWF0ZShzY29wZSk7XG5cbiAgICAgIGlmIChrZXkgIT09IG51bGwgJiYga2V5ICE9PSB1bmRlZmluZWQgJiYgIShBcnJheS5pc0FycmF5KG9iaikgJiYgdHlwZW9mIGtleSA9PT0gJ251bWJlcicpKSB7XG4gICAgICAgIGJpbmRpbmcub2JzZXJ2ZVByb3BlcnR5KG9iaiwga2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIEFjY2Vzc0tleWVkO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBDYWxsU2NvcGUgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb245KSB7XG4gIF9pbmhlcml0cyhDYWxsU2NvcGUsIF9FeHByZXNzaW9uOSk7XG5cbiAgZnVuY3Rpb24gQ2FsbFNjb3BlKG5hbWUsIGFyZ3MsIGFuY2VzdG9yKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxMSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uOS5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTEubmFtZSA9IG5hbWU7XG4gICAgX3RoaXMxMS5hcmdzID0gYXJncztcbiAgICBfdGhpczExLmFuY2VzdG9yID0gYW5jZXN0b3I7XG4gICAgcmV0dXJuIF90aGlzMTE7XG4gIH1cblxuICBDYWxsU2NvcGUucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucywgbXVzdEV2YWx1YXRlKSB7XG4gICAgdmFyIGFyZ3MgPSBldmFsTGlzdChzY29wZSwgdGhpcy5hcmdzLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHZhciBjb250ZXh0ID0gZ2V0Q29udGV4dEZvcih0aGlzLm5hbWUsIHNjb3BlLCB0aGlzLmFuY2VzdG9yKTtcbiAgICB2YXIgZnVuYyA9IGdldEZ1bmN0aW9uKGNvbnRleHQsIHRoaXMubmFtZSwgbXVzdEV2YWx1YXRlKTtcbiAgICBpZiAoZnVuYykge1xuICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgQ2FsbFNjb3BlLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0Q2FsbFNjb3BlKHRoaXMpO1xuICB9O1xuXG4gIENhbGxTY29wZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgYXJncyA9IHRoaXMuYXJncztcbiAgICB2YXIgaSA9IGFyZ3MubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGFyZ3NbaV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDYWxsU2NvcGU7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIENhbGxNZW1iZXIgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xMCkge1xuICBfaW5oZXJpdHMoQ2FsbE1lbWJlciwgX0V4cHJlc3Npb24xMCk7XG5cbiAgZnVuY3Rpb24gQ2FsbE1lbWJlcihvYmplY3QsIG5hbWUsIGFyZ3MpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczEyID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xMC5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTIub2JqZWN0ID0gb2JqZWN0O1xuICAgIF90aGlzMTIubmFtZSA9IG5hbWU7XG4gICAgX3RoaXMxMi5hcmdzID0gYXJncztcbiAgICByZXR1cm4gX3RoaXMxMjtcbiAgfVxuXG4gIENhbGxNZW1iZXIucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucywgbXVzdEV2YWx1YXRlKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcy5vYmplY3QuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgdmFyIGFyZ3MgPSBldmFsTGlzdChzY29wZSwgdGhpcy5hcmdzLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHZhciBmdW5jID0gZ2V0RnVuY3Rpb24oaW5zdGFuY2UsIHRoaXMubmFtZSwgbXVzdEV2YWx1YXRlKTtcbiAgICBpZiAoZnVuYykge1xuICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkoaW5zdGFuY2UsIGFyZ3MpO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIENhbGxNZW1iZXIucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRDYWxsTWVtYmVyKHRoaXMpO1xuICB9O1xuXG4gIENhbGxNZW1iZXIucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5vYmplY3QuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgdmFyIG9iaiA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlKTtcbiAgICBpZiAoZ2V0RnVuY3Rpb24ob2JqLCB0aGlzLm5hbWUsIGZhbHNlKSkge1xuICAgICAgdmFyIGFyZ3MgPSB0aGlzLmFyZ3M7XG4gICAgICB2YXIgaSA9IGFyZ3MubGVuZ3RoO1xuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICBhcmdzW2ldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2FsbE1lbWJlcjtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgQ2FsbEZ1bmN0aW9uID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTEpIHtcbiAgX2luaGVyaXRzKENhbGxGdW5jdGlvbiwgX0V4cHJlc3Npb24xMSk7XG5cbiAgZnVuY3Rpb24gQ2FsbEZ1bmN0aW9uKGZ1bmMsIGFyZ3MpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczEzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xMS5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTMuZnVuYyA9IGZ1bmM7XG4gICAgX3RoaXMxMy5hcmdzID0gYXJncztcbiAgICByZXR1cm4gX3RoaXMxMztcbiAgfVxuXG4gIENhbGxGdW5jdGlvbi5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zLCBtdXN0RXZhbHVhdGUpIHtcbiAgICB2YXIgZnVuYyA9IHRoaXMuZnVuYy5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICBpZiAodHlwZW9mIGZ1bmMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KG51bGwsIGV2YWxMaXN0KHNjb3BlLCB0aGlzLmFyZ3MsIGxvb2t1cEZ1bmN0aW9ucykpO1xuICAgIH1cbiAgICBpZiAoIW11c3RFdmFsdWF0ZSAmJiAoZnVuYyA9PT0gbnVsbCB8fCBmdW5jID09PSB1bmRlZmluZWQpKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5mdW5jICsgJyBpcyBub3QgYSBmdW5jdGlvbicpO1xuICB9O1xuXG4gIENhbGxGdW5jdGlvbi5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdENhbGxGdW5jdGlvbih0aGlzKTtcbiAgfTtcblxuICBDYWxsRnVuY3Rpb24ucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5mdW5jLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBmdW5jID0gdGhpcy5mdW5jLmV2YWx1YXRlKHNjb3BlKTtcbiAgICBpZiAodHlwZW9mIGZ1bmMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhciBhcmdzID0gdGhpcy5hcmdzO1xuICAgICAgdmFyIGkgPSBhcmdzLmxlbmd0aDtcbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgYXJnc1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENhbGxGdW5jdGlvbjtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgQmluYXJ5ID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTIpIHtcbiAgX2luaGVyaXRzKEJpbmFyeSwgX0V4cHJlc3Npb24xMik7XG5cbiAgZnVuY3Rpb24gQmluYXJ5KG9wZXJhdGlvbiwgbGVmdCwgcmlnaHQpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE0ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xMi5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTQub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xuICAgIF90aGlzMTQubGVmdCA9IGxlZnQ7XG4gICAgX3RoaXMxNC5yaWdodCA9IHJpZ2h0O1xuICAgIHJldHVybiBfdGhpczE0O1xuICB9XG5cbiAgQmluYXJ5LnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgbGVmdCA9IHRoaXMubGVmdC5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcblxuICAgIHN3aXRjaCAodGhpcy5vcGVyYXRpb24pIHtcbiAgICAgIGNhc2UgJyYmJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgJiYgdGhpcy5yaWdodC5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICAgIGNhc2UgJ3x8JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgfHwgdGhpcy5yaWdodC5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICB2YXIgcmlnaHQgPSB0aGlzLnJpZ2h0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuXG4gICAgc3dpdGNoICh0aGlzLm9wZXJhdGlvbikge1xuICAgICAgY2FzZSAnPT0nOlxuICAgICAgICByZXR1cm4gbGVmdCA9PSByaWdodDtcbiAgICAgIGNhc2UgJz09PSc6XG4gICAgICAgIHJldHVybiBsZWZ0ID09PSByaWdodDtcbiAgICAgIGNhc2UgJyE9JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgIT0gcmlnaHQ7XG4gICAgICBjYXNlICchPT0nOlxuICAgICAgICByZXR1cm4gbGVmdCAhPT0gcmlnaHQ7XG4gICAgICBjYXNlICdpbnN0YW5jZW9mJzpcbiAgICAgICAgcmV0dXJuIHR5cGVvZiByaWdodCA9PT0gJ2Z1bmN0aW9uJyAmJiBsZWZ0IGluc3RhbmNlb2YgcmlnaHQ7XG4gICAgICBjYXNlICdpbic6XG4gICAgICAgIHJldHVybiAodHlwZW9mIHJpZ2h0ID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihyaWdodCkpID09PSAnb2JqZWN0JyAmJiByaWdodCAhPT0gbnVsbCAmJiBsZWZ0IGluIHJpZ2h0O1xuICAgIH1cblxuICAgIGlmIChsZWZ0ID09PSBudWxsIHx8IHJpZ2h0ID09PSBudWxsIHx8IGxlZnQgPT09IHVuZGVmaW5lZCB8fCByaWdodCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBzd2l0Y2ggKHRoaXMub3BlcmF0aW9uKSB7XG4gICAgICAgIGNhc2UgJysnOlxuICAgICAgICAgIGlmIChsZWZ0ICE9PSBudWxsICYmIGxlZnQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGxlZnQ7XG4gICAgICAgICAgaWYgKHJpZ2h0ICE9PSBudWxsICYmIHJpZ2h0ICE9PSB1bmRlZmluZWQpIHJldHVybiByaWdodDtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgY2FzZSAnLSc6XG4gICAgICAgICAgaWYgKGxlZnQgIT09IG51bGwgJiYgbGVmdCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gbGVmdDtcbiAgICAgICAgICBpZiAocmlnaHQgIT09IG51bGwgJiYgcmlnaHQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIDAgLSByaWdodDtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgc3dpdGNoICh0aGlzLm9wZXJhdGlvbikge1xuICAgICAgY2FzZSAnKyc6XG4gICAgICAgIHJldHVybiBhdXRvQ29udmVydEFkZChsZWZ0LCByaWdodCk7XG4gICAgICBjYXNlICctJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgLSByaWdodDtcbiAgICAgIGNhc2UgJyonOlxuICAgICAgICByZXR1cm4gbGVmdCAqIHJpZ2h0O1xuICAgICAgY2FzZSAnLyc6XG4gICAgICAgIHJldHVybiBsZWZ0IC8gcmlnaHQ7XG4gICAgICBjYXNlICclJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgJSByaWdodDtcbiAgICAgIGNhc2UgJzwnOlxuICAgICAgICByZXR1cm4gbGVmdCA8IHJpZ2h0O1xuICAgICAgY2FzZSAnPic6XG4gICAgICAgIHJldHVybiBsZWZ0ID4gcmlnaHQ7XG4gICAgICBjYXNlICc8PSc6XG4gICAgICAgIHJldHVybiBsZWZ0IDw9IHJpZ2h0O1xuICAgICAgY2FzZSAnPj0nOlxuICAgICAgICByZXR1cm4gbGVmdCA+PSByaWdodDtcbiAgICAgIGNhc2UgJ14nOlxuICAgICAgICByZXR1cm4gbGVmdCBeIHJpZ2h0O1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcignSW50ZXJuYWwgZXJyb3IgWycgKyB0aGlzLm9wZXJhdGlvbiArICddIG5vdCBoYW5kbGVkJyk7XG4gIH07XG5cbiAgQmluYXJ5LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QmluYXJ5KHRoaXMpO1xuICB9O1xuXG4gIEJpbmFyeS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmxlZnQuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgdmFyIGxlZnQgPSB0aGlzLmxlZnQuZXZhbHVhdGUoc2NvcGUpO1xuICAgIGlmICh0aGlzLm9wZXJhdGlvbiA9PT0gJyYmJyAmJiAhbGVmdCB8fCB0aGlzLm9wZXJhdGlvbiA9PT0gJ3x8JyAmJiBsZWZ0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucmlnaHQuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmFyeTtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgVW5hcnkgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xMykge1xuICBfaW5oZXJpdHMoVW5hcnksIF9FeHByZXNzaW9uMTMpO1xuXG4gIGZ1bmN0aW9uIFVuYXJ5KG9wZXJhdGlvbiwgZXhwcmVzc2lvbikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTUgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjEzLmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxNS5vcGVyYXRpb24gPSBvcGVyYXRpb247XG4gICAgX3RoaXMxNS5leHByZXNzaW9uID0gZXhwcmVzc2lvbjtcbiAgICByZXR1cm4gX3RoaXMxNTtcbiAgfVxuXG4gIFVuYXJ5LnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBzd2l0Y2ggKHRoaXMub3BlcmF0aW9uKSB7XG4gICAgICBjYXNlICchJzpcbiAgICAgICAgcmV0dXJuICF0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICBjYXNlICd0eXBlb2YnOlxuICAgICAgICByZXR1cm4gX3R5cGVvZih0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykpO1xuICAgICAgY2FzZSAndm9pZCc6XG4gICAgICAgIHJldHVybiB2b2lkIHRoaXMuZXhwcmVzc2lvbi5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludGVybmFsIGVycm9yIFsnICsgdGhpcy5vcGVyYXRpb24gKyAnXSBub3QgaGFuZGxlZCcpO1xuICB9O1xuXG4gIFVuYXJ5LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0UHJlZml4KHRoaXMpO1xuICB9O1xuXG4gIFVuYXJ5LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMuZXhwcmVzc2lvbi5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgfTtcblxuICByZXR1cm4gVW5hcnk7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIExpdGVyYWxQcmltaXRpdmUgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xNCkge1xuICBfaW5oZXJpdHMoTGl0ZXJhbFByaW1pdGl2ZSwgX0V4cHJlc3Npb24xNCk7XG5cbiAgZnVuY3Rpb24gTGl0ZXJhbFByaW1pdGl2ZSh2YWx1ZSkge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTYgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE0LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxNi52YWx1ZSA9IHZhbHVlO1xuICAgIHJldHVybiBfdGhpczE2O1xuICB9XG5cbiAgTGl0ZXJhbFByaW1pdGl2ZS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH07XG5cbiAgTGl0ZXJhbFByaW1pdGl2ZS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxQcmltaXRpdmUodGhpcyk7XG4gIH07XG5cbiAgTGl0ZXJhbFByaW1pdGl2ZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHt9O1xuXG4gIHJldHVybiBMaXRlcmFsUHJpbWl0aXZlO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBMaXRlcmFsU3RyaW5nID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTUpIHtcbiAgX2luaGVyaXRzKExpdGVyYWxTdHJpbmcsIF9FeHByZXNzaW9uMTUpO1xuXG4gIGZ1bmN0aW9uIExpdGVyYWxTdHJpbmcodmFsdWUpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE3ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xNS5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTcudmFsdWUgPSB2YWx1ZTtcbiAgICByZXR1cm4gX3RoaXMxNztcbiAgfVxuXG4gIExpdGVyYWxTdHJpbmcucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuXG4gIExpdGVyYWxTdHJpbmcucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRMaXRlcmFsU3RyaW5nKHRoaXMpO1xuICB9O1xuXG4gIExpdGVyYWxTdHJpbmcucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7fTtcblxuICByZXR1cm4gTGl0ZXJhbFN0cmluZztcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgTGl0ZXJhbFRlbXBsYXRlID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTYpIHtcbiAgX2luaGVyaXRzKExpdGVyYWxUZW1wbGF0ZSwgX0V4cHJlc3Npb24xNik7XG5cbiAgZnVuY3Rpb24gTGl0ZXJhbFRlbXBsYXRlKGNvb2tlZCwgZXhwcmVzc2lvbnMsIHJhdywgdGFnKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxOCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTYuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczE4LmNvb2tlZCA9IGNvb2tlZDtcbiAgICBfdGhpczE4LmV4cHJlc3Npb25zID0gZXhwcmVzc2lvbnMgfHwgW107XG4gICAgX3RoaXMxOC5sZW5ndGggPSBfdGhpczE4LmV4cHJlc3Npb25zLmxlbmd0aDtcbiAgICBfdGhpczE4LnRhZ2dlZCA9IHRhZyAhPT0gdW5kZWZpbmVkO1xuICAgIGlmIChfdGhpczE4LnRhZ2dlZCkge1xuICAgICAgX3RoaXMxOC5jb29rZWQucmF3ID0gcmF3O1xuICAgICAgX3RoaXMxOC50YWcgPSB0YWc7XG4gICAgICBpZiAodGFnIGluc3RhbmNlb2YgQWNjZXNzU2NvcGUpIHtcbiAgICAgICAgX3RoaXMxOC5jb250ZXh0VHlwZSA9ICdTY29wZSc7XG4gICAgICB9IGVsc2UgaWYgKHRhZyBpbnN0YW5jZW9mIEFjY2Vzc01lbWJlciB8fCB0YWcgaW5zdGFuY2VvZiBBY2Nlc3NLZXllZCkge1xuICAgICAgICBfdGhpczE4LmNvbnRleHRUeXBlID0gJ09iamVjdCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX3RoaXMxOC50YWcgKyAnIGlzIG5vdCBhIHZhbGlkIHRlbXBsYXRlIHRhZycpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX3RoaXMxODtcbiAgfVxuXG4gIExpdGVyYWxUZW1wbGF0ZS5wcm90b3R5cGUuZ2V0U2NvcGVDb250ZXh0ID0gZnVuY3Rpb24gZ2V0U2NvcGVDb250ZXh0KHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gZ2V0Q29udGV4dEZvcih0aGlzLnRhZy5uYW1lLCBzY29wZSwgdGhpcy50YWcuYW5jZXN0b3IpO1xuICB9O1xuXG4gIExpdGVyYWxUZW1wbGF0ZS5wcm90b3R5cGUuZ2V0T2JqZWN0Q29udGV4dCA9IGZ1bmN0aW9uIGdldE9iamVjdENvbnRleHQoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnRhZy5vYmplY3QuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgTGl0ZXJhbFRlbXBsYXRlLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMsIG11c3RFdmFsdWF0ZSkge1xuICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KHRoaXMubGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlc3VsdHNbaV0gPSB0aGlzLmV4cHJlc3Npb25zW2ldLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cbiAgICBpZiAodGhpcy50YWdnZWQpIHtcbiAgICAgIHZhciBmdW5jID0gdGhpcy50YWcuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICBpZiAodHlwZW9mIGZ1bmMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzWydnZXQnICsgdGhpcy5jb250ZXh0VHlwZSArICdDb250ZXh0J10oc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwuYXBwbHkoZnVuYywgW2NvbnRleHQsIHRoaXMuY29va2VkXS5jb25jYXQocmVzdWx0cykpO1xuICAgICAgfVxuICAgICAgaWYgKCFtdXN0RXZhbHVhdGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy50YWcgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSB0aGlzLmNvb2tlZFswXTtcbiAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCB0aGlzLmxlbmd0aDsgX2kyKyspIHtcbiAgICAgIHJlc3VsdCA9IFN0cmluZy5wcm90b3R5cGUuY29uY2F0KHJlc3VsdCwgcmVzdWx0c1tfaTJdLCB0aGlzLmNvb2tlZFtfaTIgKyAxXSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgTGl0ZXJhbFRlbXBsYXRlLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0TGl0ZXJhbFRlbXBsYXRlKHRoaXMpO1xuICB9O1xuXG4gIExpdGVyYWxUZW1wbGF0ZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuZXhwcmVzc2lvbnNbaV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnRhZ2dlZCkge1xuICAgICAgdGhpcy50YWcuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBMaXRlcmFsVGVtcGxhdGU7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIExpdGVyYWxBcnJheSA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE3KSB7XG4gIF9pbmhlcml0cyhMaXRlcmFsQXJyYXksIF9FeHByZXNzaW9uMTcpO1xuXG4gIGZ1bmN0aW9uIExpdGVyYWxBcnJheShlbGVtZW50cykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTkgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE3LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxOS5lbGVtZW50cyA9IGVsZW1lbnRzO1xuICAgIHJldHVybiBfdGhpczE5O1xuICB9XG5cbiAgTGl0ZXJhbEFycmF5LnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgZWxlbWVudHMgPSB0aGlzLmVsZW1lbnRzO1xuICAgIHZhciByZXN1bHQgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgcmVzdWx0W2ldID0gZWxlbWVudHNbaV0uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBMaXRlcmFsQXJyYXkucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRMaXRlcmFsQXJyYXkodGhpcyk7XG4gIH07XG5cbiAgTGl0ZXJhbEFycmF5LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHZhciBsZW5ndGggPSB0aGlzLmVsZW1lbnRzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmVsZW1lbnRzW2ldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gTGl0ZXJhbEFycmF5O1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBMaXRlcmFsT2JqZWN0ID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTgpIHtcbiAgX2luaGVyaXRzKExpdGVyYWxPYmplY3QsIF9FeHByZXNzaW9uMTgpO1xuXG4gIGZ1bmN0aW9uIExpdGVyYWxPYmplY3Qoa2V5cywgdmFsdWVzKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMyMCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTguY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczIwLmtleXMgPSBrZXlzO1xuICAgIF90aGlzMjAudmFsdWVzID0gdmFsdWVzO1xuICAgIHJldHVybiBfdGhpczIwO1xuICB9XG5cbiAgTGl0ZXJhbE9iamVjdC5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgdmFyIGluc3RhbmNlID0ge307XG4gICAgdmFyIGtleXMgPSB0aGlzLmtleXM7XG4gICAgdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgIGluc3RhbmNlW2tleXNbaV1dID0gdmFsdWVzW2ldLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cblxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfTtcblxuICBMaXRlcmFsT2JqZWN0LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0TGl0ZXJhbE9iamVjdCh0aGlzKTtcbiAgfTtcblxuICBMaXRlcmFsT2JqZWN0LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHZhciBsZW5ndGggPSB0aGlzLmtleXMubGVuZ3RoO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMudmFsdWVzW2ldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gTGl0ZXJhbE9iamVjdDtcbn0oRXhwcmVzc2lvbik7XG5cbmZ1bmN0aW9uIGV2YWxMaXN0KHNjb3BlLCBsaXN0LCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgdmFyIGxlbmd0aCA9IGxpc3QubGVuZ3RoO1xuICB2YXIgcmVzdWx0ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICByZXN1bHRbaV0gPSBsaXN0W2ldLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGF1dG9Db252ZXJ0QWRkKGEsIGIpIHtcbiAgaWYgKGEgIT09IG51bGwgJiYgYiAhPT0gbnVsbCkge1xuICAgIGlmICh0eXBlb2YgYSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGIgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gYSArIGIudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGEgIT09ICdzdHJpbmcnICYmIHR5cGVvZiBiID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGEudG9TdHJpbmcoKSArIGI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGEgKyBiO1xuICB9XG5cbiAgaWYgKGEgIT09IG51bGwpIHtcbiAgICByZXR1cm4gYTtcbiAgfVxuXG4gIGlmIChiICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIGI7XG4gIH1cblxuICByZXR1cm4gMDtcbn1cblxuZnVuY3Rpb24gZ2V0RnVuY3Rpb24ob2JqLCBuYW1lLCBtdXN0RXhpc3QpIHtcbiAgdmFyIGZ1bmMgPSBvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQgPyBudWxsIDogb2JqW25hbWVdO1xuICBpZiAodHlwZW9mIGZ1bmMgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZnVuYztcbiAgfVxuICBpZiAoIW11c3RFeGlzdCAmJiAoZnVuYyA9PT0gbnVsbCB8fCBmdW5jID09PSB1bmRlZmluZWQpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKG5hbWUgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG59XG5cbmZ1bmN0aW9uIGdldEtleWVkKG9iaiwga2V5KSB7XG4gIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICByZXR1cm4gb2JqW3BhcnNlSW50KGtleSwgMTApXTtcbiAgfSBlbHNlIGlmIChvYmopIHtcbiAgICByZXR1cm4gb2JqW2tleV07XG4gIH0gZWxzZSBpZiAob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHJldHVybiBvYmpba2V5XTtcbn1cblxuZnVuY3Rpb24gc2V0S2V5ZWQob2JqLCBrZXksIHZhbHVlKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICB2YXIgaW5kZXggPSBwYXJzZUludChrZXksIDEwKTtcblxuICAgIGlmIChvYmoubGVuZ3RoIDw9IGluZGV4KSB7XG4gICAgICBvYmoubGVuZ3RoID0gaW5kZXggKyAxO1xuICAgIH1cblxuICAgIG9ialtpbmRleF0gPSB2YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICBvYmpba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG52YXIgX1VucGFyc2VyID0gbnVsbDtcblxuZXhwb3J0IHsgX1VucGFyc2VyIGFzIFVucGFyc2VyIH07XG5pZiAodHlwZW9mIEZFQVRVUkVfTk9fVU5QQVJTRVIgPT09ICd1bmRlZmluZWQnKSB7XG4gIF9VbnBhcnNlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBVbnBhcnNlcihidWZmZXIpIHtcbiAgICAgIFxuXG4gICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICB9XG5cbiAgICBVbnBhcnNlci51bnBhcnNlID0gZnVuY3Rpb24gdW5wYXJzZShleHByZXNzaW9uKSB7XG4gICAgICB2YXIgYnVmZmVyID0gW107XG4gICAgICB2YXIgdmlzaXRvciA9IG5ldyBfVW5wYXJzZXIoYnVmZmVyKTtcblxuICAgICAgZXhwcmVzc2lvbi5hY2NlcHQodmlzaXRvcik7XG5cbiAgICAgIHJldHVybiBidWZmZXIuam9pbignJyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIHdyaXRlKHRleHQpIHtcbiAgICAgIHRoaXMuYnVmZmVyLnB1c2godGV4dCk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS53cml0ZUFyZ3MgPSBmdW5jdGlvbiB3cml0ZUFyZ3MoYXJncykge1xuICAgICAgdGhpcy53cml0ZSgnKCcpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJncy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICBpZiAoaSAhPT0gMCkge1xuICAgICAgICAgIHRoaXMud3JpdGUoJywnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFyZ3NbaV0uYWNjZXB0KHRoaXMpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndyaXRlKCcpJyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIHZpc2l0QmluZGluZ0JlaGF2aW9yKGJlaGF2aW9yKSB7XG4gICAgICB2YXIgYXJncyA9IGJlaGF2aW9yLmFyZ3M7XG5cbiAgICAgIGJlaGF2aW9yLmV4cHJlc3Npb24uYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnJicgKyBiZWhhdmlvci5uYW1lKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdGhpcy53cml0ZSgnOicpO1xuICAgICAgICBhcmdzW2ldLmFjY2VwdCh0aGlzKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0VmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiB2aXNpdFZhbHVlQ29udmVydGVyKGNvbnZlcnRlcikge1xuICAgICAgdmFyIGFyZ3MgPSBjb252ZXJ0ZXIuYXJncztcblxuICAgICAgY29udmVydGVyLmV4cHJlc3Npb24uYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnfCcgKyBjb252ZXJ0ZXIubmFtZSk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBhcmdzLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgIHRoaXMud3JpdGUoJzonKTtcbiAgICAgICAgYXJnc1tpXS5hY2NlcHQodGhpcyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEFzc2lnbiA9IGZ1bmN0aW9uIHZpc2l0QXNzaWduKGFzc2lnbikge1xuICAgICAgYXNzaWduLnRhcmdldC5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlKCc9Jyk7XG4gICAgICBhc3NpZ24udmFsdWUuYWNjZXB0KHRoaXMpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRDb25kaXRpb25hbCA9IGZ1bmN0aW9uIHZpc2l0Q29uZGl0aW9uYWwoY29uZGl0aW9uYWwpIHtcbiAgICAgIGNvbmRpdGlvbmFsLmNvbmRpdGlvbi5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlKCc/Jyk7XG4gICAgICBjb25kaXRpb25hbC55ZXMuYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnOicpO1xuICAgICAgY29uZGl0aW9uYWwubm8uYWNjZXB0KHRoaXMpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRBY2Nlc3NUaGlzID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NUaGlzKGFjY2Vzcykge1xuICAgICAgaWYgKGFjY2Vzcy5hbmNlc3RvciA9PT0gMCkge1xuICAgICAgICB0aGlzLndyaXRlKCckdGhpcycpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLndyaXRlKCckcGFyZW50Jyk7XG4gICAgICB2YXIgaSA9IGFjY2Vzcy5hbmNlc3RvciAtIDE7XG4gICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIHRoaXMud3JpdGUoJy4kcGFyZW50Jyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEFjY2Vzc1Njb3BlID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NTY29wZShhY2Nlc3MpIHtcbiAgICAgIHZhciBpID0gYWNjZXNzLmFuY2VzdG9yO1xuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICB0aGlzLndyaXRlKCckcGFyZW50LicpO1xuICAgICAgfVxuICAgICAgdGhpcy53cml0ZShhY2Nlc3MubmFtZSk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEFjY2Vzc01lbWJlciA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzTWVtYmVyKGFjY2Vzcykge1xuICAgICAgYWNjZXNzLm9iamVjdC5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlKCcuJyArIGFjY2Vzcy5uYW1lKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzS2V5ZWQgPSBmdW5jdGlvbiB2aXNpdEFjY2Vzc0tleWVkKGFjY2Vzcykge1xuICAgICAgYWNjZXNzLm9iamVjdC5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlKCdbJyk7XG4gICAgICBhY2Nlc3Mua2V5LmFjY2VwdCh0aGlzKTtcbiAgICAgIHRoaXMud3JpdGUoJ10nKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0Q2FsbFNjb3BlID0gZnVuY3Rpb24gdmlzaXRDYWxsU2NvcGUoY2FsbCkge1xuICAgICAgdmFyIGkgPSBjYWxsLmFuY2VzdG9yO1xuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICB0aGlzLndyaXRlKCckcGFyZW50LicpO1xuICAgICAgfVxuICAgICAgdGhpcy53cml0ZShjYWxsLm5hbWUpO1xuICAgICAgdGhpcy53cml0ZUFyZ3MoY2FsbC5hcmdzKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0Q2FsbEZ1bmN0aW9uID0gZnVuY3Rpb24gdmlzaXRDYWxsRnVuY3Rpb24oY2FsbCkge1xuICAgICAgY2FsbC5mdW5jLmFjY2VwdCh0aGlzKTtcbiAgICAgIHRoaXMud3JpdGVBcmdzKGNhbGwuYXJncyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdENhbGxNZW1iZXIgPSBmdW5jdGlvbiB2aXNpdENhbGxNZW1iZXIoY2FsbCkge1xuICAgICAgY2FsbC5vYmplY3QuYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnLicgKyBjYWxsLm5hbWUpO1xuICAgICAgdGhpcy53cml0ZUFyZ3MoY2FsbC5hcmdzKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0UHJlZml4ID0gZnVuY3Rpb24gdmlzaXRQcmVmaXgocHJlZml4KSB7XG4gICAgICB0aGlzLndyaXRlKCcoJyArIHByZWZpeC5vcGVyYXRpb24pO1xuICAgICAgaWYgKHByZWZpeC5vcGVyYXRpb24uY2hhckNvZGVBdCgwKSA+PSA5Nykge1xuICAgICAgICB0aGlzLndyaXRlKCcgJyk7XG4gICAgICB9XG4gICAgICBwcmVmaXguZXhwcmVzc2lvbi5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlKCcpJyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEJpbmFyeSA9IGZ1bmN0aW9uIHZpc2l0QmluYXJ5KGJpbmFyeSkge1xuICAgICAgYmluYXJ5LmxlZnQuYWNjZXB0KHRoaXMpO1xuICAgICAgaWYgKGJpbmFyeS5vcGVyYXRpb24uY2hhckNvZGVBdCgwKSA9PT0gMTA1KSB7XG4gICAgICAgIHRoaXMud3JpdGUoJyAnICsgYmluYXJ5Lm9wZXJhdGlvbiArICcgJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLndyaXRlKGJpbmFyeS5vcGVyYXRpb24pO1xuICAgICAgfVxuICAgICAgYmluYXJ5LnJpZ2h0LmFjY2VwdCh0aGlzKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbFByaW1pdGl2ZSA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbFByaW1pdGl2ZShsaXRlcmFsKSB7XG4gICAgICB0aGlzLndyaXRlKCcnICsgbGl0ZXJhbC52YWx1ZSk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdExpdGVyYWxBcnJheSA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbEFycmF5KGxpdGVyYWwpIHtcbiAgICAgIHZhciBlbGVtZW50cyA9IGxpdGVyYWwuZWxlbWVudHM7XG5cbiAgICAgIHRoaXMud3JpdGUoJ1snKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmIChpICE9PSAwKSB7XG4gICAgICAgICAgdGhpcy53cml0ZSgnLCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudHNbaV0uYWNjZXB0KHRoaXMpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndyaXRlKCddJyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdExpdGVyYWxPYmplY3QgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxPYmplY3QobGl0ZXJhbCkge1xuICAgICAgdmFyIGtleXMgPSBsaXRlcmFsLmtleXM7XG4gICAgICB2YXIgdmFsdWVzID0gbGl0ZXJhbC52YWx1ZXM7XG5cbiAgICAgIHRoaXMud3JpdGUoJ3snKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKGkgIT09IDApIHtcbiAgICAgICAgICB0aGlzLndyaXRlKCcsJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLndyaXRlKCdcXCcnICsga2V5c1tpXSArICdcXCc6Jyk7XG4gICAgICAgIHZhbHVlc1tpXS5hY2NlcHQodGhpcyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMud3JpdGUoJ30nKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbFN0cmluZyA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbFN0cmluZyhsaXRlcmFsKSB7XG4gICAgICB2YXIgZXNjYXBlZCA9IGxpdGVyYWwudmFsdWUucmVwbGFjZSgvJy9nLCBcIlxcJ1wiKTtcbiAgICAgIHRoaXMud3JpdGUoJ1xcJycgKyBlc2NhcGVkICsgJ1xcJycpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRMaXRlcmFsVGVtcGxhdGUgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxUZW1wbGF0ZShsaXRlcmFsKSB7XG4gICAgICB2YXIgY29va2VkID0gbGl0ZXJhbC5jb29rZWQsXG4gICAgICAgICAgZXhwcmVzc2lvbnMgPSBsaXRlcmFsLmV4cHJlc3Npb25zO1xuXG4gICAgICB2YXIgbGVuZ3RoID0gZXhwcmVzc2lvbnMubGVuZ3RoO1xuICAgICAgdGhpcy53cml0ZSgnYCcpO1xuICAgICAgdGhpcy53cml0ZShjb29rZWRbMF0pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBleHByZXNzaW9uc1tpXS5hY2NlcHQodGhpcyk7XG4gICAgICAgIHRoaXMud3JpdGUoY29va2VkW2kgKyAxXSk7XG4gICAgICB9XG4gICAgICB0aGlzLndyaXRlKCdgJyk7XG4gICAgfTtcblxuICAgIHJldHVybiBVbnBhcnNlcjtcbiAgfSgpO1xufVxuXG5leHBvcnQgdmFyIEV4cHJlc3Npb25DbG9uZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV4cHJlc3Npb25DbG9uZXIoKSB7XG4gICAgXG4gIH1cblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS5jbG9uZUV4cHJlc3Npb25BcnJheSA9IGZ1bmN0aW9uIGNsb25lRXhwcmVzc2lvbkFycmF5KGFycmF5KSB7XG4gICAgdmFyIGNsb25lZEFycmF5ID0gW107XG4gICAgdmFyIGkgPSBhcnJheS5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgY2xvbmVkQXJyYXlbaV0gPSBhcnJheVtpXS5hY2NlcHQodGhpcyk7XG4gICAgfVxuICAgIHJldHVybiBjbG9uZWRBcnJheTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIHZpc2l0QmluZGluZ0JlaGF2aW9yKGJlaGF2aW9yKSB7XG4gICAgcmV0dXJuIG5ldyBCaW5kaW5nQmVoYXZpb3IoYmVoYXZpb3IuZXhwcmVzc2lvbi5hY2NlcHQodGhpcyksIGJlaGF2aW9yLm5hbWUsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoYmVoYXZpb3IuYXJncykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0VmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiB2aXNpdFZhbHVlQ29udmVydGVyKGNvbnZlcnRlcikge1xuICAgIHJldHVybiBuZXcgVmFsdWVDb252ZXJ0ZXIoY29udmVydGVyLmV4cHJlc3Npb24uYWNjZXB0KHRoaXMpLCBjb252ZXJ0ZXIubmFtZSwgdGhpcy5jbG9uZUV4cHJlc3Npb25BcnJheShjb252ZXJ0ZXIuYXJncykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QXNzaWduID0gZnVuY3Rpb24gdmlzaXRBc3NpZ24oYXNzaWduKSB7XG4gICAgcmV0dXJuIG5ldyBBc3NpZ24oYXNzaWduLnRhcmdldC5hY2NlcHQodGhpcyksIGFzc2lnbi52YWx1ZS5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0Q29uZGl0aW9uYWwgPSBmdW5jdGlvbiB2aXNpdENvbmRpdGlvbmFsKGNvbmRpdGlvbmFsKSB7XG4gICAgcmV0dXJuIG5ldyBDb25kaXRpb25hbChjb25kaXRpb25hbC5jb25kaXRpb24uYWNjZXB0KHRoaXMpLCBjb25kaXRpb25hbC55ZXMuYWNjZXB0KHRoaXMpLCBjb25kaXRpb25hbC5uby5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzVGhpcyA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzVGhpcyhhY2Nlc3MpIHtcbiAgICByZXR1cm4gbmV3IEFjY2Vzc1RoaXMoYWNjZXNzLmFuY2VzdG9yKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFjY2Vzc1Njb3BlID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NTY29wZShhY2Nlc3MpIHtcbiAgICByZXR1cm4gbmV3IEFjY2Vzc1Njb3BlKGFjY2Vzcy5uYW1lLCBhY2Nlc3MuYW5jZXN0b3IpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzTWVtYmVyID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NNZW1iZXIoYWNjZXNzKSB7XG4gICAgcmV0dXJuIG5ldyBBY2Nlc3NNZW1iZXIoYWNjZXNzLm9iamVjdC5hY2NlcHQodGhpcyksIGFjY2Vzcy5uYW1lKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFjY2Vzc0tleWVkID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NLZXllZChhY2Nlc3MpIHtcbiAgICByZXR1cm4gbmV3IEFjY2Vzc0tleWVkKGFjY2Vzcy5vYmplY3QuYWNjZXB0KHRoaXMpLCBhY2Nlc3Mua2V5LmFjY2VwdCh0aGlzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRDYWxsU2NvcGUgPSBmdW5jdGlvbiB2aXNpdENhbGxTY29wZShjYWxsKSB7XG4gICAgcmV0dXJuIG5ldyBDYWxsU2NvcGUoY2FsbC5uYW1lLCB0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGNhbGwuYXJncyksIGNhbGwuYW5jZXN0b3IpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0Q2FsbEZ1bmN0aW9uID0gZnVuY3Rpb24gdmlzaXRDYWxsRnVuY3Rpb24oY2FsbCkge1xuICAgIHJldHVybiBuZXcgQ2FsbEZ1bmN0aW9uKGNhbGwuZnVuYy5hY2NlcHQodGhpcyksIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoY2FsbC5hcmdzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRDYWxsTWVtYmVyID0gZnVuY3Rpb24gdmlzaXRDYWxsTWVtYmVyKGNhbGwpIHtcbiAgICByZXR1cm4gbmV3IENhbGxNZW1iZXIoY2FsbC5vYmplY3QuYWNjZXB0KHRoaXMpLCBjYWxsLm5hbWUsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoY2FsbC5hcmdzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRVbmFyeSA9IGZ1bmN0aW9uIHZpc2l0VW5hcnkodW5hcnkpIHtcbiAgICByZXR1cm4gbmV3IFVuYXJ5KHByZWZpeC5vcGVyYXRpb24sIHByZWZpeC5leHByZXNzaW9uLmFjY2VwdCh0aGlzKSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRCaW5hcnkgPSBmdW5jdGlvbiB2aXNpdEJpbmFyeShiaW5hcnkpIHtcbiAgICByZXR1cm4gbmV3IEJpbmFyeShiaW5hcnkub3BlcmF0aW9uLCBiaW5hcnkubGVmdC5hY2NlcHQodGhpcyksIGJpbmFyeS5yaWdodC5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbFByaW1pdGl2ZSA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbFByaW1pdGl2ZShsaXRlcmFsKSB7XG4gICAgcmV0dXJuIG5ldyBMaXRlcmFsUHJpbWl0aXZlKGxpdGVyYWwpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbEFycmF5ID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsQXJyYXkobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbEFycmF5KHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkobGl0ZXJhbC5lbGVtZW50cykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbE9iamVjdCA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbE9iamVjdChsaXRlcmFsKSB7XG4gICAgcmV0dXJuIG5ldyBMaXRlcmFsT2JqZWN0KGxpdGVyYWwua2V5cywgdGhpcy5jbG9uZUV4cHJlc3Npb25BcnJheShsaXRlcmFsLnZhbHVlcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbFN0cmluZyA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbFN0cmluZyhsaXRlcmFsKSB7XG4gICAgcmV0dXJuIG5ldyBMaXRlcmFsU3RyaW5nKGxpdGVyYWwudmFsdWUpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbFRlbXBsYXRlID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsVGVtcGxhdGUobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbFRlbXBsYXRlKGxpdGVyYWwuY29va2VkLCB0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGxpdGVyYWwuZXhwcmVzc2lvbnMpLCBsaXRlcmFsLnJhdywgbGl0ZXJhbC50YWcgJiYgbGl0ZXJhbC50YWcuYWNjZXB0KHRoaXMpKTtcbiAgfTtcblxuICByZXR1cm4gRXhwcmVzc2lvbkNsb25lcjtcbn0oKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNsb25lRXhwcmVzc2lvbihleHByZXNzaW9uKSB7XG4gIHZhciB2aXNpdG9yID0gbmV3IEV4cHJlc3Npb25DbG9uZXIoKTtcbiAgcmV0dXJuIGV4cHJlc3Npb24uYWNjZXB0KHZpc2l0b3IpO1xufVxuXG5leHBvcnQgdmFyIGJpbmRpbmdNb2RlID0ge1xuICBvbmVUaW1lOiAwLFxuICB0b1ZpZXc6IDEsXG4gIG9uZVdheTogMSxcbiAgdHdvV2F5OiAyLFxuICBmcm9tVmlldzogM1xufTtcblxuZXhwb3J0IHZhciBQYXJzZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFBhcnNlcigpIHtcbiAgICBcblxuICAgIHRoaXMuY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB9XG5cbiAgUGFyc2VyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIHBhcnNlKHNyYykge1xuICAgIHNyYyA9IHNyYyB8fCAnJztcblxuICAgIHJldHVybiB0aGlzLmNhY2hlW3NyY10gfHwgKHRoaXMuY2FjaGVbc3JjXSA9IG5ldyBQYXJzZXJJbXBsZW1lbnRhdGlvbihzcmMpLnBhcnNlQmluZGluZ0JlaGF2aW9yKCkpO1xuICB9O1xuXG4gIHJldHVybiBQYXJzZXI7XG59KCk7XG5cbnZhciBmcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlO1xuXG5leHBvcnQgdmFyIFBhcnNlckltcGxlbWVudGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICBfY3JlYXRlQ2xhc3MoUGFyc2VySW1wbGVtZW50YXRpb24sIFt7XG4gICAga2V5OiAncmF3JyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNyYy5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLmlkeCk7XG4gICAgfVxuICB9XSk7XG5cbiAgZnVuY3Rpb24gUGFyc2VySW1wbGVtZW50YXRpb24oc3JjKSB7XG4gICAgXG5cbiAgICB0aGlzLmlkeCA9IDA7XG5cbiAgICB0aGlzLnN0YXJ0ID0gMDtcblxuICAgIHRoaXMuc3JjID0gc3JjO1xuICAgIHRoaXMubGVuID0gc3JjLmxlbmd0aDtcblxuICAgIHRoaXMudGtuID0gVCRFT0Y7XG5cbiAgICB0aGlzLnZhbCA9IHVuZGVmaW5lZDtcblxuICAgIHRoaXMuY2ggPSBzcmMuY2hhckNvZGVBdCgwKTtcbiAgfVxuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIHBhcnNlQmluZGluZ0JlaGF2aW9yKCkge1xuICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgaWYgKHRoaXMudGtuICYgVCRFeHByZXNzaW9uVGVybWluYWwpIHtcbiAgICAgIHRoaXMuZXJyKCdJbnZhbGlkIHN0YXJ0IG9mIGV4cHJlc3Npb24nKTtcbiAgICB9XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VWYWx1ZUNvbnZlcnRlcigpO1xuICAgIHdoaWxlICh0aGlzLm9wdChUJEFtcGVyc2FuZCkpIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBCaW5kaW5nQmVoYXZpb3IocmVzdWx0LCB0aGlzLnZhbCwgdGhpcy5wYXJzZVZhcmlhZGljQXJncygpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudGtuICE9PSBUJEVPRikge1xuICAgICAgdGhpcy5lcnIoJ1VuY29uc3VtZWQgdG9rZW4gJyArIHRoaXMucmF3KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIHBhcnNlVmFsdWVDb252ZXJ0ZXIoKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gICAgd2hpbGUgKHRoaXMub3B0KFQkQmFyKSkge1xuICAgICAgcmVzdWx0ID0gbmV3IFZhbHVlQ29udmVydGVyKHJlc3VsdCwgdGhpcy52YWwsIHRoaXMucGFyc2VWYXJpYWRpY0FyZ3MoKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlVmFyaWFkaWNBcmdzID0gZnVuY3Rpb24gcGFyc2VWYXJpYWRpY0FyZ3MoKSB7XG4gICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgd2hpbGUgKHRoaXMub3B0KFQkQ29sb24pKSB7XG4gICAgICByZXN1bHQucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VFeHByZXNzaW9uID0gZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uKCkge1xuICAgIHZhciBleHByU3RhcnQgPSB0aGlzLmlkeDtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5wYXJzZUNvbmRpdGlvbmFsKCk7XG5cbiAgICB3aGlsZSAodGhpcy50a24gPT09IFQkRXEpIHtcbiAgICAgIGlmICghcmVzdWx0LmlzQXNzaWduYWJsZSkge1xuICAgICAgICB0aGlzLmVycignRXhwcmVzc2lvbiAnICsgdGhpcy5zcmMuc2xpY2UoZXhwclN0YXJ0LCB0aGlzLnN0YXJ0KSArICcgaXMgbm90IGFzc2lnbmFibGUnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICBleHByU3RhcnQgPSB0aGlzLmlkeDtcbiAgICAgIHJlc3VsdCA9IG5ldyBBc3NpZ24ocmVzdWx0LCB0aGlzLnBhcnNlQ29uZGl0aW9uYWwoKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlQ29uZGl0aW9uYWwgPSBmdW5jdGlvbiBwYXJzZUNvbmRpdGlvbmFsKCkge1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnBhcnNlQmluYXJ5KDApO1xuXG4gICAgaWYgKHRoaXMub3B0KFQkUXVlc3Rpb24pKSB7XG4gICAgICB2YXIgeWVzID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgIHRoaXMuZXhwZWN0KFQkQ29sb24pO1xuICAgICAgcmVzdWx0ID0gbmV3IENvbmRpdGlvbmFsKHJlc3VsdCwgeWVzLCB0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VCaW5hcnkgPSBmdW5jdGlvbiBwYXJzZUJpbmFyeShtaW5QcmVjZWRlbmNlKSB7XG4gICAgdmFyIGxlZnQgPSB0aGlzLnBhcnNlTGVmdEhhbmRTaWRlKDApO1xuXG4gICAgd2hpbGUgKHRoaXMudGtuICYgVCRCaW5hcnlPcCkge1xuICAgICAgdmFyIG9wVG9rZW4gPSB0aGlzLnRrbjtcbiAgICAgIGlmICgob3BUb2tlbiAmIFQkUHJlY2VkZW5jZSkgPD0gbWluUHJlY2VkZW5jZSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICBsZWZ0ID0gbmV3IEJpbmFyeShUb2tlblZhbHVlc1tvcFRva2VuICYgVCRUb2tlbk1hc2tdLCBsZWZ0LCB0aGlzLnBhcnNlQmluYXJ5KG9wVG9rZW4gJiBUJFByZWNlZGVuY2UpKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlZnQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlTGVmdEhhbmRTaWRlID0gZnVuY3Rpb24gcGFyc2VMZWZ0SGFuZFNpZGUoY29udGV4dCkge1xuICAgIHZhciByZXN1bHQgPSB2b2lkIDA7XG5cbiAgICBwcmltYXJ5OiBzd2l0Y2ggKHRoaXMudGtuKSB7XG4gICAgICBjYXNlIFQkUGx1czpcbiAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VMZWZ0SGFuZFNpZGUoMCk7XG4gICAgICBjYXNlIFQkTWludXM6XG4gICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgIHJldHVybiBuZXcgQmluYXJ5KCctJywgbmV3IExpdGVyYWxQcmltaXRpdmUoMCksIHRoaXMucGFyc2VMZWZ0SGFuZFNpZGUoMCkpO1xuICAgICAgY2FzZSBUJEJhbmc6XG4gICAgICBjYXNlIFQkVHlwZW9mS2V5d29yZDpcbiAgICAgIGNhc2UgVCRWb2lkS2V5d29yZDpcbiAgICAgICAgdmFyIG9wID0gVG9rZW5WYWx1ZXNbdGhpcy50a24gJiBUJFRva2VuTWFza107XG4gICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgIHJldHVybiBuZXcgVW5hcnkob3AsIHRoaXMucGFyc2VMZWZ0SGFuZFNpZGUoMCkpO1xuICAgICAgY2FzZSBUJFBhcmVudFNjb3BlOlxuICAgICAgICB7XG4gICAgICAgICAgZG8ge1xuICAgICAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgICAgIGNvbnRleHQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdChUJFBlcmlvZCkpIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMudGtuID09PSBUJFBlcmlvZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGtuICYgVCRBY2Nlc3NTY29wZVRlcm1pbmFsKSB7XG4gICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NUaGlzKGNvbnRleHQgJiBDJEFuY2VzdG9yKTtcblxuICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCAmIEMkU2hvcnRoYW5kUHJvcCB8IEMkVGhpcztcbiAgICAgICAgICAgICAgYnJlYWsgcHJpbWFyeTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuZXJyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSB3aGlsZSAodGhpcy50a24gPT09IFQkUGFyZW50U2NvcGUpO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgVCRJZGVudGlmaWVyOlxuICAgICAgICB7XG4gICAgICAgICAgcmVzdWx0ID0gbmV3IEFjY2Vzc1Njb3BlKHRoaXMudmFsLCBjb250ZXh0ICYgQyRBbmNlc3Rvcik7XG4gICAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCAmIEMkU2hvcnRoYW5kUHJvcCB8IEMkU2NvcGU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgVCRUaGlzU2NvcGU6XG4gICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NUaGlzKDApO1xuICAgICAgICBjb250ZXh0ID0gY29udGV4dCAmIEMkU2hvcnRoYW5kUHJvcCB8IEMkVGhpcztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFQkTFBhcmVuOlxuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICByZXN1bHQgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpO1xuICAgICAgICB0aGlzLmV4cGVjdChUJFJQYXJlbik7XG4gICAgICAgIGNvbnRleHQgPSBDJFByaW1hcnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUJExCcmFja2V0OlxuICAgICAgICB7XG4gICAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgICB2YXIgX2VsZW1lbnRzID0gW107XG4gICAgICAgICAgaWYgKHRoaXMudGtuICE9PSBUJFJCcmFja2V0KSB7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgIF9lbGVtZW50cy5wdXNoKHRoaXMucGFyc2VFeHByZXNzaW9uKCkpO1xuICAgICAgICAgICAgfSB3aGlsZSAodGhpcy5vcHQoVCRDb21tYSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmV4cGVjdChUJFJCcmFja2V0KTtcbiAgICAgICAgICByZXN1bHQgPSBuZXcgTGl0ZXJhbEFycmF5KF9lbGVtZW50cyk7XG4gICAgICAgICAgY29udGV4dCA9IEMkUHJpbWFyeTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgY2FzZSBUJExCcmFjZTpcbiAgICAgICAge1xuICAgICAgICAgIHZhciBrZXlzID0gW107XG4gICAgICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgd2hpbGUgKHRoaXMudGtuICE9PSBUJFJCcmFjZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMudGtuICYgVCRJZGVudGlmaWVyT3JLZXl3b3JkKSB7XG4gICAgICAgICAgICAgIHZhciBjaCA9IHRoaXMuY2gsXG4gICAgICAgICAgICAgICAgICB0a24gPSB0aGlzLnRrbixcbiAgICAgICAgICAgICAgICAgIGlkeCA9IHRoaXMuaWR4O1xuXG4gICAgICAgICAgICAgIGtleXMucHVzaCh0aGlzLnZhbCk7XG4gICAgICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgICAgIGlmICh0aGlzLm9wdChUJENvbG9uKSkge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHRoaXMucGFyc2VFeHByZXNzaW9uKCkpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2ggPSBjaDtcbiAgICAgICAgICAgICAgICB0aGlzLnRrbiA9IHRrbjtcbiAgICAgICAgICAgICAgICB0aGlzLmlkeCA9IGlkeDtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh0aGlzLnBhcnNlTGVmdEhhbmRTaWRlKEMkU2hvcnRoYW5kUHJvcCkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGtuICYgVCRMaXRlcmFsKSB7XG4gICAgICAgICAgICAgIGtleXMucHVzaCh0aGlzLnZhbCk7XG4gICAgICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgICAgIHRoaXMuZXhwZWN0KFQkQ29sb24pO1xuICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuZXJyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy50a24gIT09IFQkUkJyYWNlKSB7XG4gICAgICAgICAgICAgIHRoaXMuZXhwZWN0KFQkQ29tbWEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmV4cGVjdChUJFJCcmFjZSk7XG4gICAgICAgICAgcmVzdWx0ID0gbmV3IExpdGVyYWxPYmplY3Qoa2V5cywgdmFsdWVzKTtcbiAgICAgICAgICBjb250ZXh0ID0gQyRQcmltYXJ5O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICBjYXNlIFQkU3RyaW5nTGl0ZXJhbDpcbiAgICAgICAgcmVzdWx0ID0gbmV3IExpdGVyYWxTdHJpbmcodGhpcy52YWwpO1xuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICBjb250ZXh0ID0gQyRQcmltYXJ5O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVCRUZW1wbGF0ZVRhaWw6XG4gICAgICAgIHJlc3VsdCA9IG5ldyBMaXRlcmFsVGVtcGxhdGUoW3RoaXMudmFsXSk7XG4gICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgIGNvbnRleHQgPSBDJFByaW1hcnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUJFRlbXBsYXRlQ29udGludWF0aW9uOlxuICAgICAgICByZXN1bHQgPSB0aGlzLnBhcnNlVGVtcGxhdGUoMCk7XG4gICAgICAgIGNvbnRleHQgPSBDJFByaW1hcnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUJE51bWVyaWNMaXRlcmFsOlxuICAgICAgICB7XG4gICAgICAgICAgcmVzdWx0ID0gbmV3IExpdGVyYWxQcmltaXRpdmUodGhpcy52YWwpO1xuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG5cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgY2FzZSBUJE51bGxLZXl3b3JkOlxuICAgICAgY2FzZSBUJFVuZGVmaW5lZEtleXdvcmQ6XG4gICAgICBjYXNlIFQkVHJ1ZUtleXdvcmQ6XG4gICAgICBjYXNlIFQkRmFsc2VLZXl3b3JkOlxuICAgICAgICByZXN1bHQgPSBuZXcgTGl0ZXJhbFByaW1pdGl2ZShUb2tlblZhbHVlc1t0aGlzLnRrbiAmIFQkVG9rZW5NYXNrXSk7XG4gICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgIGNvbnRleHQgPSBDJFByaW1hcnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKHRoaXMuaWR4ID49IHRoaXMubGVuKSB7XG4gICAgICAgICAgdGhpcy5lcnIoJ1VuZXhwZWN0ZWQgZW5kIG9mIGV4cHJlc3Npb24nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmVycigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQgJiBDJFNob3J0aGFuZFByb3ApIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgdmFyIG5hbWUgPSB0aGlzLnZhbDtcbiAgICB3aGlsZSAodGhpcy50a24gJiBUJE1lbWJlck9yQ2FsbEV4cHJlc3Npb24pIHtcbiAgICAgIHN3aXRjaCAodGhpcy50a24pIHtcbiAgICAgICAgY2FzZSBUJFBlcmlvZDpcbiAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICAgIGlmICghKHRoaXMudGtuICYgVCRJZGVudGlmaWVyT3JLZXl3b3JkKSkge1xuICAgICAgICAgICAgdGhpcy5lcnIoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbmFtZSA9IHRoaXMudmFsO1xuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG5cbiAgICAgICAgICBjb250ZXh0ID0gY29udGV4dCAmIEMkUHJpbWFyeSB8IChjb250ZXh0ICYgKEMkVGhpcyB8IEMkU2NvcGUpKSA8PCAxIHwgY29udGV4dCAmIEMkTWVtYmVyIHwgKGNvbnRleHQgJiBDJEtleWVkKSA+PiAxIHwgKGNvbnRleHQgJiBDJENhbGwpID4+IDI7XG4gICAgICAgICAgaWYgKHRoaXMudGtuID09PSBUJExQYXJlbikge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjb250ZXh0ICYgQyRTY29wZSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IEFjY2Vzc1Njb3BlKG5hbWUsIHJlc3VsdC5hbmNlc3Rvcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NNZW1iZXIocmVzdWx0LCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIGNhc2UgVCRMQnJhY2tldDpcbiAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICAgIGNvbnRleHQgPSBDJEtleWVkO1xuICAgICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NLZXllZChyZXN1bHQsIHRoaXMucGFyc2VFeHByZXNzaW9uKCkpO1xuICAgICAgICAgIHRoaXMuZXhwZWN0KFQkUkJyYWNrZXQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFQkTFBhcmVuOlxuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgICB3aGlsZSAodGhpcy50a24gIT09IFQkUlBhcmVuKSB7XG4gICAgICAgICAgICBhcmdzLnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0KFQkQ29tbWEpKSB7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmV4cGVjdChUJFJQYXJlbik7XG4gICAgICAgICAgaWYgKGNvbnRleHQgJiBDJFNjb3BlKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBuZXcgQ2FsbFNjb3BlKG5hbWUsIGFyZ3MsIHJlc3VsdC5hbmNlc3Rvcik7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0ICYgKEMkTWVtYmVyIHwgQyRQcmltYXJ5KSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IENhbGxNZW1iZXIocmVzdWx0LCBuYW1lLCBhcmdzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IENhbGxGdW5jdGlvbihyZXN1bHQsIGFyZ3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb250ZXh0ID0gQyRDYWxsO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFQkVGVtcGxhdGVUYWlsOlxuICAgICAgICAgIHJlc3VsdCA9IG5ldyBMaXRlcmFsVGVtcGxhdGUoW3RoaXMudmFsXSwgW10sIFt0aGlzLnJhd10sIHJlc3VsdCk7XG4gICAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBUJFRlbXBsYXRlQ29udGludWF0aW9uOlxuICAgICAgICAgIHJlc3VsdCA9IHRoaXMucGFyc2VUZW1wbGF0ZShjb250ZXh0IHwgQyRUYWdnZWQsIHJlc3VsdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VUZW1wbGF0ZSA9IGZ1bmN0aW9uIHBhcnNlVGVtcGxhdGUoY29udGV4dCwgZnVuYykge1xuICAgIHZhciBjb29rZWQgPSBbdGhpcy52YWxdO1xuICAgIHZhciByYXcgPSBjb250ZXh0ICYgQyRUYWdnZWQgPyBbdGhpcy5yYXddIDogdW5kZWZpbmVkO1xuICAgIHRoaXMuZXhwZWN0KFQkVGVtcGxhdGVDb250aW51YXRpb24pO1xuICAgIHZhciBleHByZXNzaW9ucyA9IFt0aGlzLnBhcnNlRXhwcmVzc2lvbigpXTtcblxuICAgIHdoaWxlICgodGhpcy50a24gPSB0aGlzLnNjYW5UZW1wbGF0ZVRhaWwoKSkgIT09IFQkVGVtcGxhdGVUYWlsKSB7XG4gICAgICBjb29rZWQucHVzaCh0aGlzLnZhbCk7XG4gICAgICBpZiAoY29udGV4dCAmIEMkVGFnZ2VkKSB7XG4gICAgICAgIHJhdy5wdXNoKHRoaXMucmF3KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZXhwZWN0KFQkVGVtcGxhdGVDb250aW51YXRpb24pO1xuICAgICAgZXhwcmVzc2lvbnMucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICB9XG5cbiAgICBjb29rZWQucHVzaCh0aGlzLnZhbCk7XG4gICAgaWYgKGNvbnRleHQgJiBDJFRhZ2dlZCkge1xuICAgICAgcmF3LnB1c2godGhpcy5yYXcpO1xuICAgIH1cbiAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbFRlbXBsYXRlKGNvb2tlZCwgZXhwcmVzc2lvbnMsIHJhdywgZnVuYyk7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLm5leHRUb2tlbiA9IGZ1bmN0aW9uIG5leHRUb2tlbigpIHtcbiAgICB3aGlsZSAodGhpcy5pZHggPCB0aGlzLmxlbikge1xuICAgICAgaWYgKHRoaXMuY2ggPD0gMHgyMCkge1xuICAgICAgICB0aGlzLm5leHQoKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0aGlzLnN0YXJ0ID0gdGhpcy5pZHg7XG4gICAgICBpZiAodGhpcy5jaCA9PT0gMHgyNCB8fCB0aGlzLmNoID49IDB4NjEgJiYgdGhpcy5jaCA8PSAweDdBKSB7XG4gICAgICAgIHRoaXMudGtuID0gdGhpcy5zY2FuSWRlbnRpZmllcigpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICgodGhpcy50a24gPSBDaGFyU2Nhbm5lcnNbdGhpcy5jaF0odGhpcykpICE9PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy50a24gPSBUJEVPRjtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2ggPSB0aGlzLnNyYy5jaGFyQ29kZUF0KCsrdGhpcy5pZHgpO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5zY2FuSWRlbnRpZmllciA9IGZ1bmN0aW9uIHNjYW5JZGVudGlmaWVyKCkge1xuICAgIHdoaWxlIChBc2NpaUlkUGFydHMuaGFzKHRoaXMubmV4dCgpKSB8fCB0aGlzLmNoID4gMHg3RiAmJiBJZFBhcnRzW3RoaXMuY2hdKSB7fVxuXG4gICAgcmV0dXJuIEtleXdvcmRMb29rdXBbdGhpcy52YWwgPSB0aGlzLnJhd10gfHwgVCRJZGVudGlmaWVyO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5zY2FuTnVtYmVyID0gZnVuY3Rpb24gc2Nhbk51bWJlcihpc0Zsb2F0KSB7XG4gICAgaWYgKGlzRmxvYXQpIHtcbiAgICAgIHRoaXMudmFsID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52YWwgPSB0aGlzLmNoIC0gMHgzMDtcbiAgICAgIHdoaWxlICh0aGlzLm5leHQoKSA8PSAweDM5ICYmIHRoaXMuY2ggPj0gMHgzMCkge1xuICAgICAgICB0aGlzLnZhbCA9IHRoaXMudmFsICogMTAgKyB0aGlzLmNoIC0gMHgzMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoaXNGbG9hdCB8fCB0aGlzLmNoID09PSAweDJFKSB7XG4gICAgICBpZiAoIWlzRmxvYXQpIHtcbiAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICB9XG4gICAgICB2YXIgc3RhcnQgPSB0aGlzLmlkeDtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuY2ggLSAweDMwO1xuICAgICAgd2hpbGUgKHRoaXMubmV4dCgpIDw9IDB4MzkgJiYgdGhpcy5jaCA+PSAweDMwKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUgKiAxMCArIHRoaXMuY2ggLSAweDMwO1xuICAgICAgfVxuICAgICAgdGhpcy52YWwgPSB0aGlzLnZhbCArIHZhbHVlIC8gTWF0aC5wb3coMTAsIHRoaXMuaWR4IC0gc3RhcnQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNoID09PSAweDY1IHx8IHRoaXMuY2ggPT09IDB4NDUpIHtcbiAgICAgIHZhciBfc3RhcnQgPSB0aGlzLmlkeDtcblxuICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICBpZiAodGhpcy5jaCA9PT0gMHgyRCB8fCB0aGlzLmNoID09PSAweDJCKSB7XG4gICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoISh0aGlzLmNoID49IDB4MzAgJiYgdGhpcy5jaCA8PSAweDM5KSkge1xuICAgICAgICB0aGlzLmlkeCA9IF9zdGFydDtcbiAgICAgICAgdGhpcy5lcnIoJ0ludmFsaWQgZXhwb25lbnQnKTtcbiAgICAgIH1cbiAgICAgIHdoaWxlICh0aGlzLm5leHQoKSA8PSAweDM5ICYmIHRoaXMuY2ggPj0gMHgzMCkge31cbiAgICAgIHRoaXMudmFsID0gcGFyc2VGbG9hdCh0aGlzLnNyYy5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLmlkeCkpO1xuICAgIH1cblxuICAgIHJldHVybiBUJE51bWVyaWNMaXRlcmFsO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5zY2FuU3RyaW5nID0gZnVuY3Rpb24gc2NhblN0cmluZygpIHtcbiAgICB2YXIgcXVvdGUgPSB0aGlzLmNoO1xuICAgIHRoaXMubmV4dCgpO1xuXG4gICAgdmFyIGJ1ZmZlciA9IHZvaWQgMDtcbiAgICB2YXIgbWFya2VyID0gdGhpcy5pZHg7XG5cbiAgICB3aGlsZSAodGhpcy5jaCAhPT0gcXVvdGUpIHtcbiAgICAgIGlmICh0aGlzLmNoID09PSAweDVDKSB7XG4gICAgICAgIGlmICghYnVmZmVyKSB7XG4gICAgICAgICAgYnVmZmVyID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBidWZmZXIucHVzaCh0aGlzLnNyYy5zbGljZShtYXJrZXIsIHRoaXMuaWR4KSk7XG5cbiAgICAgICAgdGhpcy5uZXh0KCk7XG5cbiAgICAgICAgdmFyIF91bmVzY2FwZWQgPSB2b2lkIDA7XG5cbiAgICAgICAgaWYgKHRoaXMuY2ggPT09IDB4NzUpIHtcbiAgICAgICAgICB0aGlzLm5leHQoKTtcblxuICAgICAgICAgIGlmICh0aGlzLmlkeCArIDQgPCB0aGlzLmxlbikge1xuICAgICAgICAgICAgdmFyIGhleCA9IHRoaXMuc3JjLnNsaWNlKHRoaXMuaWR4LCB0aGlzLmlkeCArIDQpO1xuXG4gICAgICAgICAgICBpZiAoIS9bQS1aMC05XXs0fS9pLnRlc3QoaGV4KSkge1xuICAgICAgICAgICAgICB0aGlzLmVycignSW52YWxpZCB1bmljb2RlIGVzY2FwZSBbXFxcXHUnICsgaGV4ICsgJ10nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX3VuZXNjYXBlZCA9IHBhcnNlSW50KGhleCwgMTYpO1xuICAgICAgICAgICAgdGhpcy5pZHggKz0gNDtcbiAgICAgICAgICAgIHRoaXMuY2ggPSB0aGlzLnNyYy5jaGFyQ29kZUF0KHRoaXMuaWR4KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lcnIoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgX3VuZXNjYXBlZCA9IHVuZXNjYXBlKHRoaXMuY2gpO1xuICAgICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgYnVmZmVyLnB1c2goZnJvbUNoYXJDb2RlKF91bmVzY2FwZWQpKTtcbiAgICAgICAgbWFya2VyID0gdGhpcy5pZHg7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY2ggPT09IDAgfHwgdGhpcy5pZHggPj0gdGhpcy5sZW4pIHtcbiAgICAgICAgdGhpcy5lcnIoJ1VudGVybWluYXRlZCBxdW90ZScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGxhc3QgPSB0aGlzLnNyYy5zbGljZShtYXJrZXIsIHRoaXMuaWR4KTtcbiAgICB0aGlzLm5leHQoKTtcbiAgICB2YXIgdW5lc2NhcGVkID0gbGFzdDtcblxuICAgIGlmIChidWZmZXIgIT09IG51bGwgJiYgYnVmZmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGJ1ZmZlci5wdXNoKGxhc3QpO1xuICAgICAgdW5lc2NhcGVkID0gYnVmZmVyLmpvaW4oJycpO1xuICAgIH1cblxuICAgIHRoaXMudmFsID0gdW5lc2NhcGVkO1xuICAgIHJldHVybiBUJFN0cmluZ0xpdGVyYWw7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnNjYW5UZW1wbGF0ZSA9IGZ1bmN0aW9uIHNjYW5UZW1wbGF0ZSgpIHtcbiAgICB2YXIgdGFpbCA9IHRydWU7XG4gICAgdmFyIHJlc3VsdCA9ICcnO1xuXG4gICAgd2hpbGUgKHRoaXMubmV4dCgpICE9PSAweDYwKSB7XG4gICAgICBpZiAodGhpcy5jaCA9PT0gMHgyNCkge1xuICAgICAgICBpZiAodGhpcy5pZHggKyAxIDwgdGhpcy5sZW4gJiYgdGhpcy5zcmMuY2hhckNvZGVBdCh0aGlzLmlkeCArIDEpID09PSAweDdCKSB7XG4gICAgICAgICAgdGhpcy5pZHgrKztcbiAgICAgICAgICB0YWlsID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ICs9ICckJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNoID09PSAweDVDKSB7XG4gICAgICAgIHJlc3VsdCArPSBmcm9tQ2hhckNvZGUodW5lc2NhcGUodGhpcy5uZXh0KCkpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaCA9PT0gMCB8fCB0aGlzLmlkeCA+PSB0aGlzLmxlbikge1xuICAgICAgICB0aGlzLmVycignVW50ZXJtaW5hdGVkIHRlbXBsYXRlIGxpdGVyYWwnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCArPSBmcm9tQ2hhckNvZGUodGhpcy5jaCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5uZXh0KCk7XG4gICAgdGhpcy52YWwgPSByZXN1bHQ7XG4gICAgaWYgKHRhaWwpIHtcbiAgICAgIHJldHVybiBUJFRlbXBsYXRlVGFpbDtcbiAgICB9XG4gICAgcmV0dXJuIFQkVGVtcGxhdGVDb250aW51YXRpb247XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnNjYW5UZW1wbGF0ZVRhaWwgPSBmdW5jdGlvbiBzY2FuVGVtcGxhdGVUYWlsKCkge1xuICAgIGlmICh0aGlzLmlkeCA+PSB0aGlzLmxlbikge1xuICAgICAgdGhpcy5lcnIoJ1VudGVybWluYXRlZCB0ZW1wbGF0ZScpO1xuICAgIH1cbiAgICB0aGlzLmlkeC0tO1xuICAgIHJldHVybiB0aGlzLnNjYW5UZW1wbGF0ZSgpO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5lcnIgPSBmdW5jdGlvbiBlcnIoKSB7XG4gICAgdmFyIG1lc3NhZ2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICdVbmV4cGVjdGVkIHRva2VuICcgKyB0aGlzLnJhdztcbiAgICB2YXIgY29sdW1uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnN0YXJ0O1xuXG4gICAgdGhyb3cgbmV3IEVycm9yKCdQYXJzZXIgRXJyb3I6ICcgKyBtZXNzYWdlICsgJyBhdCBjb2x1bW4gJyArIGNvbHVtbiArICcgaW4gZXhwcmVzc2lvbiBbJyArIHRoaXMuc3JjICsgJ10nKTtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUub3B0ID0gZnVuY3Rpb24gb3B0KHRva2VuKSB7XG4gICAgaWYgKHRoaXMudGtuID09PSB0b2tlbikge1xuICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuZXhwZWN0ID0gZnVuY3Rpb24gZXhwZWN0KHRva2VuKSB7XG4gICAgaWYgKHRoaXMudGtuID09PSB0b2tlbikge1xuICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lcnIoJ01pc3NpbmcgZXhwZWN0ZWQgdG9rZW4gJyArIFRva2VuVmFsdWVzW3Rva2VuICYgVCRUb2tlbk1hc2tdLCB0aGlzLmlkeCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBQYXJzZXJJbXBsZW1lbnRhdGlvbjtcbn0oKTtcblxuZnVuY3Rpb24gdW5lc2NhcGUoY29kZSkge1xuICBzd2l0Y2ggKGNvZGUpIHtcbiAgICBjYXNlIDB4NjY6XG4gICAgICByZXR1cm4gMHhDO1xuICAgIGNhc2UgMHg2RTpcbiAgICAgIHJldHVybiAweEE7XG4gICAgY2FzZSAweDcyOlxuICAgICAgcmV0dXJuIDB4RDtcbiAgICBjYXNlIDB4NzQ6XG4gICAgICByZXR1cm4gMHg5O1xuICAgIGNhc2UgMHg3NjpcbiAgICAgIHJldHVybiAweEI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBjb2RlO1xuICB9XG59XG5cbnZhciBDJFRoaXMgPSAxIDw8IDEwO1xudmFyIEMkU2NvcGUgPSAxIDw8IDExO1xudmFyIEMkTWVtYmVyID0gMSA8PCAxMjtcbnZhciBDJEtleWVkID0gMSA8PCAxMztcbnZhciBDJENhbGwgPSAxIDw8IDE0O1xudmFyIEMkUHJpbWFyeSA9IDEgPDwgMTU7XG52YXIgQyRTaG9ydGhhbmRQcm9wID0gMSA8PCAxNjtcbnZhciBDJFRhZ2dlZCA9IDEgPDwgMTc7XG5cbnZhciBDJEFuY2VzdG9yID0gKDEgPDwgOSkgLSAxO1xuXG52YXIgVCRUb2tlbk1hc2sgPSAoMSA8PCA2KSAtIDE7XG5cbnZhciBUJFByZWNTaGlmdCA9IDY7XG5cbnZhciBUJFByZWNlZGVuY2UgPSA3IDw8IFQkUHJlY1NoaWZ0O1xuXG52YXIgVCRFeHByZXNzaW9uVGVybWluYWwgPSAxIDw8IDExO1xuXG52YXIgVCRDbG9zaW5nVG9rZW4gPSAxIDw8IDEyO1xuXG52YXIgVCRPcGVuaW5nVG9rZW4gPSAxIDw8IDEzO1xuXG52YXIgVCRBY2Nlc3NTY29wZVRlcm1pbmFsID0gMSA8PCAxNDtcbnZhciBUJEtleXdvcmQgPSAxIDw8IDE1O1xudmFyIFQkRU9GID0gMSA8PCAxNiB8IFQkQWNjZXNzU2NvcGVUZXJtaW5hbCB8IFQkRXhwcmVzc2lvblRlcm1pbmFsO1xudmFyIFQkSWRlbnRpZmllciA9IDEgPDwgMTc7XG52YXIgVCRJZGVudGlmaWVyT3JLZXl3b3JkID0gVCRJZGVudGlmaWVyIHwgVCRLZXl3b3JkO1xudmFyIFQkTGl0ZXJhbCA9IDEgPDwgMTg7XG52YXIgVCROdW1lcmljTGl0ZXJhbCA9IDEgPDwgMTkgfCBUJExpdGVyYWw7XG52YXIgVCRTdHJpbmdMaXRlcmFsID0gMSA8PCAyMCB8IFQkTGl0ZXJhbDtcbnZhciBUJEJpbmFyeU9wID0gMSA8PCAyMTtcblxudmFyIFQkVW5hcnlPcCA9IDEgPDwgMjI7XG5cbnZhciBUJE1lbWJlckV4cHJlc3Npb24gPSAxIDw8IDIzO1xuXG52YXIgVCRNZW1iZXJPckNhbGxFeHByZXNzaW9uID0gMSA8PCAyNDtcbnZhciBUJFRlbXBsYXRlVGFpbCA9IDEgPDwgMjUgfCBUJE1lbWJlck9yQ2FsbEV4cHJlc3Npb247XG52YXIgVCRUZW1wbGF0ZUNvbnRpbnVhdGlvbiA9IDEgPDwgMjYgfCBUJE1lbWJlck9yQ2FsbEV4cHJlc3Npb247XG5cbnZhciBUJEZhbHNlS2V5d29yZCA9IDAgfCBUJEtleXdvcmQgfCBUJExpdGVyYWw7XG52YXIgVCRUcnVlS2V5d29yZCA9IDEgfCBUJEtleXdvcmQgfCBUJExpdGVyYWw7XG52YXIgVCROdWxsS2V5d29yZCA9IDIgfCBUJEtleXdvcmQgfCBUJExpdGVyYWw7XG52YXIgVCRVbmRlZmluZWRLZXl3b3JkID0gMyB8IFQkS2V5d29yZCB8IFQkTGl0ZXJhbDtcbnZhciBUJFRoaXNTY29wZSA9IDQgfCBUJElkZW50aWZpZXJPcktleXdvcmQ7XG52YXIgVCRQYXJlbnRTY29wZSA9IDUgfCBUJElkZW50aWZpZXJPcktleXdvcmQ7XG5cbnZhciBUJExQYXJlbiA9IDYgfCBUJE9wZW5pbmdUb2tlbiB8IFQkQWNjZXNzU2NvcGVUZXJtaW5hbCB8IFQkTWVtYmVyT3JDYWxsRXhwcmVzc2lvbjtcbnZhciBUJExCcmFjZSA9IDcgfCBUJE9wZW5pbmdUb2tlbjtcbnZhciBUJFBlcmlvZCA9IDggfCBUJE1lbWJlckV4cHJlc3Npb24gfCBUJE1lbWJlck9yQ2FsbEV4cHJlc3Npb247XG52YXIgVCRSQnJhY2UgPSA5IHwgVCRBY2Nlc3NTY29wZVRlcm1pbmFsIHwgVCRDbG9zaW5nVG9rZW4gfCBUJEV4cHJlc3Npb25UZXJtaW5hbDtcbnZhciBUJFJQYXJlbiA9IDEwIHwgVCRBY2Nlc3NTY29wZVRlcm1pbmFsIHwgVCRDbG9zaW5nVG9rZW4gfCBUJEV4cHJlc3Npb25UZXJtaW5hbDtcbnZhciBUJENvbW1hID0gMTEgfCBUJEFjY2Vzc1Njb3BlVGVybWluYWw7XG52YXIgVCRMQnJhY2tldCA9IDEyIHwgVCRPcGVuaW5nVG9rZW4gfCBUJEFjY2Vzc1Njb3BlVGVybWluYWwgfCBUJE1lbWJlckV4cHJlc3Npb24gfCBUJE1lbWJlck9yQ2FsbEV4cHJlc3Npb247XG52YXIgVCRSQnJhY2tldCA9IDEzIHwgVCRDbG9zaW5nVG9rZW4gfCBUJEV4cHJlc3Npb25UZXJtaW5hbDtcbnZhciBUJENvbG9uID0gMTQgfCBUJEFjY2Vzc1Njb3BlVGVybWluYWw7XG52YXIgVCRRdWVzdGlvbiA9IDE1O1xuXG52YXIgVCRBbXBlcnNhbmQgPSAxOCB8IFQkQWNjZXNzU2NvcGVUZXJtaW5hbDtcbnZhciBUJEJhciA9IDE5IHwgVCRBY2Nlc3NTY29wZVRlcm1pbmFsO1xudmFyIFQkQmFyQmFyID0gMjAgfCAxIDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEFtcGVyc2FuZEFtcGVyc2FuZCA9IDIxIHwgMiA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRDYXJldCA9IDIyIHwgMyA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRFcUVxID0gMjMgfCA0IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEJhbmdFcSA9IDI0IHwgNCA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRFcUVxRXEgPSAyNSB8IDQgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkQmFuZ0VxRXEgPSAyNiB8IDQgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkTHQgPSAyNyB8IDUgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkR3QgPSAyOCB8IDUgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkTHRFcSA9IDI5IHwgNSA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRHdEVxID0gMzAgfCA1IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEluS2V5d29yZCA9IDMxIHwgNSA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3AgfCBUJEtleXdvcmQ7XG52YXIgVCRJbnN0YW5jZU9mS2V5d29yZCA9IDMyIHwgNSA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3AgfCBUJEtleXdvcmQ7XG52YXIgVCRQbHVzID0gMzMgfCA2IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcCB8IFQkVW5hcnlPcDtcbnZhciBUJE1pbnVzID0gMzQgfCA2IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcCB8IFQkVW5hcnlPcDtcbnZhciBUJFR5cGVvZktleXdvcmQgPSAzNSB8IFQkVW5hcnlPcCB8IFQkS2V5d29yZDtcbnZhciBUJFZvaWRLZXl3b3JkID0gMzYgfCBUJFVuYXJ5T3AgfCBUJEtleXdvcmQ7XG52YXIgVCRTdGFyID0gMzcgfCA3IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJFBlcmNlbnQgPSAzOCB8IDcgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkU2xhc2ggPSAzOSB8IDcgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkRXEgPSA0MDtcbnZhciBUJEJhbmcgPSA0MSB8IFQkVW5hcnlPcDtcblxudmFyIEtleXdvcmRMb29rdXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuS2V5d29yZExvb2t1cC50cnVlID0gVCRUcnVlS2V5d29yZDtcbktleXdvcmRMb29rdXAubnVsbCA9IFQkTnVsbEtleXdvcmQ7XG5LZXl3b3JkTG9va3VwLmZhbHNlID0gVCRGYWxzZUtleXdvcmQ7XG5LZXl3b3JkTG9va3VwLnVuZGVmaW5lZCA9IFQkVW5kZWZpbmVkS2V5d29yZDtcbktleXdvcmRMb29rdXAuJHRoaXMgPSBUJFRoaXNTY29wZTtcbktleXdvcmRMb29rdXAuJHBhcmVudCA9IFQkUGFyZW50U2NvcGU7XG5LZXl3b3JkTG9va3VwLmluID0gVCRJbktleXdvcmQ7XG5LZXl3b3JkTG9va3VwLmluc3RhbmNlb2YgPSBUJEluc3RhbmNlT2ZLZXl3b3JkO1xuS2V5d29yZExvb2t1cC50eXBlb2YgPSBUJFR5cGVvZktleXdvcmQ7XG5LZXl3b3JkTG9va3VwLnZvaWQgPSBUJFZvaWRLZXl3b3JkO1xuXG52YXIgVG9rZW5WYWx1ZXMgPSBbZmFsc2UsIHRydWUsIG51bGwsIHVuZGVmaW5lZCwgJyR0aGlzJywgJyRwYXJlbnQnLCAnKCcsICd7JywgJy4nLCAnfScsICcpJywgJywnLCAnWycsICddJywgJzonLCAnPycsICdcXCcnLCAnXCInLCAnJicsICd8JywgJ3x8JywgJyYmJywgJ14nLCAnPT0nLCAnIT0nLCAnPT09JywgJyE9PScsICc8JywgJz4nLCAnPD0nLCAnPj0nLCAnaW4nLCAnaW5zdGFuY2VvZicsICcrJywgJy0nLCAndHlwZW9mJywgJ3ZvaWQnLCAnKicsICclJywgJy8nLCAnPScsICchJ107XG5cbnZhciBjb2RlcyA9IHtcbiAgQXNjaWlJZFBhcnQ6IFsweDI0LCAwLCAweDMwLCAweDNBLCAweDQxLCAweDVCLCAweDVGLCAwLCAweDYxLCAweDdCXSxcbiAgSWRTdGFydDogWzB4MjQsIDAsIDB4NDEsIDB4NUIsIDB4NUYsIDAsIDB4NjEsIDB4N0IsIDB4QUEsIDAsIDB4QkEsIDAsIDB4QzAsIDB4RDcsIDB4RDgsIDB4RjcsIDB4RjgsIDB4MkI5LCAweDJFMCwgMHgyRTUsIDB4MUQwMCwgMHgxRDI2LCAweDFEMkMsIDB4MUQ1RCwgMHgxRDYyLCAweDFENjYsIDB4MUQ2QiwgMHgxRDc4LCAweDFENzksIDB4MURCRiwgMHgxRTAwLCAweDFGMDAsIDB4MjA3MSwgMCwgMHgyMDdGLCAwLCAweDIwOTAsIDB4MjA5RCwgMHgyMTJBLCAweDIxMkMsIDB4MjEzMiwgMCwgMHgyMTRFLCAwLCAweDIxNjAsIDB4MjE4OSwgMHgyQzYwLCAweDJDODAsIDB4QTcyMiwgMHhBNzg4LCAweEE3OEIsIDB4QTdBRiwgMHhBN0IwLCAweEE3QjgsIDB4QTdGNywgMHhBODAwLCAweEFCMzAsIDB4QUI1QiwgMHhBQjVDLCAweEFCNjUsIDB4RkIwMCwgMHhGQjA3LCAweEZGMjEsIDB4RkYzQiwgMHhGRjQxLCAweEZGNUJdLFxuICBEaWdpdDogWzB4MzAsIDB4M0FdLFxuICBTa2lwOiBbMCwgMHgyMSwgMHg3RiwgMHhBMV1cbn07XG5cbmZ1bmN0aW9uIGRlY29tcHJlc3MobG9va3VwLCBzZXQsIGNvbXByZXNzZWQsIHZhbHVlKSB7XG4gIHZhciByYW5nZUNvdW50ID0gY29tcHJlc3NlZC5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2VDb3VudDsgaSArPSAyKSB7XG4gICAgdmFyIHN0YXJ0ID0gY29tcHJlc3NlZFtpXTtcbiAgICB2YXIgZW5kID0gY29tcHJlc3NlZFtpICsgMV07XG4gICAgZW5kID0gZW5kID4gMCA/IGVuZCA6IHN0YXJ0ICsgMTtcbiAgICBpZiAobG9va3VwKSB7XG4gICAgICB2YXIgaiA9IHN0YXJ0O1xuICAgICAgd2hpbGUgKGogPCBlbmQpIHtcbiAgICAgICAgbG9va3VwW2pdID0gdmFsdWU7XG4gICAgICAgIGorKztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNldCkge1xuICAgICAgZm9yICh2YXIgY2ggPSBzdGFydDsgY2ggPCBlbmQ7IGNoKyspIHtcbiAgICAgICAgc2V0LmFkZChjaCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJldHVyblRva2VuKHRva2VuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAocCkge1xuICAgIHAubmV4dCgpO1xuICAgIHJldHVybiB0b2tlbjtcbiAgfTtcbn1cbmZ1bmN0aW9uIHVuZXhwZWN0ZWRDaGFyYWN0ZXIocCkge1xuICBwLmVycignVW5leHBlY3RlZCBjaGFyYWN0ZXIgWycgKyBmcm9tQ2hhckNvZGUocC5jaCkgKyAnXScpO1xuICByZXR1cm4gbnVsbDtcbn1cblxudmFyIEFzY2lpSWRQYXJ0cyA9IG5ldyBTZXQoKTtcbmRlY29tcHJlc3MobnVsbCwgQXNjaWlJZFBhcnRzLCBjb2Rlcy5Bc2NpaUlkUGFydCwgdHJ1ZSk7XG5cbnZhciBJZFBhcnRzID0gbmV3IFVpbnQ4QXJyYXkoMHhGRkZGKTtcbmRlY29tcHJlc3MoSWRQYXJ0cywgbnVsbCwgY29kZXMuSWRTdGFydCwgMSk7XG5kZWNvbXByZXNzKElkUGFydHMsIG51bGwsIGNvZGVzLkRpZ2l0LCAxKTtcblxudmFyIENoYXJTY2FubmVycyA9IG5ldyBBcnJheSgweEZGRkYpO1xudmFyIGNpID0gMDtcbndoaWxlIChjaSA8IDB4RkZGRikge1xuICBDaGFyU2Nhbm5lcnNbY2ldID0gdW5leHBlY3RlZENoYXJhY3RlcjtcbiAgY2krKztcbn1cblxuZGVjb21wcmVzcyhDaGFyU2Nhbm5lcnMsIG51bGwsIGNvZGVzLlNraXAsIGZ1bmN0aW9uIChwKSB7XG4gIHAubmV4dCgpO1xuICByZXR1cm4gbnVsbDtcbn0pO1xuZGVjb21wcmVzcyhDaGFyU2Nhbm5lcnMsIG51bGwsIGNvZGVzLklkU3RhcnQsIGZ1bmN0aW9uIChwKSB7XG4gIHJldHVybiBwLnNjYW5JZGVudGlmaWVyKCk7XG59KTtcbmRlY29tcHJlc3MoQ2hhclNjYW5uZXJzLCBudWxsLCBjb2Rlcy5EaWdpdCwgZnVuY3Rpb24gKHApIHtcbiAgcmV0dXJuIHAuc2Nhbk51bWJlcihmYWxzZSk7XG59KTtcblxuQ2hhclNjYW5uZXJzWzB4MjJdID0gQ2hhclNjYW5uZXJzWzB4MjddID0gZnVuY3Rpb24gKHApIHtcbiAgcmV0dXJuIHAuc2NhblN0cmluZygpO1xufTtcbkNoYXJTY2FubmVyc1sweDYwXSA9IGZ1bmN0aW9uIChwKSB7XG4gIHJldHVybiBwLnNjYW5UZW1wbGF0ZSgpO1xufTtcblxuQ2hhclNjYW5uZXJzWzB4MjFdID0gZnVuY3Rpb24gKHApIHtcbiAgaWYgKHAubmV4dCgpICE9PSAweDNEKSB7XG4gICAgcmV0dXJuIFQkQmFuZztcbiAgfVxuICBpZiAocC5uZXh0KCkgIT09IDB4M0QpIHtcbiAgICByZXR1cm4gVCRCYW5nRXE7XG4gIH1cbiAgcC5uZXh0KCk7XG4gIHJldHVybiBUJEJhbmdFcUVxO1xufTtcblxuQ2hhclNjYW5uZXJzWzB4M0RdID0gZnVuY3Rpb24gKHApIHtcbiAgaWYgKHAubmV4dCgpICE9PSAweDNEKSB7XG4gICAgcmV0dXJuIFQkRXE7XG4gIH1cbiAgaWYgKHAubmV4dCgpICE9PSAweDNEKSB7XG4gICAgcmV0dXJuIFQkRXFFcTtcbiAgfVxuICBwLm5leHQoKTtcbiAgcmV0dXJuIFQkRXFFcUVxO1xufTtcblxuQ2hhclNjYW5uZXJzWzB4MjZdID0gZnVuY3Rpb24gKHApIHtcbiAgaWYgKHAubmV4dCgpICE9PSAweDI2KSB7XG4gICAgcmV0dXJuIFQkQW1wZXJzYW5kO1xuICB9XG4gIHAubmV4dCgpO1xuICByZXR1cm4gVCRBbXBlcnNhbmRBbXBlcnNhbmQ7XG59O1xuXG5DaGFyU2Nhbm5lcnNbMHg3Q10gPSBmdW5jdGlvbiAocCkge1xuICBpZiAocC5uZXh0KCkgIT09IDB4N0MpIHtcbiAgICByZXR1cm4gVCRCYXI7XG4gIH1cbiAgcC5uZXh0KCk7XG4gIHJldHVybiBUJEJhckJhcjtcbn07XG5cbkNoYXJTY2FubmVyc1sweDJFXSA9IGZ1bmN0aW9uIChwKSB7XG4gIGlmIChwLm5leHQoKSA8PSAweDM5ICYmIHAuY2ggPj0gMHgzMCkge1xuICAgIHJldHVybiBwLnNjYW5OdW1iZXIodHJ1ZSk7XG4gIH1cbiAgcmV0dXJuIFQkUGVyaW9kO1xufTtcblxuQ2hhclNjYW5uZXJzWzB4M0NdID0gZnVuY3Rpb24gKHApIHtcbiAgaWYgKHAubmV4dCgpICE9PSAweDNEKSB7XG4gICAgcmV0dXJuIFQkTHQ7XG4gIH1cbiAgcC5uZXh0KCk7XG4gIHJldHVybiBUJEx0RXE7XG59O1xuXG5DaGFyU2Nhbm5lcnNbMHgzRV0gPSBmdW5jdGlvbiAocCkge1xuICBpZiAocC5uZXh0KCkgIT09IDB4M0QpIHtcbiAgICByZXR1cm4gVCRHdDtcbiAgfVxuICBwLm5leHQoKTtcbiAgcmV0dXJuIFQkR3RFcTtcbn07XG5cbkNoYXJTY2FubmVyc1sweDI1XSA9IHJldHVyblRva2VuKFQkUGVyY2VudCk7XG5DaGFyU2Nhbm5lcnNbMHgyOF0gPSByZXR1cm5Ub2tlbihUJExQYXJlbik7XG5DaGFyU2Nhbm5lcnNbMHgyOV0gPSByZXR1cm5Ub2tlbihUJFJQYXJlbik7XG5DaGFyU2Nhbm5lcnNbMHgyQV0gPSByZXR1cm5Ub2tlbihUJFN0YXIpO1xuQ2hhclNjYW5uZXJzWzB4MkJdID0gcmV0dXJuVG9rZW4oVCRQbHVzKTtcbkNoYXJTY2FubmVyc1sweDJDXSA9IHJldHVyblRva2VuKFQkQ29tbWEpO1xuQ2hhclNjYW5uZXJzWzB4MkRdID0gcmV0dXJuVG9rZW4oVCRNaW51cyk7XG5DaGFyU2Nhbm5lcnNbMHgyRl0gPSByZXR1cm5Ub2tlbihUJFNsYXNoKTtcbkNoYXJTY2FubmVyc1sweDNBXSA9IHJldHVyblRva2VuKFQkQ29sb24pO1xuQ2hhclNjYW5uZXJzWzB4M0ZdID0gcmV0dXJuVG9rZW4oVCRRdWVzdGlvbik7XG5DaGFyU2Nhbm5lcnNbMHg1Ql0gPSByZXR1cm5Ub2tlbihUJExCcmFja2V0KTtcbkNoYXJTY2FubmVyc1sweDVEXSA9IHJldHVyblRva2VuKFQkUkJyYWNrZXQpO1xuQ2hhclNjYW5uZXJzWzB4NUVdID0gcmV0dXJuVG9rZW4oVCRDYXJldCk7XG5DaGFyU2Nhbm5lcnNbMHg3Ql0gPSByZXR1cm5Ub2tlbihUJExCcmFjZSk7XG5DaGFyU2Nhbm5lcnNbMHg3RF0gPSByZXR1cm5Ub2tlbihUJFJCcmFjZSk7XG5cbnZhciBtYXBQcm90byA9IE1hcC5wcm90b3R5cGU7XG5cbmZ1bmN0aW9uIF9nZXRNYXBPYnNlcnZlcih0YXNrUXVldWUsIG1hcCkge1xuICByZXR1cm4gTW9kaWZ5TWFwT2JzZXJ2ZXIuZm9yKHRhc2tRdWV1ZSwgbWFwKTtcbn1cblxudmFyIE1vZGlmeU1hcE9ic2VydmVyID0gZnVuY3Rpb24gKF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTIpIHtcbiAgX2luaGVyaXRzKE1vZGlmeU1hcE9ic2VydmVyLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UyKTtcblxuICBmdW5jdGlvbiBNb2RpZnlNYXBPYnNlcnZlcih0YXNrUXVldWUsIG1hcCkge1xuICAgIFxuXG4gICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTIuY2FsbCh0aGlzLCB0YXNrUXVldWUsIG1hcCkpO1xuICB9XG5cbiAgTW9kaWZ5TWFwT2JzZXJ2ZXIuZm9yID0gZnVuY3Rpb24gX2Zvcih0YXNrUXVldWUsIG1hcCkge1xuICAgIGlmICghKCdfX21hcF9vYnNlcnZlcl9fJyBpbiBtYXApKSB7XG4gICAgICBSZWZsZWN0LmRlZmluZVByb3BlcnR5KG1hcCwgJ19fbWFwX29ic2VydmVyX18nLCB7XG4gICAgICAgIHZhbHVlOiBNb2RpZnlNYXBPYnNlcnZlci5jcmVhdGUodGFza1F1ZXVlLCBtYXApLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBtYXAuX19tYXBfb2JzZXJ2ZXJfXztcbiAgfTtcblxuICBNb2RpZnlNYXBPYnNlcnZlci5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUodGFza1F1ZXVlLCBtYXApIHtcbiAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgTW9kaWZ5TWFwT2JzZXJ2ZXIodGFza1F1ZXVlLCBtYXApO1xuXG4gICAgdmFyIHByb3RvID0gbWFwUHJvdG87XG4gICAgaWYgKHByb3RvLnNldCAhPT0gbWFwLnNldCB8fCBwcm90by5kZWxldGUgIT09IG1hcC5kZWxldGUgfHwgcHJvdG8uY2xlYXIgIT09IG1hcC5jbGVhcikge1xuICAgICAgcHJvdG8gPSB7XG4gICAgICAgIHNldDogbWFwLnNldCxcbiAgICAgICAgZGVsZXRlOiBtYXAuZGVsZXRlLFxuICAgICAgICBjbGVhcjogbWFwLmNsZWFyXG4gICAgICB9O1xuICAgIH1cblxuICAgIG1hcC5zZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaGFzVmFsdWUgPSBtYXAuaGFzKGFyZ3VtZW50c1swXSk7XG4gICAgICB2YXIgdHlwZSA9IGhhc1ZhbHVlID8gJ3VwZGF0ZScgOiAnYWRkJztcbiAgICAgIHZhciBvbGRWYWx1ZSA9IG1hcC5nZXQoYXJndW1lbnRzWzBdKTtcbiAgICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHJvdG8uc2V0LmFwcGx5KG1hcCwgYXJndW1lbnRzKTtcbiAgICAgIGlmICghaGFzVmFsdWUgfHwgb2xkVmFsdWUgIT09IG1hcC5nZXQoYXJndW1lbnRzWzBdKSkge1xuICAgICAgICBvYnNlcnZlci5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgb2JqZWN0OiBtYXAsXG4gICAgICAgICAga2V5OiBhcmd1bWVudHNbMF0sXG4gICAgICAgICAgb2xkVmFsdWU6IG9sZFZhbHVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gICAgfTtcblxuICAgIG1hcC5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaGFzVmFsdWUgPSBtYXAuaGFzKGFyZ3VtZW50c1swXSk7XG4gICAgICB2YXIgb2xkVmFsdWUgPSBtYXAuZ2V0KGFyZ3VtZW50c1swXSk7XG4gICAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHByb3RvLmRlbGV0ZS5hcHBseShtYXAsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAoaGFzVmFsdWUpIHtcbiAgICAgICAgb2JzZXJ2ZXIuYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgICB0eXBlOiAnZGVsZXRlJyxcbiAgICAgICAgICBvYmplY3Q6IG1hcCxcbiAgICAgICAgICBrZXk6IGFyZ3VtZW50c1swXSxcbiAgICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgICB9O1xuXG4gICAgbWFwLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwcm90by5jbGVhci5hcHBseShtYXAsIGFyZ3VtZW50cyk7XG4gICAgICBvYnNlcnZlci5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICB0eXBlOiAnY2xlYXInLFxuICAgICAgICBvYmplY3Q6IG1hcFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIG9ic2VydmVyO1xuICB9O1xuXG4gIHJldHVybiBNb2RpZnlNYXBPYnNlcnZlcjtcbn0oTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyKTtcblxudmFyIGVtTG9nZ2VyID0gTG9nTWFuYWdlci5nZXRMb2dnZXIoJ2V2ZW50LW1hbmFnZXInKTtcblxuZnVuY3Rpb24gZmluZE9yaWdpbmFsRXZlbnRUYXJnZXQoZXZlbnQpIHtcbiAgcmV0dXJuIGV2ZW50LmNvbXBvc2VkUGF0aCAmJiBldmVudC5jb21wb3NlZFBhdGgoKVswXSB8fCBldmVudC5kZWVwUGF0aCAmJiBldmVudC5kZWVwUGF0aCgpWzBdIHx8IGV2ZW50LnBhdGggJiYgZXZlbnQucGF0aFswXSB8fCBldmVudC50YXJnZXQ7XG59XG5cbmZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbigpIHtcbiAgdGhpcy5zdGFuZGFyZFN0b3BQcm9wYWdhdGlvbigpO1xuICB0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWU7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNhcHR1cmVkRXZlbnQoZXZlbnQpIHtcbiAgZXZlbnQucHJvcGFnYXRpb25TdG9wcGVkID0gZmFsc2U7XG4gIHZhciB0YXJnZXQgPSBmaW5kT3JpZ2luYWxFdmVudFRhcmdldChldmVudCk7XG5cbiAgdmFyIG9yZGVyZWRDYWxsYmFja3MgPSBbXTtcblxuICB3aGlsZSAodGFyZ2V0KSB7XG4gICAgaWYgKHRhcmdldC5jYXB0dXJlZENhbGxiYWNrcykge1xuICAgICAgdmFyIGNhbGxiYWNrID0gdGFyZ2V0LmNhcHR1cmVkQ2FsbGJhY2tzW2V2ZW50LnR5cGVdO1xuICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24gIT09IHN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICAgIGV2ZW50LnN0YW5kYXJkU3RvcFByb3BhZ2F0aW9uID0gZXZlbnQuc3RvcFByb3BhZ2F0aW9uO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbiA9IHN0b3BQcm9wYWdhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBvcmRlcmVkQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgfVxuICAgIH1cbiAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTtcbiAgfVxuICBmb3IgKHZhciBpID0gb3JkZXJlZENhbGxiYWNrcy5sZW5ndGggLSAxOyBpID49IDAgJiYgIWV2ZW50LnByb3BhZ2F0aW9uU3RvcHBlZDsgaS0tKSB7XG4gICAgdmFyIG9yZGVyZWRDYWxsYmFjayA9IG9yZGVyZWRDYWxsYmFja3NbaV07XG4gICAgaWYgKCdoYW5kbGVFdmVudCcgaW4gb3JkZXJlZENhbGxiYWNrKSB7XG4gICAgICBvcmRlcmVkQ2FsbGJhY2suaGFuZGxlRXZlbnQoZXZlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvcmRlcmVkQ2FsbGJhY2soZXZlbnQpO1xuICAgIH1cbiAgfVxufVxuXG52YXIgQ2FwdHVyZWRIYW5kbGVyRW50cnkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENhcHR1cmVkSGFuZGxlckVudHJ5KGV2ZW50TmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgdGhpcy5jb3VudCA9IDA7XG4gIH1cblxuICBDYXB0dXJlZEhhbmRsZXJFbnRyeS5wcm90b3R5cGUuaW5jcmVtZW50ID0gZnVuY3Rpb24gaW5jcmVtZW50KCkge1xuICAgIHRoaXMuY291bnQrKztcblxuICAgIGlmICh0aGlzLmNvdW50ID09PSAxKSB7XG4gICAgICBET00uYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgaGFuZGxlQ2FwdHVyZWRFdmVudCwgdHJ1ZSk7XG4gICAgfVxuICB9O1xuXG4gIENhcHR1cmVkSGFuZGxlckVudHJ5LnByb3RvdHlwZS5kZWNyZW1lbnQgPSBmdW5jdGlvbiBkZWNyZW1lbnQoKSB7XG4gICAgaWYgKHRoaXMuY291bnQgPT09IDApIHtcbiAgICAgIGVtTG9nZ2VyLndhcm4oJ1RoZSBzYW1lIEV2ZW50TGlzdGVuZXIgd2FzIGRpc3Bvc2VkIG11bHRpcGxlIHRpbWVzLicpO1xuICAgIH0gZWxzZSBpZiAoLS10aGlzLmNvdW50ID09PSAwKSB7XG4gICAgICBET00ucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgaGFuZGxlQ2FwdHVyZWRFdmVudCwgdHJ1ZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDYXB0dXJlZEhhbmRsZXJFbnRyeTtcbn0oKTtcblxudmFyIERlbGVnYXRlSGFuZGxlckVudHJ5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEZWxlZ2F0ZUhhbmRsZXJFbnRyeShldmVudE5hbWUsIGV2ZW50TWFuYWdlcikge1xuICAgIFxuXG4gICAgdGhpcy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgdGhpcy5jb3VudCA9IDA7XG4gICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudE1hbmFnZXI7XG4gIH1cblxuICBEZWxlZ2F0ZUhhbmRsZXJFbnRyeS5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiBoYW5kbGVFdmVudChldmVudCkge1xuICAgIGV2ZW50LnByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlO1xuICAgIHZhciB0YXJnZXQgPSBmaW5kT3JpZ2luYWxFdmVudFRhcmdldChldmVudCk7XG5cbiAgICB3aGlsZSAodGFyZ2V0ICYmICFldmVudC5wcm9wYWdhdGlvblN0b3BwZWQpIHtcbiAgICAgIGlmICh0YXJnZXQuZGVsZWdhdGVkQ2FsbGJhY2tzKSB7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IHRhcmdldC5kZWxlZ2F0ZWRDYWxsYmFja3NbZXZlbnQudHlwZV07XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24gIT09IHN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICAgICAgZXZlbnQuc3RhbmRhcmRTdG9wUHJvcGFnYXRpb24gPSBldmVudC5zdG9wUHJvcGFnYXRpb247XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24gPSBzdG9wUHJvcGFnYXRpb247XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICgnaGFuZGxlRXZlbnQnIGluIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjay5oYW5kbGVFdmVudChldmVudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGV2ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIHBhcmVudCA9IHRhcmdldC5wYXJlbnROb2RlO1xuICAgICAgdmFyIHNob3VsZEVzY2FwZVNoYWRvd1Jvb3QgPSB0aGlzLmV2ZW50TWFuYWdlci5lc2NhcGVTaGFkb3dSb290ICYmIHBhcmVudCBpbnN0YW5jZW9mIFNoYWRvd1Jvb3Q7XG5cbiAgICAgIHRhcmdldCA9IHNob3VsZEVzY2FwZVNoYWRvd1Jvb3QgPyBwYXJlbnQuaG9zdCA6IHBhcmVudDtcbiAgICB9XG4gIH07XG5cbiAgRGVsZWdhdGVIYW5kbGVyRW50cnkucHJvdG90eXBlLmluY3JlbWVudCA9IGZ1bmN0aW9uIGluY3JlbWVudCgpIHtcbiAgICB0aGlzLmNvdW50Kys7XG5cbiAgICBpZiAodGhpcy5jb3VudCA9PT0gMSkge1xuICAgICAgRE9NLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIHRoaXMsIGZhbHNlKTtcbiAgICB9XG4gIH07XG5cbiAgRGVsZWdhdGVIYW5kbGVyRW50cnkucHJvdG90eXBlLmRlY3JlbWVudCA9IGZ1bmN0aW9uIGRlY3JlbWVudCgpIHtcbiAgICBpZiAodGhpcy5jb3VudCA9PT0gMCkge1xuICAgICAgZW1Mb2dnZXIud2FybignVGhlIHNhbWUgRXZlbnRMaXN0ZW5lciB3YXMgZGlzcG9zZWQgbXVsdGlwbGUgdGltZXMuJyk7XG4gICAgfSBlbHNlIGlmICgtLXRoaXMuY291bnQgPT09IDApIHtcbiAgICAgIERPTS5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCB0aGlzLCBmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBEZWxlZ2F0ZUhhbmRsZXJFbnRyeTtcbn0oKTtcblxudmFyIERlbGVnYXRpb25FbnRyeUhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERlbGVnYXRpb25FbnRyeUhhbmRsZXIoZW50cnksIGxvb2t1cCwgdGFyZ2V0RXZlbnQpIHtcbiAgICBcblxuICAgIHRoaXMuZW50cnkgPSBlbnRyeTtcbiAgICB0aGlzLmxvb2t1cCA9IGxvb2t1cDtcbiAgICB0aGlzLnRhcmdldEV2ZW50ID0gdGFyZ2V0RXZlbnQ7XG4gIH1cblxuICBEZWxlZ2F0aW9uRW50cnlIYW5kbGVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICBpZiAodGhpcy5sb29rdXBbdGhpcy50YXJnZXRFdmVudF0pIHtcbiAgICAgIHRoaXMuZW50cnkuZGVjcmVtZW50KCk7XG4gICAgICB0aGlzLmxvb2t1cFt0aGlzLnRhcmdldEV2ZW50XSA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVtTG9nZ2VyLndhcm4oJ0NhbGxpbmcgLmRpc3Bvc2UoKSBvbiBhbHJlYWR5IGRpc3Bvc2VkIGV2ZW50TGlzdGVuZXInKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIERlbGVnYXRpb25FbnRyeUhhbmRsZXI7XG59KCk7XG5cbnZhciBFdmVudEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV2ZW50SGFuZGxlcih0YXJnZXQsIHRhcmdldEV2ZW50LCBjYWxsYmFjaykge1xuICAgIFxuXG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgdGhpcy50YXJnZXRFdmVudCA9IHRhcmdldEV2ZW50O1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgfVxuXG4gIEV2ZW50SGFuZGxlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLnRhcmdldEV2ZW50LCB0aGlzLmNhbGxiYWNrKTtcbiAgfTtcblxuICByZXR1cm4gRXZlbnRIYW5kbGVyO1xufSgpO1xuXG52YXIgRGVmYXVsdEV2ZW50U3RyYXRlZ3kgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERlZmF1bHRFdmVudFN0cmF0ZWd5KGV2ZW50TWFuYWdlcikge1xuICAgIFxuXG4gICAgdGhpcy5kZWxlZ2F0ZWRIYW5kbGVycyA9IHt9O1xuICAgIHRoaXMuY2FwdHVyZWRIYW5kbGVycyA9IHt9O1xuXG4gICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudE1hbmFnZXI7XG4gIH1cblxuICBEZWZhdWx0RXZlbnRTdHJhdGVneS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKHRhcmdldCwgdGFyZ2V0RXZlbnQsIGNhbGxiYWNrLCBzdHJhdGVneSwgZGlzcG9zYWJsZSkge1xuICAgIHZhciBkZWxlZ2F0ZWRIYW5kbGVycyA9IHZvaWQgMDtcbiAgICB2YXIgY2FwdHVyZWRIYW5kbGVycyA9IHZvaWQgMDtcbiAgICB2YXIgaGFuZGxlckVudHJ5ID0gdm9pZCAwO1xuXG4gICAgaWYgKHN0cmF0ZWd5ID09PSBkZWxlZ2F0aW9uU3RyYXRlZ3kuYnViYmxpbmcpIHtcbiAgICAgIGRlbGVnYXRlZEhhbmRsZXJzID0gdGhpcy5kZWxlZ2F0ZWRIYW5kbGVycztcbiAgICAgIGhhbmRsZXJFbnRyeSA9IGRlbGVnYXRlZEhhbmRsZXJzW3RhcmdldEV2ZW50XSB8fCAoZGVsZWdhdGVkSGFuZGxlcnNbdGFyZ2V0RXZlbnRdID0gbmV3IERlbGVnYXRlSGFuZGxlckVudHJ5KHRhcmdldEV2ZW50LCB0aGlzLmV2ZW50TWFuYWdlcikpO1xuICAgICAgdmFyIGRlbGVnYXRlZENhbGxiYWNrcyA9IHRhcmdldC5kZWxlZ2F0ZWRDYWxsYmFja3MgfHwgKHRhcmdldC5kZWxlZ2F0ZWRDYWxsYmFja3MgPSB7fSk7XG4gICAgICBpZiAoIWRlbGVnYXRlZENhbGxiYWNrc1t0YXJnZXRFdmVudF0pIHtcbiAgICAgICAgaGFuZGxlckVudHJ5LmluY3JlbWVudCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW1Mb2dnZXIud2FybignT3ZlcnJpZGluZyBwcmV2aW91cyBjYWxsYmFjayBmb3IgZXZlbnQgbGlzdGVuZXInLCB7IGV2ZW50OiB0YXJnZXRFdmVudCwgY2FsbGJhY2s6IGNhbGxiYWNrLCBwcmV2aW91c0NhbGxiYWNrOiBkZWxlZ2F0ZWRDYWxsYmFja3NbdGFyZ2V0RXZlbnRdIH0pO1xuICAgICAgfVxuICAgICAgZGVsZWdhdGVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSA9IGNhbGxiYWNrO1xuXG4gICAgICBpZiAoZGlzcG9zYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm4gbmV3IERlbGVnYXRpb25FbnRyeUhhbmRsZXIoaGFuZGxlckVudHJ5LCBkZWxlZ2F0ZWRDYWxsYmFja3MsIHRhcmdldEV2ZW50KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGFuZGxlckVudHJ5LmRlY3JlbWVudCgpO1xuICAgICAgICBkZWxlZ2F0ZWRDYWxsYmFja3NbdGFyZ2V0RXZlbnRdID0gbnVsbDtcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChzdHJhdGVneSA9PT0gZGVsZWdhdGlvblN0cmF0ZWd5LmNhcHR1cmluZykge1xuICAgICAgY2FwdHVyZWRIYW5kbGVycyA9IHRoaXMuY2FwdHVyZWRIYW5kbGVycztcbiAgICAgIGhhbmRsZXJFbnRyeSA9IGNhcHR1cmVkSGFuZGxlcnNbdGFyZ2V0RXZlbnRdIHx8IChjYXB0dXJlZEhhbmRsZXJzW3RhcmdldEV2ZW50XSA9IG5ldyBDYXB0dXJlZEhhbmRsZXJFbnRyeSh0YXJnZXRFdmVudCkpO1xuICAgICAgdmFyIGNhcHR1cmVkQ2FsbGJhY2tzID0gdGFyZ2V0LmNhcHR1cmVkQ2FsbGJhY2tzIHx8ICh0YXJnZXQuY2FwdHVyZWRDYWxsYmFja3MgPSB7fSk7XG4gICAgICBpZiAoIWNhcHR1cmVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSkge1xuICAgICAgICBoYW5kbGVyRW50cnkuaW5jcmVtZW50KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbUxvZ2dlci5lcnJvcignYWxyZWFkeSBoYXZlIGEgY2FsbGJhY2sgZm9yIGV2ZW50JywgeyBldmVudDogdGFyZ2V0RXZlbnQsIGNhbGxiYWNrOiBjYWxsYmFjayB9KTtcbiAgICAgIH1cbiAgICAgIGNhcHR1cmVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSA9IGNhbGxiYWNrO1xuXG4gICAgICBpZiAoZGlzcG9zYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm4gbmV3IERlbGVnYXRpb25FbnRyeUhhbmRsZXIoaGFuZGxlckVudHJ5LCBjYXB0dXJlZENhbGxiYWNrcywgdGFyZ2V0RXZlbnQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBoYW5kbGVyRW50cnkuZGVjcmVtZW50KCk7XG4gICAgICAgIGNhcHR1cmVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSA9IG51bGw7XG4gICAgICB9O1xuICAgIH1cblxuICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKHRhcmdldEV2ZW50LCBjYWxsYmFjayk7XG5cbiAgICBpZiAoZGlzcG9zYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIG5ldyBFdmVudEhhbmRsZXIodGFyZ2V0LCB0YXJnZXRFdmVudCwgY2FsbGJhY2spO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0YXJnZXRFdmVudCwgY2FsbGJhY2spO1xuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIERlZmF1bHRFdmVudFN0cmF0ZWd5O1xufSgpO1xuXG5leHBvcnQgdmFyIGRlbGVnYXRpb25TdHJhdGVneSA9IHtcbiAgbm9uZTogMCxcbiAgY2FwdHVyaW5nOiAxLFxuICBidWJibGluZzogMlxufTtcblxuZXhwb3J0IHZhciBFdmVudE1hbmFnZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV2ZW50TWFuYWdlcigpIHtcbiAgICB2YXIgZXNjYXBlU2hhZG93Um9vdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7XG5cbiAgICBcblxuICAgIHRoaXMuZWxlbWVudEhhbmRsZXJMb29rdXAgPSB7fTtcbiAgICB0aGlzLmV2ZW50U3RyYXRlZ3lMb29rdXAgPSB7fTtcbiAgICB0aGlzLmVzY2FwZVNoYWRvd1Jvb3QgPSBlc2NhcGVTaGFkb3dSb290O1xuXG4gICAgdGhpcy5yZWdpc3RlckVsZW1lbnRDb25maWcoe1xuICAgICAgdGFnTmFtZTogJ2lucHV0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdmFsdWU6IFsnY2hhbmdlJywgJ2lucHV0J10sXG4gICAgICAgIGNoZWNrZWQ6IFsnY2hhbmdlJywgJ2lucHV0J10sXG4gICAgICAgIGZpbGVzOiBbJ2NoYW5nZScsICdpbnB1dCddXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRWxlbWVudENvbmZpZyh7XG4gICAgICB0YWdOYW1lOiAndGV4dGFyZWEnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB2YWx1ZTogWydjaGFuZ2UnLCAnaW5wdXQnXVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5yZWdpc3RlckVsZW1lbnRDb25maWcoe1xuICAgICAgdGFnTmFtZTogJ3NlbGVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHZhbHVlOiBbJ2NoYW5nZSddXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRWxlbWVudENvbmZpZyh7XG4gICAgICB0YWdOYW1lOiAnY29udGVudCBlZGl0YWJsZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHZhbHVlOiBbJ2NoYW5nZScsICdpbnB1dCcsICdibHVyJywgJ2tleXVwJywgJ3Bhc3RlJ11cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMucmVnaXN0ZXJFbGVtZW50Q29uZmlnKHtcbiAgICAgIHRhZ05hbWU6ICdzY3JvbGxhYmxlIGVsZW1lbnQnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBzY3JvbGxUb3A6IFsnc2Nyb2xsJ10sXG4gICAgICAgIHNjcm9sbExlZnQ6IFsnc2Nyb2xsJ11cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuZGVmYXVsdEV2ZW50U3RyYXRlZ3kgPSBuZXcgRGVmYXVsdEV2ZW50U3RyYXRlZ3kodGhpcyk7XG4gIH1cblxuICBFdmVudE1hbmFnZXIucHJvdG90eXBlLnJlZ2lzdGVyRWxlbWVudENvbmZpZyA9IGZ1bmN0aW9uIHJlZ2lzdGVyRWxlbWVudENvbmZpZyhjb25maWcpIHtcbiAgICB2YXIgdGFnTmFtZSA9IGNvbmZpZy50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgdmFyIHByb3BlcnRpZXMgPSBjb25maWcucHJvcGVydGllcztcbiAgICB2YXIgcHJvcGVydHlOYW1lID0gdm9pZCAwO1xuXG4gICAgdmFyIGxvb2t1cCA9IHRoaXMuZWxlbWVudEhhbmRsZXJMb29rdXBbdGFnTmFtZV0gPSB7fTtcblxuICAgIGZvciAocHJvcGVydHlOYW1lIGluIHByb3BlcnRpZXMpIHtcbiAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgbG9va3VwW3Byb3BlcnR5TmFtZV0gPSBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEV2ZW50TWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJFdmVudFN0cmF0ZWd5ID0gZnVuY3Rpb24gcmVnaXN0ZXJFdmVudFN0cmF0ZWd5KGV2ZW50TmFtZSwgc3RyYXRlZ3kpIHtcbiAgICB0aGlzLmV2ZW50U3RyYXRlZ3lMb29rdXBbZXZlbnROYW1lXSA9IHN0cmF0ZWd5O1xuICB9O1xuXG4gIEV2ZW50TWFuYWdlci5wcm90b3R5cGUuZ2V0RWxlbWVudEhhbmRsZXIgPSBmdW5jdGlvbiBnZXRFbGVtZW50SGFuZGxlcih0YXJnZXQsIHByb3BlcnR5TmFtZSkge1xuICAgIHZhciB0YWdOYW1lID0gdm9pZCAwO1xuICAgIHZhciBsb29rdXAgPSB0aGlzLmVsZW1lbnRIYW5kbGVyTG9va3VwO1xuXG4gICAgaWYgKHRhcmdldC50YWdOYW1lKSB7XG4gICAgICB0YWdOYW1lID0gdGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgaWYgKGxvb2t1cFt0YWdOYW1lXSAmJiBsb29rdXBbdGFnTmFtZV1bcHJvcGVydHlOYW1lXSkge1xuICAgICAgICByZXR1cm4gbmV3IEV2ZW50U3Vic2NyaWJlcihsb29rdXBbdGFnTmFtZV1bcHJvcGVydHlOYW1lXSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICd0ZXh0Q29udGVudCcgfHwgcHJvcGVydHlOYW1lID09PSAnaW5uZXJIVE1MJykge1xuICAgICAgICByZXR1cm4gbmV3IEV2ZW50U3Vic2NyaWJlcihsb29rdXBbJ2NvbnRlbnQgZWRpdGFibGUnXS52YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdzY3JvbGxUb3AnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ3Njcm9sbExlZnQnKSB7XG4gICAgICAgIHJldHVybiBuZXcgRXZlbnRTdWJzY3JpYmVyKGxvb2t1cFsnc2Nyb2xsYWJsZSBlbGVtZW50J11bcHJvcGVydHlOYW1lXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgRXZlbnRNYW5hZ2VyLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcih0YXJnZXQsIHRhcmdldEV2ZW50LCBjYWxsYmFja09yTGlzdGVuZXIsIGRlbGVnYXRlLCBkaXNwb3NhYmxlKSB7XG4gICAgcmV0dXJuICh0aGlzLmV2ZW50U3RyYXRlZ3lMb29rdXBbdGFyZ2V0RXZlbnRdIHx8IHRoaXMuZGVmYXVsdEV2ZW50U3RyYXRlZ3kpLnN1YnNjcmliZSh0YXJnZXQsIHRhcmdldEV2ZW50LCBjYWxsYmFja09yTGlzdGVuZXIsIGRlbGVnYXRlLCBkaXNwb3NhYmxlKTtcbiAgfTtcblxuICByZXR1cm4gRXZlbnRNYW5hZ2VyO1xufSgpO1xuXG5leHBvcnQgdmFyIEV2ZW50U3Vic2NyaWJlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXZlbnRTdWJzY3JpYmVyKGV2ZW50cykge1xuICAgIFxuXG4gICAgdGhpcy5ldmVudHMgPSBldmVudHM7XG4gICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcbiAgICB0aGlzLmhhbmRsZXIgPSBudWxsO1xuICB9XG5cbiAgRXZlbnRTdWJzY3JpYmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoZWxlbWVudCwgY2FsbGJhY2tPckxpc3RlbmVyKSB7XG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmhhbmRsZXIgPSBjYWxsYmFja09yTGlzdGVuZXI7XG5cbiAgICB2YXIgZXZlbnRzID0gdGhpcy5ldmVudHM7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZXZlbnRzLmxlbmd0aDsgaWkgPiBpOyArK2kpIHtcbiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudHNbaV0sIGNhbGxiYWNrT3JMaXN0ZW5lcik7XG4gICAgfVxuICB9O1xuXG4gIEV2ZW50U3Vic2NyaWJlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgaWYgKHRoaXMuZWxlbWVudCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICB2YXIgY2FsbGJhY2tPckxpc3RlbmVyID0gdGhpcy5oYW5kbGVyO1xuICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50cztcbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBldmVudHMubGVuZ3RoOyBpaSA+IGk7ICsraSkge1xuICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50c1tpXSwgY2FsbGJhY2tPckxpc3RlbmVyKTtcbiAgICB9XG4gICAgdGhpcy5lbGVtZW50ID0gdGhpcy5oYW5kbGVyID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gRXZlbnRTdWJzY3JpYmVyO1xufSgpO1xuXG5leHBvcnQgdmFyIERpcnR5Q2hlY2tlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRGlydHlDaGVja2VyKCkge1xuICAgIFxuXG4gICAgdGhpcy50cmFja2VkID0gW107XG4gICAgdGhpcy5jaGVja0RlbGF5ID0gMTIwO1xuICB9XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5hZGRQcm9wZXJ0eSA9IGZ1bmN0aW9uIGFkZFByb3BlcnR5KHByb3BlcnR5KSB7XG4gICAgdmFyIHRyYWNrZWQgPSB0aGlzLnRyYWNrZWQ7XG5cbiAgICB0cmFja2VkLnB1c2gocHJvcGVydHkpO1xuXG4gICAgaWYgKHRyYWNrZWQubGVuZ3RoID09PSAxKSB7XG4gICAgICB0aGlzLnNjaGVkdWxlRGlydHlDaGVjaygpO1xuICAgIH1cbiAgfTtcblxuICBEaXJ0eUNoZWNrZXIucHJvdG90eXBlLnJlbW92ZVByb3BlcnR5ID0gZnVuY3Rpb24gcmVtb3ZlUHJvcGVydHkocHJvcGVydHkpIHtcbiAgICB2YXIgdHJhY2tlZCA9IHRoaXMudHJhY2tlZDtcbiAgICB0cmFja2VkLnNwbGljZSh0cmFja2VkLmluZGV4T2YocHJvcGVydHkpLCAxKTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrZXIucHJvdG90eXBlLnNjaGVkdWxlRGlydHlDaGVjayA9IGZ1bmN0aW9uIHNjaGVkdWxlRGlydHlDaGVjaygpIHtcbiAgICB2YXIgX3RoaXMyMiA9IHRoaXM7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBfdGhpczIyLmNoZWNrKCk7XG4gICAgfSwgdGhpcy5jaGVja0RlbGF5KTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrZXIucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24gY2hlY2soKSB7XG4gICAgdmFyIHRyYWNrZWQgPSB0aGlzLnRyYWNrZWQ7XG4gICAgdmFyIGkgPSB0cmFja2VkLmxlbmd0aDtcblxuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIHZhciBjdXJyZW50ID0gdHJhY2tlZFtpXTtcblxuICAgICAgaWYgKGN1cnJlbnQuaXNEaXJ0eSgpKSB7XG4gICAgICAgIGN1cnJlbnQuY2FsbCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0cmFja2VkLmxlbmd0aCkge1xuICAgICAgdGhpcy5zY2hlZHVsZURpcnR5Q2hlY2soKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIERpcnR5Q2hlY2tlcjtcbn0oKTtcblxuZXhwb3J0IHZhciBEaXJ0eUNoZWNrUHJvcGVydHkgPSAoX2RlYzUgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjNShfY2xhc3M1ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEaXJ0eUNoZWNrUHJvcGVydHkoZGlydHlDaGVja2VyLCBvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5kaXJ0eUNoZWNrZXIgPSBkaXJ0eUNoZWNrZXI7XG4gICAgdGhpcy5vYmogPSBvYmo7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG4gIH1cblxuICBEaXJ0eUNoZWNrUHJvcGVydHkucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMub2JqW3RoaXMucHJvcGVydHlOYW1lXTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrUHJvcGVydHkucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV0gPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrUHJvcGVydHkucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuXG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcblxuICAgIHRoaXMub2xkVmFsdWUgPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrUHJvcGVydHkucHJvdG90eXBlLmlzRGlydHkgPSBmdW5jdGlvbiBpc0RpcnR5KCkge1xuICAgIHJldHVybiB0aGlzLm9sZFZhbHVlICE9PSB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV07XG4gIH07XG5cbiAgRGlydHlDaGVja1Byb3BlcnR5LnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICAgIHRoaXMuZGlydHlDaGVja2VyLmFkZFByb3BlcnR5KHRoaXMpO1xuICAgIH1cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIERpcnR5Q2hlY2tQcm9wZXJ0eS5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICh0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpICYmICF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMuZGlydHlDaGVja2VyLnJlbW92ZVByb3BlcnR5KHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gRGlydHlDaGVja1Byb3BlcnR5O1xufSgpKSB8fCBfY2xhc3M1KTtcblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdwcm9wZXJ0eS1vYnNlcnZhdGlvbicpO1xuXG5leHBvcnQgdmFyIHByb3BlcnR5QWNjZXNzb3IgPSB7XG4gIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZShvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIHJldHVybiBvYmpbcHJvcGVydHlOYW1lXTtcbiAgfSxcbiAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHZhbHVlLCBvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIG9ialtwcm9wZXJ0eU5hbWVdID0gdmFsdWU7XG4gIH1cbn07XG5cbmV4cG9ydCB2YXIgUHJpbWl0aXZlT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFByaW1pdGl2ZU9ic2VydmVyKHByaW1pdGl2ZSwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLmRvTm90Q2FjaGUgPSB0cnVlO1xuXG4gICAgdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG4gIH1cblxuICBQcmltaXRpdmVPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5wcmltaXRpdmVbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIFByaW1pdGl2ZU9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKCkge1xuICAgIHZhciB0eXBlID0gX3R5cGVvZih0aGlzLnByaW1pdGl2ZSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgJyArIHRoaXMucHJvcGVydHlOYW1lICsgJyBwcm9wZXJ0eSBvZiBhICcgKyB0eXBlICsgJyAoJyArIHRoaXMucHJpbWl0aXZlICsgJykgY2Fubm90IGJlIGFzc2lnbmVkLicpO1xuICB9O1xuXG4gIFByaW1pdGl2ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoKSB7fTtcblxuICBQcmltaXRpdmVPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHt9O1xuXG4gIHJldHVybiBQcmltaXRpdmVPYnNlcnZlcjtcbn0oKTtcblxuZXhwb3J0IHZhciBTZXR0ZXJPYnNlcnZlciA9IChfZGVjNiA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM2KF9jbGFzczcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNldHRlck9ic2VydmVyKHRhc2tRdWV1ZSwgb2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xuICAgIHRoaXMub2JqID0gb2JqO1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICAgIHRoaXMucXVldWVkID0gZmFsc2U7XG4gICAgdGhpcy5vYnNlcnZpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV07XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV0gPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuZ2V0dGVyVmFsdWUgPSBmdW5jdGlvbiBnZXR0ZXJWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VmFsdWU7XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLnNldHRlclZhbHVlID0gZnVuY3Rpb24gc2V0dGVyVmFsdWUobmV3VmFsdWUpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcblxuICAgIGlmIChvbGRWYWx1ZSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgIGlmICghdGhpcy5xdWV1ZWQpIHtcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IG9sZFZhbHVlO1xuICAgICAgICB0aGlzLnF1ZXVlZCA9IHRydWU7XG4gICAgICAgIHRoaXMudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKHRoaXMpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IG5ld1ZhbHVlO1xuICAgIH1cbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICB2YXIgbmV3VmFsdWUgPSB0aGlzLm9sZFZhbHVlID0gdGhpcy5jdXJyZW50VmFsdWU7XG5cbiAgICB0aGlzLnF1ZXVlZCA9IGZhbHNlO1xuXG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKCF0aGlzLm9ic2VydmluZykge1xuICAgICAgdGhpcy5jb252ZXJ0UHJvcGVydHkoKTtcbiAgICB9XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLmNvbnZlcnRQcm9wZXJ0eSA9IGZ1bmN0aW9uIGNvbnZlcnRQcm9wZXJ0eSgpIHtcbiAgICB0aGlzLm9ic2VydmluZyA9IHRydWU7XG4gICAgdGhpcy5jdXJyZW50VmFsdWUgPSB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV07XG4gICAgdGhpcy5zZXRWYWx1ZSA9IHRoaXMuc2V0dGVyVmFsdWU7XG4gICAgdGhpcy5nZXRWYWx1ZSA9IHRoaXMuZ2V0dGVyVmFsdWU7XG5cbiAgICBpZiAoIVJlZmxlY3QuZGVmaW5lUHJvcGVydHkodGhpcy5vYmosIHRoaXMucHJvcGVydHlOYW1lLCB7XG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiB0aGlzLnByb3BlcnR5TmFtZSBpbiB0aGlzLm9iaiA/IHRoaXMub2JqLnByb3BlcnR5SXNFbnVtZXJhYmxlKHRoaXMucHJvcGVydHlOYW1lKSA6IHRydWUsXG4gICAgICBnZXQ6IHRoaXMuZ2V0VmFsdWUuYmluZCh0aGlzKSxcbiAgICAgIHNldDogdGhpcy5zZXRWYWx1ZS5iaW5kKHRoaXMpXG4gICAgfSkpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdDYW5ub3Qgb2JzZXJ2ZSBwcm9wZXJ0eSBcXCcnICsgdGhpcy5wcm9wZXJ0eU5hbWUgKyAnXFwnIG9mIG9iamVjdCcsIHRoaXMub2JqKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFNldHRlck9ic2VydmVyO1xufSgpKSB8fCBfY2xhc3M3KTtcblxuZXhwb3J0IHZhciBYTGlua0F0dHJpYnV0ZU9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBYTGlua0F0dHJpYnV0ZU9ic2VydmVyKGVsZW1lbnQsIHByb3BlcnR5TmFtZSwgYXR0cmlidXRlTmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgICB0aGlzLmF0dHJpYnV0ZU5hbWUgPSBhdHRyaWJ1dGVOYW1lO1xuICB9XG5cbiAgWExpbmtBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywgdGhpcy5hdHRyaWJ1dGVOYW1lKTtcbiAgfTtcblxuICBYTGlua0F0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsIHRoaXMuYXR0cmlidXRlTmFtZSwgbmV3VmFsdWUpO1xuICB9O1xuXG4gIFhMaW5rQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09ic2VydmF0aW9uIG9mIGEgXCInICsgdGhpcy5lbGVtZW50Lm5vZGVOYW1lICsgJ1wiIGVsZW1lbnRcXCdzIFwiJyArIHRoaXMucHJvcGVydHlOYW1lICsgJ1wiIHByb3BlcnR5IGlzIG5vdCBzdXBwb3J0ZWQuJyk7XG4gIH07XG5cbiAgcmV0dXJuIFhMaW5rQXR0cmlidXRlT2JzZXJ2ZXI7XG59KCk7XG5cbmV4cG9ydCB2YXIgZGF0YUF0dHJpYnV0ZUFjY2Vzc29yID0ge1xuICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICByZXR1cm4gb2JqLmdldEF0dHJpYnV0ZShwcm9wZXJ0eU5hbWUpO1xuICB9LFxuICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodmFsdWUsIG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9iai5yZW1vdmVBdHRyaWJ1dGUocHJvcGVydHlOYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqLnNldEF0dHJpYnV0ZShwcm9wZXJ0eU5hbWUsIHZhbHVlKTtcbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCB2YXIgRGF0YUF0dHJpYnV0ZU9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIoZWxlbWVudCwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICB9XG5cbiAgRGF0YUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKHRoaXMucHJvcGVydHlOYW1lKTtcbiAgfTtcblxuICBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICBpZiAobmV3VmFsdWUgPT09IG51bGwgfHwgbmV3VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUodGhpcy5wcm9wZXJ0eU5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSh0aGlzLnByb3BlcnR5TmFtZSwgbmV3VmFsdWUpO1xuICB9O1xuXG4gIERhdGFBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT2JzZXJ2YXRpb24gb2YgYSBcIicgKyB0aGlzLmVsZW1lbnQubm9kZU5hbWUgKyAnXCIgZWxlbWVudFxcJ3MgXCInICsgdGhpcy5wcm9wZXJ0eU5hbWUgKyAnXCIgcHJvcGVydHkgaXMgbm90IHN1cHBvcnRlZC4nKTtcbiAgfTtcblxuICByZXR1cm4gRGF0YUF0dHJpYnV0ZU9ic2VydmVyO1xufSgpO1xuXG5leHBvcnQgdmFyIFN0eWxlT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN0eWxlT2JzZXJ2ZXIoZWxlbWVudCwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuXG4gICAgdGhpcy5zdHlsZXMgPSBudWxsO1xuICAgIHRoaXMudmVyc2lvbiA9IDA7XG4gIH1cblxuICBTdHlsZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnQuc3R5bGUuY3NzVGV4dDtcbiAgfTtcblxuICBTdHlsZU9ic2VydmVyLnByb3RvdHlwZS5fc2V0UHJvcGVydHkgPSBmdW5jdGlvbiBfc2V0UHJvcGVydHkoc3R5bGUsIHZhbHVlKSB7XG4gICAgdmFyIHByaW9yaXR5ID0gJyc7XG5cbiAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgdmFsdWUuaW5kZXhPZiA9PT0gJ2Z1bmN0aW9uJyAmJiB2YWx1ZS5pbmRleE9mKCchaW1wb3J0YW50JykgIT09IC0xKSB7XG4gICAgICBwcmlvcml0eSA9ICdpbXBvcnRhbnQnO1xuICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCchaW1wb3J0YW50JywgJycpO1xuICAgIH1cbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoc3R5bGUsIHZhbHVlLCBwcmlvcml0eSk7XG4gIH07XG5cbiAgU3R5bGVPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHZhciBzdHlsZXMgPSB0aGlzLnN0eWxlcyB8fCB7fTtcbiAgICB2YXIgc3R5bGUgPSB2b2lkIDA7XG4gICAgdmFyIHZlcnNpb24gPSB0aGlzLnZlcnNpb247XG5cbiAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKG5ld1ZhbHVlIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHZvaWQgMDtcbiAgICAgICAgZm9yIChzdHlsZSBpbiBuZXdWYWx1ZSkge1xuICAgICAgICAgIGlmIChuZXdWYWx1ZS5oYXNPd25Qcm9wZXJ0eShzdHlsZSkpIHtcbiAgICAgICAgICAgIHZhbHVlID0gbmV3VmFsdWVbc3R5bGVdO1xuICAgICAgICAgICAgc3R5bGUgPSBzdHlsZS5yZXBsYWNlKC8oW0EtWl0pL2csIGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnLScgKyBtLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHN0eWxlc1tzdHlsZV0gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy5fc2V0UHJvcGVydHkoc3R5bGUsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUubGVuZ3RoKSB7XG4gICAgICAgIHZhciByeCA9IC9cXHMqKFtcXHdcXC1dKylcXHMqOlxccyooKD86KD86W1xcd1xcLV0rXFwoXFxzKig/OlwiKD86XFxcXFwifFteXCJdKSpcInwnKD86XFxcXCd8W14nXSkqJ3xbXFx3XFwtXStcXChcXHMqKD86XlwiKD86XFxcXFwifFteXCJdKSpcInwnKD86XFxcXCd8W14nXSkqJ3xbXlxcKV0qKVxcKSw/fFteXFwpXSopXFwpLD98XCIoPzpcXFxcXCJ8W15cIl0pKlwifCcoPzpcXFxcJ3xbXiddKSonfFteO10qKSw/XFxzKikrKTs/L2c7XG4gICAgICAgIHZhciBwYWlyID0gdm9pZCAwO1xuICAgICAgICB3aGlsZSAoKHBhaXIgPSByeC5leGVjKG5ld1ZhbHVlKSkgIT09IG51bGwpIHtcbiAgICAgICAgICBzdHlsZSA9IHBhaXJbMV07XG4gICAgICAgICAgaWYgKCFzdHlsZSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3R5bGVzW3N0eWxlXSA9IHZlcnNpb247XG4gICAgICAgICAgdGhpcy5fc2V0UHJvcGVydHkoc3R5bGUsIHBhaXJbMl0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zdHlsZXMgPSBzdHlsZXM7XG4gICAgdGhpcy52ZXJzaW9uICs9IDE7XG5cbiAgICBpZiAodmVyc2lvbiA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZlcnNpb24gLT0gMTtcbiAgICBmb3IgKHN0eWxlIGluIHN0eWxlcykge1xuICAgICAgaWYgKCFzdHlsZXMuaGFzT3duUHJvcGVydHkoc3R5bGUpIHx8IHN0eWxlc1tzdHlsZV0gIT09IHZlcnNpb24pIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5yZW1vdmVQcm9wZXJ0eShzdHlsZSk7XG4gICAgfVxuICB9O1xuXG4gIFN0eWxlT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09ic2VydmF0aW9uIG9mIGEgXCInICsgdGhpcy5lbGVtZW50Lm5vZGVOYW1lICsgJ1wiIGVsZW1lbnRcXCdzIFwiJyArIHRoaXMucHJvcGVydHlOYW1lICsgJ1wiIHByb3BlcnR5IGlzIG5vdCBzdXBwb3J0ZWQuJyk7XG4gIH07XG5cbiAgcmV0dXJuIFN0eWxlT2JzZXJ2ZXI7XG59KCk7XG5cbmV4cG9ydCB2YXIgVmFsdWVBdHRyaWJ1dGVPYnNlcnZlciA9IChfZGVjNyA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM3KF9jbGFzczggPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIoZWxlbWVudCwgcHJvcGVydHlOYW1lLCBoYW5kbGVyKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG4gICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ2ZpbGVzJykge1xuICAgICAgdGhpcy5zZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHt9O1xuICAgIH1cbiAgfVxuXG4gIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudFt0aGlzLnByb3BlcnR5TmFtZV07XG4gIH07XG5cbiAgVmFsdWVBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBuZXdWYWx1ZSA9PT0gbnVsbCA/ICcnIDogbmV3VmFsdWU7XG4gICAgaWYgKHRoaXMuZWxlbWVudFt0aGlzLnByb3BlcnR5TmFtZV0gIT09IG5ld1ZhbHVlKSB7XG4gICAgICB0aGlzLmVsZW1lbnRbdGhpcy5wcm9wZXJ0eU5hbWVdID0gbmV3VmFsdWU7XG4gICAgICB0aGlzLm5vdGlmeSgpO1xuICAgIH1cbiAgfTtcblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5ub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICB2YXIgbmV3VmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG5cbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuXG4gICAgdGhpcy5vbGRWYWx1ZSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlRXZlbnQoKSB7XG4gICAgdGhpcy5ub3RpZnkoKTtcbiAgfTtcblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICAgIHRoaXMuaGFuZGxlci5zdWJzY3JpYmUodGhpcy5lbGVtZW50LCB0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAodGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSAmJiAhdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLmhhbmRsZXIuZGlzcG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gVmFsdWVBdHRyaWJ1dGVPYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzOCk7XG5cbnZhciBjaGVja2VkQXJyYXlDb250ZXh0ID0gJ0NoZWNrZWRPYnNlcnZlcjphcnJheSc7XG52YXIgY2hlY2tlZFZhbHVlQ29udGV4dCA9ICdDaGVja2VkT2JzZXJ2ZXI6dmFsdWUnO1xuXG5leHBvcnQgdmFyIENoZWNrZWRPYnNlcnZlciA9IChfZGVjOCA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM4KF9jbGFzczkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENoZWNrZWRPYnNlcnZlcihlbGVtZW50LCBoYW5kbGVyLCBvYnNlcnZlckxvY2F0b3IpIHtcbiAgICBcblxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjtcbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgfVxuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICBpZiAodGhpcy5pbml0aWFsU3luYyAmJiB0aGlzLnZhbHVlID09PSBuZXdWYWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmFycmF5T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci51bnN1YnNjcmliZShjaGVja2VkQXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlciA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZWxlbWVudC50eXBlID09PSAnY2hlY2tib3gnICYmIEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKG5ld1ZhbHVlKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci5zdWJzY3JpYmUoY2hlY2tlZEFycmF5Q29udGV4dCwgdGhpcyk7XG4gICAgfVxuXG4gICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdGhpcy52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgIHRoaXMuc3luY2hyb25pemVFbGVtZW50KCk7XG4gICAgdGhpcy5ub3RpZnkoKTtcblxuICAgIGlmICghdGhpcy5pbml0aWFsU3luYykge1xuICAgICAgdGhpcy5pbml0aWFsU3luYyA9IHRydWU7XG4gICAgICB0aGlzLm9ic2VydmVyTG9jYXRvci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoY29udGV4dCwgc3BsaWNlcykge1xuICAgIHRoaXMuc3luY2hyb25pemVFbGVtZW50KCk7XG5cbiAgICBpZiAoIXRoaXMudmFsdWVPYnNlcnZlcikge1xuICAgICAgdGhpcy52YWx1ZU9ic2VydmVyID0gdGhpcy5lbGVtZW50Ll9fb2JzZXJ2ZXJzX18ubW9kZWwgfHwgdGhpcy5lbGVtZW50Ll9fb2JzZXJ2ZXJzX18udmFsdWU7XG4gICAgICBpZiAodGhpcy52YWx1ZU9ic2VydmVyKSB7XG4gICAgICAgIHRoaXMudmFsdWVPYnNlcnZlci5zdWJzY3JpYmUoY2hlY2tlZFZhbHVlQ29udGV4dCwgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuc3luY2hyb25pemVFbGVtZW50ID0gZnVuY3Rpb24gc3luY2hyb25pemVFbGVtZW50KCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgdmFyIGVsZW1lbnRWYWx1ZSA9IGVsZW1lbnQuaGFzT3duUHJvcGVydHkoJ21vZGVsJykgPyBlbGVtZW50Lm1vZGVsIDogZWxlbWVudC52YWx1ZTtcbiAgICB2YXIgaXNSYWRpbyA9IGVsZW1lbnQudHlwZSA9PT0gJ3JhZGlvJztcbiAgICB2YXIgbWF0Y2hlciA9IGVsZW1lbnQubWF0Y2hlciB8fCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfTtcblxuICAgIGVsZW1lbnQuY2hlY2tlZCA9IGlzUmFkaW8gJiYgISFtYXRjaGVyKHZhbHVlLCBlbGVtZW50VmFsdWUpIHx8ICFpc1JhZGlvICYmIHZhbHVlID09PSB0cnVlIHx8ICFpc1JhZGlvICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgcmV0dXJuICEhbWF0Y2hlcihpdGVtLCBlbGVtZW50VmFsdWUpO1xuICAgIH0pICE9PSAtMTtcbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLnN5bmNocm9uaXplVmFsdWUgPSBmdW5jdGlvbiBzeW5jaHJvbml6ZVZhbHVlKCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgdmFyIGVsZW1lbnRWYWx1ZSA9IGVsZW1lbnQuaGFzT3duUHJvcGVydHkoJ21vZGVsJykgPyBlbGVtZW50Lm1vZGVsIDogZWxlbWVudC52YWx1ZTtcbiAgICB2YXIgaW5kZXggPSB2b2lkIDA7XG4gICAgdmFyIG1hdGNoZXIgPSBlbGVtZW50Lm1hdGNoZXIgfHwgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhID09PSBiO1xuICAgIH07XG5cbiAgICBpZiAoZWxlbWVudC50eXBlID09PSAnY2hlY2tib3gnKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgaW5kZXggPSB2YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gISFtYXRjaGVyKGl0ZW0sIGVsZW1lbnRWYWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZWxlbWVudC5jaGVja2VkICYmIGluZGV4ID09PSAtMSkge1xuICAgICAgICAgIHZhbHVlLnB1c2goZWxlbWVudFZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmICghZWxlbWVudC5jaGVja2VkICYmIGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgIHZhbHVlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhbHVlID0gZWxlbWVudC5jaGVja2VkO1xuICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jaGVja2VkKSB7XG4gICAgICB2YWx1ZSA9IGVsZW1lbnRWYWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLm5vdGlmeSgpO1xuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy52YWx1ZTtcblxuICAgIGlmIChuZXdWYWx1ZSA9PT0gb2xkVmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiBoYW5kbGVFdmVudCgpIHtcbiAgICB0aGlzLnN5bmNocm9uaXplVmFsdWUoKTtcbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICghdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLmhhbmRsZXIuc3Vic2NyaWJlKHRoaXMuZWxlbWVudCwgdGhpcyk7XG4gICAgfVxuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkgJiYgIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5oYW5kbGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKHRoaXMuYXJyYXlPYnNlcnZlcikge1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyLnVuc3Vic2NyaWJlKGNoZWNrZWRBcnJheUNvbnRleHQsIHRoaXMpO1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHRoaXMudmFsdWVPYnNlcnZlcikge1xuICAgICAgdGhpcy52YWx1ZU9ic2VydmVyLnVuc3Vic2NyaWJlKGNoZWNrZWRWYWx1ZUNvbnRleHQsIHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2hlY2tlZE9ic2VydmVyO1xufSgpKSB8fCBfY2xhc3M5KTtcblxudmFyIHNlbGVjdEFycmF5Q29udGV4dCA9ICdTZWxlY3RWYWx1ZU9ic2VydmVyOmFycmF5JztcblxuZXhwb3J0IHZhciBTZWxlY3RWYWx1ZU9ic2VydmVyID0gKF9kZWM5ID0gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSwgX2RlYzkoX2NsYXNzMTAgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFNlbGVjdFZhbHVlT2JzZXJ2ZXIoZWxlbWVudCwgaGFuZGxlciwgb2JzZXJ2ZXJMb2NhdG9yKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gIH1cblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmVsZW1lbnQubXVsdGlwbGUgJiYgIUFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgbnVsbCBvciBBcnJheSBpbnN0YW5jZXMgY2FuIGJlIGJvdW5kIHRvIGEgbXVsdGktc2VsZWN0LicpO1xuICAgIH1cbiAgICBpZiAodGhpcy52YWx1ZSA9PT0gbmV3VmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcnJheU9ic2VydmVyKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIudW5zdWJzY3JpYmUoc2VsZWN0QXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlciA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKG5ld1ZhbHVlKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci5zdWJzY3JpYmUoc2VsZWN0QXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgdGhpcy5zeW5jaHJvbml6ZU9wdGlvbnMoKTtcbiAgICB0aGlzLm5vdGlmeSgpO1xuXG4gICAgaWYgKCF0aGlzLmluaXRpYWxTeW5jKSB7XG4gICAgICB0aGlzLmluaXRpYWxTeW5jID0gdHJ1ZTtcbiAgICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoY29udGV4dCwgc3BsaWNlcykge1xuICAgIHRoaXMuc3luY2hyb25pemVPcHRpb25zKCk7XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuc3luY2hyb25pemVPcHRpb25zID0gZnVuY3Rpb24gc3luY2hyb25pemVPcHRpb25zKCkge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdmFyIGlzQXJyYXkgPSB2b2lkIDA7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIGlzQXJyYXkgPSB0cnVlO1xuICAgIH1cblxuICAgIHZhciBvcHRpb25zID0gdGhpcy5lbGVtZW50Lm9wdGlvbnM7XG4gICAgdmFyIGkgPSBvcHRpb25zLmxlbmd0aDtcbiAgICB2YXIgbWF0Y2hlciA9IHRoaXMuZWxlbWVudC5tYXRjaGVyIHx8IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gYSA9PT0gYjtcbiAgICB9O1xuXG4gICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7XG4gICAgICB2YXIgb3B0aW9uID0gb3B0aW9ucy5pdGVtKGkpO1xuICAgICAgdmFyIG9wdGlvblZhbHVlID0gb3B0aW9uLmhhc093blByb3BlcnR5KCdtb2RlbCcpID8gb3B0aW9uLm1vZGVsIDogb3B0aW9uLnZhbHVlO1xuICAgICAgaWYgKGlzQXJyYXkpIHtcbiAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuICEhbWF0Y2hlcihvcHRpb25WYWx1ZSwgaXRlbSk7XG4gICAgICAgIH0pICE9PSAtMTtcbiAgICAgICAgcmV0dXJuICdjb250aW51ZSc7XG4gICAgICB9XG4gICAgICBvcHRpb24uc2VsZWN0ZWQgPSAhIW1hdGNoZXIob3B0aW9uVmFsdWUsIHZhbHVlKTtcbiAgICB9O1xuXG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgdmFyIF9yZXQgPSBfbG9vcCgpO1xuXG4gICAgICBpZiAoX3JldCA9PT0gJ2NvbnRpbnVlJykgY29udGludWU7XG4gICAgfVxuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnN5bmNocm9uaXplVmFsdWUgPSBmdW5jdGlvbiBzeW5jaHJvbml6ZVZhbHVlKCkge1xuICAgIHZhciBfdGhpczIzID0gdGhpcztcblxuICAgIHZhciBvcHRpb25zID0gdGhpcy5lbGVtZW50Lm9wdGlvbnM7XG4gICAgdmFyIGNvdW50ID0gMDtcbiAgICB2YXIgdmFsdWUgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG9wdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xuICAgICAgdmFyIF9vcHRpb24gPSBvcHRpb25zLml0ZW0oaSk7XG4gICAgICBpZiAoIV9vcHRpb24uc2VsZWN0ZWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB2YWx1ZS5wdXNoKF9vcHRpb24uaGFzT3duUHJvcGVydHkoJ21vZGVsJykgPyBfb3B0aW9uLm1vZGVsIDogX29wdGlvbi52YWx1ZSk7XG4gICAgICBjb3VudCsrO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmVsZW1lbnQubXVsdGlwbGUpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpKSB7XG4gICAgICAgIHZhciBfcmV0MiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgbWF0Y2hlciA9IF90aGlzMjMuZWxlbWVudC5tYXRjaGVyIHx8IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYSA9PT0gYjtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdmFyIGkgPSAwO1xuXG4gICAgICAgICAgdmFyIF9sb29wMiA9IGZ1bmN0aW9uIF9sb29wMigpIHtcbiAgICAgICAgICAgIHZhciBhID0gX3RoaXMyMy52YWx1ZVtpXTtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXIoYSwgYik7XG4gICAgICAgICAgICB9KSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgX3RoaXMyMy52YWx1ZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHdoaWxlIChpIDwgX3RoaXMyMy52YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIF9sb29wMigpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGkgPSAwO1xuXG4gICAgICAgICAgdmFyIF9sb29wMyA9IGZ1bmN0aW9uIF9sb29wMygpIHtcbiAgICAgICAgICAgIHZhciBhID0gdmFsdWVbaV07XG4gICAgICAgICAgICBpZiAoX3RoaXMyMy52YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXIoYSwgYik7XG4gICAgICAgICAgICB9KSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgX3RoaXMyMy52YWx1ZS5wdXNoKGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaSsrO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICB3aGlsZSAoaSA8IHZhbHVlLmxlbmd0aCkge1xuICAgICAgICAgICAgX2xvb3AzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2OiB2b2lkIDBcbiAgICAgICAgICB9O1xuICAgICAgICB9KCk7XG5cbiAgICAgICAgaWYgKCh0eXBlb2YgX3JldDIgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9yZXQyKSkgPT09IFwib2JqZWN0XCIpIHJldHVybiBfcmV0Mi52O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgdmFsdWUgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZVswXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodmFsdWUgIT09IHRoaXMudmFsdWUpIHtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgdGhpcy5ub3RpZnkoKTtcbiAgICB9XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy52YWx1ZTtcblxuICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiBoYW5kbGVFdmVudCgpIHtcbiAgICB0aGlzLnN5bmNocm9uaXplVmFsdWUoKTtcbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5oYW5kbGVyLnN1YnNjcmliZSh0aGlzLmVsZW1lbnQsIHRoaXMpO1xuICAgIH1cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAodGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSAmJiAhdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLmhhbmRsZXIuZGlzcG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZCgpIHtcbiAgICB2YXIgX3RoaXMyNCA9IHRoaXM7XG5cbiAgICB0aGlzLmRvbU9ic2VydmVyID0gRE9NLmNyZWF0ZU11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgX3RoaXMyNC5zeW5jaHJvbml6ZU9wdGlvbnMoKTtcbiAgICAgIF90aGlzMjQuc3luY2hyb25pemVWYWx1ZSgpO1xuICAgIH0pO1xuICAgIHRoaXMuZG9tT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLmVsZW1lbnQsIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlLCBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICB0aGlzLmRvbU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB0aGlzLmRvbU9ic2VydmVyID0gbnVsbDtcblxuICAgIGlmICh0aGlzLmFycmF5T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci51bnN1YnNjcmliZShzZWxlY3RBcnJheUNvbnRleHQsIHRoaXMpO1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFNlbGVjdFZhbHVlT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczEwKTtcblxuZXhwb3J0IHZhciBDbGFzc09ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDbGFzc09ic2VydmVyKGVsZW1lbnQpIHtcbiAgICBcblxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5kb05vdENhY2hlID0gdHJ1ZTtcbiAgICB0aGlzLnZhbHVlID0gJyc7XG4gICAgdGhpcy52ZXJzaW9uID0gMDtcbiAgfVxuXG4gIENsYXNzT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH07XG5cbiAgQ2xhc3NPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHZhciBuYW1lSW5kZXggPSB0aGlzLm5hbWVJbmRleCB8fCB7fTtcbiAgICB2YXIgdmVyc2lvbiA9IHRoaXMudmVyc2lvbjtcbiAgICB2YXIgbmFtZXMgPSB2b2lkIDA7XG4gICAgdmFyIG5hbWUgPSB2b2lkIDA7XG5cbiAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZS5sZW5ndGgpIHtcbiAgICAgIG5hbWVzID0gbmV3VmFsdWUuc3BsaXQoL1xccysvKTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBuYW1lcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBuYW1lID0gbmFtZXNbaV07XG4gICAgICAgIGlmIChuYW1lID09PSAnJykge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIG5hbWVJbmRleFtuYW1lXSA9IHZlcnNpb247XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKG5hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB0aGlzLm5hbWVJbmRleCA9IG5hbWVJbmRleDtcbiAgICB0aGlzLnZlcnNpb24gKz0gMTtcblxuICAgIGlmICh2ZXJzaW9uID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmVyc2lvbiAtPSAxO1xuICAgIGZvciAobmFtZSBpbiBuYW1lSW5kZXgpIHtcbiAgICAgIGlmICghbmFtZUluZGV4Lmhhc093blByb3BlcnR5KG5hbWUpIHx8IG5hbWVJbmRleFtuYW1lXSAhPT0gdmVyc2lvbikge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKG5hbWUpO1xuICAgIH1cbiAgfTtcblxuICBDbGFzc09ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdPYnNlcnZhdGlvbiBvZiBhIFwiJyArIHRoaXMuZWxlbWVudC5ub2RlTmFtZSArICdcIiBlbGVtZW50XFwncyBcImNsYXNzXCIgcHJvcGVydHkgaXMgbm90IHN1cHBvcnRlZC4nKTtcbiAgfTtcblxuICByZXR1cm4gQ2xhc3NPYnNlcnZlcjtcbn0oKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGhhc0RlY2xhcmVkRGVwZW5kZW5jaWVzKGRlc2NyaXB0b3IpIHtcbiAgcmV0dXJuICEhKGRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5nZXQgJiYgZGVzY3JpcHRvci5nZXQuZGVwZW5kZW5jaWVzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlY2xhcmVQcm9wZXJ0eURlcGVuZGVuY2llcyhjdG9yLCBwcm9wZXJ0eU5hbWUsIGRlcGVuZGVuY2llcykge1xuICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoY3Rvci5wcm90b3R5cGUsIHByb3BlcnR5TmFtZSk7XG4gIGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVkRnJvbSgpIHtcbiAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHJlc3QgPSBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICByZXN0W19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikge1xuICAgIGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyA9IHJlc3Q7XG4gICAgcmV0dXJuIGRlc2NyaXB0b3I7XG4gIH07XG59XG5cbmV4cG9ydCB2YXIgQ29tcHV0ZWRFeHByZXNzaW9uID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTkpIHtcbiAgX2luaGVyaXRzKENvbXB1dGVkRXhwcmVzc2lvbiwgX0V4cHJlc3Npb24xOSk7XG5cbiAgZnVuY3Rpb24gQ29tcHV0ZWRFeHByZXNzaW9uKG5hbWUsIGRlcGVuZGVuY2llcykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMjUgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE5LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMyNS5uYW1lID0gbmFtZTtcbiAgICBfdGhpczI1LmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcztcbiAgICBfdGhpczI1LmlzQXNzaWduYWJsZSA9IHRydWU7XG4gICAgcmV0dXJuIF90aGlzMjU7XG4gIH1cblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiBzY29wZS5iaW5kaW5nQ29udGV4dFt0aGlzLm5hbWVdO1xuICB9O1xuXG4gIENvbXB1dGVkRXhwcmVzc2lvbi5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSkge1xuICAgIHNjb3BlLmJpbmRpbmdDb250ZXh0W3RoaXMubmFtZV0gPSB2YWx1ZTtcbiAgfTtcblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTtcbiAgfTtcblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGRlcGVuZGVuY2llcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xuICAgIHZhciBpID0gZGVwZW5kZW5jaWVzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBkZXBlbmRlbmNpZXNbaV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDb21wdXRlZEV4cHJlc3Npb247XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29tcHV0ZWRPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRvciwgb2JzZXJ2ZXJMb2NhdG9yKSB7XG4gIHZhciBkZXBlbmRlbmNpZXMgPSBkZXNjcmlwdG9yLmdldC5kZXBlbmRlbmNpZXM7XG4gIGlmICghKGRlcGVuZGVuY2llcyBpbnN0YW5jZW9mIENvbXB1dGVkRXhwcmVzc2lvbikpIHtcbiAgICB2YXIgaSA9IGRlcGVuZGVuY2llcy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgZGVwZW5kZW5jaWVzW2ldID0gb2JzZXJ2ZXJMb2NhdG9yLnBhcnNlci5wYXJzZShkZXBlbmRlbmNpZXNbaV0pO1xuICAgIH1cbiAgICBkZXBlbmRlbmNpZXMgPSBkZXNjcmlwdG9yLmdldC5kZXBlbmRlbmNpZXMgPSBuZXcgQ29tcHV0ZWRFeHByZXNzaW9uKHByb3BlcnR5TmFtZSwgZGVwZW5kZW5jaWVzKTtcbiAgfVxuXG4gIHZhciBzY29wZSA9IHsgYmluZGluZ0NvbnRleHQ6IG9iaiwgb3ZlcnJpZGVDb250ZXh0OiBjcmVhdGVPdmVycmlkZUNvbnRleHQob2JqKSB9O1xuICByZXR1cm4gbmV3IEV4cHJlc3Npb25PYnNlcnZlcihzY29wZSwgZGVwZW5kZW5jaWVzLCBvYnNlcnZlckxvY2F0b3IpO1xufVxuXG52YXIgc3ZnRWxlbWVudHMgPSB2b2lkIDA7XG52YXIgc3ZnUHJlc2VudGF0aW9uRWxlbWVudHMgPSB2b2lkIDA7XG52YXIgc3ZnUHJlc2VudGF0aW9uQXR0cmlidXRlcyA9IHZvaWQgMDtcbnZhciBzdmdBbmFseXplciA9IHZvaWQgMDtcblxuaWYgKHR5cGVvZiBGRUFUVVJFX05PX1NWRyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgc3ZnRWxlbWVudHMgPSB7XG4gICAgYTogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGFyZ2V0JywgJ3RyYW5zZm9ybScsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBhbHRHbHlwaDogWydjbGFzcycsICdkeCcsICdkeScsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2Zvcm1hdCcsICdnbHlwaFJlZicsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3JvdGF0ZScsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgYWx0R2x5cGhEZWY6IFsnaWQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgYWx0R2x5cGhJdGVtOiBbJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGFuaW1hdGU6IFsnYWNjdW11bGF0ZScsICdhZGRpdGl2ZScsICdhdHRyaWJ1dGVOYW1lJywgJ2F0dHJpYnV0ZVR5cGUnLCAnYmVnaW4nLCAnYnknLCAnY2FsY01vZGUnLCAnZHVyJywgJ2VuZCcsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2ZpbGwnLCAnZnJvbScsICdpZCcsICdrZXlTcGxpbmVzJywgJ2tleVRpbWVzJywgJ21heCcsICdtaW4nLCAnb25iZWdpbicsICdvbmVuZCcsICdvbmxvYWQnLCAnb25yZXBlYXQnLCAncmVwZWF0Q291bnQnLCAncmVwZWF0RHVyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3Jlc3RhcnQnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndG8nLCAndmFsdWVzJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGFuaW1hdGVDb2xvcjogWydhY2N1bXVsYXRlJywgJ2FkZGl0aXZlJywgJ2F0dHJpYnV0ZU5hbWUnLCAnYXR0cmlidXRlVHlwZScsICdiZWdpbicsICdieScsICdjYWxjTW9kZScsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdmcm9tJywgJ2lkJywgJ2tleVNwbGluZXMnLCAna2V5VGltZXMnLCAnbWF4JywgJ21pbicsICdvbmJlZ2luJywgJ29uZW5kJywgJ29ubG9hZCcsICdvbnJlcGVhdCcsICdyZXBlYXRDb3VudCcsICdyZXBlYXREdXInLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncmVzdGFydCcsICdzeXN0ZW1MYW5ndWFnZScsICd0bycsICd2YWx1ZXMnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgYW5pbWF0ZU1vdGlvbjogWydhY2N1bXVsYXRlJywgJ2FkZGl0aXZlJywgJ2JlZ2luJywgJ2J5JywgJ2NhbGNNb2RlJywgJ2R1cicsICdlbmQnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmaWxsJywgJ2Zyb20nLCAnaWQnLCAna2V5UG9pbnRzJywgJ2tleVNwbGluZXMnLCAna2V5VGltZXMnLCAnbWF4JywgJ21pbicsICdvbmJlZ2luJywgJ29uZW5kJywgJ29ubG9hZCcsICdvbnJlcGVhdCcsICdvcmlnaW4nLCAncGF0aCcsICdyZXBlYXRDb3VudCcsICdyZXBlYXREdXInLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncmVzdGFydCcsICdyb3RhdGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndG8nLCAndmFsdWVzJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGFuaW1hdGVUcmFuc2Zvcm06IFsnYWNjdW11bGF0ZScsICdhZGRpdGl2ZScsICdhdHRyaWJ1dGVOYW1lJywgJ2F0dHJpYnV0ZVR5cGUnLCAnYmVnaW4nLCAnYnknLCAnY2FsY01vZGUnLCAnZHVyJywgJ2VuZCcsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2ZpbGwnLCAnZnJvbScsICdpZCcsICdrZXlTcGxpbmVzJywgJ2tleVRpbWVzJywgJ21heCcsICdtaW4nLCAnb25iZWdpbicsICdvbmVuZCcsICdvbmxvYWQnLCAnb25yZXBlYXQnLCAncmVwZWF0Q291bnQnLCAncmVwZWF0RHVyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3Jlc3RhcnQnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndG8nLCAndHlwZScsICd2YWx1ZXMnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgY2lyY2xlOiBbJ2NsYXNzJywgJ2N4JywgJ2N5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBjbGlwUGF0aDogWydjbGFzcycsICdjbGlwUGF0aFVuaXRzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgICdjb2xvci1wcm9maWxlJzogWydpZCcsICdsb2NhbCcsICduYW1lJywgJ3JlbmRlcmluZy1pbnRlbnQnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgY3Vyc29yOiBbJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGRlZnM6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBkZXNjOiBbJ2NsYXNzJywgJ2lkJywgJ3N0eWxlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGVsbGlwc2U6IFsnY2xhc3MnLCAnY3gnLCAnY3knLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3J4JywgJ3J5JywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBmZUJsZW5kOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdpbjInLCAnbW9kZScsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlQ29sb3JNYXRyaXg6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ3Jlc3VsdCcsICdzdHlsZScsICd0eXBlJywgJ3ZhbHVlcycsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVDb21wb25lbnRUcmFuc2ZlcjogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZUNvbXBvc2l0ZTogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAnaW4yJywgJ2sxJywgJ2syJywgJ2szJywgJ2s0JywgJ29wZXJhdG9yJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVDb252b2x2ZU1hdHJpeDogWydiaWFzJywgJ2NsYXNzJywgJ2Rpdmlzb3InLCAnZWRnZU1vZGUnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ2tlcm5lbE1hdHJpeCcsICdrZXJuZWxVbml0TGVuZ3RoJywgJ29yZGVyJywgJ3ByZXNlcnZlQWxwaGEnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3RhcmdldFgnLCAndGFyZ2V0WScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVEaWZmdXNlTGlnaHRpbmc6IFsnY2xhc3MnLCAnZGlmZnVzZUNvbnN0YW50JywgJ2hlaWdodCcsICdpZCcsICdpbicsICdrZXJuZWxVbml0TGVuZ3RoJywgJ3Jlc3VsdCcsICdzdHlsZScsICdzdXJmYWNlU2NhbGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlRGlzcGxhY2VtZW50TWFwOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdpbjInLCAncmVzdWx0JywgJ3NjYWxlJywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneENoYW5uZWxTZWxlY3RvcicsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneScsICd5Q2hhbm5lbFNlbGVjdG9yJ10sXG4gICAgZmVEaXN0YW50TGlnaHQ6IFsnYXppbXV0aCcsICdlbGV2YXRpb24nLCAnaWQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZmVGbG9vZDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZUZ1bmNBOiBbJ2FtcGxpdHVkZScsICdleHBvbmVudCcsICdpZCcsICdpbnRlcmNlcHQnLCAnb2Zmc2V0JywgJ3Nsb3BlJywgJ3RhYmxlVmFsdWVzJywgJ3R5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZmVGdW5jQjogWydhbXBsaXR1ZGUnLCAnZXhwb25lbnQnLCAnaWQnLCAnaW50ZXJjZXB0JywgJ29mZnNldCcsICdzbG9wZScsICd0YWJsZVZhbHVlcycsICd0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGZlRnVuY0c6IFsnYW1wbGl0dWRlJywgJ2V4cG9uZW50JywgJ2lkJywgJ2ludGVyY2VwdCcsICdvZmZzZXQnLCAnc2xvcGUnLCAndGFibGVWYWx1ZXMnLCAndHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBmZUZ1bmNSOiBbJ2FtcGxpdHVkZScsICdleHBvbmVudCcsICdpZCcsICdpbnRlcmNlcHQnLCAnb2Zmc2V0JywgJ3Nsb3BlJywgJ3RhYmxlVmFsdWVzJywgJ3R5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZmVHYXVzc2lhbkJsdXI6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ3Jlc3VsdCcsICdzdGREZXZpYXRpb24nLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlSW1hZ2U6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlTWVyZ2U6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVNZXJnZU5vZGU6IFsnaWQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZmVNb3JwaG9sb2d5OiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdvcGVyYXRvcicsICdyYWRpdXMnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZU9mZnNldDogWydjbGFzcycsICdkeCcsICdkeScsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZVBvaW50TGlnaHQ6IFsnaWQnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneScsICd6J10sXG4gICAgZmVTcGVjdWxhckxpZ2h0aW5nOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdrZXJuZWxVbml0TGVuZ3RoJywgJ3Jlc3VsdCcsICdzcGVjdWxhckNvbnN0YW50JywgJ3NwZWN1bGFyRXhwb25lbnQnLCAnc3R5bGUnLCAnc3VyZmFjZVNjYWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZVNwb3RMaWdodDogWydpZCcsICdsaW1pdGluZ0NvbmVBbmdsZScsICdwb2ludHNBdFgnLCAncG9pbnRzQXRZJywgJ3BvaW50c0F0WicsICdzcGVjdWxhckV4cG9uZW50JywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knLCAneiddLFxuICAgIGZlVGlsZTogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZVR1cmJ1bGVuY2U6IFsnYmFzZUZyZXF1ZW5jeScsICdjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnbnVtT2N0YXZlcycsICdyZXN1bHQnLCAnc2VlZCcsICdzdGl0Y2hUaWxlcycsICdzdHlsZScsICd0eXBlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmaWx0ZXI6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmaWx0ZXJSZXMnLCAnZmlsdGVyVW5pdHMnLCAnaGVpZ2h0JywgJ2lkJywgJ3ByaW1pdGl2ZVVuaXRzJywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmb250OiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaG9yaXotYWR2LXgnLCAnaG9yaXotb3JpZ2luLXgnLCAnaG9yaXotb3JpZ2luLXknLCAnaWQnLCAnc3R5bGUnLCAndmVydC1hZHYteScsICd2ZXJ0LW9yaWdpbi14JywgJ3ZlcnQtb3JpZ2luLXknLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgJ2ZvbnQtZmFjZSc6IFsnYWNjZW50LWhlaWdodCcsICdhbHBoYWJldGljJywgJ2FzY2VudCcsICdiYm94JywgJ2NhcC1oZWlnaHQnLCAnZGVzY2VudCcsICdmb250LWZhbWlseScsICdmb250LXNpemUnLCAnZm9udC1zdHJldGNoJywgJ2ZvbnQtc3R5bGUnLCAnZm9udC12YXJpYW50JywgJ2ZvbnQtd2VpZ2h0JywgJ2hhbmdpbmcnLCAnaWQnLCAnaWRlb2dyYXBoaWMnLCAnbWF0aGVtYXRpY2FsJywgJ292ZXJsaW5lLXBvc2l0aW9uJywgJ292ZXJsaW5lLXRoaWNrbmVzcycsICdwYW5vc2UtMScsICdzbG9wZScsICdzdGVtaCcsICdzdGVtdicsICdzdHJpa2V0aHJvdWdoLXBvc2l0aW9uJywgJ3N0cmlrZXRocm91Z2gtdGhpY2tuZXNzJywgJ3VuZGVybGluZS1wb3NpdGlvbicsICd1bmRlcmxpbmUtdGhpY2tuZXNzJywgJ3VuaWNvZGUtcmFuZ2UnLCAndW5pdHMtcGVyLWVtJywgJ3YtYWxwaGFiZXRpYycsICd2LWhhbmdpbmcnLCAndi1pZGVvZ3JhcGhpYycsICd2LW1hdGhlbWF0aWNhbCcsICd3aWR0aHMnLCAneC1oZWlnaHQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgJ2ZvbnQtZmFjZS1mb3JtYXQnOiBbJ2lkJywgJ3N0cmluZycsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICAnZm9udC1mYWNlLW5hbWUnOiBbJ2lkJywgJ25hbWUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgJ2ZvbnQtZmFjZS1zcmMnOiBbJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgICdmb250LWZhY2UtdXJpJzogWydpZCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBmb3JlaWduT2JqZWN0OiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBnOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZ2x5cGg6IFsnYXJhYmljLWZvcm0nLCAnY2xhc3MnLCAnZCcsICdnbHlwaC1uYW1lJywgJ2hvcml6LWFkdi14JywgJ2lkJywgJ2xhbmcnLCAnb3JpZW50YXRpb24nLCAnc3R5bGUnLCAndW5pY29kZScsICd2ZXJ0LWFkdi15JywgJ3ZlcnQtb3JpZ2luLXgnLCAndmVydC1vcmlnaW4teScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBnbHlwaFJlZjogWydjbGFzcycsICdkeCcsICdkeScsICdmb3JtYXQnLCAnZ2x5cGhSZWYnLCAnaWQnLCAnc3R5bGUnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGhrZXJuOiBbJ2cxJywgJ2cyJywgJ2lkJywgJ2snLCAndTEnLCAndTInLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgaW1hZ2U6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd3aWR0aCcsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgbGluZTogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3gxJywgJ3gyJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5MScsICd5MiddLFxuICAgIGxpbmVhckdyYWRpZW50OiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZ3JhZGllbnRUcmFuc2Zvcm0nLCAnZ3JhZGllbnRVbml0cycsICdpZCcsICdzcHJlYWRNZXRob2QnLCAnc3R5bGUnLCAneDEnLCAneDInLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneTEnLCAneTInXSxcbiAgICBtYXJrZXI6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdtYXJrZXJIZWlnaHQnLCAnbWFya2VyVW5pdHMnLCAnbWFya2VyV2lkdGgnLCAnb3JpZW50JywgJ3ByZXNlcnZlQXNwZWN0UmF0aW8nLCAncmVmWCcsICdyZWZZJywgJ3N0eWxlJywgJ3ZpZXdCb3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgbWFzazogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hlaWdodCcsICdpZCcsICdtYXNrQ29udGVudFVuaXRzJywgJ21hc2tVbml0cycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgbWV0YWRhdGE6IFsnaWQnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgJ21pc3NpbmctZ2x5cGgnOiBbJ2NsYXNzJywgJ2QnLCAnaG9yaXotYWR2LXgnLCAnaWQnLCAnc3R5bGUnLCAndmVydC1hZHYteScsICd2ZXJ0LW9yaWdpbi14JywgJ3ZlcnQtb3JpZ2luLXknLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgbXBhdGg6IFsnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBwYXRoOiBbJ2NsYXNzJywgJ2QnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3BhdGhMZW5ndGgnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHBhdHRlcm46IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAncGF0dGVybkNvbnRlbnRVbml0cycsICdwYXR0ZXJuVHJhbnNmb3JtJywgJ3BhdHRlcm5Vbml0cycsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3ZpZXdCb3gnLCAnd2lkdGgnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIHBvbHlnb246IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3BvaW50cycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgcG9seWxpbmU6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3BvaW50cycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgcmFkaWFsR3JhZGllbnQ6IFsnY2xhc3MnLCAnY3gnLCAnY3knLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmeCcsICdmeScsICdncmFkaWVudFRyYW5zZm9ybScsICdncmFkaWVudFVuaXRzJywgJ2lkJywgJ3InLCAnc3ByZWFkTWV0aG9kJywgJ3N0eWxlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgcmVjdDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hlaWdodCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3J4JywgJ3J5JywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgc2NyaXB0OiBbJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAndHlwZScsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBzZXQ6IFsnYXR0cmlidXRlTmFtZScsICdhdHRyaWJ1dGVUeXBlJywgJ2JlZ2luJywgJ2R1cicsICdlbmQnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmaWxsJywgJ2lkJywgJ21heCcsICdtaW4nLCAnb25iZWdpbicsICdvbmVuZCcsICdvbmxvYWQnLCAnb25yZXBlYXQnLCAncmVwZWF0Q291bnQnLCAncmVwZWF0RHVyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3Jlc3RhcnQnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndG8nLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgc3RvcDogWydjbGFzcycsICdpZCcsICdvZmZzZXQnLCAnc3R5bGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgc3R5bGU6IFsnaWQnLCAnbWVkaWEnLCAndGl0bGUnLCAndHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBzdmc6IFsnYmFzZVByb2ZpbGUnLCAnY2xhc3MnLCAnY29udGVudFNjcmlwdFR5cGUnLCAnY29udGVudFN0eWxlVHlwZScsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hlaWdodCcsICdpZCcsICdvbmFib3J0JywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmVycm9yJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdvbnJlc2l6ZScsICdvbnNjcm9sbCcsICdvbnVubG9hZCcsICdvbnpvb20nLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd2ZXJzaW9uJywgJ3ZpZXdCb3gnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneScsICd6b29tQW5kUGFuJ10sXG4gICAgc3dpdGNoOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgc3ltYm9sOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3N0eWxlJywgJ3ZpZXdCb3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgdGV4dDogWydjbGFzcycsICdkeCcsICdkeScsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ2xlbmd0aEFkanVzdCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3JvdGF0ZScsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0ZXh0TGVuZ3RoJywgJ3RyYW5zZm9ybScsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgdGV4dFBhdGg6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdsZW5ndGhBZGp1c3QnLCAnbWV0aG9kJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3BhY2luZycsICdzdGFydE9mZnNldCcsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0ZXh0TGVuZ3RoJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgdGl0bGU6IFsnY2xhc3MnLCAnaWQnLCAnc3R5bGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgdHJlZjogWydjbGFzcycsICdkeCcsICdkeScsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ2xlbmd0aEFkanVzdCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3JvdGF0ZScsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0ZXh0TGVuZ3RoJywgJ3gnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIHRzcGFuOiBbJ2NsYXNzJywgJ2R4JywgJ2R5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnbGVuZ3RoQWRqdXN0JywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAncm90YXRlJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RleHRMZW5ndGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIHVzZTogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hlaWdodCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd3aWR0aCcsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgdmlldzogWydleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ3ByZXNlcnZlQXNwZWN0UmF0aW8nLCAndmlld0JveCcsICd2aWV3VGFyZ2V0JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd6b29tQW5kUGFuJ10sXG4gICAgdmtlcm46IFsnZzEnLCAnZzInLCAnaWQnLCAnaycsICd1MScsICd1MicsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXVxuICB9O1xuXG5cbiAgc3ZnUHJlc2VudGF0aW9uRWxlbWVudHMgPSB7XG4gICAgJ2EnOiB0cnVlLFxuICAgICdhbHRHbHlwaCc6IHRydWUsXG4gICAgJ2FuaW1hdGUnOiB0cnVlLFxuICAgICdhbmltYXRlQ29sb3InOiB0cnVlLFxuICAgICdjaXJjbGUnOiB0cnVlLFxuICAgICdjbGlwUGF0aCc6IHRydWUsXG4gICAgJ2RlZnMnOiB0cnVlLFxuICAgICdlbGxpcHNlJzogdHJ1ZSxcbiAgICAnZmVCbGVuZCc6IHRydWUsXG4gICAgJ2ZlQ29sb3JNYXRyaXgnOiB0cnVlLFxuICAgICdmZUNvbXBvbmVudFRyYW5zZmVyJzogdHJ1ZSxcbiAgICAnZmVDb21wb3NpdGUnOiB0cnVlLFxuICAgICdmZUNvbnZvbHZlTWF0cml4JzogdHJ1ZSxcbiAgICAnZmVEaWZmdXNlTGlnaHRpbmcnOiB0cnVlLFxuICAgICdmZURpc3BsYWNlbWVudE1hcCc6IHRydWUsXG4gICAgJ2ZlRmxvb2QnOiB0cnVlLFxuICAgICdmZUdhdXNzaWFuQmx1cic6IHRydWUsXG4gICAgJ2ZlSW1hZ2UnOiB0cnVlLFxuICAgICdmZU1lcmdlJzogdHJ1ZSxcbiAgICAnZmVNb3JwaG9sb2d5JzogdHJ1ZSxcbiAgICAnZmVPZmZzZXQnOiB0cnVlLFxuICAgICdmZVNwZWN1bGFyTGlnaHRpbmcnOiB0cnVlLFxuICAgICdmZVRpbGUnOiB0cnVlLFxuICAgICdmZVR1cmJ1bGVuY2UnOiB0cnVlLFxuICAgICdmaWx0ZXInOiB0cnVlLFxuICAgICdmb250JzogdHJ1ZSxcbiAgICAnZm9yZWlnbk9iamVjdCc6IHRydWUsXG4gICAgJ2cnOiB0cnVlLFxuICAgICdnbHlwaCc6IHRydWUsXG4gICAgJ2dseXBoUmVmJzogdHJ1ZSxcbiAgICAnaW1hZ2UnOiB0cnVlLFxuICAgICdsaW5lJzogdHJ1ZSxcbiAgICAnbGluZWFyR3JhZGllbnQnOiB0cnVlLFxuICAgICdtYXJrZXInOiB0cnVlLFxuICAgICdtYXNrJzogdHJ1ZSxcbiAgICAnbWlzc2luZy1nbHlwaCc6IHRydWUsXG4gICAgJ3BhdGgnOiB0cnVlLFxuICAgICdwYXR0ZXJuJzogdHJ1ZSxcbiAgICAncG9seWdvbic6IHRydWUsXG4gICAgJ3BvbHlsaW5lJzogdHJ1ZSxcbiAgICAncmFkaWFsR3JhZGllbnQnOiB0cnVlLFxuICAgICdyZWN0JzogdHJ1ZSxcbiAgICAnc3RvcCc6IHRydWUsXG4gICAgJ3N2Zyc6IHRydWUsXG4gICAgJ3N3aXRjaCc6IHRydWUsXG4gICAgJ3N5bWJvbCc6IHRydWUsXG4gICAgJ3RleHQnOiB0cnVlLFxuICAgICd0ZXh0UGF0aCc6IHRydWUsXG4gICAgJ3RyZWYnOiB0cnVlLFxuICAgICd0c3Bhbic6IHRydWUsXG4gICAgJ3VzZSc6IHRydWVcbiAgfTtcblxuICBzdmdQcmVzZW50YXRpb25BdHRyaWJ1dGVzID0ge1xuICAgICdhbGlnbm1lbnQtYmFzZWxpbmUnOiB0cnVlLFxuICAgICdiYXNlbGluZS1zaGlmdCc6IHRydWUsXG4gICAgJ2NsaXAtcGF0aCc6IHRydWUsXG4gICAgJ2NsaXAtcnVsZSc6IHRydWUsXG4gICAgJ2NsaXAnOiB0cnVlLFxuICAgICdjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnOiB0cnVlLFxuICAgICdjb2xvci1pbnRlcnBvbGF0aW9uJzogdHJ1ZSxcbiAgICAnY29sb3ItcHJvZmlsZSc6IHRydWUsXG4gICAgJ2NvbG9yLXJlbmRlcmluZyc6IHRydWUsXG4gICAgJ2NvbG9yJzogdHJ1ZSxcbiAgICAnY3Vyc29yJzogdHJ1ZSxcbiAgICAnZGlyZWN0aW9uJzogdHJ1ZSxcbiAgICAnZGlzcGxheSc6IHRydWUsXG4gICAgJ2RvbWluYW50LWJhc2VsaW5lJzogdHJ1ZSxcbiAgICAnZW5hYmxlLWJhY2tncm91bmQnOiB0cnVlLFxuICAgICdmaWxsLW9wYWNpdHknOiB0cnVlLFxuICAgICdmaWxsLXJ1bGUnOiB0cnVlLFxuICAgICdmaWxsJzogdHJ1ZSxcbiAgICAnZmlsdGVyJzogdHJ1ZSxcbiAgICAnZmxvb2QtY29sb3InOiB0cnVlLFxuICAgICdmbG9vZC1vcGFjaXR5JzogdHJ1ZSxcbiAgICAnZm9udC1mYW1pbHknOiB0cnVlLFxuICAgICdmb250LXNpemUtYWRqdXN0JzogdHJ1ZSxcbiAgICAnZm9udC1zaXplJzogdHJ1ZSxcbiAgICAnZm9udC1zdHJldGNoJzogdHJ1ZSxcbiAgICAnZm9udC1zdHlsZSc6IHRydWUsXG4gICAgJ2ZvbnQtdmFyaWFudCc6IHRydWUsXG4gICAgJ2ZvbnQtd2VpZ2h0JzogdHJ1ZSxcbiAgICAnZ2x5cGgtb3JpZW50YXRpb24taG9yaXpvbnRhbCc6IHRydWUsXG4gICAgJ2dseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsJzogdHJ1ZSxcbiAgICAnaW1hZ2UtcmVuZGVyaW5nJzogdHJ1ZSxcbiAgICAna2VybmluZyc6IHRydWUsXG4gICAgJ2xldHRlci1zcGFjaW5nJzogdHJ1ZSxcbiAgICAnbGlnaHRpbmctY29sb3InOiB0cnVlLFxuICAgICdtYXJrZXItZW5kJzogdHJ1ZSxcbiAgICAnbWFya2VyLW1pZCc6IHRydWUsXG4gICAgJ21hcmtlci1zdGFydCc6IHRydWUsXG4gICAgJ21hc2snOiB0cnVlLFxuICAgICdvcGFjaXR5JzogdHJ1ZSxcbiAgICAnb3ZlcmZsb3cnOiB0cnVlLFxuICAgICdwb2ludGVyLWV2ZW50cyc6IHRydWUsXG4gICAgJ3NoYXBlLXJlbmRlcmluZyc6IHRydWUsXG4gICAgJ3N0b3AtY29sb3InOiB0cnVlLFxuICAgICdzdG9wLW9wYWNpdHknOiB0cnVlLFxuICAgICdzdHJva2UtZGFzaGFycmF5JzogdHJ1ZSxcbiAgICAnc3Ryb2tlLWRhc2hvZmZzZXQnOiB0cnVlLFxuICAgICdzdHJva2UtbGluZWNhcCc6IHRydWUsXG4gICAgJ3N0cm9rZS1saW5lam9pbic6IHRydWUsXG4gICAgJ3N0cm9rZS1taXRlcmxpbWl0JzogdHJ1ZSxcbiAgICAnc3Ryb2tlLW9wYWNpdHknOiB0cnVlLFxuICAgICdzdHJva2Utd2lkdGgnOiB0cnVlLFxuICAgICdzdHJva2UnOiB0cnVlLFxuICAgICd0ZXh0LWFuY2hvcic6IHRydWUsXG4gICAgJ3RleHQtZGVjb3JhdGlvbic6IHRydWUsXG4gICAgJ3RleHQtcmVuZGVyaW5nJzogdHJ1ZSxcbiAgICAndW5pY29kZS1iaWRpJzogdHJ1ZSxcbiAgICAndmlzaWJpbGl0eSc6IHRydWUsXG4gICAgJ3dvcmQtc3BhY2luZyc6IHRydWUsXG4gICAgJ3dyaXRpbmctbW9kZSc6IHRydWVcbiAgfTtcblxuICB2YXIgY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQoaHRtbCkge1xuICAgIHZhciBkaXYgPSBET00uY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgcmV0dXJuIGRpdi5maXJzdENoaWxkO1xuICB9O1xuXG4gIHN2Z0FuYWx5emVyID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNWR0FuYWx5emVyKCkge1xuICAgICAgXG5cbiAgICAgIGlmIChjcmVhdGVFbGVtZW50KCc8c3ZnPjxhbHRHbHlwaCAvPjwvc3ZnPicpLmZpcnN0RWxlbWVudENoaWxkLm5vZGVOYW1lID09PSAnYWx0Z2x5cGgnICYmIGVsZW1lbnRzLmFsdEdseXBoKSB7XG4gICAgICAgIGVsZW1lbnRzLmFsdGdseXBoID0gZWxlbWVudHMuYWx0R2x5cGg7XG4gICAgICAgIGRlbGV0ZSBlbGVtZW50cy5hbHRHbHlwaDtcbiAgICAgICAgZWxlbWVudHMuYWx0Z2x5cGhkZWYgPSBlbGVtZW50cy5hbHRHbHlwaERlZjtcbiAgICAgICAgZGVsZXRlIGVsZW1lbnRzLmFsdEdseXBoRGVmO1xuICAgICAgICBlbGVtZW50cy5hbHRnbHlwaGl0ZW0gPSBlbGVtZW50cy5hbHRHbHlwaEl0ZW07XG4gICAgICAgIGRlbGV0ZSBlbGVtZW50cy5hbHRHbHlwaEl0ZW07XG4gICAgICAgIGVsZW1lbnRzLmdseXBocmVmID0gZWxlbWVudHMuZ2x5cGhSZWY7XG4gICAgICAgIGRlbGV0ZSBlbGVtZW50cy5nbHlwaFJlZjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBTVkdBbmFseXplci5wcm90b3R5cGUuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZSA9IGZ1bmN0aW9uIGlzU3RhbmRhcmRTdmdBdHRyaWJ1dGUobm9kZU5hbWUsIGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgIHJldHVybiBwcmVzZW50YXRpb25FbGVtZW50c1tub2RlTmFtZV0gJiYgcHJlc2VudGF0aW9uQXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSB8fCBlbGVtZW50c1tub2RlTmFtZV0gJiYgZWxlbWVudHNbbm9kZU5hbWVdLmluZGV4T2YoYXR0cmlidXRlTmFtZSkgIT09IC0xO1xuICAgIH07XG5cbiAgICByZXR1cm4gU1ZHQW5hbHl6ZXI7XG4gIH0oKTtcbn1cblxuZXhwb3J0IHZhciBlbGVtZW50cyA9IHN2Z0VsZW1lbnRzO1xuZXhwb3J0IHZhciBwcmVzZW50YXRpb25FbGVtZW50cyA9IHN2Z1ByZXNlbnRhdGlvbkVsZW1lbnRzO1xuZXhwb3J0IHZhciBwcmVzZW50YXRpb25BdHRyaWJ1dGVzID0gc3ZnUHJlc2VudGF0aW9uQXR0cmlidXRlcztcbmV4cG9ydCB2YXIgU1ZHQW5hbHl6ZXIgPSBzdmdBbmFseXplciB8fCBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIF9jbGFzczExKCkge1xuICAgIFxuICB9XG5cbiAgX2NsYXNzMTEucHJvdG90eXBlLmlzU3RhbmRhcmRTdmdBdHRyaWJ1dGUgPSBmdW5jdGlvbiBpc1N0YW5kYXJkU3ZnQXR0cmlidXRlKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICByZXR1cm4gX2NsYXNzMTE7XG59KCk7XG5cbmV4cG9ydCB2YXIgT2JzZXJ2ZXJMb2NhdG9yID0gKF90ZW1wID0gX2NsYXNzMTIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9ic2VydmVyTG9jYXRvcih0YXNrUXVldWUsIGV2ZW50TWFuYWdlciwgZGlydHlDaGVja2VyLCBzdmdBbmFseXplciwgcGFyc2VyKSB7XG4gICAgXG5cbiAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcbiAgICB0aGlzLmV2ZW50TWFuYWdlciA9IGV2ZW50TWFuYWdlcjtcbiAgICB0aGlzLmRpcnR5Q2hlY2tlciA9IGRpcnR5Q2hlY2tlcjtcbiAgICB0aGlzLnN2Z0FuYWx5emVyID0gc3ZnQW5hbHl6ZXI7XG4gICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7XG5cbiAgICB0aGlzLmFkYXB0ZXJzID0gW107XG4gICAgdGhpcy5sb2dnZXIgPSBMb2dNYW5hZ2VyLmdldExvZ2dlcignb2JzZXJ2ZXItbG9jYXRvcicpO1xuICB9XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5nZXRPYnNlcnZlciA9IGZ1bmN0aW9uIGdldE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgdmFyIG9ic2VydmVyc0xvb2t1cCA9IG9iai5fX29ic2VydmVyc19fO1xuICAgIHZhciBvYnNlcnZlciA9IHZvaWQgMDtcblxuICAgIGlmIChvYnNlcnZlcnNMb29rdXAgJiYgcHJvcGVydHlOYW1lIGluIG9ic2VydmVyc0xvb2t1cCkge1xuICAgICAgcmV0dXJuIG9ic2VydmVyc0xvb2t1cFtwcm9wZXJ0eU5hbWVdO1xuICAgIH1cblxuICAgIG9ic2VydmVyID0gdGhpcy5jcmVhdGVQcm9wZXJ0eU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcblxuICAgIGlmICghb2JzZXJ2ZXIuZG9Ob3RDYWNoZSkge1xuICAgICAgaWYgKG9ic2VydmVyc0xvb2t1cCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9ic2VydmVyc0xvb2t1cCA9IHRoaXMuZ2V0T3JDcmVhdGVPYnNlcnZlcnNMb29rdXAob2JqKTtcbiAgICAgIH1cblxuICAgICAgb2JzZXJ2ZXJzTG9va3VwW3Byb3BlcnR5TmFtZV0gPSBvYnNlcnZlcjtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5nZXRPckNyZWF0ZU9ic2VydmVyc0xvb2t1cCA9IGZ1bmN0aW9uIGdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwKG9iaikge1xuICAgIHJldHVybiBvYmouX19vYnNlcnZlcnNfXyB8fCB0aGlzLmNyZWF0ZU9ic2VydmVyc0xvb2t1cChvYmopO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuY3JlYXRlT2JzZXJ2ZXJzTG9va3VwID0gZnVuY3Rpb24gY3JlYXRlT2JzZXJ2ZXJzTG9va3VwKG9iaikge1xuICAgIHZhciB2YWx1ZSA9IHt9O1xuXG4gICAgaWYgKCFSZWZsZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgJ19fb2JzZXJ2ZXJzX18nLCB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICB2YWx1ZTogdmFsdWVcbiAgICB9KSkge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignQ2Fubm90IGFkZCBvYnNlcnZlcnMgdG8gb2JqZWN0Jywgb2JqKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5hZGRBZGFwdGVyID0gZnVuY3Rpb24gYWRkQWRhcHRlcihhZGFwdGVyKSB7XG4gICAgdGhpcy5hZGFwdGVycy5wdXNoKGFkYXB0ZXIpO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0QWRhcHRlck9ic2VydmVyID0gZnVuY3Rpb24gZ2V0QWRhcHRlck9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdGhpcy5hZGFwdGVycy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7XG4gICAgICB2YXIgYWRhcHRlciA9IHRoaXMuYWRhcHRlcnNbaV07XG4gICAgICB2YXIgb2JzZXJ2ZXIgPSBhZGFwdGVyLmdldE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKTtcbiAgICAgIGlmIChvYnNlcnZlcikge1xuICAgICAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuY3JlYXRlUHJvcGVydHlPYnNlcnZlciA9IGZ1bmN0aW9uIGNyZWF0ZVByb3BlcnR5T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICB2YXIgZGVzY3JpcHRvciA9IHZvaWQgMDtcbiAgICB2YXIgaGFuZGxlciA9IHZvaWQgMDtcbiAgICB2YXIgeGxpbmtSZXN1bHQgPSB2b2lkIDA7XG5cbiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBPYmplY3QpKSB7XG4gICAgICByZXR1cm4gbmV3IFByaW1pdGl2ZU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICB9XG5cbiAgICBpZiAob2JqIGluc3RhbmNlb2YgRE9NLkVsZW1lbnQpIHtcbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdjbGFzcycpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDbGFzc09ic2VydmVyKG9iaik7XG4gICAgICB9XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnc3R5bGUnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ2NzcycpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTdHlsZU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgIH1cbiAgICAgIGhhbmRsZXIgPSB0aGlzLmV2ZW50TWFuYWdlci5nZXRFbGVtZW50SGFuZGxlcihvYmosIHByb3BlcnR5TmFtZSk7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAndmFsdWUnICYmIG9iai50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgIHJldHVybiBuZXcgU2VsZWN0VmFsdWVPYnNlcnZlcihvYmosIGhhbmRsZXIsIHRoaXMpO1xuICAgICAgfVxuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ2NoZWNrZWQnICYmIG9iai50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDaGVja2VkT2JzZXJ2ZXIob2JqLCBoYW5kbGVyLCB0aGlzKTtcbiAgICAgIH1cbiAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgVmFsdWVBdHRyaWJ1dGVPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSwgaGFuZGxlcik7XG4gICAgICB9XG4gICAgICB4bGlua1Jlc3VsdCA9IC9eeGxpbms6KC4rKSQvLmV4ZWMocHJvcGVydHlOYW1lKTtcbiAgICAgIGlmICh4bGlua1Jlc3VsdCkge1xuICAgICAgICByZXR1cm4gbmV3IFhMaW5rQXR0cmlidXRlT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIHhsaW5rUmVzdWx0WzFdKTtcbiAgICAgIH1cbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdyb2xlJyAmJiAob2JqIGluc3RhbmNlb2YgRE9NLkVsZW1lbnQgfHwgb2JqIGluc3RhbmNlb2YgRE9NLlNWR0VsZW1lbnQpIHx8IC9eXFx3Kzp8XmRhdGEtfF5hcmlhLS8udGVzdChwcm9wZXJ0eU5hbWUpIHx8IG9iaiBpbnN0YW5jZW9mIERPTS5TVkdFbGVtZW50ICYmIHRoaXMuc3ZnQW5hbHl6ZXIuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZShvYmoubm9kZU5hbWUsIHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0UHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcGVydHlOYW1lKTtcblxuICAgIGlmIChoYXNEZWNsYXJlZERlcGVuZGVuY2llcyhkZXNjcmlwdG9yKSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUNvbXB1dGVkT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IsIHRoaXMpO1xuICAgIH1cblxuICAgIGlmIChkZXNjcmlwdG9yKSB7XG4gICAgICB2YXIgZXhpc3RpbmdHZXR0ZXJPclNldHRlciA9IGRlc2NyaXB0b3IuZ2V0IHx8IGRlc2NyaXB0b3Iuc2V0O1xuICAgICAgaWYgKGV4aXN0aW5nR2V0dGVyT3JTZXR0ZXIpIHtcbiAgICAgICAgaWYgKGV4aXN0aW5nR2V0dGVyT3JTZXR0ZXIuZ2V0T2JzZXJ2ZXIpIHtcbiAgICAgICAgICByZXR1cm4gZXhpc3RpbmdHZXR0ZXJPclNldHRlci5nZXRPYnNlcnZlcihvYmopO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFkYXB0ZXJPYnNlcnZlciA9IHRoaXMuZ2V0QWRhcHRlck9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKTtcbiAgICAgICAgaWYgKGFkYXB0ZXJPYnNlcnZlcikge1xuICAgICAgICAgIHJldHVybiBhZGFwdGVyT2JzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBEaXJ0eUNoZWNrUHJvcGVydHkodGhpcy5kaXJ0eUNoZWNrZXIsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob2JqIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdsZW5ndGgnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFycmF5T2JzZXJ2ZXIob2JqKS5nZXRMZW5ndGhPYnNlcnZlcigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IERpcnR5Q2hlY2tQcm9wZXJ0eSh0aGlzLmRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnc2l6ZScpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWFwT2JzZXJ2ZXIob2JqKS5nZXRMZW5ndGhPYnNlcnZlcigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IERpcnR5Q2hlY2tQcm9wZXJ0eSh0aGlzLmRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgU2V0KSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnc2l6ZScpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2V0T2JzZXJ2ZXIob2JqKS5nZXRMZW5ndGhPYnNlcnZlcigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IERpcnR5Q2hlY2tQcm9wZXJ0eSh0aGlzLmRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgU2V0dGVyT2JzZXJ2ZXIodGhpcy50YXNrUXVldWUsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldEFjY2Vzc29yID0gZnVuY3Rpb24gZ2V0QWNjZXNzb3Iob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgRE9NLkVsZW1lbnQpIHtcbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdjbGFzcycgfHwgcHJvcGVydHlOYW1lID09PSAnc3R5bGUnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ2NzcycgfHwgcHJvcGVydHlOYW1lID09PSAndmFsdWUnICYmIChvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnIHx8IG9iai50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB8fCBwcm9wZXJ0eU5hbWUgPT09ICdjaGVja2VkJyAmJiBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ21vZGVsJyAmJiBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnIHx8IC9eeGxpbms6LiskLy5leGVjKHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgICAgaWYgKC9eXFx3Kzp8XmRhdGEtfF5hcmlhLS8udGVzdChwcm9wZXJ0eU5hbWUpIHx8IG9iaiBpbnN0YW5jZW9mIERPTS5TVkdFbGVtZW50ICYmIHRoaXMuc3ZnQW5hbHl6ZXIuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZShvYmoubm9kZU5hbWUsIHByb3BlcnR5TmFtZSkgfHwgb2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2ltZycgJiYgcHJvcGVydHlOYW1lID09PSAnc3JjJyB8fCBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYScgJiYgcHJvcGVydHlOYW1lID09PSAnaHJlZicpIHtcbiAgICAgICAgcmV0dXJuIGRhdGFBdHRyaWJ1dGVBY2Nlc3NvcjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHByb3BlcnR5QWNjZXNzb3I7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5nZXRBcnJheU9ic2VydmVyID0gZnVuY3Rpb24gZ2V0QXJyYXlPYnNlcnZlcihhcnJheSkge1xuICAgIHJldHVybiBfZ2V0QXJyYXlPYnNlcnZlcih0aGlzLnRhc2tRdWV1ZSwgYXJyYXkpO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0TWFwT2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRNYXBPYnNlcnZlcihtYXApIHtcbiAgICByZXR1cm4gX2dldE1hcE9ic2VydmVyKHRoaXMudGFza1F1ZXVlLCBtYXApO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0U2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRTZXRPYnNlcnZlcihzZXQpIHtcbiAgICByZXR1cm4gX2dldFNldE9ic2VydmVyKHRoaXMudGFza1F1ZXVlLCBzZXQpO1xuICB9O1xuXG4gIHJldHVybiBPYnNlcnZlckxvY2F0b3I7XG59KCksIF9jbGFzczEyLmluamVjdCA9IFtUYXNrUXVldWUsIEV2ZW50TWFuYWdlciwgRGlydHlDaGVja2VyLCBTVkdBbmFseXplciwgUGFyc2VyXSwgX3RlbXApO1xuXG5leHBvcnQgdmFyIE9iamVjdE9ic2VydmF0aW9uQWRhcHRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gT2JqZWN0T2JzZXJ2YXRpb25BZGFwdGVyKCkge1xuICAgIFxuICB9XG5cbiAgT2JqZWN0T2JzZXJ2YXRpb25BZGFwdGVyLnByb3RvdHlwZS5nZXRPYnNlcnZlciA9IGZ1bmN0aW9uIGdldE9ic2VydmVyKG9iamVjdCwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCaW5kaW5nQWRhcHRlcnMgbXVzdCBpbXBsZW1lbnQgZ2V0T2JzZXJ2ZXIob2JqZWN0LCBwcm9wZXJ0eU5hbWUpLicpO1xuICB9O1xuXG4gIHJldHVybiBPYmplY3RPYnNlcnZhdGlvbkFkYXB0ZXI7XG59KCk7XG5cbmV4cG9ydCB2YXIgQmluZGluZ0V4cHJlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJpbmRpbmdFeHByZXNzaW9uKG9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHNvdXJjZUV4cHJlc3Npb24sIG1vZGUsIGxvb2t1cEZ1bmN0aW9ucywgYXR0cmlidXRlKSB7XG4gICAgXG5cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICAgIHRoaXMuYXR0cmlidXRlID0gYXR0cmlidXRlO1xuICAgIHRoaXMuZGlzY3JldGUgPSBmYWxzZTtcbiAgfVxuXG4gIEJpbmRpbmdFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZyh0YXJnZXQpIHtcbiAgICByZXR1cm4gbmV3IEJpbmRpbmcodGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLm1vZGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICByZXR1cm4gQmluZGluZ0V4cHJlc3Npb247XG59KCk7XG5cbmV4cG9ydCB2YXIgQmluZGluZyA9IChfZGVjMTAgPSBjb25uZWN0YWJsZSgpLCBfZGVjMTAoX2NsYXNzMTMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJpbmRpbmcob2JzZXJ2ZXJMb2NhdG9yLCBzb3VyY2VFeHByZXNzaW9uLCB0YXJnZXQsIHRhcmdldFByb3BlcnR5LCBtb2RlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xuICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBCaW5kaW5nLnByb3RvdHlwZS51cGRhdGVUYXJnZXQgPSBmdW5jdGlvbiB1cGRhdGVUYXJnZXQodmFsdWUpIHtcbiAgICB0aGlzLnRhcmdldE9ic2VydmVyLnNldFZhbHVlKHZhbHVlLCB0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSk7XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUudXBkYXRlU291cmNlID0gZnVuY3Rpb24gdXBkYXRlU291cmNlKHZhbHVlKSB7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmFzc2lnbih0aGlzLnNvdXJjZSwgdmFsdWUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBCaW5kaW5nLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbChjb250ZXh0LCBuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dCA9PT0gc291cmNlQ29udGV4dCkge1xuICAgICAgb2xkVmFsdWUgPSB0aGlzLnRhcmdldE9ic2VydmVyLmdldFZhbHVlKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5KTtcbiAgICAgIG5ld1ZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMudXBkYXRlVGFyZ2V0KG5ld1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1vZGUgIT09IGJpbmRpbmdNb2RlLm9uZVRpbWUpIHtcbiAgICAgICAgdGhpcy5fdmVyc2lvbisrO1xuICAgICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNvdXJjZSk7XG4gICAgICAgIHRoaXMudW5vYnNlcnZlKGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQgPT09IHRhcmdldENvbnRleHQpIHtcbiAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucykpIHtcbiAgICAgICAgdGhpcy51cGRhdGVTb3VyY2UobmV3VmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgY2FsbCBjb250ZXh0ICcgKyBjb250ZXh0KTtcbiAgfTtcblxuICBCaW5kaW5nLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYmluZCh0aGlzLCBzb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICB2YXIgbW9kZSA9IHRoaXMubW9kZTtcbiAgICBpZiAoIXRoaXMudGFyZ2V0T2JzZXJ2ZXIpIHtcbiAgICAgIHZhciBtZXRob2QgPSBtb2RlID09PSBiaW5kaW5nTW9kZS50d29XYXkgfHwgbW9kZSA9PT0gYmluZGluZ01vZGUuZnJvbVZpZXcgPyAnZ2V0T2JzZXJ2ZXInIDogJ2dldEFjY2Vzc29yJztcbiAgICAgIHRoaXMudGFyZ2V0T2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvclttZXRob2RdKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5KTtcbiAgICB9XG5cbiAgICBpZiAoJ2JpbmQnIGluIHRoaXMudGFyZ2V0T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMudGFyZ2V0T2JzZXJ2ZXIuYmluZCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5tb2RlICE9PSBiaW5kaW5nTW9kZS5mcm9tVmlldykge1xuICAgICAgdmFyIHZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgdGhpcy51cGRhdGVUYXJnZXQodmFsdWUpO1xuICAgIH1cblxuICAgIGlmIChtb2RlID09PSBiaW5kaW5nTW9kZS5vbmVUaW1lKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChtb2RlID09PSBiaW5kaW5nTW9kZS50b1ZpZXcpIHtcbiAgICAgIGVucXVldWVCaW5kaW5nQ29ubmVjdCh0aGlzKTtcbiAgICB9IGVsc2UgaWYgKG1vZGUgPT09IGJpbmRpbmdNb2RlLnR3b1dheSkge1xuICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgc291cmNlKTtcbiAgICAgIHRoaXMudGFyZ2V0T2JzZXJ2ZXIuc3Vic2NyaWJlKHRhcmdldENvbnRleHQsIHRoaXMpO1xuICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gYmluZGluZ01vZGUuZnJvbVZpZXcpIHtcbiAgICAgIHRoaXMudGFyZ2V0T2JzZXJ2ZXIuc3Vic2NyaWJlKHRhcmdldENvbnRleHQsIHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBCaW5kaW5nLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgaWYgKCd1bmJpbmQnIGluIHRoaXMudGFyZ2V0T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMudGFyZ2V0T2JzZXJ2ZXIudW5iaW5kKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnRhcmdldE9ic2VydmVyLnVuc3Vic2NyaWJlKSB7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLnVuc3Vic2NyaWJlKHRhcmdldENvbnRleHQsIHRoaXMpO1xuICAgIH1cbiAgICB0aGlzLnVub2JzZXJ2ZSh0cnVlKTtcbiAgfTtcblxuICBCaW5kaW5nLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChldmFsdWF0ZSkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChldmFsdWF0ZSkge1xuICAgICAgdmFyIHZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICB0aGlzLnVwZGF0ZVRhcmdldCh2YWx1ZSk7XG4gICAgfVxuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHRoaXMuc291cmNlKTtcbiAgfTtcblxuICByZXR1cm4gQmluZGluZztcbn0oKSkgfHwgX2NsYXNzMTMpO1xuXG5leHBvcnQgdmFyIENhbGxFeHByZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDYWxsRXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBzb3VyY2VFeHByZXNzaW9uLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgQ2FsbEV4cHJlc3Npb24ucHJvdG90eXBlLmNyZWF0ZUJpbmRpbmcgPSBmdW5jdGlvbiBjcmVhdGVCaW5kaW5nKHRhcmdldCkge1xuICAgIHJldHVybiBuZXcgQ2FsbCh0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5zb3VyY2VFeHByZXNzaW9uLCB0YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHksIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICByZXR1cm4gQ2FsbEV4cHJlc3Npb247XG59KCk7XG5cbmV4cG9ydCB2YXIgQ2FsbCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2FsbChvYnNlcnZlckxvY2F0b3IsIHNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGFyZ2V0UHJvcGVydHksIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gb2JzZXJ2ZXJMb2NhdG9yLmdldE9ic2VydmVyKHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgQ2FsbC5wcm90b3R5cGUuY2FsbFNvdXJjZSA9IGZ1bmN0aW9uIGNhbGxTb3VyY2UoJGV2ZW50KSB7XG4gICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IHRoaXMuc291cmNlLm92ZXJyaWRlQ29udGV4dDtcbiAgICBPYmplY3QuYXNzaWduKG92ZXJyaWRlQ29udGV4dCwgJGV2ZW50KTtcbiAgICBvdmVycmlkZUNvbnRleHQuJGV2ZW50ID0gJGV2ZW50O1xuICAgIHZhciBtdXN0RXZhbHVhdGUgPSB0cnVlO1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zLCBtdXN0RXZhbHVhdGUpO1xuICAgIGRlbGV0ZSBvdmVycmlkZUNvbnRleHQuJGV2ZW50O1xuICAgIGZvciAodmFyIHByb3AgaW4gJGV2ZW50KSB7XG4gICAgICBkZWxldGUgb3ZlcnJpZGVDb250ZXh0W3Byb3BdO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIENhbGwucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIHZhciBfdGhpczI2ID0gdGhpcztcblxuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cbiAgICB0aGlzLnRhcmdldFByb3BlcnR5LnNldFZhbHVlKGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgIHJldHVybiBfdGhpczI2LmNhbGxTb3VyY2UoJGV2ZW50KTtcbiAgICB9KTtcbiAgfTtcblxuICBDYWxsLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eS5zZXRWYWx1ZShudWxsKTtcbiAgfTtcblxuICByZXR1cm4gQ2FsbDtcbn0oKTtcblxuZXhwb3J0IHZhciBWYWx1ZUNvbnZlcnRlclJlc291cmNlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWYWx1ZUNvbnZlcnRlclJlc291cmNlKG5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gIH1cblxuICBWYWx1ZUNvbnZlcnRlclJlc291cmNlLmNvbnZlbnRpb24gPSBmdW5jdGlvbiBjb252ZW50aW9uKG5hbWUpIHtcbiAgICBpZiAobmFtZS5lbmRzV2l0aCgnVmFsdWVDb252ZXJ0ZXInKSkge1xuICAgICAgcmV0dXJuIG5ldyBWYWx1ZUNvbnZlcnRlclJlc291cmNlKGNhbWVsQ2FzZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDE0KSkpO1xuICAgIH1cbiAgfTtcblxuICBWYWx1ZUNvbnZlcnRlclJlc291cmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gaW5pdGlhbGl6ZShjb250YWluZXIsIHRhcmdldCkge1xuICAgIHRoaXMuaW5zdGFuY2UgPSBjb250YWluZXIuZ2V0KHRhcmdldCk7XG4gIH07XG5cbiAgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihyZWdpc3RyeSwgbmFtZSkge1xuICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyVmFsdWVDb252ZXJ0ZXIobmFtZSB8fCB0aGlzLm5hbWUsIHRoaXMuaW5zdGFuY2UpO1xuICB9O1xuXG4gIFZhbHVlQ29udmVydGVyUmVzb3VyY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiBsb2FkKGNvbnRhaW5lciwgdGFyZ2V0KSB7fTtcblxuICByZXR1cm4gVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZTtcbn0oKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZhbHVlQ29udmVydGVyKG5hbWVPclRhcmdldCkge1xuICBpZiAobmFtZU9yVGFyZ2V0ID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG5hbWVPclRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZShuYW1lT3JUYXJnZXQpLCB0YXJnZXQpO1xuICAgIH07XG4gIH1cblxuICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIG5ldyBWYWx1ZUNvbnZlcnRlclJlc291cmNlKCksIG5hbWVPclRhcmdldCk7XG59XG5cbmV4cG9ydCB2YXIgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJpbmRpbmdCZWhhdmlvclJlc291cmNlKG5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gIH1cblxuICBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gY29udmVudGlvbihuYW1lKSB7XG4gICAgaWYgKG5hbWUuZW5kc1dpdGgoJ0JpbmRpbmdCZWhhdmlvcicpKSB7XG4gICAgICByZXR1cm4gbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKGNhbWVsQ2FzZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDE1KSkpO1xuICAgIH1cbiAgfTtcblxuICBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB0aGlzLmluc3RhbmNlID0gY29udGFpbmVyLmdldCh0YXJnZXQpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKSB7XG4gICAgcmVnaXN0cnkucmVnaXN0ZXJCaW5kaW5nQmVoYXZpb3IobmFtZSB8fCB0aGlzLm5hbWUsIHRoaXMuaW5zdGFuY2UpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gbG9hZChjb250YWluZXIsIHRhcmdldCkge307XG5cbiAgcmV0dXJuIEJpbmRpbmdCZWhhdmlvclJlc291cmNlO1xufSgpO1xuXG5leHBvcnQgZnVuY3Rpb24gYmluZGluZ0JlaGF2aW9yKG5hbWVPclRhcmdldCkge1xuICBpZiAobmFtZU9yVGFyZ2V0ID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG5hbWVPclRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UobmFtZU9yVGFyZ2V0KSwgdGFyZ2V0KTtcbiAgICB9O1xuICB9XG5cbiAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UoKSwgbmFtZU9yVGFyZ2V0KTtcbn1cblxuZXhwb3J0IHZhciBMaXN0ZW5lckV4cHJlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExpc3RlbmVyRXhwcmVzc2lvbihldmVudE1hbmFnZXIsIHRhcmdldEV2ZW50LCBzb3VyY2VFeHByZXNzaW9uLCBkZWxlZ2F0aW9uU3RyYXRlZ3ksIHByZXZlbnREZWZhdWx0LCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICAgIHRoaXMudGFyZ2V0RXZlbnQgPSB0YXJnZXRFdmVudDtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMuZGVsZWdhdGlvblN0cmF0ZWd5ID0gZGVsZWdhdGlvblN0cmF0ZWd5O1xuICAgIHRoaXMuZGlzY3JldGUgPSB0cnVlO1xuICAgIHRoaXMucHJldmVudERlZmF1bHQgPSBwcmV2ZW50RGVmYXVsdDtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIExpc3RlbmVyRXhwcmVzc2lvbi5wcm90b3R5cGUuY3JlYXRlQmluZGluZyA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmcodGFyZ2V0KSB7XG4gICAgcmV0dXJuIG5ldyBMaXN0ZW5lcih0aGlzLmV2ZW50TWFuYWdlciwgdGhpcy50YXJnZXRFdmVudCwgdGhpcy5kZWxlZ2F0aW9uU3RyYXRlZ3ksIHRoaXMuc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCB0aGlzLnByZXZlbnREZWZhdWx0LCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIExpc3RlbmVyRXhwcmVzc2lvbjtcbn0oKTtcblxuZXhwb3J0IHZhciBMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGlzdGVuZXIoZXZlbnRNYW5hZ2VyLCB0YXJnZXRFdmVudCwgZGVsZWdhdGlvblN0cmF0ZWd5LCBzb3VyY2VFeHByZXNzaW9uLCB0YXJnZXQsIHByZXZlbnREZWZhdWx0LCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICAgIHRoaXMudGFyZ2V0RXZlbnQgPSB0YXJnZXRFdmVudDtcbiAgICB0aGlzLmRlbGVnYXRpb25TdHJhdGVneSA9IGRlbGVnYXRpb25TdHJhdGVneTtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMucHJldmVudERlZmF1bHQgPSBwcmV2ZW50RGVmYXVsdDtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIExpc3RlbmVyLnByb3RvdHlwZS5jYWxsU291cmNlID0gZnVuY3Rpb24gY2FsbFNvdXJjZShldmVudCkge1xuICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSB0aGlzLnNvdXJjZS5vdmVycmlkZUNvbnRleHQ7XG4gICAgb3ZlcnJpZGVDb250ZXh0LiRldmVudCA9IGV2ZW50O1xuICAgIHZhciBtdXN0RXZhbHVhdGUgPSB0cnVlO1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zLCBtdXN0RXZhbHVhdGUpO1xuICAgIGRlbGV0ZSBvdmVycmlkZUNvbnRleHQuJGV2ZW50O1xuICAgIGlmIChyZXN1bHQgIT09IHRydWUgJiYgdGhpcy5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBMaXN0ZW5lci5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiBoYW5kbGVFdmVudChldmVudCkge1xuICAgIHRoaXMuY2FsbFNvdXJjZShldmVudCk7XG4gIH07XG5cbiAgTGlzdGVuZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cbiAgICB0aGlzLl9oYW5kbGVyID0gdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRFdmVudCwgdGhpcywgdGhpcy5kZWxlZ2F0aW9uU3RyYXRlZ3ksIHRydWUpO1xuICB9O1xuXG4gIExpc3RlbmVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy5faGFuZGxlci5kaXNwb3NlKCk7XG4gICAgdGhpcy5faGFuZGxlciA9IG51bGw7XG4gIH07XG5cbiAgcmV0dXJuIExpc3RlbmVyO1xufSgpO1xuXG5mdW5jdGlvbiBnZXRBVShlbGVtZW50KSB7XG4gIHZhciBhdSA9IGVsZW1lbnQuYXU7XG5cbiAgaWYgKGF1ID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIEF1cmVsaWEgQVBJcyBhcmUgZGVmaW5lZCBmb3IgdGhlIGVsZW1lbnQ6IFwiJyArIGVsZW1lbnQudGFnTmFtZSArICdcIi4nKTtcbiAgfVxuXG4gIHJldHVybiBhdTtcbn1cblxuZXhwb3J0IHZhciBOYW1lRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTmFtZUV4cHJlc3Npb24oc291cmNlRXhwcmVzc2lvbiwgYXBpTmFtZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMuYXBpTmFtZSA9IGFwaU5hbWU7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gICAgdGhpcy5kaXNjcmV0ZSA9IHRydWU7XG4gIH1cblxuICBOYW1lRXhwcmVzc2lvbi5wcm90b3R5cGUuY3JlYXRlQmluZGluZyA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmcodGFyZ2V0KSB7XG4gICAgcmV0dXJuIG5ldyBOYW1lQmluZGVyKHRoaXMuc291cmNlRXhwcmVzc2lvbiwgTmFtZUV4cHJlc3Npb24ubG9jYXRlQVBJKHRhcmdldCwgdGhpcy5hcGlOYW1lKSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIE5hbWVFeHByZXNzaW9uLmxvY2F0ZUFQSSA9IGZ1bmN0aW9uIGxvY2F0ZUFQSShlbGVtZW50LCBhcGlOYW1lKSB7XG4gICAgc3dpdGNoIChhcGlOYW1lKSB7XG4gICAgICBjYXNlICdlbGVtZW50JzpcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICBjYXNlICdjb250cm9sbGVyJzpcbiAgICAgICAgcmV0dXJuIGdldEFVKGVsZW1lbnQpLmNvbnRyb2xsZXI7XG4gICAgICBjYXNlICd2aWV3LW1vZGVsJzpcbiAgICAgICAgcmV0dXJuIGdldEFVKGVsZW1lbnQpLmNvbnRyb2xsZXIudmlld01vZGVsO1xuICAgICAgY2FzZSAndmlldyc6XG4gICAgICAgIHJldHVybiBnZXRBVShlbGVtZW50KS5jb250cm9sbGVyLnZpZXc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB2YXIgdGFyZ2V0ID0gZ2V0QVUoZWxlbWVudClbYXBpTmFtZV07XG5cbiAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0ZWQgdG8gcmVmZXJlbmNlIFwiJyArIGFwaU5hbWUgKyAnXCIsIGJ1dCBpdCB3YXMgbm90IGZvdW5kIGFtb25nc3QgdGhlIHRhcmdldFxcJ3MgQVBJLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhcmdldC52aWV3TW9kZWw7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBOYW1lRXhwcmVzc2lvbjtcbn0oKTtcblxudmFyIE5hbWVCaW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE5hbWVCaW5kZXIoc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBOYW1lQmluZGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24uYmluZCkge1xuICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQodGhpcywgc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5hc3NpZ24odGhpcy5zb3VyY2UsIHRoaXMudGFyZ2V0LCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgTmFtZUJpbmRlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKSA9PT0gdGhpcy50YXJnZXQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5hc3NpZ24odGhpcy5zb3VyY2UsIG51bGwsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gIH07XG5cbiAgcmV0dXJuIE5hbWVCaW5kZXI7XG59KCk7XG5cbnZhciBMb29rdXBGdW5jdGlvbnMgPSB7XG4gIGJpbmRpbmdCZWhhdmlvcnM6IGZ1bmN0aW9uIGJpbmRpbmdCZWhhdmlvcnMobmFtZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9LFxuICB2YWx1ZUNvbnZlcnRlcnM6IGZ1bmN0aW9uIHZhbHVlQ29udmVydGVycyhuYW1lKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbmV4cG9ydCB2YXIgQmluZGluZ0VuZ2luZSA9IChfdGVtcDIgPSBfY2xhc3MxNCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQmluZGluZ0VuZ2luZShvYnNlcnZlckxvY2F0b3IsIHBhcnNlcikge1xuICAgIFxuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7XG4gIH1cblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdFeHByZXNzaW9uKHRhcmdldFByb3BlcnR5LCBzb3VyY2VFeHByZXNzaW9uKSB7XG4gICAgdmFyIG1vZGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGJpbmRpbmdNb2RlLnRvVmlldztcbiAgICB2YXIgbG9va3VwRnVuY3Rpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBMb29rdXBGdW5jdGlvbnM7XG5cbiAgICByZXR1cm4gbmV3IEJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0YXJnZXRQcm9wZXJ0eSwgdGhpcy5wYXJzZXIucGFyc2Uoc291cmNlRXhwcmVzc2lvbiksIG1vZGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZ0VuZ2luZS5wcm90b3R5cGUucHJvcGVydHlPYnNlcnZlciA9IGZ1bmN0aW9uIHByb3BlcnR5T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICB2YXIgX3RoaXMyNyA9IHRoaXM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUoY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIG9ic2VydmVyID0gX3RoaXMyNy5vYnNlcnZlckxvY2F0b3IuZ2V0T2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgICBvYnNlcnZlci5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIudW5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIEJpbmRpbmdFbmdpbmUucHJvdG90eXBlLmNvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIGNvbGxlY3Rpb25PYnNlcnZlcihjb2xsZWN0aW9uKSB7XG4gICAgdmFyIF90aGlzMjggPSB0aGlzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1YnNjcmliZTogZnVuY3Rpb24gc3Vic2NyaWJlKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBvYnNlcnZlciA9IHZvaWQgMDtcbiAgICAgICAgaWYgKGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgIG9ic2VydmVyID0gX3RoaXMyOC5vYnNlcnZlckxvY2F0b3IuZ2V0QXJyYXlPYnNlcnZlcihjb2xsZWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgICAgICAgb2JzZXJ2ZXIgPSBfdGhpczI4Lm9ic2VydmVyTG9jYXRvci5nZXRNYXBPYnNlcnZlcihjb2xsZWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb2xsZWN0aW9uIGluc3RhbmNlb2YgU2V0KSB7XG4gICAgICAgICAgb2JzZXJ2ZXIgPSBfdGhpczI4Lm9ic2VydmVyTG9jYXRvci5nZXRTZXRPYnNlcnZlcihjb2xsZWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxlY3Rpb24gbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBBcnJheSwgTWFwIG9yIFNldC4nKTtcbiAgICAgICAgfVxuICAgICAgICBvYnNlcnZlci5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIudW5zdWJzY3JpYmUoY2FsbGJhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIEJpbmRpbmdFbmdpbmUucHJvdG90eXBlLmV4cHJlc3Npb25PYnNlcnZlciA9IGZ1bmN0aW9uIGV4cHJlc3Npb25PYnNlcnZlcihiaW5kaW5nQ29udGV4dCwgZXhwcmVzc2lvbikge1xuICAgIHZhciBzY29wZSA9IHsgYmluZGluZ0NvbnRleHQ6IGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQ6IGNyZWF0ZU92ZXJyaWRlQ29udGV4dChiaW5kaW5nQ29udGV4dCkgfTtcbiAgICByZXR1cm4gbmV3IEV4cHJlc3Npb25PYnNlcnZlcihzY29wZSwgdGhpcy5wYXJzZXIucGFyc2UoZXhwcmVzc2lvbiksIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCBMb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIEJpbmRpbmdFbmdpbmUucHJvdG90eXBlLnBhcnNlRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbihleHByZXNzaW9uKSB7XG4gICAgcmV0dXJuIHRoaXMucGFyc2VyLnBhcnNlKGV4cHJlc3Npb24pO1xuICB9O1xuXG4gIEJpbmRpbmdFbmdpbmUucHJvdG90eXBlLnJlZ2lzdGVyQWRhcHRlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyQWRhcHRlcihhZGFwdGVyKSB7XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IuYWRkQWRhcHRlcihhZGFwdGVyKTtcbiAgfTtcblxuICByZXR1cm4gQmluZGluZ0VuZ2luZTtcbn0oKSwgX2NsYXNzMTQuaW5qZWN0ID0gW09ic2VydmVyTG9jYXRvciwgUGFyc2VyXSwgX3RlbXAyKTtcblxudmFyIHNldFByb3RvID0gU2V0LnByb3RvdHlwZTtcblxuZnVuY3Rpb24gX2dldFNldE9ic2VydmVyKHRhc2tRdWV1ZSwgc2V0KSB7XG4gIHJldHVybiBNb2RpZnlTZXRPYnNlcnZlci5mb3IodGFza1F1ZXVlLCBzZXQpO1xufVxuXG52YXIgTW9kaWZ5U2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiAoX01vZGlmeUNvbGxlY3Rpb25PYnNlMykge1xuICBfaW5oZXJpdHMoTW9kaWZ5U2V0T2JzZXJ2ZXIsIF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTMpO1xuXG4gIGZ1bmN0aW9uIE1vZGlmeVNldE9ic2VydmVyKHRhc2tRdWV1ZSwgc2V0KSB7XG4gICAgXG5cbiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX01vZGlmeUNvbGxlY3Rpb25PYnNlMy5jYWxsKHRoaXMsIHRhc2tRdWV1ZSwgc2V0KSk7XG4gIH1cblxuICBNb2RpZnlTZXRPYnNlcnZlci5mb3IgPSBmdW5jdGlvbiBfZm9yKHRhc2tRdWV1ZSwgc2V0KSB7XG4gICAgaWYgKCEoJ19fc2V0X29ic2VydmVyX18nIGluIHNldCkpIHtcbiAgICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkoc2V0LCAnX19zZXRfb2JzZXJ2ZXJfXycsIHtcbiAgICAgICAgdmFsdWU6IE1vZGlmeVNldE9ic2VydmVyLmNyZWF0ZSh0YXNrUXVldWUsIHNldCksXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLCBjb25maWd1cmFibGU6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHNldC5fX3NldF9vYnNlcnZlcl9fO1xuICB9O1xuXG4gIE1vZGlmeVNldE9ic2VydmVyLmNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZSh0YXNrUXVldWUsIHNldCkge1xuICAgIHZhciBvYnNlcnZlciA9IG5ldyBNb2RpZnlTZXRPYnNlcnZlcih0YXNrUXVldWUsIHNldCk7XG5cbiAgICB2YXIgcHJvdG8gPSBzZXRQcm90bztcbiAgICBpZiAocHJvdG8uYWRkICE9PSBzZXQuYWRkIHx8IHByb3RvLmRlbGV0ZSAhPT0gc2V0LmRlbGV0ZSB8fCBwcm90by5jbGVhciAhPT0gc2V0LmNsZWFyKSB7XG4gICAgICBwcm90byA9IHtcbiAgICAgICAgYWRkOiBzZXQuYWRkLFxuICAgICAgICBkZWxldGU6IHNldC5kZWxldGUsXG4gICAgICAgIGNsZWFyOiBzZXQuY2xlYXJcbiAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0LmFkZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0eXBlID0gJ2FkZCc7XG4gICAgICB2YXIgb2xkU2l6ZSA9IHNldC5zaXplO1xuICAgICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwcm90by5hZGQuYXBwbHkoc2V0LCBhcmd1bWVudHMpO1xuICAgICAgdmFyIGhhc1ZhbHVlID0gc2V0LnNpemUgPT09IG9sZFNpemU7XG4gICAgICBpZiAoIWhhc1ZhbHVlKSB7XG4gICAgICAgIG9ic2VydmVyLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICBvYmplY3Q6IHNldCxcbiAgICAgICAgICB2YWx1ZTogQXJyYXkuZnJvbShzZXQpLnBvcCgpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gICAgfTtcblxuICAgIHNldC5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaGFzVmFsdWUgPSBzZXQuaGFzKGFyZ3VtZW50c1swXSk7XG4gICAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHByb3RvLmRlbGV0ZS5hcHBseShzZXQsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAoaGFzVmFsdWUpIHtcbiAgICAgICAgb2JzZXJ2ZXIuYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgICB0eXBlOiAnZGVsZXRlJyxcbiAgICAgICAgICBvYmplY3Q6IHNldCxcbiAgICAgICAgICB2YWx1ZTogYXJndW1lbnRzWzBdXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gICAgfTtcblxuICAgIHNldC5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHJvdG8uY2xlYXIuYXBwbHkoc2V0LCBhcmd1bWVudHMpO1xuICAgICAgb2JzZXJ2ZXIuYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgdHlwZTogJ2NsZWFyJyxcbiAgICAgICAgb2JqZWN0OiBzZXRcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gICAgfTtcblxuICAgIHJldHVybiBvYnNlcnZlcjtcbiAgfTtcblxuICByZXR1cm4gTW9kaWZ5U2V0T2JzZXJ2ZXI7XG59KE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcik7XG5cbmV4cG9ydCBmdW5jdGlvbiBvYnNlcnZhYmxlKHRhcmdldE9yQ29uZmlnLCBrZXksIGRlc2NyaXB0b3IpIHtcbiAgZnVuY3Rpb24gZGVjbyh0YXJnZXQsIGtleSwgZGVzY3JpcHRvciwgY29uZmlnKSB7XG4gICAgdmFyIGlzQ2xhc3NEZWNvcmF0b3IgPSBrZXkgPT09IHVuZGVmaW5lZDtcbiAgICBpZiAoaXNDbGFzc0RlY29yYXRvcikge1xuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnByb3RvdHlwZTtcbiAgICAgIGtleSA9IHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnID8gY29uZmlnIDogY29uZmlnLm5hbWU7XG4gICAgfVxuXG4gICAgdmFyIGlubmVyUHJvcGVydHlOYW1lID0gJ18nICsga2V5O1xuICAgIHZhciBpbm5lclByb3BlcnR5RGVzY3JpcHRvciA9IHtcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgd3JpdGFibGU6IHRydWVcbiAgICB9O1xuXG4gICAgdmFyIGNhbGxiYWNrTmFtZSA9IGNvbmZpZyAmJiBjb25maWcuY2hhbmdlSGFuZGxlciB8fCBrZXkgKyAnQ2hhbmdlZCc7XG5cbiAgICBpZiAoZGVzY3JpcHRvcikge1xuICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdG9yLmluaXRpYWxpemVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGlubmVyUHJvcGVydHlEZXNjcmlwdG9yLnZhbHVlID0gZGVzY3JpcHRvci5pbml0aWFsaXplcigpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBkZXNjcmlwdG9yID0ge307XG4gICAgfVxuXG4gICAgaWYgKCEoJ2VudW1lcmFibGUnIGluIGRlc2NyaXB0b3IpKSB7XG4gICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGRlbGV0ZSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgIGRlbGV0ZSBkZXNjcmlwdG9yLndyaXRhYmxlO1xuICAgIGRlbGV0ZSBkZXNjcmlwdG9yLmluaXRpYWxpemVyO1xuXG4gICAgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGlubmVyUHJvcGVydHlOYW1lLCBpbm5lclByb3BlcnR5RGVzY3JpcHRvcik7XG5cbiAgICBkZXNjcmlwdG9yLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzW2lubmVyUHJvcGVydHlOYW1lXTtcbiAgICB9O1xuICAgIGRlc2NyaXB0b3Iuc2V0ID0gZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG4gICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzW2lubmVyUHJvcGVydHlOYW1lXTtcbiAgICAgIGlmIChuZXdWYWx1ZSA9PT0gb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzW2lubmVyUHJvcGVydHlOYW1lXSA9IG5ld1ZhbHVlO1xuICAgICAgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBpbm5lclByb3BlcnR5TmFtZSwgeyBlbnVtZXJhYmxlOiBmYWxzZSB9KTtcblxuICAgICAgaWYgKHRoaXNbY2FsbGJhY2tOYW1lXSkge1xuICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlLCBrZXkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBkZXNjcmlwdG9yLmdldC5kZXBlbmRlbmNpZXMgPSBbaW5uZXJQcm9wZXJ0eU5hbWVdO1xuXG4gICAgaWYgKGlzQ2xhc3NEZWNvcmF0b3IpIHtcbiAgICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGVzY3JpcHRvcjtcbiAgICB9XG4gIH1cblxuICBpZiAoa2V5ID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHQsIGssIGQpIHtcbiAgICAgIHJldHVybiBkZWNvKHQsIGssIGQsIHRhcmdldE9yQ29uZmlnKTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBkZWNvKHRhcmdldE9yQ29uZmlnLCBrZXksIGRlc2NyaXB0b3IpO1xufVxuXG52YXIgc2lnbmFscyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gY29ubmVjdEJpbmRpbmdUb1NpZ25hbChiaW5kaW5nLCBuYW1lKSB7XG4gIGlmICghc2lnbmFscy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgIHNpZ25hbHNbbmFtZV0gPSAwO1xuICB9XG4gIGJpbmRpbmcub2JzZXJ2ZVByb3BlcnR5KHNpZ25hbHMsIG5hbWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2lnbmFsQmluZGluZ3MobmFtZSkge1xuICBpZiAoc2lnbmFscy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgIHNpZ25hbHNbbmFtZV0rKztcbiAgfVxufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWJpbmRpbmcvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWJpbmRpbmcuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtYmluZGluZ1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJcblxuaW1wb3J0ICogYXMgTG9nTWFuYWdlciBmcm9tICdhdXJlbGlhLWxvZ2dpbmcnO1xuXG52YXIgbG9nZ2VyID0gTG9nTWFuYWdlci5nZXRMb2dnZXIoJ2V2ZW50LWFnZ3JlZ2F0b3InKTtcblxudmFyIEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEhhbmRsZXIobWVzc2FnZVR5cGUsIGNhbGxiYWNrKSB7XG4gICAgXG5cbiAgICB0aGlzLm1lc3NhZ2VUeXBlID0gbWVzc2FnZVR5cGU7XG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICB9XG5cbiAgSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKG1lc3NhZ2UpIHtcbiAgICBpZiAobWVzc2FnZSBpbnN0YW5jZW9mIHRoaXMubWVzc2FnZVR5cGUpIHtcbiAgICAgIHRoaXMuY2FsbGJhY2suY2FsbChudWxsLCBtZXNzYWdlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIEhhbmRsZXI7XG59KCk7XG5cbmZ1bmN0aW9uIGludm9rZUNhbGxiYWNrKGNhbGxiYWNrLCBkYXRhLCBldmVudCkge1xuICB0cnkge1xuICAgIGNhbGxiYWNrKGRhdGEsIGV2ZW50KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbnZva2VIYW5kbGVyKGhhbmRsZXIsIGRhdGEpIHtcbiAgdHJ5IHtcbiAgICBoYW5kbGVyLmhhbmRsZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgfVxufVxuXG5leHBvcnQgdmFyIEV2ZW50QWdncmVnYXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXZlbnRBZ2dyZWdhdG9yKCkge1xuICAgIFxuXG4gICAgdGhpcy5ldmVudExvb2t1cCA9IHt9O1xuICAgIHRoaXMubWVzc2FnZUhhbmRsZXJzID0gW107XG4gIH1cblxuICBFdmVudEFnZ3JlZ2F0b3IucHJvdG90eXBlLnB1Ymxpc2ggPSBmdW5jdGlvbiBwdWJsaXNoKGV2ZW50LCBkYXRhKSB7XG4gICAgdmFyIHN1YnNjcmliZXJzID0gdm9pZCAwO1xuICAgIHZhciBpID0gdm9pZCAwO1xuXG4gICAgaWYgKCFldmVudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudCB3YXMgaW52YWxpZC4nKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGV2ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgc3Vic2NyaWJlcnMgPSB0aGlzLmV2ZW50TG9va3VwW2V2ZW50XTtcbiAgICAgIGlmIChzdWJzY3JpYmVycykge1xuICAgICAgICBzdWJzY3JpYmVycyA9IHN1YnNjcmliZXJzLnNsaWNlKCk7XG4gICAgICAgIGkgPSBzdWJzY3JpYmVycy5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgIGludm9rZUNhbGxiYWNrKHN1YnNjcmliZXJzW2ldLCBkYXRhLCBldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc3Vic2NyaWJlcnMgPSB0aGlzLm1lc3NhZ2VIYW5kbGVycy5zbGljZSgpO1xuICAgICAgaSA9IHN1YnNjcmliZXJzLmxlbmd0aDtcblxuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICBpbnZva2VIYW5kbGVyKHN1YnNjcmliZXJzW2ldLCBldmVudCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEV2ZW50QWdncmVnYXRvci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHZhciBoYW5kbGVyID0gdm9pZCAwO1xuICAgIHZhciBzdWJzY3JpYmVycyA9IHZvaWQgMDtcblxuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRXZlbnQgY2hhbm5lbC90eXBlIHdhcyBpbnZhbGlkLicpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZXZlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICBoYW5kbGVyID0gY2FsbGJhY2s7XG4gICAgICBzdWJzY3JpYmVycyA9IHRoaXMuZXZlbnRMb29rdXBbZXZlbnRdIHx8ICh0aGlzLmV2ZW50TG9va3VwW2V2ZW50XSA9IFtdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFuZGxlciA9IG5ldyBIYW5kbGVyKGV2ZW50LCBjYWxsYmFjayk7XG4gICAgICBzdWJzY3JpYmVycyA9IHRoaXMubWVzc2FnZUhhbmRsZXJzO1xuICAgIH1cblxuICAgIHN1YnNjcmliZXJzLnB1c2goaGFuZGxlcik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgdmFyIGlkeCA9IHN1YnNjcmliZXJzLmluZGV4T2YoaGFuZGxlcik7XG4gICAgICAgIGlmIChpZHggIT09IC0xKSB7XG4gICAgICAgICAgc3Vic2NyaWJlcnMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIEV2ZW50QWdncmVnYXRvci5wcm90b3R5cGUuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uIHN1YnNjcmliZU9uY2UoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHN1YiA9IHRoaXMuc3Vic2NyaWJlKGV2ZW50LCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgc3ViLmRpc3Bvc2UoKTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhhLCBiKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdWI7XG4gIH07XG5cbiAgcmV0dXJuIEV2ZW50QWdncmVnYXRvcjtcbn0oKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluY2x1ZGVFdmVudHNJbihvYmopIHtcbiAgdmFyIGVhID0gbmV3IEV2ZW50QWdncmVnYXRvcigpO1xuXG4gIG9iai5zdWJzY3JpYmVPbmNlID0gZnVuY3Rpb24gKGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHJldHVybiBlYS5zdWJzY3JpYmVPbmNlKGV2ZW50LCBjYWxsYmFjayk7XG4gIH07XG5cbiAgb2JqLnN1YnNjcmliZSA9IGZ1bmN0aW9uIChldmVudCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZWEuc3Vic2NyaWJlKGV2ZW50LCBjYWxsYmFjayk7XG4gIH07XG5cbiAgb2JqLnB1Ymxpc2ggPSBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcbiAgICBlYS5wdWJsaXNoKGV2ZW50LCBkYXRhKTtcbiAgfTtcblxuICByZXR1cm4gZWE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25maWd1cmUoY29uZmlnKSB7XG4gIGNvbmZpZy5pbnN0YW5jZShFdmVudEFnZ3JlZ2F0b3IsIGluY2x1ZGVFdmVudHNJbihjb25maWcuYXVyZWxpYSkpO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3IvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3IuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtZXZlbnQtYWdncmVnYXRvclxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJpbXBvcnQgKiBhcyBUaGVMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5pbXBvcnQgeyBDb250YWluZXIgfSBmcm9tICdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJztcbmltcG9ydCB7IExvYWRlciB9IGZyb20gJ2F1cmVsaWEtbG9hZGVyJztcbmltcG9ydCB7IEJpbmRpbmdMYW5ndWFnZSwgVmlld1Nsb3QsIFZpZXdSZXNvdXJjZXMsIFRlbXBsYXRpbmdFbmdpbmUsIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24sIFZpZXdFbmdpbmUsIEh0bWxCZWhhdmlvclJlc291cmNlIH0gZnJvbSAnYXVyZWxpYS10ZW1wbGF0aW5nJztcbmltcG9ydCB7IERPTSwgUExBVEZPUk0gfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5pbXBvcnQgeyByZWxhdGl2ZVRvRmlsZSwgam9pbiB9IGZyb20gJ2F1cmVsaWEtcGF0aCc7XG5cbmZ1bmN0aW9uIHByZXZlbnRBY3Rpb25sZXNzRm9ybVN1Ym1pdCgpIHtcbiAgRE9NLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGV2dCA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcbiAgICBjb25zdCBhY3Rpb24gPSB0YXJnZXQuYWN0aW9uO1xuXG4gICAgaWYgKHRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdmb3JtJyAmJiAhYWN0aW9uKSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH0pO1xufVxuXG5leHBvcnQgbGV0IEF1cmVsaWEgPSBjbGFzcyBBdXJlbGlhIHtcbiAgY29uc3RydWN0b3IobG9hZGVyLCBjb250YWluZXIsIHJlc291cmNlcykge1xuICAgIHRoaXMubG9hZGVyID0gbG9hZGVyIHx8IG5ldyBQTEFURk9STS5Mb2FkZXIoKTtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lciB8fCBuZXcgQ29udGFpbmVyKCkubWFrZUdsb2JhbCgpO1xuICAgIHRoaXMucmVzb3VyY2VzID0gcmVzb3VyY2VzIHx8IG5ldyBWaWV3UmVzb3VyY2VzKCk7XG4gICAgdGhpcy51c2UgPSBuZXcgRnJhbWV3b3JrQ29uZmlndXJhdGlvbih0aGlzKTtcbiAgICB0aGlzLmxvZ2dlciA9IFRoZUxvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdhdXJlbGlhJyk7XG4gICAgdGhpcy5ob3N0Q29uZmlndXJlZCA9IGZhbHNlO1xuICAgIHRoaXMuaG9zdCA9IG51bGw7XG5cbiAgICB0aGlzLnVzZS5pbnN0YW5jZShBdXJlbGlhLCB0aGlzKTtcbiAgICB0aGlzLnVzZS5pbnN0YW5jZShMb2FkZXIsIHRoaXMubG9hZGVyKTtcbiAgICB0aGlzLnVzZS5pbnN0YW5jZShWaWV3UmVzb3VyY2VzLCB0aGlzLnJlc291cmNlcyk7XG4gIH1cblxuICBzdGFydCgpIHtcbiAgICBpZiAodGhpcy5fc3RhcnRlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0ZWQ7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnQXVyZWxpYSBTdGFydGluZycpO1xuICAgIHJldHVybiB0aGlzLl9zdGFydGVkID0gdGhpcy51c2UuYXBwbHkoKS50aGVuKCgpID0+IHtcbiAgICAgIHByZXZlbnRBY3Rpb25sZXNzRm9ybVN1Ym1pdCgpO1xuXG4gICAgICBpZiAoIXRoaXMuY29udGFpbmVyLmhhc1Jlc29sdmVyKEJpbmRpbmdMYW5ndWFnZSkpIHtcbiAgICAgICAgbGV0IG1lc3NhZ2UgPSAnWW91IG11c3QgY29uZmlndXJlIEF1cmVsaWEgd2l0aCBhIEJpbmRpbmdMYW5ndWFnZSBpbXBsZW1lbnRhdGlvbi4nO1xuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihtZXNzYWdlKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdBdXJlbGlhIFN0YXJ0ZWQnKTtcbiAgICAgIGxldCBldnQgPSBET00uY3JlYXRlQ3VzdG9tRXZlbnQoJ2F1cmVsaWEtc3RhcnRlZCcsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9KTtcbiAgICAgIERPTS5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9KTtcbiAgfVxuXG4gIGVuaGFuY2UoYmluZGluZ0NvbnRleHQgPSB7fSwgYXBwbGljYXRpb25Ib3N0ID0gbnVsbCkge1xuICAgIHRoaXMuX2NvbmZpZ3VyZUhvc3QoYXBwbGljYXRpb25Ib3N0IHx8IERPTS5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0pO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgbGV0IGVuZ2luZSA9IHRoaXMuY29udGFpbmVyLmdldChUZW1wbGF0aW5nRW5naW5lKTtcbiAgICAgIHRoaXMucm9vdCA9IGVuZ2luZS5lbmhhbmNlKHsgY29udGFpbmVyOiB0aGlzLmNvbnRhaW5lciwgZWxlbWVudDogdGhpcy5ob3N0LCByZXNvdXJjZXM6IHRoaXMucmVzb3VyY2VzLCBiaW5kaW5nQ29udGV4dDogYmluZGluZ0NvbnRleHQgfSk7XG4gICAgICB0aGlzLnJvb3QuYXR0YWNoZWQoKTtcbiAgICAgIHRoaXMuX29uQXVyZWxpYUNvbXBvc2VkKCk7XG4gICAgICByZXNvbHZlKHRoaXMpO1xuICAgIH0pO1xuICB9XG5cbiAgc2V0Um9vdChyb290ID0gbnVsbCwgYXBwbGljYXRpb25Ib3N0ID0gbnVsbCkge1xuICAgIGxldCBpbnN0cnVjdGlvbiA9IHt9O1xuXG4gICAgaWYgKHRoaXMucm9vdCAmJiB0aGlzLnJvb3Qudmlld01vZGVsICYmIHRoaXMucm9vdC52aWV3TW9kZWwucm91dGVyKSB7XG4gICAgICB0aGlzLnJvb3Qudmlld01vZGVsLnJvdXRlci5kZWFjdGl2YXRlKCk7XG4gICAgICB0aGlzLnJvb3Qudmlld01vZGVsLnJvdXRlci5yZXNldCgpO1xuICAgIH1cblxuICAgIHRoaXMuX2NvbmZpZ3VyZUhvc3QoYXBwbGljYXRpb25Ib3N0KTtcblxuICAgIGxldCBlbmdpbmUgPSB0aGlzLmNvbnRhaW5lci5nZXQoVGVtcGxhdGluZ0VuZ2luZSk7XG4gICAgbGV0IHRyYW5zYWN0aW9uID0gdGhpcy5jb250YWluZXIuZ2V0KENvbXBvc2l0aW9uVHJhbnNhY3Rpb24pO1xuICAgIGRlbGV0ZSB0cmFuc2FjdGlvbi5pbml0aWFsQ29tcG9zaXRpb247XG5cbiAgICBpZiAoIXJvb3QpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZ01vZHVsZUlkKSB7XG4gICAgICAgIHJvb3QgPSByZWxhdGl2ZVRvRmlsZSgnLi9hcHAnLCB0aGlzLmNvbmZpZ01vZHVsZUlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvb3QgPSAnYXBwJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbi52aWV3TW9kZWwgPSByb290O1xuICAgIGluc3RydWN0aW9uLmNvbnRhaW5lciA9IGluc3RydWN0aW9uLmNoaWxkQ29udGFpbmVyID0gdGhpcy5jb250YWluZXI7XG4gICAgaW5zdHJ1Y3Rpb24udmlld1Nsb3QgPSB0aGlzLmhvc3RTbG90O1xuICAgIGluc3RydWN0aW9uLmhvc3QgPSB0aGlzLmhvc3Q7XG5cbiAgICByZXR1cm4gZW5naW5lLmNvbXBvc2UoaW5zdHJ1Y3Rpb24pLnRoZW4ociA9PiB7XG4gICAgICB0aGlzLnJvb3QgPSByO1xuICAgICAgaW5zdHJ1Y3Rpb24udmlld1Nsb3QuYXR0YWNoZWQoKTtcbiAgICAgIHRoaXMuX29uQXVyZWxpYUNvbXBvc2VkKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9KTtcbiAgfVxuXG4gIF9jb25maWd1cmVIb3N0KGFwcGxpY2F0aW9uSG9zdCkge1xuICAgIGlmICh0aGlzLmhvc3RDb25maWd1cmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFwcGxpY2F0aW9uSG9zdCA9IGFwcGxpY2F0aW9uSG9zdCB8fCB0aGlzLmhvc3Q7XG5cbiAgICBpZiAoIWFwcGxpY2F0aW9uSG9zdCB8fCB0eXBlb2YgYXBwbGljYXRpb25Ib3N0ID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5ob3N0ID0gRE9NLmdldEVsZW1lbnRCeUlkKGFwcGxpY2F0aW9uSG9zdCB8fCAnYXBwbGljYXRpb25Ib3N0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaG9zdCA9IGFwcGxpY2F0aW9uSG9zdDtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuaG9zdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhcHBsaWNhdGlvbkhvc3Qgd2FzIHNwZWNpZmllZC4nKTtcbiAgICB9XG5cbiAgICB0aGlzLmhvc3RDb25maWd1cmVkID0gdHJ1ZTtcbiAgICB0aGlzLmhvc3QuYXVyZWxpYSA9IHRoaXM7XG4gICAgdGhpcy5ob3N0U2xvdCA9IG5ldyBWaWV3U2xvdCh0aGlzLmhvc3QsIHRydWUpO1xuICAgIHRoaXMuaG9zdFNsb3QudHJhbnNmb3JtQ2hpbGROb2Rlc0ludG9WaWV3KCk7XG4gICAgdGhpcy5jb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uYm91bmRhcnksIHRoaXMuaG9zdCk7XG4gIH1cblxuICBfb25BdXJlbGlhQ29tcG9zZWQoKSB7XG4gICAgbGV0IGV2dCA9IERPTS5jcmVhdGVDdXN0b21FdmVudCgnYXVyZWxpYS1jb21wb3NlZCcsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9KTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IERPTS5kaXNwYXRjaEV2ZW50KGV2dCksIDEpO1xuICB9XG59O1xuXG5jb25zdCBsb2dnZXIgPSBUaGVMb2dNYW5hZ2VyLmdldExvZ2dlcignYXVyZWxpYScpO1xuY29uc3QgZXh0UGF0dGVybiA9IC9cXC5bXi8uXSskLztcblxuZnVuY3Rpb24gcnVuVGFza3MoY29uZmlnLCB0YXNrcykge1xuICBsZXQgY3VycmVudDtcbiAgbGV0IG5leHQgPSAoKSA9PiB7XG4gICAgY3VycmVudCA9IHRhc2tzLnNoaWZ0KCk7XG4gICAgaWYgKGN1cnJlbnQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY3VycmVudChjb25maWcpKS50aGVuKG5leHQpO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfTtcblxuICByZXR1cm4gbmV4dCgpO1xufVxuXG5mdW5jdGlvbiBsb2FkUGx1Z2luKGZ3Q29uZmlnLCBsb2FkZXIsIGluZm8pIHtcbiAgbG9nZ2VyLmRlYnVnKGBMb2FkaW5nIHBsdWdpbiAke2luZm8ubW9kdWxlSWR9LmApO1xuICBpZiAodHlwZW9mIGluZm8ubW9kdWxlSWQgPT09ICdzdHJpbmcnKSB7XG4gICAgZndDb25maWcucmVzb3VyY2VzUmVsYXRpdmVUbyA9IGluZm8ucmVzb3VyY2VzUmVsYXRpdmVUbztcblxuICAgIGxldCBpZCA9IGluZm8ubW9kdWxlSWQ7XG5cbiAgICBpZiAoaW5mby5yZXNvdXJjZXNSZWxhdGl2ZVRvLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiBsb2FkZXIubm9ybWFsaXplKGluZm8ubW9kdWxlSWQsIGluZm8ucmVzb3VyY2VzUmVsYXRpdmVUb1sxXSkudGhlbihub3JtYWxpemVkSWQgPT4gX2xvYWRQbHVnaW4obm9ybWFsaXplZElkKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9sb2FkUGx1Z2luKGlkKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgaW5mby5jb25maWd1cmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICBpZiAoZndDb25maWcuY29uZmlndXJlZFBsdWdpbnMuaW5kZXhPZihpbmZvLmNvbmZpZ3VyZSkgIT09IC0xKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGZ3Q29uZmlnLmNvbmZpZ3VyZWRQbHVnaW5zLnB1c2goaW5mby5jb25maWd1cmUpO1xuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShpbmZvLmNvbmZpZ3VyZS5jYWxsKG51bGwsIGZ3Q29uZmlnLCBpbmZvLmNvbmZpZyB8fCB7fSkpO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihpbnZhbGlkQ29uZmlnTXNnKGluZm8ubW9kdWxlSWQgfHwgaW5mby5jb25maWd1cmUsICdwbHVnaW4nKSk7XG5cbiAgZnVuY3Rpb24gX2xvYWRQbHVnaW4obW9kdWxlSWQpIHtcbiAgICByZXR1cm4gbG9hZGVyLmxvYWRNb2R1bGUobW9kdWxlSWQpLnRoZW4obSA9PiB7XG4gICAgICBpZiAoJ2NvbmZpZ3VyZScgaW4gbSkge1xuICAgICAgICBpZiAoZndDb25maWcuY29uZmlndXJlZFBsdWdpbnMuaW5kZXhPZihtLmNvbmZpZ3VyZSkgIT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobS5jb25maWd1cmUoZndDb25maWcsIGluZm8uY29uZmlnIHx8IHt9KSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgZndDb25maWcuY29uZmlndXJlZFBsdWdpbnMucHVzaChtLmNvbmZpZ3VyZSk7XG4gICAgICAgICAgZndDb25maWcucmVzb3VyY2VzUmVsYXRpdmVUbyA9IG51bGw7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKGBDb25maWd1cmVkIHBsdWdpbiAke2luZm8ubW9kdWxlSWR9LmApO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZndDb25maWcucmVzb3VyY2VzUmVsYXRpdmVUbyA9IG51bGw7XG4gICAgICBsb2dnZXIuZGVidWcoYExvYWRlZCBwbHVnaW4gJHtpbmZvLm1vZHVsZUlkfS5gKTtcbiAgICB9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkUmVzb3VyY2VzKGF1cmVsaWEsIHJlc291cmNlc1RvTG9hZCwgYXBwUmVzb3VyY2VzKSB7XG4gIGlmIChPYmplY3Qua2V5cyhyZXNvdXJjZXNUb0xvYWQpLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuICBsZXQgdmlld0VuZ2luZSA9IGF1cmVsaWEuY29udGFpbmVyLmdldChWaWV3RW5naW5lKTtcblxuICByZXR1cm4gUHJvbWlzZS5hbGwoT2JqZWN0LmtleXMocmVzb3VyY2VzVG9Mb2FkKS5tYXAobiA9PiBfbm9ybWFsaXplKHJlc291cmNlc1RvTG9hZFtuXSkpKS50aGVuKGxvYWRzID0+IHtcbiAgICBsZXQgbmFtZXMgPSBbXTtcbiAgICBsZXQgaW1wb3J0SWRzID0gW107XG5cbiAgICBsb2Fkcy5mb3JFYWNoKGwgPT4ge1xuICAgICAgbmFtZXMucHVzaCh1bmRlZmluZWQpO1xuICAgICAgaW1wb3J0SWRzLnB1c2gobC5pbXBvcnRJZCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdmlld0VuZ2luZS5pbXBvcnRWaWV3UmVzb3VyY2VzKGltcG9ydElkcywgbmFtZXMsIGFwcFJlc291cmNlcyk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIF9ub3JtYWxpemUobG9hZCkge1xuICAgIGxldCBtb2R1bGVJZCA9IGxvYWQubW9kdWxlSWQ7XG4gICAgbGV0IGV4dCA9IGdldEV4dChtb2R1bGVJZCk7XG5cbiAgICBpZiAoaXNPdGhlclJlc291cmNlKG1vZHVsZUlkKSkge1xuICAgICAgbW9kdWxlSWQgPSByZW1vdmVFeHQobW9kdWxlSWQpO1xuICAgIH1cblxuICAgIHJldHVybiBhdXJlbGlhLmxvYWRlci5ub3JtYWxpemUobW9kdWxlSWQsIGxvYWQucmVsYXRpdmVUbykudGhlbihub3JtYWxpemVkID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IGxvYWQubW9kdWxlSWQsXG4gICAgICAgIGltcG9ydElkOiBpc090aGVyUmVzb3VyY2UobG9hZC5tb2R1bGVJZCkgPyBhZGRPcmlnaW5hbEV4dChub3JtYWxpemVkLCBleHQpIDogbm9ybWFsaXplZFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzT3RoZXJSZXNvdXJjZShuYW1lKSB7XG4gICAgbGV0IGV4dCA9IGdldEV4dChuYW1lKTtcbiAgICBpZiAoIWV4dCkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChleHQgPT09ICcnKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGV4dCA9PT0gJy5qcycgfHwgZXh0ID09PSAnLnRzJykgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlRXh0KG5hbWUpIHtcbiAgICByZXR1cm4gbmFtZS5yZXBsYWNlKGV4dFBhdHRlcm4sICcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZE9yaWdpbmFsRXh0KG5vcm1hbGl6ZWQsIGV4dCkge1xuICAgIHJldHVybiByZW1vdmVFeHQobm9ybWFsaXplZCkgKyAnLicgKyBleHQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RXh0KG5hbWUpIHtcbiAgbGV0IG1hdGNoID0gbmFtZS5tYXRjaChleHRQYXR0ZXJuKTtcbiAgaWYgKG1hdGNoICYmIG1hdGNoLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gbWF0Y2hbMF0uc3BsaXQoJy4nKVsxXTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkQmVoYXZpb3JzKGNvbmZpZykge1xuICByZXR1cm4gUHJvbWlzZS5hbGwoY29uZmlnLmJlaGF2aW9yc1RvTG9hZC5tYXAobSA9PiBtLmxvYWQoY29uZmlnLmNvbnRhaW5lciwgbS50YXJnZXQpKSkudGhlbigoKSA9PiB7XG4gICAgY29uZmlnLmJlaGF2aW9yc1RvTG9hZCA9IG51bGw7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRQcm9jZXNzZWQocGx1Z2lucykge1xuICBpZiAocGx1Z2lucy5wcm9jZXNzZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgY29uZmlnIGluc3RhbmNlIGhhcyBhbHJlYWR5IGJlZW4gYXBwbGllZC4gVG8gbG9hZCBtb3JlIHBsdWdpbnMgb3IgZ2xvYmFsIHJlc291cmNlcywgY3JlYXRlIGEgbmV3IEZyYW1ld29ya0NvbmZpZ3VyYXRpb24gaW5zdGFuY2UuJyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW52YWxpZENvbmZpZ01zZyhjZmcsIHR5cGUpIHtcbiAgcmV0dXJuIGBJbnZhbGlkICR7dHlwZX0gWyR7Y2ZnfV0sICR7dHlwZX0gbXVzdCBiZSBzcGVjaWZpZWQgYXMgZnVuY3Rpb25zIG9yIHJlbGF0aXZlIG1vZHVsZSBJRHMuYDtcbn1cblxuZXhwb3J0IGxldCBGcmFtZXdvcmtDb25maWd1cmF0aW9uID0gY2xhc3MgRnJhbWV3b3JrQ29uZmlndXJhdGlvbiB7XG4gIGNvbnN0cnVjdG9yKGF1cmVsaWEpIHtcbiAgICB0aGlzLmF1cmVsaWEgPSBhdXJlbGlhO1xuICAgIHRoaXMuY29udGFpbmVyID0gYXVyZWxpYS5jb250YWluZXI7XG5cbiAgICB0aGlzLmluZm8gPSBbXTtcbiAgICB0aGlzLnByb2Nlc3NlZCA9IGZhbHNlO1xuICAgIHRoaXMucHJlVGFza3MgPSBbXTtcbiAgICB0aGlzLnBvc3RUYXNrcyA9IFtdO1xuXG4gICAgdGhpcy5iZWhhdmlvcnNUb0xvYWQgPSBbXTtcblxuICAgIHRoaXMuY29uZmlndXJlZFBsdWdpbnMgPSBbXTtcbiAgICB0aGlzLnJlc291cmNlc1RvTG9hZCA9IHt9O1xuICAgIHRoaXMucHJlVGFzaygoKSA9PiBhdXJlbGlhLmxvYWRlci5ub3JtYWxpemUoJ2F1cmVsaWEtYm9vdHN0cmFwcGVyJykudGhlbihuYW1lID0+IHRoaXMuYm9vdHN0cmFwcGVyTmFtZSA9IG5hbWUpKTtcbiAgICB0aGlzLnBvc3RUYXNrKCgpID0+IGxvYWRSZXNvdXJjZXMoYXVyZWxpYSwgdGhpcy5yZXNvdXJjZXNUb0xvYWQsIGF1cmVsaWEucmVzb3VyY2VzKSk7XG4gIH1cblxuICBpbnN0YW5jZSh0eXBlLCBpbnN0YW5jZSkge1xuICAgIHRoaXMuY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UodHlwZSwgaW5zdGFuY2UpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2luZ2xldG9uKHR5cGUsIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdGhpcy5jb250YWluZXIucmVnaXN0ZXJTaW5nbGV0b24odHlwZSwgaW1wbGVtZW50YXRpb24pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdHJhbnNpZW50KHR5cGUsIGltcGxlbWVudGF0aW9uKSB7XG4gICAgdGhpcy5jb250YWluZXIucmVnaXN0ZXJUcmFuc2llbnQodHlwZSwgaW1wbGVtZW50YXRpb24pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHJlVGFzayh0YXNrKSB7XG4gICAgYXNzZXJ0UHJvY2Vzc2VkKHRoaXMpO1xuICAgIHRoaXMucHJlVGFza3MucHVzaCh0YXNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHBvc3RUYXNrKHRhc2spIHtcbiAgICBhc3NlcnRQcm9jZXNzZWQodGhpcyk7XG4gICAgdGhpcy5wb3N0VGFza3MucHVzaCh0YXNrKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZlYXR1cmUocGx1Z2luLCBjb25maWcgPSB7fSkge1xuICAgIHN3aXRjaCAodHlwZW9mIHBsdWdpbikge1xuICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgbGV0IGhhc0luZGV4ID0gL1xcL2luZGV4JC9pLnRlc3QocGx1Z2luKTtcbiAgICAgICAgbGV0IG1vZHVsZUlkID0gaGFzSW5kZXggfHwgZ2V0RXh0KHBsdWdpbikgPyBwbHVnaW4gOiBwbHVnaW4gKyAnL2luZGV4JztcbiAgICAgICAgbGV0IHJvb3QgPSBoYXNJbmRleCA/IHBsdWdpbi5zdWJzdHIoMCwgcGx1Z2luLmxlbmd0aCAtIDYpIDogcGx1Z2luO1xuICAgICAgICB0aGlzLmluZm8ucHVzaCh7IG1vZHVsZUlkLCByZXNvdXJjZXNSZWxhdGl2ZVRvOiBbcm9vdCwgJyddLCBjb25maWcgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgIHRoaXMuaW5mby5wdXNoKHsgY29uZmlndXJlOiBwbHVnaW4sIGNvbmZpZzogY29uZmlnIHx8IHt9IH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihpbnZhbGlkQ29uZmlnTXNnKHBsdWdpbiwgJ2ZlYXR1cmUnKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZ2xvYmFsUmVzb3VyY2VzKHJlc291cmNlcykge1xuICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcblxuICAgIGxldCB0b0FkZCA9IEFycmF5LmlzQXJyYXkocmVzb3VyY2VzKSA/IHJlc291cmNlcyA6IGFyZ3VtZW50cztcbiAgICBsZXQgcmVzb3VyY2U7XG4gICAgbGV0IHJlc291cmNlc1JlbGF0aXZlVG8gPSB0aGlzLnJlc291cmNlc1JlbGF0aXZlVG8gfHwgWycnLCAnJ107XG5cbiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0b0FkZC5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICByZXNvdXJjZSA9IHRvQWRkW2ldO1xuICAgICAgc3dpdGNoICh0eXBlb2YgcmVzb3VyY2UpIHtcbiAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICBsZXQgcGFyZW50ID0gcmVzb3VyY2VzUmVsYXRpdmVUb1swXTtcbiAgICAgICAgICBsZXQgZ3JhbmRQYXJlbnQgPSByZXNvdXJjZXNSZWxhdGl2ZVRvWzFdO1xuICAgICAgICAgIGxldCBuYW1lID0gcmVzb3VyY2U7XG5cbiAgICAgICAgICBpZiAoKHJlc291cmNlLnN0YXJ0c1dpdGgoJy4vJykgfHwgcmVzb3VyY2Uuc3RhcnRzV2l0aCgnLi4vJykpICYmIHBhcmVudCAhPT0gJycpIHtcbiAgICAgICAgICAgIG5hbWUgPSBqb2luKHBhcmVudCwgcmVzb3VyY2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMucmVzb3VyY2VzVG9Mb2FkW25hbWVdID0geyBtb2R1bGVJZDogbmFtZSwgcmVsYXRpdmVUbzogZ3JhbmRQYXJlbnQgfTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgIGxldCBtZXRhID0gdGhpcy5hdXJlbGlhLnJlc291cmNlcy5hdXRvUmVnaXN0ZXIodGhpcy5jb250YWluZXIsIHJlc291cmNlKTtcbiAgICAgICAgICBpZiAobWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlICYmIG1ldGEuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJlaGF2aW9yc1RvTG9hZC5wdXNoKG1ldGEpID09PSAxKSB7XG4gICAgICAgICAgICAgIHRoaXMucG9zdFRhc2soKCkgPT4gbG9hZEJlaGF2aW9ycyh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpbnZhbGlkQ29uZmlnTXNnKHJlc291cmNlLCAncmVzb3VyY2UnKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBnbG9iYWxOYW1lKHJlc291cmNlUGF0aCwgbmV3TmFtZSkge1xuICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcbiAgICB0aGlzLnJlc291cmNlc1RvTG9hZFtyZXNvdXJjZVBhdGhdID0geyBtb2R1bGVJZDogbmV3TmFtZSwgcmVsYXRpdmVUbzogJycgfTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHBsdWdpbihwbHVnaW4sIHBsdWdpbkNvbmZpZykge1xuICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcblxuICAgIGxldCBpbmZvO1xuICAgIHN3aXRjaCAodHlwZW9mIHBsdWdpbikge1xuICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgaW5mbyA9IHsgbW9kdWxlSWQ6IHBsdWdpbiwgcmVzb3VyY2VzUmVsYXRpdmVUbzogW3BsdWdpbiwgJyddLCBjb25maWc6IHBsdWdpbkNvbmZpZyB8fCB7fSB9O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcbiAgICAgICAgaW5mbyA9IHsgY29uZmlndXJlOiBwbHVnaW4sIGNvbmZpZzogcGx1Z2luQ29uZmlnIHx8IHt9IH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGludmFsaWRDb25maWdNc2cocGx1Z2luLCAncGx1Z2luJykpO1xuICAgIH1cbiAgICB0aGlzLmluZm8ucHVzaChpbmZvKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIF9hZGROb3JtYWxpemVkUGx1Z2luKG5hbWUsIGNvbmZpZykge1xuICAgIGxldCBwbHVnaW4gPSB7IG1vZHVsZUlkOiBuYW1lLCByZXNvdXJjZXNSZWxhdGl2ZVRvOiBbbmFtZSwgJyddLCBjb25maWc6IGNvbmZpZyB8fCB7fSB9O1xuICAgIHRoaXMuaW5mby5wdXNoKHBsdWdpbik7XG5cbiAgICB0aGlzLnByZVRhc2soKCkgPT4ge1xuICAgICAgbGV0IHJlbGF0aXZlVG8gPSBbbmFtZSwgdGhpcy5ib290c3RyYXBwZXJOYW1lXTtcbiAgICAgIHBsdWdpbi5tb2R1bGVJZCA9IG5hbWU7XG4gICAgICBwbHVnaW4ucmVzb3VyY2VzUmVsYXRpdmVUbyA9IHJlbGF0aXZlVG87XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGRlZmF1bHRCaW5kaW5nTGFuZ3VhZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtdGVtcGxhdGluZy1iaW5kaW5nJyk7XG4gIH1cblxuICByb3V0ZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXInKTtcbiAgfVxuXG4gIGhpc3RvcnkoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtaGlzdG9yeS1icm93c2VyJyk7XG4gIH1cblxuICBkZWZhdWx0UmVzb3VyY2VzKCkge1xuICAgIHJldHVybiB0aGlzLl9hZGROb3JtYWxpemVkUGx1Z2luKCdhdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzJyk7XG4gIH1cblxuICBldmVudEFnZ3JlZ2F0b3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtZXZlbnQtYWdncmVnYXRvcicpO1xuICB9XG5cbiAgYmFzaWNDb25maWd1cmF0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmRlZmF1bHRCaW5kaW5nTGFuZ3VhZ2UoKS5kZWZhdWx0UmVzb3VyY2VzKCkuZXZlbnRBZ2dyZWdhdG9yKCk7XG4gIH1cblxuICBzdGFuZGFyZENvbmZpZ3VyYXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuYmFzaWNDb25maWd1cmF0aW9uKCkuaGlzdG9yeSgpLnJvdXRlcigpO1xuICB9XG5cbiAgZGV2ZWxvcG1lbnRMb2dnaW5nKGxldmVsKSB7XG4gICAgbGV0IGxvZ0xldmVsID0gbGV2ZWwgPyBUaGVMb2dNYW5hZ2VyLmxvZ0xldmVsW2xldmVsXSA6IHVuZGVmaW5lZDtcblxuICAgIGlmIChsb2dMZXZlbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBsb2dMZXZlbCA9IFRoZUxvZ01hbmFnZXIubG9nTGV2ZWwuZGVidWc7XG4gICAgfVxuXG4gICAgdGhpcy5wcmVUYXNrKCgpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmF1cmVsaWEubG9hZGVyLm5vcm1hbGl6ZSgnYXVyZWxpYS1sb2dnaW5nLWNvbnNvbGUnLCB0aGlzLmJvb3RzdHJhcHBlck5hbWUpLnRoZW4obmFtZSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmF1cmVsaWEubG9hZGVyLmxvYWRNb2R1bGUobmFtZSkudGhlbihtID0+IHtcbiAgICAgICAgICBUaGVMb2dNYW5hZ2VyLmFkZEFwcGVuZGVyKG5ldyBtLkNvbnNvbGVBcHBlbmRlcigpKTtcbiAgICAgICAgICBUaGVMb2dNYW5hZ2VyLnNldExldmVsKGxvZ0xldmVsKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXBwbHkoKSB7XG4gICAgaWYgKHRoaXMucHJvY2Vzc2VkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJ1blRhc2tzKHRoaXMsIHRoaXMucHJlVGFza3MpLnRoZW4oKCkgPT4ge1xuICAgICAgbGV0IGxvYWRlciA9IHRoaXMuYXVyZWxpYS5sb2FkZXI7XG4gICAgICBsZXQgaW5mbyA9IHRoaXMuaW5mbztcbiAgICAgIGxldCBjdXJyZW50O1xuXG4gICAgICBsZXQgbmV4dCA9ICgpID0+IHtcbiAgICAgICAgY3VycmVudCA9IGluZm8uc2hpZnQoKTtcbiAgICAgICAgaWYgKGN1cnJlbnQpIHtcbiAgICAgICAgICByZXR1cm4gbG9hZFBsdWdpbih0aGlzLCBsb2FkZXIsIGN1cnJlbnQpLnRoZW4obmV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnByb2Nlc3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY29uZmlndXJlZFBsdWdpbnMgPSBudWxsO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gbmV4dCgpLnRoZW4oKCkgPT4gcnVuVGFza3ModGhpcywgdGhpcy5wb3N0VGFza3MpKTtcbiAgICB9KTtcbiAgfVxufTtcblxuZXhwb3J0ICogZnJvbSAnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbic7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLWJpbmRpbmcnO1xuZXhwb3J0ICogZnJvbSAnYXVyZWxpYS1tZXRhZGF0YSc7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLXRlbXBsYXRpbmcnO1xuZXhwb3J0ICogZnJvbSAnYXVyZWxpYS1sb2FkZXInO1xuZXhwb3J0ICogZnJvbSAnYXVyZWxpYS10YXNrLXF1ZXVlJztcbmV4cG9ydCAqIGZyb20gJ2F1cmVsaWEtcGF0aCc7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLXBhbCc7XG5cbmV4cG9ydCBjb25zdCBMb2dNYW5hZ2VyID0gVGhlTG9nTWFuYWdlcjtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1mcmFtZXdvcmsvZGlzdC9lczIwMTUvYXVyZWxpYS1mcmFtZXdvcmsuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtZnJhbWV3b3JrXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsImltcG9ydCB7IEhpc3RvcnkgfSBmcm9tICdhdXJlbGlhLWhpc3RvcnknO1xuaW1wb3J0IHsgRE9NLCBQTEFURk9STSB9IGZyb20gJ2F1cmVsaWEtcGFsJztcblxuLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcclxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcclxuTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcclxuS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRFxyXG5XQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLFxyXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxyXG5cclxuU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXHJcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxuXG52YXIgTGlua0hhbmRsZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTGlua0hhbmRsZXIoKSB7XHJcbiAgICB9XHJcbiAgICBMaW5rSGFuZGxlci5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAoaGlzdG9yeSkgeyB9O1xyXG4gICAgTGlua0hhbmRsZXIucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7IH07XHJcbiAgICByZXR1cm4gTGlua0hhbmRsZXI7XHJcbn0oKSk7XHJcbnZhciBEZWZhdWx0TGlua0hhbmRsZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKERlZmF1bHRMaW5rSGFuZGxlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIERlZmF1bHRMaW5rSGFuZGxlcigpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmhhbmRsZXIgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgX2EgPSBEZWZhdWx0TGlua0hhbmRsZXIuZ2V0RXZlbnRJbmZvKGUpLCBzaG91bGRIYW5kbGVFdmVudCA9IF9hLnNob3VsZEhhbmRsZUV2ZW50LCBocmVmID0gX2EuaHJlZjtcclxuICAgICAgICAgICAgaWYgKHNob3VsZEhhbmRsZUV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5oaXN0b3J5Lm5hdmlnYXRlKGhyZWYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBEZWZhdWx0TGlua0hhbmRsZXIucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gKGhpc3RvcnkpIHtcclxuICAgICAgICBpZiAoaGlzdG9yeS5faGFzUHVzaFN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7XHJcbiAgICAgICAgICAgIERPTS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlciwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIERlZmF1bHRMaW5rSGFuZGxlci5wcm90b3R5cGUuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBET00ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZXIsIHRydWUpO1xyXG4gICAgfTtcclxuICAgIERlZmF1bHRMaW5rSGFuZGxlci5nZXRFdmVudEluZm8gPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgJGV2ZW50ID0gZXZlbnQ7XHJcbiAgICAgICAgdmFyIGluZm8gPSB7XHJcbiAgICAgICAgICAgIHNob3VsZEhhbmRsZUV2ZW50OiBmYWxzZSxcclxuICAgICAgICAgICAgaHJlZjogbnVsbCxcclxuICAgICAgICAgICAgYW5jaG9yOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gRGVmYXVsdExpbmtIYW5kbGVyLmZpbmRDbG9zZXN0QW5jaG9yKCRldmVudC50YXJnZXQpO1xyXG4gICAgICAgIGlmICghdGFyZ2V0IHx8ICFEZWZhdWx0TGlua0hhbmRsZXIudGFyZ2V0SXNUaGlzV2luZG93KHRhcmdldCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZm87XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChoYXNBdHRyaWJ1dGUodGFyZ2V0LCAnZG93bmxvYWQnKVxyXG4gICAgICAgICAgICB8fCBoYXNBdHRyaWJ1dGUodGFyZ2V0LCAncm91dGVyLWlnbm9yZScpXHJcbiAgICAgICAgICAgIHx8IGhhc0F0dHJpYnV0ZSh0YXJnZXQsICdkYXRhLXJvdXRlci1pZ25vcmUnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5mbztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCRldmVudC5hbHRLZXkgfHwgJGV2ZW50LmN0cmxLZXkgfHwgJGV2ZW50Lm1ldGFLZXkgfHwgJGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaHJlZiA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcclxuICAgICAgICBpbmZvLmFuY2hvciA9IHRhcmdldDtcclxuICAgICAgICBpbmZvLmhyZWYgPSBocmVmO1xyXG4gICAgICAgIHZhciBsZWZ0QnV0dG9uQ2xpY2tlZCA9ICRldmVudC53aGljaCA9PT0gMTtcclxuICAgICAgICB2YXIgaXNSZWxhdGl2ZSA9IGhyZWYgJiYgIShocmVmLmNoYXJBdCgwKSA9PT0gJyMnIHx8ICgvXlthLXpdKzovaSkudGVzdChocmVmKSk7XHJcbiAgICAgICAgaW5mby5zaG91bGRIYW5kbGVFdmVudCA9IGxlZnRCdXR0b25DbGlja2VkICYmIGlzUmVsYXRpdmU7XHJcbiAgICAgICAgcmV0dXJuIGluZm87XHJcbiAgICB9O1xyXG4gICAgRGVmYXVsdExpbmtIYW5kbGVyLmZpbmRDbG9zZXN0QW5jaG9yID0gZnVuY3Rpb24gKGVsKSB7XHJcbiAgICAgICAgd2hpbGUgKGVsKSB7XHJcbiAgICAgICAgICAgIGlmIChlbC50YWdOYW1lID09PSAnQScpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbCA9IGVsLnBhcmVudE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIERlZmF1bHRMaW5rSGFuZGxlci50YXJnZXRJc1RoaXNXaW5kb3cgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIHRhcmdldFdpbmRvdyA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ3RhcmdldCcpO1xyXG4gICAgICAgIHZhciB3aW4gPSBQTEFURk9STS5nbG9iYWw7XHJcbiAgICAgICAgcmV0dXJuICF0YXJnZXRXaW5kb3cgfHxcclxuICAgICAgICAgICAgdGFyZ2V0V2luZG93ID09PSB3aW4ubmFtZSB8fFxyXG4gICAgICAgICAgICB0YXJnZXRXaW5kb3cgPT09ICdfc2VsZic7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIERlZmF1bHRMaW5rSGFuZGxlcjtcclxufShMaW5rSGFuZGxlcikpO1xyXG52YXIgaGFzQXR0cmlidXRlID0gZnVuY3Rpb24gKGVsLCBhdHRyKSB7IHJldHVybiBlbC5oYXNBdHRyaWJ1dGUoYXR0cik7IH07XG5cbnZhciBCcm93c2VySGlzdG9yeSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQnJvd3Nlckhpc3RvcnksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBCcm93c2VySGlzdG9yeShsaW5rSGFuZGxlcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX2lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMuX2NoZWNrVXJsQ2FsbGJhY2sgPSBfdGhpcy5fY2hlY2tVcmwuYmluZChfdGhpcyk7XHJcbiAgICAgICAgX3RoaXMubG9jYXRpb24gPSBQTEFURk9STS5sb2NhdGlvbjtcclxuICAgICAgICBfdGhpcy5oaXN0b3J5ID0gUExBVEZPUk0uaGlzdG9yeTtcclxuICAgICAgICBfdGhpcy5saW5rSGFuZGxlciA9IGxpbmtIYW5kbGVyO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIGFjdGl2YXRlZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyICRoaXN0b3J5ID0gdGhpcy5oaXN0b3J5O1xyXG4gICAgICAgIHZhciB3YW50c1B1c2hTdGF0ZSA9ICEhb3B0aW9ucy5wdXNoU3RhdGU7XHJcbiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgIHZhciBub3JtYWxpemVkT3B0aW9ucyA9IHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHsgcm9vdDogJy8nIH0sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICAgICAgdmFyIHJvb3RVcmwgPSB0aGlzLnJvb3QgPSAoJy8nICsgbm9ybWFsaXplZE9wdGlvbnMucm9vdCArICcvJykucmVwbGFjZShyb290U3RyaXBwZXIsICcvJyk7XHJcbiAgICAgICAgdmFyIHdhbnRzSGFzaENoYW5nZSA9IHRoaXMuX3dhbnRzSGFzaENoYW5nZSA9IG5vcm1hbGl6ZWRPcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlO1xyXG4gICAgICAgIHZhciBoYXNQdXNoU3RhdGUgPSB0aGlzLl9oYXNQdXNoU3RhdGUgPSAhIShub3JtYWxpemVkT3B0aW9ucy5wdXNoU3RhdGUgJiYgJGhpc3RvcnkgJiYgJGhpc3RvcnkucHVzaFN0YXRlKTtcclxuICAgICAgICB2YXIgZXZlbnROYW1lO1xyXG4gICAgICAgIGlmIChoYXNQdXNoU3RhdGUpIHtcclxuICAgICAgICAgICAgZXZlbnROYW1lID0gJ3BvcHN0YXRlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAod2FudHNIYXNoQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgIGV2ZW50TmFtZSA9ICdoYXNoY2hhbmdlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgUExBVEZPUk0uYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMuX2NoZWNrVXJsQ2FsbGJhY2spO1xyXG4gICAgICAgIGlmICh3YW50c0hhc2hDaGFuZ2UgJiYgd2FudHNQdXNoU3RhdGUpIHtcclxuICAgICAgICAgICAgdmFyICRsb2NhdGlvbiA9IHRoaXMubG9jYXRpb247XHJcbiAgICAgICAgICAgIHZhciBhdFJvb3QgPSAkbG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cXC9dJC8sICckJi8nKSA9PT0gcm9vdFVybDtcclxuICAgICAgICAgICAgaWYgKCFoYXNQdXNoU3RhdGUgJiYgIWF0Um9vdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuX2dldEZyYWdtZW50KG51bGwsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnJlcGxhY2Uocm9vdFVybCArICRsb2NhdGlvbi5zZWFyY2ggKyAnIycgKyBmcmFnbWVudCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChoYXNQdXNoU3RhdGUgJiYgYXRSb290ICYmICRsb2NhdGlvbi5oYXNoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID0gdGhpcy5fZ2V0SGFzaCgpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpO1xyXG4gICAgICAgICAgICAgICAgJGhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBET00udGl0bGUsIHJvb3RVcmwgKyBmcmFnbWVudCArICRsb2NhdGlvbi5zZWFyY2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5mcmFnbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5fZ2V0RnJhZ21lbnQoJycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxpbmtIYW5kbGVyLmFjdGl2YXRlKHRoaXMpO1xyXG4gICAgICAgIGlmICghbm9ybWFsaXplZE9wdGlvbnMuc2lsZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2FkVXJsKCcnKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGhhbmRsZXIgPSB0aGlzLl9jaGVja1VybENhbGxiYWNrO1xyXG4gICAgICAgIFBMQVRGT1JNLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgaGFuZGxlcik7XHJcbiAgICAgICAgUExBVEZPUk0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIGhhbmRsZXIpO1xyXG4gICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5saW5rSGFuZGxlci5kZWFjdGl2YXRlKCk7XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLmdldEFic29sdXRlUm9vdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgJGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjtcclxuICAgICAgICB2YXIgb3JpZ2luID0gY3JlYXRlT3JpZ2luKCRsb2NhdGlvbi5wcm90b2NvbCwgJGxvY2F0aW9uLmhvc3RuYW1lLCAkbG9jYXRpb24ucG9ydCk7XHJcbiAgICAgICAgcmV0dXJuIFwiXCIgKyBvcmlnaW4gKyB0aGlzLnJvb3Q7XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLm5hdmlnYXRlID0gZnVuY3Rpb24gKGZyYWdtZW50LCBfYSkge1xyXG4gICAgICAgIHZhciBfYiA9IF9hID09PSB2b2lkIDAgPyB7fSA6IF9hLCBfYyA9IF9iLnRyaWdnZXIsIHRyaWdnZXIgPSBfYyA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9jLCBfZCA9IF9iLnJlcGxhY2UsIHJlcGxhY2UgPSBfZCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfZDtcclxuICAgICAgICB2YXIgbG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uO1xyXG4gICAgICAgIGlmIChmcmFnbWVudCAmJiBhYnNvbHV0ZVVybC50ZXN0KGZyYWdtZW50KSkge1xyXG4gICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gZnJhZ21lbnQ7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuX2lzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnJhZ21lbnQgPSB0aGlzLl9nZXRGcmFnbWVudChmcmFnbWVudCB8fCAnJyk7XHJcbiAgICAgICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWdtZW50ICYmICFyZXBsYWNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50O1xyXG4gICAgICAgIHZhciB1cmwgPSB0aGlzLnJvb3QgKyBmcmFnbWVudDtcclxuICAgICAgICBpZiAoZnJhZ21lbnQgPT09ICcnICYmIHVybCAhPT0gJy8nKSB7XHJcbiAgICAgICAgICAgIHVybCA9IHVybC5zbGljZSgwLCAtMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHtcclxuICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJy8vJywgJy8nKTtcclxuICAgICAgICAgICAgdGhpcy5oaXN0b3J5W3JlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7fSwgRE9NLnRpdGxlLCB1cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHtcclxuICAgICAgICAgICAgdXBkYXRlSGFzaChsb2NhdGlvbiwgZnJhZ21lbnQsIHJlcGxhY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbG9jYXRpb24uYXNzaWduKHVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0cmlnZ2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2FkVXJsKGZyYWdtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLm5hdmlnYXRlQmFjayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmhpc3RvcnkuYmFjaygpO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5zZXRUaXRsZSA9IGZ1bmN0aW9uICh0aXRsZSkge1xyXG4gICAgICAgIERPTS50aXRsZSA9IHRpdGxlO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgdmFyICRoaXN0b3J5ID0gdGhpcy5oaXN0b3J5O1xyXG4gICAgICAgIHZhciBzdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sICRoaXN0b3J5LnN0YXRlKTtcclxuICAgICAgICB2YXIgX2EgPSB0aGlzLmxvY2F0aW9uLCBwYXRobmFtZSA9IF9hLnBhdGhuYW1lLCBzZWFyY2ggPSBfYS5zZWFyY2gsIGhhc2ggPSBfYS5oYXNoO1xyXG4gICAgICAgIHN0YXRlW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAkaGlzdG9yeS5yZXBsYWNlU3RhdGUoc3RhdGUsIG51bGwsIFwiXCIgKyBwYXRobmFtZSArIHNlYXJjaCArIGhhc2gpO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5nZXRTdGF0ZSA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICB2YXIgc3RhdGUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmhpc3Rvcnkuc3RhdGUpO1xyXG4gICAgICAgIHJldHVybiBzdGF0ZVtrZXldO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5nZXRIaXN0b3J5SW5kZXggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGhpc3RvcnlJbmRleCA9IHRoaXMuZ2V0U3RhdGUoJ0hpc3RvcnlJbmRleCcpO1xyXG4gICAgICAgIGlmIChoaXN0b3J5SW5kZXggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBoaXN0b3J5SW5kZXggPSB0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSgnSGlzdG9yeUluZGV4JywgaGlzdG9yeUluZGV4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGhpc3RvcnlJbmRleDtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiAobW92ZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmhpc3RvcnkuZ28obW92ZW1lbnQpO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5fZ2V0SGFzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5oYXNoLnN1YnN0cigxKTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuX2dldEZyYWdtZW50ID0gZnVuY3Rpb24gKGZyYWdtZW50LCBmb3JjZVB1c2hTdGF0ZSkge1xyXG4gICAgICAgIHZhciByb290VXJsO1xyXG4gICAgICAgIGlmICghZnJhZ21lbnQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudHNIYXNoQ2hhbmdlIHx8IGZvcmNlUHVzaFN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb25fMSA9IHRoaXMubG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGxvY2F0aW9uXzEucGF0aG5hbWUgKyBsb2NhdGlvbl8xLnNlYXJjaDtcclxuICAgICAgICAgICAgICAgIHJvb3RVcmwgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWZyYWdtZW50LmluZGV4T2Yocm9vdFVybCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGZyYWdtZW50LnN1YnN0cihyb290VXJsLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuX2dldEhhc2goKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJy8nICsgZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9jaGVja1VybCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuX2dldEZyYWdtZW50KCcnKTtcclxuICAgICAgICBpZiAoY3VycmVudCAhPT0gdGhpcy5mcmFnbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9sb2FkVXJsKCcnKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9sb2FkVXJsID0gZnVuY3Rpb24gKGZyYWdtZW50T3ZlcnJpZGUpIHtcclxuICAgICAgICB2YXIgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID0gdGhpcy5fZ2V0RnJhZ21lbnQoZnJhZ21lbnRPdmVycmlkZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yb3V0ZUhhbmRsZXIgP1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucm91dGVIYW5kbGVyKGZyYWdtZW50KSA6XHJcbiAgICAgICAgICAgIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LmluamVjdCA9IFtMaW5rSGFuZGxlcl07XHJcbiAgICByZXR1cm4gQnJvd3Nlckhpc3Rvcnk7XHJcbn0oSGlzdG9yeSkpO1xyXG52YXIgcm91dGVTdHJpcHBlciA9IC9eIz9cXC8qfFxccyskL2c7XHJcbnZhciByb290U3RyaXBwZXIgPSAvXlxcLyt8XFwvKyQvZztcclxudmFyIHRyYWlsaW5nU2xhc2ggPSAvXFwvJC87XHJcbnZhciBhYnNvbHV0ZVVybCA9IC9eKFthLXpdW2EtejAtOStcXC0uXSo6KT9cXC9cXC8vaTtcclxuZnVuY3Rpb24gdXBkYXRlSGFzaCgkbG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKSB7XHJcbiAgICBpZiAocmVwbGFjZSkge1xyXG4gICAgICAgIHZhciBocmVmID0gJGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvKGphdmFzY3JpcHQ6fCMpLiokLywgJycpO1xyXG4gICAgICAgICRsb2NhdGlvbi5yZXBsYWNlKGhyZWYgKyAnIycgKyBmcmFnbWVudCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAkbG9jYXRpb24uaGFzaCA9ICcjJyArIGZyYWdtZW50O1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZU9yaWdpbihwcm90b2NvbCwgaG9zdG5hbWUsIHBvcnQpIHtcclxuICAgIHJldHVybiBwcm90b2NvbCArIFwiLy9cIiArIGhvc3RuYW1lICsgKHBvcnQgPyAnOicgKyBwb3J0IDogJycpO1xyXG59XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcclxuICAgIHZhciAkY29uZmlnID0gY29uZmlnO1xyXG4gICAgJGNvbmZpZy5zaW5nbGV0b24oSGlzdG9yeSwgQnJvd3Nlckhpc3RvcnkpO1xyXG4gICAgJGNvbmZpZy50cmFuc2llbnQoTGlua0hhbmRsZXIsIERlZmF1bHRMaW5rSGFuZGxlcik7XHJcbn1cblxuZXhwb3J0IHsgQnJvd3Nlckhpc3RvcnksIERlZmF1bHRMaW5rSGFuZGxlciwgTGlua0hhbmRsZXIsIGNvbmZpZ3VyZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVyZWxpYS1oaXN0b3J5LWJyb3dzZXIuanMubWFwXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1oaXN0b3J5LWJyb3dzZXIvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWhpc3RvcnktYnJvd3Nlci5qc1xuLy8gbW9kdWxlIGlkID0gYXVyZWxpYS1oaXN0b3J5LWJyb3dzZXJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiXG5cbmV4cG9ydCB2YXIgQ29uc29sZUFwcGVuZGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDb25zb2xlQXBwZW5kZXIoKSB7XG4gICAgXG4gIH1cblxuICBDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24gZGVidWcobG9nZ2VyKSB7XG4gICAgdmFyIF9jb25zb2xlO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHJlc3QgPSBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICByZXN0W19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICB9XG5cbiAgICAoX2NvbnNvbGUgPSBjb25zb2xlKS5kZWJ1Zy5hcHBseShfY29uc29sZSwgW1wiREVCVUcgW1wiICsgbG9nZ2VyLmlkICsgXCJdXCJdLmNvbmNhdChyZXN0KSk7XG4gIH07XG5cbiAgQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24gaW5mbyhsb2dnZXIpIHtcbiAgICB2YXIgX2NvbnNvbGUyO1xuXG4gICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbjIgPiAxID8gX2xlbjIgLSAxIDogMCksIF9rZXkyID0gMTsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykge1xuICAgICAgcmVzdFtfa2V5MiAtIDFdID0gYXJndW1lbnRzW19rZXkyXTtcbiAgICB9XG5cbiAgICAoX2NvbnNvbGUyID0gY29uc29sZSkuaW5mby5hcHBseShfY29uc29sZTIsIFtcIklORk8gW1wiICsgbG9nZ2VyLmlkICsgXCJdXCJdLmNvbmNhdChyZXN0KSk7XG4gIH07XG5cbiAgQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS53YXJuID0gZnVuY3Rpb24gd2Fybihsb2dnZXIpIHtcbiAgICB2YXIgX2NvbnNvbGUzO1xuXG4gICAgZm9yICh2YXIgX2xlbjMgPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbjMgPiAxID8gX2xlbjMgLSAxIDogMCksIF9rZXkzID0gMTsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykge1xuICAgICAgcmVzdFtfa2V5MyAtIDFdID0gYXJndW1lbnRzW19rZXkzXTtcbiAgICB9XG5cbiAgICAoX2NvbnNvbGUzID0gY29uc29sZSkud2Fybi5hcHBseShfY29uc29sZTMsIFtcIldBUk4gW1wiICsgbG9nZ2VyLmlkICsgXCJdXCJdLmNvbmNhdChyZXN0KSk7XG4gIH07XG5cbiAgQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIGVycm9yKGxvZ2dlcikge1xuICAgIHZhciBfY29uc29sZTQ7XG5cbiAgICBmb3IgKHZhciBfbGVuNCA9IGFyZ3VtZW50cy5sZW5ndGgsIHJlc3QgPSBBcnJheShfbGVuNCA+IDEgPyBfbGVuNCAtIDEgOiAwKSwgX2tleTQgPSAxOyBfa2V5NCA8IF9sZW40OyBfa2V5NCsrKSB7XG4gICAgICByZXN0W19rZXk0IC0gMV0gPSBhcmd1bWVudHNbX2tleTRdO1xuICAgIH1cblxuICAgIChfY29uc29sZTQgPSBjb25zb2xlKS5lcnJvci5hcHBseShfY29uc29sZTQsIFtcIkVSUk9SIFtcIiArIGxvZ2dlci5pZCArIFwiXVwiXS5jb25jYXQocmVzdCkpO1xuICB9O1xuXG4gIHJldHVybiBDb25zb2xlQXBwZW5kZXI7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtbG9nZ2luZy1jb25zb2xlL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1sb2dnaW5nLWNvbnNvbGUuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtbG9nZ2luZy1jb25zb2xlXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIlxuXG5pbXBvcnQgeyBidWlsZFF1ZXJ5U3RyaW5nLCBwYXJzZVF1ZXJ5U3RyaW5nIH0gZnJvbSAnYXVyZWxpYS1wYXRoJztcblxuZXhwb3J0IHZhciBTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RhdGUoY2hhclNwZWMpIHtcbiAgICBcblxuICAgIHRoaXMuY2hhclNwZWMgPSBjaGFyU3BlYztcbiAgICB0aGlzLm5leHRTdGF0ZXMgPSBbXTtcbiAgfVxuXG4gIFN0YXRlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY2hhclNwZWMpIHtcbiAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSB0aGlzLm5leHRTdGF0ZXMsIF9pc0FycmF5ID0gQXJyYXkuaXNBcnJheShfaXRlcmF0b3IpLCBfaSA9IDAsIF9pdGVyYXRvciA9IF9pc0FycmF5ID8gX2l0ZXJhdG9yIDogX2l0ZXJhdG9yW1N5bWJvbC5pdGVyYXRvcl0oKTs7KSB7XG4gICAgICB2YXIgX3JlZjtcblxuICAgICAgaWYgKF9pc0FycmF5KSB7XG4gICAgICAgIGlmIChfaSA+PSBfaXRlcmF0b3IubGVuZ3RoKSBicmVhaztcbiAgICAgICAgX3JlZiA9IF9pdGVyYXRvcltfaSsrXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9pID0gX2l0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgaWYgKF9pLmRvbmUpIGJyZWFrO1xuICAgICAgICBfcmVmID0gX2kudmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBjaGlsZCA9IF9yZWY7XG5cbiAgICAgIHZhciBpc0VxdWFsID0gY2hpbGQuY2hhclNwZWMudmFsaWRDaGFycyA9PT0gY2hhclNwZWMudmFsaWRDaGFycyAmJiBjaGlsZC5jaGFyU3BlYy5pbnZhbGlkQ2hhcnMgPT09IGNoYXJTcGVjLmludmFsaWRDaGFycztcblxuICAgICAgaWYgKGlzRXF1YWwpIHtcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgU3RhdGUucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uIHB1dChjaGFyU3BlYykge1xuICAgIHZhciBzdGF0ZSA9IHRoaXMuZ2V0KGNoYXJTcGVjKTtcblxuICAgIGlmIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIHN0YXRlID0gbmV3IFN0YXRlKGNoYXJTcGVjKTtcblxuICAgIHRoaXMubmV4dFN0YXRlcy5wdXNoKHN0YXRlKTtcblxuICAgIGlmIChjaGFyU3BlYy5yZXBlYXQpIHtcbiAgICAgIHN0YXRlLm5leHRTdGF0ZXMucHVzaChzdGF0ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRlO1xuICB9O1xuXG4gIFN0YXRlLnByb3RvdHlwZS5tYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKGNoKSB7XG4gICAgdmFyIG5leHRTdGF0ZXMgPSB0aGlzLm5leHRTdGF0ZXM7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gbmV4dFN0YXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIHZhciBjaGlsZCA9IG5leHRTdGF0ZXNbaV07XG4gICAgICB2YXIgY2hhclNwZWMgPSBjaGlsZC5jaGFyU3BlYztcblxuICAgICAgaWYgKGNoYXJTcGVjLnZhbGlkQ2hhcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY2hhclNwZWMudmFsaWRDaGFycy5pbmRleE9mKGNoKSAhPT0gLTEpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goY2hpbGQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoYXJTcGVjLmludmFsaWRDaGFycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChjaGFyU3BlYy5pbnZhbGlkQ2hhcnMuaW5kZXhPZihjaCkgPT09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIHJldHVybiBTdGF0ZTtcbn0oKTtcblxudmFyIHNwZWNpYWxzID0gWycvJywgJy4nLCAnKicsICcrJywgJz8nLCAnfCcsICcoJywgJyknLCAnWycsICddJywgJ3snLCAnfScsICdcXFxcJ107XG5cbnZhciBlc2NhcGVSZWdleCA9IG5ldyBSZWdFeHAoJyhcXFxcJyArIHNwZWNpYWxzLmpvaW4oJ3xcXFxcJykgKyAnKScsICdnJyk7XG5cbmV4cG9ydCB2YXIgU3RhdGljU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RhdGljU2VnbWVudChzdHJpbmcsIGNhc2VTZW5zaXRpdmUpIHtcbiAgICBcblxuICAgIHRoaXMuc3RyaW5nID0gc3RyaW5nO1xuICAgIHRoaXMuY2FzZVNlbnNpdGl2ZSA9IGNhc2VTZW5zaXRpdmU7XG4gIH1cblxuICBTdGF0aWNTZWdtZW50LnByb3RvdHlwZS5lYWNoQ2hhciA9IGZ1bmN0aW9uIGVhY2hDaGFyKGNhbGxiYWNrKSB7XG4gICAgdmFyIHMgPSB0aGlzLnN0cmluZztcbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIHZhciBjaCA9IHNbaV07XG4gICAgICBjYWxsYmFjayh7IHZhbGlkQ2hhcnM6IHRoaXMuY2FzZVNlbnNpdGl2ZSA/IGNoIDogY2gudG9VcHBlckNhc2UoKSArIGNoLnRvTG93ZXJDYXNlKCkgfSk7XG4gICAgfVxuICB9O1xuXG4gIFN0YXRpY1NlZ21lbnQucHJvdG90eXBlLnJlZ2V4ID0gZnVuY3Rpb24gcmVnZXgoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaW5nLnJlcGxhY2UoZXNjYXBlUmVnZXgsICdcXFxcJDEnKTtcbiAgfTtcblxuICBTdGF0aWNTZWdtZW50LnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uIGdlbmVyYXRlKCkge1xuICAgIHJldHVybiB0aGlzLnN0cmluZztcbiAgfTtcblxuICByZXR1cm4gU3RhdGljU2VnbWVudDtcbn0oKTtcblxuZXhwb3J0IHZhciBEeW5hbWljU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRHluYW1pY1NlZ21lbnQobmFtZSwgb3B0aW9uYWwpIHtcbiAgICBcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5vcHRpb25hbCA9IG9wdGlvbmFsO1xuICB9XG5cbiAgRHluYW1pY1NlZ21lbnQucHJvdG90eXBlLmVhY2hDaGFyID0gZnVuY3Rpb24gZWFjaENoYXIoY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjayh7IGludmFsaWRDaGFyczogJy8nLCByZXBlYXQ6IHRydWUgfSk7XG4gIH07XG5cbiAgRHluYW1pY1NlZ21lbnQucHJvdG90eXBlLnJlZ2V4ID0gZnVuY3Rpb24gcmVnZXgoKSB7XG4gICAgcmV0dXJuICcoW14vXSspJztcbiAgfTtcblxuICBEeW5hbWljU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZShwYXJhbXMsIGNvbnN1bWVkKSB7XG4gICAgY29uc3VtZWRbdGhpcy5uYW1lXSA9IHRydWU7XG4gICAgcmV0dXJuIHBhcmFtc1t0aGlzLm5hbWVdO1xuICB9O1xuXG4gIHJldHVybiBEeW5hbWljU2VnbWVudDtcbn0oKTtcblxuZXhwb3J0IHZhciBTdGFyU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RhclNlZ21lbnQobmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIFN0YXJTZWdtZW50LnByb3RvdHlwZS5lYWNoQ2hhciA9IGZ1bmN0aW9uIGVhY2hDaGFyKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2soeyBpbnZhbGlkQ2hhcnM6ICcnLCByZXBlYXQ6IHRydWUgfSk7XG4gIH07XG5cbiAgU3RhclNlZ21lbnQucHJvdG90eXBlLnJlZ2V4ID0gZnVuY3Rpb24gcmVnZXgoKSB7XG4gICAgcmV0dXJuICcoLispJztcbiAgfTtcblxuICBTdGFyU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZShwYXJhbXMsIGNvbnN1bWVkKSB7XG4gICAgY29uc3VtZWRbdGhpcy5uYW1lXSA9IHRydWU7XG4gICAgcmV0dXJuIHBhcmFtc1t0aGlzLm5hbWVdO1xuICB9O1xuXG4gIHJldHVybiBTdGFyU2VnbWVudDtcbn0oKTtcblxuZXhwb3J0IHZhciBFcHNpbG9uU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXBzaWxvblNlZ21lbnQoKSB7XG4gICAgXG4gIH1cblxuICBFcHNpbG9uU2VnbWVudC5wcm90b3R5cGUuZWFjaENoYXIgPSBmdW5jdGlvbiBlYWNoQ2hhcigpIHt9O1xuXG4gIEVwc2lsb25TZWdtZW50LnByb3RvdHlwZS5yZWdleCA9IGZ1bmN0aW9uIHJlZ2V4KCkge1xuICAgIHJldHVybiAnJztcbiAgfTtcblxuICBFcHNpbG9uU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZSgpIHtcbiAgICByZXR1cm4gJyc7XG4gIH07XG5cbiAgcmV0dXJuIEVwc2lsb25TZWdtZW50O1xufSgpO1xuXG5leHBvcnQgdmFyIFJvdXRlUmVjb2duaXplciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gUm91dGVSZWNvZ25pemVyKCkge1xuICAgIFxuXG4gICAgdGhpcy5yb290U3RhdGUgPSBuZXcgU3RhdGUoKTtcbiAgICB0aGlzLm5hbWVzID0ge307XG4gICAgdGhpcy5yb3V0ZXMgPSBuZXcgTWFwKCk7XG4gIH1cblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIGFkZChyb3V0ZSkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShyb3V0ZSkpIHtcbiAgICAgIHJvdXRlLmZvckVhY2goZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLmFkZChyKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICB2YXIgY3VycmVudFN0YXRlID0gdGhpcy5yb290U3RhdGU7XG4gICAgdmFyIHNraXBwYWJsZVN0YXRlcyA9IFtdO1xuICAgIHZhciByZWdleCA9ICdeJztcbiAgICB2YXIgdHlwZXMgPSB7IHN0YXRpY3M6IDAsIGR5bmFtaWNzOiAwLCBzdGFyczogMCB9O1xuICAgIHZhciBuYW1lcyA9IFtdO1xuICAgIHZhciByb3V0ZU5hbWUgPSByb3V0ZS5oYW5kbGVyLm5hbWU7XG4gICAgdmFyIGlzRW1wdHkgPSB0cnVlO1xuICAgIHZhciBzZWdtZW50cyA9IHBhcnNlKHJvdXRlLnBhdGgsIG5hbWVzLCB0eXBlcywgcm91dGUuY2FzZVNlbnNpdGl2ZSk7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzZWdtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7XG4gICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2ldO1xuICAgICAgaWYgKHNlZ21lbnQgaW5zdGFuY2VvZiBFcHNpbG9uU2VnbWVudCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9hZGRTZWdtZW50ID0gYWRkU2VnbWVudChjdXJyZW50U3RhdGUsIHNlZ21lbnQpLFxuICAgICAgICAgIGZpcnN0U3RhdGUgPSBfYWRkU2VnbWVudFswXSxcbiAgICAgICAgICBuZXh0U3RhdGUgPSBfYWRkU2VnbWVudFsxXTtcblxuICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gc2tpcHBhYmxlU3RhdGVzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHtcbiAgICAgICAgc2tpcHBhYmxlU3RhdGVzW2pdLm5leHRTdGF0ZXMucHVzaChmaXJzdFN0YXRlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNlZ21lbnQub3B0aW9uYWwpIHtcbiAgICAgICAgc2tpcHBhYmxlU3RhdGVzLnB1c2gobmV4dFN0YXRlKTtcbiAgICAgICAgcmVnZXggKz0gJyg/Oi8nICsgc2VnbWVudC5yZWdleCgpICsgJyk/JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRTdGF0ZSA9IG5leHRTdGF0ZTtcbiAgICAgICAgcmVnZXggKz0gJy8nICsgc2VnbWVudC5yZWdleCgpO1xuICAgICAgICBza2lwcGFibGVTdGF0ZXMubGVuZ3RoID0gMDtcbiAgICAgICAgaXNFbXB0eSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc0VtcHR5KSB7XG4gICAgICBjdXJyZW50U3RhdGUgPSBjdXJyZW50U3RhdGUucHV0KHsgdmFsaWRDaGFyczogJy8nIH0pO1xuICAgICAgcmVnZXggKz0gJy8/JztcbiAgICB9XG5cbiAgICB2YXIgaGFuZGxlcnMgPSBbeyBoYW5kbGVyOiByb3V0ZS5oYW5kbGVyLCBuYW1lczogbmFtZXMgfV07XG5cbiAgICB0aGlzLnJvdXRlcy5zZXQocm91dGUuaGFuZGxlciwgeyBzZWdtZW50czogc2VnbWVudHMsIGhhbmRsZXJzOiBoYW5kbGVycyB9KTtcbiAgICBpZiAocm91dGVOYW1lKSB7XG4gICAgICB2YXIgcm91dGVOYW1lcyA9IEFycmF5LmlzQXJyYXkocm91dGVOYW1lKSA/IHJvdXRlTmFtZSA6IFtyb3V0ZU5hbWVdO1xuICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgcm91dGVOYW1lcy5sZW5ndGg7IF9pMisrKSB7XG4gICAgICAgIGlmICghKHJvdXRlTmFtZXNbX2kyXSBpbiB0aGlzLm5hbWVzKSkge1xuICAgICAgICAgIHRoaXMubmFtZXNbcm91dGVOYW1lc1tfaTJdXSA9IHsgc2VnbWVudHM6IHNlZ21lbnRzLCBoYW5kbGVyczogaGFuZGxlcnMgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHNraXBwYWJsZVN0YXRlcy5sZW5ndGg7IF9pMysrKSB7XG4gICAgICB2YXIgc3RhdGUgPSBza2lwcGFibGVTdGF0ZXNbX2kzXTtcbiAgICAgIHN0YXRlLmhhbmRsZXJzID0gaGFuZGxlcnM7XG4gICAgICBzdGF0ZS5yZWdleCA9IG5ldyBSZWdFeHAocmVnZXggKyAnJCcsIHJvdXRlLmNhc2VTZW5zaXRpdmUgPyAnJyA6ICdpJyk7XG4gICAgICBzdGF0ZS50eXBlcyA9IHR5cGVzO1xuICAgIH1cblxuICAgIGN1cnJlbnRTdGF0ZS5oYW5kbGVycyA9IGhhbmRsZXJzO1xuICAgIGN1cnJlbnRTdGF0ZS5yZWdleCA9IG5ldyBSZWdFeHAocmVnZXggKyAnJCcsIHJvdXRlLmNhc2VTZW5zaXRpdmUgPyAnJyA6ICdpJyk7XG4gICAgY3VycmVudFN0YXRlLnR5cGVzID0gdHlwZXM7XG5cbiAgICByZXR1cm4gY3VycmVudFN0YXRlO1xuICB9O1xuXG4gIFJvdXRlUmVjb2duaXplci5wcm90b3R5cGUuZ2V0Um91dGUgPSBmdW5jdGlvbiBnZXRSb3V0ZShuYW1lT3JSb3V0ZSkge1xuICAgIHJldHVybiB0eXBlb2YgbmFtZU9yUm91dGUgPT09ICdzdHJpbmcnID8gdGhpcy5uYW1lc1tuYW1lT3JSb3V0ZV0gOiB0aGlzLnJvdXRlcy5nZXQobmFtZU9yUm91dGUpO1xuICB9O1xuXG4gIFJvdXRlUmVjb2duaXplci5wcm90b3R5cGUuaGFuZGxlcnNGb3IgPSBmdW5jdGlvbiBoYW5kbGVyc0ZvcihuYW1lT3JSb3V0ZSkge1xuICAgIHZhciByb3V0ZSA9IHRoaXMuZ2V0Um91dGUobmFtZU9yUm91dGUpO1xuICAgIGlmICghcm91dGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgaXMgbm8gcm91dGUgbmFtZWQgJyArIG5hbWVPclJvdXRlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gW10uY29uY2F0KHJvdXRlLmhhbmRsZXJzKTtcbiAgfTtcblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLmhhc1JvdXRlID0gZnVuY3Rpb24gaGFzUm91dGUobmFtZU9yUm91dGUpIHtcbiAgICByZXR1cm4gISF0aGlzLmdldFJvdXRlKG5hbWVPclJvdXRlKTtcbiAgfTtcblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gZ2VuZXJhdGUobmFtZU9yUm91dGUsIHBhcmFtcykge1xuICAgIHZhciByb3V0ZSA9IHRoaXMuZ2V0Um91dGUobmFtZU9yUm91dGUpO1xuICAgIGlmICghcm91dGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgaXMgbm8gcm91dGUgbmFtZWQgJyArIG5hbWVPclJvdXRlKTtcbiAgICB9XG5cbiAgICB2YXIgaGFuZGxlciA9IHJvdXRlLmhhbmRsZXJzWzBdLmhhbmRsZXI7XG4gICAgaWYgKGhhbmRsZXIuZ2VuZXJhdGlvblVzZXNIcmVmKSB7XG4gICAgICByZXR1cm4gaGFuZGxlci5ocmVmO1xuICAgIH1cblxuICAgIHZhciByb3V0ZVBhcmFtcyA9IE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyk7XG4gICAgdmFyIHNlZ21lbnRzID0gcm91dGUuc2VnbWVudHM7XG4gICAgdmFyIGNvbnN1bWVkID0ge307XG4gICAgdmFyIG91dHB1dCA9ICcnO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWdtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIHZhciBzZWdtZW50ID0gc2VnbWVudHNbaV07XG5cbiAgICAgIGlmIChzZWdtZW50IGluc3RhbmNlb2YgRXBzaWxvblNlZ21lbnQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBzZWdtZW50VmFsdWUgPSBzZWdtZW50LmdlbmVyYXRlKHJvdXRlUGFyYW1zLCBjb25zdW1lZCk7XG4gICAgICBpZiAoc2VnbWVudFZhbHVlID09PSBudWxsIHx8IHNlZ21lbnRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICghc2VnbWVudC5vcHRpb25hbCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQSB2YWx1ZSBpcyByZXF1aXJlZCBmb3Igcm91dGUgcGFyYW1ldGVyIFxcJycgKyBzZWdtZW50Lm5hbWUgKyAnXFwnIGluIHJvdXRlIFxcJycgKyBuYW1lT3JSb3V0ZSArICdcXCcuJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dHB1dCArPSAnLyc7XG4gICAgICAgIG91dHB1dCArPSBzZWdtZW50VmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG91dHB1dC5jaGFyQXQoMCkgIT09ICcvJykge1xuICAgICAgb3V0cHV0ID0gJy8nICsgb3V0cHV0O1xuICAgIH1cblxuICAgIGZvciAodmFyIHBhcmFtIGluIGNvbnN1bWVkKSB7XG4gICAgICBkZWxldGUgcm91dGVQYXJhbXNbcGFyYW1dO1xuICAgIH1cblxuICAgIHZhciBxdWVyeVN0cmluZyA9IGJ1aWxkUXVlcnlTdHJpbmcocm91dGVQYXJhbXMpO1xuICAgIG91dHB1dCArPSBxdWVyeVN0cmluZyA/ICc/JyArIHF1ZXJ5U3RyaW5nIDogJyc7XG5cbiAgICByZXR1cm4gb3V0cHV0O1xuICB9O1xuXG4gIFJvdXRlUmVjb2duaXplci5wcm90b3R5cGUucmVjb2duaXplID0gZnVuY3Rpb24gcmVjb2duaXplKHBhdGgpIHtcbiAgICB2YXIgc3RhdGVzID0gW3RoaXMucm9vdFN0YXRlXTtcbiAgICB2YXIgcXVlcnlQYXJhbXMgPSB7fTtcbiAgICB2YXIgaXNTbGFzaERyb3BwZWQgPSBmYWxzZTtcbiAgICB2YXIgbm9ybWFsaXplZFBhdGggPSBwYXRoO1xuXG4gICAgdmFyIHF1ZXJ5U3RhcnQgPSBub3JtYWxpemVkUGF0aC5pbmRleE9mKCc/Jyk7XG4gICAgaWYgKHF1ZXJ5U3RhcnQgIT09IC0xKSB7XG4gICAgICB2YXIgcXVlcnlTdHJpbmcgPSBub3JtYWxpemVkUGF0aC5zdWJzdHIocXVlcnlTdGFydCArIDEsIG5vcm1hbGl6ZWRQYXRoLmxlbmd0aCk7XG4gICAgICBub3JtYWxpemVkUGF0aCA9IG5vcm1hbGl6ZWRQYXRoLnN1YnN0cigwLCBxdWVyeVN0YXJ0KTtcbiAgICAgIHF1ZXJ5UGFyYW1zID0gcGFyc2VRdWVyeVN0cmluZyhxdWVyeVN0cmluZyk7XG4gICAgfVxuXG4gICAgbm9ybWFsaXplZFBhdGggPSBkZWNvZGVVUkkobm9ybWFsaXplZFBhdGgpO1xuXG4gICAgaWYgKG5vcm1hbGl6ZWRQYXRoLmNoYXJBdCgwKSAhPT0gJy8nKSB7XG4gICAgICBub3JtYWxpemVkUGF0aCA9ICcvJyArIG5vcm1hbGl6ZWRQYXRoO1xuICAgIH1cblxuICAgIHZhciBwYXRoTGVuID0gbm9ybWFsaXplZFBhdGgubGVuZ3RoO1xuICAgIGlmIChwYXRoTGVuID4gMSAmJiBub3JtYWxpemVkUGF0aC5jaGFyQXQocGF0aExlbiAtIDEpID09PSAnLycpIHtcbiAgICAgIG5vcm1hbGl6ZWRQYXRoID0gbm9ybWFsaXplZFBhdGguc3Vic3RyKDAsIHBhdGhMZW4gLSAxKTtcbiAgICAgIGlzU2xhc2hEcm9wcGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5vcm1hbGl6ZWRQYXRoLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgc3RhdGVzID0gcmVjb2duaXplQ2hhcihzdGF0ZXMsIG5vcm1hbGl6ZWRQYXRoLmNoYXJBdChpKSk7XG4gICAgICBpZiAoIXN0YXRlcy5sZW5ndGgpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHNvbHV0aW9ucyA9IFtdO1xuICAgIGZvciAodmFyIF9pNCA9IDAsIF9sID0gc3RhdGVzLmxlbmd0aDsgX2k0IDwgX2w7IF9pNCsrKSB7XG4gICAgICBpZiAoc3RhdGVzW19pNF0uaGFuZGxlcnMpIHtcbiAgICAgICAgc29sdXRpb25zLnB1c2goc3RhdGVzW19pNF0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRlcyA9IHNvcnRTb2x1dGlvbnMoc29sdXRpb25zKTtcblxuICAgIHZhciBzdGF0ZSA9IHNvbHV0aW9uc1swXTtcbiAgICBpZiAoc3RhdGUgJiYgc3RhdGUuaGFuZGxlcnMpIHtcbiAgICAgIGlmIChpc1NsYXNoRHJvcHBlZCAmJiBzdGF0ZS5yZWdleC5zb3VyY2Uuc2xpY2UoLTUpID09PSAnKC4rKSQnKSB7XG4gICAgICAgIG5vcm1hbGl6ZWRQYXRoID0gbm9ybWFsaXplZFBhdGggKyAnLyc7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmaW5kSGFuZGxlcihzdGF0ZSwgbm9ybWFsaXplZFBhdGgsIHF1ZXJ5UGFyYW1zKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFJvdXRlUmVjb2duaXplcjtcbn0oKTtcblxudmFyIFJlY29nbml6ZVJlc3VsdHMgPSBmdW5jdGlvbiBSZWNvZ25pemVSZXN1bHRzKHF1ZXJ5UGFyYW1zKSB7XG4gIFxuXG4gIHRoaXMuc3BsaWNlID0gQXJyYXkucHJvdG90eXBlLnNwbGljZTtcbiAgdGhpcy5zbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcbiAgdGhpcy5wdXNoID0gQXJyYXkucHJvdG90eXBlLnB1c2g7XG4gIHRoaXMubGVuZ3RoID0gMDtcbiAgdGhpcy5xdWVyeVBhcmFtcyA9IHF1ZXJ5UGFyYW1zIHx8IHt9O1xufTtcblxuZnVuY3Rpb24gcGFyc2Uocm91dGUsIG5hbWVzLCB0eXBlcywgY2FzZVNlbnNpdGl2ZSkge1xuICB2YXIgbm9ybWFsaXplZFJvdXRlID0gcm91dGU7XG4gIGlmIChyb3V0ZS5jaGFyQXQoMCkgPT09ICcvJykge1xuICAgIG5vcm1hbGl6ZWRSb3V0ZSA9IHJvdXRlLnN1YnN0cigxKTtcbiAgfVxuXG4gIHZhciByZXN1bHRzID0gW107XG5cbiAgdmFyIHNwbGl0Um91dGUgPSBub3JtYWxpemVkUm91dGUuc3BsaXQoJy8nKTtcbiAgZm9yICh2YXIgaSA9IDAsIGlpID0gc3BsaXRSb3V0ZS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgdmFyIHNlZ21lbnQgPSBzcGxpdFJvdXRlW2ldO1xuXG4gICAgdmFyIG1hdGNoID0gc2VnbWVudC5tYXRjaCgvXjooW14/XSspKFxcPyk/JC8pO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgdmFyIF9tYXRjaCA9IG1hdGNoLFxuICAgICAgICAgIF9uYW1lID0gX21hdGNoWzFdLFxuICAgICAgICAgIG9wdGlvbmFsID0gX21hdGNoWzJdO1xuXG4gICAgICBpZiAoX25hbWUuaW5kZXhPZignPScpICE9PSAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciAnICsgX25hbWUgKyAnIGluIHJvdXRlICcgKyByb3V0ZSArICcgaGFzIGEgZGVmYXVsdCB2YWx1ZSwgd2hpY2ggaXMgbm90IHN1cHBvcnRlZC4nKTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdHMucHVzaChuZXcgRHluYW1pY1NlZ21lbnQoX25hbWUsICEhb3B0aW9uYWwpKTtcbiAgICAgIG5hbWVzLnB1c2goX25hbWUpO1xuICAgICAgdHlwZXMuZHluYW1pY3MrKztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIG1hdGNoID0gc2VnbWVudC5tYXRjaCgvXlxcKiguKykkLyk7XG4gICAgaWYgKG1hdGNoKSB7XG4gICAgICByZXN1bHRzLnB1c2gobmV3IFN0YXJTZWdtZW50KG1hdGNoWzFdKSk7XG4gICAgICBuYW1lcy5wdXNoKG1hdGNoWzFdKTtcbiAgICAgIHR5cGVzLnN0YXJzKys7XG4gICAgfSBlbHNlIGlmIChzZWdtZW50ID09PSAnJykge1xuICAgICAgcmVzdWx0cy5wdXNoKG5ldyBFcHNpbG9uU2VnbWVudCgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0cy5wdXNoKG5ldyBTdGF0aWNTZWdtZW50KHNlZ21lbnQsIGNhc2VTZW5zaXRpdmUpKTtcbiAgICAgIHR5cGVzLnN0YXRpY3MrKztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzdWx0cztcbn1cblxuZnVuY3Rpb24gc29ydFNvbHV0aW9ucyhzdGF0ZXMpIHtcbiAgcmV0dXJuIHN0YXRlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgaWYgKGEudHlwZXMuc3RhcnMgIT09IGIudHlwZXMuc3RhcnMpIHtcbiAgICAgIHJldHVybiBhLnR5cGVzLnN0YXJzIC0gYi50eXBlcy5zdGFycztcbiAgICB9XG5cbiAgICBpZiAoYS50eXBlcy5zdGFycykge1xuICAgICAgaWYgKGEudHlwZXMuc3RhdGljcyAhPT0gYi50eXBlcy5zdGF0aWNzKSB7XG4gICAgICAgIHJldHVybiBiLnR5cGVzLnN0YXRpY3MgLSBhLnR5cGVzLnN0YXRpY3M7XG4gICAgICB9XG4gICAgICBpZiAoYS50eXBlcy5keW5hbWljcyAhPT0gYi50eXBlcy5keW5hbWljcykge1xuICAgICAgICByZXR1cm4gYi50eXBlcy5keW5hbWljcyAtIGEudHlwZXMuZHluYW1pY3M7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGEudHlwZXMuZHluYW1pY3MgIT09IGIudHlwZXMuZHluYW1pY3MpIHtcbiAgICAgIHJldHVybiBhLnR5cGVzLmR5bmFtaWNzIC0gYi50eXBlcy5keW5hbWljcztcbiAgICB9XG5cbiAgICBpZiAoYS50eXBlcy5zdGF0aWNzICE9PSBiLnR5cGVzLnN0YXRpY3MpIHtcbiAgICAgIHJldHVybiBiLnR5cGVzLnN0YXRpY3MgLSBhLnR5cGVzLnN0YXRpY3M7XG4gICAgfVxuXG4gICAgcmV0dXJuIDA7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZWNvZ25pemVDaGFyKHN0YXRlcywgY2gpIHtcbiAgdmFyIG5leHRTdGF0ZXMgPSBbXTtcblxuICBmb3IgKHZhciBpID0gMCwgbCA9IHN0YXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICB2YXIgc3RhdGUgPSBzdGF0ZXNbaV07XG4gICAgbmV4dFN0YXRlcy5wdXNoLmFwcGx5KG5leHRTdGF0ZXMsIHN0YXRlLm1hdGNoKGNoKSk7XG4gIH1cblxuICByZXR1cm4gbmV4dFN0YXRlcztcbn1cblxuZnVuY3Rpb24gZmluZEhhbmRsZXIoc3RhdGUsIHBhdGgsIHF1ZXJ5UGFyYW1zKSB7XG4gIHZhciBoYW5kbGVycyA9IHN0YXRlLmhhbmRsZXJzO1xuICB2YXIgcmVnZXggPSBzdGF0ZS5yZWdleDtcbiAgdmFyIGNhcHR1cmVzID0gcGF0aC5tYXRjaChyZWdleCk7XG4gIHZhciBjdXJyZW50Q2FwdHVyZSA9IDE7XG4gIHZhciByZXN1bHQgPSBuZXcgUmVjb2duaXplUmVzdWx0cyhxdWVyeVBhcmFtcyk7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGwgPSBoYW5kbGVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICB2YXIgX2hhbmRsZXIgPSBoYW5kbGVyc1tpXTtcbiAgICB2YXIgX25hbWVzID0gX2hhbmRsZXIubmFtZXM7XG4gICAgdmFyIF9wYXJhbXMgPSB7fTtcblxuICAgIGZvciAodmFyIGogPSAwLCBtID0gX25hbWVzLmxlbmd0aDsgaiA8IG07IGorKykge1xuICAgICAgX3BhcmFtc1tfbmFtZXNbal1dID0gY2FwdHVyZXNbY3VycmVudENhcHR1cmUrK107XG4gICAgfVxuXG4gICAgcmVzdWx0LnB1c2goeyBoYW5kbGVyOiBfaGFuZGxlci5oYW5kbGVyLCBwYXJhbXM6IF9wYXJhbXMsIGlzRHluYW1pYzogISFfbmFtZXMubGVuZ3RoIH0pO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gYWRkU2VnbWVudChjdXJyZW50U3RhdGUsIHNlZ21lbnQpIHtcbiAgdmFyIGZpcnN0U3RhdGUgPSBjdXJyZW50U3RhdGUucHV0KHsgdmFsaWRDaGFyczogJy8nIH0pO1xuICB2YXIgbmV4dFN0YXRlID0gZmlyc3RTdGF0ZTtcbiAgc2VnbWVudC5lYWNoQ2hhcihmdW5jdGlvbiAoY2gpIHtcbiAgICBuZXh0U3RhdGUgPSBuZXh0U3RhdGUucHV0KGNoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIFtmaXJzdFN0YXRlLCBuZXh0U3RhdGVdO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXJvdXRlLXJlY29nbml6ZXIvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXJvdXRlLXJlY29nbml6ZXIuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtcm91dGUtcmVjb2duaXplclxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJpbXBvcnQgeyBnZXRMb2dnZXIgfSBmcm9tICdhdXJlbGlhLWxvZ2dpbmcnO1xuaW1wb3J0IHsgQ29udGFpbmVyIH0gZnJvbSAnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbic7XG5pbXBvcnQgeyBIaXN0b3J5IH0gZnJvbSAnYXVyZWxpYS1oaXN0b3J5JztcbmltcG9ydCB7IFJvdXRlUmVjb2duaXplciB9IGZyb20gJ2F1cmVsaWEtcm91dGUtcmVjb2duaXplcic7XG5pbXBvcnQgeyBFdmVudEFnZ3JlZ2F0b3IgfSBmcm9tICdhdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3InO1xuXG4vKipcclxuICogQ2xhc3MgdXNlZCB0byByZXByZXNlbnQgYW4gaW5zdHJ1Y3Rpb24gZHVyaW5nIGEgbmF2aWdhdGlvbi5cclxuICovXHJcbmNsYXNzIE5hdmlnYXRpb25JbnN0cnVjdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3Rvcihpbml0KSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ3VycmVudCBidWlsdCB2aWV3cG9ydCBwbGFuIG9mIHRoaXMgbmF2IGluc3RydWN0aW9uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5wbGFuID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7fTtcclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIGluaXQpO1xyXG4gICAgICAgIHRoaXMucGFyYW1zID0gdGhpcy5wYXJhbXMgfHwge307XHJcbiAgICAgICAgdGhpcy52aWV3UG9ydEluc3RydWN0aW9ucyA9IHt9O1xyXG4gICAgICAgIGxldCBhbmNlc3RvclBhcmFtcyA9IFtdO1xyXG4gICAgICAgIGxldCBjdXJyZW50ID0gdGhpcztcclxuICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50UGFyYW1zID0gT2JqZWN0LmFzc2lnbih7fSwgY3VycmVudC5wYXJhbXMpO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudC5jb25maWcgJiYgY3VycmVudC5jb25maWcuaGFzQ2hpbGRSb3V0ZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0aGUgcGFyYW0gZm9yIHRoZSBpbmplY3RlZCBjaGlsZCByb3V0ZSBzZWdtZW50XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgY3VycmVudFBhcmFtc1tjdXJyZW50LmdldFdpbGRDYXJkTmFtZSgpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhbmNlc3RvclBhcmFtcy51bnNoaWZ0KGN1cnJlbnRQYXJhbXMpO1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5wYXJlbnRJbnN0cnVjdGlvbjtcclxuICAgICAgICB9IHdoaWxlIChjdXJyZW50KTtcclxuICAgICAgICBsZXQgYWxsUGFyYW1zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5xdWVyeVBhcmFtcywgLi4uYW5jZXN0b3JQYXJhbXMpO1xyXG4gICAgICAgIHRoaXMubGlmZWN5Y2xlQXJncyA9IFthbGxQYXJhbXMsIHRoaXMuY29uZmlnLCB0aGlzXTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhbiBhcnJheSBjb250YWluaW5nIHRoaXMgaW5zdHJ1Y3Rpb24gYW5kIGFsbCBjaGlsZCBpbnN0cnVjdGlvbnMgZm9yIHRoZSBjdXJyZW50IG5hdmlnYXRpb24uXHJcbiAgICAgKi9cclxuICAgIGdldEFsbEluc3RydWN0aW9ucygpIHtcclxuICAgICAgICBsZXQgaW5zdHJ1Y3Rpb25zID0gW3RoaXNdO1xyXG4gICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9ucyA9IHRoaXMudmlld1BvcnRJbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHZpZXdQb3J0SW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgICAgICAgIGxldCBjaGlsZEluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbnNba2V5XS5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgaWYgKGNoaWxkSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKC4uLmNoaWxkSW5zdHJ1Y3Rpb24uZ2V0QWxsSW5zdHJ1Y3Rpb25zKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbnM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgaW5zdHJ1Y3Rpb24gYW5kIGFsbCBjaGlsZCBpbnN0cnVjdGlvbnMgZm9yIHRoZSBwcmV2aW91cyBuYXZpZ2F0aW9uLlxyXG4gICAgICogUHJldmlvdXMgaW5zdHJ1Y3Rpb25zIGFyZSBubyBsb25nZXIgYXZhaWxhYmxlIGFmdGVyIG5hdmlnYXRpb24gY29tcGxldGVzLlxyXG4gICAgICovXHJcbiAgICBnZXRBbGxQcmV2aW91c0luc3RydWN0aW9ucygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxJbnN0cnVjdGlvbnMoKS5tYXAoYyA9PiBjLnByZXZpb3VzSW5zdHJ1Y3Rpb24pLmZpbHRlcihjID0+IGMpO1xyXG4gICAgfVxyXG4gICAgYWRkVmlld1BvcnRJbnN0cnVjdGlvbihuYW1lT3JJbml0T3B0aW9ucywgc3RyYXRlZ3ksIG1vZHVsZUlkLCBjb21wb25lbnQpIHtcclxuICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbjtcclxuICAgICAgICBsZXQgdmlld1BvcnROYW1lID0gdHlwZW9mIG5hbWVPckluaXRPcHRpb25zID09PSAnc3RyaW5nJyA/IG5hbWVPckluaXRPcHRpb25zIDogbmFtZU9ySW5pdE9wdGlvbnMubmFtZTtcclxuICAgICAgICBjb25zdCBsaWZlY3ljbGVBcmdzID0gdGhpcy5saWZlY3ljbGVBcmdzO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGxpZmVjeWNsZUFyZ3NbMV0sIHsgY3VycmVudFZpZXdQb3J0OiB2aWV3UG9ydE5hbWUgfSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JJbml0T3B0aW9ucyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdmlld1BvcnRJbnN0cnVjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWVPckluaXRPcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgc3RyYXRlZ3k6IHN0cmF0ZWd5LFxyXG4gICAgICAgICAgICAgICAgbW9kdWxlSWQ6IG1vZHVsZUlkLFxyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiBjb21wb25lbnQsXHJcbiAgICAgICAgICAgICAgICBjaGlsZFJvdXRlcjogY29tcG9uZW50LmNoaWxkUm91dGVyLFxyXG4gICAgICAgICAgICAgICAgbGlmZWN5Y2xlQXJnczogW2xpZmVjeWNsZUFyZ3NbMF0sIGNvbmZpZywgbGlmZWN5Y2xlQXJnc1syXV1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0SW5zdHJ1Y3Rpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2aWV3UG9ydE5hbWUsXHJcbiAgICAgICAgICAgICAgICBzdHJhdGVneTogbmFtZU9ySW5pdE9wdGlvbnMuc3RyYXRlZ3ksXHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6IG5hbWVPckluaXRPcHRpb25zLmNvbXBvbmVudCxcclxuICAgICAgICAgICAgICAgIG1vZHVsZUlkOiBuYW1lT3JJbml0T3B0aW9ucy5tb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgIGNoaWxkUm91dGVyOiBuYW1lT3JJbml0T3B0aW9ucy5jb21wb25lbnQuY2hpbGRSb3V0ZXIsXHJcbiAgICAgICAgICAgICAgICBsaWZlY3ljbGVBcmdzOiBbbGlmZWN5Y2xlQXJnc1swXSwgY29uZmlnLCBsaWZlY3ljbGVBcmdzWzJdXVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3UG9ydEluc3RydWN0aW9uc1t2aWV3UG9ydE5hbWVdID0gdmlld1BvcnRJbnN0cnVjdGlvbjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgbmFtZSBvZiB0aGUgcm91dGUgcGF0dGVybidzIHdpbGRjYXJkIHBhcmFtZXRlciwgaWYgYXBwbGljYWJsZS5cclxuICAgICAqL1xyXG4gICAgZ2V0V2lsZENhcmROYW1lKCkge1xyXG4gICAgICAgIC8vIHRvZG86IHBvdGVudGlhbCBpc3N1ZSwgb3IgYXQgbGVhc3QgdW5zYWZlIHR5cGluZ3NcclxuICAgICAgICBsZXQgY29uZmlnUm91dGUgPSB0aGlzLmNvbmZpZy5yb3V0ZTtcclxuICAgICAgICBsZXQgd2lsZGNhcmRJbmRleCA9IGNvbmZpZ1JvdXRlLmxhc3RJbmRleE9mKCcqJyk7XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZ1JvdXRlLnN1YnN0cih3aWxkY2FyZEluZGV4ICsgMSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIHBhdGggYW5kIHF1ZXJ5IHN0cmluZyBjcmVhdGVkIGJ5IGZpbGxpbmcgdGhlIHJvdXRlXHJcbiAgICAgKiBwYXR0ZXJuJ3Mgd2lsZGNhcmQgcGFyYW1ldGVyIHdpdGggdGhlIG1hdGNoaW5nIHBhcmFtLlxyXG4gICAgICovXHJcbiAgICBnZXRXaWxkY2FyZFBhdGgoKSB7XHJcbiAgICAgICAgbGV0IHdpbGRjYXJkTmFtZSA9IHRoaXMuZ2V0V2lsZENhcmROYW1lKCk7XHJcbiAgICAgICAgbGV0IHBhdGggPSB0aGlzLnBhcmFtc1t3aWxkY2FyZE5hbWVdIHx8ICcnO1xyXG4gICAgICAgIGxldCBxdWVyeVN0cmluZyA9IHRoaXMucXVlcnlTdHJpbmc7XHJcbiAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHBhdGggKz0gJz8nICsgcXVlcnlTdHJpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBpbnN0cnVjdGlvbidzIGJhc2UgVVJMLCBhY2NvdW50aW5nIGZvciB3aWxkY2FyZCByb3V0ZSBwYXJhbWV0ZXJzLlxyXG4gICAgICovXHJcbiAgICBnZXRCYXNlVXJsKCkge1xyXG4gICAgICAgIGxldCAkZW5jb2RlVVJJID0gZW5jb2RlVVJJO1xyXG4gICAgICAgIGxldCBmcmFnbWVudCA9IGRlY29kZVVSSSh0aGlzLmZyYWdtZW50KTtcclxuICAgICAgICBpZiAoZnJhZ21lbnQgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIGxldCBub25FbXB0eVJvdXRlID0gdGhpcy5yb3V0ZXIucm91dGVzLmZpbmQocm91dGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlLm5hbWUgPT09IHRoaXMuY29uZmlnLm5hbWUgJiZcclxuICAgICAgICAgICAgICAgICAgICByb3V0ZS5yb3V0ZSAhPT0gJyc7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAobm9uRW1wdHlSb3V0ZSkge1xyXG4gICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBub25FbXB0eVJvdXRlLnJvdXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5wYXJhbXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRlbmNvZGVVUkkoZnJhZ21lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgd2lsZGNhcmROYW1lID0gdGhpcy5nZXRXaWxkQ2FyZE5hbWUoKTtcclxuICAgICAgICBsZXQgcGF0aCA9IHRoaXMucGFyYW1zW3dpbGRjYXJkTmFtZV0gfHwgJyc7XHJcbiAgICAgICAgaWYgKCFwYXRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkZW5jb2RlVVJJKGZyYWdtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICRlbmNvZGVVUkkoZnJhZ21lbnQuc3Vic3RyKDAsIGZyYWdtZW50Lmxhc3RJbmRleE9mKHBhdGgpKSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEZpbmFsaXplIGEgdmlld3BvcnQgaW5zdHJ1Y3Rpb25cclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBfY29tbWl0Q2hhbmdlcyh3YWl0VG9Td2FwKSB7XHJcbiAgICAgICAgbGV0IHJvdXRlciA9IHRoaXMucm91dGVyO1xyXG4gICAgICAgIHJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24gPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzSW5zdHJ1Y3Rpb24gPSB0aGlzLnByZXZpb3VzSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgaWYgKHByZXZpb3VzSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgcHJldmlvdXNJbnN0cnVjdGlvbi5jb25maWcubmF2TW9kZWwuaXNBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb25maWcubmF2TW9kZWwuaXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgIHJvdXRlci5yZWZyZXNoTmF2aWdhdGlvbigpO1xyXG4gICAgICAgIGxldCBsb2FkcyA9IFtdO1xyXG4gICAgICAgIGxldCBkZWxheVN3YXBzID0gW107XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0SW5zdHJ1Y3Rpb25zID0gdGhpcy52aWV3UG9ydEluc3RydWN0aW9ucztcclxuICAgICAgICBmb3IgKGxldCB2aWV3UG9ydE5hbWUgaW4gdmlld1BvcnRJbnN0cnVjdGlvbnMpIHtcclxuICAgICAgICAgICAgbGV0IHZpZXdQb3J0SW5zdHJ1Y3Rpb24gPSB2aWV3UG9ydEluc3RydWN0aW9uc1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgICAgICBsZXQgdmlld1BvcnQgPSByb3V0ZXIudmlld1BvcnRzW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgICAgIGlmICghdmlld1BvcnQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgd2FzIG5vIHJvdXRlci12aWV3IGZvdW5kIGluIHRoZSB2aWV3IGZvciAke3ZpZXdQb3J0SW5zdHJ1Y3Rpb24ubW9kdWxlSWR9LmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBjaGlsZE5hdkluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgaWYgKHZpZXdQb3J0SW5zdHJ1Y3Rpb24uc3RyYXRlZ3kgPT09IFwicmVwbGFjZVwiIC8qIFJlcGxhY2UgKi8pIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZE5hdkluc3RydWN0aW9uICYmIGNoaWxkTmF2SW5zdHJ1Y3Rpb24ucGFyZW50Q2F0Y2hIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZHMucHVzaChjaGlsZE5hdkluc3RydWN0aW9uLl9jb21taXRDaGFuZ2VzKHdhaXRUb1N3YXApKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh3YWl0VG9Td2FwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5U3dhcHMucHVzaCh7IHZpZXdQb3J0LCB2aWV3UG9ydEluc3RydWN0aW9uIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBsb2Fkcy5wdXNoKHZpZXdQb3J0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9jZXNzKHZpZXdQb3J0SW5zdHJ1Y3Rpb24sIHdhaXRUb1N3YXApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IGNoaWxkTmF2SW5zdHJ1Y3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgPyBjaGlsZE5hdkluc3RydWN0aW9uLl9jb21taXRDaGFuZ2VzKHdhaXRUb1N3YXApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogUHJvbWlzZS5yZXNvbHZlKCkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZE5hdkluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZHMucHVzaChjaGlsZE5hdkluc3RydWN0aW9uLl9jb21taXRDaGFuZ2VzKHdhaXRUb1N3YXApKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZVxyXG4gICAgICAgICAgICAuYWxsKGxvYWRzKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGRlbGF5U3dhcHMuZm9yRWFjaCh4ID0+IHgudmlld1BvcnQuc3dhcCh4LnZpZXdQb3J0SW5zdHJ1Y3Rpb24pKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gcHJ1bmUodGhpcykpO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfdXBkYXRlVGl0bGUoKSB7XHJcbiAgICAgICAgbGV0IHJvdXRlciA9IHRoaXMucm91dGVyO1xyXG4gICAgICAgIGxldCB0aXRsZSA9IHRoaXMuX2J1aWxkVGl0bGUocm91dGVyLnRpdGxlU2VwYXJhdG9yKTtcclxuICAgICAgICBpZiAodGl0bGUpIHtcclxuICAgICAgICAgICAgcm91dGVyLmhpc3Rvcnkuc2V0VGl0bGUodGl0bGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgX2J1aWxkVGl0bGUoc2VwYXJhdG9yID0gJyB8ICcpIHtcclxuICAgICAgICBsZXQgdGl0bGUgPSAnJztcclxuICAgICAgICBsZXQgY2hpbGRUaXRsZXMgPSBbXTtcclxuICAgICAgICBsZXQgbmF2TW9kZWxUaXRsZSA9IHRoaXMuY29uZmlnLm5hdk1vZGVsLnRpdGxlO1xyXG4gICAgICAgIGxldCBpbnN0cnVjdGlvblJvdXRlciA9IHRoaXMucm91dGVyO1xyXG4gICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9ucyA9IHRoaXMudmlld1BvcnRJbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgaWYgKG5hdk1vZGVsVGl0bGUpIHtcclxuICAgICAgICAgICAgdGl0bGUgPSBpbnN0cnVjdGlvblJvdXRlci50cmFuc2Zvcm1UaXRsZShuYXZNb2RlbFRpdGxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHZpZXdQb3J0SW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXTtcclxuICAgICAgICAgICAgbGV0IGNoaWxkX25hdl9pbnN0cnVjdGlvbiA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgIGlmIChjaGlsZF9uYXZfaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGxldCBjaGlsZFRpdGxlID0gY2hpbGRfbmF2X2luc3RydWN0aW9uLl9idWlsZFRpdGxlKHNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRUaXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkVGl0bGVzLnB1c2goY2hpbGRUaXRsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNoaWxkVGl0bGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aXRsZSA9IGNoaWxkVGl0bGVzLmpvaW4oc2VwYXJhdG9yKSArICh0aXRsZSA/IHNlcGFyYXRvciA6ICcnKSArIHRpdGxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5zdHJ1Y3Rpb25Sb3V0ZXIudGl0bGUpIHtcclxuICAgICAgICAgICAgdGl0bGUgKz0gKHRpdGxlID8gc2VwYXJhdG9yIDogJycpICsgaW5zdHJ1Y3Rpb25Sb3V0ZXIudHJhbnNmb3JtVGl0bGUoaW5zdHJ1Y3Rpb25Sb3V0ZXIudGl0bGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGl0bGU7XHJcbiAgICB9XHJcbn1cclxuY29uc3QgcHJ1bmUgPSAoaW5zdHJ1Y3Rpb24pID0+IHtcclxuICAgIGluc3RydWN0aW9uLnByZXZpb3VzSW5zdHJ1Y3Rpb24gPSBudWxsO1xyXG4gICAgaW5zdHJ1Y3Rpb24ucGxhbiA9IG51bGw7XHJcbn07XG5cbi8qKlxyXG4qIENsYXNzIGZvciBzdG9yaW5nIGFuZCBpbnRlcmFjdGluZyB3aXRoIGEgcm91dGUncyBuYXZpZ2F0aW9uIHNldHRpbmdzLlxyXG4qL1xyXG5jbGFzcyBOYXZNb2RlbCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihyb3V0ZXIsIHJlbGF0aXZlSHJlZikge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogVHJ1ZSBpZiB0aGlzIG5hdiBpdGVtIGlzIGN1cnJlbnRseSBhY3RpdmUuXHJcbiAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBUaGUgdGl0bGUuXHJcbiAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnRpdGxlID0gbnVsbDtcclxuICAgICAgICAvKipcclxuICAgICAgICAqIFRoaXMgbmF2IGl0ZW0ncyBhYnNvbHV0ZSBocmVmLlxyXG4gICAgICAgICovXHJcbiAgICAgICAgdGhpcy5ocmVmID0gbnVsbDtcclxuICAgICAgICAvKipcclxuICAgICAgICAqIFRoaXMgbmF2IGl0ZW0ncyByZWxhdGl2ZSBocmVmLlxyXG4gICAgICAgICovXHJcbiAgICAgICAgdGhpcy5yZWxhdGl2ZUhyZWYgPSBudWxsO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogRGF0YSBhdHRhY2hlZCB0byB0aGUgcm91dGUgYXQgY29uZmlndXJhdGlvbiB0aW1lLlxyXG4gICAgICAgICovXHJcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHt9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogVGhlIHJvdXRlIGNvbmZpZy5cclxuICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuY29uZmlnID0gbnVsbDtcclxuICAgICAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcclxuICAgICAgICB0aGlzLnJlbGF0aXZlSHJlZiA9IHJlbGF0aXZlSHJlZjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgKiBTZXRzIHRoZSByb3V0ZSdzIHRpdGxlIGFuZCB1cGRhdGVzIGRvY3VtZW50LnRpdGxlLlxyXG4gICAgKiAgSWYgdGhlIGEgbmF2aWdhdGlvbiBpcyBpbiBwcm9ncmVzcywgdGhlIGNoYW5nZSB3aWxsIGJlIGFwcGxpZWRcclxuICAgICogIHRvIGRvY3VtZW50LnRpdGxlIHdoZW4gdGhlIG5hdmlnYXRpb24gY29tcGxldGVzLlxyXG4gICAgKlxyXG4gICAgKiBAcGFyYW0gdGl0bGUgVGhlIG5ldyB0aXRsZS5cclxuICAgICovXHJcbiAgICBzZXRUaXRsZSh0aXRsZSkge1xyXG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcclxuICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJvdXRlci51cGRhdGVUaXRsZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG5mdW5jdGlvbiBfbm9ybWFsaXplQWJzb2x1dGVQYXRoKHBhdGgsIGhhc1B1c2hTdGF0ZSwgYWJzb2x1dGUgPSBmYWxzZSkge1xyXG4gICAgaWYgKCFoYXNQdXNoU3RhdGUgJiYgcGF0aFswXSAhPT0gJyMnKSB7XHJcbiAgICAgICAgcGF0aCA9ICcjJyArIHBhdGg7XHJcbiAgICB9XHJcbiAgICBpZiAoaGFzUHVzaFN0YXRlICYmIGFic29sdXRlKSB7XHJcbiAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDEsIHBhdGgubGVuZ3RoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwYXRoO1xyXG59XHJcbmZ1bmN0aW9uIF9jcmVhdGVSb290ZWRQYXRoKGZyYWdtZW50LCBiYXNlVXJsLCBoYXNQdXNoU3RhdGUsIGFic29sdXRlKSB7XHJcbiAgICBpZiAoaXNBYnNvbHV0ZVVybC50ZXN0KGZyYWdtZW50KSkge1xyXG4gICAgICAgIHJldHVybiBmcmFnbWVudDtcclxuICAgIH1cclxuICAgIGxldCBwYXRoID0gJyc7XHJcbiAgICBpZiAoYmFzZVVybC5sZW5ndGggJiYgYmFzZVVybFswXSAhPT0gJy8nKSB7XHJcbiAgICAgICAgcGF0aCArPSAnLyc7XHJcbiAgICB9XHJcbiAgICBwYXRoICs9IGJhc2VVcmw7XHJcbiAgICBpZiAoKCFwYXRoLmxlbmd0aCB8fCBwYXRoW3BhdGgubGVuZ3RoIC0gMV0gIT09ICcvJykgJiYgZnJhZ21lbnRbMF0gIT09ICcvJykge1xyXG4gICAgICAgIHBhdGggKz0gJy8nO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhdGgubGVuZ3RoICYmIHBhdGhbcGF0aC5sZW5ndGggLSAxXSA9PT0gJy8nICYmIGZyYWdtZW50WzBdID09PSAnLycpIHtcclxuICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgcGF0aC5sZW5ndGggLSAxKTtcclxuICAgIH1cclxuICAgIHJldHVybiBfbm9ybWFsaXplQWJzb2x1dGVQYXRoKHBhdGggKyBmcmFnbWVudCwgaGFzUHVzaFN0YXRlLCBhYnNvbHV0ZSk7XHJcbn1cclxuZnVuY3Rpb24gX3Jlc29sdmVVcmwoZnJhZ21lbnQsIGJhc2VVcmwsIGhhc1B1c2hTdGF0ZSkge1xyXG4gICAgaWYgKGlzUm9vdGVkUGF0aC50ZXN0KGZyYWdtZW50KSkge1xyXG4gICAgICAgIHJldHVybiBfbm9ybWFsaXplQWJzb2x1dGVQYXRoKGZyYWdtZW50LCBoYXNQdXNoU3RhdGUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9jcmVhdGVSb290ZWRQYXRoKGZyYWdtZW50LCBiYXNlVXJsLCBoYXNQdXNoU3RhdGUpO1xyXG59XHJcbmZ1bmN0aW9uIF9lbnN1cmVBcnJheVdpdGhTaW5nbGVSb3V0ZVBlckNvbmZpZyhjb25maWcpIHtcclxuICAgIGxldCByb3V0ZUNvbmZpZ3MgPSBbXTtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5yb3V0ZSkpIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb25maWcucm91dGUubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudCA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7XHJcbiAgICAgICAgICAgIGN1cnJlbnQucm91dGUgPSBjb25maWcucm91dGVbaV07XHJcbiAgICAgICAgICAgIHJvdXRlQ29uZmlncy5wdXNoKGN1cnJlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJvdXRlQ29uZmlncy5wdXNoKE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZykpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJvdXRlQ29uZmlncztcclxufVxyXG5jb25zdCBpc1Jvb3RlZFBhdGggPSAvXiM/XFwvLztcclxuY29uc3QgaXNBYnNvbHV0ZVVybCA9IC9eKFthLXpdW2EtejAtOStcXC0uXSo6KT9cXC9cXC8vaTtcblxuLyoqXHJcbiAqIENsYXNzIHVzZWQgdG8gY29uZmlndXJlIGEgW1tSb3V0ZXJdXSBpbnN0YW5jZS5cclxuICpcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqL1xyXG5jbGFzcyBSb3V0ZXJDb25maWd1cmF0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuaW5zdHJ1Y3Rpb25zID0gW107XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge307XHJcbiAgICAgICAgdGhpcy5waXBlbGluZVN0ZXBzID0gW107XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBzdGVwIHRvIGJlIHJ1biBkdXJpbmcgdGhlIFtbUm91dGVyXV0ncyBuYXZpZ2F0aW9uIHBpcGVsaW5lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBwaXBlbGluZSBzbG90IHRvIGluc2VydCB0aGUgc3RlcCBpbnRvLlxyXG4gICAgICogQHBhcmFtIHN0ZXAgVGhlIHBpcGVsaW5lIHN0ZXAuXHJcbiAgICAgKiBAY2hhaW5hYmxlXHJcbiAgICAgKi9cclxuICAgIGFkZFBpcGVsaW5lU3RlcChuYW1lLCBzdGVwKSB7XHJcbiAgICAgICAgaWYgKHN0ZXAgPT09IG51bGwgfHwgc3RlcCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGlwZWxpbmUgc3RlcCBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucGlwZWxpbmVTdGVwcy5wdXNoKHsgbmFtZSwgc3RlcCB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHN0ZXAgdG8gYmUgcnVuIGR1cmluZyB0aGUgW1tSb3V0ZXJdXSdzIGF1dGhvcml6ZSBwaXBlbGluZSBzbG90LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdGVwIFRoZSBwaXBlbGluZSBzdGVwLlxyXG4gICAgICogQGNoYWluYWJsZVxyXG4gICAgICovXHJcbiAgICBhZGRBdXRob3JpemVTdGVwKHN0ZXApIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGRQaXBlbGluZVN0ZXAoXCJhdXRob3JpemVcIiAvKiBBdXRob3JpemUgKi8sIHN0ZXApO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgc3RlcCB0byBiZSBydW4gZHVyaW5nIHRoZSBbW1JvdXRlcl1dJ3MgcHJlQWN0aXZhdGUgcGlwZWxpbmUgc2xvdC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3RlcCBUaGUgcGlwZWxpbmUgc3RlcC5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgYWRkUHJlQWN0aXZhdGVTdGVwKHN0ZXApIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGRQaXBlbGluZVN0ZXAoXCJwcmVBY3RpdmF0ZVwiIC8qIFByZUFjdGl2YXRlICovLCBzdGVwKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHN0ZXAgdG8gYmUgcnVuIGR1cmluZyB0aGUgW1tSb3V0ZXJdXSdzIHByZVJlbmRlciBwaXBlbGluZSBzbG90LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdGVwIFRoZSBwaXBlbGluZSBzdGVwLlxyXG4gICAgICogQGNoYWluYWJsZVxyXG4gICAgICovXHJcbiAgICBhZGRQcmVSZW5kZXJTdGVwKHN0ZXApIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGRQaXBlbGluZVN0ZXAoXCJwcmVSZW5kZXJcIiAvKiBQcmVSZW5kZXIgKi8sIHN0ZXApO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgc3RlcCB0byBiZSBydW4gZHVyaW5nIHRoZSBbW1JvdXRlcl1dJ3MgcG9zdFJlbmRlciBwaXBlbGluZSBzbG90LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdGVwIFRoZSBwaXBlbGluZSBzdGVwLlxyXG4gICAgICogQGNoYWluYWJsZVxyXG4gICAgICovXHJcbiAgICBhZGRQb3N0UmVuZGVyU3RlcChzdGVwKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkUGlwZWxpbmVTdGVwKFwicG9zdFJlbmRlclwiIC8qIFBvc3RSZW5kZXIgKi8sIHN0ZXApO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDb25maWd1cmVzIGEgcm91dGUgdGhhdCB3aWxsIGJlIHVzZWQgaWYgdGhlcmUgaXMgbm8gcHJldmlvdXMgbG9jYXRpb24gYXZhaWxhYmxlIG9uIG5hdmlnYXRpb24gY2FuY2VsbGF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmcmFnbWVudCBUaGUgVVJMIGZyYWdtZW50IHRvIHVzZSBhcyB0aGUgbmF2aWdhdGlvbiBkZXN0aW5hdGlvbi5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgZmFsbGJhY2tSb3V0ZShmcmFnbWVudCkge1xyXG4gICAgICAgIHRoaXMuX2ZhbGxiYWNrUm91dGUgPSBmcmFnbWVudDtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBvbmUgb3IgbW9yZSByb3V0ZXMgdG8gYmUgcmVnaXN0ZXJlZCB3aXRoIHRoZSByb3V0ZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHJvdXRlIFRoZSBbW1JvdXRlQ29uZmlnXV0gdG8gbWFwLCBvciBhbiBhcnJheSBvZiBbW1JvdXRlQ29uZmlnXV0gdG8gbWFwLlxyXG4gICAgICogQGNoYWluYWJsZVxyXG4gICAgICovXHJcbiAgICBtYXAocm91dGUpIHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyb3V0ZSkpIHtcclxuICAgICAgICAgICAgcm91dGUuZm9yRWFjaChyID0+IHRoaXMubWFwKHIpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLm1hcFJvdXRlKHJvdXRlKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ29uZmlndXJlcyBkZWZhdWx0cyB0byB1c2UgZm9yIGFueSB2aWV3IHBvcnRzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB2aWV3UG9ydENvbmZpZyBhIHZpZXcgcG9ydCBjb25maWd1cmF0aW9uIG9iamVjdCB0byB1c2UgYXMgYVxyXG4gICAgICogIGRlZmF1bHQsIG9mIHRoZSBmb3JtIHsgdmlld1BvcnROYW1lOiB7IG1vZHVsZUlkIH0gfS5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgdXNlVmlld1BvcnREZWZhdWx0cyh2aWV3UG9ydENvbmZpZykge1xyXG4gICAgICAgIHRoaXMudmlld1BvcnREZWZhdWx0cyA9IHZpZXdQb3J0Q29uZmlnO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXBzIGEgc2luZ2xlIHJvdXRlIHRvIGJlIHJlZ2lzdGVyZWQgd2l0aCB0aGUgcm91dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb3V0ZSBUaGUgW1tSb3V0ZUNvbmZpZ11dIHRvIG1hcC5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgbWFwUm91dGUoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0cnVjdGlvbnMucHVzaChyb3V0ZXIgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcm91dGVDb25maWdzID0gX2Vuc3VyZUFycmF5V2l0aFNpbmdsZVJvdXRlUGVyQ29uZmlnKGNvbmZpZyk7XHJcbiAgICAgICAgICAgIGxldCBuYXZNb2RlbDtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcm91dGVDb25maWdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGxldCByb3V0ZUNvbmZpZyA9IHJvdXRlQ29uZmlnc1tpXTtcclxuICAgICAgICAgICAgICAgIHJvdXRlQ29uZmlnLnNldHRpbmdzID0gcm91dGVDb25maWcuc2V0dGluZ3MgfHwge307XHJcbiAgICAgICAgICAgICAgICBpZiAoIW5hdk1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2TW9kZWwgPSByb3V0ZXIuY3JlYXRlTmF2TW9kZWwocm91dGVDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcm91dGVyLmFkZFJvdXRlKHJvdXRlQ29uZmlnLCBuYXZNb2RlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVnaXN0ZXJzIGFuIHVua25vd24gcm91dGUgaGFuZGxlciB0byBiZSBydW4gd2hlbiB0aGUgVVJMIGZyYWdtZW50IGRvZXNuJ3QgbWF0Y2ggYW55IHJlZ2lzdGVyZWQgcm91dGVzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb25maWcgQSBzdHJpbmcgY29udGFpbmluZyBhIG1vZHVsZUlkIHRvIGxvYWQsIG9yIGEgW1tSb3V0ZUNvbmZpZ11dLCBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlXHJcbiAgICAgKiAgW1tOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb25dXSBhbmQgc2VsZWN0cyBhIG1vZHVsZUlkIHRvIGxvYWQuXHJcbiAgICAgKiBAY2hhaW5hYmxlXHJcbiAgICAgKi9cclxuICAgIG1hcFVua25vd25Sb3V0ZXMoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy51bmtub3duUm91dGVDb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFwcGxpZXMgdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiB0byB0aGUgc3BlY2lmaWVkIFtbUm91dGVyXV0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHJvdXRlciBUaGUgW1tSb3V0ZXJdXSB0byBhcHBseSB0aGUgY29uZmlndXJhdGlvbiB0by5cclxuICAgICAqL1xyXG4gICAgZXhwb3J0VG9Sb3V0ZXIocm91dGVyKSB7XHJcbiAgICAgICAgbGV0IGluc3RydWN0aW9ucyA9IHRoaXMuaW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uc1tpXShyb3V0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgeyB0aXRsZSwgdGl0bGVTZXBhcmF0b3IsIHVua25vd25Sb3V0ZUNvbmZpZywgX2ZhbGxiYWNrUm91dGUsIHZpZXdQb3J0RGVmYXVsdHMgfSA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHJvdXRlci50aXRsZSA9IHRpdGxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGl0bGVTZXBhcmF0b3IpIHtcclxuICAgICAgICAgICAgcm91dGVyLnRpdGxlU2VwYXJhdG9yID0gdGl0bGVTZXBhcmF0b3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1bmtub3duUm91dGVDb25maWcpIHtcclxuICAgICAgICAgICAgcm91dGVyLmhhbmRsZVVua25vd25Sb3V0ZXModW5rbm93blJvdXRlQ29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKF9mYWxsYmFja1JvdXRlKSB7XHJcbiAgICAgICAgICAgIHJvdXRlci5mYWxsYmFja1JvdXRlID0gX2ZhbGxiYWNrUm91dGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2aWV3UG9ydERlZmF1bHRzKSB7XHJcbiAgICAgICAgICAgIHJvdXRlci51c2VWaWV3UG9ydERlZmF1bHRzKHZpZXdQb3J0RGVmYXVsdHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3QuYXNzaWduKHJvdXRlci5vcHRpb25zLCB0aGlzLm9wdGlvbnMpO1xyXG4gICAgICAgIGxldCBwaXBlbGluZVN0ZXBzID0gdGhpcy5waXBlbGluZVN0ZXBzO1xyXG4gICAgICAgIGxldCBwaXBlbGluZVN0ZXBDb3VudCA9IHBpcGVsaW5lU3RlcHMubGVuZ3RoO1xyXG4gICAgICAgIGlmIChwaXBlbGluZVN0ZXBDb3VudCkge1xyXG4gICAgICAgICAgICBpZiAoIXJvdXRlci5pc1Jvb3QpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGlwZWxpbmUgc3RlcHMgY2FuIG9ubHkgYmUgYWRkZWQgdG8gdGhlIHJvb3Qgcm91dGVyJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHBpcGVsaW5lUHJvdmlkZXIgPSByb3V0ZXIucGlwZWxpbmVQcm92aWRlcjtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcGlwZWxpbmVTdGVwQ291bnQ7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgeyBuYW1lLCBzdGVwIH0gPSBwaXBlbGluZVN0ZXBzW2ldO1xyXG4gICAgICAgICAgICAgICAgcGlwZWxpbmVQcm92aWRlci5hZGRTdGVwKG5hbWUsIHN0ZXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBUaGUgcHJpbWFyeSBjbGFzcyByZXNwb25zaWJsZSBmb3IgaGFuZGxpbmcgcm91dGluZyBhbmQgbmF2aWdhdGlvbi5cclxuICovXHJcbmNsYXNzIFJvdXRlciB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBjb250YWluZXIgVGhlIFtbQ29udGFpbmVyXV0gdG8gdXNlIHdoZW4gY2hpbGQgcm91dGVycy5cclxuICAgICAqIEBwYXJhbSBoaXN0b3J5IFRoZSBbW0hpc3RvcnldXSBpbXBsZW1lbnRhdGlvbiB0byBkZWxlZ2F0ZSBuYXZpZ2F0aW9uIHJlcXVlc3RzIHRvLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIsIGhpc3RvcnkpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUaGUgcGFyZW50IHJvdXRlciwgb3IgbnVsbCBpZiB0aGlzIGluc3RhbmNlIGlzIG5vdCBhIGNoaWxkIHJvdXRlci5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnBhcmVudCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge307XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIGRlZmF1bHRzIHVzZWQgd2hlbiBhIHZpZXdwb3J0IGxhY2tzIHNwZWNpZmllZCBjb250ZW50XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy52aWV3UG9ydERlZmF1bHRzID0ge307XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRXh0ZW5zaW9uIHBvaW50IHRvIHRyYW5zZm9ybSB0aGUgZG9jdW1lbnQgdGl0bGUgYmVmb3JlIGl0IGlzIGJ1aWx0IGFuZCBkaXNwbGF5ZWQuXHJcbiAgICAgICAgICogQnkgZGVmYXVsdCwgY2hpbGQgcm91dGVycyBkZWxlZ2F0ZSB0byB0aGUgcGFyZW50IHJvdXRlciwgYW5kIHRoZSBhcHAgcm91dGVyXHJcbiAgICAgICAgICogcmV0dXJucyB0aGUgdGl0bGUgdW5jaGFuZ2VkLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMudHJhbnNmb3JtVGl0bGUgPSAodGl0bGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQudHJhbnNmb3JtVGl0bGUodGl0bGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aXRsZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBGdWxseSByZXNldHMgdGhlIHJvdXRlcidzIGludGVybmFsIHN0YXRlLiBQcmltYXJpbHkgdXNlZCBpbnRlcm5hbGx5IGJ5IHRoZSBmcmFtZXdvcmsgd2hlbiBtdWx0aXBsZSBjYWxscyB0byBzZXRSb290IGFyZSBtYWRlLlxyXG4gICAgICogVXNlIHdpdGggY2F1dGlvbiAoYWN0dWFsbHksIGF2b2lkIHVzaW5nIHRoaXMpLiBEbyBub3QgdXNlIHRoaXMgdG8gc2ltcGx5IGNoYW5nZSB5b3VyIG5hdmlnYXRpb24gbW9kZWwuXHJcbiAgICAgKi9cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMudmlld1BvcnRzID0ge307XHJcbiAgICAgICAgdGhpcy5yb3V0ZXMgPSBbXTtcclxuICAgICAgICB0aGlzLmJhc2VVcmwgPSAnJztcclxuICAgICAgICB0aGlzLmlzQ29uZmlndXJlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc0V4cGxpY2l0TmF2aWdhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNFeHBsaWNpdE5hdmlnYXRpb25CYWNrID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nTmV3ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdSZWZyZXNoID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdGb3J3YXJkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdCYWNrID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb3VsZERlYWN0aXZhdGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm5hdmlnYXRpb24gPSBbXTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRJbnN0cnVjdGlvbiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy52aWV3UG9ydERlZmF1bHRzID0ge307XHJcbiAgICAgICAgdGhpcy5fZmFsbGJhY2tPcmRlciA9IDEwMDtcclxuICAgICAgICB0aGlzLl9yZWNvZ25pemVyID0gbmV3IFJvdXRlUmVjb2duaXplcigpO1xyXG4gICAgICAgIHRoaXMuX2NoaWxkUmVjb2duaXplciA9IG5ldyBSb3V0ZVJlY29nbml6ZXIoKTtcclxuICAgICAgICB0aGlzLl9jb25maWd1cmVkUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlQ29uZmlndXJlZFByb21pc2UgPSByZXNvbHZlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIG9yIG5vdCB0aGlzIFtbUm91dGVyXV0gaXMgdGhlIHJvb3QgaW4gdGhlIHJvdXRlciB0cmVlLiBJLmUuLCBpdCBoYXMgbm8gcGFyZW50LlxyXG4gICAgICovXHJcbiAgICBnZXQgaXNSb290KCkge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5wYXJlbnQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyBhIHZpZXdQb3J0IHRvIGJlIHVzZWQgYXMgYSByZW5kZXJpbmcgdGFyZ2V0IGZvciBhY3RpdmF0ZWQgcm91dGVzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB2aWV3UG9ydCBUaGUgdmlld1BvcnQuXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgdmlld1BvcnQuICdkZWZhdWx0JyBpZiB1bnNwZWNpZmllZC5cclxuICAgICAqL1xyXG4gICAgcmVnaXN0ZXJWaWV3UG9ydCh2aWV3UG9ydCwgbmFtZSkge1xyXG4gICAgICAgIG5hbWUgPSBuYW1lIHx8ICdkZWZhdWx0JztcclxuICAgICAgICB0aGlzLnZpZXdQb3J0c1tuYW1lXSA9IHZpZXdQb3J0O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHJvdXRlciBpcyBjb25maWd1cmVkLlxyXG4gICAgICovXHJcbiAgICBlbnN1cmVDb25maWd1cmVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWd1cmVkUHJvbWlzZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ29uZmlndXJlcyB0aGUgcm91dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFja09yQ29uZmlnIFRoZSBbW1JvdXRlckNvbmZpZ3VyYXRpb25dXSBvciBhIGNhbGxiYWNrIHRoYXQgdGFrZXMgYSBbW1JvdXRlckNvbmZpZ3VyYXRpb25dXS5cclxuICAgICAqL1xyXG4gICAgY29uZmlndXJlKGNhbGxiYWNrT3JDb25maWcpIHtcclxuICAgICAgICB0aGlzLmlzQ29uZmlndXJlZCA9IHRydWU7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IGNhbGxiYWNrT3JDb25maWc7XHJcbiAgICAgICAgbGV0IGNvbmZpZztcclxuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrT3JDb25maWcgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgY29uZmlnID0gbmV3IFJvdXRlckNvbmZpZ3VyYXRpb24oKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gY2FsbGJhY2tPckNvbmZpZyhjb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZVxyXG4gICAgICAgICAgICAucmVzb2x2ZShyZXN1bHQpXHJcbiAgICAgICAgICAgIC50aGVuKChjKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjICYmIGMuZXhwb3J0VG9Sb3V0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZyA9IGM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uZmlnLmV4cG9ydFRvUm91dGVyKHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLmlzQ29uZmlndXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVDb25maWd1cmVkUHJvbWlzZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBOYXZpZ2F0ZXMgdG8gYSBuZXcgbG9jYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGZyYWdtZW50IFRoZSBVUkwgZnJhZ21lbnQgdG8gdXNlIGFzIHRoZSBuYXZpZ2F0aW9uIGRlc3RpbmF0aW9uLlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG5hdmlnYXRpb24gb3B0aW9ucy5cclxuICAgICAqL1xyXG4gICAgbmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNDb25maWd1cmVkICYmIHRoaXMucGFyZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5uYXZpZ2F0ZShmcmFnbWVudCwgb3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNFeHBsaWNpdE5hdmlnYXRpb24gPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkubmF2aWdhdGUoX3Jlc29sdmVVcmwoZnJhZ21lbnQsIHRoaXMuYmFzZVVybCwgdGhpcy5oaXN0b3J5Ll9oYXNQdXNoU3RhdGUpLCBvcHRpb25zKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTmF2aWdhdGVzIHRvIGEgbmV3IGxvY2F0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHJvdXRlIGFuZCBwYXJhbXMgc3BlY2lmaWVkLiBFcXVpdmFsbGVudCB0byBbW1JvdXRlci5nZW5lcmF0ZV1dIGZvbGxvd2VkXHJcbiAgICAgKiBieSBbW1JvdXRlci5uYXZpZ2F0ZV1dLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb3V0ZSBUaGUgbmFtZSBvZiB0aGUgcm91dGUgdG8gdXNlIHdoZW4gZ2VuZXJhdGluZyB0aGUgbmF2aWdhdGlvbiBsb2NhdGlvbi5cclxuICAgICAqIEBwYXJhbSBwYXJhbXMgVGhlIHJvdXRlIHBhcmFtZXRlcnMgdG8gYmUgdXNlZCB3aGVuIHBvcHVsYXRpbmcgdGhlIHJvdXRlIHBhdHRlcm4uXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgbmF2aWdhdGlvbiBvcHRpb25zLlxyXG4gICAgICovXHJcbiAgICBuYXZpZ2F0ZVRvUm91dGUocm91dGUsIHBhcmFtcywgb3B0aW9ucykge1xyXG4gICAgICAgIGxldCBwYXRoID0gdGhpcy5nZW5lcmF0ZShyb3V0ZSwgcGFyYW1zKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYXZpZ2F0ZShwYXRoLCBvcHRpb25zKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTmF2aWdhdGVzIGJhY2sgdG8gdGhlIG1vc3QgcmVjZW50IGxvY2F0aW9uIGluIGhpc3RvcnkuXHJcbiAgICAgKi9cclxuICAgIG5hdmlnYXRlQmFjaygpIHtcclxuICAgICAgICB0aGlzLmlzRXhwbGljaXROYXZpZ2F0aW9uQmFjayA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5oaXN0b3J5Lm5hdmlnYXRlQmFjaygpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgY2hpbGQgcm91dGVyIG9mIHRoZSBjdXJyZW50IHJvdXRlci5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBbW0NvbnRhaW5lcl1dIHRvIHByb3ZpZGUgdG8gdGhlIGNoaWxkIHJvdXRlci4gVXNlcyB0aGUgY3VycmVudCBbW1JvdXRlcl1dJ3MgW1tDb250YWluZXJdXSBpZiB1bnNwZWNpZmllZC5cclxuICAgICAqIEByZXR1cm5zIHtSb3V0ZXJ9IFRoZSBuZXcgY2hpbGQgUm91dGVyLlxyXG4gICAgICovXHJcbiAgICBjcmVhdGVDaGlsZChjb250YWluZXIpIHtcclxuICAgICAgICBsZXQgY2hpbGRSb3V0ZXIgPSBuZXcgUm91dGVyKGNvbnRhaW5lciB8fCB0aGlzLmNvbnRhaW5lci5jcmVhdGVDaGlsZCgpLCB0aGlzLmhpc3RvcnkpO1xyXG4gICAgICAgIGNoaWxkUm91dGVyLnBhcmVudCA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIGNoaWxkUm91dGVyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZW5lcmF0ZXMgYSBVUkwgZnJhZ21lbnQgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCByb3V0ZSBwYXR0ZXJuLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSByb3V0ZSB3aG9zZSBwYXR0ZXJuIHNob3VsZCBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSBmcmFnbWVudC5cclxuICAgICAqIEBwYXJhbSBwYXJhbXMgVGhlIHJvdXRlIHBhcmFtcyB0byBiZSB1c2VkIHRvIHBvcHVsYXRlIHRoZSByb3V0ZSBwYXR0ZXJuLlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgSWYgb3B0aW9ucy5hYnNvbHV0ZSA9IHRydWUsIHRoZW4gYWJzb2x1dGUgdXJsIHdpbGwgYmUgZ2VuZXJhdGVkOyBvdGhlcndpc2UsIGl0IHdpbGwgYmUgcmVsYXRpdmUgdXJsLlxyXG4gICAgICogQHJldHVybnMge3N0cmluZ30gQSBzdHJpbmcgY29udGFpbmluZyB0aGUgZ2VuZXJhdGVkIFVSTCBmcmFnbWVudC5cclxuICAgICAqL1xyXG4gICAgZ2VuZXJhdGUobmFtZU9yUm91dGUsIHBhcmFtcyA9IHt9LCBvcHRpb25zID0ge30pIHtcclxuICAgICAgICAvLyBBIGNoaWxkIHJlY29nbml6ZXIgZ2VuZXJhdGVzIHJvdXRlcyBmb3IgcG90ZW50aWFsIGNoaWxkIHJvdXRlcy4gQW55IHBvdGVudGlhbCBjaGlsZCByb3V0ZSBpcyBhZGRlZFxyXG4gICAgICAgIC8vIHRvIHRoZSBjaGlsZFJvdXRlIHByb3BlcnR5IG9mIHBhcmFtcyBmb3IgdGhlIGNoaWxkUm91dGVyIHRvIHJlY29nbml6ZS4gV2hlbiBnZW5lcmF0aW5nIHJvdXRlcywgd2VcclxuICAgICAgICAvLyB1c2UgdGhlIGNoaWxkUmVjb2duaXplciB3aGVuIGNoaWxkUm91dGUgcGFyYW1zIGFyZSBhdmFpbGFibGUgdG8gZ2VuZXJhdGUgYSBjaGlsZCByb3V0ZXIgZW5hYmxlZCByb3V0ZS5cclxuICAgICAgICBsZXQgcmVjb2duaXplciA9ICdjaGlsZFJvdXRlJyBpbiBwYXJhbXMgPyB0aGlzLl9jaGlsZFJlY29nbml6ZXIgOiB0aGlzLl9yZWNvZ25pemVyO1xyXG4gICAgICAgIGxldCBoYXNSb3V0ZSA9IHJlY29nbml6ZXIuaGFzUm91dGUobmFtZU9yUm91dGUpO1xyXG4gICAgICAgIGlmICghaGFzUm91dGUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuZ2VuZXJhdGUobmFtZU9yUm91dGUsIHBhcmFtcywgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBIHJvdXRlIHdpdGggbmFtZSAnJHtuYW1lT3JSb3V0ZX0nIGNvdWxkIG5vdCBiZSBmb3VuZC4gQ2hlY2sgdGhhdCBcXGBuYW1lOiAnJHtuYW1lT3JSb3V0ZX0nXFxgIHdhcyBzcGVjaWZpZWQgaW4gdGhlIHJvdXRlJ3MgY29uZmlnLmApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcGF0aCA9IHJlY29nbml6ZXIuZ2VuZXJhdGUobmFtZU9yUm91dGUsIHBhcmFtcyk7XHJcbiAgICAgICAgbGV0IHJvb3RlZFBhdGggPSBfY3JlYXRlUm9vdGVkUGF0aChwYXRoLCB0aGlzLmJhc2VVcmwsIHRoaXMuaGlzdG9yeS5faGFzUHVzaFN0YXRlLCBvcHRpb25zLmFic29sdXRlKTtcclxuICAgICAgICByZXR1cm4gb3B0aW9ucy5hYnNvbHV0ZSA/IGAke3RoaXMuaGlzdG9yeS5nZXRBYnNvbHV0ZVJvb3QoKX0ke3Jvb3RlZFBhdGh9YCA6IHJvb3RlZFBhdGg7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBbW05hdk1vZGVsXV0gZm9yIHRoZSBzcGVjaWZpZWQgcm91dGUgY29uZmlnLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb25maWcgVGhlIHJvdXRlIGNvbmZpZy5cclxuICAgICAqL1xyXG4gICAgY3JlYXRlTmF2TW9kZWwoY29uZmlnKSB7XHJcbiAgICAgICAgbGV0IG5hdk1vZGVsID0gbmV3IE5hdk1vZGVsKHRoaXMsICdocmVmJyBpbiBjb25maWdcclxuICAgICAgICAgICAgPyBjb25maWcuaHJlZlxyXG4gICAgICAgICAgICAvLyBwb3RlbnRpYWwgZXJyb3Igd2hlbiBjb25maWcucm91dGUgaXMgYSBzdHJpbmdbXSA/XHJcbiAgICAgICAgICAgIDogY29uZmlnLnJvdXRlKTtcclxuICAgICAgICBuYXZNb2RlbC50aXRsZSA9IGNvbmZpZy50aXRsZTtcclxuICAgICAgICBuYXZNb2RlbC5vcmRlciA9IGNvbmZpZy5uYXY7XHJcbiAgICAgICAgbmF2TW9kZWwuaHJlZiA9IGNvbmZpZy5ocmVmO1xyXG4gICAgICAgIG5hdk1vZGVsLnNldHRpbmdzID0gY29uZmlnLnNldHRpbmdzO1xyXG4gICAgICAgIG5hdk1vZGVsLmNvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICByZXR1cm4gbmF2TW9kZWw7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyBhIG5ldyByb3V0ZSB3aXRoIHRoZSByb3V0ZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbmZpZyBUaGUgW1tSb3V0ZUNvbmZpZ11dLlxyXG4gICAgICogQHBhcmFtIG5hdk1vZGVsIFRoZSBbW05hdk1vZGVsXV0gdG8gdXNlIGZvciB0aGUgcm91dGUuIE1heSBiZSBvbWl0dGVkIGZvciBzaW5nbGUtcGF0dGVybiByb3V0ZXMuXHJcbiAgICAgKi9cclxuICAgIGFkZFJvdXRlKGNvbmZpZywgbmF2TW9kZWwpIHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcucm91dGUpKSB7XHJcbiAgICAgICAgICAgIGxldCByb3V0ZUNvbmZpZ3MgPSBfZW5zdXJlQXJyYXlXaXRoU2luZ2xlUm91dGVQZXJDb25maWcoY29uZmlnKTtcclxuICAgICAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBpcyB3cm9uZy4gdG9kbzogZml4IHRoaXMgYWZ0ZXIgVFMgcmVmYWN0b3JpbmcgcmVsZWFzZVxyXG4gICAgICAgICAgICByb3V0ZUNvbmZpZ3MuZm9yRWFjaCh0aGlzLmFkZFJvdXRlLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhbGlkYXRlUm91dGVDb25maWcoY29uZmlnKTtcclxuICAgICAgICBpZiAoISgndmlld1BvcnRzJyBpbiBjb25maWcpICYmICFjb25maWcubmF2aWdhdGlvblN0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy52aWV3UG9ydHMgPSB7XHJcbiAgICAgICAgICAgICAgICAnZGVmYXVsdCc6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2R1bGVJZDogY29uZmlnLm1vZHVsZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpZXc6IGNvbmZpZy52aWV3XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghbmF2TW9kZWwpIHtcclxuICAgICAgICAgICAgbmF2TW9kZWwgPSB0aGlzLmNyZWF0ZU5hdk1vZGVsKGNvbmZpZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucm91dGVzLnB1c2goY29uZmlnKTtcclxuICAgICAgICBsZXQgcGF0aCA9IGNvbmZpZy5yb3V0ZTtcclxuICAgICAgICBpZiAocGF0aC5jaGFyQXQoMCkgPT09ICcvJykge1xyXG4gICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBjYXNlU2Vuc2l0aXZlID0gY29uZmlnLmNhc2VTZW5zaXRpdmUgPT09IHRydWU7XHJcbiAgICAgICAgbGV0IHN0YXRlID0gdGhpcy5fcmVjb2duaXplci5hZGQoe1xyXG4gICAgICAgICAgICBwYXRoOiBwYXRoLFxyXG4gICAgICAgICAgICBoYW5kbGVyOiBjb25maWcsXHJcbiAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGNhc2VTZW5zaXRpdmVcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAocGF0aCkge1xyXG4gICAgICAgICAgICBsZXQgc2V0dGluZ3MgPSBjb25maWcuc2V0dGluZ3M7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBjb25maWcuc2V0dGluZ3M7XHJcbiAgICAgICAgICAgIGxldCB3aXRoQ2hpbGQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbmZpZykpO1xyXG4gICAgICAgICAgICBjb25maWcuc2V0dGluZ3MgPSBzZXR0aW5ncztcclxuICAgICAgICAgICAgd2l0aENoaWxkLnJvdXRlID0gYCR7cGF0aH0vKmNoaWxkUm91dGVgO1xyXG4gICAgICAgICAgICB3aXRoQ2hpbGQuaGFzQ2hpbGRSb3V0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLl9jaGlsZFJlY29nbml6ZXIuYWRkKHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IHdpdGhDaGlsZC5yb3V0ZSxcclxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IHdpdGhDaGlsZCxcclxuICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGNhc2VTZW5zaXRpdmVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHdpdGhDaGlsZC5uYXZNb2RlbCA9IG5hdk1vZGVsO1xyXG4gICAgICAgICAgICB3aXRoQ2hpbGQuc2V0dGluZ3MgPSBjb25maWcuc2V0dGluZ3M7XHJcbiAgICAgICAgICAgIHdpdGhDaGlsZC5uYXZpZ2F0aW9uU3RyYXRlZ3kgPSBjb25maWcubmF2aWdhdGlvblN0cmF0ZWd5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25maWcubmF2TW9kZWwgPSBuYXZNb2RlbDtcclxuICAgICAgICBsZXQgbmF2aWdhdGlvbiA9IHRoaXMubmF2aWdhdGlvbjtcclxuICAgICAgICBpZiAoKG5hdk1vZGVsLm9yZGVyIHx8IG5hdk1vZGVsLm9yZGVyID09PSAwKSAmJiBuYXZpZ2F0aW9uLmluZGV4T2YobmF2TW9kZWwpID09PSAtMSkge1xyXG4gICAgICAgICAgICBpZiAoKCFuYXZNb2RlbC5ocmVmICYmIG5hdk1vZGVsLmhyZWYgIT09ICcnKSAmJiAoc3RhdGUudHlwZXMuZHluYW1pY3MgfHwgc3RhdGUudHlwZXMuc3RhcnMpKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcm91dGUgY29uZmlnIGZvciBcIicgKyBjb25maWcucm91dGUgKyAnXCIgOiBkeW5hbWljIHJvdXRlcyBtdXN0IHNwZWNpZnkgYW4gXCJocmVmOlwiIHRvIGJlIGluY2x1ZGVkIGluIHRoZSBuYXZpZ2F0aW9uIG1vZGVsLicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbmF2TW9kZWwub3JkZXIgIT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgICAgICBuYXZNb2RlbC5vcmRlciA9ICsrdGhpcy5fZmFsbGJhY2tPcmRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uLnB1c2gobmF2TW9kZWwpO1xyXG4gICAgICAgICAgICAvLyB0aGlzIGlzIGEgcG90ZW50aWFsIGVycm9yIC8gaW5jb25zaXN0ZW5jeSBiZXR3ZWVuIGJyb3dzZXJzXHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIC8vIE1ETjogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvc29ydFxyXG4gICAgICAgICAgICAvLyBJZiBjb21wYXJlRnVuY3Rpb24oYSwgYikgcmV0dXJucyAwLCBsZWF2ZSBhIGFuZCBiIHVuY2hhbmdlZCB3aXRoIHJlc3BlY3QgdG8gZWFjaCBvdGhlcixcclxuICAgICAgICAgICAgLy8gYnV0IHNvcnRlZCB3aXRoIHJlc3BlY3QgdG8gYWxsIGRpZmZlcmVudCBlbGVtZW50cy5cclxuICAgICAgICAgICAgLy8gTm90ZTogdGhlIEVDTUFzY3JpcHQgc3RhbmRhcmQgZG9lcyBub3QgZ3VhcmFudGVlIHRoaXMgYmVoYXZpb3VyLFxyXG4gICAgICAgICAgICAvLyBhbmQgdGh1cyBub3QgYWxsIGJyb3dzZXJzIChlLmcuIE1vemlsbGEgdmVyc2lvbnMgZGF0aW5nIGJhY2sgdG8gYXQgbGVhc3QgMjAwMykgcmVzcGVjdCB0aGlzLlxyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSB2YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgb3Igbm90IHRoaXMgW1tSb3V0ZXJdXSBvciBvbmUgb2YgaXRzIGFuY2VzdG9ycyBoYXMgYSByb3V0ZSByZWdpc3RlcmVkIHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSByb3V0ZSB0byBjaGVjay5cclxuICAgICAqL1xyXG4gICAgaGFzUm91dGUobmFtZSkge1xyXG4gICAgICAgIHJldHVybiAhISh0aGlzLl9yZWNvZ25pemVyLmhhc1JvdXRlKG5hbWUpIHx8IHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50Lmhhc1JvdXRlKG5hbWUpKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHZhbHVlIGluZGljYXRpbmcgd2hldGhlciBvciBub3QgdGhpcyBbW1JvdXRlcl1dIGhhcyBhIHJvdXRlIHJlZ2lzdGVyZWQgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIHJvdXRlIHRvIGNoZWNrLlxyXG4gICAgICovXHJcbiAgICBoYXNPd25Sb3V0ZShuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlY29nbml6ZXIuaGFzUm91dGUobmFtZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVyIGEgaGFuZGxlciB0byB1c2Ugd2hlbiB0aGUgaW5jb21pbmcgVVJMIGZyYWdtZW50IGRvZXNuJ3QgbWF0Y2ggYW55IHJlZ2lzdGVyZWQgcm91dGVzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb25maWcgVGhlIG1vZHVsZUlkLCBvciBhIGZ1bmN0aW9uIHRoYXQgc2VsZWN0cyB0aGUgbW9kdWxlSWQsIG9yIGEgW1tSb3V0ZUNvbmZpZ11dLlxyXG4gICAgICovXHJcbiAgICBoYW5kbGVVbmtub3duUm91dGVzKGNvbmZpZykge1xyXG4gICAgICAgIGlmICghY29uZmlnKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB1bmtub3duIHJvdXRlIGhhbmRsZXInKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYXRjaEFsbEhhbmRsZXIgPSBpbnN0cnVjdGlvbiA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgICAgICAgICAuX2NyZWF0ZVJvdXRlQ29uZmlnKGNvbmZpZywgaW5zdHJ1Y3Rpb24pXHJcbiAgICAgICAgICAgICAgICAudGhlbihjID0+IHtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLmNvbmZpZyA9IGM7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgdGhlIGRvY3VtZW50IHRpdGxlIHVzaW5nIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gaW5zdHJ1Y3Rpb24uXHJcbiAgICAgKi9cclxuICAgIHVwZGF0ZVRpdGxlKCkge1xyXG4gICAgICAgIGxldCBwYXJlbnRSb3V0ZXIgPSB0aGlzLnBhcmVudDtcclxuICAgICAgICBpZiAocGFyZW50Um91dGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnRSb3V0ZXIudXBkYXRlVGl0bGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGN1cnJlbnRJbnN0cnVjdGlvbiA9IHRoaXMuY3VycmVudEluc3RydWN0aW9uO1xyXG4gICAgICAgIGlmIChjdXJyZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgY3VycmVudEluc3RydWN0aW9uLl91cGRhdGVUaXRsZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIHRoZSBuYXZpZ2F0aW9uIHJvdXRlcyB3aXRoIGhyZWZzIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IGxvY2F0aW9uLlxyXG4gICAgICogTm90ZTogVGhpcyBtZXRob2Qgd2lsbCBsaWtlbHkgbW92ZSB0byBhIHBsdWdpbiBpbiBhIGZ1dHVyZSByZWxlYXNlLlxyXG4gICAgICovXHJcbiAgICByZWZyZXNoTmF2aWdhdGlvbigpIHtcclxuICAgICAgICBsZXQgbmF2ID0gdGhpcy5uYXZpZ2F0aW9uO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBuYXYubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSBuYXZbaV07XHJcbiAgICAgICAgICAgIGlmICghY3VycmVudC5jb25maWcuaHJlZikge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5ocmVmID0gX2NyZWF0ZVJvb3RlZFBhdGgoY3VycmVudC5yZWxhdGl2ZUhyZWYsIHRoaXMuYmFzZVVybCwgdGhpcy5oaXN0b3J5Ll9oYXNQdXNoU3RhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5ocmVmID0gX25vcm1hbGl6ZUFic29sdXRlUGF0aChjdXJyZW50LmNvbmZpZy5ocmVmLCB0aGlzLmhpc3RvcnkuX2hhc1B1c2hTdGF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbiBmb3IgdGhlIHZpZXcgcG9ydHMuIFRoaXMgc3BlY2lmaWVzIGhvdyB0b1xyXG4gICAgICogIHBvcHVsYXRlIGEgdmlldyBwb3J0IGZvciB3aGljaCBubyBtb2R1bGUgaXMgc3BlY2lmaWVkLiBUaGUgZGVmYXVsdCBpc1xyXG4gICAgICogIGFuIGVtcHR5IHZpZXcvdmlldy1tb2RlbCBwYWlyLlxyXG4gICAgICovXHJcbiAgICB1c2VWaWV3UG9ydERlZmF1bHRzKCR2aWV3UG9ydERlZmF1bHRzKSB7XHJcbiAgICAgICAgLy8gYSB3b3JrYXJvdW5kIHRvIGhhdmUgc3Ryb25nIHR5cGluZ3Mgd2hpbGUgbm90IHJlcXVpcmluZyB0byBleHBvc2UgaW50ZXJmYWNlIFZpZXdQb3J0SW5zdHJ1Y3Rpb25cclxuICAgICAgICBsZXQgdmlld1BvcnREZWZhdWx0cyA9ICR2aWV3UG9ydERlZmF1bHRzO1xyXG4gICAgICAgIGZvciAobGV0IHZpZXdQb3J0TmFtZSBpbiB2aWV3UG9ydERlZmF1bHRzKSB7XHJcbiAgICAgICAgICAgIGxldCB2aWV3UG9ydENvbmZpZyA9IHZpZXdQb3J0RGVmYXVsdHNbdmlld1BvcnROYW1lXTtcclxuICAgICAgICAgICAgdGhpcy52aWV3UG9ydERlZmF1bHRzW3ZpZXdQb3J0TmFtZV0gPSB7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGVJZDogdmlld1BvcnRDb25maWcubW9kdWxlSWRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIF9yZWZyZXNoQmFzZVVybCgpIHtcclxuICAgICAgICBsZXQgcGFyZW50Um91dGVyID0gdGhpcy5wYXJlbnQ7XHJcbiAgICAgICAgaWYgKHBhcmVudFJvdXRlcikge1xyXG4gICAgICAgICAgICB0aGlzLmJhc2VVcmwgPSBnZW5lcmF0ZUJhc2VVcmwocGFyZW50Um91dGVyLCBwYXJlbnRSb3V0ZXIuY3VycmVudEluc3RydWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIF9jcmVhdGVOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24odXJsID0gJycsIHBhcmVudEluc3RydWN0aW9uID0gbnVsbCkge1xyXG4gICAgICAgIGxldCBmcmFnbWVudCA9IHVybDtcclxuICAgICAgICBsZXQgcXVlcnlTdHJpbmcgPSAnJztcclxuICAgICAgICBsZXQgcXVlcnlJbmRleCA9IHVybC5pbmRleE9mKCc/Jyk7XHJcbiAgICAgICAgaWYgKHF1ZXJ5SW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIGZyYWdtZW50ID0gdXJsLnN1YnN0cigwLCBxdWVyeUluZGV4KTtcclxuICAgICAgICAgICAgcXVlcnlTdHJpbmcgPSB1cmwuc3Vic3RyKHF1ZXJ5SW5kZXggKyAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHVybFJlY29nbml6YXRpb25SZXN1bHRzID0gdGhpcy5fcmVjb2duaXplci5yZWNvZ25pemUodXJsKTtcclxuICAgICAgICBpZiAoIXVybFJlY29nbml6YXRpb25SZXN1bHRzIHx8ICF1cmxSZWNvZ25pemF0aW9uUmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdXJsUmVjb2duaXphdGlvblJlc3VsdHMgPSB0aGlzLl9jaGlsZFJlY29nbml6ZXIucmVjb2duaXplKHVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpbnN0cnVjdGlvbkluaXQgPSB7XHJcbiAgICAgICAgICAgIGZyYWdtZW50LFxyXG4gICAgICAgICAgICBxdWVyeVN0cmluZyxcclxuICAgICAgICAgICAgY29uZmlnOiBudWxsLFxyXG4gICAgICAgICAgICBwYXJlbnRJbnN0cnVjdGlvbixcclxuICAgICAgICAgICAgcHJldmlvdXNJbnN0cnVjdGlvbjogdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24sXHJcbiAgICAgICAgICAgIHJvdXRlcjogdGhpcyxcclxuICAgICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgY29tcGFyZVF1ZXJ5UGFyYW1zOiB0aGlzLm9wdGlvbnMuY29tcGFyZVF1ZXJ5UGFyYW1zXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGxldCByZXN1bHQ7XHJcbiAgICAgICAgaWYgKHVybFJlY29nbml6YXRpb25SZXN1bHRzICYmIHVybFJlY29nbml6YXRpb25SZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZXQgZmlyc3QgPSB1cmxSZWNvZ25pemF0aW9uUmVzdWx0c1swXTtcclxuICAgICAgICAgICAgbGV0IGluc3RydWN0aW9uID0gbmV3IE5hdmlnYXRpb25JbnN0cnVjdGlvbihPYmplY3QuYXNzaWduKHt9LCBpbnN0cnVjdGlvbkluaXQsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogZmlyc3QucGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgcXVlcnlQYXJhbXM6IGZpcnN0LnF1ZXJ5UGFyYW1zIHx8IHVybFJlY29nbml6YXRpb25SZXN1bHRzLnF1ZXJ5UGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgY29uZmlnOiBmaXJzdC5jb25maWcgfHwgZmlyc3QuaGFuZGxlclxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmlyc3QuaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZXZhbHVhdGVOYXZpZ2F0aW9uU3RyYXRlZ3koaW5zdHJ1Y3Rpb24sIGZpcnN0LmhhbmRsZXIsIGZpcnN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChmaXJzdC5oYW5kbGVyICYmIHR5cGVvZiBmaXJzdC5oYW5kbGVyLm5hdmlnYXRpb25TdHJhdGVneSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZXZhbHVhdGVOYXZpZ2F0aW9uU3RyYXRlZ3koaW5zdHJ1Y3Rpb24sIGZpcnN0LmhhbmRsZXIubmF2aWdhdGlvblN0cmF0ZWd5LCBmaXJzdC5oYW5kbGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IFByb21pc2UucmVzb2x2ZShpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5jYXRjaEFsbEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgbGV0IGluc3RydWN0aW9uID0gbmV3IE5hdmlnYXRpb25JbnN0cnVjdGlvbihPYmplY3QuYXNzaWduKHt9LCBpbnN0cnVjdGlvbkluaXQsIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtczogeyBwYXRoOiBmcmFnbWVudCB9LFxyXG4gICAgICAgICAgICAgICAgcXVlcnlQYXJhbXM6IHVybFJlY29nbml6YXRpb25SZXN1bHRzID8gdXJsUmVjb2duaXphdGlvblJlc3VsdHMucXVlcnlQYXJhbXMgOiB7fSxcclxuICAgICAgICAgICAgICAgIGNvbmZpZzogbnVsbCAvLyBjb25maWcgd2lsbCBiZSBjcmVhdGVkIGJ5IHRoZSBjYXRjaEFsbEhhbmRsZXJcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICByZXN1bHQgPSBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneShpbnN0cnVjdGlvbiwgdGhpcy5jYXRjaEFsbEhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICBsZXQgcm91dGVyID0gdGhpcy5fcGFyZW50Q2F0Y2hBbGxIYW5kbGVyKHRoaXMucGFyZW50KTtcclxuICAgICAgICAgICAgaWYgKHJvdXRlcikge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1BhcmVudEluc3RydWN0aW9uID0gdGhpcy5fZmluZFBhcmVudEluc3RydWN0aW9uRnJvbVJvdXRlcihyb3V0ZXIsIHBhcmVudEluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIGxldCBpbnN0cnVjdGlvbiA9IG5ldyBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24oT2JqZWN0LmFzc2lnbih7fSwgaW5zdHJ1Y3Rpb25Jbml0LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7IHBhdGg6IGZyYWdtZW50IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbXM6IHVybFJlY29nbml6YXRpb25SZXN1bHRzID8gdXJsUmVjb2duaXphdGlvblJlc3VsdHMucXVlcnlQYXJhbXMgOiB7fSxcclxuICAgICAgICAgICAgICAgICAgICByb3V0ZXI6IHJvdXRlcixcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJbnN0cnVjdGlvbjogbmV3UGFyZW50SW5zdHJ1Y3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Q2F0Y2hIYW5kbGVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzogbnVsbCAvLyBjb25maWcgd2lsbCBiZSBjcmVhdGVkIGJ5IHRoZSBjaGFpbmVkIHBhcmVudCBjYXRjaEFsbEhhbmRsZXJcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGV2YWx1YXRlTmF2aWdhdGlvblN0cmF0ZWd5KGluc3RydWN0aW9uLCByb3V0ZXIuY2F0Y2hBbGxIYW5kbGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVzdWx0ICYmIHBhcmVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmFzZVVybCA9IGdlbmVyYXRlQmFzZVVybCh0aGlzLnBhcmVudCwgcGFyZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0IHx8IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgUm91dGUgbm90IGZvdW5kOiAke3VybH1gKSk7XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIF9maW5kUGFyZW50SW5zdHJ1Y3Rpb25Gcm9tUm91dGVyKHJvdXRlciwgaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24ucm91dGVyID09PSByb3V0ZXIpIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uZnJhZ21lbnQgPSByb3V0ZXIuYmFzZVVybDsgLy8gbmVlZCB0byBjaGFuZ2UgdGhlIGZyYWdtZW50IGluIGNhc2Ugb2YgYSByZWRpcmVjdCBpbnN0ZWFkIG9mIG1vZHVsZUlkXHJcbiAgICAgICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaW5zdHJ1Y3Rpb24ucGFyZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmRQYXJlbnRJbnN0cnVjdGlvbkZyb21Sb3V0ZXIocm91dGVyLCBpbnN0cnVjdGlvbi5wYXJlbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIF9wYXJlbnRDYXRjaEFsbEhhbmRsZXIocm91dGVyKSB7XHJcbiAgICAgICAgaWYgKHJvdXRlci5jYXRjaEFsbEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJvdXRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocm91dGVyLnBhcmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50Q2F0Y2hBbGxIYW5kbGVyKHJvdXRlci5wYXJlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBfY3JlYXRlUm91dGVDb25maWcoY29uZmlnLCBpbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlXHJcbiAgICAgICAgICAgIC5yZXNvbHZlKGNvbmZpZylcclxuICAgICAgICAgICAgLnRoZW4oKGMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgbW9kdWxlSWQ6IGMgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMoaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC8vIHR5cGluZyBoZXJlIGNvdWxkIGJlIGVpdGhlciBSb3V0ZUNvbmZpZyBvciBSZWRpcmVjdENvbmZpZ1xyXG4gICAgICAgICAgICAvLyBidXQgdGVtcG9yYXJpbHkgdHJlYXQgYm90aCBhcyBSb3V0ZUNvbmZpZ1xyXG4gICAgICAgICAgICAvLyB0b2RvOiBpbXByb3ZlIHR5cGluZ3MgcHJlY2lzaW9uXHJcbiAgICAgICAgICAgIC50aGVuKChjKSA9PiB0eXBlb2YgYyA9PT0gJ3N0cmluZycgPyB7IG1vZHVsZUlkOiBjIH0gOiBjKVxyXG4gICAgICAgICAgICAudGhlbigoYykgPT4ge1xyXG4gICAgICAgICAgICBjLnJvdXRlID0gaW5zdHJ1Y3Rpb24ucGFyYW1zLnBhdGg7XHJcbiAgICAgICAgICAgIHZhbGlkYXRlUm91dGVDb25maWcoYyk7XHJcbiAgICAgICAgICAgIGlmICghYy5uYXZNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgYy5uYXZNb2RlbCA9IHRoaXMuY3JlYXRlTmF2TW9kZWwoYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuLyogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmcgKi9cclxuY29uc3QgZ2VuZXJhdGVCYXNlVXJsID0gKHJvdXRlciwgaW5zdHJ1Y3Rpb24pID0+IHtcclxuICAgIHJldHVybiBgJHtyb3V0ZXIuYmFzZVVybCB8fCAnJ30ke2luc3RydWN0aW9uLmdldEJhc2VVcmwoKSB8fCAnJ31gO1xyXG59O1xyXG4vKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xyXG5jb25zdCB2YWxpZGF0ZVJvdXRlQ29uZmlnID0gKGNvbmZpZykgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBjb25maWcgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFJvdXRlIENvbmZpZycpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBjb25maWcucm91dGUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgbGV0IG5hbWUgPSBjb25maWcubmFtZSB8fCAnKG5vIG5hbWUpJztcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgUm91dGUgQ29uZmlnIGZvciBcIicgKyBuYW1lICsgJ1wiOiBZb3UgbXVzdCBzcGVjaWZ5IGEgXCJyb3V0ZTpcIiBwYXR0ZXJuLicpO1xyXG4gICAgfVxyXG4gICAgaWYgKCEoJ3JlZGlyZWN0JyBpbiBjb25maWcgfHwgY29uZmlnLm1vZHVsZUlkIHx8IGNvbmZpZy5uYXZpZ2F0aW9uU3RyYXRlZ3kgfHwgY29uZmlnLnZpZXdQb3J0cykpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgUm91dGUgQ29uZmlnIGZvciBcIicgKyBjb25maWcucm91dGUgKyAnXCI6IFlvdSBtdXN0IHNwZWNpZnkgYSBcIm1vZHVsZUlkOlwiLCBcInJlZGlyZWN0OlwiLCBcIm5hdmlnYXRpb25TdHJhdGVneTpcIiwgb3IgXCJ2aWV3UG9ydHM6XCIuJyk7XHJcbiAgICB9XHJcbn07XHJcbi8qIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nICovXHJcbmNvbnN0IGV2YWx1YXRlTmF2aWdhdGlvblN0cmF0ZWd5ID0gKGluc3RydWN0aW9uLCBldmFsdWF0b3IsIGNvbnRleHQpID0+IHtcclxuICAgIHJldHVybiBQcm9taXNlXHJcbiAgICAgICAgLnJlc29sdmUoZXZhbHVhdG9yLmNhbGwoY29udGV4dCwgaW5zdHJ1Y3Rpb24pKVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBpZiAoISgndmlld1BvcnRzJyBpbiBpbnN0cnVjdGlvbi5jb25maWcpKSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uLmNvbmZpZy52aWV3UG9ydHMgPSB7XHJcbiAgICAgICAgICAgICAgICAnZGVmYXVsdCc6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2R1bGVJZDogaW5zdHJ1Y3Rpb24uY29uZmlnLm1vZHVsZUlkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH0pO1xyXG59O1xuXG4vKipAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xyXG5jb25zdCBjcmVhdGVOZXh0Rm4gPSAoaW5zdHJ1Y3Rpb24sIHN0ZXBzKSA9PiB7XHJcbiAgICBsZXQgaW5kZXggPSAtMTtcclxuICAgIGNvbnN0IG5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaW5kZXgrKztcclxuICAgICAgICBpZiAoaW5kZXggPCBzdGVwcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRTdGVwID0gc3RlcHNbaW5kZXhdO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRTdGVwKGluc3RydWN0aW9uLCBuZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHQucmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBuZXh0LmNvbXBsZXRlID0gY3JlYXRlQ29tcGxldGlvbkhhbmRsZXIobmV4dCwgXCJjb21wbGV0ZWRcIiAvKiBDb21wbGV0ZWQgKi8pO1xyXG4gICAgbmV4dC5jYW5jZWwgPSBjcmVhdGVDb21wbGV0aW9uSGFuZGxlcihuZXh0LCBcImNhbmNlbGVkXCIgLyogQ2FuY2VsZWQgKi8pO1xyXG4gICAgbmV4dC5yZWplY3QgPSBjcmVhdGVDb21wbGV0aW9uSGFuZGxlcihuZXh0LCBcInJlamVjdGVkXCIgLyogUmVqZWN0ZWQgKi8pO1xyXG4gICAgcmV0dXJuIG5leHQ7XHJcbn07XHJcbi8qKkBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nICovXHJcbmNvbnN0IGNyZWF0ZUNvbXBsZXRpb25IYW5kbGVyID0gKG5leHQsIHN0YXR1cykgPT4ge1xyXG4gICAgcmV0dXJuIChvdXRwdXQpID0+IFByb21pc2VcclxuICAgICAgICAucmVzb2x2ZSh7XHJcbiAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgIG91dHB1dCxcclxuICAgICAgICBjb21wbGV0ZWQ6IHN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIiAvKiBDb21wbGV0ZWQgKi9cclxuICAgIH0pO1xyXG59O1xuXG4vKipcclxuICogVGhlIGNsYXNzIHJlc3BvbnNpYmxlIGZvciBtYW5hZ2luZyBhbmQgcHJvY2Vzc2luZyB0aGUgbmF2aWdhdGlvbiBwaXBlbGluZS5cclxuICovXHJcbmNsYXNzIFBpcGVsaW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBwaXBlbGluZSBzdGVwcy4gQW5kIHN0ZXBzIGFkZGVkIHZpYSBhZGRTdGVwIHdpbGwgYmUgY29udmVydGVkIHRvIGEgZnVuY3Rpb25cclxuICAgICAgICAgKiBUaGUgYWN0dWFseSBydW5uaW5nIGZ1bmN0aW9ucyB3aXRoIGNvcnJlY3Qgc3RlcCBjb250ZXh0cyBvZiB0aGlzIHBpcGVsaW5lXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5zdGVwcyA9IFtdO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgc3RlcCB0byB0aGUgcGlwZWxpbmUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHN0ZXAgVGhlIHBpcGVsaW5lIHN0ZXAuXHJcbiAgICAgKi9cclxuICAgIGFkZFN0ZXAoc3RlcCkge1xyXG4gICAgICAgIGxldCBydW47XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzdGVwID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJ1biA9IHN0ZXA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBzdGVwLmdldFN0ZXBzID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIC8vIGdldFN0ZXBzIGlzIHRvIGVuYWJsZSBzdXBwb3J0IG9wZW4gc2xvdHNcclxuICAgICAgICAgICAgLy8gd2hlcmUgZGV2cyBjYW4gYWRkIG11bHRpcGxlIHN0ZXBzIGludG8gdGhlIHNhbWUgc2xvdCBuYW1lXHJcbiAgICAgICAgICAgIGxldCBzdGVwcyA9IHN0ZXAuZ2V0U3RlcHMoKTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzdGVwcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkU3RlcChzdGVwc1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBydW4gPSBzdGVwLnJ1bi5iaW5kKHN0ZXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN0ZXBzLnB1c2gocnVuKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUnVucyB0aGUgcGlwZWxpbmUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGluc3RydWN0aW9uIFRoZSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uIHRvIHByb2Nlc3MuXHJcbiAgICAgKi9cclxuICAgIHJ1bihpbnN0cnVjdGlvbikge1xyXG4gICAgICAgIGNvbnN0IG5leHRGbiA9IGNyZWF0ZU5leHRGbihpbnN0cnVjdGlvbiwgdGhpcy5zdGVwcyk7XHJcbiAgICAgICAgcmV0dXJuIG5leHRGbigpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4qIERldGVybWluZXMgaWYgdGhlIHByb3ZpZGVkIG9iamVjdCBpcyBhIG5hdmlnYXRpb24gY29tbWFuZC5cclxuKiBBIG5hdmlnYXRpb24gY29tbWFuZCBpcyBhbnl0aGluZyB3aXRoIGEgbmF2aWdhdGUgbWV0aG9kLlxyXG4qXHJcbiogQHBhcmFtIG9iaiBUaGUgb2JqZWN0IHRvIGNoZWNrLlxyXG4qL1xyXG5mdW5jdGlvbiBpc05hdmlnYXRpb25Db21tYW5kKG9iaikge1xyXG4gICAgcmV0dXJuIG9iaiAmJiB0eXBlb2Ygb2JqLm5hdmlnYXRlID09PSAnZnVuY3Rpb24nO1xyXG59XHJcbi8qKlxyXG4qIFVzZWQgZHVyaW5nIHRoZSBhY3RpdmF0aW9uIGxpZmVjeWNsZSB0byBjYXVzZSBhIHJlZGlyZWN0LlxyXG4qL1xyXG5jbGFzcyBSZWRpcmVjdCB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB1cmwgVGhlIFVSTCBmcmFnbWVudCB0byB1c2UgYXMgdGhlIG5hdmlnYXRpb24gZGVzdGluYXRpb24uXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgbmF2aWdhdGlvbiBvcHRpb25zLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcih1cmwsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIHRoaXMudXJsID0gdXJsO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyB0cmlnZ2VyOiB0cnVlLCByZXBsYWNlOiB0cnVlIH0sIG9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuc2hvdWxkQ29udGludWVQcm9jZXNzaW5nID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCBieSB0aGUgYWN0aXZhdGlvbiBzeXN0ZW0gdG8gc2V0IHRoZSBjaGlsZCByb3V0ZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHJvdXRlciBUaGUgcm91dGVyLlxyXG4gICAgICovXHJcbiAgICBzZXRSb3V0ZXIocm91dGVyKSB7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCBieSB0aGUgbmF2aWdhdGlvbiBwaXBlbGluZSB0byBuYXZpZ2F0ZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYXBwUm91dGVyIFRoZSByb3V0ZXIgdG8gYmUgcmVkaXJlY3RlZC5cclxuICAgICAqL1xyXG4gICAgbmF2aWdhdGUoYXBwUm91dGVyKSB7XHJcbiAgICAgICAgbGV0IG5hdmlnYXRpbmdSb3V0ZXIgPSB0aGlzLm9wdGlvbnMudXNlQXBwUm91dGVyID8gYXBwUm91dGVyIDogKHRoaXMucm91dGVyIHx8IGFwcFJvdXRlcik7XHJcbiAgICAgICAgbmF2aWdhdGluZ1JvdXRlci5uYXZpZ2F0ZSh0aGlzLnVybCwgdGhpcy5vcHRpb25zKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogVXNlZCBkdXJpbmcgdGhlIGFjdGl2YXRpb24gbGlmZWN5Y2xlIHRvIGNhdXNlIGEgcmVkaXJlY3QgdG8gYSBuYW1lZCByb3V0ZS5cclxuICovXHJcbmNsYXNzIFJlZGlyZWN0VG9Sb3V0ZSB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSByb3V0ZSBUaGUgbmFtZSBvZiB0aGUgcm91dGUuXHJcbiAgICAgKiBAcGFyYW0gcGFyYW1zIFRoZSBwYXJhbWV0ZXJzIHRvIGJlIHNlbnQgdG8gdGhlIGFjdGl2YXRpb24gbWV0aG9kLlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9wdGlvbnMgdG8gdXNlIGZvciBuYXZpZ2F0aW9uLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcihyb3V0ZSwgcGFyYW1zID0ge30sIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIHRoaXMucm91dGUgPSByb3V0ZTtcclxuICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgdHJpZ2dlcjogdHJ1ZSwgcmVwbGFjZTogdHJ1ZSB9LCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLnNob3VsZENvbnRpbnVlUHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgYnkgdGhlIGFjdGl2YXRpb24gc3lzdGVtIHRvIHNldCB0aGUgY2hpbGQgcm91dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb3V0ZXIgVGhlIHJvdXRlci5cclxuICAgICAqL1xyXG4gICAgc2V0Um91dGVyKHJvdXRlcikge1xyXG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgYnkgdGhlIG5hdmlnYXRpb24gcGlwZWxpbmUgdG8gbmF2aWdhdGUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFwcFJvdXRlciBUaGUgcm91dGVyIHRvIGJlIHJlZGlyZWN0ZWQuXHJcbiAgICAgKi9cclxuICAgIG5hdmlnYXRlKGFwcFJvdXRlcikge1xyXG4gICAgICAgIGxldCBuYXZpZ2F0aW5nUm91dGVyID0gdGhpcy5vcHRpb25zLnVzZUFwcFJvdXRlciA/IGFwcFJvdXRlciA6ICh0aGlzLnJvdXRlciB8fCBhcHBSb3V0ZXIpO1xyXG4gICAgICAgIG5hdmlnYXRpbmdSb3V0ZXIubmF2aWdhdGVUb1JvdXRlKHRoaXMucm91dGUsIHRoaXMucGFyYW1zLCB0aGlzLm9wdGlvbnMpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuZnVuY3Rpb24gX2J1aWxkTmF2aWdhdGlvblBsYW4oaW5zdHJ1Y3Rpb24sIGZvcmNlTGlmZWN5Y2xlTWluaW11bSkge1xyXG4gICAgbGV0IGNvbmZpZyA9IGluc3RydWN0aW9uLmNvbmZpZztcclxuICAgIGlmICgncmVkaXJlY3QnIGluIGNvbmZpZykge1xyXG4gICAgICAgIHJldHVybiBidWlsZFJlZGlyZWN0UGxhbihpbnN0cnVjdGlvbik7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwcmV2SW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbi5wcmV2aW91c0luc3RydWN0aW9uO1xyXG4gICAgY29uc3QgZGVmYXVsdFZpZXdQb3J0Q29uZmlncyA9IGluc3RydWN0aW9uLnJvdXRlci52aWV3UG9ydERlZmF1bHRzO1xyXG4gICAgaWYgKHByZXZJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHJldHVybiBidWlsZFRyYW5zaXRpb25QbGFucyhpbnN0cnVjdGlvbiwgcHJldkluc3RydWN0aW9uLCBkZWZhdWx0Vmlld1BvcnRDb25maWdzLCBmb3JjZUxpZmVjeWNsZU1pbmltdW0pO1xyXG4gICAgfVxyXG4gICAgLy8gZmlyc3QgbmF2aWdhdGlvbiwgb25seSBuZWVkIHRvIHByZXBhcmUgYSBmZXcgaW5mb3JtYXRpb24gZm9yIGVhY2ggdmlld3BvcnQgcGxhblxyXG4gICAgY29uc3Qgdmlld1BvcnRQbGFucyA9IHt9O1xyXG4gICAgbGV0IHZpZXdQb3J0Q29uZmlncyA9IGNvbmZpZy52aWV3UG9ydHM7XHJcbiAgICBmb3IgKGxldCB2aWV3UG9ydE5hbWUgaW4gdmlld1BvcnRDb25maWdzKSB7XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0Q29uZmlnID0gdmlld1BvcnRDb25maWdzW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgaWYgKHZpZXdQb3J0Q29uZmlnLm1vZHVsZUlkID09PSBudWxsICYmIHZpZXdQb3J0TmFtZSBpbiBkZWZhdWx0Vmlld1BvcnRDb25maWdzKSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0Q29uZmlnID0gZGVmYXVsdFZpZXdQb3J0Q29uZmlnc1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2aWV3UG9ydFBsYW5zW3ZpZXdQb3J0TmFtZV0gPSB7XHJcbiAgICAgICAgICAgIG5hbWU6IHZpZXdQb3J0TmFtZSxcclxuICAgICAgICAgICAgc3RyYXRlZ3k6IFwicmVwbGFjZVwiIC8qIFJlcGxhY2UgKi8sXHJcbiAgICAgICAgICAgIGNvbmZpZzogdmlld1BvcnRDb25maWdcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2aWV3UG9ydFBsYW5zKTtcclxufVxyXG4vKipcclxuICogQnVpbGQgcmVkaXJlY3QgcGxhbiBiYXNlZCBvbiBjb25maWcgb2YgYSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBidWlsZFJlZGlyZWN0UGxhbiA9IChpbnN0cnVjdGlvbikgPT4ge1xyXG4gICAgY29uc3QgY29uZmlnID0gaW5zdHJ1Y3Rpb24uY29uZmlnO1xyXG4gICAgY29uc3Qgcm91dGVyID0gaW5zdHJ1Y3Rpb24ucm91dGVyO1xyXG4gICAgcmV0dXJuIHJvdXRlclxyXG4gICAgICAgIC5fY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uKGNvbmZpZy5yZWRpcmVjdClcclxuICAgICAgICAudGhlbihyZWRpcmVjdEluc3RydWN0aW9uID0+IHtcclxuICAgICAgICBjb25zdCBwYXJhbXMgPSB7fTtcclxuICAgICAgICBjb25zdCBvcmlnaW5hbEluc3RydWN0aW9uUGFyYW1zID0gaW5zdHJ1Y3Rpb24ucGFyYW1zO1xyXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0SW5zdHJ1Y3Rpb25QYXJhbXMgPSByZWRpcmVjdEluc3RydWN0aW9uLnBhcmFtcztcclxuICAgICAgICBmb3IgKGxldCBrZXkgaW4gcmVkaXJlY3RJbnN0cnVjdGlvblBhcmFtcykge1xyXG4gICAgICAgICAgICAvLyBJZiB0aGUgcGFyYW0gb24gdGhlIHJlZGlyZWN0IHBvaW50cyB0byBhbm90aGVyIHBhcmFtLCBlLmcuIHsgcm91dGU6IGZpcnN0Lzp0aGlzLCByZWRpcmVjdDogc2Vjb25kLzp0aGlzIH1cclxuICAgICAgICAgICAgbGV0IHZhbCA9IHJlZGlyZWN0SW5zdHJ1Y3Rpb25QYXJhbXNba2V5XTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnICYmIHZhbFswXSA9PT0gJzonKSB7XHJcbiAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc2xpY2UoMSk7XHJcbiAgICAgICAgICAgICAgICAvLyBBbmQgaWYgdGhhdCBwYXJhbSBpcyBmb3VuZCBvbiB0aGUgb3JpZ2luYWwgaW5zdHJ1Y3Rpb24gdGhlbiB1c2UgaXRcclxuICAgICAgICAgICAgICAgIGlmICh2YWwgaW4gb3JpZ2luYWxJbnN0cnVjdGlvblBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1trZXldID0gb3JpZ2luYWxJbnN0cnVjdGlvblBhcmFtc1t2YWxdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zW2tleV0gPSByZWRpcmVjdEluc3RydWN0aW9uUGFyYW1zW2tleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJlZGlyZWN0TG9jYXRpb24gPSByb3V0ZXIuZ2VuZXJhdGUocmVkaXJlY3RJbnN0cnVjdGlvbi5jb25maWcsIHBhcmFtcywgaW5zdHJ1Y3Rpb24ub3B0aW9ucyk7XHJcbiAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgY2hpbGQgcm91dGVzXHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIG9yaWdpbmFsSW5zdHJ1Y3Rpb25QYXJhbXMpIHtcclxuICAgICAgICAgICAgcmVkaXJlY3RMb2NhdGlvbiA9IHJlZGlyZWN0TG9jYXRpb24ucmVwbGFjZShgOiR7a2V5fWAsIG9yaWdpbmFsSW5zdHJ1Y3Rpb25QYXJhbXNba2V5XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBxdWVyeVN0cmluZyA9IGluc3RydWN0aW9uLnF1ZXJ5U3RyaW5nO1xyXG4gICAgICAgIGlmIChxdWVyeVN0cmluZykge1xyXG4gICAgICAgICAgICByZWRpcmVjdExvY2F0aW9uICs9ICc/JyArIHF1ZXJ5U3RyaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBSZWRpcmVjdChyZWRpcmVjdExvY2F0aW9uKSk7XHJcbiAgICB9KTtcclxufTtcclxuLyoqXHJcbiAqIEBwYXJhbSB2aWV3UG9ydFBsYW5zIHRoZSBQbGFuIHJlY29yZCB0aGF0IGhvbGRzIGluZm9ybWF0aW9uIGFib3V0IGJ1aWx0IHBsYW5zXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBidWlsZFRyYW5zaXRpb25QbGFucyA9IChjdXJyZW50SW5zdHJ1Y3Rpb24sIHByZXZpb3VzSW5zdHJ1Y3Rpb24sIGRlZmF1bHRWaWV3UG9ydENvbmZpZ3MsIGZvcmNlTGlmZWN5Y2xlTWluaW11bSkgPT4ge1xyXG4gICAgbGV0IHZpZXdQb3J0UGxhbnMgPSB7fTtcclxuICAgIGxldCBuZXdJbnN0cnVjdGlvbkNvbmZpZyA9IGN1cnJlbnRJbnN0cnVjdGlvbi5jb25maWc7XHJcbiAgICBsZXQgaGFzTmV3UGFyYW1zID0gaGFzRGlmZmVyZW50UGFyYW1ldGVyVmFsdWVzKHByZXZpb3VzSW5zdHJ1Y3Rpb24sIGN1cnJlbnRJbnN0cnVjdGlvbik7XHJcbiAgICBsZXQgcGVuZGluZyA9IFtdO1xyXG4gICAgbGV0IHByZXZpb3VzVmlld1BvcnRJbnN0cnVjdGlvbnMgPSBwcmV2aW91c0luc3RydWN0aW9uLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zO1xyXG4gICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHByZXZpb3VzVmlld1BvcnRJbnN0cnVjdGlvbnMpIHtcclxuICAgICAgICBjb25zdCBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbiA9IHByZXZpb3VzVmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXTtcclxuICAgICAgICBjb25zdCBwcmV2Vmlld1BvcnRDb21wb25lbnQgPSBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgbmV3SW5zdHJ1Y3Rpb25WaWV3UG9ydENvbmZpZ3MgPSBuZXdJbnN0cnVjdGlvbkNvbmZpZy52aWV3UG9ydHM7XHJcbiAgICAgICAgLy8gaWYgdGhpcyBpcyBpbnZva2VkIG9uIGEgdmlld3BvcnQgd2l0aG91dCBhbnkgY2hhbmdlcywgYmFzZWQgb24gbmV3IHVybCxcclxuICAgICAgICAvLyBuZXdWaWV3UG9ydENvbmZpZyB3aWxsIGJlIHRoZSBleGlzdGluZyB2aWV3cG9ydCBpbnN0cnVjdGlvblxyXG4gICAgICAgIGxldCBuZXh0Vmlld1BvcnRDb25maWcgPSB2aWV3UG9ydE5hbWUgaW4gbmV3SW5zdHJ1Y3Rpb25WaWV3UG9ydENvbmZpZ3NcclxuICAgICAgICAgICAgPyBuZXdJbnN0cnVjdGlvblZpZXdQb3J0Q29uZmlnc1t2aWV3UG9ydE5hbWVdXHJcbiAgICAgICAgICAgIDogcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgaWYgKG5leHRWaWV3UG9ydENvbmZpZy5tb2R1bGVJZCA9PT0gbnVsbCAmJiB2aWV3UG9ydE5hbWUgaW4gZGVmYXVsdFZpZXdQb3J0Q29uZmlncykge1xyXG4gICAgICAgICAgICBuZXh0Vmlld1BvcnRDb25maWcgPSBkZWZhdWx0Vmlld1BvcnRDb25maWdzW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHZpZXdQb3J0QWN0aXZhdGlvblN0cmF0ZWd5ID0gZGV0ZXJtaW5lQWN0aXZhdGlvblN0cmF0ZWd5KGN1cnJlbnRJbnN0cnVjdGlvbiwgcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24sIG5leHRWaWV3UG9ydENvbmZpZywgaGFzTmV3UGFyYW1zLCBmb3JjZUxpZmVjeWNsZU1pbmltdW0pO1xyXG4gICAgICAgIGNvbnN0IHZpZXdQb3J0UGxhbiA9IHZpZXdQb3J0UGxhbnNbdmlld1BvcnROYW1lXSA9IHtcclxuICAgICAgICAgICAgbmFtZTogdmlld1BvcnROYW1lLFxyXG4gICAgICAgICAgICAvLyBWaWV3UG9ydEluc3RydWN0aW9uIGNhbiBxdWFjayBsaWtlIGEgUm91dGVDb25maWdcclxuICAgICAgICAgICAgY29uZmlnOiBuZXh0Vmlld1BvcnRDb25maWcsXHJcbiAgICAgICAgICAgIHByZXZDb21wb25lbnQ6IHByZXZWaWV3UG9ydENvbXBvbmVudCxcclxuICAgICAgICAgICAgcHJldk1vZHVsZUlkOiBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbi5tb2R1bGVJZCxcclxuICAgICAgICAgICAgc3RyYXRlZ3k6IHZpZXdQb3J0QWN0aXZhdGlvblN0cmF0ZWd5XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyByZWN1cnNpdmVseSBidWlsZCBuYXYgcGxhbnMgZm9yIGFsbCBleGlzdGluZyBjaGlsZCByb3V0ZXJzL3ZpZXdwb3J0cyBvZiB0aGlzIHZpZXdwb3J0XHJcbiAgICAgICAgLy8gdGhpcyBpcyBwb3NzaWJsZSBiZWNhdXNlIGV4aXN0aW5nIGNoaWxkIHZpZXdwb3J0cyBhbmQgcm91dGVycyBhbHJlYWR5IGhhdmUgbmVjZXNzYXJ5IGluZm9ybWF0aW9uXHJcbiAgICAgICAgLy8gdG8gcHJvY2VzcyB0aGUgd2lsZGNhcmQgcGF0aCBmcm9tIHBhcmVudCBpbnN0cnVjdGlvblxyXG4gICAgICAgIGlmICh2aWV3UG9ydEFjdGl2YXRpb25TdHJhdGVneSAhPT0gXCJyZXBsYWNlXCIgLyogUmVwbGFjZSAqLyAmJiBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbi5jaGlsZFJvdXRlcikge1xyXG4gICAgICAgICAgICBjb25zdCBwYXRoID0gY3VycmVudEluc3RydWN0aW9uLmdldFdpbGRjYXJkUGF0aCgpO1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrID0gcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb25cclxuICAgICAgICAgICAgICAgIC5jaGlsZFJvdXRlclxyXG4gICAgICAgICAgICAgICAgLl9jcmVhdGVOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ocGF0aCwgY3VycmVudEluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKGNoaWxkSW5zdHJ1Y3Rpb24pID0+IHtcclxuICAgICAgICAgICAgICAgIHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IGNoaWxkSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2J1aWxkTmF2aWdhdGlvblBsYW4oY2hpbGRJbnN0cnVjdGlvbiwgXHJcbiAgICAgICAgICAgICAgICAvLyBpcyBpdCBzYWZlIHRvIGFzc3VtZSB2aWV3UG9ydFBsYW4gaGFzIG5vdCBiZWVuIGNoYW5nZWQgZnJvbSBwcmV2aW91cyBhc3NpZ25tZW50P1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgc28sIGNhbiBqdXN0IHVzZSBsb2NhbCB2YXJpYWJsZSB2aWV3UG9ydFBsYW5TdHJhdGVneVxyXG4gICAgICAgICAgICAgICAgLy8gdGhlcmUgY291bGQgYmUgdXNlciBjb2RlIG1vZGlmeWluZyB2aWV3cG9ydCBwbGFuIGR1cmluZyBfY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uP1xyXG4gICAgICAgICAgICAgICAgdmlld1BvcnRQbGFuLnN0cmF0ZWd5ID09PSBcImludm9rZS1saWZlY3ljbGVcIiAvKiBJbnZva2VMaWZlY3ljbGUgKi8pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oY2hpbGRQbGFuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRQbGFuIGluc3RhbmNlb2YgUmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGNoaWxkUGxhbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkSW5zdHJ1Y3Rpb24ucGxhbiA9IGNoaWxkUGxhbjtcclxuICAgICAgICAgICAgICAgICAgICAvLyBmb3IgYmx1ZWJpcmQgP1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBwZW5kaW5nLnB1c2godGFzayk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHBlbmRpbmcpLnRoZW4oKCkgPT4gdmlld1BvcnRQbGFucyk7XHJcbn07XHJcbi8qKlxyXG4gKiBAcGFyYW0gbmV3Vmlld1BvcnRDb25maWcgaWYgdGhpcyBpcyBpbnZva2VkIG9uIGEgdmlld3BvcnQgd2l0aG91dCBhbnkgY2hhbmdlcywgYmFzZWQgb24gbmV3IHVybCwgbmV3Vmlld1BvcnRDb25maWcgd2lsbCBiZSB0aGUgZXhpc3Rpbmcgdmlld3BvcnQgaW5zdHJ1Y3Rpb25cclxuICogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IGRldGVybWluZUFjdGl2YXRpb25TdHJhdGVneSA9IChjdXJyZW50TmF2SW5zdHJ1Y3Rpb24sIHByZXZWaWV3UG9ydEluc3RydWN0aW9uLCBuZXdWaWV3UG9ydENvbmZpZywgXHJcbi8vIGluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGRpZmZlcmVuY2UgYmV0d2VlbiBvbGQgYW5kIG5ldyB1cmwgcGFyYW1zXHJcbmhhc05ld1BhcmFtcywgZm9yY2VMaWZlY3ljbGVNaW5pbXVtKSA9PiB7XHJcbiAgICBsZXQgbmV3SW5zdHJ1Y3Rpb25Db25maWcgPSBjdXJyZW50TmF2SW5zdHJ1Y3Rpb24uY29uZmlnO1xyXG4gICAgbGV0IHByZXZWaWV3UG9ydFZpZXdNb2RlbCA9IHByZXZWaWV3UG9ydEluc3RydWN0aW9uLmNvbXBvbmVudC52aWV3TW9kZWw7XHJcbiAgICBsZXQgdmlld1BvcnRQbGFuU3RyYXRlZ3k7XHJcbiAgICBpZiAocHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24ubW9kdWxlSWQgIT09IG5ld1ZpZXdQb3J0Q29uZmlnLm1vZHVsZUlkKSB7XHJcbiAgICAgICAgdmlld1BvcnRQbGFuU3RyYXRlZ3kgPSBcInJlcGxhY2VcIiAvKiBSZXBsYWNlICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoJ2RldGVybWluZUFjdGl2YXRpb25TdHJhdGVneScgaW4gcHJldlZpZXdQb3J0Vmlld01vZGVsKSB7XHJcbiAgICAgICAgdmlld1BvcnRQbGFuU3RyYXRlZ3kgPSBwcmV2Vmlld1BvcnRWaWV3TW9kZWwuZGV0ZXJtaW5lQWN0aXZhdGlvblN0cmF0ZWd5KC4uLmN1cnJlbnROYXZJbnN0cnVjdGlvbi5saWZlY3ljbGVBcmdzKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKG5ld0luc3RydWN0aW9uQ29uZmlnLmFjdGl2YXRpb25TdHJhdGVneSkge1xyXG4gICAgICAgIHZpZXdQb3J0UGxhblN0cmF0ZWd5ID0gbmV3SW5zdHJ1Y3Rpb25Db25maWcuYWN0aXZhdGlvblN0cmF0ZWd5O1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoaGFzTmV3UGFyYW1zIHx8IGZvcmNlTGlmZWN5Y2xlTWluaW11bSkge1xyXG4gICAgICAgIHZpZXdQb3J0UGxhblN0cmF0ZWd5ID0gXCJpbnZva2UtbGlmZWN5Y2xlXCIgLyogSW52b2tlTGlmZWN5Y2xlICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgdmlld1BvcnRQbGFuU3RyYXRlZ3kgPSBcIm5vLWNoYW5nZVwiIC8qIE5vQ2hhbmdlICovO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZpZXdQb3J0UGxhblN0cmF0ZWd5O1xyXG59O1xyXG4vKipAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xyXG5jb25zdCBoYXNEaWZmZXJlbnRQYXJhbWV0ZXJWYWx1ZXMgPSAocHJldiwgbmV4dCkgPT4ge1xyXG4gICAgbGV0IHByZXZQYXJhbXMgPSBwcmV2LnBhcmFtcztcclxuICAgIGxldCBuZXh0UGFyYW1zID0gbmV4dC5wYXJhbXM7XHJcbiAgICBsZXQgbmV4dFdpbGRDYXJkTmFtZSA9IG5leHQuY29uZmlnLmhhc0NoaWxkUm91dGVyID8gbmV4dC5nZXRXaWxkQ2FyZE5hbWUoKSA6IG51bGw7XHJcbiAgICBmb3IgKGxldCBrZXkgaW4gbmV4dFBhcmFtcykge1xyXG4gICAgICAgIGlmIChrZXkgPT09IG5leHRXaWxkQ2FyZE5hbWUpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcmV2UGFyYW1zW2tleV0gIT09IG5leHRQYXJhbXNba2V5XSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBrZXkgaW4gcHJldlBhcmFtcykge1xyXG4gICAgICAgIGlmIChrZXkgPT09IG5leHRXaWxkQ2FyZE5hbWUpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcmV2UGFyYW1zW2tleV0gIT09IG5leHRQYXJhbXNba2V5XSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIW5leHQub3B0aW9ucy5jb21wYXJlUXVlcnlQYXJhbXMpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBsZXQgcHJldlF1ZXJ5UGFyYW1zID0gcHJldi5xdWVyeVBhcmFtcztcclxuICAgIGxldCBuZXh0UXVlcnlQYXJhbXMgPSBuZXh0LnF1ZXJ5UGFyYW1zO1xyXG4gICAgZm9yIChsZXQga2V5IGluIG5leHRRdWVyeVBhcmFtcykge1xyXG4gICAgICAgIGlmIChwcmV2UXVlcnlQYXJhbXNba2V5XSAhPT0gbmV4dFF1ZXJ5UGFyYW1zW2tleV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yIChsZXQga2V5IGluIHByZXZRdWVyeVBhcmFtcykge1xyXG4gICAgICAgIGlmIChwcmV2UXVlcnlQYXJhbXNba2V5XSAhPT0gbmV4dFF1ZXJ5UGFyYW1zW2tleV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59O1xuXG4vKipcclxuICogVHJhbnNmb3JtIGEgbmF2aWdhdGlvbiBpbnN0cnVjdGlvbiBpbnRvIHZpZXdwb3J0IHBsYW4gcmVjb3JkIG9iamVjdCxcclxuICogb3IgYSByZWRpcmVjdCByZXF1ZXN0IGlmIHVzZXIgdmlld21vZGVsIGRlbWFuZHNcclxuICovXHJcbmNsYXNzIEJ1aWxkTmF2aWdhdGlvblBsYW5TdGVwIHtcclxuICAgIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gX2J1aWxkTmF2aWdhdGlvblBsYW4obmF2aWdhdGlvbkluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAudGhlbihwbGFuID0+IHtcclxuICAgICAgICAgICAgaWYgKHBsYW4gaW5zdGFuY2VvZiBSZWRpcmVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKHBsYW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5hdmlnYXRpb25JbnN0cnVjdGlvbi5wbGFuID0gcGxhbjtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2gobmV4dC5jYW5jZWwpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAaW50ZXJuYWwgRXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgbG9hZE5ld1JvdXRlID0gKHJvdXRlTG9hZGVyLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pID0+IHtcclxuICAgIGxldCBsb2FkaW5nUGxhbnMgPSBkZXRlcm1pbmVMb2FkaW5nUGxhbnMobmF2aWdhdGlvbkluc3RydWN0aW9uKTtcclxuICAgIGxldCBsb2FkUHJvbWlzZXMgPSBsb2FkaW5nUGxhbnMubWFwKChsb2FkaW5nUGxhbikgPT4gbG9hZFJvdXRlKHJvdXRlTG9hZGVyLCBsb2FkaW5nUGxhbi5uYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGxvYWRpbmdQbGFuLnZpZXdQb3J0UGxhbikpO1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGxvYWRQcm9taXNlcyk7XHJcbn07XHJcbi8qKlxyXG4gKiBAaW50ZXJuYWwgRXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgZGV0ZXJtaW5lTG9hZGluZ1BsYW5zID0gKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgbG9hZGluZ1BsYW5zID0gW10pID0+IHtcclxuICAgIGxldCB2aWV3UG9ydFBsYW5zID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLnBsYW47XHJcbiAgICBmb3IgKGxldCB2aWV3UG9ydE5hbWUgaW4gdmlld1BvcnRQbGFucykge1xyXG4gICAgICAgIGxldCB2aWV3UG9ydFBsYW4gPSB2aWV3UG9ydFBsYW5zW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgbGV0IGNoaWxkTmF2SW5zdHJ1Y3Rpb24gPSB2aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgaWYgKHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9PT0gXCJyZXBsYWNlXCIgLyogUmVwbGFjZSAqLykge1xyXG4gICAgICAgICAgICBsb2FkaW5nUGxhbnMucHVzaCh7IHZpZXdQb3J0UGxhbiwgbmF2aWdhdGlvbkluc3RydWN0aW9uIH0pO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGROYXZJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgZGV0ZXJtaW5lTG9hZGluZ1BsYW5zKGNoaWxkTmF2SW5zdHJ1Y3Rpb24sIGxvYWRpbmdQbGFucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9uID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLmFkZFZpZXdQb3J0SW5zdHJ1Y3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgbmFtZTogdmlld1BvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc3RyYXRlZ3k6IHZpZXdQb3J0UGxhbi5zdHJhdGVneSxcclxuICAgICAgICAgICAgICAgIG1vZHVsZUlkOiB2aWV3UG9ydFBsYW4ucHJldk1vZHVsZUlkLFxyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiB2aWV3UG9ydFBsYW4ucHJldkNvbXBvbmVudFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkTmF2SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIHZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBjaGlsZE5hdkluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgZGV0ZXJtaW5lTG9hZGluZ1BsYW5zKGNoaWxkTmF2SW5zdHJ1Y3Rpb24sIGxvYWRpbmdQbGFucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbG9hZGluZ1BsYW5zO1xyXG59O1xyXG4vKipcclxuICogQGludGVybmFsIEV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IGxvYWRSb3V0ZSA9IChyb3V0ZUxvYWRlciwgbmF2aWdhdGlvbkluc3RydWN0aW9uLCB2aWV3UG9ydFBsYW4pID0+IHtcclxuICAgIGxldCBwbGFuQ29uZmlnID0gdmlld1BvcnRQbGFuLmNvbmZpZztcclxuICAgIGxldCBtb2R1bGVJZCA9IHBsYW5Db25maWcgPyBwbGFuQ29uZmlnLm1vZHVsZUlkIDogbnVsbDtcclxuICAgIHJldHVybiBsb2FkQ29tcG9uZW50KHJvdXRlTG9hZGVyLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIHBsYW5Db25maWcpXHJcbiAgICAgICAgLnRoZW4oKGNvbXBvbmVudCkgPT4ge1xyXG4gICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9uID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLmFkZFZpZXdQb3J0SW5zdHJ1Y3Rpb24oe1xyXG4gICAgICAgICAgICBuYW1lOiB2aWV3UG9ydFBsYW4ubmFtZSxcclxuICAgICAgICAgICAgc3RyYXRlZ3k6IHZpZXdQb3J0UGxhbi5zdHJhdGVneSxcclxuICAgICAgICAgICAgbW9kdWxlSWQ6IG1vZHVsZUlkLFxyXG4gICAgICAgICAgICBjb21wb25lbnQ6IGNvbXBvbmVudFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCBjaGlsZFJvdXRlciA9IGNvbXBvbmVudC5jaGlsZFJvdXRlcjtcclxuICAgICAgICBpZiAoY2hpbGRSb3V0ZXIpIHtcclxuICAgICAgICAgICAgbGV0IHBhdGggPSBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24uZ2V0V2lsZGNhcmRQYXRoKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZFJvdXRlclxyXG4gICAgICAgICAgICAgICAgLl9jcmVhdGVOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ocGF0aCwgbmF2aWdhdGlvbkluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKGNoaWxkSW5zdHJ1Y3Rpb24pID0+IHtcclxuICAgICAgICAgICAgICAgIHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IGNoaWxkSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2J1aWxkTmF2aWdhdGlvblBsYW4oY2hpbGRJbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbigoY2hpbGRQbGFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkUGxhbiBpbnN0YW5jZW9mIFJlZGlyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChjaGlsZFBsYW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjaGlsZEluc3RydWN0aW9uLnBsYW4gPSBjaGlsZFBsYW47XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1BvcnRJbnN0cnVjdGlvbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbiA9IGNoaWxkSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYWROZXdSb3V0ZShyb3V0ZUxvYWRlciwgY2hpbGRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRzIGNvbXBsYWlucyB3aXRob3V0IHRoaXMsIHRob3VnaCB0aGV5IGFyZSBzYW1lXHJcbiAgICAgICAgcmV0dXJuIHZvaWQgMDtcclxuICAgIH0pO1xyXG59O1xyXG4vKipcclxuICogTG9hZCBhIHJvdXRlZC1jb21wb25lbnQgYmFzZWQgb24gbmF2aWdhdGlvbiBpbnN0cnVjdGlvbiBhbmQgcm91dGUgY29uZmlnXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nIG9ubHlcclxuICovXHJcbmNvbnN0IGxvYWRDb21wb25lbnQgPSAocm91dGVMb2FkZXIsIG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgY29uZmlnKSA9PiB7XHJcbiAgICBsZXQgcm91dGVyID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLnJvdXRlcjtcclxuICAgIGxldCBsaWZlY3ljbGVBcmdzID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLmxpZmVjeWNsZUFyZ3M7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAudGhlbigoKSA9PiByb3V0ZUxvYWRlci5sb2FkUm91dGUocm91dGVyLCBjb25maWcsIG5hdmlnYXRpb25JbnN0cnVjdGlvbikpXHJcbiAgICAgICAgLnRoZW4oXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBjb21wb25lbnQgYW4gb2JqZWN0IGNhcnJ5aW5nIGluZm9ybWF0aW9uIGFib3V0IGxvYWRlZCByb3V0ZVxyXG4gICAgICogdHlwaWNhbGx5IGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHZpZXcgbW9kZWwsIGNoaWxkQ29udGFpbmVyLCB2aWV3IGFuZCByb3V0ZXJcclxuICAgICAqL1xyXG4gICAgKGNvbXBvbmVudCkgPT4ge1xyXG4gICAgICAgIGxldCB7IHZpZXdNb2RlbCwgY2hpbGRDb250YWluZXIgfSA9IGNvbXBvbmVudDtcclxuICAgICAgICBjb21wb25lbnQucm91dGVyID0gcm91dGVyO1xyXG4gICAgICAgIGNvbXBvbmVudC5jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgaWYgKCdjb25maWd1cmVSb3V0ZXInIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICBsZXQgY2hpbGRSb3V0ZXIgPSBjaGlsZENvbnRhaW5lci5nZXRDaGlsZFJvdXRlcigpO1xyXG4gICAgICAgICAgICBjb21wb25lbnQuY2hpbGRSb3V0ZXIgPSBjaGlsZFJvdXRlcjtcclxuICAgICAgICAgICAgcmV0dXJuIGNoaWxkUm91dGVyXHJcbiAgICAgICAgICAgICAgICAuY29uZmlndXJlKGMgPT4gdmlld01vZGVsLmNvbmZpZ3VyZVJvdXRlcihjLCBjaGlsZFJvdXRlciwgbGlmZWN5Y2xlQXJnc1swXSwgbGlmZWN5Y2xlQXJnc1sxXSwgbGlmZWN5Y2xlQXJnc1syXSkpXHJcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiBjb21wb25lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29tcG9uZW50O1xyXG4gICAgfSk7XHJcbn07XG5cbi8qKlxyXG4gKiBBYnN0cmFjdCBjbGFzcyB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciBsb2FkaW5nIHZpZXcgLyB2aWV3IG1vZGVsIGZyb20gYSByb3V0ZSBjb25maWdcclxuICogVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gY2FuIGJlIGZvdW5kIGluIGBhdXJlbGlhLXRlbXBsYXRpbmctcm91dGVyYFxyXG4gKi9cclxuY2xhc3MgUm91dGVMb2FkZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiBMb2FkIGEgcm91dGUgY29uZmlnIGJhc2VkIG9uIGl0cyB2aWV3bW9kZWwgLyB2aWV3IGNvbmZpZ3VyYXRpb25cclxuICAgICAqL1xyXG4gICAgLy8gcmV0dXJuIHR5cGluZzogcmV0dXJuIHR5cGluZ3MgdXNlZCB0byBiZSBuZXZlclxyXG4gICAgLy8gYXMgaXQgd2FzIGEgdGhyb3cuIENoYW5naW5nIGl0IHRvIFByb21pc2U8YW55PiBzaG91bGQgbm90IGNhdXNlIGFueSBpc3N1ZXNcclxuICAgIGxvYWRSb3V0ZShyb3V0ZXIsIGNvbmZpZywgbmF2aWdhdGlvbkluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSb3V0ZSBsb2FkZXJzIG11c3QgaW1wbGVtZW50IFwibG9hZFJvdXRlKHJvdXRlciwgY29uZmlnLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pXCIuJyk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEEgcGlwZWxpbmUgc3RlcCByZXNwb25zaWJsZSBmb3IgbG9hZGluZyBhIHJvdXRlIGNvbmZpZyBvZiBhIG5hdmlnYXRpb24gaW5zdHJ1Y3Rpb25cclxuICovXHJcbmNsYXNzIExvYWRSb3V0ZVN0ZXAge1xyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBzdGF0aWMgaW5qZWN0KCkgeyByZXR1cm4gW1JvdXRlTG9hZGVyXTsgfVxyXG4gICAgY29uc3RydWN0b3Iocm91dGVMb2FkZXIpIHtcclxuICAgICAgICB0aGlzLnJvdXRlTG9hZGVyID0gcm91dGVMb2FkZXI7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJ1biB0aGUgaW50ZXJuYWwgdG8gbG9hZCByb3V0ZSBjb25maWcgb2YgYSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uIHRvIHByZXBhcmUgZm9yIG5leHQgc3RlcHMgaW4gdGhlIHBpcGVsaW5lXHJcbiAgICAgKi9cclxuICAgIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gbG9hZE5ld1JvdXRlKHRoaXMucm91dGVMb2FkZXIsIG5hdmlnYXRpb25JbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgLnRoZW4obmV4dCwgbmV4dC5jYW5jZWwpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBBIHBpcGVsaW5lIHN0ZXAgZm9yIGluc3RydWN0aW5nIGEgcGllcGxpbmUgdG8gY29tbWl0IGNoYW5nZXMgb24gYSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uXHJcbiAqL1xyXG5jbGFzcyBDb21taXRDaGFuZ2VzU3RlcCB7XHJcbiAgICBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRpb25JbnN0cnVjdGlvblxyXG4gICAgICAgICAgICAuX2NvbW1pdENoYW5nZXMoLyp3YWl0IHRvIHN3YXA/Ki8gdHJ1ZSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24uX3VwZGF0ZVRpdGxlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEFuIG9wdGlvbmFsIGludGVyZmFjZSBkZXNjcmliaW5nIHRoZSBhdmFpbGFibGUgYWN0aXZhdGlvbiBzdHJhdGVnaWVzLlxyXG4gKiBAaW50ZXJuYWwgVXNlZCBpbnRlcm5hbGx5LlxyXG4gKi9cclxudmFyIEludGVybmFsQWN0aXZhdGlvblN0cmF0ZWd5O1xyXG4oZnVuY3Rpb24gKEludGVybmFsQWN0aXZhdGlvblN0cmF0ZWd5KSB7XHJcbiAgICAvKipcclxuICAgICAqIFJldXNlIHRoZSBleGlzdGluZyB2aWV3IG1vZGVsLCB3aXRob3V0IGludm9raW5nIFJvdXRlciBsaWZlY3ljbGUgaG9va3MuXHJcbiAgICAgKi9cclxuICAgIEludGVybmFsQWN0aXZhdGlvblN0cmF0ZWd5W1wiTm9DaGFuZ2VcIl0gPSBcIm5vLWNoYW5nZVwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXVzZSB0aGUgZXhpc3RpbmcgdmlldyBtb2RlbCwgaW52b2tpbmcgUm91dGVyIGxpZmVjeWNsZSBob29rcy5cclxuICAgICAqL1xyXG4gICAgSW50ZXJuYWxBY3RpdmF0aW9uU3RyYXRlZ3lbXCJJbnZva2VMaWZlY3ljbGVcIl0gPSBcImludm9rZS1saWZlY3ljbGVcIjtcclxuICAgIC8qKlxyXG4gICAgICogUmVwbGFjZSB0aGUgZXhpc3RpbmcgdmlldyBtb2RlbCwgaW52b2tpbmcgUm91dGVyIGxpZmVjeWNsZSBob29rcy5cclxuICAgICAqL1xyXG4gICAgSW50ZXJuYWxBY3RpdmF0aW9uU3RyYXRlZ3lbXCJSZXBsYWNlXCJdID0gXCJyZXBsYWNlXCI7XHJcbn0pKEludGVybmFsQWN0aXZhdGlvblN0cmF0ZWd5IHx8IChJbnRlcm5hbEFjdGl2YXRpb25TdHJhdGVneSA9IHt9KSk7XHJcbi8qKlxyXG4gKiBUaGUgc3RyYXRlZ3kgdG8gdXNlIHdoZW4gYWN0aXZhdGluZyBtb2R1bGVzIGR1cmluZyBuYXZpZ2F0aW9uLlxyXG4gKi9cclxuLy8ga2VwdCBmb3IgY29tcGF0IHJlYXNvblxyXG5jb25zdCBhY3RpdmF0aW9uU3RyYXRlZ3kgPSB7XHJcbiAgICBub0NoYW5nZTogXCJuby1jaGFuZ2VcIiAvKiBOb0NoYW5nZSAqLyxcclxuICAgIGludm9rZUxpZmVjeWNsZTogXCJpbnZva2UtbGlmZWN5Y2xlXCIgLyogSW52b2tlTGlmZWN5Y2xlICovLFxyXG4gICAgcmVwbGFjZTogXCJyZXBsYWNlXCIgLyogUmVwbGFjZSAqL1xyXG59O1xuXG4vKipcclxuICogUmVjdXJzaXZlbHkgZmluZCBsaXN0IG9mIGRlYWN0aXZhdGUtYWJsZSB2aWV3IG1vZGVsc1xyXG4gKiBhbmQgaW52b2tlIHRoZSBlaXRoZXIgJ2NhbkRlYWN0aXZhdGUnIG9yICdkZWFjdGl2YXRlJyBvbiBlYWNoXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBwcm9jZXNzRGVhY3RpdmF0YWJsZSA9IChuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGNhbGxiYWNrTmFtZSwgbmV4dCwgaWdub3JlUmVzdWx0KSA9PiB7XHJcbiAgICBsZXQgcGxhbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5wbGFuO1xyXG4gICAgbGV0IGluZm9zID0gZmluZERlYWN0aXZhdGFibGUocGxhbiwgY2FsbGJhY2tOYW1lKTtcclxuICAgIGxldCBpID0gaW5mb3MubGVuZ3RoOyAvLyBxdWVyeSBmcm9tIGluc2lkZSBvdXRcclxuICAgIGZ1bmN0aW9uIGluc3BlY3QodmFsKSB7XHJcbiAgICAgICAgaWYgKGlnbm9yZVJlc3VsdCB8fCBzaG91bGRDb250aW51ZSh2YWwpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVyYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXh0LmNhbmNlbCh2YWwpO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gaXRlcmF0ZSgpIHtcclxuICAgICAgICBpZiAoaS0tKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmlld01vZGVsID0gaW5mb3NbaV07XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdmlld01vZGVsW2NhbGxiYWNrTmFtZV0obmF2aWdhdGlvbkluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzUG90ZW50aWFsKHJlc3VsdCwgaW5zcGVjdCwgbmV4dC5jYW5jZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucm91dGVyLmNvdWxkRGVhY3RpdmF0ZSA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBpdGVyYXRlKCk7XHJcbn07XHJcbi8qKlxyXG4gKiBSZWN1cnNpdmVseSBmaW5kIGFuZCByZXR1cm5zIGEgbGlzdCBvZiBkZWFjdGl2YXRlLWFibGUgdmlldyBtb2RlbHNcclxuICogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IGZpbmREZWFjdGl2YXRhYmxlID0gKHBsYW4sIGNhbGxiYWNrTmFtZSwgbGlzdCA9IFtdKSA9PiB7XHJcbiAgICBmb3IgKGxldCB2aWV3UG9ydE5hbWUgaW4gcGxhbikge1xyXG4gICAgICAgIGxldCB2aWV3UG9ydFBsYW4gPSBwbGFuW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgbGV0IHByZXZDb21wb25lbnQgPSB2aWV3UG9ydFBsYW4ucHJldkNvbXBvbmVudDtcclxuICAgICAgICBpZiAoKHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9PT0gYWN0aXZhdGlvblN0cmF0ZWd5Lmludm9rZUxpZmVjeWNsZSB8fCB2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5yZXBsYWNlKVxyXG4gICAgICAgICAgICAmJiBwcmV2Q29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIGxldCB2aWV3TW9kZWwgPSBwcmV2Q29tcG9uZW50LnZpZXdNb2RlbDtcclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrTmFtZSBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaCh2aWV3TW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5yZXBsYWNlICYmIHByZXZDb21wb25lbnQpIHtcclxuICAgICAgICAgICAgYWRkUHJldmlvdXNEZWFjdGl2YXRhYmxlKHByZXZDb21wb25lbnQsIGNhbGxiYWNrTmFtZSwgbGlzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICBmaW5kRGVhY3RpdmF0YWJsZSh2aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucGxhbiwgY2FsbGJhY2tOYW1lLCBsaXN0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbGlzdDtcclxufTtcclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBhZGRQcmV2aW91c0RlYWN0aXZhdGFibGUgPSAoY29tcG9uZW50LCBjYWxsYmFja05hbWUsIGxpc3QpID0+IHtcclxuICAgIGxldCBjaGlsZFJvdXRlciA9IGNvbXBvbmVudC5jaGlsZFJvdXRlcjtcclxuICAgIGlmIChjaGlsZFJvdXRlciAmJiBjaGlsZFJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbnMgPSBjaGlsZFJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24udmlld1BvcnRJbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHZpZXdQb3J0SW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXTtcclxuICAgICAgICAgICAgbGV0IHByZXZDb21wb25lbnQgPSB2aWV3UG9ydEluc3RydWN0aW9uLmNvbXBvbmVudDtcclxuICAgICAgICAgICAgbGV0IHByZXZWaWV3TW9kZWwgPSBwcmV2Q29tcG9uZW50LnZpZXdNb2RlbDtcclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrTmFtZSBpbiBwcmV2Vmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2gocHJldlZpZXdNb2RlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYWRkUHJldmlvdXNEZWFjdGl2YXRhYmxlKHByZXZDb21wb25lbnQsIGNhbGxiYWNrTmFtZSwgbGlzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IHByb2Nlc3NBY3RpdmF0YWJsZSA9IChuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGNhbGxiYWNrTmFtZSwgbmV4dCwgaWdub3JlUmVzdWx0KSA9PiB7XHJcbiAgICBsZXQgaW5mb3MgPSBmaW5kQWN0aXZhdGFibGUobmF2aWdhdGlvbkluc3RydWN0aW9uLCBjYWxsYmFja05hbWUpO1xyXG4gICAgbGV0IGxlbmd0aCA9IGluZm9zLmxlbmd0aDtcclxuICAgIGxldCBpID0gLTE7IC8vIHF1ZXJ5IGZyb20gdG9wIGRvd25cclxuICAgIGZ1bmN0aW9uIGluc3BlY3QodmFsLCByb3V0ZXIpIHtcclxuICAgICAgICBpZiAoaWdub3JlUmVzdWx0IHx8IHNob3VsZENvbnRpbnVlKHZhbCwgcm91dGVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlcmF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV4dC5jYW5jZWwodmFsKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGl0ZXJhdGUoKSB7XHJcbiAgICAgICAgaSsrO1xyXG4gICAgICAgIGlmIChpIDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudCA9IGluZm9zW2ldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGN1cnJlbnQudmlld01vZGVsW2NhbGxiYWNrTmFtZV0oLi4uY3VycmVudC5saWZlY3ljbGVBcmdzKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzUG90ZW50aWFsKHJlc3VsdCwgKHZhbCkgPT4gaW5zcGVjdCh2YWwsIGN1cnJlbnQucm91dGVyKSwgbmV4dC5jYW5jZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGl0ZXJhdGUoKTtcclxufTtcclxuLyoqXHJcbiAqIEZpbmQgbGlzdCBvZiBhY3RpdmF0YWJsZSB2aWV3IG1vZGVsIGFuZCBhZGQgdG8gbGlzdCAoM3JkIHBhcmFtZXRlcilcclxuICogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IGZpbmRBY3RpdmF0YWJsZSA9IChuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGNhbGxiYWNrTmFtZSwgbGlzdCA9IFtdLCByb3V0ZXIpID0+IHtcclxuICAgIGxldCBwbGFuID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLnBsYW47XHJcbiAgICBPYmplY3RcclxuICAgICAgICAua2V5cyhwbGFuKVxyXG4gICAgICAgIC5mb3JFYWNoKCh2aWV3UG9ydE5hbWUpID0+IHtcclxuICAgICAgICBsZXQgdmlld1BvcnRQbGFuID0gcGxhblt2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9uID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0Q29tcG9uZW50ID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQ7XHJcbiAgICAgICAgbGV0IHZpZXdNb2RlbCA9IHZpZXdQb3J0Q29tcG9uZW50LnZpZXdNb2RlbDtcclxuICAgICAgICBpZiAoKHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9PT0gYWN0aXZhdGlvblN0cmF0ZWd5Lmludm9rZUxpZmVjeWNsZVxyXG4gICAgICAgICAgICB8fCB2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5yZXBsYWNlKVxyXG4gICAgICAgICAgICAmJiBjYWxsYmFja05hbWUgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIGxpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwsXHJcbiAgICAgICAgICAgICAgICBsaWZlY3ljbGVBcmdzOiB2aWV3UG9ydEluc3RydWN0aW9uLmxpZmVjeWNsZUFyZ3MsXHJcbiAgICAgICAgICAgICAgICByb3V0ZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBjaGlsZE5hdkluc3RydWN0aW9uID0gdmlld1BvcnRQbGFuLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uO1xyXG4gICAgICAgIGlmIChjaGlsZE5hdkluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGZpbmRBY3RpdmF0YWJsZShjaGlsZE5hdkluc3RydWN0aW9uLCBjYWxsYmFja05hbWUsIGxpc3QsIHZpZXdQb3J0Q29tcG9uZW50LmNoaWxkUm91dGVyIHx8IHJvdXRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbGlzdDtcclxufTtcclxuY29uc3Qgc2hvdWxkQ29udGludWUgPSAob3V0cHV0LCByb3V0ZXIpID0+IHtcclxuICAgIGlmIChvdXRwdXQgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChpc05hdmlnYXRpb25Db21tYW5kKG91dHB1dCkpIHtcclxuICAgICAgICBpZiAodHlwZW9mIG91dHB1dC5zZXRSb3V0ZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgb3V0cHV0LnNldFJvdXRlcihyb3V0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gISFvdXRwdXQuc2hvdWxkQ29udGludWVQcm9jZXNzaW5nO1xyXG4gICAgfVxyXG4gICAgaWYgKG91dHB1dCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3V0cHV0O1xyXG59O1xyXG4vKipcclxuICogd3JhcHMgYSBzdWJzY3JpcHRpb24sIGFsbG93aW5nIHVuc3Vic2NyaWJlIGNhbGxzIGV2ZW4gaWZcclxuICogdGhlIGZpcnN0IHZhbHVlIGNvbWVzIHN5bmNocm9ub3VzbHlcclxuICovXHJcbmNsYXNzIFNhZmVTdWJzY3JpcHRpb24ge1xyXG4gICAgY29uc3RydWN0b3Ioc3Vic2NyaXB0aW9uRnVuYykge1xyXG4gICAgICAgIHRoaXMuX3N1YnNjcmliZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbkZ1bmModGhpcyk7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9zdWJzY3JpYmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgc3Vic2NyaWJlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3Vic2NyaWJlZDtcclxuICAgIH1cclxuICAgIHVuc3Vic2NyaWJlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdWJzY3JpYmVkICYmIHRoaXMuX3N1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc3Vic2NyaWJlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBIGZ1bmN0aW9uIHRvIHByb2Nlc3MgcmV0dXJuIHZhbHVlIGZyb20gYGFjdGl2YXRlYC9gY2FuQWN0aXZhdGVgIHN0ZXBzXHJcbiAqIFN1cHBvcnRzIG9ic2VydmFibGUvcHJvbWlzZVxyXG4gKlxyXG4gKiBGb3Igb2JzZXJ2YWJsZSwgcmVzb2x2ZSBhdCBmaXJzdCBuZXh0KCkgb3Igb24gY29tcGxldGUoKVxyXG4gKi9cclxuY29uc3QgcHJvY2Vzc1BvdGVudGlhbCA9IChvYmosIHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgLy8gaWYgcHJvbWlzZSBsaWtlXHJcbiAgICBpZiAob2JqICYmIHR5cGVvZiBvYmoudGhlbiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUob2JqKS50aGVuKHJlc29sdmUpLmNhdGNoKHJlamVjdCk7XHJcbiAgICB9XHJcbiAgICAvLyBpZiBvYnNlcnZhYmxlXHJcbiAgICBpZiAob2JqICYmIHR5cGVvZiBvYmouc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgbGV0IG9icyA9IG9iajtcclxuICAgICAgICByZXR1cm4gbmV3IFNhZmVTdWJzY3JpcHRpb24oc3ViID0+IG9icy5zdWJzY3JpYmUoe1xyXG4gICAgICAgICAgICBuZXh0KCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdWJzY3JpYmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvcihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdWJzY3JpYmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29tcGxldGUoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3ViLnN1YnNjcmliZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICAvLyBlbHNlIGp1c3QgcmVzb2x2ZVxyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXR1cm4gcmVzb2x2ZShvYmopO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XHJcbiAgICB9XHJcbn07XG5cbi8qKlxyXG4gKiBBIHBpcGVsaW5lIHN0ZXAgcmVzcG9uc2libGUgZm9yIGZpbmRpbmcgYW5kIGFjdGl2YXRpbmcgbWV0aG9kIGBjYW5EZWFjdGl2YXRlYCBvbiBhIHZpZXcgbW9kZWwgb2YgYSByb3V0ZVxyXG4gKi9cclxuY2xhc3MgQ2FuRGVhY3RpdmF0ZVByZXZpb3VzU3RlcCB7XHJcbiAgICBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NEZWFjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgJ2NhbkRlYWN0aXZhdGUnLCBuZXh0KTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogQSBwaXBlbGluZSBzdGVwIHJlc3BvbnNpYmxlIGZvciBmaW5kaW5nIGFuZCBhY3RpdmF0aW5nIG1ldGhvZCBgY2FuQWN0aXZhdGVgIG9uIGEgdmlldyBtb2RlbCBvZiBhIHJvdXRlXHJcbiAqL1xyXG5jbGFzcyBDYW5BY3RpdmF0ZU5leHRTdGVwIHtcclxuICAgIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gcHJvY2Vzc0FjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgJ2NhbkFjdGl2YXRlJywgbmV4dCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEEgcGlwZWxpbmUgc3RlcCByZXNwb25zaWJsZSBmb3IgZmluZGluZyBhbmQgYWN0aXZhdGluZyBtZXRob2QgYGRlYWN0aXZhdGVgIG9uIGEgdmlldyBtb2RlbCBvZiBhIHJvdXRlXHJcbiAqL1xyXG5jbGFzcyBEZWFjdGl2YXRlUHJldmlvdXNTdGVwIHtcclxuICAgIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gcHJvY2Vzc0RlYWN0aXZhdGFibGUobmF2aWdhdGlvbkluc3RydWN0aW9uLCAnZGVhY3RpdmF0ZScsIG5leHQsIHRydWUpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBIHBpcGVsaW5lIHN0ZXAgcmVzcG9uc2libGUgZm9yIGZpbmRpbmcgYW5kIGFjdGl2YXRpbmcgbWV0aG9kIGBhY3RpdmF0ZWAgb24gYSB2aWV3IG1vZGVsIG9mIGEgcm91dGVcclxuICovXHJcbmNsYXNzIEFjdGl2YXRlTmV4dFN0ZXAge1xyXG4gICAgcnVuKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBwcm9jZXNzQWN0aXZhdGFibGUobmF2aWdhdGlvbkluc3RydWN0aW9uLCAnYWN0aXZhdGUnLCBuZXh0LCB0cnVlKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQSBtdWx0aS1zbG90cyBQaXBlbGluZSBQbGFjZWhvbGRlciBTdGVwIGZvciBob29raW5nIGludG8gYSBwaXBlbGluZSBleGVjdXRpb25cclxuICovXHJcbmNsYXNzIFBpcGVsaW5lU2xvdCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIsIG5hbWUsIGFsaWFzKSB7XHJcbiAgICAgICAgdGhpcy5zdGVwcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuc2xvdE5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuc2xvdEFsaWFzID0gYWxpYXM7XHJcbiAgICB9XHJcbiAgICBnZXRTdGVwcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGVwcy5tYXAoeCA9PiB0aGlzLmNvbnRhaW5lci5nZXQoeCkpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBDbGFzcyByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIG5hdmlnYXRpb24gcGlwZWxpbmUuXHJcbiAqL1xyXG5jbGFzcyBQaXBlbGluZVByb3ZpZGVyIHtcclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIGluamVjdCgpIHsgcmV0dXJuIFtDb250YWluZXJdOyB9XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLnN0ZXBzID0gW1xyXG4gICAgICAgICAgICBCdWlsZE5hdmlnYXRpb25QbGFuU3RlcCxcclxuICAgICAgICAgICAgQ2FuRGVhY3RpdmF0ZVByZXZpb3VzU3RlcCxcclxuICAgICAgICAgICAgTG9hZFJvdXRlU3RlcCxcclxuICAgICAgICAgICAgY3JlYXRlUGlwZWxpbmVTbG90KGNvbnRhaW5lciwgXCJhdXRob3JpemVcIiAvKiBBdXRob3JpemUgKi8pLFxyXG4gICAgICAgICAgICBDYW5BY3RpdmF0ZU5leHRTdGVwLFxyXG4gICAgICAgICAgICBjcmVhdGVQaXBlbGluZVNsb3QoY29udGFpbmVyLCBcInByZUFjdGl2YXRlXCIgLyogUHJlQWN0aXZhdGUgKi8sICdtb2RlbGJpbmQnKSxcclxuICAgICAgICAgICAgLy8gTk9URTogYXBwIHN0YXRlIGNoYW5nZXMgc3RhcnQgYmVsb3cgLSBwb2ludCBvZiBubyByZXR1cm5cclxuICAgICAgICAgICAgRGVhY3RpdmF0ZVByZXZpb3VzU3RlcCxcclxuICAgICAgICAgICAgQWN0aXZhdGVOZXh0U3RlcCxcclxuICAgICAgICAgICAgY3JlYXRlUGlwZWxpbmVTbG90KGNvbnRhaW5lciwgXCJwcmVSZW5kZXJcIiAvKiBQcmVSZW5kZXIgKi8sICdwcmVjb21taXQnKSxcclxuICAgICAgICAgICAgQ29tbWl0Q2hhbmdlc1N0ZXAsXHJcbiAgICAgICAgICAgIGNyZWF0ZVBpcGVsaW5lU2xvdChjb250YWluZXIsIFwicG9zdFJlbmRlclwiIC8qIFBvc3RSZW5kZXIgKi8sICdwb3N0Y29tcGxldGUnKVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSB0aGUgbmF2aWdhdGlvbiBwaXBlbGluZS5cclxuICAgICAqL1xyXG4gICAgY3JlYXRlUGlwZWxpbmUodXNlQ2FuRGVhY3RpdmF0ZVN0ZXAgPSB0cnVlKSB7XHJcbiAgICAgICAgbGV0IHBpcGVsaW5lID0gbmV3IFBpcGVsaW5lKCk7XHJcbiAgICAgICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xyXG4gICAgICAgICAgICBpZiAodXNlQ2FuRGVhY3RpdmF0ZVN0ZXAgfHwgc3RlcCAhPT0gQ2FuRGVhY3RpdmF0ZVByZXZpb3VzU3RlcCkge1xyXG4gICAgICAgICAgICAgICAgcGlwZWxpbmUuYWRkU3RlcCh0aGlzLmNvbnRhaW5lci5nZXQoc3RlcCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHBpcGVsaW5lO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfZmluZFN0ZXAobmFtZSkge1xyXG4gICAgICAgIC8vIFN0ZXBzIHRoYXQgYXJlIG5vdCBQaXBlbGluZVNsb3RzIGFyZSBjb25zdHJ1Y3RvciBmdW5jdGlvbnMsIGFuZCB0aGV5IHdpbGwgYXV0b21hdGljYWxseSBmYWlsLiBQcm9iYWJseS5cclxuICAgICAgICByZXR1cm4gdGhpcy5zdGVwcy5maW5kKHggPT4geC5zbG90TmFtZSA9PT0gbmFtZSB8fCB4LnNsb3RBbGlhcyA9PT0gbmFtZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBzdGVwIGludG8gdGhlIHBpcGVsaW5lIGF0IGEga25vd24gc2xvdCBsb2NhdGlvbi5cclxuICAgICAqL1xyXG4gICAgYWRkU3RlcChuYW1lLCBzdGVwKSB7XHJcbiAgICAgICAgbGV0IGZvdW5kID0gdGhpcy5fZmluZFN0ZXAobmFtZSk7XHJcbiAgICAgICAgaWYgKGZvdW5kKSB7XHJcbiAgICAgICAgICAgIGxldCBzbG90U3RlcHMgPSBmb3VuZC5zdGVwcztcclxuICAgICAgICAgICAgLy8gcHJldmVudCBkdXBsaWNhdGVzXHJcbiAgICAgICAgICAgIGlmICghc2xvdFN0ZXBzLmluY2x1ZGVzKHN0ZXApKSB7XHJcbiAgICAgICAgICAgICAgICBzbG90U3RlcHMucHVzaChzdGVwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBpcGVsaW5lIHNsb3QgbmFtZTogJHtuYW1lfS5gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgYSBzdGVwIGZyb20gYSBzbG90IGluIHRoZSBwaXBlbGluZVxyXG4gICAgICovXHJcbiAgICByZW1vdmVTdGVwKG5hbWUsIHN0ZXApIHtcclxuICAgICAgICBsZXQgc2xvdCA9IHRoaXMuX2ZpbmRTdGVwKG5hbWUpO1xyXG4gICAgICAgIGlmIChzbG90KSB7XHJcbiAgICAgICAgICAgIGxldCBzbG90U3RlcHMgPSBzbG90LnN0ZXBzO1xyXG4gICAgICAgICAgICBzbG90U3RlcHMuc3BsaWNlKHNsb3RTdGVwcy5pbmRleE9mKHN0ZXApLCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENsZWFycyBhbGwgc3RlcHMgZnJvbSBhIHNsb3QgaW4gdGhlIHBpcGVsaW5lXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgX2NsZWFyU3RlcHMobmFtZSA9ICcnKSB7XHJcbiAgICAgICAgbGV0IHNsb3QgPSB0aGlzLl9maW5kU3RlcChuYW1lKTtcclxuICAgICAgICBpZiAoc2xvdCkge1xyXG4gICAgICAgICAgICBzbG90LnN0ZXBzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXNldHMgYWxsIHBpcGVsaW5lIHNsb3RzXHJcbiAgICAgKi9cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMuX2NsZWFyU3RlcHMoXCJhdXRob3JpemVcIiAvKiBBdXRob3JpemUgKi8pO1xyXG4gICAgICAgIHRoaXMuX2NsZWFyU3RlcHMoXCJwcmVBY3RpdmF0ZVwiIC8qIFByZUFjdGl2YXRlICovKTtcclxuICAgICAgICB0aGlzLl9jbGVhclN0ZXBzKFwicHJlUmVuZGVyXCIgLyogUHJlUmVuZGVyICovKTtcclxuICAgICAgICB0aGlzLl9jbGVhclN0ZXBzKFwicG9zdFJlbmRlclwiIC8qIFBvc3RSZW5kZXIgKi8pO1xyXG4gICAgfVxyXG59XHJcbi8qKkBpbnRlcm5hbCAqL1xyXG5jb25zdCBjcmVhdGVQaXBlbGluZVNsb3QgPSAoY29udGFpbmVyLCBuYW1lLCBhbGlhcykgPT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQaXBlbGluZVNsb3QoY29udGFpbmVyLCBuYW1lLCBhbGlhcyk7XHJcbn07XG5cbmNvbnN0IGxvZ2dlciA9IGdldExvZ2dlcignYXBwLXJvdXRlcicpO1xyXG4vKipcclxuICogVGhlIG1haW4gYXBwbGljYXRpb24gcm91dGVyLlxyXG4gKi9cclxuY2xhc3MgQXBwUm91dGVyIGV4dGVuZHMgUm91dGVyIHtcclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIGluamVjdCgpIHsgcmV0dXJuIFtDb250YWluZXIsIEhpc3RvcnksIFBpcGVsaW5lUHJvdmlkZXIsIEV2ZW50QWdncmVnYXRvcl07IH1cclxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgaGlzdG9yeSwgcGlwZWxpbmVQcm92aWRlciwgZXZlbnRzKSB7XHJcbiAgICAgICAgc3VwZXIoY29udGFpbmVyLCBoaXN0b3J5KTsgLy8gTm90ZSB0aGUgc3VwZXIgd2lsbCBjYWxsIHJlc2V0IGludGVybmFsbHkuXHJcbiAgICAgICAgdGhpcy5waXBlbGluZVByb3ZpZGVyID0gcGlwZWxpbmVQcm92aWRlcjtcclxuICAgICAgICB0aGlzLmV2ZW50cyA9IGV2ZW50cztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogRnVsbHkgcmVzZXRzIHRoZSByb3V0ZXIncyBpbnRlcm5hbCBzdGF0ZS4gUHJpbWFyaWx5IHVzZWQgaW50ZXJuYWxseSBieSB0aGUgZnJhbWV3b3JrIHdoZW4gbXVsdGlwbGUgY2FsbHMgdG8gc2V0Um9vdCBhcmUgbWFkZS5cclxuICAgICAqIFVzZSB3aXRoIGNhdXRpb24gKGFjdHVhbGx5LCBhdm9pZCB1c2luZyB0aGlzKS4gRG8gbm90IHVzZSB0aGlzIHRvIHNpbXBseSBjaGFuZ2UgeW91ciBuYXZpZ2F0aW9uIG1vZGVsLlxyXG4gICAgICovXHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICBzdXBlci5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMubWF4SW5zdHJ1Y3Rpb25Db3VudCA9IDEwO1xyXG4gICAgICAgIGlmICghdGhpcy5fcXVldWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fcXVldWUgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXVlLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBMb2FkcyB0aGUgc3BlY2lmaWVkIFVSTC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXJsIFRoZSBVUkwgZnJhZ21lbnQgdG8gbG9hZC5cclxuICAgICAqL1xyXG4gICAgbG9hZFVybCh1cmwpIHtcclxuICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICAuX2NyZWF0ZU5hdmlnYXRpb25JbnN0cnVjdGlvbih1cmwpXHJcbiAgICAgICAgICAgIC50aGVuKGluc3RydWN0aW9uID0+IHRoaXMuX3F1ZXVlSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24pKVxyXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICByZXN0b3JlUHJldmlvdXNMb2NhdGlvbih0aGlzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVnaXN0ZXJzIGEgdmlld1BvcnQgdG8gYmUgdXNlZCBhcyBhIHJlbmRlcmluZyB0YXJnZXQgZm9yIGFjdGl2YXRlZCByb3V0ZXMuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHZpZXdQb3J0IFRoZSB2aWV3UG9ydC4gVGhpcyBpcyB0eXBpY2FsbHkgYSA8cm91dGVyLXZpZXcvPiBlbGVtZW50IGluIEF1cmVsaWEgZGVmYXVsdCBpbXBsXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgdmlld1BvcnQuICdkZWZhdWx0JyBpZiB1bnNwZWNpZmllZC5cclxuICAgICAqL1xyXG4gICAgcmVnaXN0ZXJWaWV3UG9ydCh2aWV3UG9ydCwgbmFtZSkge1xyXG4gICAgICAgIC8vIGhhdmluZyBzdHJvbmcgdHlwaW5nIHdpdGhvdXQgY2hhbmdpbmcgcHVibGljIEFQSVxyXG4gICAgICAgIGNvbnN0ICR2aWV3UG9ydCA9IHZpZXdQb3J0O1xyXG4gICAgICAgIHN1cGVyLnJlZ2lzdGVyVmlld1BvcnQoJHZpZXdQb3J0LCBuYW1lKTtcclxuICAgICAgICAvLyBiZXNpZGUgYWRkaW5nIHZpZXdwb3J0IHRvIHRoZSByZWdpc3RyeSBvZiB0aGlzIGluc3RhbmNlXHJcbiAgICAgICAgLy8gQXBwUm91dGVyIGFsc28gY29uZmlndXJlIHJvdXRpbmcvaGlzdG9yeSB0byBzdGFydCByb3V0aW5nIGZ1bmN0aW9uYWxpdHlcclxuICAgICAgICAvLyBUaGVyZSBhcmUgc2l0dWF0aW9uIHdoZXJlIHRoZXJlIGFyZSBtb3JlIHRoYW4gMSA8cm91dGVyLXZpZXcvPiBlbGVtZW50IGF0IHJvb3Qgdmlld1xyXG4gICAgICAgIC8vIGluIHRoYXQgY2FzZSwgc3RpbGwgb25seSBhY3RpdmF0ZSBvbmNlIHZpYSB0aGUgZm9sbG93aW5nIGd1YXJkXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZpZXdNb2RlbCA9IHRoaXMuX2ZpbmRWaWV3TW9kZWwoJHZpZXdQb3J0KTtcclxuICAgICAgICAgICAgaWYgKCdjb25maWd1cmVSb3V0ZXInIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgPHJvdXRlci12aWV3Lz4gZWxlbWVudCBhdCByb290IHZpZXdcclxuICAgICAgICAgICAgICAgIC8vIHVzZSB0aGlzIGZsYWcgdG8gZ3VhcmQgYWdhaW5zdCBjb25maWd1cmUgbWV0aG9kIGJlaW5nIGludm9rZWQgbXVsdGlwbGUgdGltZXNcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMgZmxhZyBpcyBzZXQgaW5zaWRlIG1ldGhvZCBjb25maWd1cmVcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbmZpZ3VyZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXBsYWNlIHRoZSByZWFsIHJlc29sdmUgd2l0aCBhIG5vb3AgdG8gZ3VhcmFudGVlIHRoYXQgYW55IGFjdGlvbiBpbiBiYXNlIGNsYXNzIFJvdXRlclxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdvbid0IHJlc29sdmUgdGhlIGNvbmZpZ3VyZVByb21pc2UgcHJlbWF0dXJlbHlcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNvbHZlQ29uZmlndXJlZFByb21pc2UgPSB0aGlzLl9yZXNvbHZlQ29uZmlndXJlZFByb21pc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlID0gKCkgPT4geyB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jb25maWd1cmUoY29uZmlnID0+IFByb21pc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlc29sdmUodmlld01vZGVsLmNvbmZpZ3VyZVJvdXRlcihjb25maWcsIHRoaXMpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhbiBpc3N1ZSB3aXRoIGNvbmZpZ3VyZSBpbnRlcmZhY2UuIFNob3VsZCBiZSBmaXhlZCB0aGVyZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0b2RvOiBmaXggdGhpcyB2aWEgY29uZmlndXJlIGludGVyZmFjZSBpbiByb3V0ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gY29uZmlnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVDb25maWd1cmVkUHJvbWlzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHdoZW4gYSB2aWV3cG9ydCBpcyBhZGRlZCBkeW5hbWljYWxseSB0byBhIHJvb3QgdmlldyB0aGF0IGlzIGFscmVhZHkgYWN0aXZhdGVkXHJcbiAgICAgICAgLy8ganVzdCBwcm9jZXNzIHRoZSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RlcXVldWVJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFjdGl2YXRlcyB0aGUgcm91dGVyLiBUaGlzIGluc3RydWN0cyB0aGUgcm91dGVyIHRvIGJlZ2luIGxpc3RlbmluZyBmb3IgaGlzdG9yeSBjaGFuZ2VzIGFuZCBwcm9jZXNzaW5nIGluc3RydWN0aW9ucy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW1zIG9wdGlvbnMgVGhlIHNldCBvZiBvcHRpb25zIHRvIGFjdGl2YXRlIHRoZSByb3V0ZXIgd2l0aC5cclxuICAgICAqL1xyXG4gICAgYWN0aXZhdGUob3B0aW9ucykge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgLy8gcm91dGUgaGFuZGxlciBwcm9wZXJ0eSBpcyByZXNwb25zaWJsZSBmb3IgaGFuZGxpbmcgdXJsIGNoYW5nZVxyXG4gICAgICAgIC8vIHRoZSBpbnRlcmZhY2Ugb2YgYXVyZWxpYS1oaXN0b3J5IGlzbid0IGNsZWFyIG9uIHRoaXMgcGVyc3BlY3RpdmVcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgcm91dGVIYW5kbGVyOiB0aGlzLmxvYWRVcmwuYmluZCh0aGlzKSB9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuaGlzdG9yeS5hY3RpdmF0ZSh0aGlzLm9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuX2RlcXVldWVJbnN0cnVjdGlvbigpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBEZWFjdGl2YXRlcyB0aGUgcm91dGVyLlxyXG4gICAgICovXHJcbiAgICBkZWFjdGl2YXRlKCkge1xyXG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmhpc3RvcnkuZGVhY3RpdmF0ZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfcXVldWVJbnN0cnVjdGlvbihpbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbi5yZXNvbHZlID0gcmVzb2x2ZTtcclxuICAgICAgICAgICAgdGhpcy5fcXVldWUudW5zaGlmdChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMuX2RlcXVldWVJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfZGVxdWV1ZUluc3RydWN0aW9uKGluc3RydWN0aW9uQ291bnQgPSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc05hdmlnYXRpbmcgJiYgIWluc3RydWN0aW9uQ291bnQpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRzIGNvbXBsYWlucyBhYm91dCBpbmNvbnNpc3RlbnQgcmV0dXJucyB3aXRob3V0IHZvaWQgMFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgaW5zdHJ1Y3Rpb24gPSB0aGlzLl9xdWV1ZS5zaGlmdCgpO1xyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICBpZiAoIWluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0cyBjb21wbGFpbnMgYWJvdXQgaW5jb25zaXN0ZW50IHJldHVybnMgd2l0aG91dCB2b2lkIDBcclxuICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pc05hdmlnYXRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBsZXQgbmF2dHJhY2tlciA9IHRoaXMuaGlzdG9yeS5nZXRTdGF0ZSgnTmF2aWdhdGlvblRyYWNrZXInKTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnROYXZUcmFja2VyID0gdGhpcy5jdXJyZW50TmF2aWdhdGlvblRyYWNrZXI7XHJcbiAgICAgICAgICAgIGlmICghbmF2dHJhY2tlciAmJiAhY3VycmVudE5hdlRyYWNrZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nRmlyc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdOZXcgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCFuYXZ0cmFja2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTmF2aWdhdGluZ05ldyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoIWN1cnJlbnROYXZUcmFja2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTmF2aWdhdGluZ1JlZnJlc2ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnROYXZUcmFja2VyIDwgbmF2dHJhY2tlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdGb3J3YXJkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TmF2VHJhY2tlciA+IG5hdnRyYWNrZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nQmFjayA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFuYXZ0cmFja2VyKSB7XHJcbiAgICAgICAgICAgICAgICBuYXZ0cmFja2VyID0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5zZXRTdGF0ZSgnTmF2aWdhdGlvblRyYWNrZXInLCBuYXZ0cmFja2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnROYXZpZ2F0aW9uVHJhY2tlciA9IG5hdnRyYWNrZXI7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uLnByZXZpb3VzSW5zdHJ1Y3Rpb24gPSB0aGlzLmN1cnJlbnRJbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgbGV0IG1heEluc3RydWN0aW9uQ291bnQgPSB0aGlzLm1heEluc3RydWN0aW9uQ291bnQ7XHJcbiAgICAgICAgICAgIGlmICghaW5zdHJ1Y3Rpb25Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ldmVudHMucHVibGlzaChcInJvdXRlcjpuYXZpZ2F0aW9uOnByb2Nlc3NpbmdcIiAvKiBQcm9jZXNzaW5nICovLCB7IGluc3RydWN0aW9uIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGluc3RydWN0aW9uQ291bnQgPT09IG1heEluc3RydWN0aW9uQ291bnQgLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoYCR7aW5zdHJ1Y3Rpb25Db3VudCArIDF9IG5hdmlnYXRpb24gaW5zdHJ1Y3Rpb25zIGhhdmUgYmVlbiBhdHRlbXB0ZWQgd2l0aG91dCBzdWNjZXNzLiBSZXN0b3JpbmcgbGFzdCBrbm93biBnb29kIGxvY2F0aW9uLmApO1xyXG4gICAgICAgICAgICAgICAgcmVzdG9yZVByZXZpb3VzTG9jYXRpb24odGhpcyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGVxdWV1ZUluc3RydWN0aW9uKGluc3RydWN0aW9uQ291bnQgKyAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChpbnN0cnVjdGlvbkNvdW50ID4gbWF4SW5zdHJ1Y3Rpb25Db3VudCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNYXhpbXVtIG5hdmlnYXRpb24gYXR0ZW1wdHMgZXhjZWVkZWQuIEdpdmluZyB1cC4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgcGlwZWxpbmUgPSB0aGlzLnBpcGVsaW5lUHJvdmlkZXIuY3JlYXRlUGlwZWxpbmUoIXRoaXMuY291bGREZWFjdGl2YXRlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHBpcGVsaW5lXHJcbiAgICAgICAgICAgICAgICAucnVuKGluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHByb2Nlc3NSZXN1bHQoaW5zdHJ1Y3Rpb24sIHJlc3VsdCwgaW5zdHJ1Y3Rpb25Db3VudCwgdGhpcykpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgb3V0cHV0OiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoZXJyb3IpIH07XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gcmVzb2x2ZUluc3RydWN0aW9uKGluc3RydWN0aW9uLCByZXN1bHQsICEhaW5zdHJ1Y3Rpb25Db3VudCwgdGhpcykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfZmluZFZpZXdNb2RlbCh2aWV3UG9ydCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRhaW5lci52aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLnZpZXdNb2RlbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZpZXdQb3J0LmNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICBsZXQgY29udGFpbmVyID0gdmlld1BvcnQuY29udGFpbmVyO1xyXG4gICAgICAgICAgICB3aGlsZSAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyLnZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnZpZXdNb2RlbCA9IGNvbnRhaW5lci52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lci52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBjb250YWluZXIucGFyZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbn1cclxuY29uc3QgcHJvY2Vzc1Jlc3VsdCA9IChpbnN0cnVjdGlvbiwgcmVzdWx0LCBpbnN0cnVjdGlvbkNvdW50LCByb3V0ZXIpID0+IHtcclxuICAgIGlmICghKHJlc3VsdCAmJiAnY29tcGxldGVkJyBpbiByZXN1bHQgJiYgJ291dHB1dCcgaW4gcmVzdWx0KSkge1xyXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdCB8fCB7fTtcclxuICAgICAgICByZXN1bHQub3V0cHV0ID0gbmV3IEVycm9yKGBFeHBlY3RlZCByb3V0ZXIgcGlwZWxpbmUgdG8gcmV0dXJuIGEgbmF2aWdhdGlvbiByZXN1bHQsIGJ1dCBnb3QgWyR7SlNPTi5zdHJpbmdpZnkocmVzdWx0KX1dIGluc3RlYWQuYCk7XHJcbiAgICB9XHJcbiAgICBsZXQgZmluYWxSZXN1bHQgPSBudWxsO1xyXG4gICAgbGV0IG5hdmlnYXRpb25Db21tYW5kUmVzdWx0ID0gbnVsbDtcclxuICAgIGlmIChpc05hdmlnYXRpb25Db21tYW5kKHJlc3VsdC5vdXRwdXQpKSB7XHJcbiAgICAgICAgbmF2aWdhdGlvbkNvbW1hbmRSZXN1bHQgPSByZXN1bHQub3V0cHV0Lm5hdmlnYXRlKHJvdXRlcik7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBmaW5hbFJlc3VsdCA9IHJlc3VsdDtcclxuICAgICAgICBpZiAoIXJlc3VsdC5jb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5vdXRwdXQgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHJlc3VsdC5vdXRwdXQudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzdG9yZVByZXZpb3VzTG9jYXRpb24ocm91dGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5hdmlnYXRpb25Db21tYW5kUmVzdWx0KVxyXG4gICAgICAgIC50aGVuKF8gPT4gcm91dGVyLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb25Db3VudCArIDEpKVxyXG4gICAgICAgIC50aGVuKGlubmVyUmVzdWx0ID0+IGZpbmFsUmVzdWx0IHx8IGlubmVyUmVzdWx0IHx8IHJlc3VsdCk7XHJcbn07XHJcbmNvbnN0IHJlc29sdmVJbnN0cnVjdGlvbiA9IChpbnN0cnVjdGlvbiwgcmVzdWx0LCBpc0lubmVySW5zdHJ1Y3Rpb24sIHJvdXRlcikgPT4ge1xyXG4gICAgaW5zdHJ1Y3Rpb24ucmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgbGV0IGV2ZW50QWdncmVnYXRvciA9IHJvdXRlci5ldmVudHM7XHJcbiAgICBsZXQgZXZlbnRBcmdzID0geyBpbnN0cnVjdGlvbiwgcmVzdWx0IH07XHJcbiAgICBpZiAoIWlzSW5uZXJJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHJvdXRlci5pc05hdmlnYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICByb3V0ZXIuaXNFeHBsaWNpdE5hdmlnYXRpb24gPSBmYWxzZTtcclxuICAgICAgICByb3V0ZXIuaXNFeHBsaWNpdE5hdmlnYXRpb25CYWNrID0gZmFsc2U7XHJcbiAgICAgICAgcm91dGVyLmlzTmF2aWdhdGluZ0ZpcnN0ID0gZmFsc2U7XHJcbiAgICAgICAgcm91dGVyLmlzTmF2aWdhdGluZ05ldyA9IGZhbHNlO1xyXG4gICAgICAgIHJvdXRlci5pc05hdmlnYXRpbmdSZWZyZXNoID0gZmFsc2U7XHJcbiAgICAgICAgcm91dGVyLmlzTmF2aWdhdGluZ0ZvcndhcmQgPSBmYWxzZTtcclxuICAgICAgICByb3V0ZXIuaXNOYXZpZ2F0aW5nQmFjayA9IGZhbHNlO1xyXG4gICAgICAgIHJvdXRlci5jb3VsZERlYWN0aXZhdGUgPSBmYWxzZTtcclxuICAgICAgICBsZXQgZXZlbnROYW1lO1xyXG4gICAgICAgIGlmIChyZXN1bHQub3V0cHV0IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgZXZlbnROYW1lID0gXCJyb3V0ZXI6bmF2aWdhdGlvbjplcnJvclwiIC8qIEVycm9yICovO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghcmVzdWx0LmNvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICBldmVudE5hbWUgPSBcInJvdXRlcjpuYXZpZ2F0aW9uOmNhbmNlbGVkXCIgLyogQ2FuY2VsZWQgKi87XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgcXVlcnlTdHJpbmcgPSBpbnN0cnVjdGlvbi5xdWVyeVN0cmluZyA/ICgnPycgKyBpbnN0cnVjdGlvbi5xdWVyeVN0cmluZykgOiAnJztcclxuICAgICAgICAgICAgcm91dGVyLmhpc3RvcnkucHJldmlvdXNMb2NhdGlvbiA9IGluc3RydWN0aW9uLmZyYWdtZW50ICsgcXVlcnlTdHJpbmc7XHJcbiAgICAgICAgICAgIGV2ZW50TmFtZSA9IFwicm91dGVyOm5hdmlnYXRpb246c3VjY2Vzc1wiIC8qIFN1Y2Nlc3MgKi87XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV2ZW50QWdncmVnYXRvci5wdWJsaXNoKGV2ZW50TmFtZSwgZXZlbnRBcmdzKTtcclxuICAgICAgICBldmVudEFnZ3JlZ2F0b3IucHVibGlzaChcInJvdXRlcjpuYXZpZ2F0aW9uOmNvbXBsZXRlXCIgLyogQ29tcGxldGUgKi8sIGV2ZW50QXJncyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBldmVudEFnZ3JlZ2F0b3IucHVibGlzaChcInJvdXRlcjpuYXZpZ2F0aW9uOmNoaWxkOmNvbXBsZXRlXCIgLyogQ2hpbGRDb21wbGV0ZSAqLywgZXZlbnRBcmdzKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn07XHJcbmNvbnN0IHJlc3RvcmVQcmV2aW91c0xvY2F0aW9uID0gKHJvdXRlcikgPT4ge1xyXG4gICAgbGV0IHByZXZpb3VzTG9jYXRpb24gPSByb3V0ZXIuaGlzdG9yeS5wcmV2aW91c0xvY2F0aW9uO1xyXG4gICAgaWYgKHByZXZpb3VzTG9jYXRpb24pIHtcclxuICAgICAgICByb3V0ZXIubmF2aWdhdGUocHJldmlvdXNMb2NhdGlvbiwgeyB0cmlnZ2VyOiBmYWxzZSwgcmVwbGFjZTogdHJ1ZSB9KTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHJvdXRlci5mYWxsYmFja1JvdXRlKSB7XHJcbiAgICAgICAgcm91dGVyLm5hdmlnYXRlKHJvdXRlci5mYWxsYmFja1JvdXRlLCB7IHRyaWdnZXI6IHRydWUsIHJlcGxhY2U6IHRydWUgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBsb2dnZXIuZXJyb3IoJ1JvdXRlciBuYXZpZ2F0aW9uIGZhaWxlZCwgYW5kIG5vIHByZXZpb3VzIGxvY2F0aW9uIG9yIGZhbGxiYWNrUm91dGUgY291bGQgYmUgcmVzdG9yZWQuJyk7XHJcbiAgICB9XHJcbn07XG5cbi8qKlxyXG4qIFRoZSBzdGF0dXMgb2YgYSBQaXBlbGluZS5cclxuKi9cclxudmFyIFBpcGVsaW5lU3RhdHVzO1xyXG4oZnVuY3Rpb24gKFBpcGVsaW5lU3RhdHVzKSB7XHJcbiAgICBQaXBlbGluZVN0YXR1c1tcIkNvbXBsZXRlZFwiXSA9IFwiY29tcGxldGVkXCI7XHJcbiAgICBQaXBlbGluZVN0YXR1c1tcIkNhbmNlbGVkXCJdID0gXCJjYW5jZWxlZFwiO1xyXG4gICAgUGlwZWxpbmVTdGF0dXNbXCJSZWplY3RlZFwiXSA9IFwicmVqZWN0ZWRcIjtcclxuICAgIFBpcGVsaW5lU3RhdHVzW1wiUnVubmluZ1wiXSA9IFwicnVubmluZ1wiO1xyXG59KShQaXBlbGluZVN0YXR1cyB8fCAoUGlwZWxpbmVTdGF0dXMgPSB7fSkpO1xuXG4vKipcclxuICogQSBsaXN0IG9mIGtub3duIHJvdXRlciBldmVudHMgdXNlZCBieSB0aGUgQXVyZWxpYSByb3V0ZXJcclxuICogdG8gc2lnbmFsIHRoZSBwaXBlbGluZSBoYXMgY29tZSB0byBhIGNlcnRhaW4gc3RhdGVcclxuICovXHJcbi8vIGNvbnN0IGVudW0gaXMgcHJlc2VydmVkIGluIHRzY29uZmlnXHJcbnZhciBSb3V0ZXJFdmVudDtcclxuKGZ1bmN0aW9uIChSb3V0ZXJFdmVudCkge1xyXG4gICAgUm91dGVyRXZlbnRbXCJQcm9jZXNzaW5nXCJdID0gXCJyb3V0ZXI6bmF2aWdhdGlvbjpwcm9jZXNzaW5nXCI7XHJcbiAgICBSb3V0ZXJFdmVudFtcIkVycm9yXCJdID0gXCJyb3V0ZXI6bmF2aWdhdGlvbjplcnJvclwiO1xyXG4gICAgUm91dGVyRXZlbnRbXCJDYW5jZWxlZFwiXSA9IFwicm91dGVyOm5hdmlnYXRpb246Y2FuY2VsZWRcIjtcclxuICAgIFJvdXRlckV2ZW50W1wiQ29tcGxldGVcIl0gPSBcInJvdXRlcjpuYXZpZ2F0aW9uOmNvbXBsZXRlXCI7XHJcbiAgICBSb3V0ZXJFdmVudFtcIlN1Y2Nlc3NcIl0gPSBcInJvdXRlcjpuYXZpZ2F0aW9uOnN1Y2Nlc3NcIjtcclxuICAgIFJvdXRlckV2ZW50W1wiQ2hpbGRDb21wbGV0ZVwiXSA9IFwicm91dGVyOm5hdmlnYXRpb246Y2hpbGQ6Y29tcGxldGVcIjtcclxufSkoUm91dGVyRXZlbnQgfHwgKFJvdXRlckV2ZW50ID0ge30pKTtcblxuLyoqXHJcbiAqIEF2YWlsYWJsZSBwaXBlbGluZSBzbG90IG5hbWVzIHRvIGluc2VydCBpbnRlcmNlcHRvciBpbnRvIHJvdXRlciBwaXBlbGluZVxyXG4gKi9cclxuLy8gY29uc3QgZW51bSBpcyBwcmVzZXJ2ZWQgaW4gdHNjb25maWdcclxudmFyIFBpcGVsaW5lU2xvdE5hbWU7XHJcbihmdW5jdGlvbiAoUGlwZWxpbmVTbG90TmFtZSkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBBdXRob3JpemF0aW9uIHNsb3QuIEludm9rZWQgZWFybHkgaW4gdGhlIHBpcGVsaW5lLFxyXG4gICAgICogYmVmb3JlIGBjYW5BY3RpdmF0ZWAgaG9vayBvZiBpbmNvbWluZyByb3V0ZVxyXG4gICAgICovXHJcbiAgICBQaXBlbGluZVNsb3ROYW1lW1wiQXV0aG9yaXplXCJdID0gXCJhdXRob3JpemVcIjtcclxuICAgIC8qKlxyXG4gICAgICogUHJlLWFjdGl2YXRpb24gc2xvdC4gSW52b2tlZCBlYXJseSBpbiB0aGUgcGlwZWxpbmUsXHJcbiAgICAgKiBJbnZva2VkIHRpbWluZzpcclxuICAgICAqICAgLSBhZnRlciBBdXRob3JpemF0aW9uIHNsb3RcclxuICAgICAqICAgLSBhZnRlciBjYW5BY3RpdmF0ZSBob29rIG9uIG5ldyB2aWV3IG1vZGVsXHJcbiAgICAgKiAgIC0gYmVmb3JlIGRlYWN0aXZhdGUgaG9vayBvbiBvbGQgdmlldyBtb2RlbFxyXG4gICAgICogICAtIGJlZm9yZSBhY3RpdmF0ZSBob29rIG9uIG5ldyB2aWV3IG1vZGVsXHJcbiAgICAgKi9cclxuICAgIFBpcGVsaW5lU2xvdE5hbWVbXCJQcmVBY3RpdmF0ZVwiXSA9IFwicHJlQWN0aXZhdGVcIjtcclxuICAgIC8qKlxyXG4gICAgICogUHJlLXJlbmRlciBzbG90LiBJbnZva2VkIGxhdGVyIGluIHRoZSBwaXBlbGluZVxyXG4gICAgICogSW52b2tjYXRpb24gdGltaW5nOlxyXG4gICAgICogICAtIGFmdGVyIGFjdGl2YXRlIGhvb2sgb24gbmV3IHZpZXcgbW9kZWxcclxuICAgICAqICAgLSBiZWZvcmUgY29tbWl0IHN0ZXAgb24gbmV3IG5hdmlnYXRpb24gaW5zdHJ1Y3Rpb25cclxuICAgICAqL1xyXG4gICAgUGlwZWxpbmVTbG90TmFtZVtcIlByZVJlbmRlclwiXSA9IFwicHJlUmVuZGVyXCI7XHJcbiAgICAvKipcclxuICAgICAqIFBvc3QtcmVuZGVyIHNsb3QuIEludm9rZWQgbGFzdCBpbiB0aGUgcGlwZWxpbmVcclxuICAgICAqL1xyXG4gICAgUGlwZWxpbmVTbG90TmFtZVtcIlBvc3RSZW5kZXJcIl0gPSBcInBvc3RSZW5kZXJcIjtcclxufSkoUGlwZWxpbmVTbG90TmFtZSB8fCAoUGlwZWxpbmVTbG90TmFtZSA9IHt9KSk7XG5cbmV4cG9ydCB7IEFjdGl2YXRlTmV4dFN0ZXAsIEFwcFJvdXRlciwgQnVpbGROYXZpZ2F0aW9uUGxhblN0ZXAsIENhbkFjdGl2YXRlTmV4dFN0ZXAsIENhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXAsIENvbW1pdENoYW5nZXNTdGVwLCBEZWFjdGl2YXRlUHJldmlvdXNTdGVwLCBMb2FkUm91dGVTdGVwLCBOYXZNb2RlbCwgTmF2aWdhdGlvbkluc3RydWN0aW9uLCBQaXBlbGluZSwgUGlwZWxpbmVQcm92aWRlciwgUGlwZWxpbmVTbG90TmFtZSwgUGlwZWxpbmVTdGF0dXMsIFJlZGlyZWN0LCBSZWRpcmVjdFRvUm91dGUsIFJvdXRlTG9hZGVyLCBSb3V0ZXIsIFJvdXRlckNvbmZpZ3VyYXRpb24sIFJvdXRlckV2ZW50LCBhY3RpdmF0aW9uU3RyYXRlZ3ksIGlzTmF2aWdhdGlvbkNvbW1hbmQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cmVsaWEtcm91dGVyLmpzLm1hcFxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtcm91dGVyL2Rpc3QvZXMyMDE1L2F1cmVsaWEtcm91dGVyLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLXJvdXRlclxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJ2YXIgX2NsYXNzLCBfdGVtcCwgX2RlYywgX2NsYXNzMiwgX2RlYzIsIF9jbGFzczMsIF9jbGFzczQsIF90ZW1wMiwgX2NsYXNzNSwgX3RlbXAzO1xuXG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cblxuXG5pbXBvcnQgKiBhcyBMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5pbXBvcnQgeyBjYW1lbENhc2UsIFNWR0FuYWx5emVyLCBiaW5kaW5nTW9kZSwgY29ubmVjdGFibGUsIGVucXVldWVCaW5kaW5nQ29ubmVjdCwgc291cmNlQ29udGV4dCwgUGFyc2VyLCBPYnNlcnZlckxvY2F0b3IsIEV2ZW50TWFuYWdlciwgTGlzdGVuZXJFeHByZXNzaW9uLCBCaW5kaW5nRXhwcmVzc2lvbiwgQ2FsbEV4cHJlc3Npb24sIGRlbGVnYXRpb25TdHJhdGVneSwgTmFtZUV4cHJlc3Npb24sIExpdGVyYWxTdHJpbmcgfSBmcm9tICdhdXJlbGlhLWJpbmRpbmcnO1xuaW1wb3J0IHsgQmVoYXZpb3JJbnN0cnVjdGlvbiwgQmluZGluZ0xhbmd1YWdlIH0gZnJvbSAnYXVyZWxpYS10ZW1wbGF0aW5nJztcblxuZXhwb3J0IHZhciBBdHRyaWJ1dGVNYXAgPSAoX3RlbXAgPSBfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF0dHJpYnV0ZU1hcChzdmcpIHtcbiAgICBcblxuICAgIHRoaXMuZWxlbWVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHRoaXMuYWxsRWxlbWVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgdGhpcy5zdmcgPSBzdmc7XG5cbiAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCdhY2Nlc3NrZXknLCAnYWNjZXNzS2V5Jyk7XG4gICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgnY29udGVudGVkaXRhYmxlJywgJ2NvbnRlbnRFZGl0YWJsZScpO1xuICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3RhYmluZGV4JywgJ3RhYkluZGV4Jyk7XG4gICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgndGV4dGNvbnRlbnQnLCAndGV4dENvbnRlbnQnKTtcbiAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCdpbm5lcmh0bWwnLCAnaW5uZXJIVE1MJyk7XG4gICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgnc2Nyb2xsdG9wJywgJ3Njcm9sbFRvcCcpO1xuICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3Njcm9sbGxlZnQnLCAnc2Nyb2xsTGVmdCcpO1xuICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3JlYWRvbmx5JywgJ3JlYWRPbmx5Jyk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyKCdsYWJlbCcsICdmb3InLCAnaHRtbEZvcicpO1xuXG4gICAgdGhpcy5yZWdpc3RlcignaW1nJywgJ3VzZW1hcCcsICd1c2VNYXAnKTtcblxuICAgIHRoaXMucmVnaXN0ZXIoJ2lucHV0JywgJ21heGxlbmd0aCcsICdtYXhMZW5ndGgnKTtcbiAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdtaW5sZW5ndGgnLCAnbWluTGVuZ3RoJyk7XG4gICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnZm9ybWFjdGlvbicsICdmb3JtQWN0aW9uJyk7XG4gICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnZm9ybWVuY3R5cGUnLCAnZm9ybUVuY1R5cGUnKTtcbiAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdmb3JtbWV0aG9kJywgJ2Zvcm1NZXRob2QnKTtcbiAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdmb3Jtbm92YWxpZGF0ZScsICdmb3JtTm9WYWxpZGF0ZScpO1xuICAgIHRoaXMucmVnaXN0ZXIoJ2lucHV0JywgJ2Zvcm10YXJnZXQnLCAnZm9ybVRhcmdldCcpO1xuXG4gICAgdGhpcy5yZWdpc3RlcigndGV4dGFyZWEnLCAnbWF4bGVuZ3RoJywgJ21heExlbmd0aCcpO1xuXG4gICAgdGhpcy5yZWdpc3RlcigndGQnLCAncm93c3BhbicsICdyb3dTcGFuJyk7XG4gICAgdGhpcy5yZWdpc3RlcigndGQnLCAnY29sc3BhbicsICdjb2xTcGFuJyk7XG4gICAgdGhpcy5yZWdpc3RlcigndGgnLCAncm93c3BhbicsICdyb3dTcGFuJyk7XG4gICAgdGhpcy5yZWdpc3RlcigndGgnLCAnY29sc3BhbicsICdjb2xTcGFuJyk7XG4gIH1cblxuICBBdHRyaWJ1dGVNYXAucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXIoZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIHByb3BlcnR5TmFtZSkge1xuICAgIGVsZW1lbnROYW1lID0gZWxlbWVudE5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50c1tlbGVtZW50TmFtZV0gPSB0aGlzLmVsZW1lbnRzW2VsZW1lbnROYW1lXSB8fCBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIGVsZW1lbnRbYXR0cmlidXRlTmFtZV0gPSBwcm9wZXJ0eU5hbWU7XG4gIH07XG5cbiAgQXR0cmlidXRlTWFwLnByb3RvdHlwZS5yZWdpc3RlclVuaXZlcnNhbCA9IGZ1bmN0aW9uIHJlZ2lzdGVyVW5pdmVyc2FsKGF0dHJpYnV0ZU5hbWUsIHByb3BlcnR5TmFtZSkge1xuICAgIGF0dHJpYnV0ZU5hbWUgPSBhdHRyaWJ1dGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgdGhpcy5hbGxFbGVtZW50c1thdHRyaWJ1dGVOYW1lXSA9IHByb3BlcnR5TmFtZTtcbiAgfTtcblxuICBBdHRyaWJ1dGVNYXAucHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uIG1hcChlbGVtZW50TmFtZSwgYXR0cmlidXRlTmFtZSkge1xuICAgIGlmICh0aGlzLnN2Zy5pc1N0YW5kYXJkU3ZnQXR0cmlidXRlKGVsZW1lbnROYW1lLCBhdHRyaWJ1dGVOYW1lKSkge1xuICAgICAgcmV0dXJuIGF0dHJpYnV0ZU5hbWU7XG4gICAgfVxuICAgIGVsZW1lbnROYW1lID0gZWxlbWVudE5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50c1tlbGVtZW50TmFtZV07XG4gICAgaWYgKGVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBhdHRyaWJ1dGVOYW1lIGluIGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50W2F0dHJpYnV0ZU5hbWVdO1xuICAgIH1cbiAgICBpZiAoYXR0cmlidXRlTmFtZSBpbiB0aGlzLmFsbEVsZW1lbnRzKSB7XG4gICAgICByZXR1cm4gdGhpcy5hbGxFbGVtZW50c1thdHRyaWJ1dGVOYW1lXTtcbiAgICB9XG5cbiAgICBpZiAoLyg/Ol5kYXRhLSl8KD86XmFyaWEtKXw6Ly50ZXN0KGF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICByZXR1cm4gYXR0cmlidXRlTmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIGNhbWVsQ2FzZShhdHRyaWJ1dGVOYW1lKTtcbiAgfTtcblxuICByZXR1cm4gQXR0cmlidXRlTWFwO1xufSgpLCBfY2xhc3MuaW5qZWN0ID0gW1NWR0FuYWx5emVyXSwgX3RlbXApO1xuXG5leHBvcnQgdmFyIEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uKG9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHBhcnRzLCBtb2RlLCBsb29rdXBGdW5jdGlvbnMsIGF0dHJpYnV0ZSkge1xuICAgIFxuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xuICAgIHRoaXMucGFydHMgPSBwYXJ0cztcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICAgIHRoaXMuYXR0cmlidXRlID0gdGhpcy5hdHRyVG9SZW1vdmUgPSBhdHRyaWJ1dGU7XG4gICAgdGhpcy5kaXNjcmV0ZSA9IGZhbHNlO1xuICB9XG5cbiAgSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZyh0YXJnZXQpIHtcbiAgICBpZiAodGhpcy5wYXJ0cy5sZW5ndGggPT09IDMpIHtcbiAgICAgIHJldHVybiBuZXcgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyh0YXJnZXQsIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLnBhcnRzWzFdLCB0aGlzLm1vZGUsIHRoaXMubG9va3VwRnVuY3Rpb25zLCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLnBhcnRzWzBdLCB0aGlzLnBhcnRzWzJdKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbnRlcnBvbGF0aW9uQmluZGluZyh0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5wYXJ0cywgdGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLm1vZGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICByZXR1cm4gSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uO1xufSgpO1xuXG5mdW5jdGlvbiB2YWxpZGF0ZVRhcmdldCh0YXJnZXQsIHByb3BlcnR5TmFtZSkge1xuICBpZiAocHJvcGVydHlOYW1lID09PSAnc3R5bGUnKSB7XG4gICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmctYmluZGluZycpLmluZm8oJ0ludGVybmV0IEV4cGxvcmVyIGRvZXMgbm90IHN1cHBvcnQgaW50ZXJwb2xhdGlvbiBpbiBcInN0eWxlXCIgYXR0cmlidXRlcy4gIFVzZSB0aGUgc3R5bGUgYXR0cmlidXRlXFwncyBhbGlhcywgXCJjc3NcIiBpbnN0ZWFkLicpO1xuICB9IGVsc2UgaWYgKHRhcmdldC5wYXJlbnRFbGVtZW50ICYmIHRhcmdldC5wYXJlbnRFbGVtZW50Lm5vZGVOYW1lID09PSAnVEVYVEFSRUEnICYmIHByb3BlcnR5TmFtZSA9PT0gJ3RleHRDb250ZW50Jykge1xuICAgIHRocm93IG5ldyBFcnJvcignSW50ZXJwb2xhdGlvbiBiaW5kaW5nIGNhbm5vdCBiZSB1c2VkIGluIHRoZSBjb250ZW50IG9mIGEgdGV4dGFyZWEgZWxlbWVudC4gIFVzZSA8dGV4dGFyZWEgdmFsdWUuYmluZD1cImV4cHJlc3Npb25cIj48L3RleHRhcmVhPiBpbnN0ZWFkLicpO1xuICB9XG59XG5cbmV4cG9ydCB2YXIgSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEludGVycG9sYXRpb25CaW5kaW5nKG9ic2VydmVyTG9jYXRvciwgcGFydHMsIHRhcmdldCwgdGFyZ2V0UHJvcGVydHksIG1vZGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdmFsaWRhdGVUYXJnZXQodGFyZ2V0LCB0YXJnZXRQcm9wZXJ0eSk7XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy5wYXJ0cyA9IHBhcnRzO1xuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcbiAgICB0aGlzLnRhcmdldEFjY2Vzc29yID0gb2JzZXJ2ZXJMb2NhdG9yLmdldEFjY2Vzc29yKHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xuICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiBpbnRlcnBvbGF0ZSgpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICB2YXIgdmFsdWUgPSAnJztcbiAgICAgIHZhciBwYXJ0cyA9IHRoaXMucGFydHM7XG4gICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBwYXJ0cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7XG4gICAgICAgIHZhbHVlICs9IGkgJSAyID09PSAwID8gcGFydHNbaV0gOiB0aGlzWydjaGlsZEJpbmRpbmcnICsgaV0udmFsdWU7XG4gICAgICB9XG4gICAgICB0aGlzLnRhcmdldEFjY2Vzc29yLnNldFZhbHVlKHZhbHVlLCB0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSk7XG4gICAgfVxuICB9O1xuXG4gIEludGVycG9sYXRpb25CaW5kaW5nLnByb3RvdHlwZS51cGRhdGVPbmVUaW1lQmluZGluZ3MgPSBmdW5jdGlvbiB1cGRhdGVPbmVUaW1lQmluZGluZ3MoKSB7XG4gICAgZm9yICh2YXIgaSA9IDEsIGlpID0gdGhpcy5wYXJ0cy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7XG4gICAgICB2YXIgY2hpbGQgPSB0aGlzWydjaGlsZEJpbmRpbmcnICsgaV07XG4gICAgICBpZiAoY2hpbGQubW9kZSA9PT0gYmluZGluZ01vZGUub25lVGltZSkge1xuICAgICAgICBjaGlsZC5jYWxsKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEludGVycG9sYXRpb25CaW5kaW5nLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblxuICAgIHZhciBwYXJ0cyA9IHRoaXMucGFydHM7XG4gICAgZm9yICh2YXIgaSA9IDEsIGlpID0gcGFydHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikge1xuICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyh0aGlzLCB0aGlzLm9ic2VydmVyTG9jYXRvciwgcGFydHNbaV0sIHRoaXMubW9kZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgYmluZGluZy5iaW5kKHNvdXJjZSk7XG4gICAgICB0aGlzWydjaGlsZEJpbmRpbmcnICsgaV0gPSBiaW5kaW5nO1xuICAgIH1cblxuICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XG4gICAgdGhpcy5pbnRlcnBvbGF0ZSgpO1xuICB9O1xuXG4gIEludGVycG9sYXRpb25CaW5kaW5nLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHZhciBwYXJ0cyA9IHRoaXMucGFydHM7XG4gICAgZm9yICh2YXIgaSA9IDEsIGlpID0gcGFydHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikge1xuICAgICAgdmFyIG5hbWUgPSAnY2hpbGRCaW5kaW5nJyArIGk7XG4gICAgICB0aGlzW25hbWVdLnVuYmluZCgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gSW50ZXJwb2xhdGlvbkJpbmRpbmc7XG59KCk7XG5cbmV4cG9ydCB2YXIgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyA9IChfZGVjID0gY29ubmVjdGFibGUoKSwgX2RlYyhfY2xhc3MyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nKHRhcmdldCwgb2JzZXJ2ZXJMb2NhdG9yLCBzb3VyY2VFeHByZXNzaW9uLCBtb2RlLCBsb29rdXBGdW5jdGlvbnMsIHRhcmdldFByb3BlcnR5LCBsZWZ0LCByaWdodCkge1xuICAgIFxuXG4gICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEludGVycG9sYXRpb25CaW5kaW5nKSB7XG4gICAgICB0aGlzLnBhcmVudCA9IHRhcmdldDtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsaWRhdGVUYXJnZXQodGFyZ2V0LCB0YXJnZXRQcm9wZXJ0eSk7XG4gICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcbiAgICAgIHRoaXMudGFyZ2V0QWNjZXNzb3IgPSBvYnNlcnZlckxvY2F0b3IuZ2V0QWNjZXNzb3IodGFyZ2V0LCB0YXJnZXRQcm9wZXJ0eSk7XG4gICAgfVxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgICB0aGlzLmxlZnQgPSBsZWZ0O1xuICAgIHRoaXMucmlnaHQgPSByaWdodDtcbiAgfVxuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVwZGF0ZVRhcmdldCA9IGZ1bmN0aW9uIHVwZGF0ZVRhcmdldCh2YWx1ZSkge1xuICAgIHZhbHVlID0gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/ICcnIDogdmFsdWUudG9TdHJpbmcoKTtcbiAgICBpZiAodmFsdWUgIT09IHRoaXMudmFsdWUpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgIGlmICh0aGlzLnBhcmVudCkge1xuICAgICAgICB0aGlzLnBhcmVudC5pbnRlcnBvbGF0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50YXJnZXRBY2Nlc3Nvci5zZXRWYWx1ZSh0aGlzLmxlZnQgKyB2YWx1ZSArIHRoaXMucmlnaHQsIHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5KTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnJhd1ZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgdGhpcy51cGRhdGVUYXJnZXQodGhpcy5yYXdWYWx1ZSk7XG5cbiAgICBpZiAodGhpcy5tb2RlICE9PSBiaW5kaW5nTW9kZS5vbmVUaW1lKSB7XG4gICAgICB0aGlzLl92ZXJzaW9uKys7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNvdXJjZSk7XG4gICAgICBpZiAodGhpcy5yYXdWYWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZUFycmF5KHRoaXMucmF3VmFsdWUpO1xuICAgICAgfVxuICAgICAgdGhpcy51bm9ic2VydmUoZmFsc2UpO1xuICAgIH1cbiAgfTtcblxuICBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXG4gICAgdmFyIHNvdXJjZUV4cHJlc3Npb24gPSB0aGlzLnNvdXJjZUV4cHJlc3Npb247XG4gICAgaWYgKHNvdXJjZUV4cHJlc3Npb24uYmluZCkge1xuICAgICAgc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cblxuICAgIHRoaXMucmF3VmFsdWUgPSBzb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIHRoaXMudXBkYXRlVGFyZ2V0KHRoaXMucmF3VmFsdWUpO1xuXG4gICAgaWYgKHRoaXMubW9kZSA9PT0gYmluZGluZ01vZGUub25lV2F5KSB7XG4gICAgICBlbnF1ZXVlQmluZGluZ0Nvbm5lY3QodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB2YXIgc291cmNlRXhwcmVzc2lvbiA9IHRoaXMuc291cmNlRXhwcmVzc2lvbjtcbiAgICBpZiAoc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHRoaXMudmFsdWUgPSBudWxsO1xuICAgIHRoaXMucmF3VmFsdWUgPSBudWxsO1xuICAgIHRoaXMudW5vYnNlcnZlKHRydWUpO1xuICB9O1xuXG4gIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGV2YWx1YXRlKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2YWx1YXRlKSB7XG4gICAgICB0aGlzLnJhd1ZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICB0aGlzLnVwZGF0ZVRhcmdldCh0aGlzLnJhd1ZhbHVlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIGlmICh0aGlzLnJhd1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHRoaXMub2JzZXJ2ZUFycmF5KHRoaXMucmF3VmFsdWUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZztcbn0oKSkgfHwgX2NsYXNzMik7XG5cbmV4cG9ydCB2YXIgTGV0RXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGV0RXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBzb3VyY2VFeHByZXNzaW9uLCBsb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpIHtcbiAgICBcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XG4gIH1cblxuICBMZXRFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZygpIHtcbiAgICByZXR1cm4gbmV3IExldEJpbmRpbmcodGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuc291cmNlRXhwcmVzc2lvbiwgdGhpcy50YXJnZXRQcm9wZXJ0eSwgdGhpcy5sb29rdXBGdW5jdGlvbnMsIHRoaXMudG9CaW5kaW5nQ29udGV4dCk7XG4gIH07XG5cbiAgcmV0dXJuIExldEV4cHJlc3Npb247XG59KCk7XG5cbmV4cG9ydCB2YXIgTGV0QmluZGluZyA9IChfZGVjMiA9IGNvbm5lY3RhYmxlKCksIF9kZWMyKF9jbGFzczMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExldEJpbmRpbmcob2JzZXJ2ZXJMb2NhdG9yLCBzb3VyY2VFeHByZXNzaW9uLCB0YXJnZXRQcm9wZXJ0eSwgbG9va3VwRnVuY3Rpb25zLCB0b0JpbmRpbmdDb250ZXh0KSB7XG4gICAgXG5cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XG4gIH1cblxuICBMZXRCaW5kaW5nLnByb3RvdHlwZS51cGRhdGVUYXJnZXQgPSBmdW5jdGlvbiB1cGRhdGVUYXJnZXQoKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgdGhpcy50YXJnZXRbdGhpcy50YXJnZXRQcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgfTtcblxuICBMZXRCaW5kaW5nLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbChjb250ZXh0KSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQgPT09IHNvdXJjZUNvbnRleHQpIHtcbiAgICAgIHRoaXMudXBkYXRlVGFyZ2V0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBjYWxsIGNvbnRleHQgJyArIGNvbnRleHQpO1xuICB9O1xuXG4gIExldEJpbmRpbmcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiBiaW5kKHNvdXJjZSkge1xuICAgIGlmICh0aGlzLmlzQm91bmQpIHtcbiAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMudW5iaW5kKCk7XG4gICAgfVxuXG4gICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcbiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLnRhcmdldCA9IHRoaXMudG9CaW5kaW5nQ29udGV4dCA/IHNvdXJjZS5iaW5kaW5nQ29udGV4dCA6IHNvdXJjZS5vdmVycmlkZUNvbnRleHQ7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cblxuICAgIGVucXVldWVCaW5kaW5nQ29ubmVjdCh0aGlzKTtcbiAgfTtcblxuICBMZXRCaW5kaW5nLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi51bmJpbmQodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgIHRoaXMudW5vYnNlcnZlKHRydWUpO1xuICB9O1xuXG4gIExldEJpbmRpbmcucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMudXBkYXRlVGFyZ2V0KCk7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zb3VyY2UpO1xuICB9O1xuXG4gIHJldHVybiBMZXRCaW5kaW5nO1xufSgpKSB8fCBfY2xhc3MzKTtcblxuZXhwb3J0IHZhciBMZXRJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExldEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBwYXJ0cywgbG9va3VwRnVuY3Rpb25zLCB0b0JpbmRpbmdDb250ZXh0KSB7XG4gICAgXG5cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy5wYXJ0cyA9IHBhcnRzO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XG4gIH1cblxuICBMZXRJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24ucHJvdG90eXBlLmNyZWF0ZUJpbmRpbmcgPSBmdW5jdGlvbiBjcmVhdGVCaW5kaW5nKCkge1xuICAgIHJldHVybiBuZXcgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcodGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMudGFyZ2V0UHJvcGVydHksIHRoaXMucGFydHMsIHRoaXMubG9va3VwRnVuY3Rpb25zLCB0aGlzLnRvQmluZGluZ0NvbnRleHQpO1xuICB9O1xuXG4gIHJldHVybiBMZXRJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb247XG59KCk7XG5cbmV4cG9ydCB2YXIgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExldEludGVycG9sYXRpb25CaW5kaW5nKG9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHBhcnRzLCBsb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpIHtcbiAgICBcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMucGFydHMgPSBwYXJ0cztcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gICAgdGhpcy50b0JpbmRpbmdDb250ZXh0ID0gdG9CaW5kaW5nQ29udGV4dDtcbiAgICB0aGlzLnRhcmdldCA9IG51bGw7XG4gIH1cblxuICBMZXRJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoc291cmNlKSB7XG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgaWYgKHRoaXMuc291cmNlID09PSBzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy51bmJpbmQoKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgIHRoaXMudGFyZ2V0ID0gdGhpcy50b0JpbmRpbmdDb250ZXh0ID8gc291cmNlLmJpbmRpbmdDb250ZXh0IDogc291cmNlLm92ZXJyaWRlQ29udGV4dDtcblxuICAgIHRoaXMuaW50ZXJwb2xhdGlvbkJpbmRpbmcgPSB0aGlzLmNyZWF0ZUludGVycG9sYXRpb25CaW5kaW5nKCk7XG4gICAgdGhpcy5pbnRlcnBvbGF0aW9uQmluZGluZy5iaW5kKHNvdXJjZSk7XG4gIH07XG5cbiAgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgIHRoaXMuaW50ZXJwb2xhdGlvbkJpbmRpbmcudW5iaW5kKCk7XG4gICAgdGhpcy5pbnRlcnBvbGF0aW9uQmluZGluZyA9IG51bGw7XG4gIH07XG5cbiAgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmNyZWF0ZUludGVycG9sYXRpb25CaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlSW50ZXJwb2xhdGlvbkJpbmRpbmcoKSB7XG4gICAgaWYgKHRoaXMucGFydHMubGVuZ3RoID09PSAzKSB7XG4gICAgICByZXR1cm4gbmV3IENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcodGhpcy50YXJnZXQsIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLnBhcnRzWzFdLCBiaW5kaW5nTW9kZS5vbmVXYXksIHRoaXMubG9va3VwRnVuY3Rpb25zLCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLnBhcnRzWzBdLCB0aGlzLnBhcnRzWzJdKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbnRlcnBvbGF0aW9uQmluZGluZyh0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5wYXJ0cywgdGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHksIGJpbmRpbmdNb2RlLm9uZVdheSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIHJldHVybiBMZXRJbnRlcnBvbGF0aW9uQmluZGluZztcbn0oKTtcblxuZXhwb3J0IHZhciBTeW50YXhJbnRlcnByZXRlciA9IChfdGVtcDIgPSBfY2xhc3M0ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTeW50YXhJbnRlcnByZXRlcihwYXJzZXIsIG9ic2VydmVyTG9jYXRvciwgZXZlbnRNYW5hZ2VyLCBhdHRyaWJ1dGVNYXApIHtcbiAgICBcblxuICAgIHRoaXMucGFyc2VyID0gcGFyc2VyO1xuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICAgIHRoaXMuYXR0cmlidXRlTWFwID0gYXR0cmlidXRlTWFwO1xuICB9XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmludGVycHJldCA9IGZ1bmN0aW9uIGludGVycHJldChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpIHtcbiAgICBpZiAoaW5mby5jb21tYW5kIGluIHRoaXMpIHtcbiAgICAgIHJldHVybiB0aGlzW2luZm8uY29tbWFuZF0ocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5oYW5kbGVVbmtub3duQ29tbWFuZChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5oYW5kbGVVbmtub3duQ29tbWFuZCA9IGZ1bmN0aW9uIGhhbmRsZVVua25vd25Db21tYW5kKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xuICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nLWJpbmRpbmcnKS53YXJuKCdVbmtub3duIGJpbmRpbmcgY29tbWFuZC4nLCBpbmZvKTtcbiAgICByZXR1cm4gZXhpc3RpbmdJbnN0cnVjdGlvbjtcbiAgfTtcblxuICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuZGV0ZXJtaW5lRGVmYXVsdEJpbmRpbmdNb2RlID0gZnVuY3Rpb24gZGV0ZXJtaW5lRGVmYXVsdEJpbmRpbmdNb2RlKGVsZW1lbnQsIGF0dHJOYW1lLCBjb250ZXh0KSB7XG4gICAgdmFyIHRhZ05hbWUgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmICh0YWdOYW1lID09PSAnaW5wdXQnICYmIChhdHRyTmFtZSA9PT0gJ3ZhbHVlJyB8fCBhdHRyTmFtZSA9PT0gJ2ZpbGVzJykgJiYgZWxlbWVudC50eXBlICE9PSAnY2hlY2tib3gnICYmIGVsZW1lbnQudHlwZSAhPT0gJ3JhZGlvJyB8fCB0YWdOYW1lID09PSAnaW5wdXQnICYmIGF0dHJOYW1lID09PSAnY2hlY2tlZCcgJiYgKGVsZW1lbnQudHlwZSA9PT0gJ2NoZWNrYm94JyB8fCBlbGVtZW50LnR5cGUgPT09ICdyYWRpbycpIHx8ICh0YWdOYW1lID09PSAndGV4dGFyZWEnIHx8IHRhZ05hbWUgPT09ICdzZWxlY3QnKSAmJiBhdHRyTmFtZSA9PT0gJ3ZhbHVlJyB8fCAoYXR0ck5hbWUgPT09ICd0ZXh0Y29udGVudCcgfHwgYXR0ck5hbWUgPT09ICdpbm5lcmh0bWwnKSAmJiBlbGVtZW50LmNvbnRlbnRFZGl0YWJsZSA9PT0gJ3RydWUnIHx8IGF0dHJOYW1lID09PSAnc2Nyb2xsdG9wJyB8fCBhdHRyTmFtZSA9PT0gJ3Njcm9sbGxlZnQnKSB7XG4gICAgICByZXR1cm4gYmluZGluZ01vZGUudHdvV2F5O1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0ICYmIGF0dHJOYW1lIGluIGNvbnRleHQuYXR0cmlidXRlcyAmJiBjb250ZXh0LmF0dHJpYnV0ZXNbYXR0ck5hbWVdICYmIGNvbnRleHQuYXR0cmlidXRlc1thdHRyTmFtZV0uZGVmYXVsdEJpbmRpbmdNb2RlID49IGJpbmRpbmdNb2RlLm9uZVRpbWUpIHtcbiAgICAgIHJldHVybiBjb250ZXh0LmF0dHJpYnV0ZXNbYXR0ck5hbWVdLmRlZmF1bHRCaW5kaW5nTW9kZTtcbiAgICB9XG5cbiAgICByZXR1cm4gYmluZGluZ01vZGUub25lV2F5O1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBleGlzdGluZ0luc3RydWN0aW9uIHx8IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBCaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnQudGFnTmFtZSwgaW5mby5hdHRyTmFtZSksIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPT09IHVuZGVmaW5lZCB8fCBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9PT0gbnVsbCA/IHRoaXMuZGV0ZXJtaW5lRGVmYXVsdEJpbmRpbmdNb2RlKGVsZW1lbnQsIGluZm8uYXR0ck5hbWUsIGNvbnRleHQpIDogaW5mby5kZWZhdWx0QmluZGluZ01vZGUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xuXG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS50cmlnZ2VyID0gZnVuY3Rpb24gdHJpZ2dlcihyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8pIHtcbiAgICByZXR1cm4gbmV3IExpc3RlbmVyRXhwcmVzc2lvbih0aGlzLmV2ZW50TWFuYWdlciwgaW5mby5hdHRyTmFtZSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCBkZWxlZ2F0aW9uU3RyYXRlZ3kubm9uZSwgdHJ1ZSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmNhcHR1cmUgPSBmdW5jdGlvbiBjYXB0dXJlKHJlc291cmNlcywgZWxlbWVudCwgaW5mbykge1xuICAgIHJldHVybiBuZXcgTGlzdGVuZXJFeHByZXNzaW9uKHRoaXMuZXZlbnRNYW5hZ2VyLCBpbmZvLmF0dHJOYW1lLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGRlbGVnYXRpb25TdHJhdGVneS5jYXB0dXJpbmcsIHRydWUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5kZWxlZ2F0ZSA9IGZ1bmN0aW9uIGRlbGVnYXRlKHJlc291cmNlcywgZWxlbWVudCwgaW5mbykge1xuICAgIHJldHVybiBuZXcgTGlzdGVuZXJFeHByZXNzaW9uKHRoaXMuZXZlbnRNYW5hZ2VyLCBpbmZvLmF0dHJOYW1lLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGRlbGVnYXRpb25TdHJhdGVneS5idWJibGluZywgdHJ1ZSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG5cbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gbmV3IENhbGxFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCBpbmZvLmF0dHJOYW1lLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xuXG4gICAgcmV0dXJuIGluc3RydWN0aW9uO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5vcHRpb25zID0gZnVuY3Rpb24gb3B0aW9ucyhyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBleGlzdGluZ0luc3RydWN0aW9uIHx8IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuICAgIHZhciBhdHRyVmFsdWUgPSBpbmZvLmF0dHJWYWx1ZTtcbiAgICB2YXIgbGFuZ3VhZ2UgPSB0aGlzLmxhbmd1YWdlO1xuICAgIHZhciBuYW1lID0gbnVsbDtcbiAgICB2YXIgdGFyZ2V0ID0gJyc7XG4gICAgdmFyIGN1cnJlbnQgPSB2b2lkIDA7XG4gICAgdmFyIGkgPSB2b2lkIDA7XG4gICAgdmFyIGlpID0gdm9pZCAwO1xuICAgIHZhciBpblN0cmluZyA9IGZhbHNlO1xuICAgIHZhciBpbkVzY2FwZSA9IGZhbHNlO1xuICAgIHZhciBmb3VuZE5hbWUgPSBmYWxzZTtcblxuICAgIGZvciAoaSA9IDAsIGlpID0gYXR0clZhbHVlLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGN1cnJlbnQgPSBhdHRyVmFsdWVbaV07XG5cbiAgICAgIGlmIChjdXJyZW50ID09PSAnOycgJiYgIWluU3RyaW5nKSB7XG4gICAgICAgIGlmICghZm91bmROYW1lKSB7XG4gICAgICAgICAgbmFtZSA9IHRoaXMuX2dldFByaW1hcnlQcm9wZXJ0eU5hbWUocmVzb3VyY2VzLCBjb250ZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBpbmZvID0gbGFuZ3VhZ2UuaW5zcGVjdEF0dHJpYnV0ZShyZXNvdXJjZXMsICc/JywgbmFtZSwgdGFyZ2V0LnRyaW0oKSk7XG4gICAgICAgIGxhbmd1YWdlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgaW5zdHJ1Y3Rpb24sIGNvbnRleHQpO1xuXG4gICAgICAgIGlmICghaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSkge1xuICAgICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0gPSBpbmZvLmF0dHJWYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRhcmdldCA9ICcnO1xuICAgICAgICBuYW1lID0gbnVsbDtcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudCA9PT0gJzonICYmIG5hbWUgPT09IG51bGwpIHtcbiAgICAgICAgZm91bmROYW1lID0gdHJ1ZTtcbiAgICAgICAgbmFtZSA9IHRhcmdldC50cmltKCk7XG4gICAgICAgIHRhcmdldCA9ICcnO1xuICAgICAgfSBlbHNlIGlmIChjdXJyZW50ID09PSAnXFxcXCcpIHtcbiAgICAgICAgdGFyZ2V0ICs9IGN1cnJlbnQ7XG4gICAgICAgIGluRXNjYXBlID0gdHJ1ZTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXQgKz0gY3VycmVudDtcblxuICAgICAgICBpZiAobmFtZSAhPT0gbnVsbCAmJiBpbkVzY2FwZSA9PT0gZmFsc2UgJiYgY3VycmVudCA9PT0gJ1xcJycpIHtcbiAgICAgICAgICBpblN0cmluZyA9ICFpblN0cmluZztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpbkVzY2FwZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIGlmICghZm91bmROYW1lKSB7XG4gICAgICBuYW1lID0gdGhpcy5fZ2V0UHJpbWFyeVByb3BlcnR5TmFtZShyZXNvdXJjZXMsIGNvbnRleHQpO1xuICAgIH1cblxuICAgIGlmIChuYW1lICE9PSBudWxsKSB7XG4gICAgICBpbmZvID0gbGFuZ3VhZ2UuaW5zcGVjdEF0dHJpYnV0ZShyZXNvdXJjZXMsICc/JywgbmFtZSwgdGFyZ2V0LnRyaW0oKSk7XG4gICAgICBsYW5ndWFnZS5jcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGluc3RydWN0aW9uLCBjb250ZXh0KTtcblxuICAgICAgaWYgKCFpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdKSB7XG4gICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0gPSBpbmZvLmF0dHJWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLl9nZXRQcmltYXJ5UHJvcGVydHlOYW1lID0gZnVuY3Rpb24gX2dldFByaW1hcnlQcm9wZXJ0eU5hbWUocmVzb3VyY2VzLCBjb250ZXh0KSB7XG4gICAgdmFyIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGNvbnRleHQuYXR0cmlidXRlTmFtZSk7XG4gICAgaWYgKHR5cGUgJiYgdHlwZS5wcmltYXJ5UHJvcGVydHkpIHtcbiAgICAgIHJldHVybiB0eXBlLnByaW1hcnlQcm9wZXJ0eS5hdHRyaWJ1dGU7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZVsnZm9yJ10gPSBmdW5jdGlvbiBfZm9yKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xuICAgIHZhciBwYXJ0cyA9IHZvaWQgMDtcbiAgICB2YXIga2V5VmFsdWUgPSB2b2lkIDA7XG4gICAgdmFyIGluc3RydWN0aW9uID0gdm9pZCAwO1xuICAgIHZhciBhdHRyVmFsdWUgPSB2b2lkIDA7XG4gICAgdmFyIGlzRGVzdHJ1Y3R1cmluZyA9IHZvaWQgMDtcblxuICAgIGF0dHJWYWx1ZSA9IGluZm8uYXR0clZhbHVlO1xuICAgIGlzRGVzdHJ1Y3R1cmluZyA9IGF0dHJWYWx1ZS5tYXRjaCgvXiAqW1tdLitbXFxdXS8pO1xuICAgIHBhcnRzID0gaXNEZXN0cnVjdHVyaW5nID8gYXR0clZhbHVlLnNwbGl0KCdvZiAnKSA6IGF0dHJWYWx1ZS5zcGxpdCgnIG9mICcpO1xuXG4gICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbmNvcnJlY3Qgc3ludGF4IGZvciBcImZvclwiLiBUaGUgZm9ybSBpczogXCIkbG9jYWwgb2YgJGl0ZW1zXCIgb3IgXCJbJGtleSwgJHZhbHVlXSBvZiAkaXRlbXNcIi4nKTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG5cbiAgICBpZiAoaXNEZXN0cnVjdHVyaW5nKSB7XG4gICAgICBrZXlWYWx1ZSA9IHBhcnRzWzBdLnJlcGxhY2UoL1tbXFxdXS9nLCAnJykucmVwbGFjZSgvLC9nLCAnICcpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCkuc3BsaXQoJyAnKTtcbiAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXMua2V5ID0ga2V5VmFsdWVbMF07XG4gICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzLnZhbHVlID0ga2V5VmFsdWVbMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXMubG9jYWwgPSBwYXJ0c1swXTtcbiAgICB9XG5cbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzLml0ZW1zID0gbmV3IEJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCAnaXRlbXMnLCB0aGlzLnBhcnNlci5wYXJzZShwYXJ0c1sxXSksIGJpbmRpbmdNb2RlLm9uZVdheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWyd0d28td2F5J10gPSBmdW5jdGlvbiB0d29XYXkocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcblxuICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0gPSBuZXcgQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuYXR0cmlidXRlTWFwLm1hcChlbGVtZW50LnRhZ05hbWUsIGluZm8uYXR0ck5hbWUpLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGJpbmRpbmdNb2RlLnR3b1dheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWyd0by12aWV3J10gPSBmdW5jdGlvbiB0b1ZpZXcocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uKSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcblxuICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0gPSBuZXcgQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuYXR0cmlidXRlTWFwLm1hcChlbGVtZW50LnRhZ05hbWUsIGluZm8uYXR0ck5hbWUpLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGJpbmRpbmdNb2RlLnRvVmlldywgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWydmcm9tLXZpZXcnXSA9IGZ1bmN0aW9uIGZyb21WaWV3KHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xuICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XG5cbiAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gbmV3IEJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLmF0dHJpYnV0ZU1hcC5tYXAoZWxlbWVudC50YWdOYW1lLCBpbmZvLmF0dHJOYW1lKSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCBiaW5kaW5nTW9kZS5mcm9tVmlldywgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWydvbmUtdGltZSddID0gZnVuY3Rpb24gb25lVGltZShyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24pIHtcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBleGlzdGluZ0luc3RydWN0aW9uIHx8IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xuXG4gICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBCaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnQudGFnTmFtZSwgaW5mby5hdHRyTmFtZSksIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgYmluZGluZ01vZGUub25lVGltZSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgcmV0dXJuIFN5bnRheEludGVycHJldGVyO1xufSgpLCBfY2xhc3M0LmluamVjdCA9IFtQYXJzZXIsIE9ic2VydmVyTG9jYXRvciwgRXZlbnRNYW5hZ2VyLCBBdHRyaWJ1dGVNYXBdLCBfdGVtcDIpO1xuXG5TeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGVbJ29uZS13YXknXSA9IFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZVsndG8tdmlldyddO1xuXG52YXIgaW5mbyA9IHt9O1xuXG5leHBvcnQgdmFyIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UgPSAoX3RlbXAzID0gX2NsYXNzNSA9IGZ1bmN0aW9uIChfQmluZGluZ0xhbmd1YWdlKSB7XG4gIF9pbmhlcml0cyhUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlLCBfQmluZGluZ0xhbmd1YWdlKTtcblxuICBmdW5jdGlvbiBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlKHBhcnNlciwgb2JzZXJ2ZXJMb2NhdG9yLCBzeW50YXhJbnRlcnByZXRlciwgYXR0cmlidXRlTWFwKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfQmluZGluZ0xhbmd1YWdlLmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMucGFyc2VyID0gcGFyc2VyO1xuICAgIF90aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICBfdGhpcy5zeW50YXhJbnRlcnByZXRlciA9IHN5bnRheEludGVycHJldGVyO1xuICAgIF90aGlzLmVtcHR5U3RyaW5nRXhwcmVzc2lvbiA9IF90aGlzLnBhcnNlci5wYXJzZSgnXFwnXFwnJyk7XG4gICAgc3ludGF4SW50ZXJwcmV0ZXIubGFuZ3VhZ2UgPSBfdGhpcztcbiAgICBfdGhpcy5hdHRyaWJ1dGVNYXAgPSBhdHRyaWJ1dGVNYXA7XG4gICAgX3RoaXMudG9CaW5kaW5nQ29udGV4dEF0dHIgPSAndG8tYmluZGluZy1jb250ZXh0JztcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5pbnNwZWN0QXR0cmlidXRlID0gZnVuY3Rpb24gaW5zcGVjdEF0dHJpYnV0ZShyZXNvdXJjZXMsIGVsZW1lbnROYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKSB7XG4gICAgdmFyIHBhcnRzID0gYXR0ck5hbWUuc3BsaXQoJy4nKTtcblxuICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gbnVsbDtcblxuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGluZm8uYXR0ck5hbWUgPSBwYXJ0c1swXS50cmltKCk7XG4gICAgICBpbmZvLmF0dHJWYWx1ZSA9IGF0dHJWYWx1ZTtcbiAgICAgIGluZm8uY29tbWFuZCA9IHBhcnRzWzFdLnRyaW0oKTtcblxuICAgICAgaWYgKGluZm8uY29tbWFuZCA9PT0gJ3JlZicpIHtcbiAgICAgICAgaW5mby5leHByZXNzaW9uID0gbmV3IE5hbWVFeHByZXNzaW9uKHRoaXMucGFyc2VyLnBhcnNlKGF0dHJWYWx1ZSksIGluZm8uYXR0ck5hbWUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgICBpbmZvLmNvbW1hbmQgPSBudWxsO1xuICAgICAgICBpbmZvLmF0dHJOYW1lID0gJ3JlZic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbmZvLmV4cHJlc3Npb24gPSBudWxsO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYXR0ck5hbWUgPT09ICdyZWYnKSB7XG4gICAgICBpbmZvLmF0dHJOYW1lID0gYXR0ck5hbWU7XG4gICAgICBpbmZvLmF0dHJWYWx1ZSA9IGF0dHJWYWx1ZTtcbiAgICAgIGluZm8uY29tbWFuZCA9IG51bGw7XG4gICAgICBpbmZvLmV4cHJlc3Npb24gPSBuZXcgTmFtZUV4cHJlc3Npb24odGhpcy5wYXJzZXIucGFyc2UoYXR0clZhbHVlKSwgJ2VsZW1lbnQnLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5mby5hdHRyTmFtZSA9IGF0dHJOYW1lO1xuICAgICAgaW5mby5hdHRyVmFsdWUgPSBhdHRyVmFsdWU7XG4gICAgICBpbmZvLmNvbW1hbmQgPSBudWxsO1xuICAgICAgdmFyIGludGVycG9sYXRpb25QYXJ0cyA9IHRoaXMucGFyc2VJbnRlcnBvbGF0aW9uKHJlc291cmNlcywgYXR0clZhbHVlKTtcbiAgICAgIGlmIChpbnRlcnBvbGF0aW9uUGFydHMgPT09IG51bGwpIHtcbiAgICAgICAgaW5mby5leHByZXNzaW9uID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluZm8uZXhwcmVzc2lvbiA9IG5ldyBJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuYXR0cmlidXRlTWFwLm1hcChlbGVtZW50TmFtZSwgYXR0ck5hbWUpLCBpbnRlcnBvbGF0aW9uUGFydHMsIGJpbmRpbmdNb2RlLm9uZVdheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgYXR0ck5hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBpbmZvO1xuICB9O1xuXG4gIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uID0gZnVuY3Rpb24gY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBlbGVtZW50LCB0aGVJbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KSB7XG4gICAgdmFyIGluc3RydWN0aW9uID0gdm9pZCAwO1xuXG4gICAgaWYgKHRoZUluZm8uZXhwcmVzc2lvbikge1xuICAgICAgaWYgKHRoZUluZm8uYXR0ck5hbWUgPT09ICdyZWYnKSB7XG4gICAgICAgIHJldHVybiB0aGVJbmZvLmV4cHJlc3Npb247XG4gICAgICB9XG5cbiAgICAgIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZSh0aGVJbmZvLmF0dHJOYW1lKTtcbiAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbdGhlSW5mby5hdHRyTmFtZV0gPSB0aGVJbmZvLmV4cHJlc3Npb247XG4gICAgfSBlbHNlIGlmICh0aGVJbmZvLmNvbW1hbmQpIHtcbiAgICAgIGluc3RydWN0aW9uID0gdGhpcy5zeW50YXhJbnRlcnByZXRlci5pbnRlcnByZXQocmVzb3VyY2VzLCBlbGVtZW50LCB0aGVJbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XG4gIH07XG5cbiAgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuY3JlYXRlTGV0RXhwcmVzc2lvbnMgPSBmdW5jdGlvbiBjcmVhdGVMZXRFeHByZXNzaW9ucyhyZXNvdXJjZXMsIGxldEVsZW1lbnQpIHtcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBbXTtcbiAgICB2YXIgYXR0cmlidXRlcyA9IGxldEVsZW1lbnQuYXR0cmlidXRlcztcblxuICAgIHZhciBhdHRyID0gdm9pZCAwO1xuXG4gICAgdmFyIHBhcnRzID0gdm9pZCAwO1xuICAgIHZhciBhdHRyTmFtZSA9IHZvaWQgMDtcbiAgICB2YXIgYXR0clZhbHVlID0gdm9pZCAwO1xuICAgIHZhciBjb21tYW5kID0gdm9pZCAwO1xuICAgIHZhciB0b0JpbmRpbmdDb250ZXh0QXR0ciA9IHRoaXMudG9CaW5kaW5nQ29udGV4dEF0dHI7XG4gICAgdmFyIHRvQmluZGluZ0NvbnRleHQgPSBsZXRFbGVtZW50Lmhhc0F0dHJpYnV0ZSh0b0JpbmRpbmdDb250ZXh0QXR0cik7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYXR0cmlidXRlcy5sZW5ndGg7IGlpID4gaTsgKytpKSB7XG4gICAgICBhdHRyID0gYXR0cmlidXRlc1tpXTtcbiAgICAgIGF0dHJOYW1lID0gYXR0ci5uYW1lO1xuICAgICAgYXR0clZhbHVlID0gYXR0ci5ub2RlVmFsdWU7XG4gICAgICBwYXJ0cyA9IGF0dHJOYW1lLnNwbGl0KCcuJyk7XG5cbiAgICAgIGlmIChhdHRyTmFtZSA9PT0gdG9CaW5kaW5nQ29udGV4dEF0dHIpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgY29tbWFuZCA9IHBhcnRzWzFdO1xuICAgICAgICBpZiAoY29tbWFuZCAhPT0gJ2JpbmQnKSB7XG4gICAgICAgICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmctYmluZGluZy1sYW5ndWFnZScpLndhcm4oJ0RldGVjdGVkIGludmFsaWQgbGV0IGNvbW1hbmQuIEV4cGVjdGVkIFwiJyArIHBhcnRzWzBdICsgJy5iaW5kXCIsIGdpdmVuIFwiJyArIGF0dHJOYW1lICsgJ1wiJyk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgZXhwcmVzc2lvbnMucHVzaChuZXcgTGV0RXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgY2FtZWxDYXNlKHBhcnRzWzBdKSwgdGhpcy5wYXJzZXIucGFyc2UoYXR0clZhbHVlKSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgdG9CaW5kaW5nQ29udGV4dCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXR0ck5hbWUgPSBjYW1lbENhc2UoYXR0ck5hbWUpO1xuICAgICAgICBwYXJ0cyA9IHRoaXMucGFyc2VJbnRlcnBvbGF0aW9uKHJlc291cmNlcywgYXR0clZhbHVlKTtcbiAgICAgICAgaWYgKHBhcnRzID09PSBudWxsKSB7XG4gICAgICAgICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmctYmluZGluZy1sYW5ndWFnZScpLndhcm4oJ0RldGVjdGVkIHN0cmluZyBsaXRlcmFsIGluIGxldCBiaW5kaW5ncy4gRGlkIHlvdSBtZWFuIFwiJyArIGF0dHJOYW1lICsgJy5iaW5kPScgKyBhdHRyVmFsdWUgKyAnXCIgb3IgXCInICsgYXR0ck5hbWUgKyAnPSR7JyArIGF0dHJWYWx1ZSArICd9XCIgPycpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJ0cykge1xuICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2gobmV3IExldEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgYXR0ck5hbWUsIHBhcnRzLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zLCB0b0JpbmRpbmdDb250ZXh0KSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChuZXcgTGV0RXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgYXR0ck5hbWUsIG5ldyBMaXRlcmFsU3RyaW5nKGF0dHJWYWx1ZSksIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZXhwcmVzc2lvbnM7XG4gIH07XG5cbiAgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuaW5zcGVjdFRleHRDb250ZW50ID0gZnVuY3Rpb24gaW5zcGVjdFRleHRDb250ZW50KHJlc291cmNlcywgdmFsdWUpIHtcbiAgICB2YXIgcGFydHMgPSB0aGlzLnBhcnNlSW50ZXJwb2xhdGlvbihyZXNvdXJjZXMsIHZhbHVlKTtcbiAgICBpZiAocGFydHMgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgJ3RleHRDb250ZW50JywgcGFydHMsIGJpbmRpbmdNb2RlLm9uZVdheSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgJ3RleHRDb250ZW50Jyk7XG4gIH07XG5cbiAgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUucGFyc2VJbnRlcnBvbGF0aW9uID0gZnVuY3Rpb24gcGFyc2VJbnRlcnBvbGF0aW9uKHJlc291cmNlcywgdmFsdWUpIHtcbiAgICB2YXIgaSA9IHZhbHVlLmluZGV4T2YoJyR7JywgMCk7XG4gICAgdmFyIGlpID0gdmFsdWUubGVuZ3RoO1xuICAgIHZhciBjaGFyID0gdm9pZCAwO1xuICAgIHZhciBwb3MgPSAwO1xuICAgIHZhciBvcGVuID0gMDtcbiAgICB2YXIgcXVvdGUgPSBudWxsO1xuICAgIHZhciBpbnRlcnBvbGF0aW9uU3RhcnQgPSB2b2lkIDA7XG4gICAgdmFyIHBhcnRzID0gdm9pZCAwO1xuICAgIHZhciBwYXJ0SW5kZXggPSAwO1xuXG4gICAgd2hpbGUgKGkgPj0gMCAmJiBpIDwgaWkgLSAyKSB7XG4gICAgICBvcGVuID0gMTtcbiAgICAgIGludGVycG9sYXRpb25TdGFydCA9IGk7XG4gICAgICBpICs9IDI7XG5cbiAgICAgIGRvIHtcbiAgICAgICAgY2hhciA9IHZhbHVlW2ldO1xuICAgICAgICBpKys7XG5cbiAgICAgICAgaWYgKGNoYXIgPT09IFwiJ1wiIHx8IGNoYXIgPT09ICdcIicpIHtcbiAgICAgICAgICBpZiAocXVvdGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1b3RlID0gY2hhcjtcbiAgICAgICAgICB9IGVsc2UgaWYgKHF1b3RlID09PSBjaGFyKSB7XG4gICAgICAgICAgICBxdW90ZSA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoYXIgPT09ICdcXFxcJykge1xuICAgICAgICAgIGkrKztcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChxdW90ZSAhPT0gbnVsbCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoYXIgPT09ICd7Jykge1xuICAgICAgICAgIG9wZW4rKztcbiAgICAgICAgfSBlbHNlIGlmIChjaGFyID09PSAnfScpIHtcbiAgICAgICAgICBvcGVuLS07XG4gICAgICAgIH1cbiAgICAgIH0gd2hpbGUgKG9wZW4gPiAwICYmIGkgPCBpaSk7XG5cbiAgICAgIGlmIChvcGVuID09PSAwKSB7XG4gICAgICAgIHBhcnRzID0gcGFydHMgfHwgW107XG4gICAgICAgIGlmICh2YWx1ZVtpbnRlcnBvbGF0aW9uU3RhcnQgLSAxXSA9PT0gJ1xcXFwnICYmIHZhbHVlW2ludGVycG9sYXRpb25TdGFydCAtIDJdICE9PSAnXFxcXCcpIHtcbiAgICAgICAgICBwYXJ0c1twYXJ0SW5kZXhdID0gdmFsdWUuc3Vic3RyaW5nKHBvcywgaW50ZXJwb2xhdGlvblN0YXJ0IC0gMSkgKyB2YWx1ZS5zdWJzdHJpbmcoaW50ZXJwb2xhdGlvblN0YXJ0LCBpKTtcbiAgICAgICAgICBwYXJ0SW5kZXgrKztcbiAgICAgICAgICBwYXJ0c1twYXJ0SW5kZXhdID0gdGhpcy5lbXB0eVN0cmluZ0V4cHJlc3Npb247XG4gICAgICAgICAgcGFydEluZGV4Kys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFydHNbcGFydEluZGV4XSA9IHZhbHVlLnN1YnN0cmluZyhwb3MsIGludGVycG9sYXRpb25TdGFydCk7XG4gICAgICAgICAgcGFydEluZGV4Kys7XG4gICAgICAgICAgcGFydHNbcGFydEluZGV4XSA9IHRoaXMucGFyc2VyLnBhcnNlKHZhbHVlLnN1YnN0cmluZyhpbnRlcnBvbGF0aW9uU3RhcnQgKyAyLCBpIC0gMSkpO1xuICAgICAgICAgIHBhcnRJbmRleCsrO1xuICAgICAgICB9XG4gICAgICAgIHBvcyA9IGk7XG4gICAgICAgIGkgPSB2YWx1ZS5pbmRleE9mKCckeycsIGkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHBhcnRJbmRleCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcGFydHNbcGFydEluZGV4XSA9IHZhbHVlLnN1YnN0cihwb3MpO1xuICAgIHJldHVybiBwYXJ0cztcbiAgfTtcblxuICByZXR1cm4gVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZTtcbn0oQmluZGluZ0xhbmd1YWdlKSwgX2NsYXNzNS5pbmplY3QgPSBbUGFyc2VyLCBPYnNlcnZlckxvY2F0b3IsIFN5bnRheEludGVycHJldGVyLCBBdHRyaWJ1dGVNYXBdLCBfdGVtcDMpO1xuXG5leHBvcnQgZnVuY3Rpb24gY29uZmlndXJlKGNvbmZpZykge1xuICBjb25maWcuY29udGFpbmVyLnJlZ2lzdGVyU2luZ2xldG9uKEJpbmRpbmdMYW5ndWFnZSwgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZSk7XG4gIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJBbGlhcyhCaW5kaW5nTGFuZ3VhZ2UsIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UpO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZy9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtdGVtcGxhdGluZy1iaW5kaW5nLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZ1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJpbXBvcnQgeyBDb250YWluZXIsIGluamVjdCwgT3B0aW9uYWwgfSBmcm9tICdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJztcbmltcG9ydCB7IERPTSwgRkVBVFVSRSB9IGZyb20gJ2F1cmVsaWEtcGFsJztcbmltcG9ydCB7IFRhc2tRdWV1ZSB9IGZyb20gJ2F1cmVsaWEtdGFzay1xdWV1ZSc7XG5pbXBvcnQgeyBDb21wb3NpdGlvbkVuZ2luZSwgVmlld1Nsb3QsIFZpZXdSZXNvdXJjZXMsIGJpbmRhYmxlLCBub1ZpZXcsIGN1c3RvbUVsZW1lbnQsIGN1c3RvbUF0dHJpYnV0ZSwgdGVtcGxhdGVDb250cm9sbGVyLCBCb3VuZFZpZXdGYWN0b3J5LCBUYXJnZXRJbnN0cnVjdGlvbiwgQW5pbWF0b3IsIHJlc291cmNlLCB1c2VWaWV3LCB1c2VTaGFkb3dET00sIFZpZXdFbmdpbmUgfSBmcm9tICdhdXJlbGlhLXRlbXBsYXRpbmcnO1xuaW1wb3J0IHsgY3JlYXRlT3ZlcnJpZGVDb250ZXh0LCBiaW5kaW5nTW9kZSwgQmluZGluZ0JlaGF2aW9yLCBWYWx1ZUNvbnZlcnRlciwgc291cmNlQ29udGV4dCwgbWVyZ2VTcGxpY2UsIE9ic2VydmVyTG9jYXRvciwgdmFsdWVDb252ZXJ0ZXIsIERhdGFBdHRyaWJ1dGVPYnNlcnZlciwgYmluZGluZ0JlaGF2aW9yLCB0YXJnZXRDb250ZXh0LCBFdmVudFN1YnNjcmliZXIgfSBmcm9tICdhdXJlbGlhLWJpbmRpbmcnO1xuaW1wb3J0IHsgZ2V0TG9nZ2VyIH0gZnJvbSAnYXVyZWxpYS1sb2dnaW5nJztcbmltcG9ydCB7IExvYWRlciB9IGZyb20gJ2F1cmVsaWEtbG9hZGVyJztcbmltcG9ydCB7IHJlbGF0aXZlVG9GaWxlIH0gZnJvbSAnYXVyZWxpYS1wYXRoJztcbmltcG9ydCB7IG1peGluIH0gZnJvbSAnYXVyZWxpYS1tZXRhZGF0YSc7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXHJcbnRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXHJcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5USElTIENPREUgSVMgUFJPVklERUQgT04gQU4gKkFTIElTKiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXHJcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcclxuV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIFRJVExFLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSxcclxuTUVSQ0hBTlRBQkxJVFkgT1IgTk9OLUlORlJJTkdFTUVOVC5cclxuXHJcblNlZSB0aGUgQXBhY2hlIFZlcnNpb24gMi4wIExpY2Vuc2UgZm9yIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xyXG5hbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cblxudmFyIEFjdGl2YXRpb25TdHJhdGVneTtcclxuKGZ1bmN0aW9uIChBY3RpdmF0aW9uU3RyYXRlZ3kpIHtcclxuICAgIEFjdGl2YXRpb25TdHJhdGVneVtcIkludm9rZUxpZmVjeWNsZVwiXSA9IFwiaW52b2tlLWxpZmVjeWNsZVwiO1xyXG4gICAgQWN0aXZhdGlvblN0cmF0ZWd5W1wiUmVwbGFjZVwiXSA9IFwicmVwbGFjZVwiO1xyXG59KShBY3RpdmF0aW9uU3RyYXRlZ3kgfHwgKEFjdGl2YXRpb25TdHJhdGVneSA9IHt9KSk7XHJcbnZhciBDb21wb3NlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbXBvc2UoZWxlbWVudCwgY29udGFpbmVyLCBjb21wb3NpdGlvbkVuZ2luZSwgdmlld1Nsb3QsIHZpZXdSZXNvdXJjZXMsIHRhc2tRdWV1ZSkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZhdGlvblN0cmF0ZWd5ID0gQWN0aXZhdGlvblN0cmF0ZWd5Lkludm9rZUxpZmVjeWNsZTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcclxuICAgICAgICB0aGlzLnZpZXdTbG90ID0gdmlld1Nsb3Q7XHJcbiAgICAgICAgdGhpcy52aWV3UmVzb3VyY2VzID0gdmlld1Jlc291cmNlcztcclxuICAgICAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRDb250cm9sbGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmN1cnJlbnRWaWV3TW9kZWwgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICB9XHJcbiAgICBDb21wb3NlLmluamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW0RPTS5FbGVtZW50LCBDb250YWluZXIsIENvbXBvc2l0aW9uRW5naW5lLCBWaWV3U2xvdCwgVmlld1Jlc291cmNlcywgVGFza1F1ZXVlXTtcclxuICAgIH07XHJcbiAgICBDb21wb3NlLnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKG93bmluZ1ZpZXcpIHtcclxuICAgICAgICB0aGlzLm93bmluZ1ZpZXcgPSBvd25pbmdWaWV3O1xyXG4gICAgfTtcclxuICAgIENvbXBvc2UucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBiaW5kaW5nQ29udGV4dDtcclxuICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICB2YXIgY2hhbmdlcyA9IHRoaXMuY2hhbmdlcztcclxuICAgICAgICBjaGFuZ2VzLnZpZXcgPSB0aGlzLnZpZXc7XHJcbiAgICAgICAgY2hhbmdlcy52aWV3TW9kZWwgPSB0aGlzLnZpZXdNb2RlbDtcclxuICAgICAgICBjaGFuZ2VzLm1vZGVsID0gdGhpcy5tb2RlbDtcclxuICAgICAgICBpZiAoIXRoaXMucGVuZGluZ1Rhc2spIHtcclxuICAgICAgICAgICAgcHJvY2Vzc0NoYW5nZXModGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbXBvc2UucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNoYW5nZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB2YXIgcmV0dXJuVG9DYWNoZSA9IHRydWU7XHJcbiAgICAgICAgdmFyIHNraXBBbmltYXRpb24gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMudmlld1Nsb3QucmVtb3ZlQWxsKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2UucHJvdG90eXBlLm1vZGVsQ2hhbmdlZCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICB0aGlzLmNoYW5nZXMubW9kZWwgPSBuZXdWYWx1ZTtcclxuICAgICAgICByZXF1ZXN0VXBkYXRlKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2UucHJvdG90eXBlLnZpZXdDaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcy52aWV3ID0gbmV3VmFsdWU7XHJcbiAgICAgICAgcmVxdWVzdFVwZGF0ZSh0aGlzKTtcclxuICAgIH07XHJcbiAgICBDb21wb3NlLnByb3RvdHlwZS52aWV3TW9kZWxDaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcy52aWV3TW9kZWwgPSBuZXdWYWx1ZTtcclxuICAgICAgICByZXF1ZXN0VXBkYXRlKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBDb21wb3NlLnByb3RvdHlwZSwgXCJtb2RlbFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIENvbXBvc2UucHJvdG90eXBlLCBcInZpZXdcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBDb21wb3NlLnByb3RvdHlwZSwgXCJ2aWV3TW9kZWxcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBDb21wb3NlLnByb3RvdHlwZSwgXCJhY3RpdmF0aW9uU3RyYXRlZ3lcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBDb21wb3NlLnByb3RvdHlwZSwgXCJzd2FwT3JkZXJcIiwgdm9pZCAwKTtcclxuICAgIENvbXBvc2UgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBub1ZpZXcsXHJcbiAgICAgICAgY3VzdG9tRWxlbWVudCgnY29tcG9zZScpXHJcbiAgICBdLCBDb21wb3NlKTtcclxuICAgIHJldHVybiBDb21wb3NlO1xyXG59KCkpO1xyXG5mdW5jdGlvbiBpc0VtcHR5KG9iaikge1xyXG4gICAgZm9yICh2YXIgXyBpbiBvYmopIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxyXG5mdW5jdGlvbiB0cnlBY3RpdmF0ZVZpZXdNb2RlbCh2bSwgbW9kZWwpIHtcclxuICAgIGlmICh2bSAmJiB0eXBlb2Ygdm0uYWN0aXZhdGUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZtLmFjdGl2YXRlKG1vZGVsKSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlSW5zdHJ1Y3Rpb24oY29tcG9zZXIsIGluc3RydWN0aW9uKSB7XHJcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihpbnN0cnVjdGlvbiwge1xyXG4gICAgICAgIGJpbmRpbmdDb250ZXh0OiBjb21wb3Nlci5iaW5kaW5nQ29udGV4dCxcclxuICAgICAgICBvdmVycmlkZUNvbnRleHQ6IGNvbXBvc2VyLm92ZXJyaWRlQ29udGV4dCxcclxuICAgICAgICBvd25pbmdWaWV3OiBjb21wb3Nlci5vd25pbmdWaWV3LFxyXG4gICAgICAgIGNvbnRhaW5lcjogY29tcG9zZXIuY29udGFpbmVyLFxyXG4gICAgICAgIHZpZXdTbG90OiBjb21wb3Nlci52aWV3U2xvdCxcclxuICAgICAgICB2aWV3UmVzb3VyY2VzOiBjb21wb3Nlci52aWV3UmVzb3VyY2VzLFxyXG4gICAgICAgIGN1cnJlbnRDb250cm9sbGVyOiBjb21wb3Nlci5jdXJyZW50Q29udHJvbGxlcixcclxuICAgICAgICBob3N0OiBjb21wb3Nlci5lbGVtZW50LFxyXG4gICAgICAgIHN3YXBPcmRlcjogY29tcG9zZXIuc3dhcE9yZGVyXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBwcm9jZXNzQ2hhbmdlcyhjb21wb3Nlcikge1xyXG4gICAgdmFyIGNoYW5nZXMgPSBjb21wb3Nlci5jaGFuZ2VzO1xyXG4gICAgY29tcG9zZXIuY2hhbmdlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICBpZiAobmVlZHNSZUluaXRpYWxpemF0aW9uKGNvbXBvc2VyLCBjaGFuZ2VzKSkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IHtcclxuICAgICAgICAgICAgdmlldzogY29tcG9zZXIudmlldyxcclxuICAgICAgICAgICAgdmlld01vZGVsOiBjb21wb3Nlci5jdXJyZW50Vmlld01vZGVsIHx8IGNvbXBvc2VyLnZpZXdNb2RlbCxcclxuICAgICAgICAgICAgbW9kZWw6IGNvbXBvc2VyLm1vZGVsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpbnN0cnVjdGlvbiA9IE9iamVjdC5hc3NpZ24oaW5zdHJ1Y3Rpb24sIGNoYW5nZXMpO1xyXG4gICAgICAgIGluc3RydWN0aW9uID0gY3JlYXRlSW5zdHJ1Y3Rpb24oY29tcG9zZXIsIGluc3RydWN0aW9uKTtcclxuICAgICAgICBjb21wb3Nlci5wZW5kaW5nVGFzayA9IGNvbXBvc2VyLmNvbXBvc2l0aW9uRW5naW5lLmNvbXBvc2UoaW5zdHJ1Y3Rpb24pLnRoZW4oZnVuY3Rpb24gKGNvbnRyb2xsZXIpIHtcclxuICAgICAgICAgICAgY29tcG9zZXIuY3VycmVudENvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xyXG4gICAgICAgICAgICBjb21wb3Nlci5jdXJyZW50Vmlld01vZGVsID0gY29udHJvbGxlciA/IGNvbnRyb2xsZXIudmlld01vZGVsIDogbnVsbDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbXBvc2VyLnBlbmRpbmdUYXNrID0gdHJ5QWN0aXZhdGVWaWV3TW9kZWwoY29tcG9zZXIuY3VycmVudFZpZXdNb2RlbCwgY2hhbmdlcy5tb2RlbCk7XHJcbiAgICAgICAgaWYgKCFjb21wb3Nlci5wZW5kaW5nVGFzaykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29tcG9zZXIucGVuZGluZ1Rhc2sgPSBjb21wb3Nlci5wZW5kaW5nVGFza1xyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb21wbGV0ZUNvbXBvc2l0aW9uVGFzayhjb21wb3Nlcik7XHJcbiAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgY29tcGxldGVDb21wb3NpdGlvblRhc2soY29tcG9zZXIpO1xyXG4gICAgICAgIHRocm93IHJlYXNvbjtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGNvbXBsZXRlQ29tcG9zaXRpb25UYXNrKGNvbXBvc2VyKSB7XHJcbiAgICBjb21wb3Nlci5wZW5kaW5nVGFzayA9IG51bGw7XHJcbiAgICBpZiAoIWlzRW1wdHkoY29tcG9zZXIuY2hhbmdlcykpIHtcclxuICAgICAgICBwcm9jZXNzQ2hhbmdlcyhjb21wb3Nlcik7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcmVxdWVzdFVwZGF0ZShjb21wb3Nlcikge1xyXG4gICAgaWYgKGNvbXBvc2VyLnBlbmRpbmdUYXNrIHx8IGNvbXBvc2VyLnVwZGF0ZVJlcXVlc3RlZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbXBvc2VyLnVwZGF0ZVJlcXVlc3RlZCA9IHRydWU7XHJcbiAgICBjb21wb3Nlci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbXBvc2VyLnVwZGF0ZVJlcXVlc3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIHByb2Nlc3NDaGFuZ2VzKGNvbXBvc2VyKTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIG5lZWRzUmVJbml0aWFsaXphdGlvbihjb21wb3NlciwgY2hhbmdlcykge1xyXG4gICAgdmFyIGFjdGl2YXRpb25TdHJhdGVneSA9IGNvbXBvc2VyLmFjdGl2YXRpb25TdHJhdGVneTtcclxuICAgIHZhciB2bSA9IGNvbXBvc2VyLmN1cnJlbnRWaWV3TW9kZWw7XHJcbiAgICBpZiAodm0gJiYgdHlwZW9mIHZtLmRldGVybWluZUFjdGl2YXRpb25TdHJhdGVneSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIGFjdGl2YXRpb25TdHJhdGVneSA9IHZtLmRldGVybWluZUFjdGl2YXRpb25TdHJhdGVneSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICd2aWV3JyBpbiBjaGFuZ2VzXHJcbiAgICAgICAgfHwgJ3ZpZXdNb2RlbCcgaW4gY2hhbmdlc1xyXG4gICAgICAgIHx8IGFjdGl2YXRpb25TdHJhdGVneSA9PT0gQWN0aXZhdGlvblN0cmF0ZWd5LlJlcGxhY2U7XHJcbn1cblxudmFyIElmQ29yZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBJZkNvcmUodmlld0ZhY3RvcnksIHZpZXdTbG90KSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcclxuICAgICAgICB0aGlzLnZpZXcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnNob3dpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNhY2hlID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIElmQ29yZS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgfTtcclxuICAgIElmQ29yZS5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnZpZXcgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLnZpZXdGYWN0b3J5LmlzQ2FjaGluZykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNob3dpbmcpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMudmlld1Nsb3QucmVtb3ZlKHRoaXMudmlldywgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZpZXcgPSBudWxsO1xyXG4gICAgfTtcclxuICAgIElmQ29yZS5wcm90b3R5cGUuX3Nob3cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd2luZykge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMudmlldy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcuYmluZCh0aGlzLmJpbmRpbmdDb250ZXh0LCB0aGlzLm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy52aWV3ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy52aWV3LmlzQm91bmQpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3LmJpbmQodGhpcy5iaW5kaW5nQ29udGV4dCwgdGhpcy5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNob3dpbmcgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdTbG90LmFkZCh0aGlzLnZpZXcpO1xyXG4gICAgfTtcclxuICAgIElmQ29yZS5wcm90b3R5cGUuX2hpZGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoIXRoaXMuc2hvd2luZykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9IGZhbHNlO1xyXG4gICAgICAgIHZhciByZW1vdmVkID0gdGhpcy52aWV3U2xvdC5yZW1vdmUodGhpcy52aWV3KTtcclxuICAgICAgICBpZiAocmVtb3ZlZCBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbW92ZWQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fdW5iaW5kVmlldygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdW5iaW5kVmlldygpO1xyXG4gICAgfTtcclxuICAgIElmQ29yZS5wcm90b3R5cGUuX3VuYmluZFZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNhY2hlID0gdGhpcy5jYWNoZSA9PT0gJ2ZhbHNlJyA/IGZhbHNlIDogISF0aGlzLmNhY2hlO1xyXG4gICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcclxuICAgICAgICBpZiAoIWNhY2hlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBJZkNvcmU7XHJcbn0oKSk7XG5cbnZhciBJZiA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSWYsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJZigpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jYWNoZSA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgSWYucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuYmluZC5jYWxsKHRoaXMsIGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLl9zaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIElmLnByb3RvdHlwZS5jb25kaXRpb25DaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlKG5ld1ZhbHVlKTtcclxuICAgIH07XHJcbiAgICBJZi5wcm90b3R5cGUuX3VwZGF0ZSA9IGZ1bmN0aW9uIChzaG93KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAodGhpcy5hbmltYXRpbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcHJvbWlzZTtcclxuICAgICAgICBpZiAodGhpcy5lbHNlVm0pIHtcclxuICAgICAgICAgICAgcHJvbWlzZSA9IHNob3cgPyB0aGlzLl9zd2FwKHRoaXMuZWxzZVZtLCB0aGlzKSA6IHRoaXMuX3N3YXAodGhpcywgdGhpcy5lbHNlVm0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcHJvbWlzZSA9IHNob3cgPyB0aGlzLl9zaG93KCkgOiB0aGlzLl9oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9taXNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmFuaW1hdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmNvbmRpdGlvbiAhPT0gX3RoaXMuc2hvd2luZykge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl91cGRhdGUoX3RoaXMuY29uZGl0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIElmLnByb3RvdHlwZS5fc3dhcCA9IGZ1bmN0aW9uIChyZW1vdmUsIGFkZCkge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zd2FwT3JkZXIpIHtcclxuICAgICAgICAgICAgY2FzZSAnYmVmb3JlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYWRkLl9zaG93KCkpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVtb3ZlLl9oaWRlKCk7IH0pO1xyXG4gICAgICAgICAgICBjYXNlICd3aXRoJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbcmVtb3ZlLl9oaWRlKCksIGFkZC5fc2hvdygpXSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IHJlbW92ZS5faGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2UgPyBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gYWRkLl9zaG93KCk7IH0pIDogYWRkLl9zaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlKHsgcHJpbWFyeVByb3BlcnR5OiB0cnVlIH0pXHJcbiAgICBdLCBJZi5wcm90b3R5cGUsIFwiY29uZGl0aW9uXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kYWJsZVxyXG4gICAgXSwgSWYucHJvdG90eXBlLCBcInN3YXBPcmRlclwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIElmLnByb3RvdHlwZSwgXCJjYWNoZVwiLCB2b2lkIDApO1xyXG4gICAgSWYgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ2lmJyksXHJcbiAgICAgICAgdGVtcGxhdGVDb250cm9sbGVyLFxyXG4gICAgICAgIGluamVjdChCb3VuZFZpZXdGYWN0b3J5LCBWaWV3U2xvdClcclxuICAgIF0sIElmKTtcclxuICAgIHJldHVybiBJZjtcclxufShJZkNvcmUpKTtcblxudmFyIEVsc2UgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEVsc2UsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBFbHNlKHZpZXdGYWN0b3J5LCB2aWV3U2xvdCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHZpZXdGYWN0b3J5LCB2aWV3U2xvdCkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5fcmVnaXN0ZXJJbklmKCk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRWxzZS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5iaW5kLmNhbGwodGhpcywgYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaWZWbS5jb25kaXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5faGlkZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvdygpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBFbHNlLnByb3RvdHlwZS5fcmVnaXN0ZXJJbklmID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwcmV2aW91cyA9IHRoaXMudmlld1Nsb3QuYW5jaG9yLnByZXZpb3VzU2libGluZztcclxuICAgICAgICB3aGlsZSAocHJldmlvdXMgJiYgIXByZXZpb3VzLmF1KSB7XHJcbiAgICAgICAgICAgIHByZXZpb3VzID0gcHJldmlvdXMucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXByZXZpb3VzIHx8ICFwcmV2aW91cy5hdS5pZikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBmaW5kIG1hdGNoaW5nIElmIGZvciBFbHNlIGN1c3RvbSBhdHRyaWJ1dGUuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlmVm0gPSBwcmV2aW91cy5hdS5pZi52aWV3TW9kZWw7XHJcbiAgICAgICAgdGhpcy5pZlZtLmVsc2VWbSA9IHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRWxzZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgnZWxzZScpLFxyXG4gICAgICAgIHRlbXBsYXRlQ29udHJvbGxlcixcclxuICAgICAgICBpbmplY3QoQm91bmRWaWV3RmFjdG9yeSwgVmlld1Nsb3QpXHJcbiAgICBdLCBFbHNlKTtcclxuICAgIHJldHVybiBFbHNlO1xyXG59KElmQ29yZSkpO1xuXG52YXIgV2l0aCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBXaXRoKHZpZXdGYWN0b3J5LCB2aWV3U2xvdCkge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICB0aGlzLnZpZXdTbG90ID0gdmlld1Nsb3Q7XHJcbiAgICAgICAgdGhpcy5wYXJlbnRPdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlldyA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBXaXRoLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLnBhcmVudE92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlZCh0aGlzLnZhbHVlKTtcclxuICAgIH07XHJcbiAgICBXaXRoLnByb3RvdHlwZS52YWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0KG5ld1ZhbHVlLCB0aGlzLnBhcmVudE92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLnZpZXc7XHJcbiAgICAgICAgaWYgKCF2aWV3KSB7XHJcbiAgICAgICAgICAgIHZpZXcgPSB0aGlzLnZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSgpO1xyXG4gICAgICAgICAgICB2aWV3LmJpbmQobmV3VmFsdWUsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMudmlld1Nsb3QuYWRkKHZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmlldy5iaW5kKG5ld1ZhbHVlLCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBXaXRoLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLnZpZXc7XHJcbiAgICAgICAgdGhpcy5wYXJlbnRPdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIGlmICh2aWV3KSB7XHJcbiAgICAgICAgICAgIHZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFdpdGggPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ3dpdGgnKSxcclxuICAgICAgICB0ZW1wbGF0ZUNvbnRyb2xsZXIsXHJcbiAgICAgICAgaW5qZWN0KEJvdW5kVmlld0ZhY3RvcnksIFZpZXdTbG90KVxyXG4gICAgXSwgV2l0aCk7XHJcbiAgICByZXR1cm4gV2l0aDtcclxufSgpKTtcblxudmFyIG9uZVRpbWUgPSBiaW5kaW5nTW9kZS5vbmVUaW1lO1xyXG5mdW5jdGlvbiB1cGRhdGVPdmVycmlkZUNvbnRleHRzKHZpZXdzLCBzdGFydEluZGV4KSB7XHJcbiAgICB2YXIgbGVuZ3RoID0gdmlld3MubGVuZ3RoO1xyXG4gICAgaWYgKHN0YXJ0SW5kZXggPiAwKSB7XHJcbiAgICAgICAgc3RhcnRJbmRleCA9IHN0YXJ0SW5kZXggLSAxO1xyXG4gICAgfVxyXG4gICAgZm9yICg7IHN0YXJ0SW5kZXggPCBsZW5ndGg7ICsrc3RhcnRJbmRleCkge1xyXG4gICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dCh2aWV3c1tzdGFydEluZGV4XS5vdmVycmlkZUNvbnRleHQsIHN0YXJ0SW5kZXgsIGxlbmd0aCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIGRhdGEsIGluZGV4LCBsZW5ndGgsIGtleSkge1xyXG4gICAgdmFyIGJpbmRpbmdDb250ZXh0ID0ge307XHJcbiAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0KGJpbmRpbmdDb250ZXh0LCByZXBlYXQuc2NvcGUub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgIGlmICh0eXBlb2Yga2V5ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIGJpbmRpbmdDb250ZXh0W3JlcGVhdC5rZXldID0ga2V5O1xyXG4gICAgICAgIGJpbmRpbmdDb250ZXh0W3JlcGVhdC52YWx1ZV0gPSBkYXRhO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgYmluZGluZ0NvbnRleHRbcmVwZWF0LmxvY2FsXSA9IGRhdGE7XHJcbiAgICB9XHJcbiAgICB1cGRhdGVPdmVycmlkZUNvbnRleHQob3ZlcnJpZGVDb250ZXh0LCBpbmRleCwgbGVuZ3RoKTtcclxuICAgIHJldHVybiBvdmVycmlkZUNvbnRleHQ7XHJcbn1cclxuZnVuY3Rpb24gdXBkYXRlT3ZlcnJpZGVDb250ZXh0KG92ZXJyaWRlQ29udGV4dCwgaW5kZXgsIGxlbmd0aCkge1xyXG4gICAgdmFyIGZpcnN0ID0gKGluZGV4ID09PSAwKTtcclxuICAgIHZhciBsYXN0ID0gKGluZGV4ID09PSBsZW5ndGggLSAxKTtcclxuICAgIHZhciBldmVuID0gaW5kZXggJSAyID09PSAwO1xyXG4gICAgb3ZlcnJpZGVDb250ZXh0LiRpbmRleCA9IGluZGV4O1xyXG4gICAgb3ZlcnJpZGVDb250ZXh0LiRmaXJzdCA9IGZpcnN0O1xyXG4gICAgb3ZlcnJpZGVDb250ZXh0LiRsYXN0ID0gbGFzdDtcclxuICAgIG92ZXJyaWRlQ29udGV4dC4kbWlkZGxlID0gIShmaXJzdCB8fCBsYXN0KTtcclxuICAgIG92ZXJyaWRlQ29udGV4dC4kb2RkID0gIWV2ZW47XHJcbiAgICBvdmVycmlkZUNvbnRleHQuJGV2ZW4gPSBldmVuO1xyXG59XHJcbmZ1bmN0aW9uIGdldEl0ZW1zU291cmNlRXhwcmVzc2lvbihpbnN0cnVjdGlvbiwgYXR0ck5hbWUpIHtcclxuICAgIHJldHVybiBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9uc1xyXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGJpKSB7IHJldHVybiBiaS5vcmlnaW5hbEF0dHJOYW1lID09PSBhdHRyTmFtZTsgfSlbMF1cclxuICAgICAgICAuYXR0cmlidXRlc1xyXG4gICAgICAgIC5pdGVtc1xyXG4gICAgICAgIC5zb3VyY2VFeHByZXNzaW9uO1xyXG59XHJcbmZ1bmN0aW9uIHVud3JhcEV4cHJlc3Npb24oZXhwcmVzc2lvbikge1xyXG4gICAgdmFyIHVud3JhcHBlZCA9IGZhbHNlO1xyXG4gICAgd2hpbGUgKGV4cHJlc3Npb24gaW5zdGFuY2VvZiBCaW5kaW5nQmVoYXZpb3IpIHtcclxuICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5leHByZXNzaW9uO1xyXG4gICAgfVxyXG4gICAgd2hpbGUgKGV4cHJlc3Npb24gaW5zdGFuY2VvZiBWYWx1ZUNvbnZlcnRlcikge1xyXG4gICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmV4cHJlc3Npb247XHJcbiAgICAgICAgdW53cmFwcGVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB1bndyYXBwZWQgPyBleHByZXNzaW9uIDogbnVsbDtcclxufVxyXG5mdW5jdGlvbiBpc09uZVRpbWUoZXhwcmVzc2lvbikge1xyXG4gICAgd2hpbGUgKGV4cHJlc3Npb24gaW5zdGFuY2VvZiBCaW5kaW5nQmVoYXZpb3IpIHtcclxuICAgICAgICBpZiAoZXhwcmVzc2lvbi5uYW1lID09PSAnb25lVGltZScpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmV4cHJlc3Npb247XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuZnVuY3Rpb24gdXBkYXRlT25lVGltZUJpbmRpbmcoYmluZGluZykge1xyXG4gICAgaWYgKGJpbmRpbmcuY2FsbCAmJiBiaW5kaW5nLm1vZGUgPT09IG9uZVRpbWUpIHtcclxuICAgICAgICBiaW5kaW5nLmNhbGwoc291cmNlQ29udGV4dCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChiaW5kaW5nLnVwZGF0ZU9uZVRpbWVCaW5kaW5ncykge1xyXG4gICAgICAgIGJpbmRpbmcudXBkYXRlT25lVGltZUJpbmRpbmdzKCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gaW5kZXhPZihhcnJheSwgaXRlbSwgbWF0Y2hlciwgc3RhcnRJbmRleCkge1xyXG4gICAgaWYgKCFtYXRjaGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGFycmF5LmluZGV4T2YoaXRlbSk7XHJcbiAgICB9XHJcbiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgaW5kZXggPSBzdGFydEluZGV4IHx8IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgaWYgKG1hdGNoZXIoYXJyYXlbaW5kZXhdLCBpdGVtKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIC0xO1xyXG59XG5cbnZhciBBcnJheVJlcGVhdFN0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFycmF5UmVwZWF0U3RyYXRlZ3koKSB7XHJcbiAgICB9XHJcbiAgICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5nZXRDb2xsZWN0aW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbiAob2JzZXJ2ZXJMb2NhdG9yLCBpdGVtcykge1xyXG4gICAgICAgIHJldHVybiBvYnNlcnZlckxvY2F0b3IuZ2V0QXJyYXlPYnNlcnZlcihpdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgQXJyYXlSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gKHJlcGVhdCwgaXRlbXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciAkcmVwZWF0ID0gcmVwZWF0O1xyXG4gICAgICAgIHZhciBpdGVtc0xlbmd0aCA9IGl0ZW1zLmxlbmd0aDtcclxuICAgICAgICBpZiAoIWl0ZW1zIHx8IGl0ZW1zTGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICRyZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgISRyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSAkcmVwZWF0LnZpZXdzKCk7XHJcbiAgICAgICAgdmFyIHZpZXdzTGVuZ3RoID0gY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgIGlmICh2aWV3c0xlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGFuZGFyZFByb2Nlc3NJbnN0YW5jZUNoYW5nZWQoJHJlcGVhdCwgaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgkcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSkge1xyXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW5TbmFwc2hvdCA9IGNoaWxkcmVuLnNsaWNlKDApO1xyXG4gICAgICAgICAgICB2YXIgaXRlbU5hbWVJbkJpbmRpbmdDb250ZXh0ID0gJHJlcGVhdC5sb2NhbDtcclxuICAgICAgICAgICAgdmFyIG1hdGNoZXJfMSA9ICRyZXBlYXQubWF0Y2hlcigpO1xyXG4gICAgICAgICAgICB2YXIgaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xID0gW107XHJcbiAgICAgICAgICAgIHZhciB2aWV3c1RvUmVtb3ZlID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB2aWV3c0xlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZpZXcgPSBjaGlsZHJlblNuYXBzaG90W2luZGV4XTtcclxuICAgICAgICAgICAgICAgIHZhciBvbGRJdGVtID0gdmlldy5iaW5kaW5nQ29udGV4dFtpdGVtTmFtZUluQmluZGluZ0NvbnRleHRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4T2YoaXRlbXMsIG9sZEl0ZW0sIG1hdGNoZXJfMSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld3NUb1JlbW92ZS5wdXNoKHZpZXcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xLnB1c2gob2xkSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHVwZGF0ZVZpZXdzID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB2YXIgcmVtb3ZlUHJvbWlzZSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgaWYgKGl0ZW1zUHJldmlvdXNseUluVmlld3NfMS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVQcm9taXNlID0gJHJlcGVhdC5yZW1vdmVWaWV3cyh2aWV3c1RvUmVtb3ZlLCB0cnVlLCAhJHJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVmlld3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGl0ZW1zTGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXhPZlZpZXcgPSBpbmRleE9mKGl0ZW1zUHJldmlvdXNseUluVmlld3NfMSwgaXRlbSwgbWF0Y2hlcl8xLCBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhPZlZpZXcgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dCgkcmVwZWF0LCBpdGVtc1tpbmRleF0sIGluZGV4LCBpdGVtc0xlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVwZWF0Lmluc2VydFZpZXcoaW5kZXgsIG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zUHJldmlvdXNseUluVmlld3NfMS5zcGxpY2UoaW5kZXgsIDAsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaW5kZXhPZlZpZXcgPT09IGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3ID0gY2hpbGRyZW5baW5kZXhPZlZpZXddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xW2luZGV4T2ZWaWV3XSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSBjaGlsZHJlbltpbmRleE9mVmlld107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVwZWF0Lm1vdmVWaWV3KGluZGV4T2ZWaWV3LCBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1ByZXZpb3VzbHlJblZpZXdzXzEuc3BsaWNlKGluZGV4T2ZWaWV3LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zUHJldmlvdXNseUluVmlld3NfMS5zcGxpY2UoaW5kZXgsIDAsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dCh2aWV3Lm92ZXJyaWRlQ29udGV4dCwgaW5kZXgsIGl0ZW1zTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5faW5QbGFjZVByb2Nlc3NJdGVtcygkcmVwZWF0LCBpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVtb3ZlUHJvbWlzZSA9ICRyZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgISRyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVZpZXdzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX3N0YW5kYXJkUHJvY2Vzc0luc3RhbmNlQ2hhbmdlZCgkcmVwZWF0LCBpdGVtcyk7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlbW92ZVByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVQcm9taXNlLnRoZW4odXBkYXRlVmlld3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVmlld3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faW5QbGFjZVByb2Nlc3NJdGVtcygkcmVwZWF0LCBpdGVtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9zdGFuZGFyZFByb2Nlc3NJbnN0YW5jZUNoYW5nZWQgPSBmdW5jdGlvbiAocmVwZWF0LCBpdGVtcykge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGl0ZW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCBpdGVtc1tpXSwgaSwgaWkpO1xyXG4gICAgICAgICAgICByZXBlYXQuYWRkVmlldyhvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9pblBsYWNlUHJvY2Vzc0l0ZW1zID0gZnVuY3Rpb24gKHJlcGVhdCwgaXRlbXMpIHtcclxuICAgICAgICB2YXIgaXRlbXNMZW5ndGggPSBpdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgdmFyIHZpZXdzTGVuZ3RoID0gcmVwZWF0LnZpZXdDb3VudCgpO1xyXG4gICAgICAgIHdoaWxlICh2aWV3c0xlbmd0aCA+IGl0ZW1zTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHZpZXdzTGVuZ3RoLS07XHJcbiAgICAgICAgICAgIHJlcGVhdC5yZW1vdmVWaWV3KHZpZXdzTGVuZ3RoLCB0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBsb2NhbCA9IHJlcGVhdC5sb2NhbDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXdzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHZpZXcgPSByZXBlYXQudmlldyhpKTtcclxuICAgICAgICAgICAgdmFyIGxhc3QgPSBpID09PSBpdGVtc0xlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHZhciBtaWRkbGUgPSBpICE9PSAwICYmICFsYXN0O1xyXG4gICAgICAgICAgICB2YXIgYmluZGluZ0NvbnRleHQgPSB2aWV3LmJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gdmlldy5vdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgICAgIGlmIChiaW5kaW5nQ29udGV4dFtsb2NhbF0gPT09IGl0ZW1zW2ldXHJcbiAgICAgICAgICAgICAgICAmJiBvdmVycmlkZUNvbnRleHQuJG1pZGRsZSA9PT0gbWlkZGxlXHJcbiAgICAgICAgICAgICAgICAmJiBvdmVycmlkZUNvbnRleHQuJGxhc3QgPT09IGxhc3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJpbmRpbmdDb250ZXh0W2xvY2FsXSA9IGl0ZW1zW2ldO1xyXG4gICAgICAgICAgICBvdmVycmlkZUNvbnRleHQuJG1pZGRsZSA9IG1pZGRsZTtcclxuICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0LiRsYXN0ID0gbGFzdDtcclxuICAgICAgICAgICAgcmVwZWF0LnVwZGF0ZUJpbmRpbmdzKHZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBpID0gdmlld3NMZW5ndGg7IGkgPCBpdGVtc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KHJlcGVhdCwgaXRlbXNbaV0sIGksIGl0ZW1zTGVuZ3RoKTtcclxuICAgICAgICAgICAgcmVwZWF0LmFkZFZpZXcob3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZU11dGF0ZWQgPSBmdW5jdGlvbiAocmVwZWF0LCBhcnJheSwgc3BsaWNlcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHJlcGVhdC5fX3F1ZXVlZFNwbGljZXMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc3BsaWNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX2EgPSBzcGxpY2VzW2ldLCBpbmRleCA9IF9hLmluZGV4LCByZW1vdmVkID0gX2EucmVtb3ZlZCwgYWRkZWRDb3VudCA9IF9hLmFkZGVkQ291bnQ7XHJcbiAgICAgICAgICAgICAgICBtZXJnZVNwbGljZShyZXBlYXQuX19xdWV1ZWRTcGxpY2VzLCBpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVwZWF0Ll9fYXJyYXkgPSBhcnJheS5zbGljZSgwKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbWF5YmVQcm9taXNlID0gdGhpcy5fcnVuU3BsaWNlcyhyZXBlYXQsIGFycmF5LnNsaWNlKDApLCBzcGxpY2VzKTtcclxuICAgICAgICBpZiAobWF5YmVQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgICB2YXIgcXVldWVkU3BsaWNlc18xID0gcmVwZWF0Ll9fcXVldWVkU3BsaWNlcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgcnVuUXVldWVkU3BsaWNlc18xID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFxdWV1ZWRTcGxpY2VzXzEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0Ll9fcXVldWVkU3BsaWNlcyA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQuX19hcnJheSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV4dFByb21pc2UgPSBfdGhpcy5fcnVuU3BsaWNlcyhyZXBlYXQsIHJlcGVhdC5fX2FycmF5LCBxdWV1ZWRTcGxpY2VzXzEpIHx8IFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgcXVldWVkU3BsaWNlc18xID0gcmVwZWF0Ll9fcXVldWVkU3BsaWNlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgbmV4dFByb21pc2UudGhlbihydW5RdWV1ZWRTcGxpY2VzXzEpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBtYXliZVByb21pc2UudGhlbihydW5RdWV1ZWRTcGxpY2VzXzEpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fcnVuU3BsaWNlcyA9IGZ1bmN0aW9uIChyZXBlYXQsIGFycmF5LCBzcGxpY2VzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgcmVtb3ZlRGVsdGEgPSAwO1xyXG4gICAgICAgIHZhciBybVByb21pc2VzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc3BsaWNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHZhciBzcGxpY2UgPSBzcGxpY2VzW2ldO1xyXG4gICAgICAgICAgICB2YXIgcmVtb3ZlZCA9IHNwbGljZS5yZW1vdmVkO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSByZW1vdmVkLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcclxuICAgICAgICAgICAgICAgIHZhciB2aWV3T3JQcm9taXNlID0gcmVwZWF0LnJlbW92ZVZpZXcoc3BsaWNlLmluZGV4ICsgcmVtb3ZlRGVsdGEgKyBybVByb21pc2VzLmxlbmd0aCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBybVByb21pc2VzLnB1c2godmlld09yUHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVtb3ZlRGVsdGEgLT0gc3BsaWNlLmFkZGVkQ291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwbGljZUluZGV4TG93ID0gX3RoaXMuX2hhbmRsZUFkZGVkU3BsaWNlcyhyZXBlYXQsIGFycmF5LCBzcGxpY2VzKTtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dHMocmVwZWF0LnZpZXdzKCksIHNwbGljZUluZGV4TG93KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzcGxpY2VJbmRleExvdyA9IHRoaXMuX2hhbmRsZUFkZGVkU3BsaWNlcyhyZXBlYXQsIGFycmF5LCBzcGxpY2VzKTtcclxuICAgICAgICB1cGRhdGVPdmVycmlkZUNvbnRleHRzKHJlcGVhdC52aWV3cygpLCBzcGxpY2VJbmRleExvdyk7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5faGFuZGxlQWRkZWRTcGxpY2VzID0gZnVuY3Rpb24gKHJlcGVhdCwgYXJyYXksIHNwbGljZXMpIHtcclxuICAgICAgICB2YXIgc3BsaWNlSW5kZXg7XHJcbiAgICAgICAgdmFyIHNwbGljZUluZGV4TG93O1xyXG4gICAgICAgIHZhciBhcnJheUxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzcGxpY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgdmFyIHNwbGljZSA9IHNwbGljZXNbaV07XHJcbiAgICAgICAgICAgIHZhciBhZGRJbmRleCA9IHNwbGljZUluZGV4ID0gc3BsaWNlLmluZGV4O1xyXG4gICAgICAgICAgICB2YXIgZW5kID0gc3BsaWNlLmluZGV4ICsgc3BsaWNlLmFkZGVkQ291bnQ7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3BsaWNlSW5kZXhMb3cgPT09ICd1bmRlZmluZWQnIHx8IHNwbGljZUluZGV4TG93ID09PSBudWxsIHx8IHNwbGljZUluZGV4TG93ID4gc3BsaWNlLmluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBzcGxpY2VJbmRleExvdyA9IHNwbGljZUluZGV4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoOyBhZGRJbmRleCA8IGVuZDsgKythZGRJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCBhcnJheVthZGRJbmRleF0sIGFkZEluZGV4LCBhcnJheUxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICByZXBlYXQuaW5zZXJ0VmlldyhhZGRJbmRleCwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzcGxpY2VJbmRleExvdztcclxuICAgIH07XHJcbiAgICByZXR1cm4gQXJyYXlSZXBlYXRTdHJhdGVneTtcclxufSgpKTtcblxudmFyIE1hcFJlcGVhdFN0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE1hcFJlcGVhdFN0cmF0ZWd5KCkge1xyXG4gICAgfVxyXG4gICAgTWFwUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIChvYnNlcnZlckxvY2F0b3IsIGl0ZW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ic2VydmVyTG9jYXRvci5nZXRNYXBPYnNlcnZlcihpdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgTWFwUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlQ2hhbmdlZCA9IGZ1bmN0aW9uIChyZXBlYXQsIGl0ZW1zKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgcmVtb3ZlUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgaWYgKHJlbW92ZVByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcbiAgICAgICAgICAgIHJlbW92ZVByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCBpdGVtcyk7IH0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgaXRlbXMpO1xyXG4gICAgfTtcclxuICAgIE1hcFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fc3RhbmRhcmRQcm9jZXNzSXRlbXMgPSBmdW5jdGlvbiAocmVwZWF0LCBpdGVtcykge1xyXG4gICAgICAgIHZhciBpbmRleCA9IDA7XHJcbiAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCB2YWx1ZSwgaW5kZXgsIGl0ZW1zLnNpemUsIGtleSk7XHJcbiAgICAgICAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgKytpbmRleDtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VNdXRhdGVkID0gZnVuY3Rpb24gKHJlcGVhdCwgbWFwLCByZWNvcmRzKSB7XHJcbiAgICAgICAgdmFyIGtleTtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICB2YXIgcmVtb3ZlSW5kZXg7XHJcbiAgICAgICAgdmFyIGFkZEluZGV4O1xyXG4gICAgICAgIHZhciByZWNvcmQ7XHJcbiAgICAgICAgdmFyIHJtUHJvbWlzZXMgPSBbXTtcclxuICAgICAgICB2YXIgdmlld09yUHJvbWlzZTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHJlY29yZHMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzW2ldO1xyXG4gICAgICAgICAgICBrZXkgPSByZWNvcmQua2V5O1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHJlY29yZC50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd1cGRhdGUnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4ID0gdGhpcy5fZ2V0Vmlld0luZGV4QnlLZXkocmVwZWF0LCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdPclByb21pc2UgPSByZXBlYXQucmVtb3ZlVmlldyhyZW1vdmVJbmRleCwgdHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWV3T3JQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBybVByb21pc2VzLnB1c2godmlld09yUHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCBtYXAuZ2V0KGtleSksIHJlbW92ZUluZGV4LCBtYXAuc2l6ZSwga2V5KTtcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQuaW5zZXJ0VmlldyhyZW1vdmVJbmRleCwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnYWRkJzpcclxuICAgICAgICAgICAgICAgICAgICBhZGRJbmRleCA9IHJlcGVhdC52aWV3Q291bnQoKSA8PSBtYXAuc2l6ZSAtIDEgPyByZXBlYXQudmlld0NvdW50KCkgOiBtYXAuc2l6ZSAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIG1hcC5nZXQoa2V5KSwgYWRkSW5kZXgsIG1hcC5zaXplLCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdC5pbnNlcnRWaWV3KG1hcC5zaXplIC0gMSwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlJzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLm9sZFZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZW1vdmVJbmRleCA9IHRoaXMuX2dldFZpZXdJbmRleEJ5S2V5KHJlcGVhdCwga2V5KTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3T3JQcm9taXNlID0gcmVwZWF0LnJlbW92ZVZpZXcocmVtb3ZlSW5kZXgsIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm1Qcm9taXNlcy5wdXNoKHZpZXdPclByb21pc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NsZWFyJzpcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocm1Qcm9taXNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0cyhyZXBlYXQudmlld3MoKSwgMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0cyhyZXBlYXQudmlld3MoKSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE1hcFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fZ2V0Vmlld0luZGV4QnlLZXkgPSBmdW5jdGlvbiAocmVwZWF0LCBrZXkpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGNoaWxkO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gcmVwZWF0LnZpZXdDb3VudCgpOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjaGlsZCA9IHJlcGVhdC52aWV3KGkpO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGQuYmluZGluZ0NvbnRleHRbcmVwZWF0LmtleV0gPT09IGtleSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTWFwUmVwZWF0U3RyYXRlZ3k7XHJcbn0oKSk7XG5cbnZhciBOdWxsUmVwZWF0U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTnVsbFJlcGVhdFN0cmF0ZWd5KCkge1xyXG4gICAgfVxyXG4gICAgTnVsbFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZUNoYW5nZWQgPSBmdW5jdGlvbiAocmVwZWF0LCBpdGVtcykge1xyXG4gICAgICAgIHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlKTtcclxuICAgIH07XHJcbiAgICBOdWxsUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIChvYnNlcnZlckxvY2F0b3IsIGl0ZW1zKSB7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE51bGxSZXBlYXRTdHJhdGVneTtcclxufSgpKTtcblxudmFyIE51bWJlclJlcGVhdFN0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE51bWJlclJlcGVhdFN0cmF0ZWd5KCkge1xyXG4gICAgfVxyXG4gICAgTnVtYmVyUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcbiAgICBOdW1iZXJSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gKHJlcGVhdCwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciByZW1vdmVQcm9taXNlID0gcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICBpZiAocmVtb3ZlUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgcmVtb3ZlUHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIHZhbHVlKTsgfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCB2YWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgTnVtYmVyUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyA9IGZ1bmN0aW9uIChyZXBlYXQsIHZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuTGVuZ3RoID0gcmVwZWF0LnZpZXdDb3VudCgpO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIHZhciB2aWV3c1RvUmVtb3ZlO1xyXG4gICAgICAgIHZhbHVlID0gTWF0aC5mbG9vcih2YWx1ZSk7XHJcbiAgICAgICAgdmlld3NUb1JlbW92ZSA9IGNoaWxkcmVuTGVuZ3RoIC0gdmFsdWU7XHJcbiAgICAgICAgaWYgKHZpZXdzVG9SZW1vdmUgPiAwKSB7XHJcbiAgICAgICAgICAgIGlmICh2aWV3c1RvUmVtb3ZlID4gY2hpbGRyZW5MZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHZpZXdzVG9SZW1vdmUgPSBjaGlsZHJlbkxlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHZpZXdzVG9SZW1vdmU7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICByZXBlYXQucmVtb3ZlVmlldyhjaGlsZHJlbkxlbmd0aCAtIChpICsgMSksIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IGNoaWxkcmVuTGVuZ3RoLCBpaSA9IHZhbHVlOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KHJlcGVhdCwgaSwgaSwgaWkpO1xyXG4gICAgICAgICAgICByZXBlYXQuYWRkVmlldyhvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dHMocmVwZWF0LnZpZXdzKCksIDApO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBOdW1iZXJSZXBlYXRTdHJhdGVneTtcclxufSgpKTtcblxudmFyIFNldFJlcGVhdFN0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNldFJlcGVhdFN0cmF0ZWd5KCkge1xyXG4gICAgfVxyXG4gICAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIChvYnNlcnZlckxvY2F0b3IsIGl0ZW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ic2VydmVyTG9jYXRvci5nZXRTZXRPYnNlcnZlcihpdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlQ2hhbmdlZCA9IGZ1bmN0aW9uIChyZXBlYXQsIGl0ZW1zKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgcmVtb3ZlUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgaWYgKHJlbW92ZVByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcbiAgICAgICAgICAgIHJlbW92ZVByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCBpdGVtcyk7IH0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgaXRlbXMpO1xyXG4gICAgfTtcclxuICAgIFNldFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fc3RhbmRhcmRQcm9jZXNzSXRlbXMgPSBmdW5jdGlvbiAocmVwZWF0LCBpdGVtcykge1xyXG4gICAgICAgIHZhciBpbmRleCA9IDA7XHJcbiAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KHJlcGVhdCwgdmFsdWUsIGluZGV4LCBpdGVtcy5zaXplKTtcclxuICAgICAgICAgICAgcmVwZWF0LmFkZFZpZXcob3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICArK2luZGV4O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFNldFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZU11dGF0ZWQgPSBmdW5jdGlvbiAocmVwZWF0LCBzZXQsIHJlY29yZHMpIHtcclxuICAgICAgICB2YXIgdmFsdWU7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgdmFyIHJlbW92ZUluZGV4O1xyXG4gICAgICAgIHZhciByZWNvcmQ7XHJcbiAgICAgICAgdmFyIHJtUHJvbWlzZXMgPSBbXTtcclxuICAgICAgICB2YXIgdmlld09yUHJvbWlzZTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHJlY29yZHMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzW2ldO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHJlY29yZC52YWx1ZTtcclxuICAgICAgICAgICAgc3dpdGNoIChyZWNvcmQudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnYWRkJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IE1hdGgubWF4KHNldC5zaXplIC0gMSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIHZhbHVlLCBzaXplLCBzZXQuc2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0Lmluc2VydFZpZXcoc2l6ZSwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlJzpcclxuICAgICAgICAgICAgICAgICAgICByZW1vdmVJbmRleCA9IHRoaXMuX2dldFZpZXdJbmRleEJ5VmFsdWUocmVwZWF0LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld09yUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVWaWV3KHJlbW92ZUluZGV4LCB0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXdPclByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaCh2aWV3T3JQcm9taXNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjbGVhcic6XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJtUHJvbWlzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBQcm9taXNlLmFsbChybVByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dHMocmVwZWF0LnZpZXdzKCksIDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dHMocmVwZWF0LnZpZXdzKCksIDApO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXRSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX2dldFZpZXdJbmRleEJ5VmFsdWUgPSBmdW5jdGlvbiAocmVwZWF0LCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY2hpbGQ7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSByZXBlYXQudmlld0NvdW50KCk7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNoaWxkID0gcmVwZWF0LnZpZXcoaSk7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5iaW5kaW5nQ29udGV4dFtyZXBlYXQubG9jYWxdID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2V0UmVwZWF0U3RyYXRlZ3k7XHJcbn0oKSk7XG5cbnZhciBSZXBlYXRTdHJhdGVneUxvY2F0b3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUmVwZWF0U3RyYXRlZ3lMb2NhdG9yKCkge1xyXG4gICAgICAgIHRoaXMubWF0Y2hlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLnN0cmF0ZWdpZXMgPSBbXTtcclxuICAgICAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykgeyByZXR1cm4gaXRlbXMgPT09IG51bGwgfHwgaXRlbXMgPT09IHVuZGVmaW5lZDsgfSwgbmV3IE51bGxSZXBlYXRTdHJhdGVneSgpKTtcclxuICAgICAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykgeyByZXR1cm4gaXRlbXMgaW5zdGFuY2VvZiBBcnJheTsgfSwgbmV3IEFycmF5UmVwZWF0U3RyYXRlZ3koKSk7XHJcbiAgICAgICAgdGhpcy5hZGRTdHJhdGVneShmdW5jdGlvbiAoaXRlbXMpIHsgcmV0dXJuIGl0ZW1zIGluc3RhbmNlb2YgTWFwOyB9LCBuZXcgTWFwUmVwZWF0U3RyYXRlZ3koKSk7XHJcbiAgICAgICAgdGhpcy5hZGRTdHJhdGVneShmdW5jdGlvbiAoaXRlbXMpIHsgcmV0dXJuIGl0ZW1zIGluc3RhbmNlb2YgU2V0OyB9LCBuZXcgU2V0UmVwZWF0U3RyYXRlZ3koKSk7XHJcbiAgICAgICAgdGhpcy5hZGRTdHJhdGVneShmdW5jdGlvbiAoaXRlbXMpIHsgcmV0dXJuIHR5cGVvZiBpdGVtcyA9PT0gJ251bWJlcic7IH0sIG5ldyBOdW1iZXJSZXBlYXRTdHJhdGVneSgpKTtcclxuICAgIH1cclxuICAgIFJlcGVhdFN0cmF0ZWd5TG9jYXRvci5wcm90b3R5cGUuYWRkU3RyYXRlZ3kgPSBmdW5jdGlvbiAobWF0Y2hlciwgc3RyYXRlZ3kpIHtcclxuICAgICAgICB0aGlzLm1hdGNoZXJzLnB1c2gobWF0Y2hlcik7XHJcbiAgICAgICAgdGhpcy5zdHJhdGVnaWVzLnB1c2goc3RyYXRlZ3kpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdFN0cmF0ZWd5TG9jYXRvci5wcm90b3R5cGUuZ2V0U3RyYXRlZ3kgPSBmdW5jdGlvbiAoaXRlbXMpIHtcclxuICAgICAgICB2YXIgbWF0Y2hlcnMgPSB0aGlzLm1hdGNoZXJzO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG1hdGNoZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgaWYgKG1hdGNoZXJzW2ldKGl0ZW1zKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyYXRlZ2llc1tpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmVwZWF0U3RyYXRlZ3lMb2NhdG9yO1xyXG59KCkpO1xuXG52YXIgbGlmZWN5Y2xlT3B0aW9uYWxCZWhhdmlvcnMgPSBbJ2ZvY3VzJywgJ2lmJywgJ2Vsc2UnLCAncmVwZWF0JywgJ3Nob3cnLCAnaGlkZScsICd3aXRoJ107XHJcbmZ1bmN0aW9uIGJlaGF2aW9yUmVxdWlyZXNMaWZlY3ljbGUoaW5zdHJ1Y3Rpb24pIHtcclxuICAgIHZhciB0ID0gaW5zdHJ1Y3Rpb24udHlwZTtcclxuICAgIHZhciBuYW1lID0gdC5lbGVtZW50TmFtZSAhPT0gbnVsbCA/IHQuZWxlbWVudE5hbWUgOiB0LmF0dHJpYnV0ZU5hbWU7XHJcbiAgICByZXR1cm4gbGlmZWN5Y2xlT3B0aW9uYWxCZWhhdmlvcnMuaW5kZXhPZihuYW1lKSA9PT0gLTEgJiYgKHQuaGFuZGxlc0F0dGFjaGVkIHx8IHQuaGFuZGxlc0JpbmQgfHwgdC5oYW5kbGVzQ3JlYXRlZCB8fCB0LmhhbmRsZXNEZXRhY2hlZCB8fCB0LmhhbmRsZXNVbmJpbmQpXHJcbiAgICAgICAgfHwgdC52aWV3RmFjdG9yeSAmJiB2aWV3c1JlcXVpcmVMaWZlY3ljbGUodC52aWV3RmFjdG9yeSlcclxuICAgICAgICB8fCBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSAmJiB2aWV3c1JlcXVpcmVMaWZlY3ljbGUoaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkpO1xyXG59XHJcbmZ1bmN0aW9uIHRhcmdldFJlcXVpcmVzTGlmZWN5Y2xlKGluc3RydWN0aW9uKSB7XHJcbiAgICB2YXIgYmVoYXZpb3JzID0gaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnM7XHJcbiAgICBpZiAoYmVoYXZpb3JzKSB7XHJcbiAgICAgICAgdmFyIGkgPSBiZWhhdmlvcnMubGVuZ3RoO1xyXG4gICAgICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICAgICAgaWYgKGJlaGF2aW9yUmVxdWlyZXNMaWZlY3ljbGUoYmVoYXZpb3JzW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgJiYgdmlld3NSZXF1aXJlTGlmZWN5Y2xlKGluc3RydWN0aW9uLnZpZXdGYWN0b3J5KTtcclxufVxyXG5mdW5jdGlvbiB2aWV3c1JlcXVpcmVMaWZlY3ljbGUodmlld0ZhY3RvcnkpIHtcclxuICAgIGlmICgnX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZScgaW4gdmlld0ZhY3RvcnkpIHtcclxuICAgICAgICByZXR1cm4gdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZTtcclxuICAgIH1cclxuICAgIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSBmYWxzZTtcclxuICAgIGlmICh2aWV3RmFjdG9yeS52aWV3RmFjdG9yeSkge1xyXG4gICAgICAgIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSB2aWV3c1JlcXVpcmVMaWZlY3ljbGUodmlld0ZhY3Rvcnkudmlld0ZhY3RvcnkpO1xyXG4gICAgICAgIHJldHVybiB2aWV3RmFjdG9yeS5fdmlld3NSZXF1aXJlTGlmZWN5Y2xlO1xyXG4gICAgfVxyXG4gICAgaWYgKHZpZXdGYWN0b3J5LnRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5hdS1hbmltYXRlJykpIHtcclxuICAgICAgICB2aWV3RmFjdG9yeS5fdmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGZvciAodmFyIGlkIGluIHZpZXdGYWN0b3J5Lmluc3RydWN0aW9ucykge1xyXG4gICAgICAgIGlmICh0YXJnZXRSZXF1aXJlc0xpZmVjeWNsZSh2aWV3RmFjdG9yeS5pbnN0cnVjdGlvbnNbaWRdKSkge1xyXG4gICAgICAgICAgICB2aWV3RmFjdG9yeS5fdmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZSA9IGZhbHNlO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XG5cbnZhciBBYnN0cmFjdFJlcGVhdGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFic3RyYWN0UmVwZWF0ZXIob3B0aW9ucykge1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywge1xyXG4gICAgICAgICAgICBsb2NhbDogJ2l0ZW1zJyxcclxuICAgICAgICAgICAgdmlld3NSZXF1aXJlTGlmZWN5Y2xlOiB0cnVlXHJcbiAgICAgICAgfSwgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS52aWV3Q291bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgdmlld0NvdW50YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnZpZXdzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHZpZXdzYCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnZpZXcgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGB2aWV3YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLm1hdGNoZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgbWF0Y2hlcmAnKTtcclxuICAgIH07XHJcbiAgICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS5hZGRWaWV3ID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGBhZGRWaWV3YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLmluc2VydFZpZXcgPSBmdW5jdGlvbiAoaW5kZXgsIGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGBpbnNlcnRWaWV3YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLm1vdmVWaWV3ID0gZnVuY3Rpb24gKHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYG1vdmVWaWV3YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnJlbW92ZUFsbFZpZXdzID0gZnVuY3Rpb24gKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGByZW1vdmVBbGxWaWV3c2AnKTtcclxuICAgIH07XHJcbiAgICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS5yZW1vdmVWaWV3cyA9IGZ1bmN0aW9uICh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgcmVtb3ZlVmlld2AnKTtcclxuICAgIH07XHJcbiAgICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS5yZW1vdmVWaWV3ID0gZnVuY3Rpb24gKGluZGV4LCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgcmVtb3ZlVmlld2AnKTtcclxuICAgIH07XHJcbiAgICBBYnN0cmFjdFJlcGVhdGVyLnByb3RvdHlwZS51cGRhdGVCaW5kaW5ncyA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgdXBkYXRlQmluZGluZ3NgJyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEFic3RyYWN0UmVwZWF0ZXI7XHJcbn0oKSk7XG5cbnZhciBtYXRjaGVyRXh0cmFjdGlvbk1hcmtlciA9ICdfX21hcmtlcl9leHRyYWN0ZWRfXyc7XHJcbnZhciBSZXBlYXQgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFJlcGVhdCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFJlcGVhdCh2aWV3RmFjdG9yeSwgaW5zdHJ1Y3Rpb24sIHZpZXdTbG90LCB2aWV3UmVzb3VyY2VzLCBvYnNlcnZlckxvY2F0b3IsIHN0cmF0ZWd5TG9jYXRvcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHtcclxuICAgICAgICAgICAgbG9jYWw6ICdpdGVtJyxcclxuICAgICAgICAgICAgdmlld3NSZXF1aXJlTGlmZWN5Y2xlOiB2aWV3c1JlcXVpcmVMaWZlY3ljbGUodmlld0ZhY3RvcnkpXHJcbiAgICAgICAgfSkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIF90aGlzLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgX3RoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcclxuICAgICAgICBfdGhpcy5sb29rdXBGdW5jdGlvbnMgPSB2aWV3UmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucztcclxuICAgICAgICBfdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XHJcbiAgICAgICAgX3RoaXMua2V5ID0gJ2tleSc7XHJcbiAgICAgICAgX3RoaXMudmFsdWUgPSAndmFsdWUnO1xyXG4gICAgICAgIF90aGlzLnN0cmF0ZWd5TG9jYXRvciA9IHN0cmF0ZWd5TG9jYXRvcjtcclxuICAgICAgICBfdGhpcy5pZ25vcmVNdXRhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIF90aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBnZXRJdGVtc1NvdXJjZUV4cHJlc3Npb24oX3RoaXMuaW5zdHJ1Y3Rpb24sICdyZXBlYXQuZm9yJyk7XHJcbiAgICAgICAgX3RoaXMuaXNPbmVUaW1lID0gaXNPbmVUaW1lKF90aGlzLnNvdXJjZUV4cHJlc3Npb24pO1xyXG4gICAgICAgIF90aGlzLnZpZXdzUmVxdWlyZUxpZmVjeWNsZSA9IHZpZXdzUmVxdWlyZUxpZmVjeWNsZSh2aWV3RmFjdG9yeSk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgUmVwZWF0XzEgPSBSZXBlYXQ7XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAoY29udGV4dCwgY2hhbmdlcykge1xyXG4gICAgICAgIHRoaXNbY29udGV4dF0odGhpcy5pdGVtcywgY2hhbmdlcyk7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLnNjb3BlID0geyBiaW5kaW5nQ29udGV4dDogYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dDogb3ZlcnJpZGVDb250ZXh0IH07XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gdGhpcy5pbnN0cnVjdGlvbjtcclxuICAgICAgICBpZiAoIShtYXRjaGVyRXh0cmFjdGlvbk1hcmtlciBpbiBpbnN0cnVjdGlvbikpIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25bbWF0Y2hlckV4dHJhY3Rpb25NYXJrZXJdID0gdGhpcy5fY2FwdHVyZUFuZFJlbW92ZU1hdGNoZXJCaW5kaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubWF0Y2hlckJpbmRpbmcgPSBpbnN0cnVjdGlvblttYXRjaGVyRXh0cmFjdGlvbk1hcmtlcl07XHJcbiAgICAgICAgdGhpcy5pdGVtc0NoYW5nZWQoKTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnNjb3BlID0gbnVsbDtcclxuICAgICAgICB0aGlzLml0ZW1zID0gbnVsbDtcclxuICAgICAgICB0aGlzLm1hdGNoZXJCaW5kaW5nID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZXdTbG90LnJlbW92ZUFsbCh0cnVlLCB0cnVlKTtcclxuICAgICAgICB0aGlzLl91bnN1YnNjcmliZUNvbGxlY3Rpb24oKTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLl91bnN1YnNjcmliZUNvbGxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29sbGVjdGlvbk9ic2VydmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyLnVuc3Vic2NyaWJlKHRoaXMuY2FsbENvbnRleHQsIHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb25PYnNlcnZlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbENvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLml0ZW1zQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuX3Vuc3Vic2NyaWJlQ29sbGVjdGlvbigpO1xyXG4gICAgICAgIGlmICghdGhpcy5zY29wZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpdGVtcyA9IHRoaXMuaXRlbXM7XHJcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9IHRoaXMuc3RyYXRlZ3lMb2NhdG9yLmdldFN0cmF0ZWd5KGl0ZW1zKTtcclxuICAgICAgICBpZiAoIXRoaXMuc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgZm9yICdcIiArIHRoaXMuc291cmNlRXhwcmVzc2lvbiArIFwiJyBpcyBub24tcmVwZWF0YWJsZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzT25lVGltZSAmJiAhdGhpcy5fb2JzZXJ2ZUlubmVyQ29sbGVjdGlvbigpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX29ic2VydmVDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaWdub3JlTXV0YXRpb24gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc3RyYXRlZ3kuaW5zdGFuY2VDaGFuZ2VkKHRoaXMsIGl0ZW1zKTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5pZ25vcmVNdXRhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuX2dldElubmVyQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZXhwcmVzc2lvbiA9IHVud3JhcEV4cHJlc3Npb24odGhpcy5zb3VyY2VFeHByZXNzaW9uKTtcclxuICAgICAgICBpZiAoIWV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBleHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIG51bGwpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuaGFuZGxlQ29sbGVjdGlvbk11dGF0ZWQgPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgY2hhbmdlcykge1xyXG4gICAgICAgIGlmICghdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pZ25vcmVNdXRhdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc3RyYXRlZ3kuaW5zdGFuY2VNdXRhdGVkKHRoaXMsIGNvbGxlY3Rpb24sIGNoYW5nZXMpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuaGFuZGxlSW5uZXJDb2xsZWN0aW9uTXV0YXRlZCA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBjaGFuZ2VzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoIXRoaXMuY29sbGVjdGlvbk9ic2VydmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlTXV0YXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlnbm9yZU11dGF0aW9uID0gdHJ1ZTtcclxuICAgICAgICB2YXIgbmV3SXRlbXMgPSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zY29wZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayhmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5pZ25vcmVNdXRhdGlvbiA9IGZhbHNlOyB9KTtcclxuICAgICAgICBpZiAobmV3SXRlbXMgPT09IHRoaXMuaXRlbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtc0NoYW5nZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBuZXdJdGVtcztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5fb2JzZXJ2ZUlubmVyQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLl9nZXRJbm5lckNvbGxlY3Rpb24oKTtcclxuICAgICAgICB2YXIgc3RyYXRlZ3kgPSB0aGlzLnN0cmF0ZWd5TG9jYXRvci5nZXRTdHJhdGVneShpdGVtcyk7XHJcbiAgICAgICAgaWYgKCFzdHJhdGVneSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyID0gc3RyYXRlZ3kuZ2V0Q29sbGVjdGlvbk9ic2VydmVyKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCBpdGVtcyk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb25PYnNlcnZlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2FsbENvbnRleHQgPSAnaGFuZGxlSW5uZXJDb2xsZWN0aW9uTXV0YXRlZCc7XHJcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIuc3Vic2NyaWJlKHRoaXMuY2FsbENvbnRleHQsIHRoaXMpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuX29ic2VydmVDb2xsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpdGVtcyA9IHRoaXMuaXRlbXM7XHJcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIgPSB0aGlzLnN0cmF0ZWd5LmdldENvbGxlY3Rpb25PYnNlcnZlcih0aGlzLm9ic2VydmVyTG9jYXRvciwgaXRlbXMpO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb25PYnNlcnZlcikge1xyXG4gICAgICAgICAgICB0aGlzLmNhbGxDb250ZXh0ID0gJ2hhbmRsZUNvbGxlY3Rpb25NdXRhdGVkJztcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIuc3Vic2NyaWJlKHRoaXMuY2FsbENvbnRleHQsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLl9jYXB0dXJlQW5kUmVtb3ZlTWF0Y2hlckJpbmRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHZpZXdGYWN0b3J5ID0gdGhpcy52aWV3RmFjdG9yeS52aWV3RmFjdG9yeTtcclxuICAgICAgICBpZiAodmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gdmlld0ZhY3RvcnkudGVtcGxhdGU7XHJcbiAgICAgICAgICAgIHZhciBpbnN0cnVjdGlvbnMgPSB2aWV3RmFjdG9yeS5pbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgICAgIGlmIChSZXBlYXRfMS51c2VJbm5lck1hdGNoZXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBleHRyYWN0TWF0Y2hlckJpbmRpbmdFeHByZXNzaW9uKGluc3RydWN0aW9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGdldENoaWxkcmVuQ291bnQodGVtcGxhdGUpID4gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVwZWF0ZWRFbGVtZW50ID0gZ2V0Rmlyc3RFbGVtZW50Q2hpbGQodGVtcGxhdGUpO1xyXG4gICAgICAgICAgICBpZiAoIXJlcGVhdGVkRWxlbWVudC5oYXNBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXBlYXRlZEVsZW1lbnRUYXJnZXRJZCA9IHJlcGVhdGVkRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpO1xyXG4gICAgICAgICAgICByZXR1cm4gZXh0cmFjdE1hdGNoZXJCaW5kaW5nRXhwcmVzc2lvbihpbnN0cnVjdGlvbnMsIHJlcGVhdGVkRWxlbWVudFRhcmdldElkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLnZpZXdDb3VudCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMudmlld1Nsb3QuY2hpbGRyZW4ubGVuZ3RoOyB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS52aWV3cyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMudmlld1Nsb3QuY2hpbGRyZW47IH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLnZpZXcgPSBmdW5jdGlvbiAoaW5kZXgpIHsgcmV0dXJuIHRoaXMudmlld1Nsb3QuY2hpbGRyZW5baW5kZXhdOyB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5tYXRjaGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBtYXRjaGVyQmluZGluZyA9IHRoaXMubWF0Y2hlckJpbmRpbmc7XHJcbiAgICAgICAgcmV0dXJuIG1hdGNoZXJCaW5kaW5nXHJcbiAgICAgICAgICAgID8gbWF0Y2hlckJpbmRpbmcuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNjb3BlLCBtYXRjaGVyQmluZGluZy5sb29rdXBGdW5jdGlvbnMpXHJcbiAgICAgICAgICAgIDogbnVsbDtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLmFkZFZpZXcgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHZhciB2aWV3ID0gdGhpcy52aWV3RmFjdG9yeS5jcmVhdGUoKTtcclxuICAgICAgICB2aWV3LmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdC5hZGQodmlldyk7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5pbnNlcnRWaWV3ID0gZnVuY3Rpb24gKGluZGV4LCBiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSgpO1xyXG4gICAgICAgIHZpZXcuYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB0aGlzLnZpZXdTbG90Lmluc2VydChpbmRleCwgdmlldyk7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5tb3ZlVmlldyA9IGZ1bmN0aW9uIChzb3VyY2VJbmRleCwgdGFyZ2V0SW5kZXgpIHtcclxuICAgICAgICB0aGlzLnZpZXdTbG90Lm1vdmUoc291cmNlSW5kZXgsIHRhcmdldEluZGV4KTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLnJlbW92ZUFsbFZpZXdzID0gZnVuY3Rpb24gKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3U2xvdC5yZW1vdmVBbGwocmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbik7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5yZW1vdmVWaWV3cyA9IGZ1bmN0aW9uICh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1Nsb3QucmVtb3ZlTWFueSh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiAoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3U2xvdC5yZW1vdmVBdChpbmRleCwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbik7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS51cGRhdGVCaW5kaW5ncyA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgdmFyICR2aWV3ID0gdmlldztcclxuICAgICAgICB2YXIgaiA9ICR2aWV3LmJpbmRpbmdzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZSAoai0tKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZU9uZVRpbWVCaW5kaW5nKCR2aWV3LmJpbmRpbmdzW2pdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaiA9ICR2aWV3LmNvbnRyb2xsZXJzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZSAoai0tKSB7XHJcbiAgICAgICAgICAgIHZhciBrID0gJHZpZXcuY29udHJvbGxlcnNbal0uYm91bmRQcm9wZXJ0aWVzLmxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGstLSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJpbmRpbmcgPSAkdmlldy5jb250cm9sbGVyc1tqXS5ib3VuZFByb3BlcnRpZXNba10uYmluZGluZztcclxuICAgICAgICAgICAgICAgIHVwZGF0ZU9uZVRpbWVCaW5kaW5nKGJpbmRpbmcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHZhciBSZXBlYXRfMTtcclxuICAgIFJlcGVhdC51c2VJbm5lck1hdGNoZXIgPSB0cnVlO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIFJlcGVhdC5wcm90b3R5cGUsIFwiaXRlbXNcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBSZXBlYXQucHJvdG90eXBlLCBcImxvY2FsXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kYWJsZVxyXG4gICAgXSwgUmVwZWF0LnByb3RvdHlwZSwgXCJrZXlcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBSZXBlYXQucHJvdG90eXBlLCBcInZhbHVlXCIsIHZvaWQgMCk7XHJcbiAgICBSZXBlYXQgPSBSZXBlYXRfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgncmVwZWF0JyksXHJcbiAgICAgICAgdGVtcGxhdGVDb250cm9sbGVyLFxyXG4gICAgICAgIGluamVjdChCb3VuZFZpZXdGYWN0b3J5LCBUYXJnZXRJbnN0cnVjdGlvbiwgVmlld1Nsb3QsIFZpZXdSZXNvdXJjZXMsIE9ic2VydmVyTG9jYXRvciwgUmVwZWF0U3RyYXRlZ3lMb2NhdG9yKVxyXG4gICAgXSwgUmVwZWF0KTtcclxuICAgIHJldHVybiBSZXBlYXQ7XHJcbn0oQWJzdHJhY3RSZXBlYXRlcikpO1xyXG52YXIgZXh0cmFjdE1hdGNoZXJCaW5kaW5nRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIChpbnN0cnVjdGlvbnMsIHRhcmdldGVkRWxlbWVudElkKSB7XHJcbiAgICB2YXIgaW5zdHJ1Y3Rpb25JZHMgPSBPYmplY3Qua2V5cyhpbnN0cnVjdGlvbnMpO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnN0cnVjdGlvbklkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbklkID0gaW5zdHJ1Y3Rpb25JZHNbaV07XHJcbiAgICAgICAgaWYgKHRhcmdldGVkRWxlbWVudElkICE9PSB1bmRlZmluZWQgJiYgaW5zdHJ1Y3Rpb25JZCAhPT0gdGFyZ2V0ZWRFbGVtZW50SWQpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBleHByZXNzaW9ucyA9IGluc3RydWN0aW9uc1tpbnN0cnVjdGlvbklkXS5leHByZXNzaW9ucztcclxuICAgICAgICBpZiAoZXhwcmVzc2lvbnMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IGV4cHJlc3Npb25zLmxlbmd0aDsgaWkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4cHJlc3Npb25zW2lpXS50YXJnZXRQcm9wZXJ0eSA9PT0gJ21hdGNoZXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoZXJCaW5kaW5nRXhwcmVzc2lvbiA9IGV4cHJlc3Npb25zW2lpXTtcclxuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5zcGxpY2UoaWksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyQmluZGluZ0V4cHJlc3Npb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbnZhciBnZXRDaGlsZHJlbkNvdW50ID0gZnVuY3Rpb24gKGVsKSB7XHJcbiAgICB2YXIgY2hpbGROb2RlcyA9IGVsLmNoaWxkTm9kZXM7XHJcbiAgICB2YXIgY291bnQgPSAwO1xyXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGROb2Rlcy5sZW5ndGg7IGlpID4gaTsgKytpKSB7XHJcbiAgICAgICAgaWYgKGNoaWxkTm9kZXNbaV0ubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgKytjb3VudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY291bnQ7XHJcbn07XHJcbnZhciBnZXRGaXJzdEVsZW1lbnRDaGlsZCA9IGZ1bmN0aW9uIChlbCkge1xyXG4gICAgdmFyIGZpcnN0Q2hpbGQgPSBlbC5maXJzdENoaWxkO1xyXG4gICAgd2hpbGUgKGZpcnN0Q2hpbGQgIT09IG51bGwpIHtcclxuICAgICAgICBpZiAoZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmlyc3RDaGlsZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmlyc3RDaGlsZCA9IGZpcnN0Q2hpbGQubmV4dFNpYmxpbmc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcblxudmFyIGF1cmVsaWFIaWRlQ2xhc3NOYW1lID0gJ2F1cmVsaWEtaGlkZSc7XHJcbnZhciBhdXJlbGlhSGlkZUNsYXNzID0gXCIuXCIgKyBhdXJlbGlhSGlkZUNsYXNzTmFtZSArIFwiIHsgZGlzcGxheTpub25lICFpbXBvcnRhbnQ7IH1cIjtcclxuZnVuY3Rpb24gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0SGVhZCgpIHtcclxuICAgIERPTS5pbmplY3RTdHlsZXMoYXVyZWxpYUhpZGVDbGFzcyk7XHJcbn1cclxuZnVuY3Rpb24gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkoZG9tQm91bmRhcnkpIHtcclxuICAgIGlmIChGRUFUVVJFLnNoYWRvd0RPTSAmJiBkb21Cb3VuZGFyeSAmJiAhZG9tQm91bmRhcnkuaGFzQXVyZWxpYUhpZGVTdHlsZSkge1xyXG4gICAgICAgIGRvbUJvdW5kYXJ5Lmhhc0F1cmVsaWFIaWRlU3R5bGUgPSB0cnVlO1xyXG4gICAgICAgIERPTS5pbmplY3RTdHlsZXMoYXVyZWxpYUhpZGVDbGFzcywgZG9tQm91bmRhcnkpO1xyXG4gICAgfVxyXG59XG5cbnZhciBTaG93ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNob3coZWxlbWVudCwgYW5pbWF0b3IsIGRvbUJvdW5kYXJ5KSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB0aGlzLmFuaW1hdG9yID0gYW5pbWF0b3I7XHJcbiAgICAgICAgdGhpcy5kb21Cb3VuZGFyeSA9IGRvbUJvdW5kYXJ5O1xyXG4gICAgfVxyXG4gICAgU2hvdy5pbmplY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtET00uRWxlbWVudCwgQW5pbWF0b3IsIE9wdGlvbmFsLm9mKERPTS5ib3VuZGFyeSwgdHJ1ZSldO1xyXG4gICAgfTtcclxuICAgIFNob3cucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkodGhpcy5kb21Cb3VuZGFyeSk7XHJcbiAgICB9O1xyXG4gICAgU2hvdy5wcm90b3R5cGUudmFsdWVDaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XHJcbiAgICAgICAgdmFyIGFuaW1hdG9yID0gdGhpcy5hbmltYXRvcjtcclxuICAgICAgICBpZiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgYW5pbWF0b3IucmVtb3ZlQ2xhc3MoZWxlbWVudCwgYXVyZWxpYUhpZGVDbGFzc05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYW5pbWF0b3IuYWRkQ2xhc3MoZWxlbWVudCwgYXVyZWxpYUhpZGVDbGFzc05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaG93LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZWQodGhpcy52YWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgU2hvdyA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgnc2hvdycpXHJcbiAgICBdLCBTaG93KTtcclxuICAgIHJldHVybiBTaG93O1xyXG59KCkpO1xuXG52YXIgSGlkZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBIaWRlKGVsZW1lbnQsIGFuaW1hdG9yLCBkb21Cb3VuZGFyeSkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5hbmltYXRvciA9IGFuaW1hdG9yO1xyXG4gICAgICAgIHRoaXMuZG9tQm91bmRhcnkgPSBkb21Cb3VuZGFyeTtcclxuICAgIH1cclxuICAgIEhpZGUuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbRE9NLkVsZW1lbnQsIEFuaW1hdG9yLCBPcHRpb25hbC5vZihET00uYm91bmRhcnksIHRydWUpXTtcclxuICAgIH07XHJcbiAgICBIaWRlLnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluamVjdEF1cmVsaWFIaWRlU3R5bGVBdEJvdW5kYXJ5KHRoaXMuZG9tQm91bmRhcnkpO1xyXG4gICAgfTtcclxuICAgIEhpZGUucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdG9yLmFkZENsYXNzKHRoaXMuZWxlbWVudCwgYXVyZWxpYUhpZGVDbGFzc05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRvci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQsIGF1cmVsaWFIaWRlQ2xhc3NOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSGlkZS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2VkKHRoaXMudmFsdWUpO1xyXG4gICAgfTtcclxuICAgIEhpZGUucHJvdG90eXBlLnZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xyXG4gICAgfTtcclxuICAgIEhpZGUgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ2hpZGUnKVxyXG4gICAgXSwgSGlkZSk7XHJcbiAgICByZXR1cm4gSGlkZTtcclxufSgpKTtcblxudmFyIFNDUklQVF9SRUdFWCA9IC88c2NyaXB0XFxiW148XSooPzooPyE8XFwvc2NyaXB0Pik8W148XSopKjxcXC9zY3JpcHQ+L2dpO1xyXG52YXIgbmVlZHNUb1dhcm4gPSB0cnVlO1xyXG52YXIgSFRNTFNhbml0aXplciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBIVE1MU2FuaXRpemVyKCkge1xyXG4gICAgfVxyXG4gICAgSFRNTFNhbml0aXplci5wcm90b3R5cGUuc2FuaXRpemUgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICBpZiAobmVlZHNUb1dhcm4pIHtcclxuICAgICAgICAgICAgbmVlZHNUb1dhcm4gPSBmYWxzZTtcclxuICAgICAgICAgICAgZ2V0TG9nZ2VyKCdodG1sLXNhbml0aXplcicpXHJcbiAgICAgICAgICAgICAgICAud2FybihcIkNBVVRJT046IFRoZSBkZWZhdWx0IEhUTUxTYW5pdGl6ZXIgZG9lcyBOT1QgcHJvdmlkZSBzZWN1cml0eSBhZ2FpbnN0IGEgd2lkZSB2YXJpZXR5IG9mIHNvcGhpc3RpY2F0ZWQgWFNTIGF0dGFja3MsXFxuYW5kIHNob3VsZCBub3QgYmUgcmVsaWVkIG9uIGZvciBzYW5pdGl6aW5nIGlucHV0IGZyb20gdW5rbm93biBzb3VyY2VzLlxcblBsZWFzZSBzZWUgaHR0cHM6Ly9hdXJlbGlhLmlvL2RvY3MvYmluZGluZy9iYXNpY3MjZWxlbWVudC1jb250ZW50IGZvciBpbnN0cnVjdGlvbnMgb24gaG93IHRvIHVzZSBhIHNlY3VyZSBzb2x1dGlvbiBsaWtlIERPTVB1cmlmeSBvciBzYW5pdGl6ZS1odG1sLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcGxhY2UoU0NSSVBUX1JFR0VYLCAnJyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEhUTUxTYW5pdGl6ZXI7XHJcbn0oKSk7XG5cbnZhciBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlcihzYW5pdGl6ZXIpIHtcclxuICAgICAgICB0aGlzLnNhbml0aXplciA9IHNhbml0aXplcjtcclxuICAgIH1cclxuICAgIFNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS50b1ZpZXcgPSBmdW5jdGlvbiAodW50cnVzdGVkTWFya3VwKSB7XHJcbiAgICAgICAgaWYgKHVudHJ1c3RlZE1hcmt1cCA9PT0gbnVsbCB8fCB1bnRydXN0ZWRNYXJrdXAgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2FuaXRpemVyLnNhbml0aXplKHVudHJ1c3RlZE1hcmt1cCk7XHJcbiAgICB9O1xyXG4gICAgU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXIgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2YWx1ZUNvbnZlcnRlcignc2FuaXRpemVIVE1MJyksXHJcbiAgICAgICAgaW5qZWN0KEhUTUxTYW5pdGl6ZXIpXHJcbiAgICBdLCBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlcik7XHJcbiAgICByZXR1cm4gU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXI7XHJcbn0oKSk7XG5cbnZhciBSZXBsYWNlYWJsZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZXBsYWNlYWJsZSh2aWV3RmFjdG9yeSwgdmlld1Nsb3QpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdCA9IHZpZXdTbG90O1xyXG4gICAgICAgIHRoaXMudmlldyA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBSZXBsYWNlYWJsZS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMudmlldyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdTbG90LmFkZCh0aGlzLnZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZpZXcuYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBSZXBsYWNlYWJsZS5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcclxuICAgIH07XHJcbiAgICBSZXBsYWNlYWJsZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgncmVwbGFjZWFibGUnKSxcclxuICAgICAgICB0ZW1wbGF0ZUNvbnRyb2xsZXIsXHJcbiAgICAgICAgaW5qZWN0KEJvdW5kVmlld0ZhY3RvcnksIFZpZXdTbG90KVxyXG4gICAgXSwgUmVwbGFjZWFibGUpO1xyXG4gICAgcmV0dXJuIFJlcGxhY2VhYmxlO1xyXG59KCkpO1xuXG52YXIgRm9jdXMgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRm9jdXMoZWxlbWVudCwgdGFza1F1ZXVlKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm5lZWRzQXBwbHkgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIEZvY3VzLmluamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW0RPTS5FbGVtZW50LCBUYXNrUXVldWVdO1xyXG4gICAgfTtcclxuICAgIEZvY3VzLnByb3RvdHlwZS52YWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5lZWRzQXBwbHkgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBGb2N1cy5wcm90b3R5cGUuX2FwcGx5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMudmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5ibHVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEZvY3VzLnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLm5lZWRzQXBwbHkpIHtcclxuICAgICAgICAgICAgdGhpcy5uZWVkc0FwcGx5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcyk7XHJcbiAgICB9O1xyXG4gICAgRm9jdXMucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcyk7XHJcbiAgICB9O1xyXG4gICAgRm9jdXMucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoZS50eXBlID09PSAnZm9jdXMnKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChET00uYWN0aXZlRWxlbWVudCAhPT0gdGhpcy5lbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRm9jdXMgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ2ZvY3VzJywgYmluZGluZ01vZGUudHdvV2F5KVxyXG4gICAgXSwgRm9jdXMpO1xyXG4gICAgcmV0dXJuIEZvY3VzO1xyXG59KCkpO1xuXG52YXIgY3NzVXJsTWF0Y2hlciA9IC91cmxcXCgoPyFbJ1wiXWRhdGEpKFteKV0rKVxcKS9naTtcclxuZnVuY3Rpb24gZml4dXBDU1NVcmxzKGFkZHJlc3MsIGNzcykge1xyXG4gICAgaWYgKHR5cGVvZiBjc3MgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIGxvYWRpbmcgcmVxdWlyZWQgQ1NTIGZpbGU6IFwiICsgYWRkcmVzcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY3NzLnJlcGxhY2UoY3NzVXJsTWF0Y2hlciwgZnVuY3Rpb24gKG1hdGNoLCBwMSkge1xyXG4gICAgICAgIHZhciBxdW90ZSA9IHAxLmNoYXJBdCgwKTtcclxuICAgICAgICBpZiAocXVvdGUgPT09ICdcXCcnIHx8IHF1b3RlID09PSAnXCInKSB7XHJcbiAgICAgICAgICAgIHAxID0gcDEuc3Vic3RyKDEsIHAxLmxlbmd0aCAtIDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJ3VybChcXCcnICsgcmVsYXRpdmVUb0ZpbGUocDEsIGFkZHJlc3MpICsgJ1xcJyknO1xyXG4gICAgfSk7XHJcbn1cclxudmFyIENTU1Jlc291cmNlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENTU1Jlc291cmNlKGFkZHJlc3MpIHtcclxuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xyXG4gICAgICAgIHRoaXMuX3Njb3BlZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fZ2xvYmFsID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fYWxyZWFkeUdsb2JhbGx5SW5qZWN0ZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIENTU1Jlc291cmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgVGFyZ2V0KSB7XHJcbiAgICAgICAgdGhpcy5fc2NvcGVkID0gbmV3IFRhcmdldCh0aGlzKTtcclxuICAgIH07XHJcbiAgICBDU1NSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHtcclxuICAgICAgICBpZiAobmFtZSA9PT0gJ3Njb3BlZCcpIHtcclxuICAgICAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXJWaWV3RW5naW5lSG9va3ModGhpcy5fc2NvcGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2dsb2JhbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENTU1Jlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXQoTG9hZGVyKVxyXG4gICAgICAgICAgICAubG9hZFRleHQodGhpcy5hZGRyZXNzKVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikgeyByZXR1cm4gbnVsbDsgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICAgICAgdGV4dCA9IGZpeHVwQ1NTVXJscyhfdGhpcy5hZGRyZXNzLCB0ZXh0KTtcclxuICAgICAgICAgICAgX3RoaXMuX3Njb3BlZC5jc3MgPSB0ZXh0O1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuX2dsb2JhbCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX2FscmVhZHlHbG9iYWxseUluamVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIERPTS5pbmplY3RTdHlsZXModGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ1NTUmVzb3VyY2U7XHJcbn0oKSk7XHJcbnZhciBDU1NWaWV3RW5naW5lSG9va3MgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ1NTVmlld0VuZ2luZUhvb2tzKG93bmVyKSB7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgICAgIHRoaXMuY3NzID0gbnVsbDtcclxuICAgIH1cclxuICAgIENTU1ZpZXdFbmdpbmVIb29rcy5wcm90b3R5cGUuYmVmb3JlQ29tcGlsZSA9IGZ1bmN0aW9uIChjb250ZW50LCByZXNvdXJjZXMsIGluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSkge1xyXG4gICAgICAgICAgICBET00uaW5qZWN0U3R5bGVzKHRoaXMuY3NzLCBjb250ZW50LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoRkVBVFVSRS5zY29wZWRDU1MpIHtcclxuICAgICAgICAgICAgdmFyIHN0eWxlTm9kZSA9IERPTS5pbmplY3RTdHlsZXModGhpcy5jc3MsIGNvbnRlbnQsIHRydWUpO1xyXG4gICAgICAgICAgICBzdHlsZU5vZGUuc2V0QXR0cmlidXRlKCdzY29wZWQnLCAnc2NvcGVkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuX2dsb2JhbCAmJiAhdGhpcy5vd25lci5fYWxyZWFkeUdsb2JhbGx5SW5qZWN0ZWQpIHtcclxuICAgICAgICAgICAgRE9NLmluamVjdFN0eWxlcyh0aGlzLmNzcyk7XHJcbiAgICAgICAgICAgIHRoaXMub3duZXIuX2FscmVhZHlHbG9iYWxseUluamVjdGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENTU1ZpZXdFbmdpbmVIb29rcztcclxufSgpKTtcclxuZnVuY3Rpb24gX2NyZWF0ZUNTU1Jlc291cmNlKGFkZHJlc3MpIHtcclxuICAgIHZhciBWaWV3Q1NTID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgICAgICBfX2V4dGVuZHMoVmlld0NTUywgX3N1cGVyKTtcclxuICAgICAgICBmdW5jdGlvbiBWaWV3Q1NTKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFZpZXdDU1MgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICAgICAgcmVzb3VyY2UobmV3IENTU1Jlc291cmNlKGFkZHJlc3MpKVxyXG4gICAgICAgIF0sIFZpZXdDU1MpO1xyXG4gICAgICAgIHJldHVybiBWaWV3Q1NTO1xyXG4gICAgfShDU1NWaWV3RW5naW5lSG9va3MpKTtcclxuICAgIHJldHVybiBWaWV3Q1NTO1xyXG59XG5cbnZhciBBdHRyQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEF0dHJCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICB9XHJcbiAgICBBdHRyQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIGJpbmRpbmcudGFyZ2V0T2JzZXJ2ZXIgPSBuZXcgRGF0YUF0dHJpYnV0ZU9ic2VydmVyKGJpbmRpbmcudGFyZ2V0LCBiaW5kaW5nLnRhcmdldFByb3BlcnR5KTtcclxuICAgIH07XHJcbiAgICBBdHRyQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlKSB7XHJcbiAgICB9O1xyXG4gICAgQXR0ckJpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcignYXR0cicpXHJcbiAgICBdLCBBdHRyQmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBBdHRyQmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xuXG52YXIgbW9kZUJpbmRpbmdCZWhhdmlvciA9IHtcclxuICAgIGJpbmQ6IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UsIGxvb2t1cEZ1bmN0aW9ucykge1xyXG4gICAgICAgIGJpbmRpbmcub3JpZ2luYWxNb2RlID0gYmluZGluZy5tb2RlO1xyXG4gICAgICAgIGJpbmRpbmcubW9kZSA9IHRoaXMubW9kZTtcclxuICAgIH0sXHJcbiAgICB1bmJpbmQ6IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UpIHtcclxuICAgICAgICBiaW5kaW5nLm1vZGUgPSBiaW5kaW5nLm9yaWdpbmFsTW9kZTtcclxuICAgICAgICBiaW5kaW5nLm9yaWdpbmFsTW9kZSA9IG51bGw7XHJcbiAgICB9XHJcbn07XHJcbnZhciBPbmVUaW1lQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE9uZVRpbWVCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlID0gYmluZGluZ01vZGUub25lVGltZTtcclxuICAgIH1cclxuICAgIE9uZVRpbWVCaW5kaW5nQmVoYXZpb3IgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBtaXhpbihtb2RlQmluZGluZ0JlaGF2aW9yKSxcclxuICAgICAgICBiaW5kaW5nQmVoYXZpb3IoJ29uZVRpbWUnKVxyXG4gICAgXSwgT25lVGltZUJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gT25lVGltZUJpbmRpbmdCZWhhdmlvcjtcclxufSgpKTtcclxudmFyIE9uZVdheUJpbmRpbmdCZWhhdmlvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBPbmVXYXlCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlID0gYmluZGluZ01vZGUudG9WaWV3O1xyXG4gICAgfVxyXG4gICAgT25lV2F5QmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgbWl4aW4obW9kZUJpbmRpbmdCZWhhdmlvciksXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCdvbmVXYXknKVxyXG4gICAgXSwgT25lV2F5QmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBPbmVXYXlCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XHJcbnZhciBUb1ZpZXdCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVG9WaWV3QmluZGluZ0JlaGF2aW9yKCkge1xyXG4gICAgICAgIHRoaXMubW9kZSA9IGJpbmRpbmdNb2RlLnRvVmlldztcclxuICAgIH1cclxuICAgIFRvVmlld0JpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIG1peGluKG1vZGVCaW5kaW5nQmVoYXZpb3IpLFxyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcigndG9WaWV3JylcclxuICAgIF0sIFRvVmlld0JpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gVG9WaWV3QmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xyXG52YXIgRnJvbVZpZXdCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRnJvbVZpZXdCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlID0gYmluZGluZ01vZGUuZnJvbVZpZXc7XHJcbiAgICB9XHJcbiAgICBGcm9tVmlld0JpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIG1peGluKG1vZGVCaW5kaW5nQmVoYXZpb3IpLFxyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcignZnJvbVZpZXcnKVxyXG4gICAgXSwgRnJvbVZpZXdCaW5kaW5nQmVoYXZpb3IpO1xyXG4gICAgcmV0dXJuIEZyb21WaWV3QmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xyXG52YXIgVHdvV2F5QmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFR3b1dheUJpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgICAgICB0aGlzLm1vZGUgPSBiaW5kaW5nTW9kZS50d29XYXk7XHJcbiAgICB9XHJcbiAgICBUd29XYXlCaW5kaW5nQmVoYXZpb3IgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBtaXhpbihtb2RlQmluZGluZ0JlaGF2aW9yKSxcclxuICAgICAgICBiaW5kaW5nQmVoYXZpb3IoJ3R3b1dheScpXHJcbiAgICBdLCBUd29XYXlCaW5kaW5nQmVoYXZpb3IpO1xyXG4gICAgcmV0dXJuIFR3b1dheUJpbmRpbmdCZWhhdmlvcjtcclxufSgpKTtcblxuZnVuY3Rpb24gdGhyb3R0bGUobmV3VmFsdWUpIHtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICB2YXIgc3RhdGUgPSB0aGlzLnRocm90dGxlU3RhdGU7XHJcbiAgICB2YXIgZWxhcHNlZCA9ICtuZXcgRGF0ZSgpIC0gc3RhdGUubGFzdDtcclxuICAgIGlmIChlbGFwc2VkID49IHN0YXRlLmRlbGF5KSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHN0YXRlLnRpbWVvdXRJZCk7XHJcbiAgICAgICAgc3RhdGUudGltZW91dElkID0gbnVsbDtcclxuICAgICAgICBzdGF0ZS5sYXN0ID0gK25ldyBEYXRlKCk7XHJcbiAgICAgICAgdGhpcy50aHJvdHRsZWRNZXRob2QobmV3VmFsdWUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHN0YXRlLm5ld1ZhbHVlID0gbmV3VmFsdWU7XHJcbiAgICBpZiAoc3RhdGUudGltZW91dElkID09PSBudWxsKSB7XHJcbiAgICAgICAgc3RhdGUudGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHN0YXRlLnRpbWVvdXRJZCA9IG51bGw7XHJcbiAgICAgICAgICAgIHN0YXRlLmxhc3QgPSArbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgX3RoaXMudGhyb3R0bGVkTWV0aG9kKHN0YXRlLm5ld1ZhbHVlKTtcclxuICAgICAgICB9LCBzdGF0ZS5kZWxheSAtIGVsYXBzZWQpO1xyXG4gICAgfVxyXG59XHJcbnZhciBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgIH1cclxuICAgIFRocm90dGxlQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSwgZGVsYXkpIHtcclxuICAgICAgICBpZiAoZGVsYXkgPT09IHZvaWQgMCkgeyBkZWxheSA9IDIwMDsgfVxyXG4gICAgICAgIHZhciBtZXRob2RUb1Rocm90dGxlID0gJ3VwZGF0ZVRhcmdldCc7XHJcbiAgICAgICAgaWYgKGJpbmRpbmcuY2FsbFNvdXJjZSkge1xyXG4gICAgICAgICAgICBtZXRob2RUb1Rocm90dGxlID0gJ2NhbGxTb3VyY2UnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChiaW5kaW5nLnVwZGF0ZVNvdXJjZSAmJiBiaW5kaW5nLm1vZGUgPT09IGJpbmRpbmdNb2RlLnR3b1dheSkge1xyXG4gICAgICAgICAgICBtZXRob2RUb1Rocm90dGxlID0gJ3VwZGF0ZVNvdXJjZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJpbmRpbmcudGhyb3R0bGVkTWV0aG9kID0gYmluZGluZ1ttZXRob2RUb1Rocm90dGxlXTtcclxuICAgICAgICBiaW5kaW5nLnRocm90dGxlZE1ldGhvZC5vcmlnaW5hbE5hbWUgPSBtZXRob2RUb1Rocm90dGxlO1xyXG4gICAgICAgIGJpbmRpbmdbbWV0aG9kVG9UaHJvdHRsZV0gPSB0aHJvdHRsZTtcclxuICAgICAgICBiaW5kaW5nLnRocm90dGxlU3RhdGUgPSB7XHJcbiAgICAgICAgICAgIGRlbGF5OiBkZWxheSxcclxuICAgICAgICAgICAgbGFzdDogMCxcclxuICAgICAgICAgICAgdGltZW91dElkOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIHZhciBtZXRob2RUb1Jlc3RvcmUgPSBiaW5kaW5nLnRocm90dGxlZE1ldGhvZC5vcmlnaW5hbE5hbWU7XHJcbiAgICAgICAgYmluZGluZ1ttZXRob2RUb1Jlc3RvcmVdID0gYmluZGluZy50aHJvdHRsZWRNZXRob2Q7XHJcbiAgICAgICAgYmluZGluZy50aHJvdHRsZWRNZXRob2QgPSBudWxsO1xyXG4gICAgICAgIGNsZWFyVGltZW91dChiaW5kaW5nLnRocm90dGxlU3RhdGUudGltZW91dElkKTtcclxuICAgICAgICBiaW5kaW5nLnRocm90dGxlU3RhdGUgPSBudWxsO1xyXG4gICAgfTtcclxuICAgIFRocm90dGxlQmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCd0aHJvdHRsZScpXHJcbiAgICBdLCBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gVGhyb3R0bGVCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XG5cbnZhciB1bnNldCA9IHt9O1xyXG5mdW5jdGlvbiBkZWJvdW5jZUNhbGxTb3VyY2UoZXZlbnQpIHtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICB2YXIgc3RhdGUgPSB0aGlzLmRlYm91bmNlU3RhdGU7XHJcbiAgICBjbGVhclRpbWVvdXQoc3RhdGUudGltZW91dElkKTtcclxuICAgIHN0YXRlLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuZGVib3VuY2VkTWV0aG9kKGV2ZW50KTsgfSwgc3RhdGUuZGVsYXkpO1xyXG59XHJcbmZ1bmN0aW9uIGRlYm91bmNlQ2FsbChjb250ZXh0LCBuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICB2YXIgc3RhdGUgPSB0aGlzLmRlYm91bmNlU3RhdGU7XHJcbiAgICBjbGVhclRpbWVvdXQoc3RhdGUudGltZW91dElkKTtcclxuICAgIGlmIChjb250ZXh0ICE9PSBzdGF0ZS5jYWxsQ29udGV4dFRvRGVib3VuY2UpIHtcclxuICAgICAgICBzdGF0ZS5vbGRWYWx1ZSA9IHVuc2V0O1xyXG4gICAgICAgIHRoaXMuZGVib3VuY2VkTWV0aG9kKGNvbnRleHQsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHN0YXRlLm9sZFZhbHVlID09PSB1bnNldCkge1xyXG4gICAgICAgIHN0YXRlLm9sZFZhbHVlID0gb2xkVmFsdWU7XHJcbiAgICB9XHJcbiAgICBzdGF0ZS50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX29sZFZhbHVlID0gc3RhdGUub2xkVmFsdWU7XHJcbiAgICAgICAgc3RhdGUub2xkVmFsdWUgPSB1bnNldDtcclxuICAgICAgICBfdGhpcy5kZWJvdW5jZWRNZXRob2QoY29udGV4dCwgbmV3VmFsdWUsIF9vbGRWYWx1ZSk7XHJcbiAgICB9LCBzdGF0ZS5kZWxheSk7XHJcbn1cclxudmFyIERlYm91bmNlQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIERlYm91bmNlQmluZGluZ0JlaGF2aW9yKCkge1xyXG4gICAgfVxyXG4gICAgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlLCBkZWxheSkge1xyXG4gICAgICAgIGlmIChkZWxheSA9PT0gdm9pZCAwKSB7IGRlbGF5ID0gMjAwOyB9XHJcbiAgICAgICAgdmFyIGlzQ2FsbFNvdXJjZSA9IGJpbmRpbmcuY2FsbFNvdXJjZSAhPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBtZXRob2RUb0RlYm91bmNlID0gaXNDYWxsU291cmNlID8gJ2NhbGxTb3VyY2UnIDogJ2NhbGwnO1xyXG4gICAgICAgIHZhciBkZWJvdW5jZXIgPSBpc0NhbGxTb3VyY2UgPyBkZWJvdW5jZUNhbGxTb3VyY2UgOiBkZWJvdW5jZUNhbGw7XHJcbiAgICAgICAgdmFyIG1vZGUgPSBiaW5kaW5nLm1vZGU7XHJcbiAgICAgICAgdmFyIGNhbGxDb250ZXh0VG9EZWJvdW5jZSA9IG1vZGUgPT09IGJpbmRpbmdNb2RlLnR3b1dheSB8fCBtb2RlID09PSBiaW5kaW5nTW9kZS5mcm9tVmlldyA/IHRhcmdldENvbnRleHQgOiBzb3VyY2VDb250ZXh0O1xyXG4gICAgICAgIGJpbmRpbmcuZGVib3VuY2VkTWV0aG9kID0gYmluZGluZ1ttZXRob2RUb0RlYm91bmNlXTtcclxuICAgICAgICBiaW5kaW5nLmRlYm91bmNlZE1ldGhvZC5vcmlnaW5hbE5hbWUgPSBtZXRob2RUb0RlYm91bmNlO1xyXG4gICAgICAgIGJpbmRpbmdbbWV0aG9kVG9EZWJvdW5jZV0gPSBkZWJvdW5jZXI7XHJcbiAgICAgICAgYmluZGluZy5kZWJvdW5jZVN0YXRlID0ge1xyXG4gICAgICAgICAgICBjYWxsQ29udGV4dFRvRGVib3VuY2U6IGNhbGxDb250ZXh0VG9EZWJvdW5jZSxcclxuICAgICAgICAgICAgZGVsYXk6IGRlbGF5LFxyXG4gICAgICAgICAgICB0aW1lb3V0SWQ6IDAsXHJcbiAgICAgICAgICAgIG9sZFZhbHVlOiB1bnNldFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UpIHtcclxuICAgICAgICB2YXIgbWV0aG9kVG9SZXN0b3JlID0gYmluZGluZy5kZWJvdW5jZWRNZXRob2Qub3JpZ2luYWxOYW1lO1xyXG4gICAgICAgIGJpbmRpbmdbbWV0aG9kVG9SZXN0b3JlXSA9IGJpbmRpbmcuZGVib3VuY2VkTWV0aG9kO1xyXG4gICAgICAgIGJpbmRpbmcuZGVib3VuY2VkTWV0aG9kID0gbnVsbDtcclxuICAgICAgICBjbGVhclRpbWVvdXQoYmluZGluZy5kZWJvdW5jZVN0YXRlLnRpbWVvdXRJZCk7XHJcbiAgICAgICAgYmluZGluZy5kZWJvdW5jZVN0YXRlID0gbnVsbDtcclxuICAgIH07XHJcbiAgICBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcignZGVib3VuY2UnKVxyXG4gICAgXSwgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IpO1xyXG4gICAgcmV0dXJuIERlYm91bmNlQmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xuXG5mdW5jdGlvbiBmaW5kT3JpZ2luYWxFdmVudFRhcmdldChldmVudCkge1xyXG4gICAgcmV0dXJuIChldmVudC5wYXRoICYmIGV2ZW50LnBhdGhbMF0pIHx8IChldmVudC5kZWVwUGF0aCAmJiBldmVudC5kZWVwUGF0aFswXSkgfHwgZXZlbnQudGFyZ2V0O1xyXG59XHJcbmZ1bmN0aW9uIGhhbmRsZVNlbGZFdmVudChldmVudCkge1xyXG4gICAgdmFyIHRhcmdldCA9IGZpbmRPcmlnaW5hbEV2ZW50VGFyZ2V0KGV2ZW50KTtcclxuICAgIGlmICh0aGlzLnRhcmdldCAhPT0gdGFyZ2V0KSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZWxmRXZlbnRDYWxsU291cmNlKGV2ZW50KTtcclxufVxyXG52YXIgU2VsZkJpbmRpbmdCZWhhdmlvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTZWxmQmluZGluZ0JlaGF2aW9yKCkge1xyXG4gICAgfVxyXG4gICAgU2VsZkJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UpIHtcclxuICAgICAgICBpZiAoIWJpbmRpbmcuY2FsbFNvdXJjZSB8fCAhYmluZGluZy50YXJnZXRFdmVudCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlbGYgYmluZGluZyBiZWhhdmlvciBvbmx5IHN1cHBvcnRzIGV2ZW50LicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBiaW5kaW5nLnNlbGZFdmVudENhbGxTb3VyY2UgPSBiaW5kaW5nLmNhbGxTb3VyY2U7XHJcbiAgICAgICAgYmluZGluZy5jYWxsU291cmNlID0gaGFuZGxlU2VsZkV2ZW50O1xyXG4gICAgfTtcclxuICAgIFNlbGZCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UpIHtcclxuICAgICAgICBiaW5kaW5nLmNhbGxTb3VyY2UgPSBiaW5kaW5nLnNlbGZFdmVudENhbGxTb3VyY2U7XHJcbiAgICAgICAgYmluZGluZy5zZWxmRXZlbnRDYWxsU291cmNlID0gbnVsbDtcclxuICAgIH07XHJcbiAgICBTZWxmQmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCdzZWxmJylcclxuICAgIF0sIFNlbGZCaW5kaW5nQmVoYXZpb3IpO1xyXG4gICAgcmV0dXJuIFNlbGZCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XG5cbnZhciBCaW5kaW5nU2lnbmFsZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQmluZGluZ1NpZ25hbGVyKCkge1xyXG4gICAgICAgIHRoaXMuc2lnbmFscyA9IHt9O1xyXG4gICAgfVxyXG4gICAgQmluZGluZ1NpZ25hbGVyLnByb3RvdHlwZS5zaWduYWwgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIHZhciBiaW5kaW5ncyA9IHRoaXMuc2lnbmFsc1tuYW1lXTtcclxuICAgICAgICBpZiAoIWJpbmRpbmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGkgPSBiaW5kaW5ncy5sZW5ndGg7XHJcbiAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICBiaW5kaW5nc1tpXS5jYWxsKHNvdXJjZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQmluZGluZ1NpZ25hbGVyO1xyXG59KCkpO1xuXG52YXIgU2lnbmFsQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNpZ25hbEJpbmRpbmdCZWhhdmlvcihiaW5kaW5nU2lnbmFsZXIpIHtcclxuICAgICAgICB0aGlzLnNpZ25hbHMgPSBiaW5kaW5nU2lnbmFsZXIuc2lnbmFscztcclxuICAgIH1cclxuICAgIFNpZ25hbEJpbmRpbmdCZWhhdmlvci5pbmplY3QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBbQmluZGluZ1NpZ25hbGVyXTsgfTtcclxuICAgIFNpZ25hbEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UpIHtcclxuICAgICAgICB2YXIgbmFtZXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDI7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICBuYW1lc1tfaSAtIDJdID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFiaW5kaW5nLnVwZGF0ZVRhcmdldCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgcHJvcGVydHkgYmluZGluZ3MgYW5kIHN0cmluZyBpbnRlcnBvbGF0aW9uIGJpbmRpbmdzIGNhbiBiZSBzaWduYWxlZC4gIFRyaWdnZXIsIGRlbGVnYXRlIGFuZCBjYWxsIGJpbmRpbmdzIGNhbm5vdCBiZSBzaWduYWxlZC4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNpZ25hbHMgPSB0aGlzLnNpZ25hbHM7XHJcbiAgICAgICAgaWYgKG5hbWVzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICB2YXIgbmFtZV8xID0gbmFtZXNbMF07XHJcbiAgICAgICAgICAgIHZhciBiaW5kaW5ncyA9IHNpZ25hbHNbbmFtZV8xXSB8fCAoc2lnbmFsc1tuYW1lXzFdID0gW10pO1xyXG4gICAgICAgICAgICBiaW5kaW5ncy5wdXNoKGJpbmRpbmcpO1xyXG4gICAgICAgICAgICBiaW5kaW5nLnNpZ25hbE5hbWUgPSBuYW1lXzE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG5hbWVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSBuYW1lcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBuYW1lXzIgPSBuYW1lc1tpXTtcclxuICAgICAgICAgICAgICAgIHZhciBiaW5kaW5ncyA9IHNpZ25hbHNbbmFtZV8yXSB8fCAoc2lnbmFsc1tuYW1lXzJdID0gW10pO1xyXG4gICAgICAgICAgICAgICAgYmluZGluZ3MucHVzaChiaW5kaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiaW5kaW5nLnNpZ25hbE5hbWUgPSBuYW1lcztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2lnbmFsIG5hbWUgaXMgcmVxdWlyZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNpZ25hbEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIHZhciBzaWduYWxzID0gdGhpcy5zaWduYWxzO1xyXG4gICAgICAgIHZhciBuYW1lID0gYmluZGluZy5zaWduYWxOYW1lO1xyXG4gICAgICAgIGJpbmRpbmcuc2lnbmFsTmFtZSA9IG51bGw7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZSkpIHtcclxuICAgICAgICAgICAgdmFyIG5hbWVzID0gbmFtZTtcclxuICAgICAgICAgICAgdmFyIGkgPSBuYW1lcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBuID0gbmFtZXNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgYmluZGluZ3MgPSBzaWduYWxzW25dO1xyXG4gICAgICAgICAgICAgICAgYmluZGluZ3Muc3BsaWNlKGJpbmRpbmdzLmluZGV4T2YoYmluZGluZyksIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgYmluZGluZ3MgPSBzaWduYWxzW25hbWVdO1xyXG4gICAgICAgICAgICBiaW5kaW5ncy5zcGxpY2UoYmluZGluZ3MuaW5kZXhPZihiaW5kaW5nKSwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNpZ25hbEJpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcignc2lnbmFsJylcclxuICAgIF0sIFNpZ25hbEJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gU2lnbmFsQmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xuXG52YXIgZXZlbnROYW1lc1JlcXVpcmVkID0gJ1RoZSB1cGRhdGVUcmlnZ2VyIGJpbmRpbmcgYmVoYXZpb3IgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIGV2ZW50IG5hbWUgYXJndW1lbnQ6IGVnIDxpbnB1dCB2YWx1ZS5iaW5kPVwiZmlyc3ROYW1lICYgdXBkYXRlVHJpZ2dlcjpcXCdibHVyXFwnXCI+JztcclxudmFyIG5vdEFwcGxpY2FibGVNZXNzYWdlID0gJ1RoZSB1cGRhdGVUcmlnZ2VyIGJpbmRpbmcgYmVoYXZpb3IgY2FuIG9ubHkgYmUgYXBwbGllZCB0byB0d28td2F5LyBmcm9tLXZpZXcgYmluZGluZ3Mgb24gaW5wdXQvc2VsZWN0IGVsZW1lbnRzLic7XHJcbnZhciBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFVwZGF0ZVRyaWdnZXJCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICB9XHJcbiAgICBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIHZhciBldmVudHMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDI7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICBldmVudHNbX2kgLSAyXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChldmVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihldmVudE5hbWVzUmVxdWlyZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYmluZGluZy5tb2RlICE9PSBiaW5kaW5nTW9kZS50d29XYXkgJiYgYmluZGluZy5tb2RlICE9PSBiaW5kaW5nTW9kZS5mcm9tVmlldykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iobm90QXBwbGljYWJsZU1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdGFyZ2V0T2JzZXJ2ZXIgPSBiaW5kaW5nLm9ic2VydmVyTG9jYXRvci5nZXRPYnNlcnZlcihiaW5kaW5nLnRhcmdldCwgYmluZGluZy50YXJnZXRQcm9wZXJ0eSk7XHJcbiAgICAgICAgaWYgKCF0YXJnZXRPYnNlcnZlci5oYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihub3RBcHBsaWNhYmxlTWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJpbmRpbmcudGFyZ2V0T2JzZXJ2ZXIgPSB0YXJnZXRPYnNlcnZlcjtcclxuICAgICAgICB0YXJnZXRPYnNlcnZlci5vcmlnaW5hbEhhbmRsZXIgPSBiaW5kaW5nLnRhcmdldE9ic2VydmVyLmhhbmRsZXI7XHJcbiAgICAgICAgdmFyIGhhbmRsZXIgPSBuZXcgRXZlbnRTdWJzY3JpYmVyKGV2ZW50cyk7XHJcbiAgICAgICAgdGFyZ2V0T2JzZXJ2ZXIuaGFuZGxlciA9IGhhbmRsZXI7XHJcbiAgICB9O1xyXG4gICAgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIHZhciB0YXJnZXRPYnNlcnZlciA9IGJpbmRpbmcudGFyZ2V0T2JzZXJ2ZXI7XHJcbiAgICAgICAgdGFyZ2V0T2JzZXJ2ZXIuaGFuZGxlci5kaXNwb3NlKCk7XHJcbiAgICAgICAgdGFyZ2V0T2JzZXJ2ZXIuaGFuZGxlciA9IHRhcmdldE9ic2VydmVyLm9yaWdpbmFsSGFuZGxlcjtcclxuICAgICAgICB0YXJnZXRPYnNlcnZlci5vcmlnaW5hbEhhbmRsZXIgPSBudWxsO1xyXG4gICAgfTtcclxuICAgIFVwZGF0ZVRyaWdnZXJCaW5kaW5nQmVoYXZpb3IgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kaW5nQmVoYXZpb3IoJ3VwZGF0ZVRyaWdnZXInKVxyXG4gICAgXSwgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvcjtcclxufSgpKTtcblxuZnVuY3Rpb24gX2NyZWF0ZUR5bmFtaWNFbGVtZW50KF9hKSB7XHJcbiAgICB2YXIgbmFtZSA9IF9hLm5hbWUsIHZpZXdVcmwgPSBfYS52aWV3VXJsLCBiaW5kYWJsZU5hbWVzID0gX2EuYmluZGFibGVOYW1lcywgdXNlU2hhZG93RE9NbW9kZSA9IF9hLnVzZVNoYWRvd0RPTW1vZGU7XHJcbiAgICB2YXIgRHluYW1pY0VsZW1lbnQgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIER5bmFtaWNFbGVtZW50KCkge1xyXG4gICAgICAgIH1cclxuICAgICAgICBEeW5hbWljRWxlbWVudC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgICAgICB0aGlzLiRwYXJlbnQgPSBiaW5kaW5nQ29udGV4dDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIER5bmFtaWNFbGVtZW50ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgICAgIGN1c3RvbUVsZW1lbnQobmFtZSksXHJcbiAgICAgICAgICAgIHVzZVZpZXcodmlld1VybClcclxuICAgICAgICBdLCBEeW5hbWljRWxlbWVudCk7XHJcbiAgICAgICAgcmV0dXJuIER5bmFtaWNFbGVtZW50O1xyXG4gICAgfSgpKTtcclxuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGJpbmRhYmxlTmFtZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgIGJpbmRhYmxlKGJpbmRhYmxlTmFtZXNbaV0pKER5bmFtaWNFbGVtZW50KTtcclxuICAgIH1cclxuICAgIHN3aXRjaCAodXNlU2hhZG93RE9NbW9kZSkge1xyXG4gICAgICAgIGNhc2UgJ29wZW4nOlxyXG4gICAgICAgICAgICB1c2VTaGFkb3dET00oeyBtb2RlOiAnb3BlbicgfSkoRHluYW1pY0VsZW1lbnQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdjbG9zZWQnOlxyXG4gICAgICAgICAgICB1c2VTaGFkb3dET00oeyBtb2RlOiAnY2xvc2VkJyB9KShEeW5hbWljRWxlbWVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJyc6XHJcbiAgICAgICAgICAgIHVzZVNoYWRvd0RPTShEeW5hbWljRWxlbWVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgbnVsbDpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgZ2V0TG9nZ2VyKCdhdXJlbGlhLWh0bWwtb25seS1lbGVtZW50JylcclxuICAgICAgICAgICAgICAgIC53YXJuKFwiRXhwZWN0ZWQgJ3VzZS1zaGFkb3ctZG9tJyB2YWx1ZSB0byBiZSBcXFwiY2xvc2VcXFwiLCBcXFwib3BlblxcXCIgb3IgXFxcIlxcXCIsIHJlY2VpdmVkIFwiICsgdXNlU2hhZG93RE9NbW9kZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIER5bmFtaWNFbGVtZW50O1xyXG59XG5cbmZ1bmN0aW9uIGdldEVsZW1lbnROYW1lKGFkZHJlc3MpIHtcclxuICAgIHJldHVybiAvKFteXFwvXlxcP10rKVxcLmh0bWwvaS5leGVjKGFkZHJlc3MpWzFdLnRvTG93ZXJDYXNlKCk7XHJcbn1cclxuZnVuY3Rpb24gY29uZmlndXJlKGNvbmZpZykge1xyXG4gICAgdmFyIHZpZXdFbmdpbmUgPSBjb25maWcuY29udGFpbmVyLmdldChWaWV3RW5naW5lKTtcclxuICAgIHZhciBsb2FkZXIgPSBjb25maWcuYXVyZWxpYS5sb2FkZXI7XHJcbiAgICB2aWV3RW5naW5lLmFkZFJlc291cmNlUGx1Z2luKCcuaHRtbCcsIHtcclxuICAgICAgICAnZmV0Y2gnOiBmdW5jdGlvbiAodmlld1VybCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZGVyLmxvYWRUZW1wbGF0ZSh2aWV3VXJsKS50aGVuKGZ1bmN0aW9uIChyZWdpc3RyeUVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmluZGFibGVOYW1lcyA9IHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUuZ2V0QXR0cmlidXRlKCdiaW5kYWJsZScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVzZVNoYWRvd0RPTW1vZGUgPSByZWdpc3RyeUVudHJ5LnRlbXBsYXRlLmdldEF0dHJpYnV0ZSgndXNlLXNoYWRvdy1kb20nKTtcclxuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZ2V0RWxlbWVudE5hbWUodmlld1VybCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmluZGFibGVOYW1lcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGJpbmRhYmxlTmFtZXMgPSBiaW5kYWJsZU5hbWVzLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnRyaW0oKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVnaXN0cnlFbnRyeS50ZW1wbGF0ZS5yZW1vdmVBdHRyaWJ1dGUoJ2JpbmRhYmxlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBiaW5kYWJsZU5hbWVzID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX2EgPSB7fSwgX2FbbmFtZV0gPSBfY3JlYXRlRHluYW1pY0VsZW1lbnQoeyBuYW1lOiBuYW1lLCB2aWV3VXJsOiB2aWV3VXJsLCBiaW5kYWJsZU5hbWVzOiBiaW5kYWJsZU5hbWVzLCB1c2VTaGFkb3dET01tb2RlOiB1c2VTaGFkb3dET01tb2RlIH0pLCBfYTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cblxuZnVuY3Rpb24gY29uZmlndXJlJDEoY29uZmlnKSB7XHJcbiAgICBpbmplY3RBdXJlbGlhSGlkZVN0eWxlQXRIZWFkKCk7XHJcbiAgICBjb25maWcuZ2xvYmFsUmVzb3VyY2VzKENvbXBvc2UsIElmLCBFbHNlLCBXaXRoLCBSZXBlYXQsIFNob3csIEhpZGUsIFJlcGxhY2VhYmxlLCBGb2N1cywgU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXIsIE9uZVRpbWVCaW5kaW5nQmVoYXZpb3IsIE9uZVdheUJpbmRpbmdCZWhhdmlvciwgVG9WaWV3QmluZGluZ0JlaGF2aW9yLCBGcm9tVmlld0JpbmRpbmdCZWhhdmlvciwgVHdvV2F5QmluZGluZ0JlaGF2aW9yLCBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvciwgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IsIFNlbGZCaW5kaW5nQmVoYXZpb3IsIFNpZ25hbEJpbmRpbmdCZWhhdmlvciwgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciwgQXR0ckJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICBjb25maWd1cmUoY29uZmlnKTtcclxuICAgIHZhciB2aWV3RW5naW5lID0gY29uZmlnLmNvbnRhaW5lci5nZXQoVmlld0VuZ2luZSk7XHJcbiAgICB2YXIgc3R5bGVSZXNvdXJjZVBsdWdpbiA9IHtcclxuICAgICAgICBmZXRjaDogZnVuY3Rpb24gKGFkZHJlc3MpIHtcclxuICAgICAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgICAgICByZXR1cm4gX2EgPSB7fSwgX2FbYWRkcmVzc10gPSBfY3JlYXRlQ1NTUmVzb3VyY2UoYWRkcmVzcyksIF9hO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBbJy5jc3MnLCAnLmxlc3MnLCAnLnNhc3MnLCAnLnNjc3MnLCAnLnN0eWwnXS5mb3JFYWNoKGZ1bmN0aW9uIChleHQpIHsgcmV0dXJuIHZpZXdFbmdpbmUuYWRkUmVzb3VyY2VQbHVnaW4oZXh0LCBzdHlsZVJlc291cmNlUGx1Z2luKTsgfSk7XHJcbn1cblxuZXhwb3J0IHsgQWJzdHJhY3RSZXBlYXRlciwgQXJyYXlSZXBlYXRTdHJhdGVneSwgQXR0ckJpbmRpbmdCZWhhdmlvciwgQmluZGluZ1NpZ25hbGVyLCBDb21wb3NlLCBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvciwgRWxzZSwgRm9jdXMsIEZyb21WaWV3QmluZGluZ0JlaGF2aW9yLCBIVE1MU2FuaXRpemVyLCBIaWRlLCBJZiwgTWFwUmVwZWF0U3RyYXRlZ3ksIE51bGxSZXBlYXRTdHJhdGVneSwgTnVtYmVyUmVwZWF0U3RyYXRlZ3ksIE9uZVRpbWVCaW5kaW5nQmVoYXZpb3IsIE9uZVdheUJpbmRpbmdCZWhhdmlvciwgUmVwZWF0LCBSZXBlYXRTdHJhdGVneUxvY2F0b3IsIFJlcGxhY2VhYmxlLCBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlciwgU2VsZkJpbmRpbmdCZWhhdmlvciwgU2V0UmVwZWF0U3RyYXRlZ3ksIFNob3csIFNpZ25hbEJpbmRpbmdCZWhhdmlvciwgVGhyb3R0bGVCaW5kaW5nQmVoYXZpb3IsIFRvVmlld0JpbmRpbmdCZWhhdmlvciwgVHdvV2F5QmluZGluZ0JlaGF2aW9yLCBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yLCBXaXRoLCBjb25maWd1cmUkMSBhcyBjb25maWd1cmUsIGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQsIGdldEl0ZW1zU291cmNlRXhwcmVzc2lvbiwgaXNPbmVUaW1lLCB1bndyYXBFeHByZXNzaW9uLCB1cGRhdGVPbmVUaW1lQmluZGluZywgdXBkYXRlT3ZlcnJpZGVDb250ZXh0LCB2aWV3c1JlcXVpcmVMaWZlY3ljbGUgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMuanMubWFwXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiaW1wb3J0IHsgUm91dGVyLCBSb3V0ZUxvYWRlciwgQXBwUm91dGVyIH0gZnJvbSAnYXVyZWxpYS1yb3V0ZXInO1xuaW1wb3J0IHsgT3JpZ2luIH0gZnJvbSAnYXVyZWxpYS1tZXRhZGF0YSc7XG5pbXBvcnQgeyByZWxhdGl2ZVRvRmlsZSB9IGZyb20gJ2F1cmVsaWEtcGF0aCc7XG5pbXBvcnQgeyBWaWV3U2xvdCwgVmlld0xvY2F0b3IsIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24sIENvbXBvc2l0aW9uRW5naW5lLCBCZWhhdmlvckluc3RydWN0aW9uLCBTaGFkb3dET00sIFN3YXBTdHJhdGVnaWVzLCBpbmxpbmVWaWV3LCBjdXN0b21FbGVtZW50LCB1c2VWaWV3IH0gZnJvbSAnYXVyZWxpYS10ZW1wbGF0aW5nJztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nO1xuaW1wb3J0IHsgY3JlYXRlT3ZlcnJpZGVDb250ZXh0IH0gZnJvbSAnYXVyZWxpYS1iaW5kaW5nJztcbmltcG9ydCB7IERPTSB9IGZyb20gJ2F1cmVsaWEtcGFsJztcbmltcG9ydCB7IGdldExvZ2dlciB9IGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5cbmNsYXNzIEVtcHR5TGF5b3V0Vmlld01vZGVsIHtcclxufVxyXG4vKipcclxuICogSW1wbGVtZW50YXRpb24gb2YgQXVyZWxpYSBSb3V0ZXIgVmlld1BvcnQuIFJlc3BvbnNpYmxlIGZvciBsb2FkaW5nIHJvdXRlLCBjb21wb3NpbmcgYW5kIHN3YXBwaW5nIHJvdXRlcyB2aWV3c1xyXG4gKi9cclxuY2xhc3MgUm91dGVyVmlldyB7XHJcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCBjb250YWluZXIsIHZpZXdTbG90LCByb3V0ZXIsIHZpZXdMb2NhdG9yLCBjb21wb3NpdGlvblRyYW5zYWN0aW9uLCBjb21wb3NpdGlvbkVuZ2luZSkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdCA9IHZpZXdTbG90O1xyXG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG4gICAgICAgIHRoaXMudmlld0xvY2F0b3IgPSB2aWV3TG9jYXRvcjtcclxuICAgICAgICB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSBjb21wb3NpdGlvblRyYW5zYWN0aW9uO1xyXG4gICAgICAgIHRoaXMuY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcclxuICAgICAgICAvLyBhZGQgdGhpcyA8cm91dGVyLXZpZXcvPiB0byByb3V0ZXIgdmlldyBwb3J0cyBsb29rdXAgYmFzZWQgb24gbmFtZSBhdHRyaWJ1dGVcclxuICAgICAgICAvLyB3aGVuIHRoaXMgcm91dGVyIGlzIHRoZSByb290IHJvdXRlci12aWV3XHJcbiAgICAgICAgLy8gYWxzbyB0cmlnZ2VyIEFwcFJvdXRlciByZWdpc3RlclZpZXdQb3J0IGV4dHJhIGZsb3dcclxuICAgICAgICB0aGlzLnJvdXRlci5yZWdpc3RlclZpZXdQb3J0KHRoaXMsIHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKSk7XHJcbiAgICAgICAgLy8gRWFjaCA8cm91dGVyLXZpZXcvPiBwcm9jZXNzIGl0cyBpbnN0cnVjdGlvbiBhcyBhIGNvbXBvc2l0aW9uIHRyYW5zYWN0aW9uXHJcbiAgICAgICAgLy8gdGhlcmUgYXJlIGRpZmZlcmVuY2VzIGJldHdlZW4gaW50aWFsIGNvbXBvc2l0aW9uIGFuZCBzdWJzZXF1ZW50IGNvbXBvc2l0aW9uc1xyXG4gICAgICAgIC8vIGFsc28gdGhlcmUgYXJlIGRpZmZlcmVuY2VzIGJldHdlZW4gcm9vdCBjb21wb3NpdGlvbiBhbmQgY2hpbGQgPHJvdXRlci12aWV3Lz4gY29tcG9zaXRpb25cclxuICAgICAgICAvLyBtYXJrIHRoZSBmaXJzdCBjb21wb3NpdGlvbiB0cmFuc2FjdGlvbiB3aXRoIGEgcHJvcGVydHkgaW5pdGlhbENvbXBvc2l0aW9uIHRvIGRpc3Rpbmd1aXNoIGl0XHJcbiAgICAgICAgLy8gd2hlbiB0aGUgcm9vdCA8cm91dGVyLXZpZXcvPiBnZXRzIG5ldyBpbnN0cnVjdGlvbiBmb3IgdGhlIGZpcnN0IHRpbWVcclxuICAgICAgICBpZiAoISgnaW5pdGlhbENvbXBvc2l0aW9uJyBpbiBjb21wb3NpdGlvblRyYW5zYWN0aW9uKSkge1xyXG4gICAgICAgICAgICBjb21wb3NpdGlvblRyYW5zYWN0aW9uLmluaXRpYWxDb21wb3NpdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyID0gY29tcG9zaXRpb25UcmFuc2FjdGlvbi5lbmxpc3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBpbmplY3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtET00uRWxlbWVudCwgQ29udGFpbmVyLCBWaWV3U2xvdCwgUm91dGVyLCBWaWV3TG9jYXRvciwgQ29tcG9zaXRpb25UcmFuc2FjdGlvbiwgQ29tcG9zaXRpb25FbmdpbmVdO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlZChvd25pbmdWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5vd25pbmdWaWV3ID0gb3duaW5nVmlldztcclxuICAgIH1cclxuICAgIGJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIC8vIHJvdXRlciBuZWVkcyB0byBnZXQgYWNjZXNzIHRvIHZpZXcgbW9kZWwgb2YgY3VycmVudCByb3V0ZSBwYXJlbnRcclxuICAgICAgICAvLyBkb2luZyBpdCBpbiBnZW5lcmljIHdheSB2aWEgdmlld01vZGVsIHByb3BlcnR5IG9uIGNvbnRhaW5lclxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnZpZXdNb2RlbCA9IGJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiBgYXVyZWxpYS1yb3V0ZXJgIFZpZXdQb3J0IGludGVyZmFjZSwgcmVzcG9uc2libGUgZm9yIHRlbXBsYXRpbmcgcmVsYXRlZCBwYXJ0IGluIHJvdXRpbmcgUGlwZWxpbmVcclxuICAgICAqL1xyXG4gICAgcHJvY2Vzcygkdmlld1BvcnRJbnN0cnVjdGlvbiwgd2FpdFRvU3dhcCkge1xyXG4gICAgICAgIC8vIGhhdmUgc3Ryb25nIHR5cGluZ3Mgd2l0aG91dCBleHBvc2luZyBpdCBpbiBwdWJsaWMgdHlwaW5ncywgdGhpcyBpcyB0byBlbnN1cmUgbWF4aW11bSBiYWNrd2FyZCBjb21wYXRcclxuICAgICAgICBjb25zdCB2aWV3UG9ydEluc3RydWN0aW9uID0gJHZpZXdQb3J0SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50ID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQ7XHJcbiAgICAgICAgY29uc3QgY2hpbGRDb250YWluZXIgPSBjb21wb25lbnQuY2hpbGRDb250YWluZXI7XHJcbiAgICAgICAgY29uc3Qgdmlld01vZGVsID0gY29tcG9uZW50LnZpZXdNb2RlbDtcclxuICAgICAgICBjb25zdCB2aWV3TW9kZWxSZXNvdXJjZSA9IGNvbXBvbmVudC52aWV3TW9kZWxSZXNvdXJjZTtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHZpZXdNb2RlbFJlc291cmNlLm1ldGFkYXRhO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGNvbXBvbmVudC5yb3V0ZXIuY3VycmVudEluc3RydWN0aW9uLmNvbmZpZztcclxuICAgICAgICBjb25zdCB2aWV3UG9ydENvbmZpZyA9IGNvbmZpZy52aWV3UG9ydHMgPyAoY29uZmlnLnZpZXdQb3J0c1t2aWV3UG9ydEluc3RydWN0aW9uLm5hbWVdIHx8IHt9KSA6IHt9O1xyXG4gICAgICAgIGNoaWxkQ29udGFpbmVyLmdldChSb3V0ZXJWaWV3TG9jYXRvcikuX25vdGlmeSh0aGlzKTtcclxuICAgICAgICAvLyBsYXlvdXRJbnN0cnVjdGlvbiBpcyBvdXIgbGF5b3V0IHZpZXdNb2RlbFxyXG4gICAgICAgIGNvbnN0IGxheW91dEluc3RydWN0aW9uID0ge1xyXG4gICAgICAgICAgICB2aWV3TW9kZWw6IHZpZXdQb3J0Q29uZmlnLmxheW91dFZpZXdNb2RlbCB8fCBjb25maWcubGF5b3V0Vmlld01vZGVsIHx8IHRoaXMubGF5b3V0Vmlld01vZGVsLFxyXG4gICAgICAgICAgICB2aWV3OiB2aWV3UG9ydENvbmZpZy5sYXlvdXRWaWV3IHx8IGNvbmZpZy5sYXlvdXRWaWV3IHx8IHRoaXMubGF5b3V0VmlldyxcclxuICAgICAgICAgICAgbW9kZWw6IHZpZXdQb3J0Q29uZmlnLmxheW91dE1vZGVsIHx8IGNvbmZpZy5sYXlvdXRNb2RlbCB8fCB0aGlzLmxheW91dE1vZGVsLFxyXG4gICAgICAgICAgICByb3V0ZXI6IHZpZXdQb3J0SW5zdHJ1Y3Rpb24uY29tcG9uZW50LnJvdXRlcixcclxuICAgICAgICAgICAgY2hpbGRDb250YWluZXI6IGNoaWxkQ29udGFpbmVyLFxyXG4gICAgICAgICAgICB2aWV3U2xvdDogdGhpcy52aWV3U2xvdFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gdmlld3BvcnQgd2lsbCBiZSBhIHRoaW4gd3JhcHBlciBhcm91bmQgY29tcG9zaXRpb24gZW5naW5lXHJcbiAgICAgICAgLy8gdG8gcHJvY2VzcyBpbnN0cnVjdGlvbi9jb25maWd1cmF0aW9uIGZyb20gdXNlcnNcclxuICAgICAgICAvLyBwcmVwYXJpbmcgYWxsIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gYSBjb21wb3NpdGlvbiBwcm9jZXNzXHJcbiAgICAgICAgLy8gZmlyc3QgYnkgZ2V0dGluZyB2aWV3IHN0cmF0ZWd5IG9mIGEgVmlld1BvcnRDb21wb25lbnQgVmlld1xyXG4gICAgICAgIGNvbnN0IHZpZXdTdHJhdGVneSA9IHRoaXMudmlld0xvY2F0b3IuZ2V0Vmlld1N0cmF0ZWd5KGNvbXBvbmVudC52aWV3IHx8IHZpZXdNb2RlbCk7XHJcbiAgICAgICAgaWYgKHZpZXdTdHJhdGVneSAmJiBjb21wb25lbnQudmlldykge1xyXG4gICAgICAgICAgICB2aWV3U3RyYXRlZ3kubWFrZVJlbGF0aXZlVG8oT3JpZ2luLmdldChjb21wb25lbnQucm91dGVyLmNvbnRhaW5lci52aWV3TW9kZWwuY29uc3RydWN0b3IpLm1vZHVsZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdXNpbmcgbWV0YWRhdGEgb2YgYSBjdXN0b20gZWxlbWVudCB2aWV3IG1vZGVsIHRvIGxvYWQgYXBwcm9wcmlhdGUgdmlldy1mYWN0b3J5IGluc3RhbmNlXHJcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhXHJcbiAgICAgICAgICAgIC5sb2FkKGNoaWxkQ29udGFpbmVyLCB2aWV3TW9kZWxSZXNvdXJjZS52YWx1ZSwgbnVsbCwgdmlld1N0cmF0ZWd5LCB0cnVlKVxyXG4gICAgICAgICAgICAvLyBmb3IgY3VzdG9tIGVsZW1lbnQsIHZpZXdGYWN0b3J5IHR5cGluZyBpcyBhbHdheXMgVmlld0ZhY3RvcnlcclxuICAgICAgICAgICAgLy8gZm9yIGN1c3RvbSBhdHRyaWJ1dGUsIGl0IHdpbGwgYmUgSHRtbEJlaGF2aW9yUmVzb3VyY2VcclxuICAgICAgICAgICAgLnRoZW4oKHZpZXdGYWN0b3J5KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgbm90IHRoZSBmaXJzdCB0aW1lIHRoYXQgdGhpcyA8cm91dGVyLXZpZXcvPiBpcyBjb21wb3NpbmcgaXRzIGluc3RydWN0aW9uXHJcbiAgICAgICAgICAgIC8vIHRyeSB0byBjYXB0dXJlIG93bmVyc2hpcCBvZiB0aGUgY29tcG9zaXRpb24gdHJhbnNhY3Rpb25cclxuICAgICAgICAgICAgLy8gY2hpbGQgPHJvdXRlci12aWV3Lz4gd2lsbCBub3QgYmUgYWJsZSB0byBjYXB0dXJlLCBzaW5jZSByb290IDxyb3V0ZXItdmlldy8+IHR5cGljYWxseSBjYXB0dXJlc1xyXG4gICAgICAgICAgICAvLyB0aGUgb3duZXJzaGlwIHRva2VuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uLnRyeUNhcHR1cmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobGF5b3V0SW5zdHJ1Y3Rpb24udmlld01vZGVsIHx8IGxheW91dEluc3RydWN0aW9uLnZpZXcpIHtcclxuICAgICAgICAgICAgICAgIHZpZXdQb3J0SW5zdHJ1Y3Rpb24ubGF5b3V0SW5zdHJ1Y3Rpb24gPSBsYXlvdXRJbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB2aWV3UG9ydENvbXBvbmVudEJlaGF2aW9ySW5zdHJ1Y3Rpb24gPSBCZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWModGhpcy5lbGVtZW50LCB2aWV3TW9kZWwsIHZpZXdGYWN0b3J5KTtcclxuICAgICAgICAgICAgdmlld1BvcnRJbnN0cnVjdGlvbi5jb250cm9sbGVyID0gbWV0YWRhdGEuY3JlYXRlKGNoaWxkQ29udGFpbmVyLCB2aWV3UG9ydENvbXBvbmVudEJlaGF2aW9ySW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICBpZiAod2FpdFRvU3dhcCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zd2FwKHZpZXdQb3J0SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc3dhcCgkdmlld1BvcnRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIC8vIGhhdmUgc3Ryb25nIHR5cGluZ3Mgd2l0aG91dCBleHBvc2luZyBpdCBpbiBwdWJsaWMgdHlwaW5ncywgdGhpcyBpcyB0byBlbnN1cmUgbWF4aW11bSBiYWNrd2FyZCBjb21wYXRcclxuICAgICAgICBjb25zdCB2aWV3UG9ydEluc3RydWN0aW9uID0gJHZpZXdQb3J0SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgY29uc3Qgdmlld1BvcnRDb250cm9sbGVyID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jb250cm9sbGVyO1xyXG4gICAgICAgIGNvbnN0IGxheW91dEluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbi5sYXlvdXRJbnN0cnVjdGlvbjtcclxuICAgICAgICBjb25zdCBwcmV2aW91c1ZpZXcgPSB0aGlzLnZpZXc7XHJcbiAgICAgICAgLy8gRmluYWwgc3RlcCBvZiBzd2FwcGluZyBhIDxyb3V0ZXItdmlldy8+IFZpZXdQb3J0Q29tcG9uZW50XHJcbiAgICAgICAgY29uc3Qgd29yayA9ICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc3dhcFN0cmF0ZWd5ID0gU3dhcFN0cmF0ZWdpZXNbdGhpcy5zd2FwT3JkZXJdIHx8IFN3YXBTdHJhdGVnaWVzLmFmdGVyO1xyXG4gICAgICAgICAgICBjb25zdCB2aWV3U2xvdCA9IHRoaXMudmlld1Nsb3Q7XHJcbiAgICAgICAgICAgIHN3YXBTdHJhdGVneSh2aWV3U2xvdCwgcHJldmlvdXNWaWV3LCAoKSA9PiBQcm9taXNlLnJlc29sdmUodmlld1Nsb3QuYWRkKHRoaXMudmlldykpKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIEVuc3VyZSBhbGwgdXNlcnMgc2V0dXBzIGhhdmUgYmVlbiBjb21wbGV0ZWRcclxuICAgICAgICBjb25zdCByZWFkeSA9IChvd25pbmdWaWV3X29yX2xheW91dFZpZXcpID0+IHtcclxuICAgICAgICAgICAgdmlld1BvcnRDb250cm9sbGVyLmF1dG9tYXRlKHRoaXMub3ZlcnJpZGVDb250ZXh0LCBvd25pbmdWaWV3X29yX2xheW91dFZpZXcpO1xyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbk93bmVyU2hpcFRva2VuID0gdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW47XHJcbiAgICAgICAgICAgIC8vIGlmIHRoaXMgcm91dGVyLXZpZXcgaXMgdGhlIHJvb3QgPHJvdXRlci12aWV3Lz4gb2YgYSBub3JtYWwgc3RhcnR1cCB2aWEgYXVyZWxpYS5zZXRSb290XHJcbiAgICAgICAgICAgIC8vIGF0dGVtcCB0byB0YWtlIGNvbnRyb2wgb2YgdGhlIHRyYW5zYWN0aW9uXHJcbiAgICAgICAgICAgIC8vIGlmIG93bmVyc2hpcCBjYW4gYmUgdGFrZW5cclxuICAgICAgICAgICAgLy8gd2FpdCBmb3IgdHJhbnNhY3Rpb24gdG8gY29tcGxldGUgYmVmb3JlIHN3YXBwaW5nXHJcbiAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbk93bmVyU2hpcFRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb25Pd25lclNoaXBUb2tlblxyXG4gICAgICAgICAgICAgICAgICAgIC53YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29yaygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCBqdXN0IHN3YXBcclxuICAgICAgICAgICAgcmV0dXJuIHdvcmsoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGxheW91dCBpbnN0cnVjdGlvbiwgbmV3IHRvIGNvbXBvc2UgbGF5b3V0IGJlZm9yZSBwcm9jZXNzaW5nIFZpZXdQb3J0Q29tcG9uZW50XHJcbiAgICAgICAgLy8gbGF5b3V0IGNvbnRyb2xsZXIvdmlldy92aWV3LW1vZGVsIGlzIGNvbXBvc2VkIHVzaW5nIGNvbXBvc2l0aW9uIGVuZ2luZSBBUElzXHJcbiAgICAgICAgaWYgKGxheW91dEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmICghbGF5b3V0SW5zdHJ1Y3Rpb24udmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGVDb250cm9sbGVyIGNob2tlcyBpZiB0aGVyZSdzIG5vIHZpZXdtb2RlbCwgc28gY3JlYXRlIGEgZHVtbXkgb25lXHJcbiAgICAgICAgICAgICAgICAvLyBidXQgYXZvaWQgdXNpbmcgYSBQT0pPIGFzIGl0IGNyZWF0ZXMgdW53YW50ZWQgbWV0YWRhdGEgaW4gT2JqZWN0IGNvbnN0cnVjdG9yXHJcbiAgICAgICAgICAgICAgICBsYXlvdXRJbnN0cnVjdGlvbi52aWV3TW9kZWwgPSBuZXcgRW1wdHlMYXlvdXRWaWV3TW9kZWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyB1c2luZyBjb21wb3NpdGlvbiBlbmdpbmUgdG8gY3JlYXRlIGNvbXBvc2UgbGF5b3V0XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvc2l0aW9uRW5naW5lXHJcbiAgICAgICAgICAgICAgICAvLyBmaXJzdCBjcmVhdGUgY29udHJvbGxlciBmcm9tIGxheW91dEluc3RydWN0aW9uXHJcbiAgICAgICAgICAgICAgICAvLyBhbmQgdHJlYXQgaXQgYXMgQ29tcG9zaXRpb25Db250ZXh0XHJcbiAgICAgICAgICAgICAgICAvLyB0aGVuIGVtdWxhdGUgc2xvdCBwcm9qZWN0aW9uIHdpdGggVmlld1BvcnRDb21wb25lbnQgdmlld1xyXG4gICAgICAgICAgICAgICAgLmNyZWF0ZUNvbnRyb2xsZXIobGF5b3V0SW5zdHJ1Y3Rpb24pXHJcbiAgICAgICAgICAgICAgICAudGhlbigobGF5b3V0Q29udHJvbGxlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0VmlldyA9IGxheW91dENvbnRyb2xsZXIudmlldztcclxuICAgICAgICAgICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3UG9ydENvbnRyb2xsZXIudmlldywgbGF5b3V0Q29udHJvbGxlci5zbG90cyB8fCBsYXlvdXRWaWV3LnNsb3RzKTtcclxuICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlcmUgaXMgYSBsYXlvdXRcclxuICAgICAgICAgICAgICAgIC8vIHZpZXcgaGllcmFyY2h5IGlzOiA8cm91dGVyLXZpZXcvPiBvd25lciB2aWV3IC0+IGxheW91dCB2aWV3IC0+IFZpZXdQb3J0Q29tcG9uZW50IHZpZXdcclxuICAgICAgICAgICAgICAgIGxheW91dENvbnRyb2xsZXIuYXV0b21hdGUoY3JlYXRlT3ZlcnJpZGVDb250ZXh0KGxheW91dEluc3RydWN0aW9uLnZpZXdNb2RlbCksIHRoaXMub3duaW5nVmlldyk7XHJcbiAgICAgICAgICAgICAgICBsYXlvdXRWaWV3LmNoaWxkcmVuLnB1c2godmlld1BvcnRDb250cm9sbGVyLnZpZXcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxheW91dFZpZXcgfHwgbGF5b3V0Q29udHJvbGxlcjtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKChuZXdWaWV3KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcgPSBuZXdWaWV3O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlYWR5KG5ld1ZpZXcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gbGF5b3V0LCB0aGVuIGdldCBWaWV3UG9ydENvbXBvbmVudCB2aWV3IHJlYWR5IGFzIHZpZXcgcHJvcGVydHlcclxuICAgICAgICAvLyBhbmQgcHJvY2VzcyBjb250cm9sbGVyL3N3YXBwaW5nXHJcbiAgICAgICAgLy8gd2hlbiB0aGVyZSBpcyBubyBsYXlvdXRcclxuICAgICAgICAvLyB2aWV3IGhpZXJhcmNoeSBpczogPHJvdXRlci12aWV3Lz4gb3duZXIgdmlldyAtPiBWaWV3UG9ydENvbXBvbmVudCB2aWV3XHJcbiAgICAgICAgdGhpcy52aWV3ID0gdmlld1BvcnRDb250cm9sbGVyLnZpZXc7XHJcbiAgICAgICAgcmV0dXJuIHJlYWR5KHRoaXMub3duaW5nVmlldyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE5vdGlmeSBjb21wb3NpdGlvbiB0cmFuc2FjdGlvbiB0aGF0IHRoaXMgcm91dGVyIGhhcyBmaW5pc2hlZCBwcm9jZXNzaW5nXHJcbiAgICAgKiBIYXBwZW5zIHdoZW4gdGhpcyA8cm91dGVyLXZpZXcvPiBpcyB0aGUgcm9vdCByb3V0ZXItdmlld1xyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIF9ub3RpZnkoKSB7XHJcbiAgICAgICAgY29uc3Qgbm90aWZpZXIgPSB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcjtcclxuICAgICAgICBpZiAobm90aWZpZXIpIHtcclxuICAgICAgICAgICAgbm90aWZpZXIuZG9uZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBAaW50ZXJuYWwgQWN0aXZlbHkgYXZvaWQgdXNpbmcgZGVjb3JhdG9yIHRvIHJlZHVjZSB0aGUgYW1vdW50IG9mIGNvZGUgZ2VuZXJhdGVkXHJcbiAqXHJcbiAqIFRoZXJlIGlzIG5vIHZpZXcgdG8gY29tcG9zZSBieSBkZWZhdWx0IGluIGEgcm91dGVyIHZpZXdcclxuICogVGhpcyBjdXN0b20gZWxlbWVudCBpcyByZXNwb25zaWJsZSBmb3IgY29tcG9zaW5nIGl0cyBvd24gdmlldywgYmFzZWQgb24gY3VycmVudCBjb25maWdcclxuICovXHJcblJvdXRlclZpZXcuJHZpZXcgPSBudWxsO1xyXG4vKipcclxuICogQGludGVybmFsIEFjdGl2ZWx5IGF2b2lkIHVzaW5nIGRlY29yYXRvciB0byByZWR1Y2UgdGhlIGFtb3VudCBvZiBjb2RlIGdlbmVyYXRlZFxyXG4gKi9cclxuUm91dGVyVmlldy4kcmVzb3VyY2UgPSB7XHJcbiAgICBuYW1lOiAncm91dGVyLXZpZXcnLFxyXG4gICAgYmluZGFibGVzOiBbJ3N3YXBPcmRlcicsICdsYXlvdXRWaWV3JywgJ2xheW91dFZpZXdNb2RlbCcsICdsYXlvdXRNb2RlbCcsICdpbmhlcml0LWJpbmRpbmctY29udGV4dCddXHJcbn07XHJcbi8qKlxyXG4qIExvY2F0b3Igd2hpY2ggZmluZHMgdGhlIG5lYXJlc3QgUm91dGVyVmlldywgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZGVwZW5kZW5jeSBpbmplY3Rpb24gY29udGFpbmVyLlxyXG4qL1xyXG5jbGFzcyBSb3V0ZXJWaWV3TG9jYXRvciB7XHJcbiAgICAvKipcclxuICAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgUm91dGVyVmlld0xvY2F0b3IgY2xhc3MuXHJcbiAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHRoaXMucmVzb2x2ZSA9IHJlc29sdmUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAqIEZpbmRzIHRoZSBuZWFyZXN0IFJvdXRlclZpZXcgaW5zdGFuY2UuXHJcbiAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgbG9jYXRlZCBSb3V0ZXJWaWV3IGluc3RhbmNlLlxyXG4gICAgKi9cclxuICAgIGZpbmROZWFyZXN0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb21pc2U7XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIF9ub3RpZnkocm91dGVyVmlldykge1xyXG4gICAgICAgIHRoaXMucmVzb2x2ZShyb3V0ZXJWaWV3KTtcclxuICAgIH1cclxufVxuXG4vKipAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xyXG5jbGFzcyBFbXB0eUNsYXNzIHtcclxufVxyXG5pbmxpbmVWaWV3KCc8dGVtcGxhdGU+PC90ZW1wbGF0ZT4nKShFbXB0eUNsYXNzKTtcclxuLyoqXHJcbiAqIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgYFJvdXRlTG9hZGVyYCB1c2VkIGZvciBsb2FkaW5nIGNvbXBvbmVudCBiYXNlZCBvbiBhIHJvdXRlIGNvbmZpZ1xyXG4gKi9cclxuY2xhc3MgVGVtcGxhdGluZ1JvdXRlTG9hZGVyIGV4dGVuZHMgUm91dGVMb2FkZXIge1xyXG4gICAgY29uc3RydWN0b3IoY29tcG9zaXRpb25FbmdpbmUpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVzb2x2ZSBhIHZpZXcgbW9kZWwgZnJvbSBhIFJvdXRlQ29uZmlnXHJcbiAgICAgKiBUaHJvd3Mgd2hlbiB0aGVyZSBpcyBuZWl0aGVyIFwibW9kdWxlSWRcIiBub3IgXCJ2aWV3TW9kZWxcIiBwcm9wZXJ0eVxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHJlc29sdmVWaWV3TW9kZWwocm91dGVyLCBjb25maWcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdmlld01vZGVsO1xyXG4gICAgICAgICAgICBpZiAoJ21vZHVsZUlkJyBpbiBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIGxldCBtb2R1bGVJZCA9IGNvbmZpZy5tb2R1bGVJZDtcclxuICAgICAgICAgICAgICAgIGlmIChtb2R1bGVJZCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbCA9IEVtcHR5Q2xhc3M7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIHJlcXVpcmVzIGNvbnRhaW5lciBvZiByb3V0ZXIgaGFzIHBhc3NlcyBhIGNlcnRhaW4gcG9pbnRcclxuICAgICAgICAgICAgICAgICAgICAvLyB3aGVyZSBhIHZpZXcgbW9kZWwgaGFzIGJlZW4gc2V0dXAgb24gdGhlIGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGl0IHdpbGwgZmFpbCBpbiBlbmhhbmNlIHNjZW5hcmlvIGJlY2F1c2Ugbm8gdmlld3BvcnQgaGFzIGJlZW4gcmVnaXN0ZXJlZFxyXG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZUlkID0gcmVsYXRpdmVUb0ZpbGUobW9kdWxlSWQsIE9yaWdpbi5nZXQocm91dGVyLmNvbnRhaW5lci52aWV3TW9kZWwuY29uc3RydWN0b3IpLm1vZHVsZUlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoL1xcLmh0bWwvaS50ZXN0KG1vZHVsZUlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWwgPSBjcmVhdGVEeW5hbWljQ2xhc3MobW9kdWxlSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsID0gbW9kdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodmlld01vZGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyB0b2RvOiBhZGQgaWYgKCd2aWV3TW9kZWwnIGluIGNvbmZpZykgdG8gc3VwcG9ydCBzdGF0aWMgdmlldyBtb2RlbCByZXNvbHV0aW9uXHJcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0ludmFsaWQgcm91dGUgY29uZmlnLiBObyBcIm1vZHVsZUlkXCIgZm91bmQuJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgY2hpbGQgY29udGFpbmVyIGJhc2VkIG9uIGEgcm91dGVyIGNvbnRhaW5lclxyXG4gICAgICogQWxzbyBlbnN1cmVzIHRoYXQgY2hpbGQgcm91dGVyIGFyZSBwcm9wZXJseSBjb25zdHJ1Y3RlZCBpbiB0aGUgbmV3bHkgY3JlYXRlZCBjaGlsZCBjb250YWluZXJcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBjcmVhdGVDaGlsZENvbnRhaW5lcihyb3V0ZXIpIHtcclxuICAgICAgICBjb25zdCBjaGlsZENvbnRhaW5lciA9IHJvdXRlci5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcclxuICAgICAgICBjaGlsZENvbnRhaW5lci5yZWdpc3RlclNpbmdsZXRvbihSb3V0ZXJWaWV3TG9jYXRvcik7XHJcbiAgICAgICAgY2hpbGRDb250YWluZXIuZ2V0Q2hpbGRSb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGxldCBjaGlsZFJvdXRlcjtcclxuICAgICAgICAgICAgY2hpbGRDb250YWluZXIucmVnaXN0ZXJIYW5kbGVyKFJvdXRlciwgKCkgPT4gY2hpbGRSb3V0ZXIgfHwgKGNoaWxkUm91dGVyID0gcm91dGVyLmNyZWF0ZUNoaWxkKGNoaWxkQ29udGFpbmVyKSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGRDb250YWluZXIuZ2V0KFJvdXRlcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gY2hpbGRDb250YWluZXI7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIExvYWQgY29ycmVzcG9uZGluZyBjb21wb25lbnQgb2YgYSByb3V0ZSBjb25maWcgb2YgYSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uXHJcbiAgICAgKi9cclxuICAgIGxvYWRSb3V0ZShyb3V0ZXIsIGNvbmZpZywgX25hdkluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICAgICAgLnJlc29sdmVWaWV3TW9kZWwocm91dGVyLCBjb25maWcpXHJcbiAgICAgICAgICAgIC50aGVuKHZpZXdNb2RlbCA9PiB0aGlzLmNvbXBvc2l0aW9uRW5naW5lLmVuc3VyZVZpZXdNb2RlbCh7XHJcbiAgICAgICAgICAgIHZpZXdNb2RlbDogdmlld01vZGVsLFxyXG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lcjogdGhpcy5jcmVhdGVDaGlsZENvbnRhaW5lcihyb3V0ZXIpLFxyXG4gICAgICAgICAgICB2aWV3OiBjb25maWcudmlldyB8fCBjb25maWcudmlld1N0cmF0ZWd5LFxyXG4gICAgICAgICAgICByb3V0ZXI6IHJvdXRlclxyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxufVxyXG4vKipAaW50ZXJuYWwgKi9cclxuVGVtcGxhdGluZ1JvdXRlTG9hZGVyLmluamVjdCA9IFtDb21wb3NpdGlvbkVuZ2luZV07XHJcbi8qKkBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nICovXHJcbmZ1bmN0aW9uIGNyZWF0ZUR5bmFtaWNDbGFzcyhtb2R1bGVJZCkge1xyXG4gICAgY29uc3QgbmFtZSA9IC8oW15cXC9eXFw/XSspXFwuaHRtbC9pLmV4ZWMobW9kdWxlSWQpWzFdO1xyXG4gICAgY2xhc3MgRHluYW1pY0NsYXNzIHtcclxuICAgICAgICBiaW5kKGJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudCA9IGJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGN1c3RvbUVsZW1lbnQobmFtZSkoRHluYW1pY0NsYXNzKTtcclxuICAgIHVzZVZpZXcobW9kdWxlSWQpKER5bmFtaWNDbGFzcyk7XHJcbiAgICByZXR1cm4gRHluYW1pY0NsYXNzO1xyXG59XG5cbmNvbnN0IGxvZ2dlciA9IGdldExvZ2dlcigncm91dGUtaHJlZicpO1xyXG4vKipcclxuICogSGVscGVyIGN1c3RvbSBhdHRyaWJ1dGUgdG8gaGVscCBhc3NvY2lhdGUgYW4gZWxlbWVudCB3aXRoIGEgcm91dGUgYnkgbmFtZVxyXG4gKi9cclxuY2xhc3MgUm91dGVIcmVmIHtcclxuICAgIGNvbnN0cnVjdG9yKHJvdXRlciwgZWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGUgPSAnaHJlZic7XHJcbiAgICB9XHJcbiAgICAvKkBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIGluamVjdCgpIHtcclxuICAgICAgICByZXR1cm4gW1JvdXRlciwgRE9NLkVsZW1lbnRdO1xyXG4gICAgfVxyXG4gICAgYmluZCgpIHtcclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnByb2Nlc3NDaGFuZ2UoKTtcclxuICAgIH1cclxuICAgIHVuYmluZCgpIHtcclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBhdHRyaWJ1dGVDaGFuZ2VkKHZhbHVlLCBwcmV2aW91cykge1xyXG4gICAgICAgIGlmIChwcmV2aW91cykge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHByZXZpb3VzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0NoYW5nZSgpO1xyXG4gICAgfVxyXG4gICAgcHJvY2Vzc0NoYW5nZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZXJcclxuICAgICAgICAgICAgLmVuc3VyZUNvbmZpZ3VyZWQoKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuaW5nIG51bGwgdG8gYXZvaWQgQmx1ZWJpcmQgd2FybmluZ1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3QgaHJlZiA9IHRoaXMucm91dGVyLmdlbmVyYXRlKHRoaXMucm91dGUsIHRoaXMucGFyYW1zKTtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXUuY29udHJvbGxlcikge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbFt0aGlzLmF0dHJpYnV0ZV0gPSBocmVmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUodGhpcy5hdHRyaWJ1dGUsIGhyZWYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHJldHVybmluZyBudWxsIHRvIGF2b2lkIEJsdWViaXJkIHdhcm5pbmdcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKChyZWFzb24pID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBBY3RpdmVseSBhdm9pZCB1c2luZyBkZWNvcmF0b3IgdG8gcmVkdWNlIHRoZSBhbW91bnQgb2YgY29kZSBnZW5lcmF0ZWRcclxuICovXHJcblJvdXRlSHJlZi4kcmVzb3VyY2UgPSB7XHJcbiAgICB0eXBlOiAnYXR0cmlidXRlJyxcclxuICAgIG5hbWU6ICdyb3V0ZS1ocmVmJyxcclxuICAgIGJpbmRhYmxlczogW1xyXG4gICAgICAgIHsgbmFtZTogJ3JvdXRlJywgY2hhbmdlSGFuZGxlcjogJ3Byb2Nlc3NDaGFuZ2UnLCBwcmltYXJ5UHJvcGVydHk6IHRydWUgfSxcclxuICAgICAgICB7IG5hbWU6ICdwYXJhbXMnLCBjaGFuZ2VIYW5kbGVyOiAncHJvY2Vzc0NoYW5nZScgfSxcclxuICAgICAgICAnYXR0cmlidXRlJ1xyXG4gICAgXSAvLyB0eXBlIGRlZmluaXRpb24gb2YgQXVyZWxpYSB0ZW1wbGF0aW5nIGlzIHdyb25nXHJcbn07XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcclxuICAgIGNvbmZpZ1xyXG4gICAgICAgIC5zaW5nbGV0b24oUm91dGVMb2FkZXIsIFRlbXBsYXRpbmdSb3V0ZUxvYWRlcilcclxuICAgICAgICAuc2luZ2xldG9uKFJvdXRlciwgQXBwUm91dGVyKVxyXG4gICAgICAgIC5nbG9iYWxSZXNvdXJjZXMoUm91dGVyVmlldywgUm91dGVIcmVmKTtcclxuICAgIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJBbGlhcyhSb3V0ZXIsIEFwcFJvdXRlcik7XHJcbn1cblxuZXhwb3J0IHsgUm91dGVIcmVmLCBSb3V0ZXJWaWV3LCBUZW1wbGF0aW5nUm91dGVMb2FkZXIsIGNvbmZpZ3VyZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci5qcy5tYXBcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcm91dGVyL2Rpc3QvZXMyMDE1L2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM1cUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3p0S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy9MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzlrTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUMzSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDOXJCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDelNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy9yRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3gyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDcDlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OyIsInNvdXJjZVJvb3QiOiIifQ==